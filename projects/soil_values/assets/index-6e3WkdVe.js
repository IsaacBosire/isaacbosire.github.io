var kC=Object.defineProperty;var PC=(i,e,a)=>e in i?kC(i,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[e]=a;var Ls=(i,e,a)=>PC(i,typeof e!="symbol"?e+"":e,a);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))h(p);new MutationObserver(p=>{for(const x of p)if(x.type==="childList")for(const T of x.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&h(T)}).observe(document,{childList:!0,subtree:!0});function a(p){const x={};return p.integrity&&(x.integrity=p.integrity),p.referrerPolicy&&(x.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?x.credentials="include":p.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function h(p){if(p.ep)return;p.ep=!0;const x=a(p);fetch(p.href,x)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function vx(i){const e=Object.create(null);for(const a of i.split(","))e[a]=1;return a=>a in e}const ks={},Np=[],ja=()=>{},IC=()=>!1,e_=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&(i.charCodeAt(2)>122||i.charCodeAt(2)<97),cb=i=>i.startsWith("onUpdate:"),pn=Object.assign,hb=(i,e)=>{const a=i.indexOf(e);a>-1&&i.splice(a,1)},LC=Object.prototype.hasOwnProperty,Xs=(i,e)=>LC.call(i,e),Si=Array.isArray,jp=i=>sm(i)==="[object Map]",bf=i=>sm(i)==="[object Set]",lw=i=>sm(i)==="[object Date]",DC=i=>sm(i)==="[object RegExp]",Wi=i=>typeof i=="function",wn=i=>typeof i=="string",wl=i=>typeof i=="symbol",on=i=>i!==null&&typeof i=="object",ub=i=>(on(i)||Wi(i))&&Wi(i.then)&&Wi(i.catch),SS=Object.prototype.toString,sm=i=>SS.call(i),zC=i=>sm(i).slice(8,-1),bx=i=>sm(i)==="[object Object]",db=i=>wn(i)&&i!=="NaN"&&i[0]!=="-"&&""+parseInt(i,10)===i,Up=vx(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),wx=i=>{const e=Object.create(null);return a=>e[a]||(e[a]=i(a))},OC=/-(\w)/g,zr=wx(i=>i.replace(OC,(e,a)=>a?a.toUpperCase():"")),RC=/\B([A-Z])/g,Go=wx(i=>i.replace(RC,"-$1").toLowerCase()),i_=wx(i=>i.charAt(0).toUpperCase()+i.slice(1)),Sg=wx(i=>i?`on${i_(i)}`:""),xo=(i,e)=>!Object.is(i,e),Vp=(i,...e)=>{for(let a=0;a<i.length;a++)i[a](...e)},ES=(i,e,a,h=!1)=>{Object.defineProperty(i,e,{configurable:!0,enumerable:!1,writable:h,value:a})},qy=i=>{const e=parseFloat(i);return isNaN(e)?i:e},Zy=i=>{const e=wn(i)?Number(i):NaN;return isNaN(e)?i:e};let cw;const Tx=()=>cw||(cw=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),BC="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt,console,Error,Symbol",FC=vx(BC);function wf(i){if(Si(i)){const e={};for(let a=0;a<i.length;a++){const h=i[a],p=wn(h)?VC(h):wf(h);if(p)for(const x in p)e[x]=p[x]}return e}else if(wn(i)||on(i))return i}const NC=/;(?![^(]*\))/g,jC=/:([^]+)/,UC=/\/\*[^]*?\*\//g;function VC(i){const e={};return i.replace(UC,"").split(NC).forEach(a=>{if(a){const h=a.split(jC);h.length>1&&(e[h[0].trim()]=h[1].trim())}}),e}function nm(i){let e="";if(wn(i))e=i;else if(Si(i))for(let a=0;a<i.length;a++){const h=nm(i[a]);h&&(e+=h+" ")}else if(on(i))for(const a in i)i[a]&&(e+=a+" ");return e.trim()}function $C(i){if(!i)return null;let{class:e,style:a}=i;return e&&!wn(e)&&(i.class=nm(e)),a&&(i.style=wf(a)),i}const GC="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",WC=vx(GC);function MS(i){return!!i||i===""}function HC(i,e){if(i.length!==e.length)return!1;let a=!0;for(let h=0;a&&h<i.length;h++)a=Du(i[h],e[h]);return a}function Du(i,e){if(i===e)return!0;let a=lw(i),h=lw(e);if(a||h)return a&&h?i.getTime()===e.getTime():!1;if(a=wl(i),h=wl(e),a||h)return i===e;if(a=Si(i),h=Si(e),a||h)return a&&h?HC(i,e):!1;if(a=on(i),h=on(e),a||h){if(!a||!h)return!1;const p=Object.keys(i).length,x=Object.keys(e).length;if(p!==x)return!1;for(const T in i){const P=i.hasOwnProperty(T),o=e.hasOwnProperty(T);if(P&&!o||!P&&o||!Du(i[T],e[T]))return!1}}return String(i)===String(e)}function Sx(i,e){return i.findIndex(a=>Du(a,e))}const AS=i=>!!(i&&i.__v_isRef===!0),Dn=i=>wn(i)?i:i==null?"":Si(i)||on(i)&&(i.toString===SS||!Wi(i.toString))?AS(i)?Dn(i.value):JSON.stringify(i,CS,2):String(i),CS=(i,e)=>AS(e)?CS(i,e.value):jp(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((a,[h,p],x)=>(a[ev(h,x)+" =>"]=p,a),{})}:bf(e)?{[`Set(${e.size})`]:[...e.values()].map(a=>ev(a))}:wl(e)?ev(e):on(e)&&!Si(e)&&!bx(e)?String(e):e,ev=(i,e="")=>{var a;return wl(i)?`Symbol(${(a=i.description)!=null?a:e})`:i};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let yo;class fb{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=yo,!e&&yo&&(this.index=(yo.scopes||(yo.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,a;if(this.scopes)for(e=0,a=this.scopes.length;e<a;e++)this.scopes[e].pause();for(e=0,a=this.effects.length;e<a;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,a;if(this.scopes)for(e=0,a=this.scopes.length;e<a;e++)this.scopes[e].resume();for(e=0,a=this.effects.length;e<a;e++)this.effects[e].resume()}}run(e){if(this._active){const a=yo;try{return yo=this,e()}finally{yo=a}}}on(){yo=this}off(){yo=this.parent}stop(e){if(this._active){this._active=!1;let a,h;for(a=0,h=this.effects.length;a<h;a++)this.effects[a].stop();for(this.effects.length=0,a=0,h=this.cleanups.length;a<h;a++)this.cleanups[a]();if(this.cleanups.length=0,this.scopes){for(a=0,h=this.scopes.length;a<h;a++)this.scopes[a].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const p=this.parent.scopes.pop();p&&p!==this&&(this.parent.scopes[this.index]=p,p.index=this.index)}this.parent=void 0}}}function pb(i){return new fb(i)}function mb(){return yo}function kS(i,e=!1){yo&&yo.cleanups.push(i)}let bn;const iv=new WeakSet;class jg{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,yo&&yo.active&&yo.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,iv.has(this)&&(iv.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||IS(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,hw(this),LS(this);const e=bn,a=bl;bn=this,bl=!0;try{return this.fn()}finally{DS(this),bn=e,bl=a,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)yb(e);this.deps=this.depsTail=void 0,hw(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?iv.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Pv(this)&&this.run()}get dirty(){return Pv(this)}}let PS=0,Eg,Mg;function IS(i,e=!1){if(i.flags|=8,e){i.next=Mg,Mg=i;return}i.next=Eg,Eg=i}function gb(){PS++}function _b(){if(--PS>0)return;if(Mg){let e=Mg;for(Mg=void 0;e;){const a=e.next;e.next=void 0,e.flags&=-9,e=a}}let i;for(;Eg;){let e=Eg;for(Eg=void 0;e;){const a=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(h){i||(i=h)}e=a}}if(i)throw i}function LS(i){for(let e=i.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function DS(i){let e,a=i.depsTail,h=a;for(;h;){const p=h.prevDep;h.version===-1?(h===a&&(a=p),yb(h),XC(h)):e=h,h.dep.activeLink=h.prevActiveLink,h.prevActiveLink=void 0,h=p}i.deps=e,i.depsTail=a}function Pv(i){for(let e=i.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(zS(e.dep.computed)||e.dep.version!==e.version))return!0;return!!i._dirty}function zS(i){if(i.flags&4&&!(i.flags&16)||(i.flags&=-17,i.globalVersion===Ug))return;i.globalVersion=Ug;const e=i.dep;if(i.flags|=2,e.version>0&&!i.isSSR&&i.deps&&!Pv(i)){i.flags&=-3;return}const a=bn,h=bl;bn=i,bl=!0;try{LS(i);const p=i.fn(i._value);(e.version===0||xo(p,i._value))&&(i._value=p,e.version++)}catch(p){throw e.version++,p}finally{bn=a,bl=h,DS(i),i.flags&=-3}}function yb(i,e=!1){const{dep:a,prevSub:h,nextSub:p}=i;if(h&&(h.nextSub=p,i.prevSub=void 0),p&&(p.prevSub=h,i.nextSub=void 0),a.subs===i&&(a.subs=h,!h&&a.computed)){a.computed.flags&=-5;for(let x=a.computed.deps;x;x=x.nextDep)yb(x,!0)}!e&&!--a.sc&&a.map&&a.map.delete(a.key)}function XC(i){const{prevDep:e,nextDep:a}=i;e&&(e.nextDep=a,i.prevDep=void 0),a&&(a.prevDep=e,i.nextDep=void 0)}function qC(i,e){i.effect instanceof jg&&(i=i.effect.fn);const a=new jg(i);e&&pn(a,e);try{a.run()}catch(p){throw a.stop(),p}const h=a.run.bind(a);return h.effect=a,h}function ZC(i){i.effect.stop()}let bl=!0;const OS=[];function Bu(){OS.push(bl),bl=!1}function Fu(){const i=OS.pop();bl=i===void 0?!0:i}function hw(i){const{cleanup:e}=i;if(i.cleanup=void 0,e){const a=bn;bn=void 0;try{e()}finally{bn=a}}}let Ug=0;class YC{constructor(e,a){this.sub=e,this.dep=a,this.version=a.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Ex{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){if(!bn||!bl||bn===this.computed)return;let a=this.activeLink;if(a===void 0||a.sub!==bn)a=this.activeLink=new YC(bn,this),bn.deps?(a.prevDep=bn.depsTail,bn.depsTail.nextDep=a,bn.depsTail=a):bn.deps=bn.depsTail=a,RS(a);else if(a.version===-1&&(a.version=this.version,a.nextDep)){const h=a.nextDep;h.prevDep=a.prevDep,a.prevDep&&(a.prevDep.nextDep=h),a.prevDep=bn.depsTail,a.nextDep=void 0,bn.depsTail.nextDep=a,bn.depsTail=a,bn.deps===a&&(bn.deps=h)}return a}trigger(e){this.version++,Ug++,this.notify(e)}notify(e){gb();try{for(let a=this.subs;a;a=a.prevSub)a.sub.notify()&&a.sub.dep.notify()}finally{_b()}}}function RS(i){if(i.dep.sc++,i.sub.flags&4){const e=i.dep.computed;if(e&&!i.dep.subs){e.flags|=20;for(let h=e.deps;h;h=h.nextDep)RS(h)}const a=i.dep.subs;a!==i&&(i.prevSub=a,a&&(a.nextSub=i)),i.dep.subs=i}}const Yy=new WeakMap,ff=Symbol(""),Iv=Symbol(""),Vg=Symbol("");function Yr(i,e,a){if(bl&&bn){let h=Yy.get(i);h||Yy.set(i,h=new Map);let p=h.get(a);p||(h.set(a,p=new Ex),p.map=h,p.key=a),p.track()}}function ah(i,e,a,h,p,x){const T=Yy.get(i);if(!T){Ug++;return}const P=o=>{o&&o.trigger()};if(gb(),e==="clear")T.forEach(P);else{const o=Si(i),z=o&&db(a);if(o&&a==="length"){const $=Number(h);T.forEach((q,Q)=>{(Q==="length"||Q===Vg||!wl(Q)&&Q>=$)&&P(q)})}else switch((a!==void 0||T.has(void 0))&&P(T.get(a)),z&&P(T.get(Vg)),e){case"add":o?z&&P(T.get("length")):(P(T.get(ff)),jp(i)&&P(T.get(Iv)));break;case"delete":o||(P(T.get(ff)),jp(i)&&P(T.get(Iv)));break;case"set":jp(i)&&P(T.get(ff));break}}_b()}function KC(i,e){const a=Yy.get(i);return a&&a.get(e)}function Pp(i){const e=Cs(i);return e===i?e:(Yr(e,"iterate",Vg),_a(i)?e:e.map(Kr))}function Mx(i){return Yr(i=Cs(i),"iterate",Vg),i}const JC={__proto__:null,[Symbol.iterator](){return sv(this,Symbol.iterator,Kr)},concat(...i){return Pp(this).concat(...i.map(e=>Si(e)?Pp(e):e))},entries(){return sv(this,"entries",i=>(i[1]=Kr(i[1]),i))},every(i,e){return Qc(this,"every",i,e,void 0,arguments)},filter(i,e){return Qc(this,"filter",i,e,a=>a.map(Kr),arguments)},find(i,e){return Qc(this,"find",i,e,Kr,arguments)},findIndex(i,e){return Qc(this,"findIndex",i,e,void 0,arguments)},findLast(i,e){return Qc(this,"findLast",i,e,Kr,arguments)},findLastIndex(i,e){return Qc(this,"findLastIndex",i,e,void 0,arguments)},forEach(i,e){return Qc(this,"forEach",i,e,void 0,arguments)},includes(...i){return nv(this,"includes",i)},indexOf(...i){return nv(this,"indexOf",i)},join(i){return Pp(this).join(i)},lastIndexOf(...i){return nv(this,"lastIndexOf",i)},map(i,e){return Qc(this,"map",i,e,void 0,arguments)},pop(){return hg(this,"pop")},push(...i){return hg(this,"push",i)},reduce(i,...e){return uw(this,"reduce",i,e)},reduceRight(i,...e){return uw(this,"reduceRight",i,e)},shift(){return hg(this,"shift")},some(i,e){return Qc(this,"some",i,e,void 0,arguments)},splice(...i){return hg(this,"splice",i)},toReversed(){return Pp(this).toReversed()},toSorted(i){return Pp(this).toSorted(i)},toSpliced(...i){return Pp(this).toSpliced(...i)},unshift(...i){return hg(this,"unshift",i)},values(){return sv(this,"values",Kr)}};function sv(i,e,a){const h=Mx(i),p=h[e]();return h!==i&&!_a(i)&&(p._next=p.next,p.next=()=>{const x=p._next();return x.value&&(x.value=a(x.value)),x}),p}const QC=Array.prototype;function Qc(i,e,a,h,p,x){const T=Mx(i),P=T!==i&&!_a(i),o=T[e];if(o!==QC[e]){const q=o.apply(i,x);return P?Kr(q):q}let z=a;T!==i&&(P?z=function(q,Q){return a.call(this,Kr(q),Q,i)}:a.length>2&&(z=function(q,Q){return a.call(this,q,Q,i)}));const $=o.call(T,z,h);return P&&p?p($):$}function uw(i,e,a,h){const p=Mx(i);let x=a;return p!==i&&(_a(i)?a.length>3&&(x=function(T,P,o){return a.call(this,T,P,o,i)}):x=function(T,P,o){return a.call(this,T,Kr(P),o,i)}),p[e](x,...h)}function nv(i,e,a){const h=Cs(i);Yr(h,"iterate",Vg);const p=h[e](...a);return(p===-1||p===!1)&&kx(a[0])?(a[0]=Cs(a[0]),h[e](...a)):p}function hg(i,e,a=[]){Bu(),gb();const h=Cs(i)[e].apply(i,a);return _b(),Fu(),h}const tk=vx("__proto__,__v_isRef,__isVue"),BS=new Set(Object.getOwnPropertyNames(Symbol).filter(i=>i!=="arguments"&&i!=="caller").map(i=>Symbol[i]).filter(wl));function ek(i){wl(i)||(i=String(i));const e=Cs(this);return Yr(e,"has",i),e.hasOwnProperty(i)}class FS{constructor(e=!1,a=!1){this._isReadonly=e,this._isShallow=a}get(e,a,h){if(a==="__v_skip")return e.__v_skip;const p=this._isReadonly,x=this._isShallow;if(a==="__v_isReactive")return!p;if(a==="__v_isReadonly")return p;if(a==="__v_isShallow")return x;if(a==="__v_raw")return h===(p?x?GS:$S:x?VS:US).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(h)?e:void 0;const T=Si(e);if(!p){let o;if(T&&(o=JC[a]))return o;if(a==="hasOwnProperty")return ek}const P=Reflect.get(e,a,Un(e)?e:h);return(wl(a)?BS.has(a):tk(a))||(p||Yr(e,"get",a),x)?P:Un(P)?T&&db(a)?P:P.value:on(P)?p?vb(P):rm(P):P}}class NS extends FS{constructor(e=!1){super(!1,e)}set(e,a,h,p){let x=e[a];if(!this._isShallow){const o=zu(x);if(!_a(h)&&!zu(h)&&(x=Cs(x),h=Cs(h)),!Si(e)&&Un(x)&&!Un(h))return o?!1:(x.value=h,!0)}const T=Si(e)&&db(a)?Number(a)<e.length:Xs(e,a),P=Reflect.set(e,a,h,Un(e)?e:p);return e===Cs(p)&&(T?xo(h,x)&&ah(e,"set",a,h):ah(e,"add",a,h)),P}deleteProperty(e,a){const h=Xs(e,a);e[a];const p=Reflect.deleteProperty(e,a);return p&&h&&ah(e,"delete",a,void 0),p}has(e,a){const h=Reflect.has(e,a);return(!wl(a)||!BS.has(a))&&Yr(e,"has",a),h}ownKeys(e){return Yr(e,"iterate",Si(e)?"length":ff),Reflect.ownKeys(e)}}class jS extends FS{constructor(e=!1){super(!0,e)}set(e,a){return!0}deleteProperty(e,a){return!0}}const ik=new NS,sk=new jS,nk=new NS(!0),rk=new jS(!0),Lv=i=>i,my=i=>Reflect.getPrototypeOf(i);function ok(i,e,a){return function(...h){const p=this.__v_raw,x=Cs(p),T=jp(x),P=i==="entries"||i===Symbol.iterator&&T,o=i==="keys"&&T,z=p[i](...h),$=a?Lv:e?Dv:Kr;return!e&&Yr(x,"iterate",o?Iv:ff),{next(){const{value:q,done:Q}=z.next();return Q?{value:q,done:Q}:{value:P?[$(q[0]),$(q[1])]:$(q),done:Q}},[Symbol.iterator](){return this}}}}function gy(i){return function(...e){return i==="delete"?!1:i==="clear"?void 0:this}}function ak(i,e){const a={get(p){const x=this.__v_raw,T=Cs(x),P=Cs(p);i||(xo(p,P)&&Yr(T,"get",p),Yr(T,"get",P));const{has:o}=my(T),z=e?Lv:i?Dv:Kr;if(o.call(T,p))return z(x.get(p));if(o.call(T,P))return z(x.get(P));x!==T&&x.get(p)},get size(){const p=this.__v_raw;return!i&&Yr(Cs(p),"iterate",ff),Reflect.get(p,"size",p)},has(p){const x=this.__v_raw,T=Cs(x),P=Cs(p);return i||(xo(p,P)&&Yr(T,"has",p),Yr(T,"has",P)),p===P?x.has(p):x.has(p)||x.has(P)},forEach(p,x){const T=this,P=T.__v_raw,o=Cs(P),z=e?Lv:i?Dv:Kr;return!i&&Yr(o,"iterate",ff),P.forEach(($,q)=>p.call(x,z($),z(q),T))}};return pn(a,i?{add:gy("add"),set:gy("set"),delete:gy("delete"),clear:gy("clear")}:{add(p){!e&&!_a(p)&&!zu(p)&&(p=Cs(p));const x=Cs(this);return my(x).has.call(x,p)||(x.add(p),ah(x,"add",p,p)),this},set(p,x){!e&&!_a(x)&&!zu(x)&&(x=Cs(x));const T=Cs(this),{has:P,get:o}=my(T);let z=P.call(T,p);z||(p=Cs(p),z=P.call(T,p));const $=o.call(T,p);return T.set(p,x),z?xo(x,$)&&ah(T,"set",p,x):ah(T,"add",p,x),this},delete(p){const x=Cs(this),{has:T,get:P}=my(x);let o=T.call(x,p);o||(p=Cs(p),o=T.call(x,p)),P&&P.call(x,p);const z=x.delete(p);return o&&ah(x,"delete",p,void 0),z},clear(){const p=Cs(this),x=p.size!==0,T=p.clear();return x&&ah(p,"clear",void 0,void 0),T}}),["keys","values","entries",Symbol.iterator].forEach(p=>{a[p]=ok(p,i,e)}),a}function Ax(i,e){const a=ak(i,e);return(h,p,x)=>p==="__v_isReactive"?!i:p==="__v_isReadonly"?i:p==="__v_raw"?h:Reflect.get(Xs(a,p)&&p in h?a:h,p,x)}const lk={get:Ax(!1,!1)},ck={get:Ax(!1,!0)},hk={get:Ax(!0,!1)},uk={get:Ax(!0,!0)},US=new WeakMap,VS=new WeakMap,$S=new WeakMap,GS=new WeakMap;function dk(i){switch(i){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function fk(i){return i.__v_skip||!Object.isExtensible(i)?0:dk(zC(i))}function rm(i){return zu(i)?i:Cx(i,!1,ik,lk,US)}function xb(i){return Cx(i,!1,nk,ck,VS)}function vb(i){return Cx(i,!0,sk,hk,$S)}function pk(i){return Cx(i,!0,rk,uk,GS)}function Cx(i,e,a,h,p){if(!on(i)||i.__v_raw&&!(e&&i.__v_isReactive))return i;const x=p.get(i);if(x)return x;const T=fk(i);if(T===0)return i;const P=new Proxy(i,T===2?h:a);return p.set(i,P),P}function mc(i){return zu(i)?mc(i.__v_raw):!!(i&&i.__v_isReactive)}function zu(i){return!!(i&&i.__v_isReadonly)}function _a(i){return!!(i&&i.__v_isShallow)}function kx(i){return i?!!i.__v_raw:!1}function Cs(i){const e=i&&i.__v_raw;return e?Cs(e):i}function Px(i){return!Xs(i,"__v_skip")&&Object.isExtensible(i)&&ES(i,"__v_skip",!0),i}const Kr=i=>on(i)?rm(i):i,Dv=i=>on(i)?vb(i):i;function Un(i){return i?i.__v_isRef===!0:!1}function Bs(i){return WS(i,!1)}function bb(i){return WS(i,!0)}function WS(i,e){return Un(i)?i:new mk(i,e)}class mk{constructor(e,a){this.dep=new Ex,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=a?e:Cs(e),this._value=a?e:Kr(e),this.__v_isShallow=a}get value(){return this.dep.track(),this._value}set value(e){const a=this._rawValue,h=this.__v_isShallow||_a(e)||zu(e);e=h?e:Cs(e),xo(e,a)&&(this._rawValue=e,this._value=h?e:Kr(e),this.dep.trigger())}}function gk(i){i.dep&&i.dep.trigger()}function hh(i){return Un(i)?i.value:i}function _k(i){return Wi(i)?i():hh(i)}const yk={get:(i,e,a)=>e==="__v_raw"?i:hh(Reflect.get(i,e,a)),set:(i,e,a,h)=>{const p=i[e];return Un(p)&&!Un(a)?(p.value=a,!0):Reflect.set(i,e,a,h)}};function wb(i){return mc(i)?i:new Proxy(i,yk)}class xk{constructor(e){this.__v_isRef=!0,this._value=void 0;const a=this.dep=new Ex,{get:h,set:p}=e(a.track.bind(a),a.trigger.bind(a));this._get=h,this._set=p}get value(){return this._value=this._get()}set value(e){this._set(e)}}function HS(i){return new xk(i)}function XS(i){const e=Si(i)?new Array(i.length):{};for(const a in i)e[a]=qS(i,a);return e}class vk{constructor(e,a,h){this._object=e,this._key=a,this._defaultValue=h,this.__v_isRef=!0,this._value=void 0}get value(){const e=this._object[this._key];return this._value=e===void 0?this._defaultValue:e}set value(e){this._object[this._key]=e}get dep(){return KC(Cs(this._object),this._key)}}class bk{constructor(e){this._getter=e,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=void 0}get value(){return this._value=this._getter()}}function wk(i,e,a){return Un(i)?i:Wi(i)?new bk(i):on(i)&&arguments.length>1?qS(i,e,a):Bs(i)}function qS(i,e,a){const h=i[e];return Un(h)?h:new vk(i,e,a)}class Tk{constructor(e,a,h){this.fn=e,this.setter=a,this._value=void 0,this.dep=new Ex(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Ug-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!a,this.isSSR=h}notify(){if(this.flags|=16,!(this.flags&8)&&bn!==this)return IS(this,!0),!0}get value(){const e=this.dep.track();return zS(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function Sk(i,e,a=!1){let h,p;return Wi(i)?h=i:(h=i.get,p=i.set),new Tk(h,p,a)}const Ek={GET:"get",HAS:"has",ITERATE:"iterate"},Mk={SET:"set",ADD:"add",DELETE:"delete",CLEAR:"clear"},_y={},Ky=new WeakMap;let vu;function Ak(){return vu}function ZS(i,e=!1,a=vu){if(a){let h=Ky.get(a);h||Ky.set(a,h=[]),h.push(i)}}function Ck(i,e,a=ks){const{immediate:h,deep:p,once:x,scheduler:T,augmentJob:P,call:o}=a,z=It=>p?It:_a(It)||p===!1||p===0?lh(It,1):lh(It);let $,q,Q,nt,Tt=!1,yt=!1;if(Un(i)?(q=()=>i.value,Tt=_a(i)):mc(i)?(q=()=>z(i),Tt=!0):Si(i)?(yt=!0,Tt=i.some(It=>mc(It)||_a(It)),q=()=>i.map(It=>{if(Un(It))return It.value;if(mc(It))return z(It);if(Wi(It))return o?o(It,2):It()})):Wi(i)?e?q=o?()=>o(i,2):i:q=()=>{if(Q){Bu();try{Q()}finally{Fu()}}const It=vu;vu=$;try{return o?o(i,3,[nt]):i(nt)}finally{vu=It}}:q=ja,e&&p){const It=q,Xt=p===!0?1/0:p;q=()=>lh(It(),Xt)}const Lt=mb(),Nt=()=>{$.stop(),Lt&&Lt.active&&hb(Lt.effects,$)};if(x&&e){const It=e;e=(...Xt)=>{It(...Xt),Nt()}}let Dt=yt?new Array(i.length).fill(_y):_y;const wt=It=>{if(!(!($.flags&1)||!$.dirty&&!It))if(e){const Xt=$.run();if(p||Tt||(yt?Xt.some((Zt,re)=>xo(Zt,Dt[re])):xo(Xt,Dt))){Q&&Q();const Zt=vu;vu=$;try{const re=[Xt,Dt===_y?void 0:yt&&Dt[0]===_y?[]:Dt,nt];o?o(e,3,re):e(...re),Dt=Xt}finally{vu=Zt}}}else $.run()};return P&&P(wt),$=new jg(q),$.scheduler=T?()=>T(wt,!1):wt,nt=It=>ZS(It,!1,$),Q=$.onStop=()=>{const It=Ky.get($);if(It){if(o)o(It,4);else for(const Xt of It)Xt();Ky.delete($)}},e?h?wt(!0):Dt=$.run():T?T(wt.bind(null,!0),!0):$.run(),Nt.pause=$.pause.bind($),Nt.resume=$.resume.bind($),Nt.stop=Nt,Nt}function lh(i,e=1/0,a){if(e<=0||!on(i)||i.__v_skip||(a=a||new Set,a.has(i)))return i;if(a.add(i),e--,Un(i))lh(i.value,e,a);else if(Si(i))for(let h=0;h<i.length;h++)lh(i[h],e,a);else if(bf(i)||jp(i))i.forEach(h=>{lh(h,e,a)});else if(bx(i)){for(const h in i)lh(i[h],e,a);for(const h of Object.getOwnPropertySymbols(i))Object.prototype.propertyIsEnumerable.call(i,h)&&lh(i[h],e,a)}return i}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const YS=[];function kk(i){YS.push(i)}function Pk(){YS.pop()}function Ik(i,e){}const Lk={SETUP_FUNCTION:0,0:"SETUP_FUNCTION",RENDER_FUNCTION:1,1:"RENDER_FUNCTION",NATIVE_EVENT_HANDLER:5,5:"NATIVE_EVENT_HANDLER",COMPONENT_EVENT_HANDLER:6,6:"COMPONENT_EVENT_HANDLER",VNODE_HOOK:7,7:"VNODE_HOOK",DIRECTIVE_HOOK:8,8:"DIRECTIVE_HOOK",TRANSITION_HOOK:9,9:"TRANSITION_HOOK",APP_ERROR_HANDLER:10,10:"APP_ERROR_HANDLER",APP_WARN_HANDLER:11,11:"APP_WARN_HANDLER",FUNCTION_REF:12,12:"FUNCTION_REF",ASYNC_COMPONENT_LOADER:13,13:"ASYNC_COMPONENT_LOADER",SCHEDULER:14,14:"SCHEDULER",COMPONENT_UPDATE:15,15:"COMPONENT_UPDATE",APP_UNMOUNT_CLEANUP:16,16:"APP_UNMOUNT_CLEANUP"},Dk={sp:"serverPrefetch hook",bc:"beforeCreate hook",c:"created hook",bm:"beforeMount hook",m:"mounted hook",bu:"beforeUpdate hook",u:"updated",bum:"beforeUnmount hook",um:"unmounted hook",a:"activated hook",da:"deactivated hook",ec:"errorCaptured hook",rtc:"renderTracked hook",rtg:"renderTriggered hook",0:"setup function",1:"render function",2:"watcher getter",3:"watcher callback",4:"watcher cleanup function",5:"native event handler",6:"component event handler",7:"vnode hook",8:"directive hook",9:"transition hook",10:"app errorHandler",11:"app warnHandler",12:"ref function",13:"async component loader",14:"scheduler flush",15:"component update",16:"app unmount cleanup function"};function om(i,e,a,h){try{return h?i(...h):i()}catch(p){Tf(p,e,a)}}function $a(i,e,a,h){if(Wi(i)){const p=om(i,e,a,h);return p&&ub(p)&&p.catch(x=>{Tf(x,e,a)}),p}if(Si(i)){const p=[];for(let x=0;x<i.length;x++)p.push($a(i[x],e,a,h));return p}}function Tf(i,e,a,h=!0){const p=e?e.vnode:null,{errorHandler:x,throwUnhandledErrorInProduction:T}=e&&e.appContext.config||ks;if(e){let P=e.parent;const o=e.proxy,z=`https://vuejs.org/error-reference/#runtime-${a}`;for(;P;){const $=P.ec;if($){for(let q=0;q<$.length;q++)if($[q](i,o,z)===!1)return}P=P.parent}if(x){Bu(),om(x,null,10,[i,o,z]),Fu();return}}zk(i,a,p,h,T)}function zk(i,e,a,h=!0,p=!1){if(p)throw i;console.error(i)}const vo=[];let dc=-1;const $p=[];let bu=null,zp=0;const KS=Promise.resolve();let Jy=null;function Sf(i){const e=Jy||KS;return i?e.then(this?i.bind(this):i):e}function Ok(i){let e=dc+1,a=vo.length;for(;e<a;){const h=e+a>>>1,p=vo[h],x=Gg(p);x<i||x===i&&p.flags&2?e=h+1:a=h}return e}function Tb(i){if(!(i.flags&1)){const e=Gg(i),a=vo[vo.length-1];!a||!(i.flags&2)&&e>=Gg(a)?vo.push(i):vo.splice(Ok(e),0,i),i.flags|=1,JS()}}function JS(){Jy||(Jy=KS.then(QS))}function $g(i){Si(i)?$p.push(...i):bu&&i.id===-1?bu.splice(zp+1,0,i):i.flags&1||($p.push(i),i.flags|=1),JS()}function dw(i,e,a=dc+1){for(;a<vo.length;a++){const h=vo[a];if(h&&h.flags&2){if(i&&h.id!==i.uid)continue;vo.splice(a,1),a--,h.flags&4&&(h.flags&=-2),h(),h.flags&4||(h.flags&=-2)}}}function Qy(i){if($p.length){const e=[...new Set($p)].sort((a,h)=>Gg(a)-Gg(h));if($p.length=0,bu){bu.push(...e);return}for(bu=e,zp=0;zp<bu.length;zp++){const a=bu[zp];a.flags&4&&(a.flags&=-2),a.flags&8||a(),a.flags&=-2}bu=null,zp=0}}const Gg=i=>i.id==null?i.flags&2?-1:1/0:i.id;function QS(i){try{for(dc=0;dc<vo.length;dc++){const e=vo[dc];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),om(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;dc<vo.length;dc++){const e=vo[dc];e&&(e.flags&=-2)}dc=-1,vo.length=0,Qy(),Jy=null,(vo.length||$p.length)&&QS()}}let Op,yy=[];function tE(i,e){var a,h;Op=i,Op?(Op.enabled=!0,yy.forEach(({event:p,args:x})=>Op.emit(p,...x)),yy=[]):typeof window<"u"&&window.HTMLElement&&!((h=(a=window.navigator)==null?void 0:a.userAgent)!=null&&h.includes("jsdom"))?((e.__VUE_DEVTOOLS_HOOK_REPLAY__=e.__VUE_DEVTOOLS_HOOK_REPLAY__||[]).push(x=>{tE(x,e)}),setTimeout(()=>{Op||(e.__VUE_DEVTOOLS_HOOK_REPLAY__=null,yy=[])},3e3)):yy=[]}let vr=null,Ix=null;function Wg(i){const e=vr;return vr=i,Ix=i&&i.type.__scopeId||null,e}function Rk(i){Ix=i}function Bk(){Ix=null}const Fk=i=>Fa;function Fa(i,e=vr,a){if(!e||i._n)return i;const h=(...p)=>{h._d&&Uv(-1);const x=Wg(e);let T;try{T=i(...p)}finally{Wg(x),h._d&&Uv(1)}return T};return h._n=!0,h._c=!0,h._d=!0,h}function Ag(i,e){if(vr===null)return i;const a=o_(vr),h=i.dirs||(i.dirs=[]);for(let p=0;p<e.length;p++){let[x,T,P,o=ks]=e[p];x&&(Wi(x)&&(x={mounted:x,updated:x}),x.deep&&lh(T),h.push({dir:x,instance:a,value:T,oldValue:void 0,arg:P,modifiers:o}))}return i}function pc(i,e,a,h){const p=i.dirs,x=e&&e.dirs;for(let T=0;T<p.length;T++){const P=p[T];x&&(P.oldValue=x[T].value);let o=P.dir[h];o&&(Bu(),$a(o,a,8,[i.el,P,i,e]),Fu())}}const eE=Symbol("_vte"),iE=i=>i.__isTeleport,Cg=i=>i&&(i.disabled||i.disabled===""),fw=i=>i&&(i.defer||i.defer===""),pw=i=>typeof SVGElement<"u"&&i instanceof SVGElement,mw=i=>typeof MathMLElement=="function"&&i instanceof MathMLElement,zv=(i,e)=>{const a=i&&i.to;return wn(a)?e?e(a):null:a},sE={name:"Teleport",__isTeleport:!0,process(i,e,a,h,p,x,T,P,o,z){const{mc:$,pc:q,pbc:Q,o:{insert:nt,querySelector:Tt,createText:yt,createComment:Lt}}=z,Nt=Cg(e.props);let{shapeFlag:Dt,children:wt,dynamicChildren:It}=e;if(i==null){const Xt=e.el=yt(""),Zt=e.anchor=yt("");nt(Xt,a,h),nt(Zt,a,h);const re=(ne,Ut)=>{Dt&16&&(p&&p.isCE&&(p.ce._teleportTarget=ne),$(wt,ne,Ut,p,x,T,P,o))},kt=()=>{const ne=e.target=zv(e.props,Tt),Ut=nE(ne,e,yt,nt);ne&&(T!=="svg"&&pw(ne)?T="svg":T!=="mathml"&&mw(ne)&&(T="mathml"),Nt||(re(ne,Ut),Ny(e,!1)))};Nt&&(re(a,Zt),Ny(e,!0)),fw(e.props)?yr(()=>{kt(),e.el.__isMounted=!0},x):kt()}else{if(fw(e.props)&&!i.el.__isMounted){yr(()=>{sE.process(i,e,a,h,p,x,T,P,o,z),delete i.el.__isMounted},x);return}e.el=i.el,e.targetStart=i.targetStart;const Xt=e.anchor=i.anchor,Zt=e.target=i.target,re=e.targetAnchor=i.targetAnchor,kt=Cg(i.props),ne=kt?a:Zt,Ut=kt?Xt:re;if(T==="svg"||pw(Zt)?T="svg":(T==="mathml"||mw(Zt))&&(T="mathml"),It?(Q(i.dynamicChildren,It,ne,p,x,T,P),Db(i,e,!0)):o||q(i,e,ne,Ut,p,x,T,P,!1),Nt)kt?e.props&&i.props&&e.props.to!==i.props.to&&(e.props.to=i.props.to):xy(e,a,Xt,z,1);else if((e.props&&e.props.to)!==(i.props&&i.props.to)){const Le=e.target=zv(e.props,Tt);Le&&xy(e,Le,null,z,0)}else kt&&xy(e,Zt,re,z,1);Ny(e,Nt)}},remove(i,e,a,{um:h,o:{remove:p}},x){const{shapeFlag:T,children:P,anchor:o,targetStart:z,targetAnchor:$,target:q,props:Q}=i;if(q&&(p(z),p($)),x&&p(o),T&16){const nt=x||!Cg(Q);for(let Tt=0;Tt<P.length;Tt++){const yt=P[Tt];h(yt,e,a,nt,!!yt.dynamicChildren)}}},move:xy,hydrate:Nk};function xy(i,e,a,{o:{insert:h},m:p},x=2){x===0&&h(i.targetAnchor,e,a);const{el:T,anchor:P,shapeFlag:o,children:z,props:$}=i,q=x===2;if(q&&h(T,e,a),(!q||Cg($))&&o&16)for(let Q=0;Q<z.length;Q++)p(z[Q],e,a,2);q&&h(P,e,a)}function Nk(i,e,a,h,p,x,{o:{nextSibling:T,parentNode:P,querySelector:o,insert:z,createText:$}},q){const Q=e.target=zv(e.props,o);if(Q){const nt=Cg(e.props),Tt=Q._lpa||Q.firstChild;if(e.shapeFlag&16)if(nt)e.anchor=q(T(i),e,P(i),a,h,p,x),e.targetStart=Tt,e.targetAnchor=Tt&&T(Tt);else{e.anchor=T(i);let yt=Tt;for(;yt;){if(yt&&yt.nodeType===8){if(yt.data==="teleport start anchor")e.targetStart=yt;else if(yt.data==="teleport anchor"){e.targetAnchor=yt,Q._lpa=e.targetAnchor&&T(e.targetAnchor);break}}yt=T(yt)}e.targetAnchor||nE(Q,e,$,z),q(Tt&&T(Tt),e,Q,a,h,p,x)}Ny(e,nt)}return e.anchor&&T(e.anchor)}const jk=sE;function Ny(i,e){const a=i.ctx;if(a&&a.ut){let h,p;for(e?(h=i.el,p=i.anchor):(h=i.targetStart,p=i.targetAnchor);h&&h!==p;)h.nodeType===1&&h.setAttribute("data-v-owner",a.uid),h=h.nextSibling;a.ut()}}function nE(i,e,a,h){const p=e.targetStart=a(""),x=e.targetAnchor=a("");return p[eE]=x,i&&(h(p,i),h(x,i)),x}const wu=Symbol("_leaveCb"),vy=Symbol("_enterCb");function Sb(){const i={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return ph(()=>{i.isMounted=!0}),n_(()=>{i.isUnmounting=!0}),i}const Oa=[Function,Array],Eb={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Oa,onEnter:Oa,onAfterEnter:Oa,onEnterCancelled:Oa,onBeforeLeave:Oa,onLeave:Oa,onAfterLeave:Oa,onLeaveCancelled:Oa,onBeforeAppear:Oa,onAppear:Oa,onAfterAppear:Oa,onAppearCancelled:Oa},rE=i=>{const e=i.subTree;return e.component?rE(e.component):e},Uk={name:"BaseTransition",props:Eb,setup(i,{slots:e}){const a=Wa(),h=Sb();return()=>{const p=e.default&&Lx(e.default(),!0);if(!p||!p.length)return;const x=oE(p),T=Cs(i),{mode:P}=T;if(h.isLeaving)return rv(x);const o=gw(x);if(!o)return rv(x);let z=Zp(o,T,h,a,q=>z=q);o.type!==dr&&uh(o,z);let $=a.subTree&&gw(a.subTree);if($&&$.type!==dr&&!yl(o,$)&&rE(a).type!==dr){let q=Zp($,T,h,a);if(uh($,q),P==="out-in"&&o.type!==dr)return h.isLeaving=!0,q.afterLeave=()=>{h.isLeaving=!1,a.job.flags&8||a.update(),delete q.afterLeave,$=void 0},rv(x);P==="in-out"&&o.type!==dr?q.delayLeave=(Q,nt,Tt)=>{const yt=lE(h,$);yt[String($.key)]=$,Q[wu]=()=>{nt(),Q[wu]=void 0,delete z.delayedLeave,$=void 0},z.delayedLeave=()=>{Tt(),delete z.delayedLeave,$=void 0}}:$=void 0}else $&&($=void 0);return x}}};function oE(i){let e=i[0];if(i.length>1){for(const a of i)if(a.type!==dr){e=a;break}}return e}const aE=Uk;function lE(i,e){const{leavingVNodes:a}=i;let h=a.get(e.type);return h||(h=Object.create(null),a.set(e.type,h)),h}function Zp(i,e,a,h,p){const{appear:x,mode:T,persisted:P=!1,onBeforeEnter:o,onEnter:z,onAfterEnter:$,onEnterCancelled:q,onBeforeLeave:Q,onLeave:nt,onAfterLeave:Tt,onLeaveCancelled:yt,onBeforeAppear:Lt,onAppear:Nt,onAfterAppear:Dt,onAppearCancelled:wt}=e,It=String(i.key),Xt=lE(a,i),Zt=(ne,Ut)=>{ne&&$a(ne,h,9,Ut)},re=(ne,Ut)=>{const Le=Ut[1];Zt(ne,Ut),Si(ne)?ne.every(ye=>ye.length<=1)&&Le():ne.length<=1&&Le()},kt={mode:T,persisted:P,beforeEnter(ne){let Ut=o;if(!a.isMounted)if(x)Ut=Lt||o;else return;ne[wu]&&ne[wu](!0);const Le=Xt[It];Le&&yl(i,Le)&&Le.el[wu]&&Le.el[wu](),Zt(Ut,[ne])},enter(ne){let Ut=z,Le=$,ye=q;if(!a.isMounted)if(x)Ut=Nt||z,Le=Dt||$,ye=wt||q;else return;let Ce=!1;const di=ne[vy]=Ti=>{Ce||(Ce=!0,Ti?Zt(ye,[ne]):Zt(Le,[ne]),kt.delayedLeave&&kt.delayedLeave(),ne[vy]=void 0)};Ut?re(Ut,[ne,di]):di()},leave(ne,Ut){const Le=String(i.key);if(ne[vy]&&ne[vy](!0),a.isUnmounting)return Ut();Zt(Q,[ne]);let ye=!1;const Ce=ne[wu]=di=>{ye||(ye=!0,Ut(),di?Zt(yt,[ne]):Zt(Tt,[ne]),ne[wu]=void 0,Xt[Le]===i&&delete Xt[Le])};Xt[Le]=i,nt?re(nt,[ne,Ce]):Ce()},clone(ne){const Ut=Zp(ne,e,a,h,p);return p&&p(Ut),Ut}};return kt}function rv(i){if(s_(i))return i=_c(i),i.children=null,i}function gw(i){if(!s_(i))return iE(i.type)&&i.children?oE(i.children):i;const{shapeFlag:e,children:a}=i;if(a){if(e&16)return a[0];if(e&32&&Wi(a.default))return a.default()}}function uh(i,e){i.shapeFlag&6&&i.component?(i.transition=e,uh(i.component.subTree,e)):i.shapeFlag&128?(i.ssContent.transition=e.clone(i.ssContent),i.ssFallback.transition=e.clone(i.ssFallback)):i.transition=e}function Lx(i,e=!1,a){let h=[],p=0;for(let x=0;x<i.length;x++){let T=i[x];const P=a==null?T.key:String(a)+String(T.key!=null?T.key:x);T.type===dn?(T.patchFlag&128&&p++,h=h.concat(Lx(T.children,e,P))):(e||T.type!==dr)&&h.push(P!=null?_c(T,{key:P}):T)}if(p>1)for(let x=0;x<h.length;x++)h[x].patchFlag=-2;return h}/*! #__NO_SIDE_EFFECTS__ */function bo(i,e){return Wi(i)?pn({name:i.name},e,{setup:i}):i}function Vk(){const i=Wa();return i?(i.appContext.config.idPrefix||"v")+"-"+i.ids[0]+i.ids[1]++:""}function Mb(i){i.ids=[i.ids[0]+i.ids[2]+++"-",0,0]}function $k(i){const e=Wa(),a=bb(null);if(e){const p=e.refs===ks?e.refs={}:e.refs;Object.defineProperty(p,i,{enumerable:!0,get:()=>a.value,set:x=>a.value=x})}return a}function Hg(i,e,a,h,p=!1){if(Si(i)){i.forEach((Tt,yt)=>Hg(Tt,e&&(Si(e)?e[yt]:e),a,h,p));return}if(Cu(h)&&!p){h.shapeFlag&512&&h.type.__asyncResolved&&h.component.subTree.component&&Hg(i,e,a,h.component.subTree);return}const x=h.shapeFlag&4?o_(h.component):h.el,T=p?null:x,{i:P,r:o}=i,z=e&&e.r,$=P.refs===ks?P.refs={}:P.refs,q=P.setupState,Q=Cs(q),nt=q===ks?()=>!1:Tt=>Xs(Q,Tt);if(z!=null&&z!==o&&(wn(z)?($[z]=null,nt(z)&&(q[z]=null)):Un(z)&&(z.value=null)),Wi(o))om(o,P,12,[T,$]);else{const Tt=wn(o),yt=Un(o);if(Tt||yt){const Lt=()=>{if(i.f){const Nt=Tt?nt(o)?q[o]:$[o]:o.value;p?Si(Nt)&&hb(Nt,x):Si(Nt)?Nt.includes(x)||Nt.push(x):Tt?($[o]=[x],nt(o)&&(q[o]=$[o])):(o.value=[x],i.k&&($[i.k]=o.value))}else Tt?($[o]=T,nt(o)&&(q[o]=T)):yt&&(o.value=T,i.k&&($[i.k]=T))};T?(Lt.id=-1,yr(Lt,a)):Lt()}}}let _w=!1;const Ip=()=>{_w||(console.error("Hydration completed but contains mismatches."),_w=!0)},Gk=i=>i.namespaceURI.includes("svg")&&i.tagName!=="foreignObject",Wk=i=>i.namespaceURI.includes("MathML"),by=i=>{if(i.nodeType===1){if(Gk(i))return"svg";if(Wk(i))return"mathml"}},Bp=i=>i.nodeType===8;function Hk(i){const{mt:e,p:a,o:{patchProp:h,createText:p,nextSibling:x,parentNode:T,remove:P,insert:o,createComment:z}}=i,$=(wt,It)=>{if(!It.hasChildNodes()){a(null,wt,It),Qy(),It._vnode=wt;return}q(It.firstChild,wt,null,null,null),Qy(),It._vnode=wt},q=(wt,It,Xt,Zt,re,kt=!1)=>{kt=kt||!!It.dynamicChildren;const ne=Bp(wt)&&wt.data==="[",Ut=()=>yt(wt,It,Xt,Zt,re,ne),{type:Le,ref:ye,shapeFlag:Ce,patchFlag:di}=It;let Ti=wt.nodeType;It.el=wt,di===-2&&(kt=!1,It.dynamicChildren=null);let Ge=null;switch(Le){case ku:Ti!==3?It.children===""?(o(It.el=p(""),T(wt),wt),Ge=wt):Ge=Ut():(wt.data!==It.children&&(Ip(),wt.data=It.children),Ge=x(wt));break;case dr:Dt(wt)?(Ge=x(wt),Nt(It.el=wt.content.firstChild,wt,Xt)):Ti!==8||ne?Ge=Ut():Ge=x(wt);break;case mf:if(ne&&(wt=x(wt),Ti=wt.nodeType),Ti===1||Ti===3){Ge=wt;const li=!It.children.length;for(let fi=0;fi<It.staticCount;fi++)li&&(It.children+=Ge.nodeType===1?Ge.outerHTML:Ge.data),fi===It.staticCount-1&&(It.anchor=Ge),Ge=x(Ge);return ne?x(Ge):Ge}else Ut();break;case dn:ne?Ge=Tt(wt,It,Xt,Zt,re,kt):Ge=Ut();break;default:if(Ce&1)(Ti!==1||It.type.toLowerCase()!==wt.tagName.toLowerCase())&&!Dt(wt)?Ge=Ut():Ge=Q(wt,It,Xt,Zt,re,kt);else if(Ce&6){It.slotScopeIds=re;const li=T(wt);if(ne?Ge=Lt(wt):Bp(wt)&&wt.data==="teleport start"?Ge=Lt(wt,wt.data,"teleport end"):Ge=x(wt),e(It,li,null,Xt,Zt,by(li),kt),Cu(It)&&!It.type.__asyncResolved){let fi;ne?(fi=fs(dn),fi.anchor=Ge?Ge.previousSibling:li.lastChild):fi=wt.nodeType===3?Na(""):fs("div"),fi.el=wt,It.component.subTree=fi}}else Ce&64?Ti!==8?Ge=Ut():Ge=It.type.hydrate(wt,It,Xt,Zt,re,kt,i,nt):Ce&128&&(Ge=It.type.hydrate(wt,It,Xt,Zt,by(T(wt)),re,kt,i,q))}return ye!=null&&Hg(ye,null,Zt,It),Ge},Q=(wt,It,Xt,Zt,re,kt)=>{kt=kt||!!It.dynamicChildren;const{type:ne,props:Ut,patchFlag:Le,shapeFlag:ye,dirs:Ce,transition:di}=It,Ti=ne==="input"||ne==="option";if(Ti||Le!==-1){Ce&&pc(It,null,Xt,"created");let Ge=!1;if(Dt(wt)){Ge=zE(null,di)&&Xt&&Xt.vnode.props&&Xt.vnode.props.appear;const fi=wt.content.firstChild;Ge&&di.beforeEnter(fi),Nt(fi,wt,Xt),It.el=wt=fi}if(ye&16&&!(Ut&&(Ut.innerHTML||Ut.textContent))){let fi=nt(wt.firstChild,It,wt,Xt,Zt,re,kt);for(;fi;){wy(wt,1)||Ip();const pi=fi;fi=fi.nextSibling,P(pi)}}else if(ye&8){let fi=It.children;fi[0]===`
`&&(wt.tagName==="PRE"||wt.tagName==="TEXTAREA")&&(fi=fi.slice(1)),wt.textContent!==fi&&(wy(wt,0)||Ip(),wt.textContent=It.children)}if(Ut){if(Ti||!kt||Le&48){const fi=wt.tagName.includes("-");for(const pi in Ut)(Ti&&(pi.endsWith("value")||pi==="indeterminate")||e_(pi)&&!Up(pi)||pi[0]==="."||fi)&&h(wt,pi,null,Ut[pi],void 0,Xt)}else if(Ut.onClick)h(wt,"onClick",null,Ut.onClick,void 0,Xt);else if(Le&4&&mc(Ut.style))for(const fi in Ut.style)Ut.style[fi]}let li;(li=Ut&&Ut.onVnodeBeforeMount)&&Vo(li,Xt,It),Ce&&pc(It,null,Xt,"beforeMount"),((li=Ut&&Ut.onVnodeMounted)||Ce||Ge)&&$E(()=>{li&&Vo(li,Xt,It),Ge&&di.enter(wt),Ce&&pc(It,null,Xt,"mounted")},Zt)}return wt.nextSibling},nt=(wt,It,Xt,Zt,re,kt,ne)=>{ne=ne||!!It.dynamicChildren;const Ut=It.children,Le=Ut.length;for(let ye=0;ye<Le;ye++){const Ce=ne?Ut[ye]:Ut[ye]=$o(Ut[ye]),di=Ce.type===ku;wt?(di&&!ne&&ye+1<Le&&$o(Ut[ye+1]).type===ku&&(o(p(wt.data.slice(Ce.children.length)),Xt,x(wt)),wt.data=Ce.children),wt=q(wt,Ce,Zt,re,kt,ne)):di&&!Ce.children?o(Ce.el=p(""),Xt):(wy(Xt,1)||Ip(),a(null,Ce,Xt,null,Zt,re,by(Xt),kt))}return wt},Tt=(wt,It,Xt,Zt,re,kt)=>{const{slotScopeIds:ne}=It;ne&&(re=re?re.concat(ne):ne);const Ut=T(wt),Le=nt(x(wt),It,Ut,Xt,Zt,re,kt);return Le&&Bp(Le)&&Le.data==="]"?x(It.anchor=Le):(Ip(),o(It.anchor=z("]"),Ut,Le),Le)},yt=(wt,It,Xt,Zt,re,kt)=>{if(wy(wt.parentElement,1)||Ip(),It.el=null,kt){const Le=Lt(wt);for(;;){const ye=x(wt);if(ye&&ye!==Le)P(ye);else break}}const ne=x(wt),Ut=T(wt);return P(wt),a(null,It,Ut,ne,Xt,Zt,by(Ut),re),Xt&&(Xt.vnode.el=It.el,Bx(Xt,It.el)),ne},Lt=(wt,It="[",Xt="]")=>{let Zt=0;for(;wt;)if(wt=x(wt),wt&&Bp(wt)&&(wt.data===It&&Zt++,wt.data===Xt)){if(Zt===0)return x(wt);Zt--}return wt},Nt=(wt,It,Xt)=>{const Zt=It.parentNode;Zt&&Zt.replaceChild(wt,It);let re=Xt;for(;re;)re.vnode.el===It&&(re.vnode.el=re.subTree.el=wt),re=re.parent},Dt=wt=>wt.nodeType===1&&wt.tagName==="TEMPLATE";return[$,q]}const yw="data-allow-mismatch",Xk={0:"text",1:"children",2:"class",3:"style",4:"attribute"};function wy(i,e){if(e===0||e===1)for(;i&&!i.hasAttribute(yw);)i=i.parentElement;const a=i&&i.getAttribute(yw);if(a==null)return!1;if(a==="")return!0;{const h=a.split(",");return e===0&&h.includes("children")?!0:a.split(",").includes(Xk[e])}}const qk=Tx().requestIdleCallback||(i=>setTimeout(i,1)),Zk=Tx().cancelIdleCallback||(i=>clearTimeout(i)),Yk=(i=1e4)=>e=>{const a=qk(e,{timeout:i});return()=>Zk(a)};function Kk(i){const{top:e,left:a,bottom:h,right:p}=i.getBoundingClientRect(),{innerHeight:x,innerWidth:T}=window;return(e>0&&e<x||h>0&&h<x)&&(a>0&&a<T||p>0&&p<T)}const Jk=i=>(e,a)=>{const h=new IntersectionObserver(p=>{for(const x of p)if(x.isIntersecting){h.disconnect(),e();break}},i);return a(p=>{if(p instanceof Element){if(Kk(p))return e(),h.disconnect(),!1;h.observe(p)}}),()=>h.disconnect()},Qk=i=>e=>{if(i){const a=matchMedia(i);if(a.matches)e();else return a.addEventListener("change",e,{once:!0}),()=>a.removeEventListener("change",e)}},tP=(i=[])=>(e,a)=>{wn(i)&&(i=[i]);let h=!1;const p=T=>{h||(h=!0,x(),e(),T.target.dispatchEvent(new T.constructor(T.type,T)))},x=()=>{a(T=>{for(const P of i)T.removeEventListener(P,p)})};return a(T=>{for(const P of i)T.addEventListener(P,p,{once:!0})}),x};function eP(i,e){if(Bp(i)&&i.data==="["){let a=1,h=i.nextSibling;for(;h;){if(h.nodeType===1){if(e(h)===!1)break}else if(Bp(h))if(h.data==="]"){if(--a===0)break}else h.data==="["&&a++;h=h.nextSibling}}else e(i)}const Cu=i=>!!i.type.__asyncLoader;/*! #__NO_SIDE_EFFECTS__ */function iP(i){Wi(i)&&(i={loader:i});const{loader:e,loadingComponent:a,errorComponent:h,delay:p=200,hydrate:x,timeout:T,suspensible:P=!0,onError:o}=i;let z=null,$,q=0;const Q=()=>(q++,z=null,nt()),nt=()=>{let Tt;return z||(Tt=z=e().catch(yt=>{if(yt=yt instanceof Error?yt:new Error(String(yt)),o)return new Promise((Lt,Nt)=>{o(yt,()=>Lt(Q()),()=>Nt(yt),q+1)});throw yt}).then(yt=>Tt!==z&&z?z:(yt&&(yt.__esModule||yt[Symbol.toStringTag]==="Module")&&(yt=yt.default),$=yt,yt)))};return bo({name:"AsyncComponentWrapper",__asyncLoader:nt,__asyncHydrate(Tt,yt,Lt){const Nt=x?()=>{const Dt=x(Lt,wt=>eP(Tt,wt));Dt&&(yt.bum||(yt.bum=[])).push(Dt)}:Lt;$?Nt():nt().then(()=>!yt.isUnmounted&&Nt())},get __asyncResolved(){return $},setup(){const Tt=xr;if(Mb(Tt),$)return()=>ov($,Tt);const yt=wt=>{z=null,Tf(wt,Tt,13,!h)};if(P&&Tt.suspense||Yp)return nt().then(wt=>()=>ov(wt,Tt)).catch(wt=>(yt(wt),()=>h?fs(h,{error:wt}):null));const Lt=Bs(!1),Nt=Bs(),Dt=Bs(!!p);return p&&setTimeout(()=>{Dt.value=!1},p),T!=null&&setTimeout(()=>{if(!Lt.value&&!Nt.value){const wt=new Error(`Async component timed out after ${T}ms.`);yt(wt),Nt.value=wt}},T),nt().then(()=>{Lt.value=!0,Tt.parent&&s_(Tt.parent.vnode)&&Tt.parent.update()}).catch(wt=>{yt(wt),Nt.value=wt}),()=>{if(Lt.value&&$)return ov($,Tt);if(Nt.value&&h)return fs(h,{error:Nt.value});if(a&&!Dt.value)return fs(a)}}})}function ov(i,e){const{ref:a,props:h,children:p,ce:x}=e.vnode,T=fs(i,h,p);return T.ref=a,T.ce=x,delete e.vnode.ce,T}const s_=i=>i.type.__isKeepAlive,sP={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(i,{slots:e}){const a=Wa(),h=a.ctx;if(!h.renderer)return()=>{const Dt=e.default&&e.default();return Dt&&Dt.length===1?Dt[0]:Dt};const p=new Map,x=new Set;let T=null;const P=a.suspense,{renderer:{p:o,m:z,um:$,o:{createElement:q}}}=h,Q=q("div");h.activate=(Dt,wt,It,Xt,Zt)=>{const re=Dt.component;z(Dt,wt,It,0,P),o(re.vnode,Dt,wt,It,re,P,Xt,Dt.slotScopeIds,Zt),yr(()=>{re.isDeactivated=!1,re.a&&Vp(re.a);const kt=Dt.props&&Dt.props.onVnodeMounted;kt&&Vo(kt,re.parent,Dt)},P)},h.deactivate=Dt=>{const wt=Dt.component;ix(wt.m),ix(wt.a),z(Dt,Q,null,1,P),yr(()=>{wt.da&&Vp(wt.da);const It=Dt.props&&Dt.props.onVnodeUnmounted;It&&Vo(It,wt.parent,Dt),wt.isDeactivated=!0},P)};function nt(Dt){av(Dt),$(Dt,a,P,!0)}function Tt(Dt){p.forEach((wt,It)=>{const Xt=Hv(wt.type);Xt&&!Dt(Xt)&&yt(It)})}function yt(Dt){const wt=p.get(Dt);wt&&(!T||!yl(wt,T))?nt(wt):T&&av(T),p.delete(Dt),x.delete(Dt)}ya(()=>[i.include,i.exclude],([Dt,wt])=>{Dt&&Tt(It=>xg(Dt,It)),wt&&Tt(It=>!xg(wt,It))},{flush:"post",deep:!0});let Lt=null;const Nt=()=>{Lt!=null&&(sx(a.subTree.type)?yr(()=>{p.set(Lt,Ty(a.subTree))},a.subTree.suspense):p.set(Lt,Ty(a.subTree)))};return ph(Nt),zx(Nt),n_(()=>{p.forEach(Dt=>{const{subTree:wt,suspense:It}=a,Xt=Ty(wt);if(Dt.type===Xt.type&&Dt.key===Xt.key){av(Xt);const Zt=Xt.component.da;Zt&&yr(Zt,It);return}nt(Dt)})}),()=>{if(Lt=null,!e.default)return T=null;const Dt=e.default(),wt=Dt[0];if(Dt.length>1)return T=null,Dt;if(!dh(wt)||!(wt.shapeFlag&4)&&!(wt.shapeFlag&128))return T=null,wt;let It=Ty(wt);if(It.type===dr)return T=null,It;const Xt=It.type,Zt=Hv(Cu(It)?It.type.__asyncResolved||{}:Xt),{include:re,exclude:kt,max:ne}=i;if(re&&(!Zt||!xg(re,Zt))||kt&&Zt&&xg(kt,Zt))return It.shapeFlag&=-257,T=It,wt;const Ut=It.key==null?Xt:It.key,Le=p.get(Ut);return It.el&&(It=_c(It),wt.shapeFlag&128&&(wt.ssContent=It)),Lt=Ut,Le?(It.el=Le.el,It.component=Le.component,It.transition&&uh(It,It.transition),It.shapeFlag|=512,x.delete(Ut),x.add(Ut)):(x.add(Ut),ne&&x.size>parseInt(ne,10)&&yt(x.values().next().value)),It.shapeFlag|=256,T=It,sx(wt.type)?wt:It}}},nP=sP;function xg(i,e){return Si(i)?i.some(a=>xg(a,e)):wn(i)?i.split(",").includes(e):DC(i)?(i.lastIndex=0,i.test(e)):!1}function cE(i,e){uE(i,"a",e)}function hE(i,e){uE(i,"da",e)}function uE(i,e,a=xr){const h=i.__wdc||(i.__wdc=()=>{let p=a;for(;p;){if(p.isDeactivated)return;p=p.parent}return i()});if(Dx(e,h,a),a){let p=a.parent;for(;p&&p.parent;)s_(p.parent.vnode)&&rP(h,e,a,p),p=p.parent}}function rP(i,e,a,h){const p=Dx(e,i,h,!0);Ox(()=>{hb(h[e],p)},a)}function av(i){i.shapeFlag&=-257,i.shapeFlag&=-513}function Ty(i){return i.shapeFlag&128?i.ssContent:i}function Dx(i,e,a=xr,h=!1){if(a){const p=a[i]||(a[i]=[]),x=e.__weh||(e.__weh=(...T)=>{Bu();const P=xf(a),o=$a(e,a,i,T);return P(),Fu(),o});return h?p.unshift(x):p.push(x),x}}const fh=i=>(e,a=xr)=>{(!Yp||i==="sp")&&Dx(i,(...h)=>e(...h),a)},dE=fh("bm"),ph=fh("m"),Ab=fh("bu"),zx=fh("u"),n_=fh("bum"),Ox=fh("um"),fE=fh("sp"),pE=fh("rtg"),mE=fh("rtc");function gE(i,e=xr){Dx("ec",i,e)}const Cb="components",oP="directives";function tx(i,e){return kb(Cb,i,!0,e)||i}const _E=Symbol.for("v-ndc");function aP(i){return wn(i)?kb(Cb,i,!1)||i:i||_E}function lP(i){return kb(oP,i)}function kb(i,e,a=!0,h=!1){const p=vr||xr;if(p){const x=p.type;if(i===Cb){const P=Hv(x,!1);if(P&&(P===e||P===zr(e)||P===i_(zr(e))))return x}const T=xw(p[i]||x[i],e)||xw(p.appContext[i],e);return!T&&h?x:T}}function xw(i,e){return i&&(i[e]||i[zr(e)]||i[i_(zr(e))])}function gc(i,e,a,h){let p;const x=a&&a[h],T=Si(i);if(T||wn(i)){const P=T&&mc(i);let o=!1;P&&(o=!_a(i),i=Mx(i)),p=new Array(i.length);for(let z=0,$=i.length;z<$;z++)p[z]=e(o?Kr(i[z]):i[z],z,void 0,x&&x[z])}else if(typeof i=="number"){p=new Array(i);for(let P=0;P<i;P++)p[P]=e(P+1,P,void 0,x&&x[P])}else if(on(i))if(i[Symbol.iterator])p=Array.from(i,(P,o)=>e(P,o,void 0,x&&x[o]));else{const P=Object.keys(i);p=new Array(P.length);for(let o=0,z=P.length;o<z;o++){const $=P[o];p[o]=e(i[$],$,o,x&&x[o])}}else p=[];return a&&(a[h]=p),p}function cP(i,e){for(let a=0;a<e.length;a++){const h=e[a];if(Si(h))for(let p=0;p<h.length;p++)i[h[p].name]=h[p].fn;else h&&(i[h.name]=h.key?(...p)=>{const x=h.fn(...p);return x&&(x.key=h.key),x}:h.fn)}return i}function hP(i,e,a={},h,p){if(vr.ce||vr.parent&&Cu(vr.parent)&&vr.parent.ce)return e!=="default"&&(a.name=e),qi(),yf(dn,null,[fs("slot",a,h&&h())],64);let x=i[e];x&&x._c&&(x._d=!1),qi();const T=x&&Pb(x(a)),P=a.key||T&&T.key,o=yf(dn,{key:(P&&!wl(P)?P:`_${e}`)+(!T&&h?"_fb":"")},T||(h?h():[]),T&&i._===1?64:-2);return!p&&o.scopeId&&(o.slotScopeIds=[o.scopeId+"-s"]),x&&x._c&&(x._d=!0),o}function Pb(i){return i.some(e=>dh(e)?!(e.type===dr||e.type===dn&&!Pb(e.children)):!0)?i:null}function uP(i,e){const a={};for(const h in i)a[e&&/[A-Z]/.test(h)?`on:${h}`:Sg(h)]=i[h];return a}const Ov=i=>i?YE(i)?o_(i):Ov(i.parent):null,kg=pn(Object.create(null),{$:i=>i,$el:i=>i.vnode.el,$data:i=>i.data,$props:i=>i.props,$attrs:i=>i.attrs,$slots:i=>i.slots,$refs:i=>i.refs,$parent:i=>Ov(i.parent),$root:i=>Ov(i.root),$host:i=>i.ce,$emit:i=>i.emit,$options:i=>Ib(i),$forceUpdate:i=>i.f||(i.f=()=>{Tb(i.update)}),$nextTick:i=>i.n||(i.n=Sf.bind(i.proxy)),$watch:i=>VP.bind(i)}),lv=(i,e)=>i!==ks&&!i.__isScriptSetup&&Xs(i,e),Rv={get({_:i},e){if(e==="__v_skip")return!0;const{ctx:a,setupState:h,data:p,props:x,accessCache:T,type:P,appContext:o}=i;let z;if(e[0]!=="$"){const nt=T[e];if(nt!==void 0)switch(nt){case 1:return h[e];case 2:return p[e];case 4:return a[e];case 3:return x[e]}else{if(lv(h,e))return T[e]=1,h[e];if(p!==ks&&Xs(p,e))return T[e]=2,p[e];if((z=i.propsOptions[0])&&Xs(z,e))return T[e]=3,x[e];if(a!==ks&&Xs(a,e))return T[e]=4,a[e];Bv&&(T[e]=0)}}const $=kg[e];let q,Q;if($)return e==="$attrs"&&Yr(i.attrs,"get",""),$(i);if((q=P.__cssModules)&&(q=q[e]))return q;if(a!==ks&&Xs(a,e))return T[e]=4,a[e];if(Q=o.config.globalProperties,Xs(Q,e))return Q[e]},set({_:i},e,a){const{data:h,setupState:p,ctx:x}=i;return lv(p,e)?(p[e]=a,!0):h!==ks&&Xs(h,e)?(h[e]=a,!0):Xs(i.props,e)||e[0]==="$"&&e.slice(1)in i?!1:(x[e]=a,!0)},has({_:{data:i,setupState:e,accessCache:a,ctx:h,appContext:p,propsOptions:x}},T){let P;return!!a[T]||i!==ks&&Xs(i,T)||lv(e,T)||(P=x[0])&&Xs(P,T)||Xs(h,T)||Xs(kg,T)||Xs(p.config.globalProperties,T)},defineProperty(i,e,a){return a.get!=null?i._.accessCache[e]=0:Xs(a,"value")&&this.set(i,e,a.value,null),Reflect.defineProperty(i,e,a)}},dP=pn({},Rv,{get(i,e){if(e!==Symbol.unscopables)return Rv.get(i,e,i)},has(i,e){return e[0]!=="_"&&!FC(e)}});function fP(){return null}function pP(){return null}function mP(i){}function gP(i){}function _P(){return null}function yP(){}function xP(i,e){return null}function vP(){return yE().slots}function bP(){return yE().attrs}function yE(){const i=Wa();return i.setupContext||(i.setupContext=QE(i))}function Xg(i){return Si(i)?i.reduce((e,a)=>(e[a]=null,e),{}):i}function wP(i,e){const a=Xg(i);for(const h in e){if(h.startsWith("__skip"))continue;let p=a[h];p?Si(p)||Wi(p)?p=a[h]={type:p,default:e[h]}:p.default=e[h]:p===null&&(p=a[h]={default:e[h]}),p&&e[`__skip_${h}`]&&(p.skipFactory=!0)}return a}function TP(i,e){return!i||!e?i||e:Si(i)&&Si(e)?i.concat(e):pn({},Xg(i),Xg(e))}function SP(i,e){const a={};for(const h in i)e.includes(h)||Object.defineProperty(a,h,{enumerable:!0,get:()=>i[h]});return a}function EP(i){const e=Wa();let a=i();return $v(),ub(a)&&(a=a.catch(h=>{throw xf(e),h})),[a,()=>xf(e)]}let Bv=!0;function MP(i){const e=Ib(i),a=i.proxy,h=i.ctx;Bv=!1,e.beforeCreate&&vw(e.beforeCreate,i,"bc");const{data:p,computed:x,methods:T,watch:P,provide:o,inject:z,created:$,beforeMount:q,mounted:Q,beforeUpdate:nt,updated:Tt,activated:yt,deactivated:Lt,beforeDestroy:Nt,beforeUnmount:Dt,destroyed:wt,unmounted:It,render:Xt,renderTracked:Zt,renderTriggered:re,errorCaptured:kt,serverPrefetch:ne,expose:Ut,inheritAttrs:Le,components:ye,directives:Ce,filters:di}=e;if(z&&AP(z,h,null),T)for(const li in T){const fi=T[li];Wi(fi)&&(h[li]=fi.bind(a))}if(p){const li=p.call(a,a);on(li)&&(i.data=rm(li))}if(Bv=!0,x)for(const li in x){const fi=x[li],pi=Wi(fi)?fi.bind(a,a):Wi(fi.get)?fi.get.bind(a,a):ja,Ns=!Wi(fi)&&Wi(fi.set)?fi.set.bind(a):ja,hs=Jr({get:pi,set:Ns});Object.defineProperty(h,li,{enumerable:!0,configurable:!0,get:()=>hs.value,set:Yi=>hs.value=Yi})}if(P)for(const li in P)xE(P[li],h,a,li);if(o){const li=Wi(o)?o.call(a):o;Reflect.ownKeys(li).forEach(fi=>{Pg(fi,li[fi])})}$&&vw($,i,"c");function Ge(li,fi){Si(fi)?fi.forEach(pi=>li(pi.bind(a))):fi&&li(fi.bind(a))}if(Ge(dE,q),Ge(ph,Q),Ge(Ab,nt),Ge(zx,Tt),Ge(cE,yt),Ge(hE,Lt),Ge(gE,kt),Ge(mE,Zt),Ge(pE,re),Ge(n_,Dt),Ge(Ox,It),Ge(fE,ne),Si(Ut))if(Ut.length){const li=i.exposed||(i.exposed={});Ut.forEach(fi=>{Object.defineProperty(li,fi,{get:()=>a[fi],set:pi=>a[fi]=pi})})}else i.exposed||(i.exposed={});Xt&&i.render===ja&&(i.render=Xt),Le!=null&&(i.inheritAttrs=Le),ye&&(i.components=ye),Ce&&(i.directives=Ce),ne&&Mb(i)}function AP(i,e,a=ja){Si(i)&&(i=Fv(i));for(const h in i){const p=i[h];let x;on(p)?"default"in p?x=Ua(p.from||h,p.default,!0):x=Ua(p.from||h):x=Ua(p),Un(x)?Object.defineProperty(e,h,{enumerable:!0,configurable:!0,get:()=>x.value,set:T=>x.value=T}):e[h]=x}}function vw(i,e,a){$a(Si(i)?i.map(h=>h.bind(e.proxy)):i.bind(e.proxy),e,a)}function xE(i,e,a,h){let p=h.includes(".")?NE(a,h):()=>a[h];if(wn(i)){const x=e[i];Wi(x)&&ya(p,x)}else if(Wi(i))ya(p,i.bind(a));else if(on(i))if(Si(i))i.forEach(x=>xE(x,e,a,h));else{const x=Wi(i.handler)?i.handler.bind(a):e[i.handler];Wi(x)&&ya(p,x,i)}}function Ib(i){const e=i.type,{mixins:a,extends:h}=e,{mixins:p,optionsCache:x,config:{optionMergeStrategies:T}}=i.appContext,P=x.get(e);let o;return P?o=P:!p.length&&!a&&!h?o=e:(o={},p.length&&p.forEach(z=>ex(o,z,T,!0)),ex(o,e,T)),on(e)&&x.set(e,o),o}function ex(i,e,a,h=!1){const{mixins:p,extends:x}=e;x&&ex(i,x,a,!0),p&&p.forEach(T=>ex(i,T,a,!0));for(const T in e)if(!(h&&T==="expose")){const P=CP[T]||a&&a[T];i[T]=P?P(i[T],e[T]):e[T]}return i}const CP={data:bw,props:ww,emits:ww,methods:vg,computed:vg,beforeCreate:_o,created:_o,beforeMount:_o,mounted:_o,beforeUpdate:_o,updated:_o,beforeDestroy:_o,beforeUnmount:_o,destroyed:_o,unmounted:_o,activated:_o,deactivated:_o,errorCaptured:_o,serverPrefetch:_o,components:vg,directives:vg,watch:PP,provide:bw,inject:kP};function bw(i,e){return e?i?function(){return pn(Wi(i)?i.call(this,this):i,Wi(e)?e.call(this,this):e)}:e:i}function kP(i,e){return vg(Fv(i),Fv(e))}function Fv(i){if(Si(i)){const e={};for(let a=0;a<i.length;a++)e[i[a]]=i[a];return e}return i}function _o(i,e){return i?[...new Set([].concat(i,e))]:e}function vg(i,e){return i?pn(Object.create(null),i,e):e}function ww(i,e){return i?Si(i)&&Si(e)?[...new Set([...i,...e])]:pn(Object.create(null),Xg(i),Xg(e??{})):e}function PP(i,e){if(!i)return e;if(!e)return i;const a=pn(Object.create(null),i);for(const h in e)a[h]=_o(i[h],e[h]);return a}function vE(){return{app:null,config:{isNativeTag:IC,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let IP=0;function LP(i,e){return function(h,p=null){Wi(h)||(h=pn({},h)),p!=null&&!on(p)&&(p=null);const x=vE(),T=new WeakSet,P=[];let o=!1;const z=x.app={_uid:IP++,_component:h,_props:p,_container:null,_context:x,_instance:null,version:eM,get config(){return x.config},set config($){},use($,...q){return T.has($)||($&&Wi($.install)?(T.add($),$.install(z,...q)):Wi($)&&(T.add($),$(z,...q))),z},mixin($){return x.mixins.includes($)||x.mixins.push($),z},component($,q){return q?(x.components[$]=q,z):x.components[$]},directive($,q){return q?(x.directives[$]=q,z):x.directives[$]},mount($,q,Q){if(!o){const nt=z._ceVNode||fs(h,p);return nt.appContext=x,Q===!0?Q="svg":Q===!1&&(Q=void 0),q&&e?e(nt,$):i(nt,$,Q),o=!0,z._container=$,$.__vue_app__=z,o_(nt.component)}},onUnmount($){P.push($)},unmount(){o&&($a(P,z._instance,16),i(null,z._container),delete z._container.__vue_app__)},provide($,q){return x.provides[$]=q,z},runWithContext($){const q=pf;pf=z;try{return $()}finally{pf=q}}};return z}}let pf=null;function Pg(i,e){if(xr){let a=xr.provides;const h=xr.parent&&xr.parent.provides;h===a&&(a=xr.provides=Object.create(h)),a[i]=e}}function Ua(i,e,a=!1){const h=xr||vr;if(h||pf){const p=pf?pf._context.provides:h?h.parent==null?h.vnode.appContext&&h.vnode.appContext.provides:h.parent.provides:void 0;if(p&&i in p)return p[i];if(arguments.length>1)return a&&Wi(e)?e.call(h&&h.proxy):e}}function bE(){return!!(xr||vr||pf)}const wE={},TE=()=>Object.create(wE),SE=i=>Object.getPrototypeOf(i)===wE;function DP(i,e,a,h=!1){const p={},x=TE();i.propsDefaults=Object.create(null),EE(i,e,p,x);for(const T in i.propsOptions[0])T in p||(p[T]=void 0);a?i.props=h?p:xb(p):i.type.props?i.props=p:i.props=x,i.attrs=x}function zP(i,e,a,h){const{props:p,attrs:x,vnode:{patchFlag:T}}=i,P=Cs(p),[o]=i.propsOptions;let z=!1;if((h||T>0)&&!(T&16)){if(T&8){const $=i.vnode.dynamicProps;for(let q=0;q<$.length;q++){let Q=$[q];if(Rx(i.emitsOptions,Q))continue;const nt=e[Q];if(o)if(Xs(x,Q))nt!==x[Q]&&(x[Q]=nt,z=!0);else{const Tt=zr(Q);p[Tt]=Nv(o,P,Tt,nt,i,!1)}else nt!==x[Q]&&(x[Q]=nt,z=!0)}}}else{EE(i,e,p,x)&&(z=!0);let $;for(const q in P)(!e||!Xs(e,q)&&(($=Go(q))===q||!Xs(e,$)))&&(o?a&&(a[q]!==void 0||a[$]!==void 0)&&(p[q]=Nv(o,P,q,void 0,i,!0)):delete p[q]);if(x!==P)for(const q in x)(!e||!Xs(e,q))&&(delete x[q],z=!0)}z&&ah(i.attrs,"set","")}function EE(i,e,a,h){const[p,x]=i.propsOptions;let T=!1,P;if(e)for(let o in e){if(Up(o))continue;const z=e[o];let $;p&&Xs(p,$=zr(o))?!x||!x.includes($)?a[$]=z:(P||(P={}))[$]=z:Rx(i.emitsOptions,o)||(!(o in h)||z!==h[o])&&(h[o]=z,T=!0)}if(x){const o=Cs(a),z=P||ks;for(let $=0;$<x.length;$++){const q=x[$];a[q]=Nv(p,o,q,z[q],i,!Xs(z,q))}}return T}function Nv(i,e,a,h,p,x){const T=i[a];if(T!=null){const P=Xs(T,"default");if(P&&h===void 0){const o=T.default;if(T.type!==Function&&!T.skipFactory&&Wi(o)){const{propsDefaults:z}=p;if(a in z)h=z[a];else{const $=xf(p);h=z[a]=o.call(null,e),$()}}else h=o;p.ce&&p.ce._setProp(a,h)}T[0]&&(x&&!P?h=!1:T[1]&&(h===""||h===Go(a))&&(h=!0))}return h}const OP=new WeakMap;function ME(i,e,a=!1){const h=a?OP:e.propsCache,p=h.get(i);if(p)return p;const x=i.props,T={},P=[];let o=!1;if(!Wi(i)){const $=q=>{o=!0;const[Q,nt]=ME(q,e,!0);pn(T,Q),nt&&P.push(...nt)};!a&&e.mixins.length&&e.mixins.forEach($),i.extends&&$(i.extends),i.mixins&&i.mixins.forEach($)}if(!x&&!o)return on(i)&&h.set(i,Np),Np;if(Si(x))for(let $=0;$<x.length;$++){const q=zr(x[$]);Tw(q)&&(T[q]=ks)}else if(x)for(const $ in x){const q=zr($);if(Tw(q)){const Q=x[$],nt=T[q]=Si(Q)||Wi(Q)?{type:Q}:pn({},Q),Tt=nt.type;let yt=!1,Lt=!0;if(Si(Tt))for(let Nt=0;Nt<Tt.length;++Nt){const Dt=Tt[Nt],wt=Wi(Dt)&&Dt.name;if(wt==="Boolean"){yt=!0;break}else wt==="String"&&(Lt=!1)}else yt=Wi(Tt)&&Tt.name==="Boolean";nt[0]=yt,nt[1]=Lt,(yt||Xs(nt,"default"))&&P.push(q)}}const z=[T,P];return on(i)&&h.set(i,z),z}function Tw(i){return i[0]!=="$"&&!Up(i)}const AE=i=>i[0]==="_"||i==="$stable",Lb=i=>Si(i)?i.map($o):[$o(i)],RP=(i,e,a)=>{if(e._n)return e;const h=Fa((...p)=>Lb(e(...p)),a);return h._c=!1,h},CE=(i,e,a)=>{const h=i._ctx;for(const p in i){if(AE(p))continue;const x=i[p];if(Wi(x))e[p]=RP(p,x,h);else if(x!=null){const T=Lb(x);e[p]=()=>T}}},kE=(i,e)=>{const a=Lb(e);i.slots.default=()=>a},PE=(i,e,a)=>{for(const h in e)(a||h!=="_")&&(i[h]=e[h])},BP=(i,e,a)=>{const h=i.slots=TE();if(i.vnode.shapeFlag&32){const p=e._;p?(PE(h,e,a),a&&ES(h,"_",p,!0)):CE(e,h)}else e&&kE(i,e)},FP=(i,e,a)=>{const{vnode:h,slots:p}=i;let x=!0,T=ks;if(h.shapeFlag&32){const P=e._;P?a&&P===1?x=!1:PE(p,e,a):(x=!e.$stable,CE(e,p)),T=e}else e&&(kE(i,e),T={default:1});if(x)for(const P in p)!AE(P)&&T[P]==null&&delete p[P]},yr=$E;function IE(i){return DE(i)}function LE(i){return DE(i,Hk)}function DE(i,e){const a=Tx();a.__VUE__=!0;const{insert:h,remove:p,patchProp:x,createElement:T,createText:P,createComment:o,setText:z,setElementText:$,parentNode:q,nextSibling:Q,setScopeId:nt=ja,insertStaticContent:Tt}=i,yt=(_t,zt,fe,Se=null,be=null,Ue=null,ei=void 0,We=null,Xe=!!zt.dynamicChildren)=>{if(_t===zt)return;_t&&!yl(_t,zt)&&(Se=Me(_t),Yi(_t,be,Ue,!0),_t=null),zt.patchFlag===-2&&(Xe=!1,zt.dynamicChildren=null);const{type:Ve,ref:Ci,shapeFlag:ti}=zt;switch(Ve){case ku:Lt(_t,zt,fe,Se);break;case dr:Nt(_t,zt,fe,Se);break;case mf:_t==null&&Dt(zt,fe,Se,ei);break;case dn:ye(_t,zt,fe,Se,be,Ue,ei,We,Xe);break;default:ti&1?Xt(_t,zt,fe,Se,be,Ue,ei,We,Xe):ti&6?Ce(_t,zt,fe,Se,be,Ue,ei,We,Xe):(ti&64||ti&128)&&Ve.process(_t,zt,fe,Se,be,Ue,ei,We,Xe,_i)}Ci!=null&&be&&Hg(Ci,_t&&_t.ref,Ue,zt||_t,!zt)},Lt=(_t,zt,fe,Se)=>{if(_t==null)h(zt.el=P(zt.children),fe,Se);else{const be=zt.el=_t.el;zt.children!==_t.children&&z(be,zt.children)}},Nt=(_t,zt,fe,Se)=>{_t==null?h(zt.el=o(zt.children||""),fe,Se):zt.el=_t.el},Dt=(_t,zt,fe,Se)=>{[_t.el,_t.anchor]=Tt(_t.children,zt,fe,Se,_t.el,_t.anchor)},wt=({el:_t,anchor:zt},fe,Se)=>{let be;for(;_t&&_t!==zt;)be=Q(_t),h(_t,fe,Se),_t=be;h(zt,fe,Se)},It=({el:_t,anchor:zt})=>{let fe;for(;_t&&_t!==zt;)fe=Q(_t),p(_t),_t=fe;p(zt)},Xt=(_t,zt,fe,Se,be,Ue,ei,We,Xe)=>{zt.type==="svg"?ei="svg":zt.type==="math"&&(ei="mathml"),_t==null?Zt(zt,fe,Se,be,Ue,ei,We,Xe):ne(_t,zt,be,Ue,ei,We,Xe)},Zt=(_t,zt,fe,Se,be,Ue,ei,We)=>{let Xe,Ve;const{props:Ci,shapeFlag:ti,transition:wi,dirs:Pi}=_t;if(Xe=_t.el=T(_t.type,Ue,Ci&&Ci.is,Ci),ti&8?$(Xe,_t.children):ti&16&&kt(_t.children,Xe,null,Se,be,cv(_t,Ue),ei,We),Pi&&pc(_t,null,Se,"created"),re(Xe,_t,_t.scopeId,ei,Se),Ci){for(const es in Ci)es!=="value"&&!Up(es)&&x(Xe,es,null,Ci[es],Ue,Se);"value"in Ci&&x(Xe,"value",null,Ci.value,Ue),(Ve=Ci.onVnodeBeforeMount)&&Vo(Ve,Se,_t)}Pi&&pc(_t,null,Se,"beforeMount");const ts=zE(be,wi);ts&&wi.beforeEnter(Xe),h(Xe,zt,fe),((Ve=Ci&&Ci.onVnodeMounted)||ts||Pi)&&yr(()=>{Ve&&Vo(Ve,Se,_t),ts&&wi.enter(Xe),Pi&&pc(_t,null,Se,"mounted")},be)},re=(_t,zt,fe,Se,be)=>{if(fe&&nt(_t,fe),Se)for(let Ue=0;Ue<Se.length;Ue++)nt(_t,Se[Ue]);if(be){let Ue=be.subTree;if(zt===Ue||sx(Ue.type)&&(Ue.ssContent===zt||Ue.ssFallback===zt)){const ei=be.vnode;re(_t,ei,ei.scopeId,ei.slotScopeIds,be.parent)}}},kt=(_t,zt,fe,Se,be,Ue,ei,We,Xe=0)=>{for(let Ve=Xe;Ve<_t.length;Ve++){const Ci=_t[Ve]=We?Tu(_t[Ve]):$o(_t[Ve]);yt(null,Ci,zt,fe,Se,be,Ue,ei,We)}},ne=(_t,zt,fe,Se,be,Ue,ei)=>{const We=zt.el=_t.el;let{patchFlag:Xe,dynamicChildren:Ve,dirs:Ci}=zt;Xe|=_t.patchFlag&16;const ti=_t.props||ks,wi=zt.props||ks;let Pi;if(fe&&rf(fe,!1),(Pi=wi.onVnodeBeforeUpdate)&&Vo(Pi,fe,zt,_t),Ci&&pc(zt,_t,fe,"beforeUpdate"),fe&&rf(fe,!0),(ti.innerHTML&&wi.innerHTML==null||ti.textContent&&wi.textContent==null)&&$(We,""),Ve?Ut(_t.dynamicChildren,Ve,We,fe,Se,cv(zt,be),Ue):ei||fi(_t,zt,We,null,fe,Se,cv(zt,be),Ue,!1),Xe>0){if(Xe&16)Le(We,ti,wi,fe,be);else if(Xe&2&&ti.class!==wi.class&&x(We,"class",null,wi.class,be),Xe&4&&x(We,"style",ti.style,wi.style,be),Xe&8){const ts=zt.dynamicProps;for(let es=0;es<ts.length;es++){const ns=ts[es],zn=ti[ns],tn=wi[ns];(tn!==zn||ns==="value")&&x(We,ns,zn,tn,be,fe)}}Xe&1&&_t.children!==zt.children&&$(We,zt.children)}else!ei&&Ve==null&&Le(We,ti,wi,fe,be);((Pi=wi.onVnodeUpdated)||Ci)&&yr(()=>{Pi&&Vo(Pi,fe,zt,_t),Ci&&pc(zt,_t,fe,"updated")},Se)},Ut=(_t,zt,fe,Se,be,Ue,ei)=>{for(let We=0;We<zt.length;We++){const Xe=_t[We],Ve=zt[We],Ci=Xe.el&&(Xe.type===dn||!yl(Xe,Ve)||Xe.shapeFlag&70)?q(Xe.el):fe;yt(Xe,Ve,Ci,null,Se,be,Ue,ei,!0)}},Le=(_t,zt,fe,Se,be)=>{if(zt!==fe){if(zt!==ks)for(const Ue in zt)!Up(Ue)&&!(Ue in fe)&&x(_t,Ue,zt[Ue],null,be,Se);for(const Ue in fe){if(Up(Ue))continue;const ei=fe[Ue],We=zt[Ue];ei!==We&&Ue!=="value"&&x(_t,Ue,We,ei,be,Se)}"value"in fe&&x(_t,"value",zt.value,fe.value,be)}},ye=(_t,zt,fe,Se,be,Ue,ei,We,Xe)=>{const Ve=zt.el=_t?_t.el:P(""),Ci=zt.anchor=_t?_t.anchor:P("");let{patchFlag:ti,dynamicChildren:wi,slotScopeIds:Pi}=zt;Pi&&(We=We?We.concat(Pi):Pi),_t==null?(h(Ve,fe,Se),h(Ci,fe,Se),kt(zt.children||[],fe,Ci,be,Ue,ei,We,Xe)):ti>0&&ti&64&&wi&&_t.dynamicChildren?(Ut(_t.dynamicChildren,wi,fe,be,Ue,ei,We),(zt.key!=null||be&&zt===be.subTree)&&Db(_t,zt,!0)):fi(_t,zt,fe,Ci,be,Ue,ei,We,Xe)},Ce=(_t,zt,fe,Se,be,Ue,ei,We,Xe)=>{zt.slotScopeIds=We,_t==null?zt.shapeFlag&512?be.ctx.activate(zt,fe,Se,ei,Xe):di(zt,fe,Se,be,Ue,ei,Xe):Ti(_t,zt,Xe)},di=(_t,zt,fe,Se,be,Ue,ei)=>{const We=_t.component=ZE(_t,Se,be);if(s_(_t)&&(We.ctx.renderer=_i),KE(We,!1,ei),We.asyncDep){if(be&&be.registerDep(We,Ge,ei),!_t.el){const Xe=We.subTree=fs(dr);Nt(null,Xe,zt,fe)}}else Ge(We,_t,zt,fe,be,Ue,ei)},Ti=(_t,zt,fe)=>{const Se=zt.component=_t.component;if(qP(_t,zt,fe))if(Se.asyncDep&&!Se.asyncResolved){li(Se,zt,fe);return}else Se.next=zt,Se.update();else zt.el=_t.el,Se.vnode=zt},Ge=(_t,zt,fe,Se,be,Ue,ei)=>{const We=()=>{if(_t.isMounted){let{next:ti,bu:wi,u:Pi,parent:ts,vnode:es}=_t;{const is=OE(_t);if(is){ti&&(ti.el=es.el,li(_t,ti,ei)),is.asyncDep.then(()=>{_t.isUnmounted||We()});return}}let ns=ti,zn;rf(_t,!1),ti?(ti.el=es.el,li(_t,ti,ei)):ti=es,wi&&Vp(wi),(zn=ti.props&&ti.props.onVnodeBeforeUpdate)&&Vo(zn,ts,ti,es),rf(_t,!0);const tn=jy(_t),Vn=_t.subTree;_t.subTree=tn,yt(Vn,tn,q(Vn.el),Me(Vn),_t,be,Ue),ti.el=tn.el,ns===null&&Bx(_t,tn.el),Pi&&yr(Pi,be),(zn=ti.props&&ti.props.onVnodeUpdated)&&yr(()=>Vo(zn,ts,ti,es),be)}else{let ti;const{el:wi,props:Pi}=zt,{bm:ts,m:es,parent:ns,root:zn,type:tn}=_t,Vn=Cu(zt);if(rf(_t,!1),ts&&Vp(ts),!Vn&&(ti=Pi&&Pi.onVnodeBeforeMount)&&Vo(ti,ns,zt),rf(_t,!0),wi&&xi){const is=()=>{_t.subTree=jy(_t),xi(wi,_t.subTree,_t,be,null)};Vn&&tn.__asyncHydrate?tn.__asyncHydrate(wi,_t,is):is()}else{zn.ce&&zn.ce._injectChildStyle(tn);const is=_t.subTree=jy(_t);yt(null,is,fe,Se,_t,be,Ue),zt.el=is.el}if(es&&yr(es,be),!Vn&&(ti=Pi&&Pi.onVnodeMounted)){const is=zt;yr(()=>Vo(ti,ns,is),be)}(zt.shapeFlag&256||ns&&Cu(ns.vnode)&&ns.vnode.shapeFlag&256)&&_t.a&&yr(_t.a,be),_t.isMounted=!0,zt=fe=Se=null}};_t.scope.on();const Xe=_t.effect=new jg(We);_t.scope.off();const Ve=_t.update=Xe.run.bind(Xe),Ci=_t.job=Xe.runIfDirty.bind(Xe);Ci.i=_t,Ci.id=_t.uid,Xe.scheduler=()=>Tb(Ci),rf(_t,!0),Ve()},li=(_t,zt,fe)=>{zt.component=_t;const Se=_t.vnode.props;_t.vnode=zt,_t.next=null,zP(_t,zt.props,Se,fe),FP(_t,zt.children,fe),Bu(),dw(_t),Fu()},fi=(_t,zt,fe,Se,be,Ue,ei,We,Xe=!1)=>{const Ve=_t&&_t.children,Ci=_t?_t.shapeFlag:0,ti=zt.children,{patchFlag:wi,shapeFlag:Pi}=zt;if(wi>0){if(wi&128){Ns(Ve,ti,fe,Se,be,Ue,ei,We,Xe);return}else if(wi&256){pi(Ve,ti,fe,Se,be,Ue,ei,We,Xe);return}}Pi&8?(Ci&16&&Ds(Ve,be,Ue),ti!==Ve&&$(fe,ti)):Ci&16?Pi&16?Ns(Ve,ti,fe,Se,be,Ue,ei,We,Xe):Ds(Ve,be,Ue,!0):(Ci&8&&$(fe,""),Pi&16&&kt(ti,fe,Se,be,Ue,ei,We,Xe))},pi=(_t,zt,fe,Se,be,Ue,ei,We,Xe)=>{_t=_t||Np,zt=zt||Np;const Ve=_t.length,Ci=zt.length,ti=Math.min(Ve,Ci);let wi;for(wi=0;wi<ti;wi++){const Pi=zt[wi]=Xe?Tu(zt[wi]):$o(zt[wi]);yt(_t[wi],Pi,fe,null,be,Ue,ei,We,Xe)}Ve>Ci?Ds(_t,be,Ue,!0,!1,ti):kt(zt,fe,Se,be,Ue,ei,We,Xe,ti)},Ns=(_t,zt,fe,Se,be,Ue,ei,We,Xe)=>{let Ve=0;const Ci=zt.length;let ti=_t.length-1,wi=Ci-1;for(;Ve<=ti&&Ve<=wi;){const Pi=_t[Ve],ts=zt[Ve]=Xe?Tu(zt[Ve]):$o(zt[Ve]);if(yl(Pi,ts))yt(Pi,ts,fe,null,be,Ue,ei,We,Xe);else break;Ve++}for(;Ve<=ti&&Ve<=wi;){const Pi=_t[ti],ts=zt[wi]=Xe?Tu(zt[wi]):$o(zt[wi]);if(yl(Pi,ts))yt(Pi,ts,fe,null,be,Ue,ei,We,Xe);else break;ti--,wi--}if(Ve>ti){if(Ve<=wi){const Pi=wi+1,ts=Pi<Ci?zt[Pi].el:Se;for(;Ve<=wi;)yt(null,zt[Ve]=Xe?Tu(zt[Ve]):$o(zt[Ve]),fe,ts,be,Ue,ei,We,Xe),Ve++}}else if(Ve>wi)for(;Ve<=ti;)Yi(_t[Ve],be,Ue,!0),Ve++;else{const Pi=Ve,ts=Ve,es=new Map;for(Ve=ts;Ve<=wi;Ve++){const Sn=zt[Ve]=Xe?Tu(zt[Ve]):$o(zt[Ve]);Sn.key!=null&&es.set(Sn.key,Ve)}let ns,zn=0;const tn=wi-ts+1;let Vn=!1,is=0;const fr=new Array(tn);for(Ve=0;Ve<tn;Ve++)fr[Ve]=0;for(Ve=Pi;Ve<=ti;Ve++){const Sn=_t[Ve];if(zn>=tn){Yi(Sn,be,Ue,!0);continue}let $n;if(Sn.key!=null)$n=es.get(Sn.key);else for(ns=ts;ns<=wi;ns++)if(fr[ns-ts]===0&&yl(Sn,zt[ns])){$n=ns;break}$n===void 0?Yi(Sn,be,Ue,!0):(fr[$n-ts]=Ve+1,$n>=is?is=$n:Vn=!0,yt(Sn,zt[$n],fe,null,be,Ue,ei,We,Xe),zn++)}const to=Vn?NP(fr):Np;for(ns=to.length-1,Ve=tn-1;Ve>=0;Ve--){const Sn=ts+Ve,$n=zt[Sn],Yn=Sn+1<Ci?zt[Sn+1].el:Se;fr[Ve]===0?yt(null,$n,fe,Yn,be,Ue,ei,We,Xe):Vn&&(ns<0||Ve!==to[ns]?hs($n,fe,Yn,2):ns--)}}},hs=(_t,zt,fe,Se,be=null)=>{const{el:Ue,type:ei,transition:We,children:Xe,shapeFlag:Ve}=_t;if(Ve&6){hs(_t.component.subTree,zt,fe,Se);return}if(Ve&128){_t.suspense.move(zt,fe,Se);return}if(Ve&64){ei.move(_t,zt,fe,_i);return}if(ei===dn){h(Ue,zt,fe);for(let ti=0;ti<Xe.length;ti++)hs(Xe[ti],zt,fe,Se);h(_t.anchor,zt,fe);return}if(ei===mf){wt(_t,zt,fe);return}if(Se!==2&&Ve&1&&We)if(Se===0)We.beforeEnter(Ue),h(Ue,zt,fe),yr(()=>We.enter(Ue),be);else{const{leave:ti,delayLeave:wi,afterLeave:Pi}=We,ts=()=>h(Ue,zt,fe),es=()=>{ti(Ue,()=>{ts(),Pi&&Pi()})};wi?wi(Ue,ts,es):es()}else h(Ue,zt,fe)},Yi=(_t,zt,fe,Se=!1,be=!1)=>{const{type:Ue,props:ei,ref:We,children:Xe,dynamicChildren:Ve,shapeFlag:Ci,patchFlag:ti,dirs:wi,cacheIndex:Pi}=_t;if(ti===-2&&(be=!1),We!=null&&Hg(We,null,fe,_t,!0),Pi!=null&&(zt.renderCache[Pi]=void 0),Ci&256){zt.ctx.deactivate(_t);return}const ts=Ci&1&&wi,es=!Cu(_t);let ns;if(es&&(ns=ei&&ei.onVnodeBeforeUnmount)&&Vo(ns,zt,_t),Ci&6)Tn(_t.component,fe,Se);else{if(Ci&128){_t.suspense.unmount(fe,Se);return}ts&&pc(_t,null,zt,"beforeUnmount"),Ci&64?_t.type.remove(_t,zt,fe,_i,Se):Ve&&!Ve.hasOnce&&(Ue!==dn||ti>0&&ti&64)?Ds(Ve,zt,fe,!1,!0):(Ue===dn&&ti&384||!be&&Ci&16)&&Ds(Xe,zt,fe),Se&&Zs(_t)}(es&&(ns=ei&&ei.onVnodeUnmounted)||ts)&&yr(()=>{ns&&Vo(ns,zt,_t),ts&&pc(_t,null,zt,"unmounted")},fe)},Zs=_t=>{const{type:zt,el:fe,anchor:Se,transition:be}=_t;if(zt===dn){Ji(fe,Se);return}if(zt===mf){It(_t);return}const Ue=()=>{p(fe),be&&!be.persisted&&be.afterLeave&&be.afterLeave()};if(_t.shapeFlag&1&&be&&!be.persisted){const{leave:ei,delayLeave:We}=be,Xe=()=>ei(fe,Ue);We?We(_t.el,Ue,Xe):Xe()}else Ue()},Ji=(_t,zt)=>{let fe;for(;_t!==zt;)fe=Q(_t),p(_t),_t=fe;p(zt)},Tn=(_t,zt,fe)=>{const{bum:Se,scope:be,job:Ue,subTree:ei,um:We,m:Xe,a:Ve}=_t;ix(Xe),ix(Ve),Se&&Vp(Se),be.stop(),Ue&&(Ue.flags|=8,Yi(ei,_t,zt,fe)),We&&yr(We,zt),yr(()=>{_t.isUnmounted=!0},zt),zt&&zt.pendingBranch&&!zt.isUnmounted&&_t.asyncDep&&!_t.asyncResolved&&_t.suspenseId===zt.pendingId&&(zt.deps--,zt.deps===0&&zt.resolve())},Ds=(_t,zt,fe,Se=!1,be=!1,Ue=0)=>{for(let ei=Ue;ei<_t.length;ei++)Yi(_t[ei],zt,fe,Se,be)},Me=_t=>{if(_t.shapeFlag&6)return Me(_t.component.subTree);if(_t.shapeFlag&128)return _t.suspense.next();const zt=Q(_t.anchor||_t.el),fe=zt&&zt[eE];return fe?Q(fe):zt};let ci=!1;const ni=(_t,zt,fe)=>{_t==null?zt._vnode&&Yi(zt._vnode,null,null,!0):yt(zt._vnode||null,_t,zt,null,null,null,fe),zt._vnode=_t,ci||(ci=!0,dw(),Qy(),ci=!1)},_i={p:yt,um:Yi,m:hs,r:Zs,mt:di,mc:kt,pc:fi,pbc:Ut,n:Me,o:i};let ss,xi;return e&&([ss,xi]=e(_i)),{render:ni,hydrate:ss,createApp:LP(ni,ss)}}function cv({type:i,props:e},a){return a==="svg"&&i==="foreignObject"||a==="mathml"&&i==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:a}function rf({effect:i,job:e},a){a?(i.flags|=32,e.flags|=4):(i.flags&=-33,e.flags&=-5)}function zE(i,e){return(!i||i&&!i.pendingBranch)&&e&&!e.persisted}function Db(i,e,a=!1){const h=i.children,p=e.children;if(Si(h)&&Si(p))for(let x=0;x<h.length;x++){const T=h[x];let P=p[x];P.shapeFlag&1&&!P.dynamicChildren&&((P.patchFlag<=0||P.patchFlag===32)&&(P=p[x]=Tu(p[x]),P.el=T.el),!a&&P.patchFlag!==-2&&Db(T,P)),P.type===ku&&(P.el=T.el)}}function NP(i){const e=i.slice(),a=[0];let h,p,x,T,P;const o=i.length;for(h=0;h<o;h++){const z=i[h];if(z!==0){if(p=a[a.length-1],i[p]<z){e[h]=p,a.push(h);continue}for(x=0,T=a.length-1;x<T;)P=x+T>>1,i[a[P]]<z?x=P+1:T=P;z<i[a[x]]&&(x>0&&(e[h]=a[x-1]),a[x]=h)}}for(x=a.length,T=a[x-1];x-- >0;)a[x]=T,T=e[T];return a}function OE(i){const e=i.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:OE(e)}function ix(i){if(i)for(let e=0;e<i.length;e++)i[e].flags|=8}const RE=Symbol.for("v-scx"),BE=()=>Ua(RE);function jP(i,e){return r_(i,null,e)}function UP(i,e){return r_(i,null,{flush:"post"})}function FE(i,e){return r_(i,null,{flush:"sync"})}function ya(i,e,a){return r_(i,e,a)}function r_(i,e,a=ks){const{immediate:h,deep:p,flush:x,once:T}=a,P=pn({},a),o=e&&h||!e&&x!=="post";let z;if(Yp){if(x==="sync"){const nt=BE();z=nt.__watcherHandles||(nt.__watcherHandles=[])}else if(!o){const nt=()=>{};return nt.stop=ja,nt.resume=ja,nt.pause=ja,nt}}const $=xr;P.call=(nt,Tt,yt)=>$a(nt,$,Tt,yt);let q=!1;x==="post"?P.scheduler=nt=>{yr(nt,$&&$.suspense)}:x!=="sync"&&(q=!0,P.scheduler=(nt,Tt)=>{Tt?nt():Tb(nt)}),P.augmentJob=nt=>{e&&(nt.flags|=4),q&&(nt.flags|=2,$&&(nt.id=$.uid,nt.i=$))};const Q=Ck(i,e,P);return Yp&&(z?z.push(Q):o&&Q()),Q}function VP(i,e,a){const h=this.proxy,p=wn(i)?i.includes(".")?NE(h,i):()=>h[i]:i.bind(h,h);let x;Wi(e)?x=e:(x=e.handler,a=e);const T=xf(this),P=r_(p,x.bind(h),a);return T(),P}function NE(i,e){const a=e.split(".");return()=>{let h=i;for(let p=0;p<a.length&&h;p++)h=h[a[p]];return h}}function $P(i,e,a=ks){const h=Wa(),p=zr(e),x=Go(e),T=jE(i,p),P=HS((o,z)=>{let $,q=ks,Q;return FE(()=>{const nt=i[p];xo($,nt)&&($=nt,z())}),{get(){return o(),a.get?a.get($):$},set(nt){const Tt=a.set?a.set(nt):nt;if(!xo(Tt,$)&&!(q!==ks&&xo(nt,q)))return;const yt=h.vnode.props;yt&&(e in yt||p in yt||x in yt)&&(`onUpdate:${e}`in yt||`onUpdate:${p}`in yt||`onUpdate:${x}`in yt)||($=nt,z()),h.emit(`update:${e}`,Tt),xo(nt,Tt)&&xo(nt,q)&&!xo(Tt,Q)&&z(),q=nt,Q=Tt}}});return P[Symbol.iterator]=()=>{let o=0;return{next(){return o<2?{value:o++?T||ks:P,done:!1}:{done:!0}}}},P}const jE=(i,e)=>e==="modelValue"||e==="model-value"?i.modelModifiers:i[`${e}Modifiers`]||i[`${zr(e)}Modifiers`]||i[`${Go(e)}Modifiers`];function GP(i,e,...a){if(i.isUnmounted)return;const h=i.vnode.props||ks;let p=a;const x=e.startsWith("update:"),T=x&&jE(h,e.slice(7));T&&(T.trim&&(p=a.map($=>wn($)?$.trim():$)),T.number&&(p=a.map(qy)));let P,o=h[P=Sg(e)]||h[P=Sg(zr(e))];!o&&x&&(o=h[P=Sg(Go(e))]),o&&$a(o,i,6,p);const z=h[P+"Once"];if(z){if(!i.emitted)i.emitted={};else if(i.emitted[P])return;i.emitted[P]=!0,$a(z,i,6,p)}}function UE(i,e,a=!1){const h=e.emitsCache,p=h.get(i);if(p!==void 0)return p;const x=i.emits;let T={},P=!1;if(!Wi(i)){const o=z=>{const $=UE(z,e,!0);$&&(P=!0,pn(T,$))};!a&&e.mixins.length&&e.mixins.forEach(o),i.extends&&o(i.extends),i.mixins&&i.mixins.forEach(o)}return!x&&!P?(on(i)&&h.set(i,null),null):(Si(x)?x.forEach(o=>T[o]=null):pn(T,x),on(i)&&h.set(i,T),T)}function Rx(i,e){return!i||!e_(e)?!1:(e=e.slice(2).replace(/Once$/,""),Xs(i,e[0].toLowerCase()+e.slice(1))||Xs(i,Go(e))||Xs(i,e))}function jy(i){const{type:e,vnode:a,proxy:h,withProxy:p,propsOptions:[x],slots:T,attrs:P,emit:o,render:z,renderCache:$,props:q,data:Q,setupState:nt,ctx:Tt,inheritAttrs:yt}=i,Lt=Wg(i);let Nt,Dt;try{if(a.shapeFlag&4){const It=p||h,Xt=It;Nt=$o(z.call(Xt,It,$,q,nt,Q,Tt)),Dt=P}else{const It=e;Nt=$o(It.length>1?It(q,{attrs:P,slots:T,emit:o}):It(q,null)),Dt=e.props?P:HP(P)}}catch(It){Ig.length=0,Tf(It,i,1),Nt=fs(dr)}let wt=Nt;if(Dt&&yt!==!1){const It=Object.keys(Dt),{shapeFlag:Xt}=wt;It.length&&Xt&7&&(x&&It.some(cb)&&(Dt=XP(Dt,x)),wt=_c(wt,Dt,!1,!0))}return a.dirs&&(wt=_c(wt,null,!1,!0),wt.dirs=wt.dirs?wt.dirs.concat(a.dirs):a.dirs),a.transition&&uh(wt,a.transition),Nt=wt,Wg(Lt),Nt}function WP(i,e=!0){let a;for(let h=0;h<i.length;h++){const p=i[h];if(dh(p)){if(p.type!==dr||p.children==="v-if"){if(a)return;a=p}}else return}return a}const HP=i=>{let e;for(const a in i)(a==="class"||a==="style"||e_(a))&&((e||(e={}))[a]=i[a]);return e},XP=(i,e)=>{const a={};for(const h in i)(!cb(h)||!(h.slice(9)in e))&&(a[h]=i[h]);return a};function qP(i,e,a){const{props:h,children:p,component:x}=i,{props:T,children:P,patchFlag:o}=e,z=x.emitsOptions;if(e.dirs||e.transition)return!0;if(a&&o>=0){if(o&1024)return!0;if(o&16)return h?Sw(h,T,z):!!T;if(o&8){const $=e.dynamicProps;for(let q=0;q<$.length;q++){const Q=$[q];if(T[Q]!==h[Q]&&!Rx(z,Q))return!0}}}else return(p||P)&&(!P||!P.$stable)?!0:h===T?!1:h?T?Sw(h,T,z):!0:!!T;return!1}function Sw(i,e,a){const h=Object.keys(e);if(h.length!==Object.keys(i).length)return!0;for(let p=0;p<h.length;p++){const x=h[p];if(e[x]!==i[x]&&!Rx(a,x))return!0}return!1}function Bx({vnode:i,parent:e},a){for(;e;){const h=e.subTree;if(h.suspense&&h.suspense.activeBranch===i&&(h.el=i.el),h===i)(i=e.vnode).el=a,e=e.parent;else break}}const sx=i=>i.__isSuspense;let jv=0;const ZP={name:"Suspense",__isSuspense:!0,process(i,e,a,h,p,x,T,P,o,z){if(i==null)KP(e,a,h,p,x,T,P,o,z);else{if(x&&x.deps>0&&!i.suspense.isInFallback){e.suspense=i.suspense,e.suspense.vnode=e,e.el=i.el;return}JP(i,e,a,h,p,T,P,o,z)}},hydrate:QP,normalize:tI},YP=ZP;function qg(i,e){const a=i.props&&i.props[e];Wi(a)&&a()}function KP(i,e,a,h,p,x,T,P,o){const{p:z,o:{createElement:$}}=o,q=$("div"),Q=i.suspense=VE(i,p,h,e,q,a,x,T,P,o);z(null,Q.pendingBranch=i.ssContent,q,null,h,Q,x,T),Q.deps>0?(qg(i,"onPending"),qg(i,"onFallback"),z(null,i.ssFallback,e,a,h,null,x,T),Gp(Q,i.ssFallback)):Q.resolve(!1,!0)}function JP(i,e,a,h,p,x,T,P,{p:o,um:z,o:{createElement:$}}){const q=e.suspense=i.suspense;q.vnode=e,e.el=i.el;const Q=e.ssContent,nt=e.ssFallback,{activeBranch:Tt,pendingBranch:yt,isInFallback:Lt,isHydrating:Nt}=q;if(yt)q.pendingBranch=Q,yl(Q,yt)?(o(yt,Q,q.hiddenContainer,null,p,q,x,T,P),q.deps<=0?q.resolve():Lt&&(Nt||(o(Tt,nt,a,h,p,null,x,T,P),Gp(q,nt)))):(q.pendingId=jv++,Nt?(q.isHydrating=!1,q.activeBranch=yt):z(yt,p,q),q.deps=0,q.effects.length=0,q.hiddenContainer=$("div"),Lt?(o(null,Q,q.hiddenContainer,null,p,q,x,T,P),q.deps<=0?q.resolve():(o(Tt,nt,a,h,p,null,x,T,P),Gp(q,nt))):Tt&&yl(Q,Tt)?(o(Tt,Q,a,h,p,q,x,T,P),q.resolve(!0)):(o(null,Q,q.hiddenContainer,null,p,q,x,T,P),q.deps<=0&&q.resolve()));else if(Tt&&yl(Q,Tt))o(Tt,Q,a,h,p,q,x,T,P),Gp(q,Q);else if(qg(e,"onPending"),q.pendingBranch=Q,Q.shapeFlag&512?q.pendingId=Q.component.suspenseId:q.pendingId=jv++,o(null,Q,q.hiddenContainer,null,p,q,x,T,P),q.deps<=0)q.resolve();else{const{timeout:Dt,pendingId:wt}=q;Dt>0?setTimeout(()=>{q.pendingId===wt&&q.fallback(nt)},Dt):Dt===0&&q.fallback(nt)}}function VE(i,e,a,h,p,x,T,P,o,z,$=!1){const{p:q,m:Q,um:nt,n:Tt,o:{parentNode:yt,remove:Lt}}=z;let Nt;const Dt=eI(i);Dt&&e&&e.pendingBranch&&(Nt=e.pendingId,e.deps++);const wt=i.props?Zy(i.props.timeout):void 0,It=x,Xt={vnode:i,parent:e,parentComponent:a,namespace:T,container:h,hiddenContainer:p,deps:0,pendingId:jv++,timeout:typeof wt=="number"?wt:-1,activeBranch:null,pendingBranch:null,isInFallback:!$,isHydrating:$,isUnmounted:!1,effects:[],resolve(Zt=!1,re=!1){const{vnode:kt,activeBranch:ne,pendingBranch:Ut,pendingId:Le,effects:ye,parentComponent:Ce,container:di}=Xt;let Ti=!1;Xt.isHydrating?Xt.isHydrating=!1:Zt||(Ti=ne&&Ut.transition&&Ut.transition.mode==="out-in",Ti&&(ne.transition.afterLeave=()=>{Le===Xt.pendingId&&(Q(Ut,di,x===It?Tt(ne):x,0),$g(ye))}),ne&&(yt(ne.el)===di&&(x=Tt(ne)),nt(ne,Ce,Xt,!0)),Ti||Q(Ut,di,x,0)),Gp(Xt,Ut),Xt.pendingBranch=null,Xt.isInFallback=!1;let Ge=Xt.parent,li=!1;for(;Ge;){if(Ge.pendingBranch){Ge.effects.push(...ye),li=!0;break}Ge=Ge.parent}!li&&!Ti&&$g(ye),Xt.effects=[],Dt&&e&&e.pendingBranch&&Nt===e.pendingId&&(e.deps--,e.deps===0&&!re&&e.resolve()),qg(kt,"onResolve")},fallback(Zt){if(!Xt.pendingBranch)return;const{vnode:re,activeBranch:kt,parentComponent:ne,container:Ut,namespace:Le}=Xt;qg(re,"onFallback");const ye=Tt(kt),Ce=()=>{Xt.isInFallback&&(q(null,Zt,Ut,ye,ne,null,Le,P,o),Gp(Xt,Zt))},di=Zt.transition&&Zt.transition.mode==="out-in";di&&(kt.transition.afterLeave=Ce),Xt.isInFallback=!0,nt(kt,ne,null,!0),di||Ce()},move(Zt,re,kt){Xt.activeBranch&&Q(Xt.activeBranch,Zt,re,kt),Xt.container=Zt},next(){return Xt.activeBranch&&Tt(Xt.activeBranch)},registerDep(Zt,re,kt){const ne=!!Xt.pendingBranch;ne&&Xt.deps++;const Ut=Zt.vnode.el;Zt.asyncDep.catch(Le=>{Tf(Le,Zt,0)}).then(Le=>{if(Zt.isUnmounted||Xt.isUnmounted||Xt.pendingId!==Zt.suspenseId)return;Zt.asyncResolved=!0;const{vnode:ye}=Zt;Gv(Zt,Le,!1),Ut&&(ye.el=Ut);const Ce=!Ut&&Zt.subTree.el;re(Zt,ye,yt(Ut||Zt.subTree.el),Ut?null:Tt(Zt.subTree),Xt,T,kt),Ce&&Lt(Ce),Bx(Zt,ye.el),ne&&--Xt.deps===0&&Xt.resolve()})},unmount(Zt,re){Xt.isUnmounted=!0,Xt.activeBranch&&nt(Xt.activeBranch,a,Zt,re),Xt.pendingBranch&&nt(Xt.pendingBranch,a,Zt,re)}};return Xt}function QP(i,e,a,h,p,x,T,P,o){const z=e.suspense=VE(e,h,a,i.parentNode,document.createElement("div"),null,p,x,T,P,!0),$=o(i,z.pendingBranch=e.ssContent,a,z,x,T);return z.deps===0&&z.resolve(!1,!0),$}function tI(i){const{shapeFlag:e,children:a}=i,h=e&32;i.ssContent=Ew(h?a.default:a),i.ssFallback=h?Ew(a.fallback):fs(dr)}function Ew(i){let e;if(Wi(i)){const a=_f&&i._c;a&&(i._d=!1,qi()),i=i(),a&&(i._d=!0,e=Qr,GE())}return Si(i)&&(i=WP(i)),i=$o(i),e&&!i.dynamicChildren&&(i.dynamicChildren=e.filter(a=>a!==i)),i}function $E(i,e){e&&e.pendingBranch?Si(i)?e.effects.push(...i):e.effects.push(i):$g(i)}function Gp(i,e){i.activeBranch=e;const{vnode:a,parentComponent:h}=i;let p=e.el;for(;!p&&e.component;)e=e.component.subTree,p=e.el;a.el=p,h&&h.subTree===a&&(h.vnode.el=p,Bx(h,p))}function eI(i){const e=i.props&&i.props.suspensible;return e!=null&&e!==!1}const dn=Symbol.for("v-fgt"),ku=Symbol.for("v-txt"),dr=Symbol.for("v-cmt"),mf=Symbol.for("v-stc"),Ig=[];let Qr=null;function qi(i=!1){Ig.push(Qr=i?null:[])}function GE(){Ig.pop(),Qr=Ig[Ig.length-1]||null}let _f=1;function Uv(i,e=!1){_f+=i,i<0&&Qr&&e&&(Qr.hasOnce=!0)}function WE(i){return i.dynamicChildren=_f>0?Qr||Np:null,GE(),_f>0&&Qr&&Qr.push(i),i}function cs(i,e,a,h,p,x){return WE(Ye(i,e,a,h,p,x,!0))}function yf(i,e,a,h,p){return WE(fs(i,e,a,h,p,!0))}function dh(i){return i?i.__v_isVNode===!0:!1}function yl(i,e){return i.type===e.type&&i.key===e.key}function iI(i){}const HE=({key:i})=>i??null,Uy=({ref:i,ref_key:e,ref_for:a})=>(typeof i=="number"&&(i=""+i),i!=null?wn(i)||Un(i)||Wi(i)?{i:vr,r:i,k:e,f:!!a}:i:null);function Ye(i,e=null,a=null,h=0,p=null,x=i===dn?0:1,T=!1,P=!1){const o={__v_isVNode:!0,__v_skip:!0,type:i,props:e,key:e&&HE(e),ref:e&&Uy(e),scopeId:Ix,slotScopeIds:null,children:a,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:x,patchFlag:h,dynamicProps:p,dynamicChildren:null,appContext:null,ctx:vr};return P?(zb(o,a),x&128&&i.normalize(o)):a&&(o.shapeFlag|=wn(a)?8:16),_f>0&&!T&&Qr&&(o.patchFlag>0||x&6)&&o.patchFlag!==32&&Qr.push(o),o}const fs=sI;function sI(i,e=null,a=null,h=0,p=null,x=!1){if((!i||i===_E)&&(i=dr),dh(i)){const P=_c(i,e,!0);return a&&zb(P,a),_f>0&&!x&&Qr&&(P.shapeFlag&6?Qr[Qr.indexOf(i)]=P:Qr.push(P)),P.patchFlag=-2,P}if(hI(i)&&(i=i.__vccOpts),e){e=XE(e);let{class:P,style:o}=e;P&&!wn(P)&&(e.class=nm(P)),on(o)&&(kx(o)&&!Si(o)&&(o=pn({},o)),e.style=wf(o))}const T=wn(i)?1:sx(i)?128:iE(i)?64:on(i)?4:Wi(i)?2:0;return Ye(i,e,a,h,p,T,x,!0)}function XE(i){return i?kx(i)||SE(i)?pn({},i):i:null}function _c(i,e,a=!1,h=!1){const{props:p,ref:x,patchFlag:T,children:P,transition:o}=i,z=e?qE(p||{},e):p,$={__v_isVNode:!0,__v_skip:!0,type:i.type,props:z,key:z&&HE(z),ref:e&&e.ref?a&&x?Si(x)?x.concat(Uy(e)):[x,Uy(e)]:Uy(e):x,scopeId:i.scopeId,slotScopeIds:i.slotScopeIds,children:P,target:i.target,targetStart:i.targetStart,targetAnchor:i.targetAnchor,staticCount:i.staticCount,shapeFlag:i.shapeFlag,patchFlag:e&&i.type!==dn?T===-1?16:T|16:T,dynamicProps:i.dynamicProps,dynamicChildren:i.dynamicChildren,appContext:i.appContext,dirs:i.dirs,transition:o,component:i.component,suspense:i.suspense,ssContent:i.ssContent&&_c(i.ssContent),ssFallback:i.ssFallback&&_c(i.ssFallback),el:i.el,anchor:i.anchor,ctx:i.ctx,ce:i.ce};return o&&h&&uh($,o.clone($)),$}function Na(i=" ",e=0){return fs(ku,null,i,e)}function Fx(i,e){const a=fs(mf,null,i);return a.staticCount=e,a}function Ba(i="",e=!1){return e?(qi(),yf(dr,null,i)):fs(dr,null,i)}function $o(i){return i==null||typeof i=="boolean"?fs(dr):Si(i)?fs(dn,null,i.slice()):dh(i)?Tu(i):fs(ku,null,String(i))}function Tu(i){return i.el===null&&i.patchFlag!==-1||i.memo?i:_c(i)}function zb(i,e){let a=0;const{shapeFlag:h}=i;if(e==null)e=null;else if(Si(e))a=16;else if(typeof e=="object")if(h&65){const p=e.default;p&&(p._c&&(p._d=!1),zb(i,p()),p._c&&(p._d=!0));return}else{a=32;const p=e._;!p&&!SE(e)?e._ctx=vr:p===3&&vr&&(vr.slots._===1?e._=1:(e._=2,i.patchFlag|=1024))}else Wi(e)?(e={default:e,_ctx:vr},a=32):(e=String(e),h&64?(a=16,e=[Na(e)]):a=8);i.children=e,i.shapeFlag|=a}function qE(...i){const e={};for(let a=0;a<i.length;a++){const h=i[a];for(const p in h)if(p==="class")e.class!==h.class&&(e.class=nm([e.class,h.class]));else if(p==="style")e.style=wf([e.style,h.style]);else if(e_(p)){const x=e[p],T=h[p];T&&x!==T&&!(Si(x)&&x.includes(T))&&(e[p]=x?[].concat(x,T):T)}else p!==""&&(e[p]=h[p])}return e}function Vo(i,e,a,h=null){$a(i,e,7,[a,h])}const nI=vE();let rI=0;function ZE(i,e,a){const h=i.type,p=(e?e.appContext:i.appContext)||nI,x={uid:rI++,vnode:i,type:h,parent:e,appContext:p,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new fb(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(p.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:ME(h,p),emitsOptions:UE(h,p),emit:null,emitted:null,propsDefaults:ks,inheritAttrs:h.inheritAttrs,ctx:ks,data:ks,props:ks,attrs:ks,slots:ks,refs:ks,setupState:ks,setupContext:null,suspense:a,suspenseId:a?a.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return x.ctx={_:x},x.root=e?e.root:x,x.emit=GP.bind(null,x),i.ce&&i.ce(x),x}let xr=null;const Wa=()=>xr||vr;let nx,Vv;{const i=Tx(),e=(a,h)=>{let p;return(p=i[a])||(p=i[a]=[]),p.push(h),x=>{p.length>1?p.forEach(T=>T(x)):p[0](x)}};nx=e("__VUE_INSTANCE_SETTERS__",a=>xr=a),Vv=e("__VUE_SSR_SETTERS__",a=>Yp=a)}const xf=i=>{const e=xr;return nx(i),i.scope.on(),()=>{i.scope.off(),nx(e)}},$v=()=>{xr&&xr.scope.off(),nx(null)};function YE(i){return i.vnode.shapeFlag&4}let Yp=!1;function KE(i,e=!1,a=!1){e&&Vv(e);const{props:h,children:p}=i.vnode,x=YE(i);DP(i,h,x,e),BP(i,p,a);const T=x?oI(i,e):void 0;return e&&Vv(!1),T}function oI(i,e){const a=i.type;i.accessCache=Object.create(null),i.proxy=new Proxy(i.ctx,Rv);const{setup:h}=a;if(h){Bu();const p=i.setupContext=h.length>1?QE(i):null,x=xf(i),T=om(h,i,0,[i.props,p]),P=ub(T);if(Fu(),x(),(P||i.sp)&&!Cu(i)&&Mb(i),P){if(T.then($v,$v),e)return T.then(o=>{Gv(i,o,e)}).catch(o=>{Tf(o,i,0)});i.asyncDep=T}else Gv(i,T,e)}else JE(i,e)}function Gv(i,e,a){Wi(e)?i.type.__ssrInlineRender?i.ssrRender=e:i.render=e:on(e)&&(i.setupState=wb(e)),JE(i,a)}let rx,Wv;function aI(i){rx=i,Wv=e=>{e.render._rc&&(e.withProxy=new Proxy(e.ctx,dP))}}const lI=()=>!rx;function JE(i,e,a){const h=i.type;if(!i.render){if(!e&&rx&&!h.render){const p=h.template||Ib(i).template;if(p){const{isCustomElement:x,compilerOptions:T}=i.appContext.config,{delimiters:P,compilerOptions:o}=h,z=pn(pn({isCustomElement:x,delimiters:P},T),o);h.render=rx(p,z)}}i.render=h.render||ja,Wv&&Wv(i)}{const p=xf(i);Bu();try{MP(i)}finally{Fu(),p()}}}const cI={get(i,e){return Yr(i,"get",""),i[e]}};function QE(i){const e=a=>{i.exposed=a||{}};return{attrs:new Proxy(i.attrs,cI),slots:i.slots,emit:i.emit,expose:e}}function o_(i){return i.exposed?i.exposeProxy||(i.exposeProxy=new Proxy(wb(Px(i.exposed)),{get(e,a){if(a in e)return e[a];if(a in kg)return kg[a](i)},has(e,a){return a in e||a in kg}})):i.proxy}function Hv(i,e=!0){return Wi(i)?i.displayName||i.name:i.name||e&&i.__name}function hI(i){return Wi(i)&&"__vccOpts"in i}const Jr=(i,e)=>Sk(i,e,Yp);function Nx(i,e,a){const h=arguments.length;return h===2?on(e)&&!Si(e)?dh(e)?fs(i,null,[e]):fs(i,e):fs(i,null,e):(h>3?a=Array.prototype.slice.call(arguments,2):h===3&&dh(a)&&(a=[a]),fs(i,e,a))}function uI(){}function dI(i,e,a,h){const p=a[h];if(p&&tM(p,i))return p;const x=e();return x.memo=i.slice(),x.cacheIndex=h,a[h]=x}function tM(i,e){const a=i.memo;if(a.length!=e.length)return!1;for(let h=0;h<a.length;h++)if(xo(a[h],e[h]))return!1;return _f>0&&Qr&&Qr.push(i),!0}const eM="3.5.13",fI=ja,pI=Dk,mI=Op,gI=tE,_I={createComponentInstance:ZE,setupComponent:KE,renderComponentRoot:jy,setCurrentRenderingInstance:Wg,isVNode:dh,normalizeVNode:$o,getComponentPublicInstance:o_,ensureValidVNode:Pb,pushWarningContext:kk,popWarningContext:Pk},yI=_I,xI=null,vI=null,bI=null;/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Xv;const Mw=typeof window<"u"&&window.trustedTypes;if(Mw)try{Xv=Mw.createPolicy("vue",{createHTML:i=>i})}catch{}const iM=Xv?i=>Xv.createHTML(i):i=>i,wI="http://www.w3.org/2000/svg",TI="http://www.w3.org/1998/Math/MathML",nh=typeof document<"u"?document:null,Aw=nh&&nh.createElement("template"),SI={insert:(i,e,a)=>{e.insertBefore(i,a||null)},remove:i=>{const e=i.parentNode;e&&e.removeChild(i)},createElement:(i,e,a,h)=>{const p=e==="svg"?nh.createElementNS(wI,i):e==="mathml"?nh.createElementNS(TI,i):a?nh.createElement(i,{is:a}):nh.createElement(i);return i==="select"&&h&&h.multiple!=null&&p.setAttribute("multiple",h.multiple),p},createText:i=>nh.createTextNode(i),createComment:i=>nh.createComment(i),setText:(i,e)=>{i.nodeValue=e},setElementText:(i,e)=>{i.textContent=e},parentNode:i=>i.parentNode,nextSibling:i=>i.nextSibling,querySelector:i=>nh.querySelector(i),setScopeId(i,e){i.setAttribute(e,"")},insertStaticContent(i,e,a,h,p,x){const T=a?a.previousSibling:e.lastChild;if(p&&(p===x||p.nextSibling))for(;e.insertBefore(p.cloneNode(!0),a),!(p===x||!(p=p.nextSibling)););else{Aw.innerHTML=iM(h==="svg"?`<svg>${i}</svg>`:h==="mathml"?`<math>${i}</math>`:i);const P=Aw.content;if(h==="svg"||h==="mathml"){const o=P.firstChild;for(;o.firstChild;)P.appendChild(o.firstChild);P.removeChild(o)}e.insertBefore(P,a)}return[T?T.nextSibling:e.firstChild,a?a.previousSibling:e.lastChild]}},gu="transition",ug="animation",Kp=Symbol("_vtc"),sM={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},nM=pn({},Eb,sM),EI=i=>(i.displayName="Transition",i.props=nM,i),Ob=EI((i,{slots:e})=>Nx(aE,rM(i),e)),of=(i,e=[])=>{Si(i)?i.forEach(a=>a(...e)):i&&i(...e)},Cw=i=>i?Si(i)?i.some(e=>e.length>1):i.length>1:!1;function rM(i){const e={};for(const ye in i)ye in sM||(e[ye]=i[ye]);if(i.css===!1)return e;const{name:a="v",type:h,duration:p,enterFromClass:x=`${a}-enter-from`,enterActiveClass:T=`${a}-enter-active`,enterToClass:P=`${a}-enter-to`,appearFromClass:o=x,appearActiveClass:z=T,appearToClass:$=P,leaveFromClass:q=`${a}-leave-from`,leaveActiveClass:Q=`${a}-leave-active`,leaveToClass:nt=`${a}-leave-to`}=i,Tt=MI(p),yt=Tt&&Tt[0],Lt=Tt&&Tt[1],{onBeforeEnter:Nt,onEnter:Dt,onEnterCancelled:wt,onLeave:It,onLeaveCancelled:Xt,onBeforeAppear:Zt=Nt,onAppear:re=Dt,onAppearCancelled:kt=wt}=e,ne=(ye,Ce,di,Ti)=>{ye._enterCancelled=Ti,yu(ye,Ce?$:P),yu(ye,Ce?z:T),di&&di()},Ut=(ye,Ce)=>{ye._isLeaving=!1,yu(ye,q),yu(ye,nt),yu(ye,Q),Ce&&Ce()},Le=ye=>(Ce,di)=>{const Ti=ye?re:Dt,Ge=()=>ne(Ce,ye,di);of(Ti,[Ce,Ge]),kw(()=>{yu(Ce,ye?o:x),hc(Ce,ye?$:P),Cw(Ti)||Pw(Ce,h,yt,Ge)})};return pn(e,{onBeforeEnter(ye){of(Nt,[ye]),hc(ye,x),hc(ye,T)},onBeforeAppear(ye){of(Zt,[ye]),hc(ye,o),hc(ye,z)},onEnter:Le(!1),onAppear:Le(!0),onLeave(ye,Ce){ye._isLeaving=!0;const di=()=>Ut(ye,Ce);hc(ye,q),ye._enterCancelled?(hc(ye,Q),qv()):(qv(),hc(ye,Q)),kw(()=>{ye._isLeaving&&(yu(ye,q),hc(ye,nt),Cw(It)||Pw(ye,h,Lt,di))}),of(It,[ye,di])},onEnterCancelled(ye){ne(ye,!1,void 0,!0),of(wt,[ye])},onAppearCancelled(ye){ne(ye,!0,void 0,!0),of(kt,[ye])},onLeaveCancelled(ye){Ut(ye),of(Xt,[ye])}})}function MI(i){if(i==null)return null;if(on(i))return[hv(i.enter),hv(i.leave)];{const e=hv(i);return[e,e]}}function hv(i){return Zy(i)}function hc(i,e){e.split(/\s+/).forEach(a=>a&&i.classList.add(a)),(i[Kp]||(i[Kp]=new Set)).add(e)}function yu(i,e){e.split(/\s+/).forEach(h=>h&&i.classList.remove(h));const a=i[Kp];a&&(a.delete(e),a.size||(i[Kp]=void 0))}function kw(i){requestAnimationFrame(()=>{requestAnimationFrame(i)})}let AI=0;function Pw(i,e,a,h){const p=i._endId=++AI,x=()=>{p===i._endId&&h()};if(a!=null)return setTimeout(x,a);const{type:T,timeout:P,propCount:o}=oM(i,e);if(!T)return h();const z=T+"end";let $=0;const q=()=>{i.removeEventListener(z,Q),x()},Q=nt=>{nt.target===i&&++$>=o&&q()};setTimeout(()=>{$<o&&q()},P+1),i.addEventListener(z,Q)}function oM(i,e){const a=window.getComputedStyle(i),h=Tt=>(a[Tt]||"").split(", "),p=h(`${gu}Delay`),x=h(`${gu}Duration`),T=Iw(p,x),P=h(`${ug}Delay`),o=h(`${ug}Duration`),z=Iw(P,o);let $=null,q=0,Q=0;e===gu?T>0&&($=gu,q=T,Q=x.length):e===ug?z>0&&($=ug,q=z,Q=o.length):(q=Math.max(T,z),$=q>0?T>z?gu:ug:null,Q=$?$===gu?x.length:o.length:0);const nt=$===gu&&/\b(transform|all)(,|$)/.test(h(`${gu}Property`).toString());return{type:$,timeout:q,propCount:Q,hasTransform:nt}}function Iw(i,e){for(;i.length<e.length;)i=i.concat(i);return Math.max(...e.map((a,h)=>Lw(a)+Lw(i[h])))}function Lw(i){return i==="auto"?0:Number(i.slice(0,-1).replace(",","."))*1e3}function qv(){return document.body.offsetHeight}function CI(i,e,a){const h=i[Kp];h&&(e=(e?[e,...h]:[...h]).join(" ")),e==null?i.removeAttribute("class"):a?i.setAttribute("class",e):i.className=e}const ox=Symbol("_vod"),aM=Symbol("_vsh"),lM={beforeMount(i,{value:e},{transition:a}){i[ox]=i.style.display==="none"?"":i.style.display,a&&e?a.beforeEnter(i):dg(i,e)},mounted(i,{value:e},{transition:a}){a&&e&&a.enter(i)},updated(i,{value:e,oldValue:a},{transition:h}){!e!=!a&&(h?e?(h.beforeEnter(i),dg(i,!0),h.enter(i)):h.leave(i,()=>{dg(i,!1)}):dg(i,e))},beforeUnmount(i,{value:e}){dg(i,e)}};function dg(i,e){i.style.display=e?i[ox]:"none",i[aM]=!e}function kI(){lM.getSSRProps=({value:i})=>{if(!i)return{style:{display:"none"}}}}const cM=Symbol("");function PI(i){const e=Wa();if(!e)return;const a=e.ut=(p=i(e.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${e.uid}"]`)).forEach(x=>ax(x,p))},h=()=>{const p=i(e.proxy);e.ce?ax(e.ce,p):Zv(e.subTree,p),a(p)};Ab(()=>{$g(h)}),ph(()=>{ya(h,ja,{flush:"post"});const p=new MutationObserver(h);p.observe(e.subTree.el.parentNode,{childList:!0}),Ox(()=>p.disconnect())})}function Zv(i,e){if(i.shapeFlag&128){const a=i.suspense;i=a.activeBranch,a.pendingBranch&&!a.isHydrating&&a.effects.push(()=>{Zv(a.activeBranch,e)})}for(;i.component;)i=i.component.subTree;if(i.shapeFlag&1&&i.el)ax(i.el,e);else if(i.type===dn)i.children.forEach(a=>Zv(a,e));else if(i.type===mf){let{el:a,anchor:h}=i;for(;a&&(ax(a,e),a!==h);)a=a.nextSibling}}function ax(i,e){if(i.nodeType===1){const a=i.style;let h="";for(const p in e)a.setProperty(`--${p}`,e[p]),h+=`--${p}: ${e[p]};`;a[cM]=h}}const II=/(^|;)\s*display\s*:/;function LI(i,e,a){const h=i.style,p=wn(a);let x=!1;if(a&&!p){if(e)if(wn(e))for(const T of e.split(";")){const P=T.slice(0,T.indexOf(":")).trim();a[P]==null&&Vy(h,P,"")}else for(const T in e)a[T]==null&&Vy(h,T,"");for(const T in a)T==="display"&&(x=!0),Vy(h,T,a[T])}else if(p){if(e!==a){const T=h[cM];T&&(a+=";"+T),h.cssText=a,x=II.test(a)}}else e&&i.removeAttribute("style");ox in i&&(i[ox]=x?h.display:"",i[aM]&&(h.display="none"))}const Dw=/\s*!important$/;function Vy(i,e,a){if(Si(a))a.forEach(h=>Vy(i,e,h));else if(a==null&&(a=""),e.startsWith("--"))i.setProperty(e,a);else{const h=DI(i,e);Dw.test(a)?i.setProperty(Go(h),a.replace(Dw,""),"important"):i[h]=a}}const zw=["Webkit","Moz","ms"],uv={};function DI(i,e){const a=uv[e];if(a)return a;let h=zr(e);if(h!=="filter"&&h in i)return uv[e]=h;h=i_(h);for(let p=0;p<zw.length;p++){const x=zw[p]+h;if(x in i)return uv[e]=x}return e}const Ow="http://www.w3.org/1999/xlink";function Rw(i,e,a,h,p,x=WC(e)){h&&e.startsWith("xlink:")?a==null?i.removeAttributeNS(Ow,e.slice(6,e.length)):i.setAttributeNS(Ow,e,a):a==null||x&&!MS(a)?i.removeAttribute(e):i.setAttribute(e,x?"":wl(a)?String(a):a)}function Bw(i,e,a,h,p){if(e==="innerHTML"||e==="textContent"){a!=null&&(i[e]=e==="innerHTML"?iM(a):a);return}const x=i.tagName;if(e==="value"&&x!=="PROGRESS"&&!x.includes("-")){const P=x==="OPTION"?i.getAttribute("value")||"":i.value,o=a==null?i.type==="checkbox"?"on":"":String(a);(P!==o||!("_value"in i))&&(i.value=o),a==null&&i.removeAttribute(e),i._value=a;return}let T=!1;if(a===""||a==null){const P=typeof i[e];P==="boolean"?a=MS(a):a==null&&P==="string"?(a="",T=!0):P==="number"&&(a=0,T=!0)}try{i[e]=a}catch{}T&&i.removeAttribute(p||e)}function ch(i,e,a,h){i.addEventListener(e,a,h)}function zI(i,e,a,h){i.removeEventListener(e,a,h)}const Fw=Symbol("_vei");function OI(i,e,a,h,p=null){const x=i[Fw]||(i[Fw]={}),T=x[e];if(h&&T)T.value=h;else{const[P,o]=RI(e);if(h){const z=x[e]=NI(h,p);ch(i,P,z,o)}else T&&(zI(i,P,T,o),x[e]=void 0)}}const Nw=/(?:Once|Passive|Capture)$/;function RI(i){let e;if(Nw.test(i)){e={};let h;for(;h=i.match(Nw);)i=i.slice(0,i.length-h[0].length),e[h[0].toLowerCase()]=!0}return[i[2]===":"?i.slice(3):Go(i.slice(2)),e]}let dv=0;const BI=Promise.resolve(),FI=()=>dv||(BI.then(()=>dv=0),dv=Date.now());function NI(i,e){const a=h=>{if(!h._vts)h._vts=Date.now();else if(h._vts<=a.attached)return;$a(jI(h,a.value),e,5,[h])};return a.value=i,a.attached=FI(),a}function jI(i,e){if(Si(e)){const a=i.stopImmediatePropagation;return i.stopImmediatePropagation=()=>{a.call(i),i._stopped=!0},e.map(h=>p=>!p._stopped&&h&&h(p))}else return e}const jw=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&i.charCodeAt(2)>96&&i.charCodeAt(2)<123,UI=(i,e,a,h,p,x)=>{const T=p==="svg";e==="class"?CI(i,h,T):e==="style"?LI(i,a,h):e_(e)?cb(e)||OI(i,e,a,h,x):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):VI(i,e,h,T))?(Bw(i,e,h),!i.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Rw(i,e,h,T,x,e!=="value")):i._isVueCE&&(/[A-Z]/.test(e)||!wn(h))?Bw(i,zr(e),h,x,e):(e==="true-value"?i._trueValue=h:e==="false-value"&&(i._falseValue=h),Rw(i,e,h,T))};function VI(i,e,a,h){if(h)return!!(e==="innerHTML"||e==="textContent"||e in i&&jw(e)&&Wi(a));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&i.tagName==="INPUT"||e==="type"&&i.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const p=i.tagName;if(p==="IMG"||p==="VIDEO"||p==="CANVAS"||p==="SOURCE")return!1}return jw(e)&&wn(a)?!1:e in i}const Uw={};/*! #__NO_SIDE_EFFECTS__ */function hM(i,e,a){const h=bo(i,e);bx(h)&&pn(h,e);class p extends jx{constructor(T){super(h,T,a)}}return p.def=h,p}/*! #__NO_SIDE_EFFECTS__ */const $I=(i,e)=>hM(i,e,bM),GI=typeof HTMLElement<"u"?HTMLElement:class{};class jx extends GI{constructor(e,a={},h=hx){super(),this._def=e,this._props=a,this._createApp=h,this._isVueCE=!0,this._instance=null,this._app=null,this._nonce=this._def.nonce,this._connected=!1,this._resolved=!1,this._numberProps=null,this._styleChildren=new WeakSet,this._ob=null,this.shadowRoot&&h!==hx?this._root=this.shadowRoot:e.shadowRoot!==!1?(this.attachShadow({mode:"open"}),this._root=this.shadowRoot):this._root=this,this._def.__asyncLoader||this._resolveProps(this._def)}connectedCallback(){if(!this.isConnected)return;this.shadowRoot||this._parseSlots(),this._connected=!0;let e=this;for(;e=e&&(e.parentNode||e.host);)if(e instanceof jx){this._parent=e;break}this._instance||(this._resolved?(this._setParent(),this._update()):e&&e._pendingResolve?this._pendingResolve=e._pendingResolve.then(()=>{this._pendingResolve=void 0,this._resolveDef()}):this._resolveDef())}_setParent(e=this._parent){e&&(this._instance.parent=e._instance,this._instance.provides=e._instance.provides)}disconnectedCallback(){this._connected=!1,Sf(()=>{this._connected||(this._ob&&(this._ob.disconnect(),this._ob=null),this._app&&this._app.unmount(),this._instance&&(this._instance.ce=void 0),this._app=this._instance=null)})}_resolveDef(){if(this._pendingResolve)return;for(let h=0;h<this.attributes.length;h++)this._setAttr(this.attributes[h].name);this._ob=new MutationObserver(h=>{for(const p of h)this._setAttr(p.attributeName)}),this._ob.observe(this,{attributes:!0});const e=(h,p=!1)=>{this._resolved=!0,this._pendingResolve=void 0;const{props:x,styles:T}=h;let P;if(x&&!Si(x))for(const o in x){const z=x[o];(z===Number||z&&z.type===Number)&&(o in this._props&&(this._props[o]=Zy(this._props[o])),(P||(P=Object.create(null)))[zr(o)]=!0)}this._numberProps=P,p&&this._resolveProps(h),this.shadowRoot&&this._applyStyles(T),this._mount(h)},a=this._def.__asyncLoader;a?this._pendingResolve=a().then(h=>e(this._def=h,!0)):e(this._def)}_mount(e){this._app=this._createApp(e),e.configureApp&&e.configureApp(this._app),this._app._ceVNode=this._createVNode(),this._app.mount(this._root);const a=this._instance&&this._instance.exposed;if(a)for(const h in a)Xs(this,h)||Object.defineProperty(this,h,{get:()=>hh(a[h])})}_resolveProps(e){const{props:a}=e,h=Si(a)?a:Object.keys(a||{});for(const p of Object.keys(this))p[0]!=="_"&&h.includes(p)&&this._setProp(p,this[p]);for(const p of h.map(zr))Object.defineProperty(this,p,{get(){return this._getProp(p)},set(x){this._setProp(p,x,!0,!0)}})}_setAttr(e){if(e.startsWith("data-v-"))return;const a=this.hasAttribute(e);let h=a?this.getAttribute(e):Uw;const p=zr(e);a&&this._numberProps&&this._numberProps[p]&&(h=Zy(h)),this._setProp(p,h,!1,!0)}_getProp(e){return this._props[e]}_setProp(e,a,h=!0,p=!1){if(a!==this._props[e]&&(a===Uw?delete this._props[e]:(this._props[e]=a,e==="key"&&this._app&&(this._app._ceVNode.key=a)),p&&this._instance&&this._update(),h)){const x=this._ob;x&&x.disconnect(),a===!0?this.setAttribute(Go(e),""):typeof a=="string"||typeof a=="number"?this.setAttribute(Go(e),a+""):a||this.removeAttribute(Go(e)),x&&x.observe(this,{attributes:!0})}}_update(){vM(this._createVNode(),this._root)}_createVNode(){const e={};this.shadowRoot||(e.onVnodeMounted=e.onVnodeUpdated=this._renderSlots.bind(this));const a=fs(this._def,pn(e,this._props));return this._instance||(a.ce=h=>{this._instance=h,h.ce=this,h.isCE=!0;const p=(x,T)=>{this.dispatchEvent(new CustomEvent(x,bx(T[0])?pn({detail:T},T[0]):{detail:T}))};h.emit=(x,...T)=>{p(x,T),Go(x)!==x&&p(Go(x),T)},this._setParent()}),a}_applyStyles(e,a){if(!e)return;if(a){if(a===this._def||this._styleChildren.has(a))return;this._styleChildren.add(a)}const h=this._nonce;for(let p=e.length-1;p>=0;p--){const x=document.createElement("style");h&&x.setAttribute("nonce",h),x.textContent=e[p],this.shadowRoot.prepend(x)}}_parseSlots(){const e=this._slots={};let a;for(;a=this.firstChild;){const h=a.nodeType===1&&a.getAttribute("slot")||"default";(e[h]||(e[h]=[])).push(a),this.removeChild(a)}}_renderSlots(){const e=(this._teleportTarget||this).querySelectorAll("slot"),a=this._instance.type.__scopeId;for(let h=0;h<e.length;h++){const p=e[h],x=p.getAttribute("name")||"default",T=this._slots[x],P=p.parentNode;if(T)for(const o of T){if(a&&o.nodeType===1){const z=a+"-s",$=document.createTreeWalker(o,1);o.setAttribute(z,"");let q;for(;q=$.nextNode();)q.setAttribute(z,"")}P.insertBefore(o,p)}else for(;p.firstChild;)P.insertBefore(p.firstChild,p);P.removeChild(p)}}_injectChildStyle(e){this._applyStyles(e.styles,e)}_removeChildStyle(e){}}function uM(i){const e=Wa(),a=e&&e.ce;return a||null}function WI(){const i=uM();return i&&i.shadowRoot}function HI(i="$style"){{const e=Wa();if(!e)return ks;const a=e.type.__cssModules;if(!a)return ks;const h=a[i];return h||ks}}const dM=new WeakMap,fM=new WeakMap,lx=Symbol("_moveCb"),Vw=Symbol("_enterCb"),XI=i=>(delete i.props.mode,i),qI=XI({name:"TransitionGroup",props:pn({},nM,{tag:String,moveClass:String}),setup(i,{slots:e}){const a=Wa(),h=Sb();let p,x;return zx(()=>{if(!p.length)return;const T=i.moveClass||`${i.name||"v"}-move`;if(!QI(p[0].el,a.vnode.el,T))return;p.forEach(YI),p.forEach(KI);const P=p.filter(JI);qv(),P.forEach(o=>{const z=o.el,$=z.style;hc(z,T),$.transform=$.webkitTransform=$.transitionDuration="";const q=z[lx]=Q=>{Q&&Q.target!==z||(!Q||/transform$/.test(Q.propertyName))&&(z.removeEventListener("transitionend",q),z[lx]=null,yu(z,T))};z.addEventListener("transitionend",q)})}),()=>{const T=Cs(i),P=rM(T);let o=T.tag||dn;if(p=[],x)for(let z=0;z<x.length;z++){const $=x[z];$.el&&$.el instanceof Element&&(p.push($),uh($,Zp($,P,h,a)),dM.set($,$.el.getBoundingClientRect()))}x=e.default?Lx(e.default()):[];for(let z=0;z<x.length;z++){const $=x[z];$.key!=null&&uh($,Zp($,P,h,a))}return fs(o,null,x)}}}),ZI=qI;function YI(i){const e=i.el;e[lx]&&e[lx](),e[Vw]&&e[Vw]()}function KI(i){fM.set(i,i.el.getBoundingClientRect())}function JI(i){const e=dM.get(i),a=fM.get(i),h=e.left-a.left,p=e.top-a.top;if(h||p){const x=i.el.style;return x.transform=x.webkitTransform=`translate(${h}px,${p}px)`,x.transitionDuration="0s",i}}function QI(i,e,a){const h=i.cloneNode(),p=i[Kp];p&&p.forEach(P=>{P.split(/\s+/).forEach(o=>o&&h.classList.remove(o))}),a.split(/\s+/).forEach(P=>P&&h.classList.add(P)),h.style.display="none";const x=e.nodeType===1?e:e.parentNode;x.appendChild(h);const{hasTransform:T}=oM(h);return x.removeChild(h),T}const Ou=i=>{const e=i.props["onUpdate:modelValue"]||!1;return Si(e)?a=>Vp(e,a):e};function tL(i){i.target.composing=!0}function $w(i){const e=i.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Va=Symbol("_assign"),cx={created(i,{modifiers:{lazy:e,trim:a,number:h}},p){i[Va]=Ou(p);const x=h||p.props&&p.props.type==="number";ch(i,e?"change":"input",T=>{if(T.target.composing)return;let P=i.value;a&&(P=P.trim()),x&&(P=qy(P)),i[Va](P)}),a&&ch(i,"change",()=>{i.value=i.value.trim()}),e||(ch(i,"compositionstart",tL),ch(i,"compositionend",$w),ch(i,"change",$w))},mounted(i,{value:e}){i.value=e??""},beforeUpdate(i,{value:e,oldValue:a,modifiers:{lazy:h,trim:p,number:x}},T){if(i[Va]=Ou(T),i.composing)return;const P=(x||i.type==="number")&&!/^0\d/.test(i.value)?qy(i.value):i.value,o=e??"";P!==o&&(document.activeElement===i&&i.type!=="range"&&(h&&e===a||p&&i.value.trim()===o)||(i.value=o))}},Rb={deep:!0,created(i,e,a){i[Va]=Ou(a),ch(i,"change",()=>{const h=i._modelValue,p=Jp(i),x=i.checked,T=i[Va];if(Si(h)){const P=Sx(h,p),o=P!==-1;if(x&&!o)T(h.concat(p));else if(!x&&o){const z=[...h];z.splice(P,1),T(z)}}else if(bf(h)){const P=new Set(h);x?P.add(p):P.delete(p),T(P)}else T(pM(i,x))})},mounted:Gw,beforeUpdate(i,e,a){i[Va]=Ou(a),Gw(i,e,a)}};function Gw(i,{value:e,oldValue:a},h){i._modelValue=e;let p;if(Si(e))p=Sx(e,h.props.value)>-1;else if(bf(e))p=e.has(h.props.value);else{if(e===a)return;p=Du(e,pM(i,!0))}i.checked!==p&&(i.checked=p)}const Bb={created(i,{value:e},a){i.checked=Du(e,a.props.value),i[Va]=Ou(a),ch(i,"change",()=>{i[Va](Jp(i))})},beforeUpdate(i,{value:e,oldValue:a},h){i[Va]=Ou(h),e!==a&&(i.checked=Du(e,h.props.value))}},Wp={deep:!0,created(i,{value:e,modifiers:{number:a}},h){const p=bf(e);ch(i,"change",()=>{const x=Array.prototype.filter.call(i.options,T=>T.selected).map(T=>a?qy(Jp(T)):Jp(T));i[Va](i.multiple?p?new Set(x):x:x[0]),i._assigning=!0,Sf(()=>{i._assigning=!1})}),i[Va]=Ou(h)},mounted(i,{value:e}){Ww(i,e)},beforeUpdate(i,e,a){i[Va]=Ou(a)},updated(i,{value:e}){i._assigning||Ww(i,e)}};function Ww(i,e){const a=i.multiple,h=Si(e);if(!(a&&!h&&!bf(e))){for(let p=0,x=i.options.length;p<x;p++){const T=i.options[p],P=Jp(T);if(a)if(h){const o=typeof P;o==="string"||o==="number"?T.selected=e.some(z=>String(z)===String(P)):T.selected=Sx(e,P)>-1}else T.selected=e.has(P);else if(Du(Jp(T),e)){i.selectedIndex!==p&&(i.selectedIndex=p);return}}!a&&i.selectedIndex!==-1&&(i.selectedIndex=-1)}}function Jp(i){return"_value"in i?i._value:i.value}function pM(i,e){const a=e?"_trueValue":"_falseValue";return a in i?i[a]:e}const mM={created(i,e,a){Sy(i,e,a,null,"created")},mounted(i,e,a){Sy(i,e,a,null,"mounted")},beforeUpdate(i,e,a,h){Sy(i,e,a,h,"beforeUpdate")},updated(i,e,a,h){Sy(i,e,a,h,"updated")}};function gM(i,e){switch(i){case"SELECT":return Wp;case"TEXTAREA":return cx;default:switch(e){case"checkbox":return Rb;case"radio":return Bb;default:return cx}}}function Sy(i,e,a,h,p){const T=gM(i.tagName,a.props&&a.props.type)[p];T&&T(i,e,a,h)}function eL(){cx.getSSRProps=({value:i})=>({value:i}),Bb.getSSRProps=({value:i},e)=>{if(e.props&&Du(e.props.value,i))return{checked:!0}},Rb.getSSRProps=({value:i},e)=>{if(Si(i)){if(e.props&&Sx(i,e.props.value)>-1)return{checked:!0}}else if(bf(i)){if(e.props&&i.has(e.props.value))return{checked:!0}}else if(i)return{checked:!0}},mM.getSSRProps=(i,e)=>{if(typeof e.type!="string")return;const a=gM(e.type.toUpperCase(),e.props&&e.props.type);if(a.getSSRProps)return a.getSSRProps(i,e)}}const iL=["ctrl","shift","alt","meta"],sL={stop:i=>i.stopPropagation(),prevent:i=>i.preventDefault(),self:i=>i.target!==i.currentTarget,ctrl:i=>!i.ctrlKey,shift:i=>!i.shiftKey,alt:i=>!i.altKey,meta:i=>!i.metaKey,left:i=>"button"in i&&i.button!==0,middle:i=>"button"in i&&i.button!==1,right:i=>"button"in i&&i.button!==2,exact:(i,e)=>iL.some(a=>i[`${a}Key`]&&!e.includes(a))},nL=(i,e)=>{const a=i._withMods||(i._withMods={}),h=e.join(".");return a[h]||(a[h]=(p,...x)=>{for(let T=0;T<e.length;T++){const P=sL[e[T]];if(P&&P(p,e))return}return i(p,...x)})},rL={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},oL=(i,e)=>{const a=i._withKeys||(i._withKeys={}),h=e.join(".");return a[h]||(a[h]=p=>{if(!("key"in p))return;const x=Go(p.key);if(e.some(T=>T===x||rL[T]===x))return i(p)})},_M=pn({patchProp:UI},SI);let Lg,Hw=!1;function yM(){return Lg||(Lg=IE(_M))}function xM(){return Lg=Hw?Lg:LE(_M),Hw=!0,Lg}const vM=(...i)=>{yM().render(...i)},aL=(...i)=>{xM().hydrate(...i)},hx=(...i)=>{const e=yM().createApp(...i),{mount:a}=e;return e.mount=h=>{const p=TM(h);if(!p)return;const x=e._component;!Wi(x)&&!x.render&&!x.template&&(x.template=p.innerHTML),p.nodeType===1&&(p.textContent="");const T=a(p,!1,wM(p));return p instanceof Element&&(p.removeAttribute("v-cloak"),p.setAttribute("data-v-app","")),T},e},bM=(...i)=>{const e=xM().createApp(...i),{mount:a}=e;return e.mount=h=>{const p=TM(h);if(p)return a(p,!0,wM(p))},e};function wM(i){if(i instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&i instanceof MathMLElement)return"mathml"}function TM(i){return wn(i)?document.querySelector(i):i}let Xw=!1;const lL=()=>{Xw||(Xw=!0,eL(),kI())};/**
* vue v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const cL=()=>{},hL=Object.freeze(Object.defineProperty({__proto__:null,BaseTransition:aE,BaseTransitionPropsValidators:Eb,Comment:dr,DeprecationTypes:bI,EffectScope:fb,ErrorCodes:Lk,ErrorTypeStrings:pI,Fragment:dn,KeepAlive:nP,ReactiveEffect:jg,Static:mf,Suspense:YP,Teleport:jk,Text:ku,TrackOpTypes:Ek,Transition:Ob,TransitionGroup:ZI,TriggerOpTypes:Mk,VueElement:jx,assertNumber:Ik,callWithAsyncErrorHandling:$a,callWithErrorHandling:om,camelize:zr,capitalize:i_,cloneVNode:_c,compatUtils:vI,compile:cL,computed:Jr,createApp:hx,createBlock:yf,createCommentVNode:Ba,createElementBlock:cs,createElementVNode:Ye,createHydrationRenderer:LE,createPropsRestProxy:SP,createRenderer:IE,createSSRApp:bM,createSlots:cP,createStaticVNode:Fx,createTextVNode:Na,createVNode:fs,customRef:HS,defineAsyncComponent:iP,defineComponent:bo,defineCustomElement:hM,defineEmits:pP,defineExpose:mP,defineModel:yP,defineOptions:gP,defineProps:fP,defineSSRCustomElement:$I,defineSlots:_P,devtools:mI,effect:qC,effectScope:pb,getCurrentInstance:Wa,getCurrentScope:mb,getCurrentWatcher:Ak,getTransitionRawChildren:Lx,guardReactiveProps:XE,h:Nx,handleError:Tf,hasInjectionContext:bE,hydrate:aL,hydrateOnIdle:Yk,hydrateOnInteraction:tP,hydrateOnMediaQuery:Qk,hydrateOnVisible:Jk,initCustomFormatter:uI,initDirectivesForSSR:lL,inject:Ua,isMemoSame:tM,isProxy:kx,isReactive:mc,isReadonly:zu,isRef:Un,isRuntimeOnly:lI,isShallow:_a,isVNode:dh,markRaw:Px,mergeDefaults:wP,mergeModels:TP,mergeProps:qE,nextTick:Sf,normalizeClass:nm,normalizeProps:$C,normalizeStyle:wf,onActivated:cE,onBeforeMount:dE,onBeforeUnmount:n_,onBeforeUpdate:Ab,onDeactivated:hE,onErrorCaptured:gE,onMounted:ph,onRenderTracked:mE,onRenderTriggered:pE,onScopeDispose:kS,onServerPrefetch:fE,onUnmounted:Ox,onUpdated:zx,onWatcherCleanup:ZS,openBlock:qi,popScopeId:Bk,provide:Pg,proxyRefs:wb,pushScopeId:Rk,queuePostFlushCb:$g,reactive:rm,readonly:vb,ref:Bs,registerRuntimeCompiler:aI,render:vM,renderList:gc,renderSlot:hP,resolveComponent:tx,resolveDirective:lP,resolveDynamicComponent:aP,resolveFilter:xI,resolveTransitionHooks:Zp,setBlockTracking:Uv,setDevtoolsHook:gI,setTransitionHooks:uh,shallowReactive:xb,shallowReadonly:pk,shallowRef:bb,ssrContextKey:RE,ssrUtils:yI,stop:ZC,toDisplayString:Dn,toHandlerKey:Sg,toHandlers:uP,toRaw:Cs,toRef:wk,toRefs:XS,toValue:_k,transformVNodeArgs:iI,triggerRef:gk,unref:hh,useAttrs:bP,useCssModule:HI,useCssVars:PI,useHost:uM,useId:Vk,useModel:$P,useSSRContext:BE,useShadowRoot:WI,useSlots:vP,useTemplateRef:$k,useTransitionState:Sb,vModelCheckbox:Rb,vModelDynamic:mM,vModelRadio:Bb,vModelSelect:Wp,vModelText:cx,vShow:lM,version:eM,warn:fI,watch:ya,watchEffect:jP,watchPostEffect:UP,watchSyncEffect:FE,withAsyncContext:EP,withCtx:Fa,withDefaults:xP,withDirectives:Ag,withKeys:oL,withMemo:dI,withModifiers:nL,withScopeId:Fk},Symbol.toStringTag,{value:"Module"})),Fb="/projects/soil_values/assets/DGIS_logo-BMUz1Rxj.webp",SM="/projects/soil_values/assets/logo-CicDM-h9.png";/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Rp=typeof document<"u";function EM(i){return typeof i=="object"||"displayName"in i||"props"in i||"__vccOpts"in i}function uL(i){return i.__esModule||i[Symbol.toStringTag]==="Module"||i.default&&EM(i.default)}const Qs=Object.assign;function fv(i,e){const a={};for(const h in e){const p=e[h];a[h]=Tl(p)?p.map(i):i(p)}return a}const Dg=()=>{},Tl=Array.isArray,MM=/#/g,dL=/&/g,fL=/\//g,pL=/=/g,mL=/\?/g,AM=/\+/g,gL=/%5B/g,_L=/%5D/g,CM=/%5E/g,yL=/%60/g,kM=/%7B/g,xL=/%7C/g,PM=/%7D/g,vL=/%20/g;function Nb(i){return encodeURI(""+i).replace(xL,"|").replace(gL,"[").replace(_L,"]")}function bL(i){return Nb(i).replace(kM,"{").replace(PM,"}").replace(CM,"^")}function Yv(i){return Nb(i).replace(AM,"%2B").replace(vL,"+").replace(MM,"%23").replace(dL,"%26").replace(yL,"`").replace(kM,"{").replace(PM,"}").replace(CM,"^")}function wL(i){return Yv(i).replace(pL,"%3D")}function TL(i){return Nb(i).replace(MM,"%23").replace(mL,"%3F")}function SL(i){return i==null?"":TL(i).replace(fL,"%2F")}function Zg(i){try{return decodeURIComponent(""+i)}catch{}return""+i}const EL=/\/$/,ML=i=>i.replace(EL,"");function pv(i,e,a="/"){let h,p={},x="",T="";const P=e.indexOf("#");let o=e.indexOf("?");return P<o&&P>=0&&(o=-1),o>-1&&(h=e.slice(0,o),x=e.slice(o+1,P>-1?P:e.length),p=i(x)),P>-1&&(h=h||e.slice(0,P),T=e.slice(P,e.length)),h=PL(h??e,a),{fullPath:h+(x&&"?")+x+T,path:h,query:p,hash:Zg(T)}}function AL(i,e){const a=e.query?i(e.query):"";return e.path+(a&&"?")+a+(e.hash||"")}function qw(i,e){return!e||!i.toLowerCase().startsWith(e.toLowerCase())?i:i.slice(e.length)||"/"}function CL(i,e,a){const h=e.matched.length-1,p=a.matched.length-1;return h>-1&&h===p&&Qp(e.matched[h],a.matched[p])&&IM(e.params,a.params)&&i(e.query)===i(a.query)&&e.hash===a.hash}function Qp(i,e){return(i.aliasOf||i)===(e.aliasOf||e)}function IM(i,e){if(Object.keys(i).length!==Object.keys(e).length)return!1;for(const a in i)if(!kL(i[a],e[a]))return!1;return!0}function kL(i,e){return Tl(i)?Zw(i,e):Tl(e)?Zw(e,i):i===e}function Zw(i,e){return Tl(e)?i.length===e.length&&i.every((a,h)=>a===e[h]):i.length===1&&i[0]===e}function PL(i,e){if(i.startsWith("/"))return i;if(!i)return e;const a=e.split("/"),h=i.split("/"),p=h[h.length-1];(p===".."||p===".")&&h.push("");let x=a.length-1,T,P;for(T=0;T<h.length;T++)if(P=h[T],P!==".")if(P==="..")x>1&&x--;else break;return a.slice(0,x).join("/")+"/"+h.slice(T).join("/")}const _u={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Yg;(function(i){i.pop="pop",i.push="push"})(Yg||(Yg={}));var zg;(function(i){i.back="back",i.forward="forward",i.unknown=""})(zg||(zg={}));function IL(i){if(!i)if(Rp){const e=document.querySelector("base");i=e&&e.getAttribute("href")||"/",i=i.replace(/^\w+:\/\/[^\/]+/,"")}else i="/";return i[0]!=="/"&&i[0]!=="#"&&(i="/"+i),ML(i)}const LL=/^[^#]+#/;function DL(i,e){return i.replace(LL,"#")+e}function zL(i,e){const a=document.documentElement.getBoundingClientRect(),h=i.getBoundingClientRect();return{behavior:e.behavior,left:h.left-a.left-(e.left||0),top:h.top-a.top-(e.top||0)}}const Ux=()=>({left:window.scrollX,top:window.scrollY});function OL(i){let e;if("el"in i){const a=i.el,h=typeof a=="string"&&a.startsWith("#"),p=typeof a=="string"?h?document.getElementById(a.slice(1)):document.querySelector(a):a;if(!p)return;e=zL(p,i)}else e=i;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function Yw(i,e){return(history.state?history.state.position-e:-1)+i}const Kv=new Map;function RL(i,e){Kv.set(i,e)}function BL(i){const e=Kv.get(i);return Kv.delete(i),e}let FL=()=>location.protocol+"//"+location.host;function LM(i,e){const{pathname:a,search:h,hash:p}=e,x=i.indexOf("#");if(x>-1){let P=p.includes(i.slice(x))?i.slice(x).length:1,o=p.slice(P);return o[0]!=="/"&&(o="/"+o),qw(o,"")}return qw(a,i)+h+p}function NL(i,e,a,h){let p=[],x=[],T=null;const P=({state:Q})=>{const nt=LM(i,location),Tt=a.value,yt=e.value;let Lt=0;if(Q){if(a.value=nt,e.value=Q,T&&T===Tt){T=null;return}Lt=yt?Q.position-yt.position:0}else h(nt);p.forEach(Nt=>{Nt(a.value,Tt,{delta:Lt,type:Yg.pop,direction:Lt?Lt>0?zg.forward:zg.back:zg.unknown})})};function o(){T=a.value}function z(Q){p.push(Q);const nt=()=>{const Tt=p.indexOf(Q);Tt>-1&&p.splice(Tt,1)};return x.push(nt),nt}function $(){const{history:Q}=window;Q.state&&Q.replaceState(Qs({},Q.state,{scroll:Ux()}),"")}function q(){for(const Q of x)Q();x=[],window.removeEventListener("popstate",P),window.removeEventListener("beforeunload",$)}return window.addEventListener("popstate",P),window.addEventListener("beforeunload",$,{passive:!0}),{pauseListeners:o,listen:z,destroy:q}}function Kw(i,e,a,h=!1,p=!1){return{back:i,current:e,forward:a,replaced:h,position:window.history.length,scroll:p?Ux():null}}function jL(i){const{history:e,location:a}=window,h={value:LM(i,a)},p={value:e.state};p.value||x(h.value,{back:null,current:h.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function x(o,z,$){const q=i.indexOf("#"),Q=q>-1?(a.host&&document.querySelector("base")?i:i.slice(q))+o:FL()+i+o;try{e[$?"replaceState":"pushState"](z,"",Q),p.value=z}catch(nt){console.error(nt),a[$?"replace":"assign"](Q)}}function T(o,z){const $=Qs({},e.state,Kw(p.value.back,o,p.value.forward,!0),z,{position:p.value.position});x(o,$,!0),h.value=o}function P(o,z){const $=Qs({},p.value,e.state,{forward:o,scroll:Ux()});x($.current,$,!0);const q=Qs({},Kw(h.value,o,null),{position:$.position+1},z);x(o,q,!1),h.value=o}return{location:h,state:p,push:P,replace:T}}function UL(i){i=IL(i);const e=jL(i),a=NL(i,e.state,e.location,e.replace);function h(x,T=!0){T||a.pauseListeners(),history.go(x)}const p=Qs({location:"",base:i,go:h,createHref:DL.bind(null,i)},e,a);return Object.defineProperty(p,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(p,"state",{enumerable:!0,get:()=>e.state.value}),p}function VL(i){return typeof i=="string"||i&&typeof i=="object"}function DM(i){return typeof i=="string"||typeof i=="symbol"}const zM=Symbol("");var Jw;(function(i){i[i.aborted=4]="aborted",i[i.cancelled=8]="cancelled",i[i.duplicated=16]="duplicated"})(Jw||(Jw={}));function tm(i,e){return Qs(new Error,{type:i,[zM]:!0},e)}function th(i,e){return i instanceof Error&&zM in i&&(e==null||!!(i.type&e))}const Qw="[^/]+?",$L={sensitive:!1,strict:!1,start:!0,end:!0},GL=/[.+*?^${}()[\]/\\]/g;function WL(i,e){const a=Qs({},$L,e),h=[];let p=a.start?"^":"";const x=[];for(const z of i){const $=z.length?[]:[90];a.strict&&!z.length&&(p+="/");for(let q=0;q<z.length;q++){const Q=z[q];let nt=40+(a.sensitive?.25:0);if(Q.type===0)q||(p+="/"),p+=Q.value.replace(GL,"\\$&"),nt+=40;else if(Q.type===1){const{value:Tt,repeatable:yt,optional:Lt,regexp:Nt}=Q;x.push({name:Tt,repeatable:yt,optional:Lt});const Dt=Nt||Qw;if(Dt!==Qw){nt+=10;try{new RegExp(`(${Dt})`)}catch(It){throw new Error(`Invalid custom RegExp for param "${Tt}" (${Dt}): `+It.message)}}let wt=yt?`((?:${Dt})(?:/(?:${Dt}))*)`:`(${Dt})`;q||(wt=Lt&&z.length<2?`(?:/${wt})`:"/"+wt),Lt&&(wt+="?"),p+=wt,nt+=20,Lt&&(nt+=-8),yt&&(nt+=-20),Dt===".*"&&(nt+=-50)}$.push(nt)}h.push($)}if(a.strict&&a.end){const z=h.length-1;h[z][h[z].length-1]+=.7000000000000001}a.strict||(p+="/?"),a.end?p+="$":a.strict&&!p.endsWith("/")&&(p+="(?:/|$)");const T=new RegExp(p,a.sensitive?"":"i");function P(z){const $=z.match(T),q={};if(!$)return null;for(let Q=1;Q<$.length;Q++){const nt=$[Q]||"",Tt=x[Q-1];q[Tt.name]=nt&&Tt.repeatable?nt.split("/"):nt}return q}function o(z){let $="",q=!1;for(const Q of i){(!q||!$.endsWith("/"))&&($+="/"),q=!1;for(const nt of Q)if(nt.type===0)$+=nt.value;else if(nt.type===1){const{value:Tt,repeatable:yt,optional:Lt}=nt,Nt=Tt in z?z[Tt]:"";if(Tl(Nt)&&!yt)throw new Error(`Provided param "${Tt}" is an array but it is not repeatable (* or + modifiers)`);const Dt=Tl(Nt)?Nt.join("/"):Nt;if(!Dt)if(Lt)Q.length<2&&($.endsWith("/")?$=$.slice(0,-1):q=!0);else throw new Error(`Missing required param "${Tt}"`);$+=Dt}}return $||"/"}return{re:T,score:h,keys:x,parse:P,stringify:o}}function HL(i,e){let a=0;for(;a<i.length&&a<e.length;){const h=e[a]-i[a];if(h)return h;a++}return i.length<e.length?i.length===1&&i[0]===80?-1:1:i.length>e.length?e.length===1&&e[0]===80?1:-1:0}function OM(i,e){let a=0;const h=i.score,p=e.score;for(;a<h.length&&a<p.length;){const x=HL(h[a],p[a]);if(x)return x;a++}if(Math.abs(p.length-h.length)===1){if(tT(h))return 1;if(tT(p))return-1}return p.length-h.length}function tT(i){const e=i[i.length-1];return i.length>0&&e[e.length-1]<0}const XL={type:0,value:""},qL=/[a-zA-Z0-9_]/;function ZL(i){if(!i)return[[]];if(i==="/")return[[XL]];if(!i.startsWith("/"))throw new Error(`Invalid path "${i}"`);function e(nt){throw new Error(`ERR (${a})/"${z}": ${nt}`)}let a=0,h=a;const p=[];let x;function T(){x&&p.push(x),x=[]}let P=0,o,z="",$="";function q(){z&&(a===0?x.push({type:0,value:z}):a===1||a===2||a===3?(x.length>1&&(o==="*"||o==="+")&&e(`A repeatable param (${z}) must be alone in its segment. eg: '/:ids+.`),x.push({type:1,value:z,regexp:$,repeatable:o==="*"||o==="+",optional:o==="*"||o==="?"})):e("Invalid state to consume buffer"),z="")}function Q(){z+=o}for(;P<i.length;){if(o=i[P++],o==="\\"&&a!==2){h=a,a=4;continue}switch(a){case 0:o==="/"?(z&&q(),T()):o===":"?(q(),a=1):Q();break;case 4:Q(),a=h;break;case 1:o==="("?a=2:qL.test(o)?Q():(q(),a=0,o!=="*"&&o!=="?"&&o!=="+"&&P--);break;case 2:o===")"?$[$.length-1]=="\\"?$=$.slice(0,-1)+o:a=3:$+=o;break;case 3:q(),a=0,o!=="*"&&o!=="?"&&o!=="+"&&P--,$="";break;default:e("Unknown state");break}}return a===2&&e(`Unfinished custom RegExp for param "${z}"`),q(),T(),p}function YL(i,e,a){const h=WL(ZL(i.path),a),p=Qs(h,{record:i,parent:e,children:[],alias:[]});return e&&!p.record.aliasOf==!e.record.aliasOf&&e.children.push(p),p}function KL(i,e){const a=[],h=new Map;e=nT({strict:!1,end:!0,sensitive:!1},e);function p(q){return h.get(q)}function x(q,Q,nt){const Tt=!nt,yt=iT(q);yt.aliasOf=nt&&nt.record;const Lt=nT(e,q),Nt=[yt];if("alias"in q){const It=typeof q.alias=="string"?[q.alias]:q.alias;for(const Xt of It)Nt.push(iT(Qs({},yt,{components:nt?nt.record.components:yt.components,path:Xt,aliasOf:nt?nt.record:yt})))}let Dt,wt;for(const It of Nt){const{path:Xt}=It;if(Q&&Xt[0]!=="/"){const Zt=Q.record.path,re=Zt[Zt.length-1]==="/"?"":"/";It.path=Q.record.path+(Xt&&re+Xt)}if(Dt=YL(It,Q,Lt),nt?nt.alias.push(Dt):(wt=wt||Dt,wt!==Dt&&wt.alias.push(Dt),Tt&&q.name&&!sT(Dt)&&T(q.name)),RM(Dt)&&o(Dt),yt.children){const Zt=yt.children;for(let re=0;re<Zt.length;re++)x(Zt[re],Dt,nt&&nt.children[re])}nt=nt||Dt}return wt?()=>{T(wt)}:Dg}function T(q){if(DM(q)){const Q=h.get(q);Q&&(h.delete(q),a.splice(a.indexOf(Q),1),Q.children.forEach(T),Q.alias.forEach(T))}else{const Q=a.indexOf(q);Q>-1&&(a.splice(Q,1),q.record.name&&h.delete(q.record.name),q.children.forEach(T),q.alias.forEach(T))}}function P(){return a}function o(q){const Q=tD(q,a);a.splice(Q,0,q),q.record.name&&!sT(q)&&h.set(q.record.name,q)}function z(q,Q){let nt,Tt={},yt,Lt;if("name"in q&&q.name){if(nt=h.get(q.name),!nt)throw tm(1,{location:q});Lt=nt.record.name,Tt=Qs(eT(Q.params,nt.keys.filter(wt=>!wt.optional).concat(nt.parent?nt.parent.keys.filter(wt=>wt.optional):[]).map(wt=>wt.name)),q.params&&eT(q.params,nt.keys.map(wt=>wt.name))),yt=nt.stringify(Tt)}else if(q.path!=null)yt=q.path,nt=a.find(wt=>wt.re.test(yt)),nt&&(Tt=nt.parse(yt),Lt=nt.record.name);else{if(nt=Q.name?h.get(Q.name):a.find(wt=>wt.re.test(Q.path)),!nt)throw tm(1,{location:q,currentLocation:Q});Lt=nt.record.name,Tt=Qs({},Q.params,q.params),yt=nt.stringify(Tt)}const Nt=[];let Dt=nt;for(;Dt;)Nt.unshift(Dt.record),Dt=Dt.parent;return{name:Lt,path:yt,params:Tt,matched:Nt,meta:QL(Nt)}}i.forEach(q=>x(q));function $(){a.length=0,h.clear()}return{addRoute:x,resolve:z,removeRoute:T,clearRoutes:$,getRoutes:P,getRecordMatcher:p}}function eT(i,e){const a={};for(const h of e)h in i&&(a[h]=i[h]);return a}function iT(i){const e={path:i.path,redirect:i.redirect,name:i.name,meta:i.meta||{},aliasOf:i.aliasOf,beforeEnter:i.beforeEnter,props:JL(i),children:i.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in i?i.components||null:i.component&&{default:i.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function JL(i){const e={},a=i.props||!1;if("component"in i)e.default=a;else for(const h in i.components)e[h]=typeof a=="object"?a[h]:a;return e}function sT(i){for(;i;){if(i.record.aliasOf)return!0;i=i.parent}return!1}function QL(i){return i.reduce((e,a)=>Qs(e,a.meta),{})}function nT(i,e){const a={};for(const h in i)a[h]=h in e?e[h]:i[h];return a}function tD(i,e){let a=0,h=e.length;for(;a!==h;){const x=a+h>>1;OM(i,e[x])<0?h=x:a=x+1}const p=eD(i);return p&&(h=e.lastIndexOf(p,h-1)),h}function eD(i){let e=i;for(;e=e.parent;)if(RM(e)&&OM(i,e)===0)return e}function RM({record:i}){return!!(i.name||i.components&&Object.keys(i.components).length||i.redirect)}function iD(i){const e={};if(i===""||i==="?")return e;const h=(i[0]==="?"?i.slice(1):i).split("&");for(let p=0;p<h.length;++p){const x=h[p].replace(AM," "),T=x.indexOf("="),P=Zg(T<0?x:x.slice(0,T)),o=T<0?null:Zg(x.slice(T+1));if(P in e){let z=e[P];Tl(z)||(z=e[P]=[z]),z.push(o)}else e[P]=o}return e}function rT(i){let e="";for(let a in i){const h=i[a];if(a=wL(a),h==null){h!==void 0&&(e+=(e.length?"&":"")+a);continue}(Tl(h)?h.map(x=>x&&Yv(x)):[h&&Yv(h)]).forEach(x=>{x!==void 0&&(e+=(e.length?"&":"")+a,x!=null&&(e+="="+x))})}return e}function sD(i){const e={};for(const a in i){const h=i[a];h!==void 0&&(e[a]=Tl(h)?h.map(p=>p==null?null:""+p):h==null?h:""+h)}return e}const nD=Symbol(""),oT=Symbol(""),jb=Symbol(""),Ub=Symbol(""),Jv=Symbol("");function fg(){let i=[];function e(h){return i.push(h),()=>{const p=i.indexOf(h);p>-1&&i.splice(p,1)}}function a(){i=[]}return{add:e,list:()=>i.slice(),reset:a}}function Su(i,e,a,h,p,x=T=>T()){const T=h&&(h.enterCallbacks[p]=h.enterCallbacks[p]||[]);return()=>new Promise((P,o)=>{const z=Q=>{Q===!1?o(tm(4,{from:a,to:e})):Q instanceof Error?o(Q):VL(Q)?o(tm(2,{from:e,to:Q})):(T&&h.enterCallbacks[p]===T&&typeof Q=="function"&&T.push(Q),P())},$=x(()=>i.call(h&&h.instances[p],e,a,z));let q=Promise.resolve($);i.length<3&&(q=q.then(z)),q.catch(Q=>o(Q))})}function mv(i,e,a,h,p=x=>x()){const x=[];for(const T of i)for(const P in T.components){let o=T.components[P];if(!(e!=="beforeRouteEnter"&&!T.instances[P]))if(EM(o)){const $=(o.__vccOpts||o)[e];$&&x.push(Su($,a,h,T,P,p))}else{let z=o();x.push(()=>z.then($=>{if(!$)throw new Error(`Couldn't resolve component "${P}" at "${T.path}"`);const q=uL($)?$.default:$;T.mods[P]=$,T.components[P]=q;const nt=(q.__vccOpts||q)[e];return nt&&Su(nt,a,h,T,P,p)()}))}}return x}function aT(i){const e=Ua(jb),a=Ua(Ub),h=Jr(()=>{const o=hh(i.to);return e.resolve(o)}),p=Jr(()=>{const{matched:o}=h.value,{length:z}=o,$=o[z-1],q=a.matched;if(!$||!q.length)return-1;const Q=q.findIndex(Qp.bind(null,$));if(Q>-1)return Q;const nt=lT(o[z-2]);return z>1&&lT($)===nt&&q[q.length-1].path!==nt?q.findIndex(Qp.bind(null,o[z-2])):Q}),x=Jr(()=>p.value>-1&&cD(a.params,h.value.params)),T=Jr(()=>p.value>-1&&p.value===a.matched.length-1&&IM(a.params,h.value.params));function P(o={}){if(lD(o)){const z=e[hh(i.replace)?"replace":"push"](hh(i.to)).catch(Dg);return i.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>z),z}return Promise.resolve()}return{route:h,href:Jr(()=>h.value.href),isActive:x,isExactActive:T,navigate:P}}function rD(i){return i.length===1?i[0]:i}const oD=bo({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:aT,setup(i,{slots:e}){const a=rm(aT(i)),{options:h}=Ua(jb),p=Jr(()=>({[cT(i.activeClass,h.linkActiveClass,"router-link-active")]:a.isActive,[cT(i.exactActiveClass,h.linkExactActiveClass,"router-link-exact-active")]:a.isExactActive}));return()=>{const x=e.default&&rD(e.default(a));return i.custom?x:Nx("a",{"aria-current":a.isExactActive?i.ariaCurrentValue:null,href:a.href,onClick:a.navigate,class:p.value},x)}}}),aD=oD;function lD(i){if(!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)&&!i.defaultPrevented&&!(i.button!==void 0&&i.button!==0)){if(i.currentTarget&&i.currentTarget.getAttribute){const e=i.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return i.preventDefault&&i.preventDefault(),!0}}function cD(i,e){for(const a in e){const h=e[a],p=i[a];if(typeof h=="string"){if(h!==p)return!1}else if(!Tl(p)||p.length!==h.length||h.some((x,T)=>x!==p[T]))return!1}return!0}function lT(i){return i?i.aliasOf?i.aliasOf.path:i.path:""}const cT=(i,e,a)=>i??e??a,hD=bo({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(i,{attrs:e,slots:a}){const h=Ua(Jv),p=Jr(()=>i.route||h.value),x=Ua(oT,0),T=Jr(()=>{let z=hh(x);const{matched:$}=p.value;let q;for(;(q=$[z])&&!q.components;)z++;return z}),P=Jr(()=>p.value.matched[T.value]);Pg(oT,Jr(()=>T.value+1)),Pg(nD,P),Pg(Jv,p);const o=Bs();return ya(()=>[o.value,P.value,i.name],([z,$,q],[Q,nt,Tt])=>{$&&($.instances[q]=z,nt&&nt!==$&&z&&z===Q&&($.leaveGuards.size||($.leaveGuards=nt.leaveGuards),$.updateGuards.size||($.updateGuards=nt.updateGuards))),z&&$&&(!nt||!Qp($,nt)||!Q)&&($.enterCallbacks[q]||[]).forEach(yt=>yt(z))},{flush:"post"}),()=>{const z=p.value,$=i.name,q=P.value,Q=q&&q.components[$];if(!Q)return hT(a.default,{Component:Q,route:z});const nt=q.props[$],Tt=nt?nt===!0?z.params:typeof nt=="function"?nt(z):nt:null,Lt=Nx(Q,Qs({},Tt,e,{onVnodeUnmounted:Nt=>{Nt.component.isUnmounted&&(q.instances[$]=null)},ref:o}));return hT(a.default,{Component:Lt,route:z})||Lt}}});function hT(i,e){if(!i)return null;const a=i(e);return a.length===1?a[0]:a}const uD=hD;function dD(i){const e=KL(i.routes,i),a=i.parseQuery||iD,h=i.stringifyQuery||rT,p=i.history,x=fg(),T=fg(),P=fg(),o=bb(_u);let z=_u;Rp&&i.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const $=fv.bind(null,Me=>""+Me),q=fv.bind(null,SL),Q=fv.bind(null,Zg);function nt(Me,ci){let ni,_i;return DM(Me)?(ni=e.getRecordMatcher(Me),_i=ci):_i=Me,e.addRoute(_i,ni)}function Tt(Me){const ci=e.getRecordMatcher(Me);ci&&e.removeRoute(ci)}function yt(){return e.getRoutes().map(Me=>Me.record)}function Lt(Me){return!!e.getRecordMatcher(Me)}function Nt(Me,ci){if(ci=Qs({},ci||o.value),typeof Me=="string"){const zt=pv(a,Me,ci.path),fe=e.resolve({path:zt.path},ci),Se=p.createHref(zt.fullPath);return Qs(zt,fe,{params:Q(fe.params),hash:Zg(zt.hash),redirectedFrom:void 0,href:Se})}let ni;if(Me.path!=null)ni=Qs({},Me,{path:pv(a,Me.path,ci.path).path});else{const zt=Qs({},Me.params);for(const fe in zt)zt[fe]==null&&delete zt[fe];ni=Qs({},Me,{params:q(zt)}),ci.params=q(ci.params)}const _i=e.resolve(ni,ci),ss=Me.hash||"";_i.params=$(Q(_i.params));const xi=AL(h,Qs({},Me,{hash:bL(ss),path:_i.path})),_t=p.createHref(xi);return Qs({fullPath:xi,hash:ss,query:h===rT?sD(Me.query):Me.query||{}},_i,{redirectedFrom:void 0,href:_t})}function Dt(Me){return typeof Me=="string"?pv(a,Me,o.value.path):Qs({},Me)}function wt(Me,ci){if(z!==Me)return tm(8,{from:ci,to:Me})}function It(Me){return re(Me)}function Xt(Me){return It(Qs(Dt(Me),{replace:!0}))}function Zt(Me){const ci=Me.matched[Me.matched.length-1];if(ci&&ci.redirect){const{redirect:ni}=ci;let _i=typeof ni=="function"?ni(Me):ni;return typeof _i=="string"&&(_i=_i.includes("?")||_i.includes("#")?_i=Dt(_i):{path:_i},_i.params={}),Qs({query:Me.query,hash:Me.hash,params:_i.path!=null?{}:Me.params},_i)}}function re(Me,ci){const ni=z=Nt(Me),_i=o.value,ss=Me.state,xi=Me.force,_t=Me.replace===!0,zt=Zt(ni);if(zt)return re(Qs(Dt(zt),{state:typeof zt=="object"?Qs({},ss,zt.state):ss,force:xi,replace:_t}),ci||ni);const fe=ni;fe.redirectedFrom=ci;let Se;return!xi&&CL(h,_i,ni)&&(Se=tm(16,{to:fe,from:_i}),hs(_i,_i,!0,!1)),(Se?Promise.resolve(Se):Ut(fe,_i)).catch(be=>th(be)?th(be,2)?be:Ns(be):fi(be,fe,_i)).then(be=>{if(be){if(th(be,2))return re(Qs({replace:_t},Dt(be.to),{state:typeof be.to=="object"?Qs({},ss,be.to.state):ss,force:xi}),ci||fe)}else be=ye(fe,_i,!0,_t,ss);return Le(fe,_i,be),be})}function kt(Me,ci){const ni=wt(Me,ci);return ni?Promise.reject(ni):Promise.resolve()}function ne(Me){const ci=Ji.values().next().value;return ci&&typeof ci.runWithContext=="function"?ci.runWithContext(Me):Me()}function Ut(Me,ci){let ni;const[_i,ss,xi]=fD(Me,ci);ni=mv(_i.reverse(),"beforeRouteLeave",Me,ci);for(const zt of _i)zt.leaveGuards.forEach(fe=>{ni.push(Su(fe,Me,ci))});const _t=kt.bind(null,Me,ci);return ni.push(_t),Ds(ni).then(()=>{ni=[];for(const zt of x.list())ni.push(Su(zt,Me,ci));return ni.push(_t),Ds(ni)}).then(()=>{ni=mv(ss,"beforeRouteUpdate",Me,ci);for(const zt of ss)zt.updateGuards.forEach(fe=>{ni.push(Su(fe,Me,ci))});return ni.push(_t),Ds(ni)}).then(()=>{ni=[];for(const zt of xi)if(zt.beforeEnter)if(Tl(zt.beforeEnter))for(const fe of zt.beforeEnter)ni.push(Su(fe,Me,ci));else ni.push(Su(zt.beforeEnter,Me,ci));return ni.push(_t),Ds(ni)}).then(()=>(Me.matched.forEach(zt=>zt.enterCallbacks={}),ni=mv(xi,"beforeRouteEnter",Me,ci,ne),ni.push(_t),Ds(ni))).then(()=>{ni=[];for(const zt of T.list())ni.push(Su(zt,Me,ci));return ni.push(_t),Ds(ni)}).catch(zt=>th(zt,8)?zt:Promise.reject(zt))}function Le(Me,ci,ni){P.list().forEach(_i=>ne(()=>_i(Me,ci,ni)))}function ye(Me,ci,ni,_i,ss){const xi=wt(Me,ci);if(xi)return xi;const _t=ci===_u,zt=Rp?history.state:{};ni&&(_i||_t?p.replace(Me.fullPath,Qs({scroll:_t&&zt&&zt.scroll},ss)):p.push(Me.fullPath,ss)),o.value=Me,hs(Me,ci,ni,_t),Ns()}let Ce;function di(){Ce||(Ce=p.listen((Me,ci,ni)=>{if(!Tn.listening)return;const _i=Nt(Me),ss=Zt(_i);if(ss){re(Qs(ss,{replace:!0,force:!0}),_i).catch(Dg);return}z=_i;const xi=o.value;Rp&&RL(Yw(xi.fullPath,ni.delta),Ux()),Ut(_i,xi).catch(_t=>th(_t,12)?_t:th(_t,2)?(re(Qs(Dt(_t.to),{force:!0}),_i).then(zt=>{th(zt,20)&&!ni.delta&&ni.type===Yg.pop&&p.go(-1,!1)}).catch(Dg),Promise.reject()):(ni.delta&&p.go(-ni.delta,!1),fi(_t,_i,xi))).then(_t=>{_t=_t||ye(_i,xi,!1),_t&&(ni.delta&&!th(_t,8)?p.go(-ni.delta,!1):ni.type===Yg.pop&&th(_t,20)&&p.go(-1,!1)),Le(_i,xi,_t)}).catch(Dg)}))}let Ti=fg(),Ge=fg(),li;function fi(Me,ci,ni){Ns(Me);const _i=Ge.list();return _i.length?_i.forEach(ss=>ss(Me,ci,ni)):console.error(Me),Promise.reject(Me)}function pi(){return li&&o.value!==_u?Promise.resolve():new Promise((Me,ci)=>{Ti.add([Me,ci])})}function Ns(Me){return li||(li=!Me,di(),Ti.list().forEach(([ci,ni])=>Me?ni(Me):ci()),Ti.reset()),Me}function hs(Me,ci,ni,_i){const{scrollBehavior:ss}=i;if(!Rp||!ss)return Promise.resolve();const xi=!ni&&BL(Yw(Me.fullPath,0))||(_i||!ni)&&history.state&&history.state.scroll||null;return Sf().then(()=>ss(Me,ci,xi)).then(_t=>_t&&OL(_t)).catch(_t=>fi(_t,Me,ci))}const Yi=Me=>p.go(Me);let Zs;const Ji=new Set,Tn={currentRoute:o,listening:!0,addRoute:nt,removeRoute:Tt,clearRoutes:e.clearRoutes,hasRoute:Lt,getRoutes:yt,resolve:Nt,options:i,push:It,replace:Xt,go:Yi,back:()=>Yi(-1),forward:()=>Yi(1),beforeEach:x.add,beforeResolve:T.add,afterEach:P.add,onError:Ge.add,isReady:pi,install(Me){const ci=this;Me.component("RouterLink",aD),Me.component("RouterView",uD),Me.config.globalProperties.$router=ci,Object.defineProperty(Me.config.globalProperties,"$route",{enumerable:!0,get:()=>hh(o)}),Rp&&!Zs&&o.value===_u&&(Zs=!0,It(p.location).catch(ss=>{}));const ni={};for(const ss in _u)Object.defineProperty(ni,ss,{get:()=>o.value[ss],enumerable:!0});Me.provide(jb,ci),Me.provide(Ub,xb(ni)),Me.provide(Jv,o);const _i=Me.unmount;Ji.add(Me),Me.unmount=function(){Ji.delete(Me),Ji.size<1&&(z=_u,Ce&&Ce(),Ce=null,o.value=_u,Zs=!1,li=!1),_i()}}};function Ds(Me){return Me.reduce((ci,ni)=>ci.then(()=>ne(ni)),Promise.resolve())}return Tn}function fD(i,e){const a=[],h=[],p=[],x=Math.max(e.matched.length,i.matched.length);for(let T=0;T<x;T++){const P=e.matched[T];P&&(i.matched.find(z=>Qp(z,P))?h.push(P):a.push(P));const o=i.matched[T];o&&(e.matched.find(z=>Qp(z,o))||p.push(o))}return[a,h,p]}function pD(i){return Ua(Ub)}const mD={class:"app-container"},gD={class:"navbar"},_D={key:0,class:"geoportal-title"},yD={class:"navbar-links"},xD={class:"view-container"},vD=bo({__name:"Layout",setup(i){const e=pD(),a=Jr(()=>e.path!=="/");return(h,p)=>{const x=tx("router-link"),T=tx("router-view");return qi(),cs("div",mD,[Ye("nav",gD,[fs(x,{to:"/",class:"logo-group","aria-label":"Home"},{default:Fa(()=>[p[0]||(p[0]=Ye("img",{src:Fb,alt:"Donor Logo",class:"logo-dgis"},null,-1)),p[1]||(p[1]=Ye("img",{src:SM,alt:"Soil Values Logo",class:"logo-sv"},null,-1)),a.value?(qi(),cs("span",_D,"Soil Values Geoportal")):Ba("",!0)]),_:1}),Ye("div",yD,[fs(x,{to:"/",class:"nav-link"},{default:Fa(()=>p[2]||(p[2]=[Na("Home")])),_:1}),fs(x,{to:"/dashboard",class:"nav-link"},{default:Fa(()=>p[3]||(p[3]=[Na("Map")])),_:1}),fs(x,{to:"/monitoring",class:"nav-link"},{default:Fa(()=>p[4]||(p[4]=[Na("M&E Dashboard")])),_:1}),fs(x,{to:"/catalog",class:"nav-link"},{default:Fa(()=>p[5]||(p[5]=[Na("Catalog")])),_:1}),fs(x,{to:"/about",class:"nav-link"},{default:Fa(()=>p[6]||(p[6]=[Na("About")])),_:1})])]),Ye("div",xD,[fs(T)])])}}}),Ha=(i,e)=>{const a=i.__vccOpts||i;for(const[h,p]of e)a[h]=p;return a},bD=Ha(vD,[["__scopeId","data-v-7373cfba"]]),wD={id:"app"},TD=bo({__name:"App",setup(i){return(e,a)=>(qi(),cs("div",wD,[fs(bD)]))}}),BM="/projects/soil_values/assets/ifdc_logo-C0Phf9Dr.png",FM="/projects/soil_values/assets/WUR_logo-Ds7IIsIR.png",NM="/projects/soil_values/assets/SNV_logo_2-LRpPKBkz.png",jM="/projects/soil_values/assets/AGRA_logo-BuD40XdR.webp",UM="/projects/soil_values/assets/IITA_logo-DW09z6CA.png",VM="/projects/soil_values/assets/IWMI_logo-B-LuUFd5.jpg",$M="/projects/soil_values/assets/ISRIC_logo-Cx1mKsJo.webp",GM="/projects/soil_values/assets/CIFOR-ICRAF-logo-CA2wt9fE.webp",SD={class:"home-container"},ED={class:"landing-content"},MD=bo({__name:"HomeView",setup(i){return(e,a)=>{const h=tx("router-link");return qi(),cs("div",SD,[Ye("div",ED,[a[1]||(a[1]=Fx('<div class="top-logos fade-slide" data-v-3671cfce><a href="https://www.government.nl/ministries/ministry-of-foreign-affairs" target="_blank" rel="noopener" data-v-3671cfce><img src="'+Fb+'" alt="DGIS Logo" class="logo donor-logo" data-v-3671cfce></a><a href="https://ifdc.org/soil-values" target="_blank" rel="noopener" data-v-3671cfce><img src="'+SM+'" alt="Soil Values Logo" class="logo main-logo" data-v-3671cfce></a></div><h1 class="fade-slide" data-v-3671cfce>Soil Values Geoportal</h1><div class="landing-text fade-slide" style="animation-delay:0.3s;" data-v-3671cfce><p data-v-3671cfce> Welcome to the Soil Values Geoportal, your gateway to dynamic, data-driven insights for landscape restoration and sustainable land management. </p><p data-v-3671cfce> Explore real-time maps and analytics on land cover, soil health, crops, and climate to inform impactful decisions across our intervention areas. </p></div><div class="logos-grid" data-v-3671cfce><div class="logo-row fade-slide" style="animation-delay:0.6s;" data-v-3671cfce><a href="https://ifdc.org" target="_blank" rel="noopener" data-v-3671cfce><img src="'+BM+'" alt="IFDC" data-v-3671cfce></a><a href="https://wur.nl" target="_blank" rel="noopener" data-v-3671cfce><img src="'+FM+'" alt="WUR" data-v-3671cfce></a><a href="https://snv.org" target="_blank" rel="noopener" data-v-3671cfce><img src="'+NM+'" alt="SNV" data-v-3671cfce></a></div><div class="logo-row fade-slide" style="animation-delay:0.9s;" data-v-3671cfce><a href="https://agra.org" target="_blank" rel="noopener" data-v-3671cfce><img src="'+jM+'" alt="AGRA" data-v-3671cfce></a><a href="https://www.iita.org" target="_blank" rel="noopener" data-v-3671cfce><img src="'+UM+'" alt="IITA" data-v-3671cfce></a><a href="https://www.iwmi.cgiar.org" target="_blank" rel="noopener" data-v-3671cfce><img src="'+VM+'" alt="IWMI" class="logo-iwmi" data-v-3671cfce></a><a href="https://www.isric.org" target="_blank" rel="noopener" data-v-3671cfce><img src="'+$M+'" alt="ISRIC" data-v-3671cfce></a><a href="https://www.cifor-icraf.org" target="_blank" rel="noopener" data-v-3671cfce><img src="'+GM+'" alt="CIFOR-ICRAF" data-v-3671cfce></a></div></div>',4)),fs(h,{to:"/dashboard",class:"launch-btn fade-slide",style:{"animation-delay":"1.2s"}},{default:Fa(()=>a[0]||(a[0]=[Na(" Launch ")])),_:1})])])}}}),AD=Ha(MD,[["__scopeId","data-v-3671cfce"]]);/*!
 * pinia v3.0.2
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let WM;const Vx=i=>WM=i,HM=Symbol();function Qv(i){return i&&typeof i=="object"&&Object.prototype.toString.call(i)==="[object Object]"&&typeof i.toJSON!="function"}var Og;(function(i){i.direct="direct",i.patchObject="patch object",i.patchFunction="patch function"})(Og||(Og={}));function CD(){const i=pb(!0),e=i.run(()=>Bs({}));let a=[],h=[];const p=Px({install(x){Vx(p),p._a=x,x.provide(HM,p),x.config.globalProperties.$pinia=p,h.forEach(T=>a.push(T)),h=[]},use(x){return this._a?a.push(x):h.push(x),this},_p:a,_a:null,_e:i,_s:new Map,state:e});return p}const XM=()=>{};function uT(i,e,a,h=XM){i.push(e);const p=()=>{const x=i.indexOf(e);x>-1&&(i.splice(x,1),h())};return!a&&mb()&&kS(p),p}function Lp(i,...e){i.slice().forEach(a=>{a(...e)})}const kD=i=>i(),dT=Symbol(),gv=Symbol();function tb(i,e){i instanceof Map&&e instanceof Map?e.forEach((a,h)=>i.set(h,a)):i instanceof Set&&e instanceof Set&&e.forEach(i.add,i);for(const a in e){if(!e.hasOwnProperty(a))continue;const h=e[a],p=i[a];Qv(p)&&Qv(h)&&i.hasOwnProperty(a)&&!Un(h)&&!mc(h)?i[a]=tb(p,h):i[a]=h}return i}const PD=Symbol();function ID(i){return!Qv(i)||!Object.prototype.hasOwnProperty.call(i,PD)}const{assign:xu}=Object;function LD(i){return!!(Un(i)&&i.effect)}function DD(i,e,a,h){const{state:p,actions:x,getters:T}=e,P=a.state.value[i];let o;function z(){P||(a.state.value[i]=p?p():{});const $=XS(a.state.value[i]);return xu($,x,Object.keys(T||{}).reduce((q,Q)=>(q[Q]=Px(Jr(()=>{Vx(a);const nt=a._s.get(i);return T[Q].call(nt,nt)})),q),{}))}return o=qM(i,z,e,a,h,!0),o}function qM(i,e,a={},h,p,x){let T;const P=xu({actions:{}},a),o={deep:!0};let z,$,q=[],Q=[],nt;const Tt=h.state.value[i];!x&&!Tt&&(h.state.value[i]={}),Bs({});let yt;function Lt(kt){let ne;z=$=!1,typeof kt=="function"?(kt(h.state.value[i]),ne={type:Og.patchFunction,storeId:i,events:nt}):(tb(h.state.value[i],kt),ne={type:Og.patchObject,payload:kt,storeId:i,events:nt});const Ut=yt=Symbol();Sf().then(()=>{yt===Ut&&(z=!0)}),$=!0,Lp(q,ne,h.state.value[i])}const Nt=x?function(){const{state:ne}=a,Ut=ne?ne():{};this.$patch(Le=>{xu(Le,Ut)})}:XM;function Dt(){T.stop(),q=[],Q=[],h._s.delete(i)}const wt=(kt,ne="")=>{if(dT in kt)return kt[gv]=ne,kt;const Ut=function(){Vx(h);const Le=Array.from(arguments),ye=[],Ce=[];function di(li){ye.push(li)}function Ti(li){Ce.push(li)}Lp(Q,{args:Le,name:Ut[gv],store:Xt,after:di,onError:Ti});let Ge;try{Ge=kt.apply(this&&this.$id===i?this:Xt,Le)}catch(li){throw Lp(Ce,li),li}return Ge instanceof Promise?Ge.then(li=>(Lp(ye,li),li)).catch(li=>(Lp(Ce,li),Promise.reject(li))):(Lp(ye,Ge),Ge)};return Ut[dT]=!0,Ut[gv]=ne,Ut},It={_p:h,$id:i,$onAction:uT.bind(null,Q),$patch:Lt,$reset:Nt,$subscribe(kt,ne={}){const Ut=uT(q,kt,ne.detached,()=>Le()),Le=T.run(()=>ya(()=>h.state.value[i],ye=>{(ne.flush==="sync"?$:z)&&kt({storeId:i,type:Og.direct,events:nt},ye)},xu({},o,ne)));return Ut},$dispose:Dt},Xt=rm(It);h._s.set(i,Xt);const re=(h._a&&h._a.runWithContext||kD)(()=>h._e.run(()=>(T=pb()).run(()=>e({action:wt}))));for(const kt in re){const ne=re[kt];if(Un(ne)&&!LD(ne)||mc(ne))x||(Tt&&ID(ne)&&(Un(ne)?ne.value=Tt[kt]:tb(ne,Tt[kt])),h.state.value[i][kt]=ne);else if(typeof ne=="function"){const Ut=wt(ne,kt);re[kt]=Ut,P.actions[kt]=ne}}return xu(Xt,re),xu(Cs(Xt),re),Object.defineProperty(Xt,"$state",{get:()=>h.state.value[i],set:kt=>{Lt(ne=>{xu(ne,kt)})}}),h._p.forEach(kt=>{xu(Xt,T.run(()=>kt({store:Xt,app:h._a,pinia:h,options:P})))}),Tt&&x&&a.hydrate&&a.hydrate(Xt.$state,Tt),z=!0,$=!0,Xt}/*! #__NO_SIDE_EFFECTS__ */function zD(i,e,a){let h;const p=typeof e=="function";h=p?a:e;function x(T,P){const o=bE();return T=T||(o?Ua(HM,null):null),T&&Vx(T),T=WM,T._s.has(i)||(p?qM(i,e,h,T):DD(i,h,T)),T._s.get(i)}return x.$id=i,x}var ZM=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function YM(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function OD(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var a=function h(){return this instanceof h?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};a.prototype=e.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(i).forEach(function(h){var p=Object.getOwnPropertyDescriptor(i,h);Object.defineProperty(a,h,p.get?p:{enumerable:!0,get:function(){return i[h]}})}),a}var KM={exports:{}};(function(i,e){var a={};(function(h,p){i.exports=p()})(ZM,function(){var h,p,x;function T(o,z){if(!h)h=z;else if(!p)p=z;else{var $="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+h+")(sharedChunk); ("+p+")(sharedChunk); self.onerror = null;",q={};h(q),x=z(q),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(x.workerUrl=window.URL.createObjectURL(new Blob([$],{type:"text/javascript"})))}}T(["exports"],function(o){var z=typeof self<"u"?self:{},$="2.15.0";let q;const Q={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(q==null){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{q=a.API_URL_REGEX!=null?new RegExp(a.API_URL_REGEX):s}catch{q=s}}return q},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Q.API_URL)return null;try{const s=new URL(Q.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},nt={supported:!1,testSupport:function(s){!Lt&&yt&&(Nt?Dt(s):Tt=s)}};let Tt,yt,Lt=!1,Nt=!1;function Dt(s){const t=s.createTexture();s.bindTexture(s.TEXTURE_2D,t);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,yt),s.isContextLost())return;nt.supported=!0}catch{}s.deleteTexture(t),Lt=!0}z.document&&(yt=z.document.createElement("img"),yt.onload=function(){Tt&&Dt(Tt),Tt=null,Nt=!0},yt.onerror=function(){Lt=!0,Tt=null},yt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const wt="01";function It(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Xt=Zt;function Zt(s,t,n,c){this.cx=3*s,this.bx=3*(n-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(c-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=t,this.p2x=n,this.p2y=c}Zt.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,t){if(t===void 0&&(t=1e-6),s<0)return 0;if(s>1)return 1;for(var n=s,c=0;c<8;c++){var d=this.sampleCurveX(n)-s;if(Math.abs(d)<t)return n;var _=this.sampleCurveDerivativeX(n);if(Math.abs(_)<1e-6)break;n-=d/_}var v=0,E=1;for(n=s,c=0;c<20&&(d=this.sampleCurveX(n),!(Math.abs(d-s)<t));c++)s>d?v=n:E=n,n=.5*(E-v)+v;return n},solve:function(s,t){return this.sampleCurveY(this.solveCurveX(s,t))}};var re=It(Xt),kt=ne;function ne(s,t){this.x=s,this.y=t}ne.prototype={clone:function(){return new ne(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,t){return this.clone()._rotateAround(s,t)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var t=s.x-this.x,n=s.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,t){return Math.atan2(this.x*t-this.y*s,this.x*s+this.y*t)},_matMult:function(s){var t=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=t,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var t=Math.cos(s),n=Math.sin(s),c=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=c,this},_rotateAround:function(s,t){var n=Math.cos(s),c=Math.sin(s),d=t.y+c*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-c*(this.y-t.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ne.convert=function(s){return s instanceof ne?s:Array.isArray(s)?new ne(s[0],s[1]):s};var Ut=It(kt);const Le=Math.PI/180,ye=180/Math.PI;function Ce(s){return s*Le}function di(s){return s*ye}const Ti=[[0,0],[1,0],[1,1],[0,1]];function Ge(s){if(s<=0)return 0;if(s>=1)return 1;const t=s*s,n=t*s;return 4*(s<.5?n:3*(s-t)+n-.75)}function li(s,t,n,c){const d=new re(s,t,n,c);return function(_){return d.solve(_)}}const fi=li(.25,.1,.25,1);function pi(s,t,n){return Math.min(n,Math.max(t,s))}function Ns(s,t,n){return(n=pi((n-s)/(t-s),0,1))*n*(3-2*n)}function hs(s,t,n){const c=n-t,d=((s-t)%c+c)%c+t;return d===t?n:d}function Yi(s,t,n){if(!s.length)return n(null,[]);let c=s.length;const d=new Array(s.length);let _=null;s.forEach((v,E)=>{t(v,(k,L)=>{k&&(_=k),d[E]=L,--c==0&&n(_,d)})})}function Zs(s){const t=[];for(const n in s)t.push(s[n]);return t}function Ji(s,...t){for(const n of t)for(const c in n)s[c]=n[c];return s}let Tn=1;function Ds(){return Tn++}function Me(){return function s(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function ci(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function ni(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function _i(s,t){s.forEach(n=>{t[n]&&(t[n]=t[n].bind(t))})}function ss(s,t){return s.indexOf(t,s.length-t.length)!==-1}function xi(s,t,n){const c={};for(const d in s)c[d]=t.call(this,s[d],d,s);return c}function _t(s,t,n){const c={};for(const d in s)t.call(n||this,s[d],d,s)&&(c[d]=s[d]);return c}function zt(s){return Array.isArray(s)?s.map(zt):typeof s=="object"&&s?xi(s,zt):s}const fe={};function Se(s){fe[s]||(typeof console<"u"&&console.warn(s),fe[s]=!0)}function be(s,t,n){return(n.y-s.y)*(t.x-s.x)>(t.y-s.y)*(n.x-s.x)}function Ue(s){let t=0;for(let n,c,d=0,_=s.length,v=_-1;d<_;v=d++)n=s[d],c=s[v],t+=(c.x-n.x)*(n.y+c.y);return t}function ei(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function We(s){const t={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,c,d,_)=>{const v=d||_;return t[c]=!v||v.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t}let Xe=null;function Ve(s){if(Xe==null){const t=s.navigator?s.navigator.userAgent:null;Xe=!!s.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Xe}function Ci(s){try{const t=z[s];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function ti(s,t){return[s[4*t],s[4*t+1],s[4*t+2],s[4*t+3]]}const wi="mapbox-tiles";let Pi=500,ts=50,es,ns;function zn(){try{return z.caches}catch{}}function tn(){zn()&&!es&&(es=z.caches.open(wi))}function Vn(s){const t=s.indexOf("?");if(t<0)return s;const n=function(d){const _=d.indexOf("?");return _>0?d.slice(_+1).split("&"):[]}(s),c=n.filter(d=>{const _=d.split("=");return _[0]==="language"||_[0]==="worldview"});return c.length?`${s.slice(0,t)}?${c.join("&")}`:s.slice(0,t)}let is=1/0;const fr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(fr);class to extends Error{constructor(t,n,c){n===401&&ie(c)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=n,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Sn=ei()?()=>self.worker&&self.worker.referrer:()=>(z.location.protocol==="blob:"?z.parent:z).location.href,$n=function(s,t){if(!(/^file:/.test(n=s.url)||/^file:/.test(Sn())&&!/^\w+:/.test(n))){if(z.fetch&&z.Request&&z.AbortController&&z.Request.prototype.hasOwnProperty("signal"))return function(c,d){const _=new z.AbortController,v=new z.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Sn(),referrerPolicy:c.referrerPolicy,signal:_.signal});let E=!1,k=!1;const L=(N=v.url).indexOf("sku=")>0&&ie(N);var N;c.type==="json"&&v.headers.set("Accept","application/json");const V=(Y,K,st)=>{if(k)return;if(Y&&Y.message!=="SecurityError"&&Se(Y.toString()),K&&st)return W(K);const ut=Date.now();z.fetch(v).then(vt=>{if(vt.ok){const Pt=L?vt.clone():null;return W(vt,Pt,ut)}return d(new to(vt.statusText,vt.status,c.url))}).catch(vt=>{vt.name!=="AbortError"&&d(new Error(`${vt.message} ${c.url}`))})},W=(Y,K,st)=>{(c.type==="arrayBuffer"?Y.arrayBuffer():c.type==="json"?Y.json():Y.text()).then(ut=>{k||(K&&st&&function(vt,Pt,bt){if(tn(),!es)return;const Ct={status:Pt.status,statusText:Pt.statusText,headers:new z.Headers};Pt.headers.forEach((he,oe)=>Ct.headers.set(oe,he));const Ft=We(Pt.headers.get("Cache-Control")||"");if(Ft["no-store"])return;Ft["max-age"]&&Ct.headers.set("Expires",new Date(bt+1e3*Ft["max-age"]).toUTCString());const Ot=Ct.headers.get("Expires");Ot&&(new Date(Ot).getTime()-bt<42e4||function(he,oe){if(ns===void 0)try{new Response(new ReadableStream),ns=!0}catch{ns=!1}ns?oe(he.body):he.blob().then(oe)}(Pt,he=>{const oe=new z.Response(he,Ct);tn(),es&&es.then(_e=>_e.put(Vn(vt.url),oe)).catch(_e=>Se(_e.message))}))}(v,K,st),E=!0,d(null,ut,Y.headers.get("Cache-Control"),Y.headers.get("Expires")))}).catch(ut=>{k||d(new Error(ut.message))})};return L?function(Y,K){if(tn(),!es)return K(null);const st=Vn(Y.url);es.then(ut=>{ut.match(st).then(vt=>{const Pt=function(bt){if(!bt)return!1;const Ct=new Date(bt.headers.get("Expires")||0),Ft=We(bt.headers.get("Cache-Control")||"");return Ct>Date.now()&&!Ft["no-cache"]}(vt);ut.delete(st),Pt&&ut.put(st,vt.clone()),K(null,vt,Pt)}).catch(K)}).catch(K)}(v,V):V(null,null),{cancel:()=>{k=!0,E||_.abort()}}}(s,t);if(ei()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,t,void 0,!0)}var n;return function(c,d){const _=new z.XMLHttpRequest;_.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(_.responseType="arraybuffer");for(const v in c.headers)_.setRequestHeader(v,c.headers[v]);return c.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=c.credentials==="include",_.onerror=()=>{d(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let v=_.response;if(c.type==="json")try{v=JSON.parse(_.response)}catch(E){return d(E)}d(null,v,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else d(new to(_.statusText,_.status,c.url))},_.send(c.body),{cancel:()=>_.abort()}}(s,t)},Yn=function(s,t){return $n(Ji(s,{type:"arrayBuffer"}),t)};function El(s){const t=z.document.createElement("a");return t.href=s,t.protocol===z.document.location.protocol&&t.host===z.document.location.host}const At="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let at,lt;at=[],lt=0;const Mt=function(s,t){if(nt.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),lt>=Q.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:s,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return at.push(_),_}lt++;let n=!1;const c=()=>{if(!n)for(n=!0,lt--;at.length&&lt<Q.MAX_PARALLEL_IMAGE_REQUESTS;){const _=at.shift(),{requestParameters:v,callback:E,cancelled:k}=_;k||(_.cancel=Mt(v,E).cancel)}},d=Yn(s,(_,v,E,k)=>{c(),_?t(_):v&&(z.createImageBitmap?function(L,N){const V=new z.Blob([new Uint8Array(L)],{type:"image/png"});z.createImageBitmap(V).then(W=>{N(null,W)}).catch(W=>{N(new Error(`Could not load image because of ${W.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(L,N)=>t(L,N,E,k)):function(L,N){const V=new z.Image,W=z.URL;V.onload=()=>{N(null,V),W.revokeObjectURL(V.src),V.onload=null,z.requestAnimationFrame(()=>{V.src=At})},V.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Y=new z.Blob([new Uint8Array(L)],{type:"image/png"});V.src=L.byteLength?W.createObjectURL(Y):At}(v,(L,N)=>t(L,N,E,k)))});return{cancel:()=>{d.cancel(),c()}}},jt="NO_ACCESS_TOKEN";function Wt(s){return s.indexOf("mapbox:")===0}function ie(s){return Q.API_URL_REGEX.test(s)}function te(s){return Q.API_CDN_URL_REGEX.test(s)}function qt(s){return Q.API_STYLE_REGEX.test(s)&&!Qt(s)}function Qt(s){return Q.API_SPRITE_REGEX.test(s)}const Fe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function He(s){const t=s.match(Fe);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ze(s){const t=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${t}`}const Di="mapbox.eventData";function Ei(s){if(!s)return null;const t=s.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(z.atob(t[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class zi{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=Ei(Q.ACCESS_TOKEN);let c="";return c=n&&n.u?z.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(d,_)=>String.fromCharCode(+("0x"+_)))):Q.ACCESS_TOKEN||"",t?`${Di}.${t}:${c}`:`${Di}:${c}`}fetchEventData(){const t=Ci("localStorage"),n=this.getStorageKey(),c=this.getStorageKey("uuid");if(t)try{const d=z.localStorage.getItem(n);d&&(this.eventData=JSON.parse(d));const _=z.localStorage.getItem(c);_&&(this.anonId=_)}catch{Se("Unable to read from LocalStorage")}}saveEventData(){const t=Ci("localStorage"),n=this.getStorageKey(),c=this.getStorageKey("uuid");if(t)try{z.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&z.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Se("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,c,d){if(!Q.EVENTS_URL)return;const _=He(Q.EVENTS_URL);_.params.push(`access_token=${d||Q.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(t).toISOString()},E=n?Ji(v,n):v,k={url:ze(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([E])};this.pendingRequest=function(L,N){return $n(Ji(L,{method:"POST"}),N)}(k,L=>{this.pendingRequest=null,c(L),this.saveEventData(),this.processRequests(d)})}queueRequest(t,n){this.queue.push(t),this.processRequests(n)}}const Xi=new class extends zi{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,t){Q.EVENTS_URL&&Q.ACCESS_TOKEN&&Array.isArray(s)&&s.some(n=>Wt(n)||ie(n))&&this.queueRequest(Date.now(),t)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Ei(Q.ACCESS_TOKEN),n=t?t.u:Q.ACCESS_TOKEN;let c=n!==this.eventData.tokenU;ni(this.anonId)||(this.anonId=Me(),c=!0);const d=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),v=new Date(d),E=(d-this.eventData.lastSuccess)/864e5;c=c||E>=1||E<-1||_.getDate()!==v.getDate()}else c=!0;c?this.postEvent(d,{sdkIdentifier:"mapbox-gl-js",sdkVersion:$,skuId:wt,"enabled.telemetry":!1,userId:this.anonId},_=>{_||(this.eventData.lastSuccess=d,this.eventData.tokenU=n)},s):this.processRequests()}},Qi=Xi.postTurnstileEvent.bind(Xi),en=new class extends zi{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,t,n,c){this.skuToken=t,this.errorCb=c,Q.EVENTS_URL&&(n||Q.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},n):this.errorCb(new Error(jt)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),ni(this.anonId)||(this.anonId=Me()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:$,skuId:wt,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},s))}},an=en.postMapLoadEvent.bind(en),Kn=new class extends zi{constructor(){super("gljs.performance")}postPerformanceEvent(s,t){Q.EVENTS_URL&&(s||Q.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},s)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:n}=this.queue.shift(),c=function(d){const _=z.performance.getEntriesByType("resource"),v=z.performance.getEntriesByType("mark"),E=function(W){const Y={};if(W){for(const K in W)if(K!=="other")for(const st of W[K]){const ut=`${K}ResolveRangeMin`,vt=`${K}ResolveRangeMax`,Pt=`${K}RequestCount`,bt=`${K}RequestCachedCount`;Y[ut]=Math.min(Y[ut]||1/0,st.startTime),Y[vt]=Math.max(Y[vt]||-1/0,st.responseEnd);const Ct=Ft=>{Y[Ft]===void 0&&(Y[Ft]=0),++Y[Ft]};st.transferSize!==void 0&&st.transferSize===0&&Ct(bt),Ct(Pt)}}return Y}(function(W,Y){const K={};if(W)for(const st of W){const ut=Y(st);K[ut]===void 0&&(K[ut]=[]),K[ut].push(st)}return K}(_,Mf)),k=z.devicePixelRatio,L=z.navigator.connection||z.navigator.mozConnection||z.navigator.webkitConnection,N={counters:[],metadata:[],attributes:[]},V=(W,Y,K)=>{K!=null&&W.push({name:Y,value:K.toString()})};for(const W in E)V(N.counters,W,E[W]);if(d.interactionRange[0]!==1/0&&d.interactionRange[1]!==-1/0&&(V(N.counters,"interactionRangeMin",d.interactionRange[0]),V(N.counters,"interactionRangeMax",d.interactionRange[1])),v)for(const W of Object.keys(mn)){const Y=mn[W],K=v.find(st=>st.name===Y);K&&V(N.counters,Y,K.startTime)}return V(N.counters,"visibilityHidden",d.visibilityHidden),V(N.attributes,"style",function(W){if(W)for(const Y of W){const K=Y.name.split("?")[0];if(qt(K)){const st=K.split("/").slice(-2);if(st.length===2)return`mapbox://styles/${st[0]}/${st[1]}`}}}(_)),V(N.attributes,"terrainEnabled",d.terrainEnabled?"true":"false"),V(N.attributes,"fogEnabled",d.fogEnabled?"true":"false"),V(N.attributes,"projection",d.projection),V(N.attributes,"zoom",d.zoom),V(N.metadata,"devicePixelRatio",k),V(N.metadata,"connectionEffectiveType",L?L.effectiveType:void 0),V(N.metadata,"navigatorUserAgent",z.navigator.userAgent),V(N.metadata,"screenWidth",z.screen.width),V(N.metadata,"screenHeight",z.screen.height),V(N.metadata,"windowWidth",z.innerWidth),V(N.metadata,"windowHeight",z.innerHeight),V(N.metadata,"mapWidth",d.width/k),V(N.metadata,"mapHeight",d.height/k),V(N.metadata,"webglRenderer",d.renderer),V(N.metadata,"webglVendor",d.vendor),V(N.metadata,"sdkVersion",$),V(N.metadata,"sdkIdentifier","mapbox-gl-js"),N}(n);for(const d of c.metadata);for(const d of c.counters);for(const d of c.attributes);this.postEvent(t,c,()=>{},s)}},Pn=Kn.postPerformanceEvent.bind(Kn),wo=new class extends zi{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,t,n,c){if(!Q.API_URL||!Q.SESSION_PATH)return;const d=He(Q.API_URL+Q.SESSION_PATH);d.params.push(`sku=${t||""}`),d.params.push(`access_token=${c||Q.ACCESS_TOKEN||""}`);const _={url:ze(d),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(v,E){return $n(Ji(v,{method:"GET"}),E)}(_,v=>{this.pendingRequest=null,n(v),this.saveEventData(),this.processRequests(c)})}getSessionAPI(s,t,n,c){this.skuToken=t,this.errorCb=c,Q.SESSION_PATH&&Q.API_URL&&(n||Q.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},n):this.errorCb(new Error(jt)))}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},s)}},In=wo.getSessionAPI.bind(wo),er=new Set,mn={create:"create",load:"load",fullLoad:"fullLoad"},Ef={mark(s){z.performance.mark(s)},measure(s,t,n){z.performance.measure(s,t,n)}};function Mf(s){const t=s.name.split("?")[0];return te(t)&&t.includes("mapbox-gl.js")?"javascript":te(t)&&t.includes("mapbox-gl.css")?"css":function(n){return Q.API_FONTS_REGEX.test(n)}(t)?"fontRange":Qt(t)?"sprite":qt(t)?"style":function(n){return Q.API_TILEJSON_REGEX.test(n)}(t)?"tilejson":"other"}const ms=z.performance;function Nu(s){const t=s?s.url.toString():void 0;return ms.getEntriesByName(t)}let yc,mh,gh,eo;const To={now:()=>gh!==void 0?gh:z.performance.now(),setNow(s){gh=s},restoreNow(){gh=void 0},frame(s){const t=z.requestAnimationFrame(s);return{cancel:()=>z.cancelAnimationFrame(t)}},getImageData(s,t=0){const{width:n,height:c}=s;eo||(eo=z.document.createElement("canvas"));const d=eo.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(n>eo.width||c>eo.height)&&(eo.width=n,eo.height=c),d.clearRect(-t,-t,n+2*t,c+2*t),d.drawImage(s,0,0,n,c),d.getImageData(-t,-t,n+2*t,c+2*t)},resolveURL:s=>(yc||(yc=z.document.createElement("a")),yc.href=s,yc.href),get devicePixelRatio(){return z.devicePixelRatio},get prefersReducedMotion(){return!!z.matchMedia&&(mh==null&&(mh=z.matchMedia("(prefers-reduced-motion: reduce)")),mh.matches)}};function ju(s,t,n){n[s]&&n[s].indexOf(t)!==-1||(n[s]=n[s]||[],n[s].push(t))}function xc(s,t,n){if(n&&n[s]){const c=n[s].indexOf(t);c!==-1&&n[s].splice(c,1)}}class So{constructor(t,n={}){Ji(this,n),this.type=t}}class qo extends So{constructor(t,n={}){super("error",Ji({error:t},n))}}class Is{on(t,n){return this._listeners=this._listeners||{},ju(t,n,this._listeners),this}off(t,n){return xc(t,n,this._listeners),xc(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},ju(t,n,this._oneTimeListeners),this):new Promise(c=>this.once(t,c))}fire(t,n){typeof t=="string"&&(t=new So(t,n||{}));const c=t.type;if(this.listens(c)){t.target=this;const d=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const E of d)E.call(this,t);const _=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const E of _)xc(c,E,this._oneTimeListeners),E.call(this,t);const v=this._eventedParent;v&&(Ji(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(t))}else t instanceof qo&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var pe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Eo(s,...t){for(const n of t)for(const c in n)s[c]=n[c];return s}function En(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Gn(s){if(Array.isArray(s))return s.map(Gn);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const t={};for(const n in s)t[n]=Gn(s[n]);return t}return En(s)}class Af extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}var Mo=Af;class _h{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[c,d]of n)this.bindings[c]=d}concat(t){return new _h(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var Cf=_h;const Ml={kind:"null"},Ke={kind:"number"},Ki={kind:"string"},Ui={kind:"boolean"},br={kind:"color"},Or={kind:"object"},Vi={kind:"value"},wr={kind:"collator"},ir={kind:"formatted"},io={kind:"resolvedImage"};function Rr(s,t){return{kind:"array",itemType:s,N:t}}function Ys(s){if(s.kind==="array"){const t=Ys(s.itemType);return typeof s.N=="number"?`array<${t}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${t}>`}return s.kind}const kf=[Ml,Ke,Ki,Ui,br,ir,Or,Rr(Vi),io];function so(s,t){if(t.kind==="error")return null;if(s.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!so(s.itemType,t.itemType))&&(typeof s.N!="number"||s.N===t.N))return null}else{if(s.kind===t.kind)return null;if(s.kind==="value"){for(const n of kf)if(!so(n,t))return null}}return`Expected ${Ys(s)} but found ${Ys(t)} instead.`}function xa(s,t){return t.some(n=>n.kind===s.kind)}function vc(s,t){return t.some(n=>n==="null"?s===null:n==="array"?Array.isArray(s):n==="object"?s&&!Array.isArray(s)&&typeof s=="object":n===typeof s)}var Uu,Vu={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Al(s){return(s=Math.round(s))<0?0:s>255?255:s}function Ao(s){return Al(s[s.length-1]==="%"?parseFloat(s)/100*255:parseInt(s))}function yh(s){return(t=s[s.length-1]==="%"?parseFloat(s)/100:parseFloat(s))<0?0:t>1?1:t;var t}function Zo(s,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?s+(t-s)*n*6:2*n<1?t:3*n<2?s+(t-s)*(2/3-n)*6:s}try{Uu={}.parseCSSColor=function(s){var t,n=s.replace(/ /g,"").toLowerCase();if(n in Vu)return Vu[n].slice();if(n[0]==="#")return n.length===4?(t=parseInt(n.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:n.length===7&&(t=parseInt(n.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var c=n.indexOf("("),d=n.indexOf(")");if(c!==-1&&d+1===n.length){var _=n.substr(0,c),v=n.substr(c+1,d-(c+1)).split(","),E=1;switch(_){case"rgba":if(v.length!==4)return null;E=yh(v.pop());case"rgb":return v.length!==3?null:[Ao(v[0]),Ao(v[1]),Ao(v[2]),E];case"hsla":if(v.length!==4)return null;E=yh(v.pop());case"hsl":if(v.length!==3)return null;var k=(parseFloat(v[0])%360+360)%360/360,L=yh(v[1]),N=yh(v[2]),V=N<=.5?N*(L+1):N+L-N*L,W=2*N-V;return[Al(255*Zo(W,V,k+1/3)),Al(255*Zo(W,V,k)),Al(255*Zo(W,V,k-1/3)),E];default:return null}}return null}}catch{}class Tr{constructor(t,n,c,d=1){this.r=t,this.g=n,this.b=c,this.a=d}static parse(t){if(!t)return;if(t instanceof Tr)return t;if(typeof t!="string")return;const n=Uu(t);return n?new Tr(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[t,n,c,d]=this.toArray();return`rgba(${Math.round(t)},${Math.round(n)},${Math.round(c)},${d})`}toArray(){const{r:t,g:n,b:c,a:d}=this;return d===0?[0,0,0,0]:[255*t/d,255*n/d,255*c/d,d]}toArray01(){const{r:t,g:n,b:c,a:d}=this;return d===0?[0,0,0,0]:[t/d,n/d,c/d,d]}toArray01PremultipliedAlpha(){const{r:t,g:n,b:c,a:d}=this;return[t,n,c,d]}}Tr.black=new Tr(0,0,0,1),Tr.white=new Tr(1,1,1,1),Tr.transparent=new Tr(0,0,0,0),Tr.red=new Tr(1,0,0,1),Tr.blue=new Tr(0,0,1,1);var gn=Tr;class $u{constructor(t,n,c){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class bc{constructor(t,n,c,d,_){this.text=t.normalize?t.normalize():t,this.image=n,this.scale=c,this.fontStack=d,this.textColor=_}}class Sr{constructor(t){this.sections=t}static fromString(t){return new Sr([new bc(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Sr?t:Sr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const n of this.sections){if(n.image){t.push(["image",n.image.name]);continue}t.push(n.text);const c={};n.fontStack&&(c["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(c["font-scale"]=n.scale),n.textColor&&(c["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(c)}return t}}class pr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new pr({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Gu(s,t,n,c){return typeof s=="number"&&s>=0&&s<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[s,t,n,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[s,t,n,c]:[s,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Er(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof gn||s instanceof $u||s instanceof Sr||s instanceof pr)return!0;if(Array.isArray(s)){for(const t of s)if(!Er(t))return!1;return!0}if(typeof s=="object"){for(const t in s)if(!Er(s[t]))return!1;return!0}return!1}function ln(s){if(s===null)return Ml;if(typeof s=="string")return Ki;if(typeof s=="boolean")return Ui;if(typeof s=="number")return Ke;if(s instanceof gn)return br;if(s instanceof $u)return wr;if(s instanceof Sr)return ir;if(s instanceof pr)return io;if(Array.isArray(s)){const t=s.length;let n;for(const c of s){const d=ln(c);if(n){if(n===d)continue;n=Vi;break}n=d}return Rr(n||Vi,t)}return Or}function Yo(s){const t=typeof s;return s===null?"":t==="string"||t==="number"||t==="boolean"?String(s):s instanceof gn||s instanceof Sr||s instanceof pr?s.toString():JSON.stringify(s)}class wc{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Er(t[1]))return n.error("invalid value");const c=t[1];let d=ln(c);const _=n.expectedType;return d.kind!=="array"||d.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(d=_),new wc(d,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof gn?["rgba"].concat(this.value.toArray()):this.value instanceof Sr?this.value.serialize():this.value}}var Ko=wc,Wn=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const xh={string:Ki,number:Ke,boolean:Ui,object:Or};class Wu{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let c,d=1;const _=t[0];if(_==="array"){let E,k;if(t.length>2){const L=t[1];if(typeof L!="string"||!(L in xh)||L==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);E=xh[L],d++}else E=Vi;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);k=t[2],d++}c=Rr(E,k)}else c=xh[_];const v=[];for(;d<t.length;d++){const E=n.parse(t[d],d,Vi);if(!E)return null;v.push(E)}return new Wu(c,v)}evaluate(t){for(let n=0;n<this.args.length;n++){const c=this.args[n].evaluate(t);if(!so(this.type,ln(c)))return c;if(n===this.args.length-1)throw new Wn(`Expected value to be of type ${Ys(this.type)}, but found ${Ys(ln(c))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,n=[t.kind];if(t.kind==="array"){const c=t.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){n.push(c.kind);const d=t.N;(typeof d=="number"||this.args.length>1)&&n.push(d)}}return n.concat(this.args.map(c=>c.serialize()))}}var Jo=Wu;class Qo{constructor(t){this.type=ir,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return n.error("First argument must be an image or text section.");const d=[];let _=!1;for(let v=1;v<=t.length-1;++v){const E=t[v];if(_&&typeof E=="object"&&!Array.isArray(E)){_=!1;let k=null;if(E["font-scale"]&&(k=n.parse(E["font-scale"],1,Ke),!k))return null;let L=null;if(E["text-font"]&&(L=n.parse(E["text-font"],1,Rr(Ki)),!L))return null;let N=null;if(E["text-color"]&&(N=n.parse(E["text-color"],1,br),!N))return null;const V=d[d.length-1];V.scale=k,V.font=L,V.textColor=N}else{const k=n.parse(t[v],1,Vi);if(!k)return null;const L=k.type.kind;if(L!=="string"&&L!=="value"&&L!=="null"&&L!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,d.push({content:k,scale:null,font:null,textColor:null})}}return new Qo(d)}evaluate(t){return new Sr(this.sections.map(n=>{const c=n.content.evaluate(t);return ln(c)===io?new bc("",c,null,null,null):new bc(Yo(c),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const n of this.sections){t.push(n.content.serialize());const c={};n.scale&&(c["font-scale"]=n.scale.serialize()),n.font&&(c["text-font"]=n.font.serialize()),n.textColor&&(c["text-color"]=n.textColor.serialize()),t.push(c)}return t}}class Cl{constructor(t){this.type=io,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const c=n.parse(t[1],1,Ki);return c?new Cl(c):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),c=pr.fromString(n);return c&&t.availableImages&&(c.available=t.availableImages.indexOf(n)>-1),c}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const kl={"to-boolean":Ui,"to-color":br,"to-number":Ke,"to-string":Ki};class no{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const c=t[0];if((c==="to-boolean"||c==="to-string")&&t.length!==2)return n.error("Expected one argument.");const d=kl[c],_=[];for(let v=1;v<t.length;v++){const E=n.parse(t[v],v,Vi);if(!E)return null;_.push(E)}return new no(d,_)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let n,c;for(const d of this.args){if(n=d.evaluate(t),c=null,n instanceof gn)return n;if(typeof n=="string"){const _=t.parseColor(n);if(_)return _}else if(Array.isArray(n)&&(c=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Gu(n[0],n[1],n[2],n[3]),!c))return new gn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Wn(c||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const c of this.args){if(n=c.evaluate(t),n===null)return 0;const d=Number(n);if(!isNaN(d))return d}throw new Wn(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Sr.fromString(Yo(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?pr.fromString(Yo(this.args[0].evaluate(t))):Yo(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Qo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Cl(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(n=>{t.push(n.serialize())}),t}}var ta=no;const Co=["Unknown","Point","LineString","Polygon"];var Hu=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Co[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:n,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*t-s[0])+this.featureDistanceData.bearing[1]*(c*t-s[1])}return 0}parseColor(s){let t=this._parseColorCache[s];return t||(t=this._parseColorCache[s]=gn.parse(s)),t}};class Xa{constructor(t,n,c,d){this.name=t,this.type=n,this._evaluate=c,this.args=d}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,n){const c=t[0],d=Xa.definitions[c];if(!d)return n.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(d)?d[0]:d.type,v=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,E=v.filter(([L])=>!Array.isArray(L)||L.length===t.length-1);let k=null;for(const[L,N]of E){k=new qu(n.registry,n.path,null,n.scope);const V=[];let W=!1;for(let Y=1;Y<t.length;Y++){const K=t[Y],st=Array.isArray(L)?L[Y-1]:L.type,ut=k.parse(K,1+V.length,st);if(!ut){W=!0;break}V.push(ut)}if(!W)if(Array.isArray(L)&&L.length!==V.length)k.error(`Expected ${L.length} arguments, but found ${V.length} instead.`);else{for(let Y=0;Y<V.length;Y++){const K=Array.isArray(L)?L[Y]:L.type,st=V[Y];k.concat(Y+1).checkSubtype(K,st.type)}if(k.errors.length===0)return new Xa(c,_,N,V)}}if(E.length===1)n.errors.push(...k.errors);else{const L=(E.length?E:v).map(([V])=>{return W=V,Array.isArray(W)?`(${W.map(Ys).join(", ")})`:`(${Ys(W.type)}...)`;var W}).join(" | "),N=[];for(let V=1;V<t.length;V++){const W=n.parse(t[V],1+N.length);if(!W)return null;N.push(Ys(W.type))}n.error(`Expected arguments of type ${L}, but found (${N.join(", ")}) instead.`)}return null}static register(t,n){Xa.definitions=n;for(const c in n)t[c]=Xa}}var ko=Xa;class cn{constructor(t,n,c){this.type=wr,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return n.error("Collator options argument must be an object.");const d=n.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Ui);if(!d)return null;const _=n.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Ui);if(!_)return null;let v=null;return c.locale&&(v=n.parse(c.locale,1,Ki),!v)?null:new cn(d,_,v)}evaluate(t){return new $u(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const Hn=8192;function Tc(s,t){s[0]=Math.min(s[0],t[0]),s[1]=Math.min(s[1],t[1]),s[2]=Math.max(s[2],t[0]),s[3]=Math.max(s[3],t[1])}function Pl(s,t){return!(s[0]<=t[0]||s[2]>=t[2]||s[1]<=t[1]||s[3]>=t[3])}function Il(s,t){const n=(180+s[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,d=Math.pow(2,t.z);return[Math.round(n*d*Hn),Math.round(c*d*Hn)]}function Ll(s,t,n){const c=s[0]-t[0],d=s[1]-t[1],_=s[0]-n[0],v=s[1]-n[1];return c*v-_*d==0&&c*_<=0&&d*v<=0}function vh(s,t){let n=!1;for(let v=0,E=t.length;v<E;v++){const k=t[v];for(let L=0,N=k.length;L<N-1;L++){if(Ll(s,k[L],k[L+1]))return!1;(d=k[L])[1]>(c=s)[1]!=(_=k[L+1])[1]>c[1]&&c[0]<(_[0]-d[0])*(c[1]-d[1])/(_[1]-d[1])+d[0]&&(n=!n)}}var c,d,_;return n}function Dl(s,t){for(let n=0;n<t.length;n++)if(vh(s,t[n]))return!0;return!1}function bh(s,t,n,c){const d=c[0]-n[0],_=c[1]-n[1],v=(s[0]-n[0])*_-d*(s[1]-n[1]),E=(t[0]-n[0])*_-d*(t[1]-n[1]);return v>0&&E<0||v<0&&E>0}function Br(s,t,n){for(const L of n)for(let N=0;N<L.length-1;++N)if((E=[(v=L[N+1])[0]-(_=L[N])[0],v[1]-_[1]])[0]*(k=[(d=t)[0]-(c=s)[0],d[1]-c[1]])[1]-E[1]*k[0]!=0&&bh(c,d,_,v)&&bh(_,v,c,d))return!0;var c,d,_,v,E,k;return!1}function ps(s,t){for(let n=0;n<s.length;++n)if(!vh(s[n],t))return!1;for(let n=0;n<s.length-1;++n)if(Br(s[n],s[n+1],t))return!1;return!0}function cm(s,t){for(let n=0;n<t.length;n++)if(ps(s,t[n]))return!0;return!1}function qa(s,t,n){const c=[];for(let d=0;d<s.length;d++){const _=[];for(let v=0;v<s[d].length;v++){const E=Il(s[d][v],n);Tc(t,E),_.push(E)}c.push(_)}return c}function Xu(s,t,n){const c=[];for(let d=0;d<s.length;d++){const _=qa(s[d],t,n);c.push(_)}return c}function wh(s,t,n,c){if(s[0]<n[0]||s[0]>n[2]){const d=.5*c;let _=s[0]-n[0]>d?-c:n[0]-s[0]>d?c:0;_===0&&(_=s[0]-n[2]>d?-c:n[2]-s[0]>d?c:0),s[0]+=_}Tc(t,s)}function Th(s,t,n,c){const d=Math.pow(2,c.z)*Hn,_=[c.x*Hn,c.y*Hn],v=[];if(!s)return v;for(const E of s)for(const k of E){const L=[k.x+_[0],k.y+_[1]];wh(L,t,n,d),v.push(L)}return v}function Sh(s,t,n,c){const d=Math.pow(2,c.z)*Hn,_=[c.x*Hn,c.y*Hn],v=[];if(!s)return v;for(const k of s){const L=[];for(const N of k){const V=[N.x+_[0],N.y+_[1]];Tc(t,V),L.push(V)}v.push(L)}if(t[2]-t[0]<=d/2){(E=t)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const k of v)for(const L of k)wh(L,t,n,d)}var E;return v}class va{constructor(t,n){this.type=Ui,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Er(t[1])){const c=t[1];if(c.type==="FeatureCollection")for(let d=0;d<c.features.length;++d){const _=c.features[d].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new va(c,c.features[d].geometry)}else if(c.type==="Feature"){const d=c.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new va(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new va(c,c)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,c){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=n.canonicalID();if(!v)return!1;if(c.type==="Polygon"){const E=qa(c.coordinates,_,v),k=Th(n.geometry(),d,_,v);if(!Pl(d,_))return!1;for(const L of k)if(!vh(L,E))return!1}if(c.type==="MultiPolygon"){const E=Xu(c.coordinates,_,v),k=Th(n.geometry(),d,_,v);if(!Pl(d,_))return!1;for(const L of k)if(!Dl(L,E))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,c){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=n.canonicalID();if(!v)return!1;if(c.type==="Polygon"){const E=qa(c.coordinates,_,v),k=Sh(n.geometry(),d,_,v);if(!Pl(d,_))return!1;for(const L of k)if(!ps(L,E))return!1}if(c.type==="MultiPolygon"){const E=Xu(c.coordinates,_,v),k=Sh(n.geometry(),d,_,v);if(!Pl(d,_))return!1;for(const L of k)if(!cm(L,E))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Eh=va;function Za(s){if(s instanceof ko&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Eh)return!1;let t=!0;return s.eachChild(n=>{t&&!Za(n)&&(t=!1)}),t}function ro(s){if(s instanceof ko&&s.name==="feature-state")return!1;let t=!0;return s.eachChild(n=>{t&&!ro(n)&&(t=!1)}),t}function Ya(s,t){if(s instanceof ko&&t.indexOf(s.name)>=0)return!1;let n=!0;return s.eachChild(c=>{n&&!Ya(c,t)&&(n=!1)}),n}class Mh{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const c=t[1];return n.scope.has(c)?new Mh(c,n.scope.get(c)):n.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Pf=Mh;class Sc{constructor(t,n=[],c,d=new Cf,_=[]){this.registry=t,this.path=n,this.key=n.map(v=>`[${v}]`).join(""),this.scope=d,this.errors=_,this.expectedType=c}parse(t,n,c,d,_={}){return n?this.concat(n,c,d)._parse(t,_):this._parse(t,_)}_parse(t,n){function c(d,_,v){return v==="assert"?new Jo(_,[d]):v==="coerce"?new ta(_,[d]):d}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=t[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[d];if(_){let v=_.parse(t,this);if(!v)return null;if(this.expectedType){const E=this.expectedType,k=v.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||k.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||k.kind!=="value"&&k.kind!=="string"){if(this.checkSubtype(E,k))return null}else v=c(v,E,n.typeAnnotation||"coerce");else v=c(v,E,n.typeAnnotation||"assert")}if(!(v instanceof Ko)&&v.type.kind!=="resolvedImage"&&Ec(v)){const E=new Hu;try{v=new Ko(v.type,v.evaluate(E))}catch(k){return this.error(k.message),null}}return v}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,c){const d=typeof t=="number"?this.path.concat(t):this.path,_=c?this.scope.concat(c):this.scope;return new Sc(this.registry,d,n||null,_,this.errors)}error(t,...n){const c=`${this.key}${n.map(d=>`[${d}]`).join("")}`;this.errors.push(new Mo(c,t))}checkSubtype(t,n){const c=so(t,n);return c&&this.error(c),c}}var qu=Sc;function Ec(s){if(s instanceof Pf)return Ec(s.boundExpression);if(s instanceof ko&&s.name==="error"||s instanceof cn||s instanceof Eh)return!1;const t=s instanceof ta||s instanceof Jo;let n=!0;return s.eachChild(c=>{n=t?n&&Ec(c):n&&c instanceof Ko}),!!n&&Za(s)&&Ya(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ah(s,t){const n=s.length-1;let c,d,_=0,v=n,E=0;for(;_<=v;)if(E=Math.floor((_+v)/2),c=s[E],d=s[E+1],c<=t){if(E===n||t<d)return E;_=E+1}else{if(!(c>t))throw new Wn("Input is not a number.");v=E-1}return 0}class Ch{constructor(t,n,c){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[d,_]of c)this.labels.push(d),this.outputs.push(_)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const c=n.parse(t[1],1,Ke);if(!c)return null;const d=[];let _=null;n.expectedType&&n.expectedType.kind!=="value"&&(_=n.expectedType);for(let v=1;v<t.length;v+=2){const E=v===1?-1/0:t[v],k=t[v+1],L=v,N=v+1;if(typeof E!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(d.length&&d[d.length-1][0]>=E)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const V=n.parse(k,N,_);if(!V)return null;_=_||V.type,d.push([E,V])}return new Ch(_,c,d)}evaluate(t){const n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(t);const d=this.input.evaluate(t);if(d<=n[0])return c[0].evaluate(t);const _=n.length;return d>=n[_-1]?c[_-1].evaluate(t):c[Ah(n,d)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&t.push(this.labels[n]),t.push(this.outputs[n].serialize());return t}}var Zu=Ch;function rs(s,t,n){return s*(1-n)+t*n}var Po=Object.freeze({__proto__:null,array:function(s,t,n){return s.map((c,d)=>rs(c,t[d],n))},color:function(s,t,n){return new gn(rs(s.r,t.r,n),rs(s.g,t.g,n),rs(s.b,t.b,n),rs(s.a,t.a,n))},number:rs});const Yu=.95047,kh=1.08883,If=4/29,Ka=6/29,Ku=3*Ka*Ka,Ju=Ka*Ka*Ka,Qu=Math.PI/180,Ph=180/Math.PI;function zl(s){return s>Ju?Math.pow(s,1/3):s/Ku+If}function td(s){return s>Ka?s*s*s:Ku*(s-If)}function Ih(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Ja(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function ba(s){const t=Ja(s.r),n=Ja(s.g),c=Ja(s.b),d=zl((.4124564*t+.3575761*n+.1804375*c)/Yu),_=zl((.2126729*t+.7151522*n+.072175*c)/1);return{l:116*_-16,a:500*(d-_),b:200*(_-zl((.0193339*t+.119192*n+.9503041*c)/kh)),alpha:s.a}}function Lf(s){let t=(s.l+16)/116,n=isNaN(s.a)?t:t+s.a/500,c=isNaN(s.b)?t:t-s.b/200;return t=1*td(t),n=Yu*td(n),c=kh*td(c),new gn(Ih(3.2404542*n-1.5371385*t-.4985314*c),Ih(-.969266*n+1.8760108*t+.041556*c),Ih(.0556434*n-.2040259*t+1.0572252*c),s.alpha)}function Qa(s,t,n){const c=t-s;return s+n*(c>180||c<-180?c-360*Math.round(c/360):c)}const Mc={forward:ba,reverse:Lf,interpolate:function(s,t,n){return{l:rs(s.l,t.l,n),a:rs(s.a,t.a,n),b:rs(s.b,t.b,n),alpha:rs(s.alpha,t.alpha,n)}}},oo={forward:function(s){const{l:t,a:n,b:c}=ba(s),d=Math.atan2(c,n)*Ph;return{h:d<0?d+360:d,c:Math.sqrt(n*n+c*c),l:t,alpha:s.a}},reverse:function(s){const t=s.h*Qu,n=s.c;return Lf({l:s.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:s.alpha})},interpolate:function(s,t,n){return{h:Qa(s.h,t.h,n),c:rs(s.c,t.c,n),l:rs(s.l,t.l,n),alpha:rs(s.alpha,t.alpha,n)}}};var tl=Object.freeze({__proto__:null,hcl:oo,lab:Mc});class Ac{constructor(t,n,c,d,_){this.type=t,this.operator=n,this.interpolation=c,this.input=d,this.labels=[],this.outputs=[];for(const[v,E]of _)this.labels.push(v),this.outputs.push(E)}static interpolationFactor(t,n,c,d){let _=0;if(t.name==="exponential")_=Cc(n,t.base,c,d);else if(t.name==="linear")_=Cc(n,1,c,d);else if(t.name==="cubic-bezier"){const v=t.controlPoints;_=new re(v[0],v[1],v[2],v[3]).solve(Cc(n,1,c,d))}return _}static parse(t,n){let[c,d,_,...v]=t;if(!Array.isArray(d)||d.length===0)return n.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const L=d[1];if(typeof L!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:L}}else{if(d[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const L=d.slice(1);if(L.length!==4||L.some(N=>typeof N!="number"||N<0||N>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:L}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(_=n.parse(_,2,Ke),!_)return null;const E=[];let k=null;c==="interpolate-hcl"||c==="interpolate-lab"?k=br:n.expectedType&&n.expectedType.kind!=="value"&&(k=n.expectedType);for(let L=0;L<v.length;L+=2){const N=v[L],V=v[L+1],W=L+3,Y=L+4;if(typeof N!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',W);if(E.length&&E[E.length-1][0]>=N)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',W);const K=n.parse(V,Y,k);if(!K)return null;k=k||K.type,E.push([N,K])}return k.kind==="number"||k.kind==="color"||k.kind==="array"&&k.itemType.kind==="number"&&typeof k.N=="number"?new Ac(k,c,d,_,E):n.error(`Type ${Ys(k)} is not interpolatable.`)}evaluate(t){const n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(t);const d=this.input.evaluate(t);if(d<=n[0])return c[0].evaluate(t);const _=n.length;if(d>=n[_-1])return c[_-1].evaluate(t);const v=Ah(n,d),E=Ac.interpolationFactor(this.interpolation,d,n[v],n[v+1]),k=c[v].evaluate(t),L=c[v+1].evaluate(t);return this.operator==="interpolate"?Po[this.type.kind.toLowerCase()](k,L,E):this.operator==="interpolate-hcl"?oo.reverse(oo.interpolate(oo.forward(k),oo.forward(L),E)):Mc.reverse(Mc.interpolate(Mc.forward(k),Mc.forward(L),E))}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,t,this.input.serialize()];for(let c=0;c<this.labels.length;c++)n.push(this.labels[c],this.outputs[c].serialize());return n}}function Cc(s,t,n,c){const d=c-n,_=s-n;return d===0?0:t===1?_/d:(Math.pow(t,_)-1)/(Math.pow(t,d)-1)}var Fr=Ac;class Lh{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let c=null;const d=n.expectedType;d&&d.kind!=="value"&&(c=d);const _=[];for(const E of t.slice(1)){const k=n.parse(E,1+_.length,c,void 0,{typeAnnotation:"omit"});if(!k)return null;c=c||k.type,_.push(k)}const v=d&&_.some(E=>so(d,E.type));return new Lh(v?Vi:c,_)}evaluate(t){let n,c=null,d=0;for(const _ of this.args){if(d++,c=_.evaluate(t),c&&c instanceof pr&&!c.available&&(n||(n=c),c=null,d===this.args.length))return n;if(c!==null)break}return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(n=>{t.push(n.serialize())}),t}}var ed=Lh;class Dh{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let _=1;_<t.length-1;_+=2){const v=t[_];if(typeof v!="string")return n.error(`Expected string, but found ${typeof v} instead.`,_);if(/[^a-zA-Z0-9_]/.test(v))return n.error("Variable names must contain only alphanumeric characters or '_'.",_);const E=n.parse(t[_+1],_+1);if(!E)return null;c.push([v,E])}const d=n.parse(t[t.length-1],t.length-1,n.expectedType,c);return d?new Dh(c,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[n,c]of this.bindings)t.push(n,c.serialize());return t.push(this.result.serialize()),t}}var kc=Dh;class id{constructor(t,n,c){this.type=t,this.index=n,this.input=c}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=n.parse(t[1],1,Ke),d=n.parse(t[2],2,Rr(n.expectedType||Vi));return c&&d?new id(d.type.itemType,c,d):null}evaluate(t){const n=this.index.evaluate(t),c=this.input.evaluate(t);if(n<0)throw new Wn(`Array index out of bounds: ${n} < 0.`);if(n>=c.length)throw new Wn(`Array index out of bounds: ${n} > ${c.length-1}.`);if(n!==Math.floor(n))throw new Wn(`Array index must be an integer, but found ${n} instead.`);return c[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var hm=id;class sd{constructor(t,n){this.type=Ui,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=n.parse(t[1],1,Vi),d=n.parse(t[2],2,Vi);return c&&d?xa(c.type,[Ui,Ki,Ke,Ml,Vi])?new sd(c,d):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ys(c.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(c==null)return!1;if(!vc(n,["boolean","string","number","null"]))throw new Wn(`Expected first argument to be of type boolean, string, number or null, but found ${Ys(ln(n))} instead.`);if(!vc(c,["string","array"]))throw new Wn(`Expected second argument to be of type array or string, but found ${Ys(ln(c))} instead.`);return c.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ao=sd;class Pc{constructor(t,n,c){this.type=Ke,this.needle=t,this.haystack=n,this.fromIndex=c}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=n.parse(t[1],1,Vi),d=n.parse(t[2],2,Vi);if(!c||!d)return null;if(!xa(c.type,[Ui,Ki,Ke,Ml,Vi]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ys(c.type)} instead`);if(t.length===4){const _=n.parse(t[3],3,Ke);return _?new Pc(c,d,_):null}return new Pc(c,d)}evaluate(t){const n=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!vc(n,["boolean","string","number","null"]))throw new Wn(`Expected first argument to be of type boolean, string, number or null, but found ${Ys(ln(n))} instead.`);if(!vc(c,["string","array"]))throw new Wn(`Expected second argument to be of type array or string, but found ${Ys(ln(c))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(t);return c.indexOf(n,d)}return c.indexOf(n)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var nd=Pc;class rd{constructor(t,n,c,d,_,v){this.inputType=t,this.type=n,this.input=c,this.cases=d,this.outputs=_,this.otherwise=v}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let c,d;n.expectedType&&n.expectedType.kind!=="value"&&(d=n.expectedType);const _={},v=[];for(let L=2;L<t.length-1;L+=2){let N=t[L];const V=t[L+1];Array.isArray(N)||(N=[N]);const W=n.concat(L);if(N.length===0)return W.error("Expected at least one branch label.");for(const K of N){if(typeof K!="number"&&typeof K!="string")return W.error("Branch labels must be numbers or strings.");if(typeof K=="number"&&Math.abs(K)>Number.MAX_SAFE_INTEGER)return W.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof K=="number"&&Math.floor(K)!==K)return W.error("Numeric branch labels must be integer values.");if(c){if(W.checkSubtype(c,ln(K)))return null}else c=ln(K);if(_[String(K)]!==void 0)return W.error("Branch labels must be unique.");_[String(K)]=v.length}const Y=n.parse(V,L,d);if(!Y)return null;d=d||Y.type,v.push(Y)}const E=n.parse(t[1],1,Vi);if(!E)return null;const k=n.parse(t[t.length-1],t.length-1,d);return k?E.type.kind!=="value"&&n.concat(1).checkSubtype(c,E.type)?null:new rd(c,d,E,_,v,k):null}evaluate(t){const n=this.input.evaluate(t);return(ln(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),c=[],d={};for(const v of n){const E=d[this.cases[v]];E===void 0?(d[this.cases[v]]=c.length,c.push([this.cases[v],[v]])):c[E][1].push(v)}const _=v=>this.inputType.kind==="number"?Number(v):v;for(const[v,E]of c)t.push(E.length===1?_(E[0]):E.map(_)),t.push(this.outputs[v].serialize());return t.push(this.otherwise.serialize()),t}}var um=rd;class Ol{constructor(t,n,c){this.type=t,this.branches=n,this.otherwise=c}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const d=[];for(let v=1;v<t.length-1;v+=2){const E=n.parse(t[v],v,Ui);if(!E)return null;const k=n.parse(t[v+1],v+1,c);if(!k)return null;d.push([E,k]),c=c||k.type}const _=n.parse(t[t.length-1],t.length-1,c);return _?new Ol(c,d,_):null}evaluate(t){for(const[n,c]of this.branches)if(n.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,c]of this.branches)t(n),t(c);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(n=>{t.push(n.serialize())}),t}}var Df=Ol;class Ic{constructor(t,n,c,d){this.type=t,this.input=n,this.beginIndex=c,this.endIndex=d}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=n.parse(t[1],1,Vi),d=n.parse(t[2],2,Ke);if(!c||!d)return null;if(!xa(c.type,[Rr(Vi),Ki,Vi]))return n.error(`Expected first argument to be of type array or string, but found ${Ys(c.type)} instead`);if(t.length===4){const _=n.parse(t[3],3,Ke);return _?new Ic(c.type,c,d,_):null}return new Ic(c.type,c,d)}evaluate(t){const n=this.input.evaluate(t),c=this.beginIndex.evaluate(t);if(!vc(n,["string","array"]))throw new Wn(`Expected first argument to be of type array or string, but found ${Ys(ln(n))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(t);return n.slice(c,d)}return n.slice(c)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var od=Ic;function zh(s,t){return s==="=="||s==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function el(s,t,n,c){return c.compare(t,n)===0}function Nr(s,t,n){const c=s!=="=="&&s!=="!=";return class JM{constructor(_,v,E){this.type=Ui,this.lhs=_,this.rhs=v,this.collator=E,this.hasUntypedArgument=_.type.kind==="value"||v.type.kind==="value"}static parse(_,v){if(_.length!==3&&_.length!==4)return v.error("Expected two or three arguments.");const E=_[0];let k=v.parse(_[1],1,Vi);if(!k)return null;if(!zh(E,k.type))return v.concat(1).error(`"${E}" comparisons are not supported for type '${Ys(k.type)}'.`);let L=v.parse(_[2],2,Vi);if(!L)return null;if(!zh(E,L.type))return v.concat(2).error(`"${E}" comparisons are not supported for type '${Ys(L.type)}'.`);if(k.type.kind!==L.type.kind&&k.type.kind!=="value"&&L.type.kind!=="value")return v.error(`Cannot compare types '${Ys(k.type)}' and '${Ys(L.type)}'.`);c&&(k.type.kind==="value"&&L.type.kind!=="value"?k=new Jo(L.type,[k]):k.type.kind!=="value"&&L.type.kind==="value"&&(L=new Jo(k.type,[L])));let N=null;if(_.length===4){if(k.type.kind!=="string"&&L.type.kind!=="string"&&k.type.kind!=="value"&&L.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(N=v.parse(_[3],3,wr),!N)return null}return new JM(k,L,N)}evaluate(_){const v=this.lhs.evaluate(_),E=this.rhs.evaluate(_);if(c&&this.hasUntypedArgument){const k=ln(v),L=ln(E);if(k.kind!==L.kind||k.kind!=="string"&&k.kind!=="number")throw new Wn(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${k.kind}, ${L.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const k=ln(v),L=ln(E);if(k.kind!=="string"||L.kind!=="string")return t(_,v,E)}return this.collator?n(_,v,E,this.collator.evaluate(_)):t(_,v,E)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[s];return this.eachChild(v=>{_.push(v.serialize())}),_}}}const dm=Nr("==",function(s,t,n){return t===n},el),fm=Nr("!=",function(s,t,n){return t!==n},function(s,t,n,c){return!el(0,t,n,c)}),pm=Nr("<",function(s,t,n){return t<n},function(s,t,n,c){return c.compare(t,n)<0}),mm=Nr(">",function(s,t,n){return t>n},function(s,t,n,c){return c.compare(t,n)>0}),gm=Nr("<=",function(s,t,n){return t<=n},function(s,t,n,c){return c.compare(t,n)<=0}),Lc=Nr(">=",function(s,t,n){return t>=n},function(s,t,n,c){return c.compare(t,n)>=0});class Rl{constructor(t,n,c,d,_,v){this.type=Ki,this.number=t,this.locale=n,this.currency=c,this.unit=d,this.minFractionDigits=_,this.maxFractionDigits=v}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const c=n.parse(t[1],1,Ke);if(!c)return null;const d=t[2];if(typeof d!="object"||Array.isArray(d))return n.error("NumberFormat options argument must be an object.");let _=null;if(d.locale&&(_=n.parse(d.locale,1,Ki),!_))return null;let v=null;if(d.currency&&(v=n.parse(d.currency,1,Ki),!v))return null;let E=null;if(d.unit&&(E=n.parse(d.unit,1,Ki),!E))return null;let k=null;if(d["min-fraction-digits"]&&(k=n.parse(d["min-fraction-digits"],1,Ke),!k))return null;let L=null;return d["max-fraction-digits"]&&(L=n.parse(d["max-fraction-digits"],1,Ke),!L)?null:new Rl(c,_,v,E,k,L)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Bl{constructor(t){this.type=Ke,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=n.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Ys(c.type)} instead.`):new Bl(c):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Wn(`Expected value to be of type string or array, but found ${Ys(ln(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(n=>{t.push(n.serialize())}),t}}const Dc={"==":dm,"!=":fm,">":mm,"<":pm,">=":Lc,"<=":gm,array:Jo,at:hm,boolean:Jo,case:Df,coalesce:ed,collator:cn,format:Qo,image:Cl,in:ao,"index-of":nd,interpolate:Fr,"interpolate-hcl":Fr,"interpolate-lab":Fr,length:Bl,let:kc,literal:Ko,match:um,number:Jo,"number-format":Rl,object:Jo,slice:od,step:Zu,string:Jo,"to-boolean":ta,"to-color":ta,"to-number":ta,"to-string":ta,var:Pf,within:Eh};function Oh(s,[t,n,c,d]){t=t.evaluate(s),n=n.evaluate(s),c=c.evaluate(s);const _=d?d.evaluate(s):1,v=Gu(t,n,c,_);if(v)throw new Wn(v);return new gn(t/255*_,n/255*_,c/255*_,_)}function ea(s,t){return s in t}function zc(s,t){const n=t[s];return n===void 0?null:n}function sr(s){return{type:s}}ko.register(Dc,{error:[{kind:"error"},[Ki],(s,[t])=>{throw new Wn(t.evaluate(s))}],typeof:[Ki,[Vi],(s,[t])=>Ys(ln(t.evaluate(s)))],"to-rgba":[Rr(Ke,4),[br],(s,[t])=>t.evaluate(s).toArray()],rgb:[br,[Ke,Ke,Ke],Oh],rgba:[br,[Ke,Ke,Ke,Ke],Oh],has:{type:Ui,overloads:[[[Ki],(s,[t])=>ea(t.evaluate(s),s.properties())],[[Ki,Or],(s,[t,n])=>ea(t.evaluate(s),n.evaluate(s))]]},get:{type:Vi,overloads:[[[Ki],(s,[t])=>zc(t.evaluate(s),s.properties())],[[Ki,Or],(s,[t,n])=>zc(t.evaluate(s),n.evaluate(s))]]},"feature-state":[Vi,[Ki],(s,[t])=>zc(t.evaluate(s),s.featureState||{})],properties:[Or,[],s=>s.properties()],"geometry-type":[Ki,[],s=>s.geometryType()],id:[Vi,[],s=>s.id()],zoom:[Ke,[],s=>s.globals.zoom],pitch:[Ke,[],s=>s.globals.pitch||0],"distance-from-center":[Ke,[],s=>s.distanceFromCenter()],"heatmap-density":[Ke,[],s=>s.globals.heatmapDensity||0],"line-progress":[Ke,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[Ke,[],s=>s.globals.skyRadialProgress||0],accumulated:[Vi,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[Ke,sr(Ke),(s,t)=>{let n=0;for(const c of t)n+=c.evaluate(s);return n}],"*":[Ke,sr(Ke),(s,t)=>{let n=1;for(const c of t)n*=c.evaluate(s);return n}],"-":{type:Ke,overloads:[[[Ke,Ke],(s,[t,n])=>t.evaluate(s)-n.evaluate(s)],[[Ke],(s,[t])=>-t.evaluate(s)]]},"/":[Ke,[Ke,Ke],(s,[t,n])=>t.evaluate(s)/n.evaluate(s)],"%":[Ke,[Ke,Ke],(s,[t,n])=>t.evaluate(s)%n.evaluate(s)],ln2:[Ke,[],()=>Math.LN2],pi:[Ke,[],()=>Math.PI],e:[Ke,[],()=>Math.E],"^":[Ke,[Ke,Ke],(s,[t,n])=>Math.pow(t.evaluate(s),n.evaluate(s))],sqrt:[Ke,[Ke],(s,[t])=>Math.sqrt(t.evaluate(s))],log10:[Ke,[Ke],(s,[t])=>Math.log(t.evaluate(s))/Math.LN10],ln:[Ke,[Ke],(s,[t])=>Math.log(t.evaluate(s))],log2:[Ke,[Ke],(s,[t])=>Math.log(t.evaluate(s))/Math.LN2],sin:[Ke,[Ke],(s,[t])=>Math.sin(t.evaluate(s))],cos:[Ke,[Ke],(s,[t])=>Math.cos(t.evaluate(s))],tan:[Ke,[Ke],(s,[t])=>Math.tan(t.evaluate(s))],asin:[Ke,[Ke],(s,[t])=>Math.asin(t.evaluate(s))],acos:[Ke,[Ke],(s,[t])=>Math.acos(t.evaluate(s))],atan:[Ke,[Ke],(s,[t])=>Math.atan(t.evaluate(s))],min:[Ke,sr(Ke),(s,t)=>Math.min(...t.map(n=>n.evaluate(s)))],max:[Ke,sr(Ke),(s,t)=>Math.max(...t.map(n=>n.evaluate(s)))],abs:[Ke,[Ke],(s,[t])=>Math.abs(t.evaluate(s))],round:[Ke,[Ke],(s,[t])=>{const n=t.evaluate(s);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ke,[Ke],(s,[t])=>Math.floor(t.evaluate(s))],ceil:[Ke,[Ke],(s,[t])=>Math.ceil(t.evaluate(s))],"filter-==":[Ui,[Ki,Vi],(s,[t,n])=>s.properties()[t.value]===n.value],"filter-id-==":[Ui,[Vi],(s,[t])=>s.id()===t.value],"filter-type-==":[Ui,[Ki],(s,[t])=>s.geometryType()===t.value],"filter-<":[Ui,[Ki,Vi],(s,[t,n])=>{const c=s.properties()[t.value],d=n.value;return typeof c==typeof d&&c<d}],"filter-id-<":[Ui,[Vi],(s,[t])=>{const n=s.id(),c=t.value;return typeof n==typeof c&&n<c}],"filter->":[Ui,[Ki,Vi],(s,[t,n])=>{const c=s.properties()[t.value],d=n.value;return typeof c==typeof d&&c>d}],"filter-id->":[Ui,[Vi],(s,[t])=>{const n=s.id(),c=t.value;return typeof n==typeof c&&n>c}],"filter-<=":[Ui,[Ki,Vi],(s,[t,n])=>{const c=s.properties()[t.value],d=n.value;return typeof c==typeof d&&c<=d}],"filter-id-<=":[Ui,[Vi],(s,[t])=>{const n=s.id(),c=t.value;return typeof n==typeof c&&n<=c}],"filter->=":[Ui,[Ki,Vi],(s,[t,n])=>{const c=s.properties()[t.value],d=n.value;return typeof c==typeof d&&c>=d}],"filter-id->=":[Ui,[Vi],(s,[t])=>{const n=s.id(),c=t.value;return typeof n==typeof c&&n>=c}],"filter-has":[Ui,[Vi],(s,[t])=>t.value in s.properties()],"filter-has-id":[Ui,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Ui,[Rr(Ki)],(s,[t])=>t.value.indexOf(s.geometryType())>=0],"filter-id-in":[Ui,[Rr(Vi)],(s,[t])=>t.value.indexOf(s.id())>=0],"filter-in-small":[Ui,[Ki,Rr(Vi)],(s,[t,n])=>n.value.indexOf(s.properties()[t.value])>=0],"filter-in-large":[Ui,[Ki,Rr(Vi)],(s,[t,n])=>function(c,d,_,v){for(;_<=v;){const E=_+v>>1;if(d[E]===c)return!0;d[E]>c?v=E-1:_=E+1}return!1}(s.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Ui,overloads:[[[Ui,Ui],(s,[t,n])=>t.evaluate(s)&&n.evaluate(s)],[sr(Ui),(s,t)=>{for(const n of t)if(!n.evaluate(s))return!1;return!0}]]},any:{type:Ui,overloads:[[[Ui,Ui],(s,[t,n])=>t.evaluate(s)||n.evaluate(s)],[sr(Ui),(s,t)=>{for(const n of t)if(n.evaluate(s))return!0;return!1}]]},"!":[Ui,[Ui],(s,[t])=>!t.evaluate(s)],"is-supported-script":[Ui,[Ki],(s,[t])=>{const n=s.globals&&s.globals.isSupportedScript;return!n||n(t.evaluate(s))}],upcase:[Ki,[Ki],(s,[t])=>t.evaluate(s).toUpperCase()],downcase:[Ki,[Ki],(s,[t])=>t.evaluate(s).toLowerCase()],concat:[Ki,sr(Vi),(s,t)=>t.map(n=>Yo(n.evaluate(s))).join("")],"resolved-locale":[Ki,[wr],(s,[t])=>t.evaluate(s).resolvedLocale()]});var Oc=Dc;function Rc(s){return{result:"success",value:s}}function il(s){return{result:"error",value:s}}function Fl(s){return s["property-type"]==="data-driven"}function Pr(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function ia(s){return!!s.expression&&s.expression.interpolated}function us(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function Nl(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function zf(s){return s}function jl(s,t){const n=t.type==="color",c=s.stops&&typeof s.stops[0][0]=="object",d=c||!(c||s.property!==void 0),_=s.type||(ia(t)?"exponential":"interval");if(n&&((s=Eo({},s)).stops&&(s.stops=s.stops.map(L=>[L[0],gn.parse(L[1])])),s.default=gn.parse(s.default?s.default:t.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!tl[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let v,E,k;if(_==="exponential")v=sa;else if(_==="interval")v=Bc;else if(_==="categorical"){v=Of,E=Object.create(null);for(const L of s.stops)E[L[0]]=L[1];k=typeof s.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);v=Rh}if(c){const L={},N=[];for(let Y=0;Y<s.stops.length;Y++){const K=s.stops[Y],st=K[0].zoom;L[st]===void 0&&(L[st]={zoom:st,type:s.type,property:s.property,default:s.default,stops:[]},N.push(st)),L[st].stops.push([K[0].value,K[1]])}const V=[];for(const Y of N)V.push([L[Y].zoom,jl(L[Y],t)]);const W={name:"linear"};return{kind:"composite",interpolationType:W,interpolationFactor:Fr.interpolationFactor.bind(void 0,W),zoomStops:V.map(Y=>Y[0]),evaluate:({zoom:Y},K)=>sa({stops:V,base:s.base},t,Y).evaluate(Y,K)}}if(d){const L=_==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:Fr.interpolationFactor.bind(void 0,L),zoomStops:s.stops.map(N=>N[0]),evaluate:({zoom:N})=>v(s,t,N,E,k)}}return{kind:"source",evaluate(L,N){const V=N&&N.properties?N.properties[s.property]:void 0;return V===void 0?Ul(s.default,t.default):v(s,t,V,E,k)}}}function Ul(s,t,n){return s!==void 0?s:t!==void 0?t:n!==void 0?n:void 0}function Of(s,t,n,c,d){return Ul(typeof n===d?c[n]:void 0,s.default,t.default)}function Bc(s,t,n){if(us(n)!=="number")return Ul(s.default,t.default);const c=s.stops.length;if(c===1||n<=s.stops[0][0])return s.stops[0][1];if(n>=s.stops[c-1][0])return s.stops[c-1][1];const d=Ah(s.stops.map(_=>_[0]),n);return s.stops[d][1]}function sa(s,t,n){const c=s.base!==void 0?s.base:1;if(us(n)!=="number")return Ul(s.default,t.default);const d=s.stops.length;if(d===1||n<=s.stops[0][0])return s.stops[0][1];if(n>=s.stops[d-1][0])return s.stops[d-1][1];const _=Ah(s.stops.map(N=>N[0]),n),v=function(N,V,W,Y){const K=Y-W,st=N-W;return K===0?0:V===1?st/K:(Math.pow(V,st)-1)/(Math.pow(V,K)-1)}(n,c,s.stops[_][0],s.stops[_+1][0]),E=s.stops[_][1],k=s.stops[_+1][1];let L=Po[t.type]||zf;if(s.colorSpace&&s.colorSpace!=="rgb"){const N=tl[s.colorSpace];L=(V,W)=>N.reverse(N.interpolate(N.forward(V),N.forward(W),v))}return typeof E.evaluate=="function"?{evaluate(...N){const V=E.evaluate.apply(void 0,N),W=k.evaluate.apply(void 0,N);if(V!==void 0&&W!==void 0)return L(V,W,v)}}:L(E,k,v)}function Rh(s,t,n){return t.type==="color"?n=gn.parse(n):t.type==="formatted"?n=Sr.fromString(n.toString()):t.type==="resolvedImage"?n=pr.fromString(n.toString()):us(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0),Ul(n,s.default,t.default)}class nr{constructor(t,n){this.expression=t,this._warningHistory={},this._evaluator=new Hu,this._defaultValue=n?function(c){return c.type==="color"&&(Nl(c.default)||Array.isArray(c.default))?new gn(0,0,0,0):c.type==="color"?gn.parse(c.default)||null:c.default===void 0?null:c.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,c,d,_,v,E,k){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=c,this._evaluator.canonical=d||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=E||null,this._evaluator.featureDistanceData=k||null,this.expression.evaluate(this._evaluator)}evaluate(t,n,c,d,_,v,E,k){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=c||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=E||null,this._evaluator.featureDistanceData=k||null;try{const L=this.expression.evaluate(this._evaluator);if(L==null||typeof L=="number"&&L!=L)return this._defaultValue;if(this._enumValues&&!(L in this._enumValues))throw new Wn(`Expected value to be one of ${Object.keys(this._enumValues).map(N=>JSON.stringify(N)).join(", ")}, but found ${JSON.stringify(L)} instead.`);return L}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(L.message)),this._defaultValue}}}function ys(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Oc}function Vl(s,t){const n=new qu(Oc,[],t?function(d){const _={color:br,string:Ki,number:Ke,enum:Ki,boolean:Ui,formatted:ir,resolvedImage:io};return d.type==="array"?Rr(_[d.value]||Vi,d.length):_[d.type]}(t):void 0),c=n.parse(s,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Rc(new nr(c,t)):il(n.errors)}class Bh{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!ro(n.expression)}evaluateWithoutErrorHandling(t,n,c,d,_,v){return this._styleExpression.evaluateWithoutErrorHandling(t,n,c,d,_,v)}evaluate(t,n,c,d,_,v){return this._styleExpression.evaluate(t,n,c,d,_,v)}}class sl{constructor(t,n,c,d){this.kind=t,this.zoomStops=c,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!ro(n.expression),this.interpolationType=d}evaluateWithoutErrorHandling(t,n,c,d,_,v){return this._styleExpression.evaluateWithoutErrorHandling(t,n,c,d,_,v)}evaluate(t,n,c,d,_,v){return this._styleExpression.evaluate(t,n,c,d,_,v)}interpolationFactor(t,n,c){return this.interpolationType?Fr.interpolationFactor(this.interpolationType,t,n,c):0}}function wa(s,t){if((s=Vl(s,t)).result==="error")return s;const n=s.value.expression,c=Za(n);if(!c&&!Fl(t))return il([new Mo("","data expressions not supported")]);const d=Ya(n,["zoom","pitch","distance-from-center"]);if(!d&&!Pr(t))return il([new Mo("","zoom expressions not supported")]);const _=Fc(n);return _||d?_ instanceof Mo?il([_]):_ instanceof Fr&&!ia(t)?il([new Mo("",'"interpolate" expressions cannot be used with this property')]):Rc(_?new sl(c?"camera":"composite",s.value,_.labels,_ instanceof Fr?_.interpolation:void 0):new Bh(c?"constant":"source",s.value)):il([new Mo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class js{constructor(t,n){this._parameters=t,this._specification=n,Eo(this,jl(this._parameters,this._specification))}static deserialize(t){return new js(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Fc(s){let t=null;if(s instanceof kc)t=Fc(s.result);else if(s instanceof ed){for(const n of s.args)if(t=Fc(n),t)break}else(s instanceof Zu||s instanceof Fr)&&s.input instanceof ko&&s.input.name==="zoom"&&(t=s);return t instanceof Mo||s.eachChild(n=>{const c=Fc(n);c instanceof Mo?t=c:!t&&c?t=new Mo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&c&&t!==c&&(t=new Mo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}class ii{constructor(t,n,c,d){this.message=(t?`${t}: `:"")+c,d&&(this.identifier=d),n!=null&&n.__line__&&(this.line=n.__line__)}}function jr(s){const t=s.key,n=s.value,c=s.valueSpec||{},d=s.objectElementValidators||{},_=s.style,v=s.styleSpec;let E=[];const k=us(n);if(k!=="object")return[new ii(t,n,`object expected, ${k} found`)];for(const L in n){const N=L.split(".")[0];let V;d[N]?V=d[N]:c[N]?V=rr:d["*"]?V=d["*"]:c["*"]&&(V=rr),V?E=E.concat(V({key:(t&&`${t}.`)+L,value:n[L],valueSpec:c[N]||c["*"],style:_,styleSpec:v,object:n,objectKey:L},n)):E.push(new ii(t,n[L],`unknown property "${L}"`))}for(const L in c)d[L]||c[L].required&&c[L].default===void 0&&n[L]===void 0&&E.push(new ii(t,n,`missing required property "${L}"`));return E}function Ai(s){const t=s.value,n=s.valueSpec,c=s.style,d=s.styleSpec,_=s.key,v=s.arrayElementValidator||rr;if(us(t)!=="array")return[new ii(_,t,`array expected, ${us(t)} found`)];if(n.length&&t.length!==n.length)return[new ii(_,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new ii(_,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let E={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};d.$version<7&&(E.function=n.function),us(n.value)==="object"&&(E=n.value);let k=[];for(let L=0;L<t.length;L++)k=k.concat(v({array:t,arrayIndex:L,value:t[L],valueSpec:E,style:c,styleSpec:d,key:`${_}[${L}]`}));return k}function $l(s){const t=s.key,n=s.value,c=s.valueSpec;let d=us(n);if(d==="number"&&n!=n&&(d="NaN"),d!=="number")return[new ii(t,n,`number expected, ${d} found`)];if("minimum"in c){let _=c.minimum;if(us(c.minimum)==="array"&&(_=c.minimum[s.arrayIndex]),n<_)return[new ii(t,n,`${n} is less than the minimum value ${_}`)]}if("maximum"in c){let _=c.maximum;if(us(c.maximum)==="array"&&(_=c.maximum[s.arrayIndex]),n>_)return[new ii(t,n,`${n} is greater than the maximum value ${_}`)]}return[]}function Ta(s){const t=s.valueSpec,n=En(s.value.type);let c,d,_,v={};const E=n!=="categorical"&&s.value.property===void 0,k=!E,L=us(s.value.stops)==="array"&&us(s.value.stops[0])==="array"&&us(s.value.stops[0][0])==="object",N=jr({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(Y){if(n==="identity")return[new ii(Y.key,Y.value,'identity function may not have a "stops" property')];let K=[];const st=Y.value;return K=K.concat(Ai({key:Y.key,value:st,valueSpec:Y.valueSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:V})),us(st)==="array"&&st.length===0&&K.push(new ii(Y.key,st,"array must have at least one stop")),K},default:function(Y){return rr({key:Y.key,value:Y.value,valueSpec:t,style:Y.style,styleSpec:Y.styleSpec})}}});return n==="identity"&&E&&N.push(new ii(s.key,s.value,'missing required property "property"')),n==="identity"||s.value.stops||N.push(new ii(s.key,s.value,'missing required property "stops"')),n==="exponential"&&s.valueSpec.expression&&!ia(s.valueSpec)&&N.push(new ii(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(k&&!Fl(s.valueSpec)?N.push(new ii(s.key,s.value,"property functions not supported")):E&&!Pr(s.valueSpec)&&N.push(new ii(s.key,s.value,"zoom functions not supported"))),n!=="categorical"&&!L||s.value.property!==void 0||N.push(new ii(s.key,s.value,'"property" property is required')),N;function V(Y){let K=[];const st=Y.value,ut=Y.key;if(us(st)!=="array")return[new ii(ut,st,`array expected, ${us(st)} found`)];if(st.length!==2)return[new ii(ut,st,`array length 2 expected, length ${st.length} found`)];if(L){if(us(st[0])!=="object")return[new ii(ut,st,`object expected, ${us(st[0])} found`)];if(st[0].zoom===void 0)return[new ii(ut,st,"object stop key must have zoom")];if(st[0].value===void 0)return[new ii(ut,st,"object stop key must have value")];const vt=En(st[0].zoom);if(typeof vt!="number")return[new ii(ut,st[0].zoom,"stop zoom values must be numbers")];if(_&&_>vt)return[new ii(ut,st[0].zoom,"stop zoom values must appear in ascending order")];vt!==_&&(_=vt,d=void 0,v={}),K=K.concat(jr({key:`${ut}[0]`,value:st[0],valueSpec:{zoom:{}},style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:$l,value:W}}))}else K=K.concat(W({key:`${ut}[0]`,value:st[0],style:Y.style,styleSpec:Y.styleSpec},st));return ys(Gn(st[1]))?K.concat([new ii(`${ut}[1]`,st[1],"expressions are not allowed in function stops.")]):K.concat(rr({key:`${ut}[1]`,value:st[1],valueSpec:t,style:Y.style,styleSpec:Y.styleSpec}))}function W(Y,K){const st=us(Y.value),ut=En(Y.value),vt=Y.value!==null?Y.value:K;if(c){if(st!==c)return[new ii(Y.key,vt,`${st} stop domain type must match previous stop domain type ${c}`)]}else c=st;if(st!=="number"&&st!=="string"&&st!=="boolean"&&typeof ut!="number"&&typeof ut!="string"&&typeof ut!="boolean")return[new ii(Y.key,vt,"stop domain value must be a number, string, or boolean")];if(st!=="number"&&n!=="categorical"){let Pt=`number expected, ${st} found`;return Fl(t)&&n===void 0&&(Pt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ii(Y.key,vt,Pt)]}return n!=="categorical"||st!=="number"||typeof ut=="number"&&isFinite(ut)&&Math.floor(ut)===ut?n!=="categorical"&&st==="number"&&typeof ut=="number"&&typeof d=="number"&&d!==void 0&&ut<d?[new ii(Y.key,vt,"stop domain values must appear in ascending order")]:(d=ut,n==="categorical"&&ut in v?[new ii(Y.key,vt,"stop domain values must be unique")]:(v[ut]=!0,[])):[new ii(Y.key,vt,`integer expected, found ${String(ut)}`)]}}function Xn(s){const t=(s.expressionContext==="property"?wa:Vl)(Gn(s.value),s.valueSpec);if(t.result==="error")return t.value.map(c=>new ii(`${s.key}${c.key}`,s.value,c.message));const n=t.value.expression||t.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!n.outputDefined())return[new ii(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!ro(n))return[new ii(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter")return Sa(n,s);if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!Ya(n,["zoom","feature-state"]))return[new ii(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Za(n))return[new ii(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Sa(s,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const d of t.valueSpec.expression.parameters)n.delete(d);if(n.size===0)return[];const c=[];return s instanceof ko&&n.has(s.name)?[new ii(t.key,t.value,`["${s.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(s.eachChild(d=>{c.push(...Sa(d,t))}),c)}function Hi(s){const t=s.key,n=s.value,c=s.valueSpec,d=[];return Array.isArray(c.values)?c.values.indexOf(En(n))===-1&&d.push(new ii(t,n,`expected one of [${c.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(c.values).indexOf(En(n))===-1&&d.push(new ii(t,n,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(n)} found`)),d}function Gl(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const t of s.slice(1))if(!Gl(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function Fh(s,t="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Gl(s)||(s=Wl(s));const n=s;let c=!0;try{c=function(L){if(!nl(L))return L;let N=Gn(L);return Nh(N),N=Rf(N),N}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}const d=pe[`filter_${t}`],_=Vl(c,d);let v=null;if(_.result==="error")throw new Error(_.value.map(L=>`${L.key}: ${L.message}`).join(", "));v=(L,N,V)=>_.value.evaluate(L,N,{},V);let E=null,k=null;if(c!==n){const L=Vl(n,d);if(L.result==="error")throw new Error(L.value.map(N=>`${N.key}: ${N.message}`).join(", "));E=(N,V,W,Y,K)=>L.value.evaluate(N,V,{},W,void 0,void 0,Y,K),k=!Za(L.value.expression)}return{filter:v,dynamicFilter:E||void 0,needGeometry:Bf(c),needFeature:!!k}}function Rf(s){if(!Array.isArray(s))return s;const t=function(n){if(Ea.has(n[0])){for(let c=1;c<n.length;c++)if(nl(n[c]))return!0}return n}(s);return t===!0?t:t.map(n=>Rf(n))}function Nh(s){let t=!1;const n=[];if(s[0]==="case"){for(let c=1;c<s.length-1;c+=2)t=t||nl(s[c]),n.push(s[c+1]);n.push(s[s.length-1])}else if(s[0]==="match"){t=t||nl(s[1]);for(let c=2;c<s.length-1;c+=2)n.push(s[c+1]);n.push(s[s.length-1])}else if(s[0]==="step"){t=t||nl(s[1]);for(let c=1;c<s.length-1;c+=2)n.push(s[c+1])}t&&(s.length=0,s.push("any",...n));for(let c=1;c<s.length;c++)Nh(s[c])}function nl(s){if(!Array.isArray(s))return!1;if((t=s[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let n=1;n<s.length;n++)if(nl(s[n]))return!0;return!1}const Ea=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function _m(s,t){return s<t?-1:s>t?1:0}function Bf(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let t=1;t<s.length;t++)if(Bf(s[t]))return!0;return!1}function Wl(s){if(!s)return!0;const t=s[0];return s.length<=1?t!=="any":t==="=="?Hl(s[1],s[2],"=="):t==="!="?Uh(Hl(s[1],s[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Hl(s[1],s[2],t):t==="any"?(n=s.slice(1),["any"].concat(n.map(Wl))):t==="all"?["all"].concat(s.slice(1).map(Wl)):t==="none"?["all"].concat(s.slice(1).map(Wl).map(Uh)):t==="in"?ad(s[1],s.slice(2)):t==="!in"?Uh(ad(s[1],s.slice(2))):t==="has"?jh(s[1]):t==="!has"?Uh(jh(s[1])):t!=="within"||s;var n}function Hl(s,t,n){switch(s){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,s,t]}}function ad(s,t){if(t.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",s,["literal",t.sort(_m)]]:["filter-in-small",s,["literal",t]]}}function jh(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Uh(s){return["!",s]}function Nc(s){return Gl(Gn(s.value))?Xn(Eo({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):jc(s)}function jc(s){const t=s.value,n=s.key;if(us(t)!=="array")return[new ii(n,t,`array expected, ${us(t)} found`)];const c=s.styleSpec;let d,_=[];if(t.length<1)return[new ii(n,t,"filter array must have at least 1 element")];switch(_=_.concat(Hi({key:`${n}[0]`,value:t[0],valueSpec:c.filter_operator,style:s.style,styleSpec:s.styleSpec})),En(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&En(t[1])==="$type"&&_.push(new ii(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new ii(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(d=us(t[1]),d!=="string"&&_.push(new ii(`${n}[1]`,t[1],`string expected, ${d} found`)));for(let v=2;v<t.length;v++)d=us(t[v]),En(t[1])==="$type"?_=_.concat(Hi({key:`${n}[${v}]`,value:t[v],valueSpec:c.geometry_type,style:s.style,styleSpec:s.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&_.push(new ii(`${n}[${v}]`,t[v],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)_=_.concat(jc({key:`${n}[${v}]`,value:t[v],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":d=us(t[1]),t.length!==2?_.push(new ii(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):d!=="string"&&_.push(new ii(`${n}[1]`,t[1],`string expected, ${d} found`));break;case"within":d=us(t[1]),t.length!==2?_.push(new ii(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):d!=="object"&&_.push(new ii(`${n}[1]`,t[1],`object expected, ${d} found`))}return _}function ld(s,t){const n=s.key,c=s.style,d=s.styleSpec,_=s.value,v=s.objectKey,E=d[`${t}_${s.layerType}`];if(!E)return[];const k=v.match(/^(.*)-transition$/);if(t==="paint"&&k&&E[k[1]]&&E[k[1]].transition)return rr({key:n,value:_,valueSpec:d.transition,style:c,styleSpec:d});const L=s.valueSpec||E[v];if(!L)return[new ii(n,_,`unknown property "${v}"`)];let N;if(us(_)==="string"&&Fl(L)&&!L.tokens&&(N=/^{([^}]+)}$/.exec(_))){const W=`\`{ "type": "identity", "property": ${N?JSON.stringify(N[1]):'"_"'} }\``;return[new ii(n,_,`"${v}" does not support interpolation syntax
Use an identity property function instead: ${W}.`)]}const V=[];return s.layerType==="symbol"&&(v==="text-field"&&c&&!c.glyphs&&V.push(new ii(n,_,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&Nl(Gn(_))&&En(_.type)==="identity"&&V.push(new ii(n,_,'"text-font" does not support identity functions'))),V.concat(rr({key:s.key,value:_,valueSpec:L,style:c,styleSpec:d,expressionContext:"property",propertyType:t,propertyKey:v}))}function Ff(s){return ld(s,"paint")}function Vh(s){return ld(s,"layout")}function Nf(s){let t=[];const n=s.value,c=s.key,d=s.style,_=s.styleSpec;n.type||n.ref||t.push(new ii(c,n,'either "type" or "ref" is required'));let v=En(n.type);const E=En(n.ref);if(n.id){const k=En(n.id);for(let L=0;L<s.arrayIndex;L++){const N=d.layers[L];En(N.id)===k&&t.push(new ii(c,n.id,`duplicate layer id "${n.id}", previously used at line ${N.id.__line__}`))}}if("ref"in n){let k;["type","source","source-layer","filter","layout"].forEach(L=>{L in n&&t.push(new ii(c,n[L],`"${L}" is prohibited for ref layers`))}),d.layers.forEach(L=>{En(L.id)===E&&(k=L)}),k?k.ref?t.push(new ii(c,n.ref,"ref cannot reference another ref layer")):v=En(k.type):typeof E=="string"&&t.push(new ii(c,n.ref,`ref layer "${E}" not found`))}else if(v!=="background"&&v!=="sky")if(n.source){const k=d.sources&&d.sources[n.source],L=k&&En(k.type);k?L==="vector"&&v==="raster"?t.push(new ii(c,n.source,`layer "${n.id}" requires a raster source`)):L==="raster"&&v!=="raster"?t.push(new ii(c,n.source,`layer "${n.id}" requires a vector source`)):L!=="vector"||n["source-layer"]?L==="raster-dem"&&v!=="hillshade"?t.push(new ii(c,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):v!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||L==="geojson"&&k.lineMetrics||t.push(new ii(c,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ii(c,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new ii(c,n.source,`source "${n.source}" not found`))}else t.push(new ii(c,n,'missing required property "source"'));return t=t.concat(jr({key:c,value:n,valueSpec:_.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>rr({key:`${c}.type`,value:n.type,valueSpec:_.layer.type,style:s.style,styleSpec:s.styleSpec,object:n,objectKey:"type"}),filter:k=>Nc(Eo({layerType:v},k)),layout:k=>jr({layer:n,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":L=>Vh(Eo({layerType:v},L))}}),paint:k=>jr({layer:n,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":L=>Ff(Eo({layerType:v},L))}})}})),t}function Ma(s){const t=s.value,n=s.key,c=us(t);return c!=="string"?[new ii(n,t,`string expected, ${c} found`)]:[]}const cd={promoteId:function({key:s,value:t}){if(us(t)==="string")return Ma({key:s,value:t});{const n=[];for(const c in t)n.push(...Ma({key:`${s}.${c}`,value:t[c]}));return n}}};function hd(s){const t=s.value,n=s.key,c=s.styleSpec,d=s.style;if(!t.type)return[new ii(n,t,'"type" is required')];const _=En(t.type);let v;switch(_){case"vector":case"raster":case"raster-dem":return v=jr({key:n,value:t,valueSpec:c[`source_${_.replace("-","_")}`],style:s.style,styleSpec:c,objectElementValidators:cd}),v;case"geojson":if(v=jr({key:n,value:t,valueSpec:c.source_geojson,style:d,styleSpec:c,objectElementValidators:cd}),t.cluster)for(const E in t.clusterProperties){const[k,L]=t.clusterProperties[E],N=typeof k=="string"?[k,["accumulated"],["get",E]]:k;v.push(...Xn({key:`${n}.${E}.map`,value:L,expressionContext:"cluster-map"})),v.push(...Xn({key:`${n}.${E}.reduce`,value:N,expressionContext:"cluster-reduce"}))}return v;case"video":return jr({key:n,value:t,valueSpec:c.source_video,style:d,styleSpec:c});case"image":return jr({key:n,value:t,valueSpec:c.source_image,style:d,styleSpec:c});case"canvas":return[new ii(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Hi({key:`${n}.type`,value:t.type,valueSpec:{values:Io(c)}})}}function Io(s){return s.source.reduce((t,n)=>{const c=s[n];return c.type.type==="enum"&&(t=t.concat(Object.keys(c.type.values))),t},[])}function jf(s){const t=s.value,n=s.styleSpec,c=n.light,d=s.style;let _=[];const v=us(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new ii("light",t,`object expected, ${v} found`)]),_;for(const E in t){const k=E.match(/^(.*)-transition$/);_=_.concat(k&&c[k[1]]&&c[k[1]].transition?rr({key:E,value:t[E],valueSpec:n.transition,style:d,styleSpec:n}):c[E]?rr({key:E,value:t[E],valueSpec:c[E],style:d,styleSpec:n}):[new ii(E,t[E],`unknown property "${E}"`)])}return _}function ud(s){const t=s.value,n=s.key,c=s.style,d=s.styleSpec,_=d.terrain;let v=[];const E=us(t);if(t===void 0)return v;if(E!=="object")return v=v.concat([new ii("terrain",t,`object expected, ${E} found`)]),v;for(const k in t){const L=k.match(/^(.*)-transition$/);v=v.concat(L&&_[L[1]]&&_[L[1]].transition?rr({key:k,value:t[k],valueSpec:d.transition,style:c,styleSpec:d}):_[k]?rr({key:k,value:t[k],valueSpec:_[k],style:c,styleSpec:d}):[new ii(k,t[k],`unknown property "${k}"`)])}if(t.source){const k=c.sources&&c.sources[t.source],L=k&&En(k.type);k?L!=="raster-dem"&&v.push(new ii(n,t.source,`terrain cannot be used with a source of type ${String(L)}, it only be used with a "raster-dem" source type`)):v.push(new ii(n,t.source,`source "${t.source}" not found`))}else v.push(new ii(n,t,'terrain is missing required property "source"'));return v}function Uf(s){const t=s.value,n=s.style,c=s.styleSpec,d=c.fog;let _=[];const v=us(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new ii("fog",t,`object expected, ${v} found`)]),_;for(const E in t){const k=E.match(/^(.*)-transition$/);_=_.concat(k&&d[k[1]]&&d[k[1]].transition?rr({key:E,value:t[E],valueSpec:c.transition,style:n,styleSpec:c}):d[E]?rr({key:E,value:t[E],valueSpec:d[E],style:n,styleSpec:c}):[new ii(E,t[E],`unknown property "${E}"`)])}return _}const dd={"*":()=>[],array:Ai,boolean:function(s){const t=s.value,n=s.key,c=us(t);return c!=="boolean"?[new ii(n,t,`boolean expected, ${c} found`)]:[]},number:$l,color:function(s){const t=s.key,n=s.value,c=us(n);return c!=="string"?[new ii(t,n,`color expected, ${c} found`)]:Uu(n)===null?[new ii(t,n,`color expected, "${n}" found`)]:[]},enum:Hi,filter:Nc,function:Ta,layer:Nf,object:jr,source:hd,light:jf,terrain:ud,fog:Uf,string:Ma,formatted:function(s){return Ma(s).length===0?[]:Xn(s)},resolvedImage:function(s){return Ma(s).length===0?[]:Xn(s)},projection:function(s){const t=s.value,n=s.styleSpec,c=n.projection,d=s.style;let _=[];const v=us(t);if(v==="object")for(const E in t)_=_.concat(rr({key:E,value:t[E],valueSpec:c[E],style:d,styleSpec:n}));else v!=="string"&&(_=_.concat([new ii("projection",t,`object or string expected, ${v} found`)]));return _}};function rr(s){const t=s.value,n=s.valueSpec,c=s.styleSpec;return n.expression&&Nl(En(t))?Ta(s):n.expression&&ys(Gn(t))?Xn(s):n.type&&dd[n.type]?dd[n.type](s):jr(Eo({},s,{valueSpec:n.type?c[n.type]:n}))}function ym(s){const t=s.value,n=s.key,c=Ma(s);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new ii(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new ii(n,t,'"glyphs" url must include a "{range}" token'))),c}function Uc(s,t=pe){return Ur(rr({key:"",value:s,valueSpec:t.$root,styleSpec:t,style:s,objectElementValidators:{glyphs:ym,"*":()=>[]}}))}const xm=s=>Ur(Ff(s)),Vf=s=>Ur(Vh(s));function Ur(s){return s.slice().sort((t,n)=>t.line&&n.line?t.line-n.line:0)}function $f(s,t){let n=!1;if(t&&t.length)for(const c of t)s.fire(new qo(new Error(c.message))),n=!0;return n}var Gf=Lo,lo=3;function Lo(s,t,n){var c=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var d=new Int32Array(this.arrayBuffer);s=d[0],this.d=(t=d[1])+2*(n=d[2]);for(var _=0;_<this.d*this.d;_++){var v=d[lo+_],E=d[lo+_+1];c.push(v===E?null:d.subarray(v,E))}var k=d[lo+c.length+1];this.keys=d.subarray(d[lo+c.length],k),this.bboxes=d.subarray(k),this.insert=this._insertReadonly}else{this.d=t+2*n;for(var L=0;L<this.d*this.d;L++)c.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=s,this.padding=n,this.scale=t/s,this.uid=0;var N=n/t*s;this.min=-N,this.max=s+N}Lo.prototype.insert=function(s,t,n,c,d){this._forEachCell(t,n,c,d,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(c),this.bboxes.push(d)},Lo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Lo.prototype._insertCell=function(s,t,n,c,d,_){this.cells[d].push(_)},Lo.prototype.query=function(s,t,n,c,d){var _=this.min,v=this.max;if(s<=_&&t<=_&&v<=n&&v<=c&&!d)return Array.prototype.slice.call(this.keys);var E=[];return this._forEachCell(s,t,n,c,this._queryCell,E,{},d),E},Lo.prototype._queryCell=function(s,t,n,c,d,_,v,E){var k=this.cells[d];if(k!==null)for(var L=this.keys,N=this.bboxes,V=0;V<k.length;V++){var W=k[V];if(v[W]===void 0){var Y=4*W;(E?E(N[Y+0],N[Y+1],N[Y+2],N[Y+3]):s<=N[Y+2]&&t<=N[Y+3]&&n>=N[Y+0]&&c>=N[Y+1])?(v[W]=!0,_.push(L[W])):v[W]=!1}}},Lo.prototype._forEachCell=function(s,t,n,c,d,_,v,E){for(var k=this._convertToCellCoord(s),L=this._convertToCellCoord(t),N=this._convertToCellCoord(n),V=this._convertToCellCoord(c),W=k;W<=N;W++)for(var Y=L;Y<=V;Y++){var K=this.d*Y+W;if((!E||E(this._convertFromCellCoord(W),this._convertFromCellCoord(Y),this._convertFromCellCoord(W+1),this._convertFromCellCoord(Y+1)))&&d.call(this,s,t,n,c,K,_,v,E))return}},Lo.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},Lo.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},Lo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,t=lo+this.cells.length+1+1,n=0,c=0;c<this.cells.length;c++)n+=this.cells[c].length;var d=new Int32Array(t+n+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var _=t,v=0;v<s.length;v++){var E=s[v];d[lo+v]=_,d.set(E,_),_+=E.length}return d[lo+s.length]=_,d.set(this.keys,_),d[lo+s.length+1]=_+=this.keys.length,d.set(this.bboxes,_),_+=this.bboxes.length,d.buffer};var rl=It(Gf);const na={};function oi(s,t,n={}){Object.defineProperty(s,"_classRegistryKey",{value:t,writeable:!1}),na[t]={klass:s,omit:n.omit||[]}}oi(Object,"Object"),rl.serialize=function(s,t){const n=s.toArrayBuffer();return t&&t.push(n),{buffer:n}},rl.deserialize=function(s){return new rl(s.buffer)},Object.defineProperty(rl,"name",{value:"Grid"}),oi(rl,"Grid"),oi(gn,"Color"),oi(Error,"Error"),oi(to,"AJAXError"),oi(pr,"ResolvedImage"),oi(js,"StylePropertyFunction"),oi(nr,"StyleExpression",{omit:["_evaluator"]}),oi(sl,"ZoomDependentExpression"),oi(Bh,"ZoomConstantExpression"),oi(ko,"CompoundExpression",{omit:["_evaluate"]});for(const s in Oc)na[Oc[s]._classRegistryKey]||oi(Oc[s],`Expression${s}`);function fd(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function pd(s){return z.ImageBitmap&&s instanceof z.ImageBitmap}function ol(s,t){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(fd(s)||pd(s))return t&&t.push(s),s;if(ArrayBuffer.isView(s)){const n=s;return t&&t.push(n.buffer),n}if(s instanceof z.ImageData)return t&&t.push(s.data.buffer),s;if(Array.isArray(s)){const n=[];for(const c of s)n.push(ol(c,t));return n}if(typeof s=="object"){const n=s.constructor,c=n._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const d=n.serialize?n.serialize(s,t):{};if(!n.serialize){for(const _ in s)s.hasOwnProperty(_)&&(na[c].omit.indexOf(_)>=0||(d[_]=ol(s[_],t)));s instanceof Error&&(d.message=s.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(d.$name=c),d}throw new Error("can't serialize object of type "+typeof s)}function Aa(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||fd(s)||pd(s)||ArrayBuffer.isView(s)||s instanceof z.ImageData)return s;if(Array.isArray(s))return s.map(Aa);if(typeof s=="object"){const t=s.$name||"Object",{klass:n}=na[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(s);const c=Object.create(n.prototype);for(const d of Object.keys(s))d!=="$name"&&(c[d]=Aa(s[d]));return c}throw new Error("can't deserialize object of type "+typeof s)}const Ze={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function md(s){for(const t of s)if(gd(t.charCodeAt(0)))return!0;return!1}function vm(s){for(const t of s)if(!$h(t.charCodeAt(0)))return!1;return!0}function $h(s){return!(Ze.Arabic(s)||Ze["Arabic Supplement"](s)||Ze["Arabic Extended-A"](s)||Ze["Arabic Presentation Forms-A"](s)||Ze["Arabic Presentation Forms-B"](s))}function gd(s){return!(s!==746&&s!==747&&(s<4352||!(Ze["Bopomofo Extended"](s)||Ze.Bopomofo(s)||Ze["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||Ze["CJK Compatibility Ideographs"](s)||Ze["CJK Compatibility"](s)||Ze["CJK Radicals Supplement"](s)||Ze["CJK Strokes"](s)||!(!Ze["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||Ze["CJK Unified Ideographs Extension A"](s)||Ze["CJK Unified Ideographs"](s)||Ze["Enclosed CJK Letters and Months"](s)||Ze["Hangul Compatibility Jamo"](s)||Ze["Hangul Jamo Extended-A"](s)||Ze["Hangul Jamo Extended-B"](s)||Ze["Hangul Jamo"](s)||Ze["Hangul Syllables"](s)||Ze.Hiragana(s)||Ze["Ideographic Description Characters"](s)||Ze.Kanbun(s)||Ze["Kangxi Radicals"](s)||Ze["Katakana Phonetic Extensions"](s)||Ze.Katakana(s)&&s!==12540||!(!Ze["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!Ze["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||Ze["Unified Canadian Aboriginal Syllabics"](s)||Ze["Unified Canadian Aboriginal Syllabics Extended"](s)||Ze["Vertical Forms"](s)||Ze["Yijing Hexagram Symbols"](s)||Ze["Yi Syllables"](s)||Ze["Yi Radicals"](s))))}function al(s){return!(gd(s)||function(t){return!!(Ze["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Ze["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Ze["Letterlike Symbols"](t)||Ze["Number Forms"](t)||Ze["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ze["Control Pictures"](t)&&t!==9251||Ze["Optical Character Recognition"](t)||Ze["Enclosed Alphanumerics"](t)||Ze["Geometric Shapes"](t)||Ze["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ze["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ze["CJK Symbols and Punctuation"](t)||Ze.Katakana(t)||Ze["Private Use Area"](t)||Ze["CJK Compatibility Forms"](t)||Ze["Small Form Variants"](t)||Ze["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(s))}function Wf(s){return s>=1424&&s<=2303||Ze["Arabic Presentation Forms-A"](s)||Ze["Arabic Presentation Forms-B"](s)}function _d(s,t){return!(!t&&Wf(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||Ze.Khmer(s))}function bm(s){for(const t of s)if(Wf(t.charCodeAt(0)))return!0;return!1}const Vc="deferred",Gh="loading",yd="loaded";let Xl=null,m="unavailable",r=null;const u=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(m="error"),Xl&&Xl(s)};function y(){S.fire(new So("pluginStateChange",{pluginStatus:m,pluginURL:r}))}const S=new Is,M=function(){return m},D=function(){if(m!==Vc||!r)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");m=Gh,y(),r&&Yn({url:r},s=>{s?u(s):(m=yd,y())})},O={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>m===yd||O.applyArabicShaping!=null,isLoading:()=>m===Gh,setState(s){m=s.pluginStatus,r=s.pluginURL},isParsed:()=>O.applyArabicShaping!=null&&O.processBidirectionalText!=null&&O.processStyledBidirectionalText!=null,getPluginURL:()=>r};class j{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(t){return function(n,c){for(const d of n)if(!_d(d.charCodeAt(0),c))return!1;return!0}(t,O.isLoaded())}}class H{constructor(t,n){this.property=t,this.value=n,this.expression=function(c,d){if(Nl(c))return new js(c,d);if(ys(c)){const _=wa(c,d);if(_.result==="error")throw new Error(_.value.map(v=>`${v.key}: ${v.message}`).join(", "));return _.value}{let _=c;return typeof c=="string"&&d.type==="color"&&(_=gn.parse(c)),{kind:"constant",evaluate:()=>_}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,c){return this.property.possiblyEvaluate(this,t,n,c)}}class X{constructor(t){this.property=t,this.value=new H(t,void 0)}transitioned(t,n){return new ht(this.property,this.value,n,Ji({},t.transition,this.transition),t.now)}untransitioned(){return new ht(this.property,this.value,null,{},0)}}class tt{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return zt(this._values[t].value.value)}setValue(t,n){this._values.hasOwnProperty(t)||(this._values[t]=new X(this._values[t].property)),this._values[t].value=new H(this._values[t].property,n===null?void 0:zt(n))}getTransition(t){return zt(this._values[t].transition)}setTransition(t,n){this._values.hasOwnProperty(t)||(this._values[t]=new X(this._values[t].property)),this._values[t].transition=zt(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const c=this.getValue(n);c!==void 0&&(t[n]=c);const d=this.getTransition(n);d!==void 0&&(t[`${n}-transition`]=d)}return t}transitioned(t,n){const c=new pt(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].transitioned(t,n._values[d]);return c}untransitioned(){const t=new pt(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class ht{constructor(t,n,c,d,_){const v=d.delay||0,E=d.duration||0;_=_||0,this.property=t,this.value=n,this.begin=_+v,this.end=this.begin+E,t.specification.transition&&(d.delay||d.duration)&&(this.prior=c)}possiblyEvaluate(t,n,c){const d=t.now||0,_=this.value.possiblyEvaluate(t,n,c),v=this.prior;if(v){if(d>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(d<this.begin)return v.possiblyEvaluate(t,n,c);{const E=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(t,n,c),_,Ge(E))}}return _}}class pt{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,c){const d=new xt(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(t,n,c);return d}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class gt{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return zt(this._values[t].value)}setValue(t,n){this._values[t]=new H(this._values[t].property,n===null?void 0:zt(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const c=this.getValue(n);c!==void 0&&(t[n]=c)}return t}possiblyEvaluate(t,n,c){const d=new xt(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(t,n,c);return d}}class mt{constructor(t,n,c){this.property=t,this.value=n,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,c,d){return this.property.evaluate(this.value,this.parameters,t,n,c,d)}}class xt{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class et{constructor(t){this.specification=t}possiblyEvaluate(t,n){return t.expression.evaluate(n)}interpolate(t,n,c){const d=Po[this.specification.type];return d?d(t,n,c):t}}class ft{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,c,d){return new mt(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},c,d)}:t.expression,n)}interpolate(t,n,c){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new mt(this,{kind:"constant",value:void 0},t.parameters);const d=Po[this.specification.type];return d?new mt(this,{kind:"constant",value:d(t.value.value,n.value.value,c)},t.parameters):t}evaluate(t,n,c,d,_,v){return t.kind==="constant"?t.value:t.evaluate(n,c,d,_,v)}}class St{constructor(t){this.specification=t}possiblyEvaluate(t,n,c,d){return!!t.expression.evaluate(n,null,{},c,d)}interpolate(){return!1}}class Et{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new j(0,{});for(const c in t){const d=t[c];d.specification.overridable&&this.overridableProperties.push(c);const _=this.defaultPropertyValues[c]=new H(d,void 0),v=this.defaultTransitionablePropertyValues[c]=new X(d);this.defaultTransitioningPropertyValues[c]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=_.possiblyEvaluate(n)}}}function $t(s,t){return 256*(s=pi(Math.floor(s),0,255))+pi(Math.floor(t),0,255)}oi(ft,"DataDrivenProperty"),oi(et,"DataConstantProperty"),oi(St,"ColorRampProperty");const Rt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Gt{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Jt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Yt(s,t=1){let n=0,c=0;return{members:s.map(d=>{const _=Rt[d.type].BYTES_PER_ELEMENT,v=n=ae(n,Math.max(t,_)),E=d.components||1;return c=Math.max(c,_),n+=_*E,{name:d.name,type:d.type,components:E,offset:v}}),size:ae(n,Math.max(c,t)),alignment:t}}function ae(s,t){return Math.ceil(s/t)*t}class ke extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const c=this.length;return this.resize(c+1),this.emplace(c,t,n)}emplace(t,n,c){const d=2*t;return this.int16[d+0]=n,this.int16[d+1]=c,t}}ke.prototype.bytesPerElement=4,oi(ke,"StructArrayLayout2i4");class se extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,c)}emplace(t,n,c,d){const _=3*t;return this.int16[_+0]=n,this.int16[_+1]=c,this.int16[_+2]=d,t}}se.prototype.bytesPerElement=6,oi(se,"StructArrayLayout3i6");class xe extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,c,d)}emplace(t,n,c,d,_){const v=4*t;return this.int16[v+0]=n,this.int16[v+1]=c,this.int16[v+2]=d,this.int16[v+3]=_,t}}xe.prototype.bytesPerElement=8,oi(xe,"StructArrayLayout4i8");class ue extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_,v,E){const k=this.length;return this.resize(k+1),this.emplace(k,t,n,c,d,_,v,E)}emplace(t,n,c,d,_,v,E,k){const L=6*t,N=12*t,V=3*t;return this.int16[L+0]=n,this.int16[L+1]=c,this.uint8[N+4]=d,this.uint8[N+5]=_,this.uint8[N+6]=v,this.uint8[N+7]=E,this.float32[V+2]=k,t}}ue.prototype.bytesPerElement=12,oi(ue,"StructArrayLayout2i4ub1f12");class Ie extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,c,d)}emplace(t,n,c,d,_){const v=4*t;return this.float32[v+0]=n,this.float32[v+1]=c,this.float32[v+2]=d,this.float32[v+3]=_,t}}Ie.prototype.bytesPerElement=16,oi(Ie,"StructArrayLayout4f16");class ee extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,c,d,_)}emplace(t,n,c,d,_,v){const E=6*t,k=3*t;return this.uint16[E+0]=n,this.uint16[E+1]=c,this.uint16[E+2]=d,this.uint16[E+3]=_,this.float32[k+2]=v,t}}ee.prototype.bytesPerElement=12,oi(ee,"StructArrayLayout4ui1f12");class ve extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,c,d)}emplace(t,n,c,d,_){const v=4*t;return this.uint16[v+0]=n,this.uint16[v+1]=c,this.uint16[v+2]=d,this.uint16[v+3]=_,t}}ve.prototype.bytesPerElement=8,oi(ve,"StructArrayLayout4ui8");class De extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_,v){const E=this.length;return this.resize(E+1),this.emplace(E,t,n,c,d,_,v)}emplace(t,n,c,d,_,v,E){const k=6*t;return this.int16[k+0]=n,this.int16[k+1]=c,this.int16[k+2]=d,this.int16[k+3]=_,this.int16[k+4]=v,this.int16[k+5]=E,t}}De.prototype.bytesPerElement=12,oi(De,"StructArrayLayout6i12");class ge extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_,v,E,k,L,N,V,W){const Y=this.length;return this.resize(Y+1),this.emplace(Y,t,n,c,d,_,v,E,k,L,N,V,W)}emplace(t,n,c,d,_,v,E,k,L,N,V,W,Y){const K=12*t;return this.int16[K+0]=n,this.int16[K+1]=c,this.int16[K+2]=d,this.int16[K+3]=_,this.uint16[K+4]=v,this.uint16[K+5]=E,this.uint16[K+6]=k,this.uint16[K+7]=L,this.int16[K+8]=N,this.int16[K+9]=V,this.int16[K+10]=W,this.int16[K+11]=Y,t}}ge.prototype.bytesPerElement=24,oi(ge,"StructArrayLayout4i4ui4i24");class Oe extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_,v){const E=this.length;return this.resize(E+1),this.emplace(E,t,n,c,d,_,v)}emplace(t,n,c,d,_,v,E){const k=10*t,L=5*t;return this.int16[k+0]=n,this.int16[k+1]=c,this.int16[k+2]=d,this.float32[L+2]=_,this.float32[L+3]=v,this.float32[L+4]=E,t}}Oe.prototype.bytesPerElement=20,oi(Oe,"StructArrayLayout3i3f20");class yi extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}yi.prototype.bytesPerElement=4,oi(yi,"StructArrayLayout1ul4");class ki extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_,v,E,k,L,N,V,W,Y){const K=this.length;return this.resize(K+1),this.emplace(K,t,n,c,d,_,v,E,k,L,N,V,W,Y)}emplace(t,n,c,d,_,v,E,k,L,N,V,W,Y,K){const st=20*t,ut=10*t;return this.int16[st+0]=n,this.int16[st+1]=c,this.int16[st+2]=d,this.int16[st+3]=_,this.int16[st+4]=v,this.float32[ut+3]=E,this.float32[ut+4]=k,this.float32[ut+5]=L,this.float32[ut+6]=N,this.int16[st+14]=V,this.uint32[ut+8]=W,this.uint16[st+18]=Y,this.uint16[st+19]=K,t}}ki.prototype.bytesPerElement=40,oi(ki,"StructArrayLayout5i4f1i1ul2ui40");class ai extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_,v,E){const k=this.length;return this.resize(k+1),this.emplace(k,t,n,c,d,_,v,E)}emplace(t,n,c,d,_,v,E,k){const L=8*t;return this.int16[L+0]=n,this.int16[L+1]=c,this.int16[L+2]=d,this.int16[L+4]=_,this.int16[L+5]=v,this.int16[L+6]=E,this.int16[L+7]=k,t}}ai.prototype.bytesPerElement=16,oi(ai,"StructArrayLayout3i2i2i16");class vi extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,c,d,_)}emplace(t,n,c,d,_,v){const E=4*t,k=8*t;return this.float32[E+0]=n,this.float32[E+1]=c,this.float32[E+2]=d,this.int16[k+6]=_,this.int16[k+7]=v,t}}vi.prototype.bytesPerElement=16,oi(vi,"StructArrayLayout2f1f2i16");class Oi extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,c,d)}emplace(t,n,c,d,_){const v=12*t,E=3*t;return this.uint8[v+0]=n,this.uint8[v+1]=c,this.float32[E+1]=d,this.float32[E+2]=_,t}}Oi.prototype.bytesPerElement=12,oi(Oi,"StructArrayLayout2ub2f12");class Ri extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,c)}emplace(t,n,c,d){const _=3*t;return this.float32[_+0]=n,this.float32[_+1]=c,this.float32[_+2]=d,t}}Ri.prototype.bytesPerElement=12,oi(Ri,"StructArrayLayout3f12");class mi extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,c)}emplace(t,n,c,d){const _=3*t;return this.uint16[_+0]=n,this.uint16[_+1]=c,this.uint16[_+2]=d,t}}mi.prototype.bytesPerElement=6,oi(mi,"StructArrayLayout3ui6");class xs extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_,v,E,k,L,N,V,W,Y,K,st,ut,vt,Pt,bt,Ct,Ft){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,t,n,c,d,_,v,E,k,L,N,V,W,Y,K,st,ut,vt,Pt,bt,Ct,Ft)}emplace(t,n,c,d,_,v,E,k,L,N,V,W,Y,K,st,ut,vt,Pt,bt,Ct,Ft,Ot){const he=30*t,oe=15*t,_e=60*t;return this.int16[he+0]=n,this.int16[he+1]=c,this.int16[he+2]=d,this.float32[oe+2]=_,this.float32[oe+3]=v,this.uint16[he+8]=E,this.uint16[he+9]=k,this.uint32[oe+5]=L,this.uint32[oe+6]=N,this.uint32[oe+7]=V,this.uint16[he+16]=W,this.uint16[he+17]=Y,this.uint16[he+18]=K,this.float32[oe+10]=st,this.float32[oe+11]=ut,this.uint8[_e+48]=vt,this.uint8[_e+49]=Pt,this.uint8[_e+50]=bt,this.uint32[oe+13]=Ct,this.int16[he+28]=Ft,this.uint8[_e+58]=Ot,t}}xs.prototype.bytesPerElement=60,oi(xs,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ws extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_,v,E,k,L,N,V,W,Y,K,st,ut,vt,Pt,bt,Ct,Ft,Ot,he,oe,_e,Re,de,we,Te,Pe){const Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,t,n,c,d,_,v,E,k,L,N,V,W,Y,K,st,ut,vt,Pt,bt,Ct,Ft,Ot,he,oe,_e,Re,de,we,Te,Pe)}emplace(t,n,c,d,_,v,E,k,L,N,V,W,Y,K,st,ut,vt,Pt,bt,Ct,Ft,Ot,he,oe,_e,Re,de,we,Te,Pe,Ne){const me=38*t,qe=19*t;return this.int16[me+0]=n,this.int16[me+1]=c,this.int16[me+2]=d,this.float32[qe+2]=_,this.float32[qe+3]=v,this.int16[me+8]=E,this.int16[me+9]=k,this.int16[me+10]=L,this.int16[me+11]=N,this.int16[me+12]=V,this.int16[me+13]=W,this.uint16[me+14]=Y,this.uint16[me+15]=K,this.uint16[me+16]=st,this.uint16[me+17]=ut,this.uint16[me+18]=vt,this.uint16[me+19]=Pt,this.uint16[me+20]=bt,this.uint16[me+21]=Ct,this.uint16[me+22]=Ft,this.uint16[me+23]=Ot,this.uint16[me+24]=he,this.uint16[me+25]=oe,this.uint16[me+26]=_e,this.uint16[me+27]=Re,this.uint16[me+28]=de,this.uint32[qe+15]=we,this.float32[qe+16]=Te,this.float32[qe+17]=Pe,this.float32[qe+18]=Ne,t}}ws.prototype.bytesPerElement=76,oi(ws,"StructArrayLayout3i2f6i15ui1ul3f76");class Ts extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}Ts.prototype.bytesPerElement=4,oi(Ts,"StructArrayLayout1f4");class Ss extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,c,d,_)}emplace(t,n,c,d,_,v){const E=5*t;return this.float32[E+0]=n,this.float32[E+1]=c,this.float32[E+2]=d,this.float32[E+3]=_,this.float32[E+4]=v,t}}Ss.prototype.bytesPerElement=20,oi(Ss,"StructArrayLayout5f20");class or extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,c,d)}emplace(t,n,c,d,_){const v=6*t;return this.uint32[3*t+0]=n,this.uint16[v+2]=c,this.uint16[v+3]=d,this.uint16[v+4]=_,t}}or.prototype.bytesPerElement=12,oi(or,"StructArrayLayout1ul3ui12");class qn extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const c=this.length;return this.resize(c+1),this.emplace(c,t,n)}emplace(t,n,c){const d=2*t;return this.uint16[d+0]=n,this.uint16[d+1]=c,t}}qn.prototype.bytesPerElement=4,oi(qn,"StructArrayLayout2ui4");class Vr extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}Vr.prototype.bytesPerElement=2,oi(Vr,"StructArrayLayout1ui2");class bs extends Jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const c=this.length;return this.resize(c+1),this.emplace(c,t,n)}emplace(t,n,c){const d=2*t;return this.float32[d+0]=n,this.float32[d+1]=c,t}}bs.prototype.bytesPerElement=8,oi(bs,"StructArrayLayout2f8");class Us extends Gt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Us.prototype.size=40;class Ps extends ki{get(t){return new Us(this,t)}}oi(Ps,"CollisionBoxArray");class os extends Gt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}os.prototype.size=60;class Mn extends xs{get(t){return new os(this,t)}}oi(Mn,"PlacedSymbolArray");class mr extends Gt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}mr.prototype.size=76;class Vs extends ws{get(t){return new mr(this,t)}}oi(Vs,"SymbolInstanceArray");class On extends Ts{getoffsetX(t){return this.float32[1*t+0]}}oi(On,"GlyphOffsetArray");class Wh extends ke{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}oi(Wh,"SymbolLineVertexArray");class ra extends Gt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ra.prototype.size=12;class ql extends or{get(t){return new ra(this,t)}}oi(ql,"FeatureIndexArray");class Do extends qn{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}oi(Do,"FillExtrusionCentroidArray");const oa=Yt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ll=Yt([{name:"a_dash",components:4,type:"Uint16"}]);var hn={exports:{}},$c={exports:{}};$c.exports=function(s,t){var n,c,d,_,v,E,k,L;for(c=s.length-(n=3&s.length),d=t,v=3432918353,E=461845907,L=0;L<c;)k=255&s.charCodeAt(L)|(255&s.charCodeAt(++L))<<8|(255&s.charCodeAt(++L))<<16|(255&s.charCodeAt(++L))<<24,++L,d=27492+(65535&(_=5*(65535&(d=(d^=k=(65535&(k=(k=(65535&k)*v+(((k>>>16)*v&65535)<<16)&4294967295)<<15|k>>>17))*E+(((k>>>16)*E&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(k=0,n){case 3:k^=(255&s.charCodeAt(L+2))<<16;case 2:k^=(255&s.charCodeAt(L+1))<<8;case 1:d^=k=(65535&(k=(k=(65535&(k^=255&s.charCodeAt(L)))*v+(((k>>>16)*v&65535)<<16)&4294967295)<<15|k>>>17))*E+(((k>>>16)*E&65535)<<16)&4294967295}return d^=s.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0};var xd=$c.exports,wm={exports:{}};wm.exports=function(s,t){for(var n,c=s.length,d=t^c,_=0;c>=4;)n=1540483477*(65535&(n=255&s.charCodeAt(_)|(255&s.charCodeAt(++_))<<8|(255&s.charCodeAt(++_))<<16|(255&s.charCodeAt(++_))<<24))+((1540483477*(n>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),c-=4,++_;switch(c){case 3:d^=(255&s.charCodeAt(_+2))<<16;case 2:d^=(255&s.charCodeAt(_+1))<<8;case 1:d=1540483477*(65535&(d^=255&s.charCodeAt(_)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var vd=xd,Hh=wm.exports;hn.exports=vd,hn.exports.murmur3=vd,hn.exports.murmur2=Hh;var Tm=It(hn.exports);class nn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,c,d){this.ids.push(c_(t)),this.positions.push(n,c,d)}getPositions(t){const n=c_(t);let c=0,d=this.ids.length-1;for(;c<d;){const v=c+d>>1;this.ids[v]>=n?d=v:c=v+1}const _=[];for(;this.ids[c]===n;)_.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return _}static serialize(t,n){const c=new Float64Array(t.ids),d=new Uint32Array(t.positions);return Hf(c,d,0,c.length-1),n&&n.push(c.buffer,d.buffer),{ids:c,positions:d}}static deserialize(t){const n=new nn;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function c_(s){const t=+s;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Tm(String(s))}function Hf(s,t,n,c){for(;n<c;){const d=s[n+c>>1];let _=n-1,v=c+1;for(;;){do _++;while(s[_]<d);do v--;while(s[v]>d);if(_>=v)break;bd(s,_,v),bd(t,3*_,3*v),bd(t,3*_+1,3*v+1),bd(t,3*_+2,3*v+2)}v-n<c-v?(Hf(s,t,n,v),n=v+1):(Hf(s,t,v+1,c),c=v)}}function bd(s,t,n){const c=s[t];s[t]=s[n],s[n]=c}oi(nn,"FeaturePositionMap");class Ca{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,n),this.initialized=!0),!!this.location}}class Ln extends Ca{constructor(t){super(t),this.current=0}set(t,n,c){this.fetchUniformLocation(t,n)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class h_ extends Ca{constructor(t){super(t),this.current=[0,0,0,0]}set(t,n,c){this.fetchUniformLocation(t,n)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class Xh extends Ca{constructor(t){super(t),this.current=gn.transparent}set(t,n,c){this.fetchUniformLocation(t,n)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const Sm=new Float32Array(16),_n=new Float32Array(9),Xx=new Float32Array(4);function Xf(s){return[$t(255*s.r,255*s.g),$t(255*s.b,255*s.a)]}class Ir{constructor(t,n,c){this.value=t,this.uniformNames=n.map(d=>`u_${d}`),this.type=c}setUniform(t,n,c,d,_){n.set(t,_,d.constantOr(this.value))}getBinding(t,n){return this.type==="color"?new Xh(t):new Ln(t)}}class ar{constructor(t,n){this.uniformNames=n.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,n,c,d,_){const v=_==="u_pattern"||_==="u_dash"?this.pattern:_==="u_pixel_ratio"?this.pixelRatio:null;v&&n.set(t,_,v)}getBinding(t,n){return n==="u_pattern"||n==="u_dash"?new h_(t):new Ln(t)}}class cl{constructor(t,n,c,d){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(t,n,c,d,_,v){const E=this.paintVertexArray.length,k=this.expression.evaluate(new j(0),n,{},_,d,v);this.paintVertexArray.resize(t),this._setPaintValue(E,t,k)}updatePaintArray(t,n,c,d,_){const v=this.expression.evaluate({zoom:0},c,d,void 0,_);this._setPaintValue(t,n,v)}_setPaintValue(t,n,c){if(this.type==="color"){const d=Xf(c);for(let _=t;_<n;_++)this.paintVertexArray.emplace(_,d[0],d[1])}else{for(let d=t;d<n;d++)this.paintVertexArray.emplace(d,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class aa{constructor(t,n,c,d,_,v){this.expression=t,this.uniformNames=n.map(E=>`u_${E}_t`),this.type=c,this.useIntegerZoom=d,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=n.map(E=>({name:`a_${E}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(t,n,c,d,_,v){const E=this.expression.evaluate(new j(this.zoom),n,{},_,d,v),k=this.expression.evaluate(new j(this.zoom+1),n,{},_,d,v),L=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(L,t,E,k)}updatePaintArray(t,n,c,d,_){const v=this.expression.evaluate({zoom:this.zoom},c,d,void 0,_),E=this.expression.evaluate({zoom:this.zoom+1},c,d,void 0,_);this._setPaintValue(t,n,v,E)}_setPaintValue(t,n,c,d){if(this.type==="color"){const _=Xf(c),v=Xf(d);for(let E=t;E<n;E++)this.paintVertexArray.emplace(E,_[0],_[1],v[0],v[1])}else{for(let _=t;_<n;_++)this.paintVertexArray.emplace(_,c,d);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(d))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n,c,d,_){const v=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,E=pi(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);n.set(t,_,E)}getBinding(t,n){return new Ln(t)}}class hl{constructor(t,n,c,d,_){this.expression=t,this.layerId=_,this.paintVertexAttributes=(c==="array"?ll:oa).members;for(let v=0;v<n.length;++v);this.paintVertexArray=new d}populatePaintArray(t,n,c){const d=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(d,t,n.patterns&&n.patterns[this.layerId],c)}updatePaintArray(t,n,c,d,_,v){this._setPaintValues(t,n,c.patterns&&c.patterns[this.layerId],v)}_setPaintValues(t,n,c,d){if(!d||!c)return;const _=d[c];if(!_)return;const{tl:v,br:E,pixelRatio:k}=_;for(let L=t;L<n;L++)this.paintVertexArray.emplace(L,v[0],v[1],E[0],E[1],k)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Zl{constructor(t,n,c=()=>!0){this.binders={},this._buffers=[];const d=[];for(const _ in t.paint._values){if(!c(_))continue;const v=t.paint.get(_);if(!(v instanceof mt&&Fl(v.property.specification)))continue;const E=Zx(_,t.type),k=v.value,L=v.property.specification.type,N=!!v.property.useIntegerZoom,V=_==="line-dasharray"||_.endsWith("pattern"),W=_==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(k.kind!=="constant"||W)if(k.kind==="source"||W||V){const Y=u_(_,L,"source");this.binders[_]=V?new hl(k,E,L,Y,t.id):new cl(k,E,L,Y),d.push(`/a_${_}`)}else{const Y=u_(_,L,"composite");this.binders[_]=new aa(k,E,L,N,n,Y),d.push(`/z_${_}`)}else this.binders[_]=V?new ar(k.value,E):new Ir(k.value,E,L),d.push(`/u_${_}`)}this.cacheKey=d.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof cl||n instanceof aa?n.maxValue:0}populatePaintArrays(t,n,c,d,_,v){for(const E in this.binders){const k=this.binders[E];(k instanceof cl||k instanceof aa||k instanceof hl)&&k.populatePaintArray(t,n,c,d,_,v)}}setConstantPatternPositions(t){for(const n in this.binders){const c=this.binders[n];c instanceof ar&&c.setConstantPatternPositions(t)}}updatePaintArrays(t,n,c,d,_,v){let E=!1;for(const k in t){const L=n.getPositions(k);for(const N of L){const V=c.feature(N.index);for(const W in this.binders){const Y=this.binders[W];if((Y instanceof cl||Y instanceof aa||Y instanceof hl)&&Y.expression.isStateDependent===!0){const K=d.paint.get(W);Y.expression=K.value,Y.updatePaintArray(N.start,N.end,V,t[k],_,v),E=!0}}}}return E}defines(){const t=[];for(const n in this.binders){const c=this.binders[n];(c instanceof Ir||c instanceof ar)&&t.push(...c.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const c=this.binders[n];if(c instanceof cl||c instanceof aa||c instanceof hl)for(let d=0;d<c.paintVertexAttributes.length;d++)t.push(c.paintVertexAttributes[d].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const c=this.binders[n];if(c instanceof Ir||c instanceof ar||c instanceof aa)for(const d of c.uniformNames)t.push(d)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const n=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof Ir||d instanceof ar||d instanceof aa)for(const _ of d.uniformNames)n.push({name:_,property:c,binding:d.getBinding(t,_)})}return n}setUniforms(t,n,c,d,_){for(const{name:v,property:E,binding:k}of c)this.binders[E].setUniform(t,k,_,d.get(E),v)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const n=this.binders[t];(n instanceof cl||n instanceof aa||n instanceof hl)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(t){for(const n in this.binders){const c=this.binders[n];(c instanceof cl||c instanceof aa||c instanceof hl)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof cl||n instanceof aa||n instanceof hl)&&n.destroy()}}}class Yl{constructor(t,n,c=()=>!0){this.programConfigurations={};for(const d of t)this.programConfigurations[d.id]=new Zl(d,n,c);this.needsUpload=!1,this._featureMap=new nn,this._bufferOffset=0}populatePaintArrays(t,n,c,d,_,v,E){for(const k in this.programConfigurations)this.programConfigurations[k].populatePaintArrays(t,n,d,_,v,E);n.id!==void 0&&this._featureMap.add(n.id,c,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,c,d,_){for(const v of c)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(t,this._featureMap,n,v,d,_)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const qx={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Zx(s,t){return qx[s]||[s.replace(`${t}-`,"").replace(/-/g,"_")]}const qf={"line-pattern":{source:ee,composite:ee},"fill-pattern":{source:ee,composite:ee},"fill-extrusion-pattern":{source:ee,composite:ee},"line-dasharray":{source:ve,composite:ve}},Yx={color:{source:bs,composite:Ie},number:{source:Ts,composite:bs}};function u_(s,t,n){const c=qf[s];return c&&c[n]||Yx[t][n]}oi(Ir,"ConstantBinder"),oi(ar,"PatternConstantBinder"),oi(cl,"SourceExpressionBinder"),oi(hl,"PatternCompositeBinder"),oi(aa,"CompositeExpressionBinder"),oi(Zl,"ProgramConfiguration",{omit:["_buffers"]}),oi(Yl,"ProgramConfigurationSet");const Zf="-transition";class la extends Is{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new gt(n.layout)),n.paint)){this._transitionablePaint=new tt(n.paint);for(const c in t.paint)this.setPaintProperty(c,t.paint[c],{validate:!1});for(const c in t.layout)this.setLayoutProperty(c,t.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xt(n.paint)}}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,c={}){n!=null&&this._validate(Vf,`layers.${this.id}.layout.${t}`,t,n,c)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return ss(t,Zf)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,c={}){if(n!=null&&this._validate(xm,`layers.${this.id}.paint.${t}`,t,n,c))return!1;if(ss(t,Zf))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const d=this._transitionablePaint._values[t],_=d.value.isDataDriven(),v=d.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const E=this._transitionablePaint._values[t].value,k=E.isDataDriven(),L=ss(t,"pattern")||t==="line-dasharray";return k||_||L||this._handleOverridablePaintPropertyUpdate(t,v,E)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,n,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),_t(t,(n,c)=>!(n===void 0||c==="layout"&&!Object.keys(n).length||c==="paint"&&!Object.keys(n).length))}_validate(t,n,c,d,_={}){return(!_||_.validate!==!1)&&$f(this,t.call(Uc,{key:n,layerType:this.type,objectKey:c,value:d,styleSpec:pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof mt&&Fl(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Fh(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Kx=Yt([{name:"a_pos",components:2,type:"Int16"}],4),ul=Yt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class yn{constructor(t=[]){this.segments=t}prepareSegment(t,n,c,d){let _=this.segments[this.segments.length-1];return t>yn.MAX_VERTEX_ARRAY_LENGTH&&Se(`Max vertices per segment is ${yn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!_||_.vertexLength+t>yn.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==d)&&(_={vertexOffset:n.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},d!==void 0&&(_.sortKey=d),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,c,d){return new yn([{vertexOffset:t,primitiveOffset:n,vertexLength:c,primitiveLength:d,vaos:{},sortKey:0}])}}yn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,oi(yn,"SegmentVector");var gi=8192;class Jn{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Es?new Es(t.lng,t.lat):Es.convert(t),this}setSouthWest(t){return this._sw=t instanceof Es?new Es(t.lng,t.lat):Es.convert(t),this}extend(t){const n=this._sw,c=this._ne;let d,_;if(t instanceof Es)d=t,_=t;else{if(!(t instanceof Jn))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Jn.convert(t)):this.extend(Es.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(Es.convert(t)):this;if(d=t._sw,_=t._ne,!d||!_)return this}return n||c?(n.lng=Math.min(d.lng,n.lng),n.lat=Math.min(d.lat,n.lat),c.lng=Math.max(_.lng,c.lng),c.lat=Math.max(_.lat,c.lat)):(this._sw=new Es(d.lng,d.lat),this._ne=new Es(_.lng,_.lat)),this}getCenter(){return new Es((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Es(this.getWest(),this.getNorth())}getSouthEast(){return new Es(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:c}=Es.convert(t);let d=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&d}static convert(t){return!t||t instanceof Jn?t:new Jn(t)}}var Yf=1e-6,$r=typeof Float32Array<"u"?Float32Array:Array;function d_(){var s=new $r(9);return $r!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function f_(s,t,n){var c=t[0],d=t[1],_=t[2],v=t[3],E=t[4],k=t[5],L=t[6],N=t[7],V=t[8],W=n[0],Y=n[1],K=n[2],st=n[3],ut=n[4],vt=n[5],Pt=n[6],bt=n[7],Ct=n[8];return s[0]=W*c+Y*v+K*L,s[1]=W*d+Y*E+K*N,s[2]=W*_+Y*k+K*V,s[3]=st*c+ut*v+vt*L,s[4]=st*d+ut*E+vt*N,s[5]=st*_+ut*k+vt*V,s[6]=Pt*c+bt*v+Ct*L,s[7]=Pt*d+bt*E+Ct*N,s[8]=Pt*_+bt*k+Ct*V,s}function co(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Kf(s,t){var n=t[0],c=t[1],d=t[2],_=t[3],v=t[4],E=t[5],k=t[6],L=t[7],N=t[8],V=t[9],W=t[10],Y=t[11],K=t[12],st=t[13],ut=t[14],vt=t[15],Pt=n*E-c*v,bt=n*k-d*v,Ct=n*L-_*v,Ft=c*k-d*E,Ot=c*L-_*E,he=d*L-_*k,oe=N*st-V*K,_e=N*ut-W*K,Re=N*vt-Y*K,de=V*ut-W*st,we=V*vt-Y*st,Te=W*vt-Y*ut,Pe=Pt*Te-bt*we+Ct*de+Ft*Re-Ot*_e+he*oe;return Pe?(s[0]=(E*Te-k*we+L*de)*(Pe=1/Pe),s[1]=(d*we-c*Te-_*de)*Pe,s[2]=(st*he-ut*Ot+vt*Ft)*Pe,s[3]=(W*Ot-V*he-Y*Ft)*Pe,s[4]=(k*Re-v*Te-L*_e)*Pe,s[5]=(n*Te-d*Re+_*_e)*Pe,s[6]=(ut*Ct-K*he-vt*bt)*Pe,s[7]=(N*he-W*Ct+Y*bt)*Pe,s[8]=(v*we-E*Re+L*oe)*Pe,s[9]=(c*Re-n*we-_*oe)*Pe,s[10]=(K*Ot-st*Ct+vt*Pt)*Pe,s[11]=(V*Ct-N*Ot-Y*Pt)*Pe,s[12]=(E*_e-v*de-k*oe)*Pe,s[13]=(n*de-c*_e+d*oe)*Pe,s[14]=(st*bt-K*Ft-ut*Pt)*Pe,s[15]=(N*Ft-V*bt+W*Pt)*Pe,s):null}function dl(s,t,n){var c=t[0],d=t[1],_=t[2],v=t[3],E=t[4],k=t[5],L=t[6],N=t[7],V=t[8],W=t[9],Y=t[10],K=t[11],st=t[12],ut=t[13],vt=t[14],Pt=t[15],bt=n[0],Ct=n[1],Ft=n[2],Ot=n[3];return s[0]=bt*c+Ct*E+Ft*V+Ot*st,s[1]=bt*d+Ct*k+Ft*W+Ot*ut,s[2]=bt*_+Ct*L+Ft*Y+Ot*vt,s[3]=bt*v+Ct*N+Ft*K+Ot*Pt,s[4]=(bt=n[4])*c+(Ct=n[5])*E+(Ft=n[6])*V+(Ot=n[7])*st,s[5]=bt*d+Ct*k+Ft*W+Ot*ut,s[6]=bt*_+Ct*L+Ft*Y+Ot*vt,s[7]=bt*v+Ct*N+Ft*K+Ot*Pt,s[8]=(bt=n[8])*c+(Ct=n[9])*E+(Ft=n[10])*V+(Ot=n[11])*st,s[9]=bt*d+Ct*k+Ft*W+Ot*ut,s[10]=bt*_+Ct*L+Ft*Y+Ot*vt,s[11]=bt*v+Ct*N+Ft*K+Ot*Pt,s[12]=(bt=n[12])*c+(Ct=n[13])*E+(Ft=n[14])*V+(Ot=n[15])*st,s[13]=bt*d+Ct*k+Ft*W+Ot*ut,s[14]=bt*_+Ct*L+Ft*Y+Ot*vt,s[15]=bt*v+Ct*N+Ft*K+Ot*Pt,s}function wd(s,t,n){var c,d,_,v,E,k,L,N,V,W,Y,K,st=n[0],ut=n[1],vt=n[2];return t===s?(s[12]=t[0]*st+t[4]*ut+t[8]*vt+t[12],s[13]=t[1]*st+t[5]*ut+t[9]*vt+t[13],s[14]=t[2]*st+t[6]*ut+t[10]*vt+t[14],s[15]=t[3]*st+t[7]*ut+t[11]*vt+t[15]):(d=t[1],_=t[2],v=t[3],E=t[4],k=t[5],L=t[6],N=t[7],V=t[8],W=t[9],Y=t[10],K=t[11],s[0]=c=t[0],s[1]=d,s[2]=_,s[3]=v,s[4]=E,s[5]=k,s[6]=L,s[7]=N,s[8]=V,s[9]=W,s[10]=Y,s[11]=K,s[12]=c*st+E*ut+V*vt+t[12],s[13]=d*st+k*ut+W*vt+t[13],s[14]=_*st+L*ut+Y*vt+t[14],s[15]=v*st+N*ut+K*vt+t[15]),s}function fl(s,t,n){var c=n[0],d=n[1],_=n[2];return s[0]=t[0]*c,s[1]=t[1]*c,s[2]=t[2]*c,s[3]=t[3]*c,s[4]=t[4]*d,s[5]=t[5]*d,s[6]=t[6]*d,s[7]=t[7]*d,s[8]=t[8]*_,s[9]=t[9]*_,s[10]=t[10]*_,s[11]=t[11]*_,s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15],s}function Td(s,t,n){var c=Math.sin(n),d=Math.cos(n),_=t[4],v=t[5],E=t[6],k=t[7],L=t[8],N=t[9],V=t[10],W=t[11];return t!==s&&(s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s[4]=_*d+L*c,s[5]=v*d+N*c,s[6]=E*d+V*c,s[7]=k*d+W*c,s[8]=L*d-_*c,s[9]=N*d-v*c,s[10]=V*d-E*c,s[11]=W*d-k*c,s}function Jf(s,t,n){var c=Math.sin(n),d=Math.cos(n),_=t[0],v=t[1],E=t[2],k=t[3],L=t[8],N=t[9],V=t[10],W=t[11];return t!==s&&(s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s[0]=_*d-L*c,s[1]=v*d-N*c,s[2]=E*d-V*c,s[3]=k*d-W*c,s[8]=_*c+L*d,s[9]=v*c+N*d,s[10]=E*c+V*d,s[11]=k*c+W*d,s}function Em(s,t){return s[0]=t[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=t[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=t[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Kl(s,t,n){var c,d,_,v=n[0],E=n[1],k=n[2],L=Math.hypot(v,E,k);return L<Yf?null:(v*=L=1/L,E*=L,k*=L,c=Math.sin(t),d=Math.cos(t),s[0]=v*v*(_=1-d)+d,s[1]=E*v*_+k*c,s[2]=k*v*_-E*c,s[3]=0,s[4]=v*E*_-k*c,s[5]=E*E*_+d,s[6]=k*E*_+v*c,s[7]=0,s[8]=v*k*_+E*c,s[9]=E*k*_-v*c,s[10]=k*k*_+d,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,t=arguments.length;t--;)s+=arguments[t]*arguments[t];return Math.sqrt(s)});var Sd=dl;function Qf(){var s=new $r(3);return $r!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function p_(s){var t=new $r(3);return t[0]=s[0],t[1]=s[1],t[2]=s[2],t}function qh(s){return Math.hypot(s[0],s[1],s[2])}function Jl(s,t,n){var c=new $r(3);return c[0]=s,c[1]=t,c[2]=n,c}function ca(s,t,n){return s[0]=t[0]+n[0],s[1]=t[1]+n[1],s[2]=t[2]+n[2],s}function tp(s,t,n){return s[0]=t[0]-n[0],s[1]=t[1]-n[1],s[2]=t[2]-n[2],s}function ep(s,t,n){return s[0]=t[0]*n[0],s[1]=t[1]*n[1],s[2]=t[2]*n[2],s}function Lr(s,t,n){return s[0]=Math.min(t[0],n[0]),s[1]=Math.min(t[1],n[1]),s[2]=Math.min(t[2],n[2]),s}function zo(s,t,n){return s[0]=Math.max(t[0],n[0]),s[1]=Math.max(t[1],n[1]),s[2]=Math.max(t[2],n[2]),s}function Gr(s,t,n){return s[0]=t[0]*n,s[1]=t[1]*n,s[2]=t[2]*n,s}function Ed(s,t,n,c){return s[0]=t[0]+n[0]*c,s[1]=t[1]+n[1]*c,s[2]=t[2]+n[2]*c,s}function Mr(s,t){var n=t[0],c=t[1],d=t[2],_=n*n+c*c+d*d;return _>0&&(_=1/Math.sqrt(_)),s[0]=t[0]*_,s[1]=t[1]*_,s[2]=t[2]*_,s}function Wr(s,t){return s[0]*t[0]+s[1]*t[1]+s[2]*t[2]}function ka(s,t,n){var c=t[0],d=t[1],_=t[2],v=n[0],E=n[1],k=n[2];return s[0]=d*k-_*E,s[1]=_*v-c*k,s[2]=c*E-d*v,s}function rn(s,t,n){var c=t[0],d=t[1],_=t[2],v=n[3]*c+n[7]*d+n[11]*_+n[15];return s[0]=(n[0]*c+n[4]*d+n[8]*_+n[12])/(v=v||1),s[1]=(n[1]*c+n[5]*d+n[9]*_+n[13])/v,s[2]=(n[2]*c+n[6]*d+n[10]*_+n[14])/v,s}function gs(s,t,n){var c=n[0],d=n[1],_=n[2],v=t[0],E=t[1],k=t[2],L=d*k-_*E,N=_*v-c*k,V=c*E-d*v,W=d*V-_*N,Y=_*L-c*V,K=c*N-d*L,st=2*n[3];return N*=st,V*=st,Y*=2,K*=2,s[0]=v+(L*=st)+(W*=2),s[1]=E+N+Y,s[2]=k+V+K,s}var Md,ho=tp,Jx=ep,Zh=qh;function m_(s,t,n){return s[0]=t[0]*n,s[1]=t[1]*n,s[2]=t[2]*n,s[3]=t[3]*n,s}function Ad(s,t){var n=t[0],c=t[1],d=t[2],_=t[3],v=n*n+c*c+d*d+_*_;return v>0&&(v=1/Math.sqrt(v)),s[0]=n*v,s[1]=c*v,s[2]=d*v,s[3]=_*v,s}function Ar(s,t,n){var c=t[0],d=t[1],_=t[2],v=t[3];return s[0]=n[0]*c+n[4]*d+n[8]*_+n[12]*v,s[1]=n[1]*c+n[5]*d+n[9]*_+n[13]*v,s[2]=n[2]*c+n[6]*d+n[10]*_+n[14]*v,s[3]=n[3]*c+n[7]*d+n[11]*_+n[15]*v,s}function ip(){var s=new $r(4);return $r!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function lr(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function g_(s,t,n){n*=.5;var c=t[0],d=t[1],_=t[2],v=t[3],E=Math.sin(n),k=Math.cos(n);return s[0]=c*k+v*E,s[1]=d*k+_*E,s[2]=_*k-d*E,s[3]=v*k-c*E,s}function Mm(s,t,n){n*=.5;var c=t[0],d=t[1],_=t[2],v=t[3],E=Math.sin(n),k=Math.cos(n);return s[0]=c*k-_*E,s[1]=d*k+v*E,s[2]=_*k+c*E,s[3]=v*k-d*E,s}Qf(),Md=new $r(4),$r!=Float32Array&&(Md[0]=0,Md[1]=0,Md[2]=0,Md[3]=0);var __=Ad;Qf(),Jl(1,0,0),Jl(0,1,0),ip(),ip(),d_();const sp=Yt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:y_}=sp,x_=Yt([{name:"a_pos_3",components:3,type:"Int16"}]);var Oo=Yt([{name:"a_pos",type:"Int16",components:2}]);class Am{constructor(t,n){this.pos=t,this.dir=n}intersectsPlane(t,n,c){const d=Wr(n,this.dir);if(Math.abs(d)<1e-6)return!1;const _=((t[0]-this.pos[0])*n[0]+(t[1]-this.pos[1])*n[1]+(t[2]-this.pos[2])*n[2])/d;return c[0]=this.pos[0]+this.dir[0]*_,c[1]=this.pos[1]+this.dir[1]*_,c[2]=this.pos[2]+this.dir[2]*_,!0}closestPointOnSphere(t,n,c){if(function(Y,K){var st=Y[0],ut=Y[1],vt=Y[2],Pt=K[0],bt=K[1],Ct=K[2];return Math.abs(st-Pt)<=Yf*Math.max(1,Math.abs(st),Math.abs(Pt))&&Math.abs(ut-bt)<=Yf*Math.max(1,Math.abs(ut),Math.abs(bt))&&Math.abs(vt-Ct)<=Yf*Math.max(1,Math.abs(vt),Math.abs(Ct))}(this.pos,t)||n===0)return c[0]=c[1]=c[2]=0,!1;const[d,_,v]=this.dir,E=this.pos[0]-t[0],k=this.pos[1]-t[1],L=this.pos[2]-t[2],N=d*d+_*_+v*v,V=2*(E*d+k*_+L*v),W=V*V-4*N*(E*E+k*k+L*L-n*n);if(W<0){const Y=Math.max(-V/2,0),K=E+d*Y,st=k+_*Y,ut=L+v*Y,vt=Math.hypot(K,st,ut);return c[0]=K*n/vt,c[1]=st*n/vt,c[2]=ut*n/vt,!1}{const Y=(-V-Math.sqrt(W))/(2*N);if(Y<0){const K=Math.hypot(E,k,L);return c[0]=E*n/K,c[1]=k*n/K,c[2]=L*n/K,!1}return c[0]=E+d*Y,c[1]=k+_*Y,c[2]=L+v*Y,!0}}}class Cm{constructor(t,n,c,d,_){this.TL=t,this.TR=n,this.BR=c,this.BL=d,this.horizon=_}static fromInvProjectionMatrix(t,n,c){const d=[-1,1,1],_=[1,1,1],v=[1,-1,1],E=[-1,-1,1],k=rn(d,d,t),L=rn(_,_,t),N=rn(v,v,t),V=rn(E,E,t);return new Cm(k,L,N,V,n/c)}}class Pa{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,c,d){const _=Math.pow(2,c),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(k=>{const L=Ar([],k,t),N=1/L[3]/n*_;return function(V,W,Y){return V[0]=W[0]*Y[0],V[1]=W[1]*Y[1],V[2]=W[2]*Y[2],V[3]=W[3]*Y[3],V}(L,L,[N,N,d?1/L[3]:N,N])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(k=>{const L=Mr([],ka([],ho([],v[k[0]],v[k[1]]),ho([],v[k[2]],v[k[1]]))),N=-Wr(L,v[k[1]]);return L.concat(N)});return new Pa(v,E)}}class Qn{static fromPoints(t){const n=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const d of t)Lr(n,n,d),zo(c,c,d);return new Qn(n,c)}static applyTransform(t,n){const c=t.getCorners();for(let d=0;d<c.length;++d)rn(c[d],c[d],n);return Qn.fromPoints(c)}constructor(t,n){this.min=t,this.max=n,this.center=Gr([],ca([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],c=p_(this.min),d=p_(this.max);for(let _=0;_<n.length;_++)c[_]=n[_]?this.min[_]:this.center[_],d[_]=n[_]?this.center[_]:this.max[_];return d[2]=this.max[2],new Qn(c,d)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,n=this.max;return[[t[0],t[1],t[2]],[n[0],t[1],t[2]],[n[0],n[1],t[2]],[t[0],n[1],t[2]],[t[0],t[1],n[2]],[n[0],t[1],n[2]],[n[0],n[1],n[2]],[t[0],n[1],n[2]]]}intersects(t){const n=this.getCorners();let c=!0;for(let d=0;d<t.planes.length;d++){const _=t.planes[d];let v=0;for(let E=0;E<n.length;E++)v+=Wr(_,n[E])+_[3]>=0;if(v===0)return 0;v!==n.length&&(c=!1)}if(c)return 2;for(let d=0;d<3;d++){let _=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let E=0;E<t.points.length;E++){const k=t.points[E][d]-this.min[d];_=Math.min(_,k),v=Math.max(v,k)}if(v<0||_>this.max[d]-this.min[d])return 0}return 1}}const Cd=5,np=6,Ia=gi/Math.PI/2,v_=16383,Ql=64,kd=[Ql,32,16],uo=-Ia,Cr=Ia,Qx=[new Qn([uo,uo,uo],[Cr,Cr,Cr]),new Qn([uo,uo,uo],[0,0,Cr]),new Qn([0,uo,uo],[Cr,0,Cr]),new Qn([uo,0,uo],[0,Cr,Cr]),new Qn([0,0,uo],[Cr,Cr,Cr])];function rp(s){return s*Ia/Dd}function b_(s,t,n,c=!0){const d=Gr([],s._camera.position,s.worldSize),_=[t,n,1,1];Ar(_,_,s.pixelMatrixInverse),m_(_,_,1/_[3]);const v=Mr([],ho([],_,d)),E=s.globeMatrix,k=[E[12],E[13],E[14]],L=ho([],k,d),N=qh(L),V=Mr([],L),W=s.worldSize/(2*Math.PI),Y=Wr(V,v),K=Math.asin(W/N);if(K<Math.acos(Y)){if(!c)return null;const Re=[],de=[];Gr(Re,v,N/Y),Mr(de,ho(de,Re,L)),Mr(v,ca(v,L,Gr(v,de,Math.tan(K)*N)))}const st=[];new Am(d,v).closestPointOnSphere(k,W,st);const ut=Mr([],ti(E,0)),vt=Mr([],ti(E,1)),Pt=Mr([],ti(E,2)),bt=Wr(ut,st),Ct=Wr(vt,st),Ft=Wr(Pt,st),Ot=di(Math.asin(-Ct/W));let he=di(Math.atan2(bt,Ft));he=s.center.lng+function(Re,de){const we=(de-Re+180)%360-180;return we<-180?we+360:we}(s.center.lng,he);const oe=ua(he),_e=pi(Bo(Ot),0,1);return new Qh(oe,_e)}class w_{constructor(t,n,c){this.a=ho([],t,c),this.b=ho([],n,c),this.center=c;const d=Mr([],this.a),_=Mr([],this.b);this.angle=Math.acos(Wr(d,_))}}function Pd(s,t){if(s.angle===0)return null;let n;return n=s.a[t]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[t]/s.a[t]/Math.sin(s.angle)-1/Math.tan(s.angle)),n<0||n>1?null:function(c,d,_,v){const E=Math.sin(_);return c*(Math.sin((1-v)*_)/E)+d*(Math.sin(v*_)/E)}(s.a[t],s.b[t],s.angle,pi(n,0,1))+s.center[t]}function Ro(s){if(s.z<=1)return Qx[s.z+2*s.y+s.x];const t=Gc(Id(s));return Qn.fromPoints(t)}function ha(s,t,n){return Gr(s,s,1-n),Ed(s,s,t,n)}function km(s,t){const n=Jh(t.zoom);if(n===0)return Ro(s);const c=Id(s),d=Gc(c),_=ua(c.getWest())*t.worldSize,v=ua(c.getEast())*t.worldSize,E=Bo(c.getNorth())*t.worldSize,k=Bo(c.getSouth())*t.worldSize,L=[_,E,0],N=[v,E,0],V=[_,k,0],W=[v,k,0],Y=Kf([],t.globeMatrix);return rn(L,L,Y),rn(N,N,Y),rn(V,V,Y),rn(W,W,Y),d[0]=ha(d[0],V,n),d[1]=ha(d[1],W,n),d[2]=ha(d[2],N,n),d[3]=ha(d[3],L,n),Qn.fromPoints(d)}function T_(s,t,n){for(const c of s)rn(c,c,t),Gr(c,c,n)}function t0(s,t,n){const c=t/s.worldSize,d=s.globeMatrix;if(n.z<=1){const oe=Ro(n).getCorners();return T_(oe,d,c),Qn.fromPoints(oe)}const _=Id(n),v=Gc(_);T_(v,d,c);const E=Number.MAX_VALUE,k=[-E,-E,-E],L=[E,E,E];if(_.contains(s.center)){for(const Re of v)Lr(L,L,Re),zo(k,k,Re);k[2]=0;const oe=s.point,_e=[oe.x*c,oe.y*c,0];return Lr(L,L,_e),zo(k,k,_e),new Qn(L,k)}const N=[d[12]*c,d[13]*c,d[14]*c],V=_.getCenter(),W=pi(s.center.lat,-85.051129,po),Y=pi(V.lat,-85.051129,po),K=ua(s.center.lng),st=Bo(W);let ut=K-ua(V.lng);const vt=st-Bo(Y);ut>.5?ut-=1:ut<-.5&&(ut+=1);let Pt=0;Math.abs(ut)>Math.abs(vt)?Pt=ut>=0?1:3:(Pt=vt>=0?0:2,Ed(N,N,[d[4]*c,d[5]*c,d[6]*c],-Math.sin(Ce(vt>=0?_.getSouth():_.getNorth()))*Ia));const bt=v[Pt],Ct=v[(Pt+1)%4],Ft=new w_(bt,Ct,N),Ot=[Pd(Ft,0)||bt[0],Pd(Ft,1)||bt[1],Pd(Ft,2)||bt[2]],he=Jh(s.zoom);if(he>0){const oe=function({x:Re,y:de,z:we},Te,Pe,Ne,me){const qe=1/(1<<we);let ui=Re*qe,Qe=ui+qe,Fi=de*qe,je=Fi+qe,bi=0;const Ni=(ui+Qe)/2-Ne;return Ni>.5?bi=-1:Ni<-.5&&(bi=1),ui=((ui+bi)*Te-(Ne*=Te))*Pe+Ne,Qe=((Qe+bi)*Te-Ne)*Pe+Ne,Fi=(Fi*Te-(me*=Te))*Pe+me,je=(je*Te-me)*Pe+me,[[ui,je,0],[Qe,je,0],[Qe,Fi,0],[ui,Fi,0]]}(n,t,s._pixelsPerMercatorPixel,K,st);for(let Re=0;Re<v.length;Re++)ha(v[Re],oe[Re],he);const _e=ca([],oe[Pt],oe[(Pt+1)%4]);Gr(_e,_e,.5),ha(Ot,_e,he)}for(const oe of v)Lr(L,L,oe),zo(k,k,oe);return L[2]=Math.min(bt[2],Ct[2]),Lr(L,L,Ot),zo(k,k,Ot),new Qn(L,k)}function Id({x:s,y:t,z:n}){const c=1/(1<<n),d=new Es(fo(s*c),cr((t+1)*c)),_=new Es(fo((s+1)*c),cr(t*c));return new Jn(d,_)}function Gc(s){const t=Ce(s.getNorth()),n=Ce(s.getSouth()),c=Math.cos(t),d=Math.cos(n),_=Math.sin(t),v=Math.sin(n),E=s.getWest(),k=s.getEast();return[Wc(d,v,E),Wc(d,v,k),Wc(c,_,k),Wc(c,_,E)]}function Wc(s,t,n,c=Ia){return n=Ce(n),[s*Math.sin(n)*c,-t*c,s*Math.cos(n)*c]}function Yh(s,t,n){return Wc(Math.cos(Ce(s)),Math.sin(Ce(s)),t,n)}function Ld(s,t,n,c){const d=1<<n.z,_=(s/gi+n.x)/d;return Yh(cr((t/gi+n.y)/d),fo(_),c)}function Kh({min:s,max:t}){return v_/Math.max(t[0]-s[0],t[1]-s[1],t[2]-s[2])}const tc=new Float64Array(16);function Hc(s){const t=Kh(s),n=Em(tc,[t,t,t]);return wd(n,n,((c=[])[0]=-(d=s.min)[0],c[1]=-d[1],c[2]=-d[2],c));var c,d}function Pm(s){const t=(c=s.min,(n=tc)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=c[0],n[13]=c[1],n[14]=c[2],n[15]=1,n);var n,c;const d=1/Kh(s);return fl(t,t,[d,d,d])}function S_(s,t,n,c,d){const _=function(k){const L=gi/(2*Math.PI);return k/(2*Math.PI)/L}(n),v=[s,t,-n/(2*Math.PI)],E=co(new Float64Array(16));return wd(E,E,v),fl(E,E,[_,_,_]),Td(E,E,Ce(-d)),Jf(E,E,Ce(-c)),E}function Jh(s){return Ns(Cd,np,s)}function E_(s,t){const n=Yh(t.lat,t.lng),c=function(K){const st=Yh(K._center.lat,K._center.lng);let ut=ka([],Jl(0,1,0),st);const vt=Kl([],-K.angle,st);ut=rn(ut,ut,vt),Kl(vt,-K._pitch,ut);const Pt=Mr([],st);return Gr(Pt,Pt,rp(K.cameraToCenterDistance/K.pixelsPerMeter)),rn(Pt,Pt,vt),ca([],st,Pt)}(s);return v=(d=tp([],c,n))[0],E=d[1],k=d[2],L=(_=n)[0],N=_[1],V=_[2],Y=(W=Math.sqrt(v*v+E*E+k*k)*Math.sqrt(L*L+N*N+V*V))&&Wr(d,_)/W,Math.acos(Math.min(Math.max(Y,-1),1));var d,_,v,E,k,L,N,V,W,Y}function Im(s,t){return E_(s,t)>Math.PI/2*1.01}const M_=Ce(85),e0=Math.cos(M_),i0=Math.sin(M_),Dd=63710088e-1,A_=2*Math.PI*Dd;class ec{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ec(hs(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,c=this.lat*n,d=t.lat*n,_=Math.sin(c)*Math.sin(d)+Math.cos(c)*Math.cos(d)*Math.cos((t.lng-this.lng)*n);return Dd*Math.acos(Math.min(_,1))}toBounds(t=0){const n=360*t/40075017,c=n/Math.cos(Math.PI/180*this.lat);return new Jn(new ec(this.lng-c,this.lat-n),new ec(this.lng+c,this.lat+n))}toEcef(t){const n=rp(t);return Yh(this.lat,this.lng,Ia+n)}static convert(t){if(t instanceof ec)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ec(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ec(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Es=ec;function Lm(s){return A_*Math.cos(s*Math.PI/180)}function ua(s){return(180+s)/360}function Bo(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function da(s,t){return s/Lm(t)}function fo(s){return 360*s-180}function cr(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function zd(s,t){return s*Lm(cr(t))}const po=85.051129;function Dm(s){return 1/Math.cos(s*Math.PI/180)}class Qh{constructor(t,n,c=0){this.x=+t,this.y=+n,this.z=+c}static fromLngLat(t,n=0){const c=Es.convert(t);return new Qh(ua(c.lng),Bo(c.lat),da(n,c.lat))}toLngLat(){return new Es(fo(this.x),cr(this.y))}toAltitude(){return zd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/A_*Dm(cr(this.y))}}function tu(s,t,n,c,d,_,v,E,k){const L=(t+c)/2,N=(n+d)/2,V=new Ut(L,N);E(V),function(W,Y,K,st,ut,vt){const Pt=K-ut,bt=st-vt;return Math.abs((st-Y)*Pt-(K-W)*bt)/Math.hypot(Pt,bt)}(V.x,V.y,_.x,_.y,v.x,v.y)>=k?(tu(s,t,n,L,N,_,V,E,k),tu(s,L,N,c,d,V,v,E,k)):s.push(v)}function op(s,t,n){let c=s[0],d=c.x,_=c.y;t(c);const v=[c];for(let E=1;E<s.length;E++){const k=s[E],{x:L,y:N}=k;t(k),tu(v,d,_,L,N,c,k,t,n),d=L,_=N,c=k}return v}function ap(s,t,n,c){if(c(t,n)){const d=t.add(n)._mult(.5);ap(s,t,d,c),ap(s,d,n,c)}else s.push(n)}function s0(s,t){let n=s[0];const c=[n];for(let d=1;d<s.length;d++){const _=s[d];ap(c,n,_,t),n=_}return c}const Od=Math.pow(2,14)-1,C_=-Od-1;function n0(s,t){const n=Math.round(s.x*t),c=Math.round(s.y*t);return s.x=pi(n,C_,Od),s.y=pi(c,C_,Od),(n<s.x||n>s.x+1||c<s.y||c>s.y+1)&&Se("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function fa(s,t,n){const c=s.loadGeometry(),d=s.extent,_=gi/d;if(t&&n&&n.projection.isReprojectedInTileSpace){const v=1<<t.z,{scale:E,x:k,y:L,projection:N}=n,V=W=>{const Y=fo((t.x+W.x/d)/v),K=cr((t.y+W.y/d)/v),st=N.project(Y,K);W.x=(st.x*E-k)*d,W.y=(st.y*E-L)*d};for(let W=0;W<c.length;W++)if(s.type!==1)c[W]=op(c[W],V,1);else{const Y=[];for(const K of c[W])K.x<0||K.x>=d||K.y<0||K.y>=d||(V(K),Y.push(K));c[W]=Y}}for(const v of c)for(const E of v)n0(E,_);return c}function Xc(s,t){return{type:s.type,id:s.id,properties:s.properties,geometry:t?fa(s):[]}}function lp(s,t,n,c,d){s.emplaceBack(2*t+(c+1)/2,2*n+(d+1)/2)}function cp(s,t,n){s.emplaceBack(t.x,t.y,t.z,n[0]*16384,n[1]*16384,n[2]*16384)}class eu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new ke,this.indexArray=new mi,this.segments=new yn,this.programConfigurations=new Yl(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,c,d){const _=this.layers[0],v=[];let E=null;_.type==="circle"&&(E=_.layout.get("circle-sort-key"));for(const{feature:L,id:N,index:V,sourceLayerIndex:W}of t){const Y=this.layers[0]._featureFilter.needGeometry,K=Xc(L,Y);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),K,c))continue;const st=E?E.evaluate(K,{},c):void 0,ut={id:N,properties:L.properties,type:L.type,sourceLayerIndex:W,index:V,geometry:Y?K.geometry:fa(L,c,d),patterns:{},sortKey:st};v.push(ut)}E&&v.sort((L,N)=>L.sortKey-N.sortKey);let k=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new De,k=d.projection);for(const L of v){const{geometry:N,index:V,sourceLayerIndex:W}=L,Y=t[V].feature;this.addFeature(L,N,V,n.availableImages,c,k),n.featureIndex.insert(Y,N,V,W,this.index)}}update(t,n,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Kx.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,ul.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,n,c,d,_,v){for(const E of n)for(const k of E){const L=k.x,N=k.y;if(L<0||L>=gi||N<0||N>=gi)continue;if(v){const Y=v.projectTilePoint(L,N,_),K=v.upVector(_,L,N),st=this.globeExtVertexArray;cp(st,Y,K),cp(st,Y,K),cp(st,Y,K),cp(st,Y,K)}const V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),W=V.vertexLength;lp(this.layoutVertexArray,L,N,-1,-1),lp(this.layoutVertexArray,L,N,1,-1),lp(this.layoutVertexArray,L,N,1,1),lp(this.layoutVertexArray,L,N,-1,1),this.indexArray.emplaceBack(W,W+1,W+2),this.indexArray.emplaceBack(W,W+2,W+3),V.vertexLength+=4,V.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},d,_)}}function Rd(s,t){for(let n=0;n<s.length;n++)if(La(t,s[n]))return!0;for(let n=0;n<t.length;n++)if(La(s,t[n]))return!0;return!!hp(s,t)}function k_(s,t,n){return!!La(s,t)||!!Bd(t,s,n)}function zm(s,t){if(s.length===1)return I_(t,s[0]);for(let n=0;n<t.length;n++){const c=t[n];for(let d=0;d<c.length;d++)if(La(s,c[d]))return!0}for(let n=0;n<s.length;n++)if(I_(t,s[n]))return!0;for(let n=0;n<t.length;n++)if(hp(s,t[n]))return!0;return!1}function P_(s,t,n){if(s.length>1){if(hp(s,t))return!0;for(let c=0;c<t.length;c++)if(Bd(t[c],s,n))return!0}for(let c=0;c<s.length;c++)if(Bd(s[c],t,n))return!0;return!1}function hp(s,t){if(s.length===0||t.length===0)return!1;for(let n=0;n<s.length-1;n++){const c=s[n],d=s[n+1];for(let _=0;_<t.length-1;_++)if(up(c,d,t[_],t[_+1]))return!0}return!1}function up(s,t,n,c){return be(s,n,c)!==be(t,n,c)&&be(s,t,n)!==be(s,t,c)}function Bd(s,t,n){const c=n*n;if(t.length===1)return s.distSqr(t[0])<c;for(let d=1;d<t.length;d++)if(iu(s,t[d-1],t[d])<c)return!0;return!1}function iu(s,t,n){const c=t.distSqr(n);if(c===0)return s.distSqr(t);const d=((s.x-t.x)*(n.x-t.x)+(s.y-t.y)*(n.y-t.y))/c;return s.distSqr(d<0?t:d>1?n:n.sub(t)._mult(d)._add(t))}function I_(s,t){let n,c,d,_=!1;for(let v=0;v<s.length;v++){n=s[v];for(let E=0,k=n.length-1;E<n.length;k=E++)c=n[E],d=n[k],c.y>t.y!=d.y>t.y&&t.x<(d.x-c.x)*(t.y-c.y)/(d.y-c.y)+c.x&&(_=!_)}return _}function La(s,t){let n=!1;for(let c=0,d=s.length-1;c<s.length;d=c++){const _=s[c],v=s[d];_.y>t.y!=v.y>t.y&&t.x<(v.x-_.x)*(t.y-_.y)/(v.y-_.y)+_.x&&(n=!n)}return n}function Fd(s,t,n,c,d){for(const v of s)if(t<=v.x&&n<=v.y&&c>=v.x&&d>=v.y)return!0;const _=[new Ut(t,n),new Ut(t,d),new Ut(c,d),new Ut(c,n)];if(s.length>2){for(const v of _)if(La(s,v))return!0}for(let v=0;v<s.length-1;v++)if(r0(s[v],s[v+1],_))return!0;return!1}function r0(s,t,n){const c=n[0],d=n[2];if(s.x<c.x&&t.x<c.x||s.x>d.x&&t.x>d.x||s.y<c.y&&t.y<c.y||s.y>d.y&&t.y>d.y)return!1;const _=be(s,t,n[0]);return _!==be(s,t,n[1])||_!==be(s,t,n[2])||_!==be(s,t,n[3])}function su(s,t,n){const c=t.paint.get(s).value;return c.kind==="constant"?c.value:n.programConfigurations.get(t.id).getMaxValue(s)}function Da(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Om(s,t,n,c,d){if(!t[0]&&!t[1])return s;const _=Ut.convert(t)._mult(d);n==="viewport"&&_._rotate(-c);const v=[];for(let E=0;E<s.length;E++)v.push(s[E].sub(_));return v}function dp(s,t,n,c){const d=Ut.convert(s)._mult(c);return t==="viewport"&&d._rotate(-n),d}oi(eu,"CircleBucket",{omit:["layers"]});const L_=new Et({"circle-sort-key":new ft(pe.layout_circle["circle-sort-key"])});var ic={paint:new Et({"circle-radius":new ft(pe.paint_circle["circle-radius"]),"circle-color":new ft(pe.paint_circle["circle-color"]),"circle-blur":new ft(pe.paint_circle["circle-blur"]),"circle-opacity":new ft(pe.paint_circle["circle-opacity"]),"circle-translate":new et(pe.paint_circle["circle-translate"]),"circle-translate-anchor":new et(pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new et(pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new et(pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ft(pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ft(pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ft(pe.paint_circle["circle-stroke-opacity"])}),layout:L_};function nu(s,t,n,c,d,_,v,E,k){if(_&&s.queryGeometry.isAboveHorizon)return!1;_&&(k*=s.pixelToTileUnitsFactor);const L=s.tileID.canonical,N=n.projection.upVectorScale(L,n.center.lat,n.worldSize).metersToTile;for(const V of t)for(const W of V){const Y=W.add(E),K=d&&n.elevation?n.elevation.exaggeration()*d.getElevationAt(Y.x,Y.y,!0):0,st=n.projection.projectTilePoint(Y.x,Y.y,L);if(K>0){const bt=n.projection.upVector(L,Y.x,Y.y);st.x+=bt[0]*N*K,st.y+=bt[1]*N*K,st.z+=bt[2]*N*K}const ut=_?Y:Nd(st.x,st.y,st.z,c),vt=_?s.tilespaceRays.map(bt=>o0(bt,K)):s.queryGeometry.screenGeometry,Pt=Ar([],[st.x,st.y,st.z,1],c);if(!v&&_?k*=Pt[3]/n.cameraToCenterDistance:v&&!_&&(k*=n.cameraToCenterDistance/Pt[3]),_){const bt=cr((W.y/gi+L.y)/(1<<L.z));k/=n.projection.pixelsPerMeter(bt,1)/da(1,bt)}if(k_(vt,ut,k))return!0}return!1}function Nd(s,t,n,c){const d=Ar([],[s,t,n,1],c);return new Ut(d[0]/d[3],d[1]/d[3])}const D_=Jl(0,0,0),jd=Jl(0,0,1);function o0(s,t){const n=Qf();return D_[2]=t,s.intersectsPlane(D_,jd,n),new Ut(n[0],n[1])}class Rm extends eu{}function Ud(s,{width:t,height:n},c,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==t*n*c)throw new RangeError("mismatched image size")}else d=new Uint8Array(t*n*c);return s.width=t,s.height=n,s.data=d,s}function z_(s,t,n){const{width:c,height:d}=t;c===s.width&&d===s.height||(fp(s,t,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,c),height:Math.min(s.height,d)},n),s.width=c,s.height=d,s.data=t.data)}function fp(s,t,n,c,d,_){if(d.width===0||d.height===0)return t;if(d.width>s.width||d.height>s.height||n.x>s.width-d.width||n.y>s.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>t.width||d.height>t.height||c.x>t.width-d.width||c.y>t.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const v=s.data,E=t.data;for(let k=0;k<d.height;k++){const L=((n.y+k)*s.width+n.x)*_,N=((c.y+k)*t.width+c.x)*_;for(let V=0;V<d.width*_;V++)E[N+V]=v[L+V]}return t}oi(Rm,"HeatmapBucket",{omit:["layers"]});class pl{constructor(t,n){Ud(this,t,1,n)}resize(t){z_(this,new pl(t),1)}clone(){return new pl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,c,d,_){fp(t,n,c,d,_,1)}}class Hr{constructor(t,n){Ud(this,t,4,n)}resize(t){z_(this,new Hr(t),4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Hr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,c,d,_){fp(t,n,c,d,_,4)}}oi(pl,"AlphaImage"),oi(Hr,"RGBAImage");var a0={paint:new Et({"heatmap-radius":new ft(pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ft(pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new et(pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new St(pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new et(pe.paint_heatmap["heatmap-opacity"])})};function Bm(s){const t={},n=s.resolution||256,c=s.clips?s.clips.length:1,d=s.image||new Hr({width:n,height:c}),_=(v,E,k)=>{t[s.evaluationKey]=k;const L=s.expression.evaluate(t);d.data[v+E+0]=Math.floor(255*L.r/L.a),d.data[v+E+1]=Math.floor(255*L.g/L.a),d.data[v+E+2]=Math.floor(255*L.b/L.a),d.data[v+E+3]=Math.floor(255*L.a)};if(s.clips)for(let v=0,E=0;v<c;++v,E+=4*n)for(let k=0,L=0;k<n;k++,L+=4){const N=k/(n-1),{start:V,end:W}=s.clips[v];_(E,L,V*(1-N)+W*N)}else for(let v=0,E=0;v<n;v++,E+=4)_(0,E,v/(n-1));return d}var l0={paint:new Et({"hillshade-illumination-direction":new et(pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new et(pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new et(pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new et(pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new et(pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new et(pe.paint_hillshade["hillshade-accent-color"])})};const Fm=Yt([{name:"a_pos",components:2,type:"Int16"}],4),{members:c0}=Fm;var pp={exports:{}};function mp(s,t,n){n=n||2;var c,d,_,v,E,k,L,N=t&&t.length,V=N?t[0]*n:s.length,W=O_(s,0,V,n,!0),Y=[];if(!W||W.next===W.prev)return Y;if(N&&(W=function(st,ut,vt,Pt){var bt,Ct,Ft,Ot=[];for(bt=0,Ct=ut.length;bt<Ct;bt++)(Ft=O_(st,ut[bt]*Pt,bt<Ct-1?ut[bt+1]*Pt:st.length,Pt,!1))===Ft.next&&(Ft.steiner=!0),Ot.push(f0(Ft));for(Ot.sort(u0),bt=0;bt<Ot.length;bt++)vt=B_(Ot[bt],vt);return vt}(s,t,W,n)),s.length>80*n){c=_=s[0],d=v=s[1];for(var K=n;K<V;K+=n)(E=s[K])<c&&(c=E),(k=s[K+1])<d&&(d=k),E>_&&(_=E),k>v&&(v=k);L=(L=Math.max(_-c,v-d))!==0?32767/L:0}return sc(W,Y,n,c,d,L,0),Y}function O_(s,t,n,c,d){var _,v;if(d===Gd(s,t,n,c)>0)for(_=t;_<n;_+=c)v=Um(_,s[_],s[_+1],v);else for(_=n-c;_>=t;_-=c)v=Um(_,s[_],s[_+1],v);return v&&yp(v,v.next)&&(Zc(v),v=v.next),v}function qc(s,t){if(!s)return s;t||(t=s);var n,c=s;do if(n=!1,c.steiner||!yp(c,c.next)&&An(c.prev,c,c.next)!==0)c=c.next;else{if(Zc(c),(c=t=c.prev)===c.next)break;n=!0}while(n||c!==t);return t}function sc(s,t,n,c,d,_,v){if(s){!v&&_&&function(N,V,W,Y){var K=N;do K.z===0&&(K.z=_p(K.x,K.y,V,W,Y)),K.prevZ=K.prev,K.nextZ=K.next,K=K.next;while(K!==N);K.prevZ.nextZ=null,K.prevZ=null,function(st){var ut,vt,Pt,bt,Ct,Ft,Ot,he,oe=1;do{for(vt=st,st=null,Ct=null,Ft=0;vt;){for(Ft++,Pt=vt,Ot=0,ut=0;ut<oe&&(Ot++,Pt=Pt.nextZ);ut++);for(he=oe;Ot>0||he>0&&Pt;)Ot!==0&&(he===0||!Pt||vt.z<=Pt.z)?(bt=vt,vt=vt.nextZ,Ot--):(bt=Pt,Pt=Pt.nextZ,he--),Ct?Ct.nextZ=bt:st=bt,bt.prevZ=Ct,Ct=bt;vt=Pt}Ct.nextZ=null,oe*=2}while(Ft>1)}(K)}(s,c,d,_);for(var E,k,L=s;s.prev!==s.next;)if(E=s.prev,k=s.next,_?h0(s,c,d,_):R_(s))t.push(E.i/n|0),t.push(s.i/n|0),t.push(k.i/n|0),Zc(s),s=k.next,L=k.next;else if((s=k)===L){v?v===1?sc(s=Nm(qc(s),t,n),t,n,c,d,_,2):v===2&&gp(s,t,n,c,d,_):sc(qc(s),t,n,c,d,_,1);break}}}function R_(s){var t=s.prev,n=s,c=s.next;if(An(t,n,c)>=0)return!1;for(var d=t.x,_=n.x,v=c.x,E=t.y,k=n.y,L=c.y,N=d<_?d<v?d:v:_<v?_:v,V=E<k?E<L?E:L:k<L?k:L,W=d>_?d>v?d:v:_>v?_:v,Y=E>k?E>L?E:L:k>L?k:L,K=c.next;K!==t;){if(K.x>=N&&K.x<=W&&K.y>=V&&K.y<=Y&&ru(d,E,_,k,v,L,K.x,K.y)&&An(K.prev,K,K.next)>=0)return!1;K=K.next}return!0}function h0(s,t,n,c){var d=s.prev,_=s,v=s.next;if(An(d,_,v)>=0)return!1;for(var E=d.x,k=_.x,L=v.x,N=d.y,V=_.y,W=v.y,Y=E<k?E<L?E:L:k<L?k:L,K=N<V?N<W?N:W:V<W?V:W,st=E>k?E>L?E:L:k>L?k:L,ut=N>V?N>W?N:W:V>W?V:W,vt=_p(Y,K,t,n,c),Pt=_p(st,ut,t,n,c),bt=s.prevZ,Ct=s.nextZ;bt&&bt.z>=vt&&Ct&&Ct.z<=Pt;){if(bt.x>=Y&&bt.x<=st&&bt.y>=K&&bt.y<=ut&&bt!==d&&bt!==v&&ru(E,N,k,V,L,W,bt.x,bt.y)&&An(bt.prev,bt,bt.next)>=0||(bt=bt.prevZ,Ct.x>=Y&&Ct.x<=st&&Ct.y>=K&&Ct.y<=ut&&Ct!==d&&Ct!==v&&ru(E,N,k,V,L,W,Ct.x,Ct.y)&&An(Ct.prev,Ct,Ct.next)>=0))return!1;Ct=Ct.nextZ}for(;bt&&bt.z>=vt;){if(bt.x>=Y&&bt.x<=st&&bt.y>=K&&bt.y<=ut&&bt!==d&&bt!==v&&ru(E,N,k,V,L,W,bt.x,bt.y)&&An(bt.prev,bt,bt.next)>=0)return!1;bt=bt.prevZ}for(;Ct&&Ct.z<=Pt;){if(Ct.x>=Y&&Ct.x<=st&&Ct.y>=K&&Ct.y<=ut&&Ct!==d&&Ct!==v&&ru(E,N,k,V,L,W,Ct.x,Ct.y)&&An(Ct.prev,Ct,Ct.next)>=0)return!1;Ct=Ct.nextZ}return!0}function Nm(s,t,n){var c=s;do{var d=c.prev,_=c.next.next;!yp(d,_)&&jm(d,c,c.next,_)&&$d(d,_)&&$d(_,d)&&(t.push(d.i/n|0),t.push(c.i/n|0),t.push(_.i/n|0),Zc(c),Zc(c.next),c=s=_),c=c.next}while(c!==s);return qc(c)}function gp(s,t,n,c,d,_){var v=s;do{for(var E=v.next.next;E!==v.prev;){if(v.i!==E.i&&p0(v,E)){var k=F_(v,E);return v=qc(v,v.next),k=qc(k,k.next),sc(v,t,n,c,d,_,0),void sc(k,t,n,c,d,_,0)}E=E.next}v=v.next}while(v!==s)}function u0(s,t){return s.x-t.x}function B_(s,t){var n=function(d,_){var v,E=_,k=d.x,L=d.y,N=-1/0;do{if(L<=E.y&&L>=E.next.y&&E.next.y!==E.y){var V=E.x+(L-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(V<=k&&V>N&&(N=V,v=E.x<E.next.x?E:E.next,V===k))return v}E=E.next}while(E!==_);if(!v)return null;var W,Y=v,K=v.x,st=v.y,ut=1/0;E=v;do k>=E.x&&E.x>=K&&k!==E.x&&ru(L<st?k:N,L,K,st,L<st?N:k,L,E.x,E.y)&&(W=Math.abs(L-E.y)/(k-E.x),$d(E,d)&&(W<ut||W===ut&&(E.x>v.x||E.x===v.x&&d0(v,E)))&&(v=E,ut=W)),E=E.next;while(E!==Y);return v}(s,t);if(!n)return t;var c=F_(n,s);return qc(c,c.next),qc(n,n.next)}function d0(s,t){return An(s.prev,s,t.prev)<0&&An(t.next,s,s.next)<0}function _p(s,t,n,c,d){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-n)*d|0)|s<<8))|s<<4))|s<<2))|s<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*d|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f0(s){var t=s,n=s;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==s);return n}function ru(s,t,n,c,d,_,v,E){return(d-v)*(t-E)>=(s-v)*(_-E)&&(s-v)*(c-E)>=(n-v)*(t-E)&&(n-v)*(_-E)>=(d-v)*(c-E)}function p0(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!function(n,c){var d=n;do{if(d.i!==n.i&&d.next.i!==n.i&&d.i!==c.i&&d.next.i!==c.i&&jm(d,d.next,n,c))return!0;d=d.next}while(d!==n);return!1}(s,t)&&($d(s,t)&&$d(t,s)&&function(n,c){var d=n,_=!1,v=(n.x+c.x)/2,E=(n.y+c.y)/2;do d.y>E!=d.next.y>E&&d.next.y!==d.y&&v<(d.next.x-d.x)*(E-d.y)/(d.next.y-d.y)+d.x&&(_=!_),d=d.next;while(d!==n);return _}(s,t)&&(An(s.prev,s,t.prev)||An(s,t.prev,t))||yp(s,t)&&An(s.prev,s,s.next)>0&&An(t.prev,t,t.next)>0)}function An(s,t,n){return(t.y-s.y)*(n.x-t.x)-(t.x-s.x)*(n.y-t.y)}function yp(s,t){return s.x===t.x&&s.y===t.y}function jm(s,t,n,c){var d=Vd(An(s,t,n)),_=Vd(An(s,t,c)),v=Vd(An(n,c,s)),E=Vd(An(n,c,t));return d!==_&&v!==E||!(d!==0||!xp(s,n,t))||!(_!==0||!xp(s,c,t))||!(v!==0||!xp(n,s,c))||!(E!==0||!xp(n,t,c))}function xp(s,t,n){return t.x<=Math.max(s.x,n.x)&&t.x>=Math.min(s.x,n.x)&&t.y<=Math.max(s.y,n.y)&&t.y>=Math.min(s.y,n.y)}function Vd(s){return s>0?1:s<0?-1:0}function $d(s,t){return An(s.prev,s,s.next)<0?An(s,t,s.next)>=0&&An(s,s.prev,t)>=0:An(s,t,s.prev)<0||An(s,s.next,t)<0}function F_(s,t){var n=new Vm(s.i,s.x,s.y),c=new Vm(t.i,t.x,t.y),d=s.next,_=t.prev;return s.next=t,t.prev=s,n.next=d,d.prev=n,c.next=n,n.prev=c,_.next=c,c.prev=_,c}function Um(s,t,n,c){var d=new Vm(s,t,n);return c?(d.next=c.next,d.prev=c,c.next.prev=d,c.next=d):(d.prev=d,d.next=d),d}function Zc(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Vm(s,t,n){this.i=s,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Gd(s,t,n,c){for(var d=0,_=t,v=n-c;_<n;_+=c)d+=(s[v]-s[_])*(s[_+1]+s[v+1]),v=_;return d}pp.exports=mp,pp.exports.default=mp,mp.deviation=function(s,t,n,c){var d=t&&t.length,_=Math.abs(Gd(s,0,d?t[0]*n:s.length,n));if(d)for(var v=0,E=t.length;v<E;v++)_-=Math.abs(Gd(s,t[v]*n,v<E-1?t[v+1]*n:s.length,n));var k=0;for(v=0;v<c.length;v+=3){var L=c[v]*n,N=c[v+1]*n,V=c[v+2]*n;k+=Math.abs((s[L]-s[V])*(s[N+1]-s[L+1])-(s[L]-s[N])*(s[V+1]-s[L+1]))}return _===0&&k===0?0:Math.abs((k-_)/_)},mp.flatten=function(s){for(var t=s[0][0].length,n={vertices:[],holes:[],dimensions:t},c=0,d=0;d<s.length;d++){for(var _=0;_<s[d].length;_++)for(var v=0;v<t;v++)n.vertices.push(s[d][_][v]);d>0&&n.holes.push(c+=s[d-1].length)}return n};var $m=It(pp.exports);function m0(s,t,n,c,d){N_(s,t,n,c||s.length-1,d||g0)}function N_(s,t,n,c,d){for(;c>n;){if(c-n>600){var _=c-n+1,v=t-n+1,E=Math.log(_),k=.5*Math.exp(2*E/3),L=.5*Math.sqrt(E*k*(_-k)/_)*(v-_/2<0?-1:1);N_(s,t,Math.max(n,Math.floor(t-v*k/_+L)),Math.min(c,Math.floor(t+(_-v)*k/_+L)),d)}var N=s[t],V=n,W=c;for(ou(s,n,t),d(s[c],N)>0&&ou(s,n,c);V<W;){for(ou(s,V,W),V++,W--;d(s[V],N)<0;)V++;for(;d(s[W],N)>0;)W--}d(s[n],N)===0?ou(s,n,W):ou(s,++W,c),W<=t&&(n=W+1),t<=W&&(c=W-1)}}function ou(s,t,n){var c=s[t];s[t]=s[n],s[n]=c}function g0(s,t){return s<t?-1:s>t?1:0}function vp(s,t){const n=s.length;if(n<=1)return[s];const c=[];let d,_;for(let v=0;v<n;v++){const E=Ue(s[v]);E!==0&&(s[v].area=Math.abs(E),_===void 0&&(_=E<0),_===E<0?(d&&c.push(d),d=[s[v]]):d.push(s[v]))}if(d&&c.push(d),t>1)for(let v=0;v<c.length;v++)c[v].length<=t||(m0(c[v],t,1,c[v].length-1,j_),c[v]=c[v].slice(0,t));return c}function j_(s,t){return t.area-s.area}function Gm(s,t,n){const c=n.patternDependencies;let d=!1;for(const _ of t){const v=_.paint.get(`${s}-pattern`);v.isConstant()||(d=!0);const E=v.constantOr(null);E&&(d=!0,c[E]=!0)}return d}function Wm(s,t,n,c,d){const _=d.patternDependencies;for(const v of t){const E=v.paint.get(`${s}-pattern`).value;if(E.kind!=="constant"){let k=E.evaluate({zoom:c},n,{},d.availableImages);k=k&&k.name?k.name:k,_[k]=!0,n.patterns[v.id]=k}}return n}class Wd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ke,this.indexArray=new mi,this.indexArray2=new qn,this.programConfigurations=new Yl(t.layers,t.zoom),this.segments=new yn,this.segments2=new yn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=t.projection}populate(t,n,c,d){this.hasPattern=Gm("fill",this.layers,n);const _=this.layers[0].layout.get("fill-sort-key"),v=[];for(const{feature:E,id:k,index:L,sourceLayerIndex:N}of t){const V=this.layers[0]._featureFilter.needGeometry,W=Xc(E,V);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),W,c))continue;const Y=_?_.evaluate(W,{},c,n.availableImages):void 0,K={id:k,properties:E.properties,type:E.type,sourceLayerIndex:N,index:L,geometry:V?W.geometry:fa(E,c,d),patterns:{},sortKey:Y};v.push(K)}_&&v.sort((E,k)=>E.sortKey-k.sortKey);for(const E of v){const{geometry:k,index:L,sourceLayerIndex:N}=E;if(this.hasPattern){const V=Wm("fill",this.layers,E,this.zoom,n);this.patternFeatures.push(V)}else this.addFeature(E,k,L,c,{},n.availableImages);n.featureIndex.insert(t[L].feature,k,L,N,this.index)}}update(t,n,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,c,d)}addFeatures(t,n,c,d,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,n,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,c0),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,c,d,_,v=[]){for(const E of vp(n,500)){let k=0;for(const K of E)k+=K.length;const L=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),N=L.vertexLength,V=[],W=[];for(const K of E){if(K.length===0)continue;K!==E[0]&&W.push(V.length/2);const st=this.segments2.prepareSegment(K.length,this.layoutVertexArray,this.indexArray2),ut=st.vertexLength;this.layoutVertexArray.emplaceBack(K[0].x,K[0].y),this.indexArray2.emplaceBack(ut+K.length-1,ut),V.push(K[0].x),V.push(K[0].y);for(let vt=1;vt<K.length;vt++)this.layoutVertexArray.emplaceBack(K[vt].x,K[vt].y),this.indexArray2.emplaceBack(ut+vt-1,ut+vt),V.push(K[vt].x),V.push(K[vt].y);st.vertexLength+=K.length,st.primitiveLength+=K.length}const Y=$m(V,W);for(let K=0;K<Y.length;K+=3)this.indexArray.emplaceBack(N+Y[K],N+Y[K+1],N+Y[K+2]);L.vertexLength+=k,L.primitiveLength+=Y.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,_,v,d)}}oi(Wd,"FillBucket",{omit:["layers","patternFeatures"]});const _0=new Et({"fill-sort-key":new ft(pe.layout_fill["fill-sort-key"])});var y0={paint:new Et({"fill-antialias":new et(pe.paint_fill["fill-antialias"]),"fill-opacity":new ft(pe.paint_fill["fill-opacity"]),"fill-color":new ft(pe.paint_fill["fill-color"]),"fill-outline-color":new ft(pe.paint_fill["fill-outline-color"]),"fill-translate":new et(pe.paint_fill["fill-translate"]),"fill-translate-anchor":new et(pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new ft(pe.paint_fill["fill-pattern"])}),layout:_0};const x0=Yt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),v0=Yt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),U_=Yt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:V_}=x0;var bp={},b0=kt,Hm=au;function au(s,t,n,c,d){this.properties={},this.extent=n,this.type=0,this._pbf=s,this._geometry=-1,this._keys=c,this._values=d,s.readFields($_,this,t)}function $_(s,t,n){s==1?t.id=n.readVarint():s==2?function(c,d){for(var _=c.readVarint()+c.pos;c.pos<_;){var v=d._keys[c.readVarint()],E=d._values[c.readVarint()];d.properties[v]=E}}(n,t):s==3?t.type=n.readVarint():s==4&&(t._geometry=n.pos)}function w0(s){for(var t,n,c=0,d=0,_=s.length,v=_-1;d<_;v=d++)c+=((n=s[v]).x-(t=s[d]).x)*(t.y+n.y);return c}au.types=["Unknown","Point","LineString","Polygon"],au.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var t,n=s.readVarint()+s.pos,c=1,d=0,_=0,v=0,E=[];s.pos<n;){if(d<=0){var k=s.readVarint();c=7&k,d=k>>3}if(d--,c===1||c===2)_+=s.readSVarint(),v+=s.readSVarint(),c===1&&(t&&E.push(t),t=[]),t.push(new b0(_,v));else{if(c!==7)throw new Error("unknown command "+c);t&&t.push(t[0].clone())}}return t&&E.push(t),E},au.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var t=s.readVarint()+s.pos,n=1,c=0,d=0,_=0,v=1/0,E=-1/0,k=1/0,L=-1/0;s.pos<t;){if(c<=0){var N=s.readVarint();n=7&N,c=N>>3}if(c--,n===1||n===2)(d+=s.readSVarint())<v&&(v=d),d>E&&(E=d),(_+=s.readSVarint())<k&&(k=_),_>L&&(L=_);else if(n!==7)throw new Error("unknown command "+n)}return[v,k,E,L]},au.prototype.toGeoJSON=function(s,t,n){var c,d,_=this.extent*Math.pow(2,n),v=this.extent*s,E=this.extent*t,k=this.loadGeometry(),L=au.types[this.type];function N(Y){for(var K=0;K<Y.length;K++){var st=Y[K];Y[K]=[360*(st.x+v)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(st.y+E)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var V=[];for(c=0;c<k.length;c++)V[c]=k[c][0];N(k=V);break;case 2:for(c=0;c<k.length;c++)N(k[c]);break;case 3:for(k=function(Y){var K=Y.length;if(K<=1)return[Y];for(var st,ut,vt=[],Pt=0;Pt<K;Pt++){var bt=w0(Y[Pt]);bt!==0&&(ut===void 0&&(ut=bt<0),ut===bt<0?(st&&vt.push(st),st=[Y[Pt]]):st.push(Y[Pt]))}return st&&vt.push(st),vt}(k),c=0;c<k.length;c++)for(d=0;d<k[c].length;d++)N(k[c][d])}k.length===1?k=k[0]:L="Multi"+L;var W={type:"Feature",geometry:{type:L,coordinates:k},properties:this.properties};return"id"in this&&(W.id=this.id),W};var G_=Hm,Xm=W_;function W_(s,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(H_,this,t),this.length=this._features.length}function H_(s,t,n){s===15?t.version=n.readVarint():s===1?t.name=n.readString():s===5?t.extent=n.readVarint():s===2?t._features.push(n.pos):s===3?t._keys.push(n.readString()):s===4&&t._values.push(function(c){for(var d=null,_=c.readVarint()+c.pos;c.pos<_;){var v=c.readVarint()>>3;d=v===1?c.readString():v===2?c.readFloat():v===3?c.readDouble():v===4?c.readVarint64():v===5?c.readVarint():v===6?c.readSVarint():v===7?c.readBoolean():null}return d}(n))}W_.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var t=this._pbf.readVarint()+this._pbf.pos;return new G_(this._pbf,t,this.extent,this._keys,this._values)};var T0=Xm;function qm(s,t,n){if(s===3){var c=new T0(n,n.readVarint()+n.pos);c.length&&(t[c.name]=c)}}var Zm=bp.VectorTile=function(s,t){this.layers=s.readFields(qm,{},t)},Hd=bp.VectorTileFeature=Hm;function Xd(s,t,n,c){const d=[],_=c===0?(v,E,k,L,N,V)=>{v.push(new Ut(V,k+(V-E)/(L-E)*(N-k)))}:(v,E,k,L,N,V)=>{v.push(new Ut(E+(V-k)/(N-k)*(L-E),V))};for(const v of s){const E=[];for(const k of v){if(k.length<=2)continue;const L=[];for(let W=0;W<k.length-1;W++){const Y=k[W].x,K=k[W].y,st=k[W+1].x,ut=k[W+1].y,vt=c===0?Y:K,Pt=c===0?st:ut;vt<t?Pt>t&&_(L,Y,K,st,ut,t):vt>n?Pt<n&&_(L,Y,K,st,ut,n):L.push(k[W]),Pt<t&&vt>=t&&_(L,Y,K,st,ut,t),Pt>n&&vt<=n&&_(L,Y,K,st,ut,n)}let N=k[k.length-1];const V=c===0?N.x:N.y;V>=t&&V<=n&&L.push(N),L.length&&(N=L[L.length-1],L[0].x===N.x&&L[0].y===N.y||L.push(L[0]),E.push(L))}E.length&&d.push(E)}return d}bp.VectorTileLayer=Xm;const S0=Hd.types,E0=Math.pow(2,13);function Yc(s,t,n,c,d,_,v,E){s.emplaceBack((t<<1)+v,(n<<1)+_,(Math.floor(c*E0)<<1)+d,Math.round(E))}function qd(s,t,n){s.emplaceBack(t.x,t.y,t.z,n[0]*16384,n[1]*16384,n[2]*16384)}class X_{constructor(){this.acc=new Ut(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ut(t.x,t.y),this.max=new Ut(t.x,t.y))}append(t,n){this.currentPolyCount.edges++,this.acc._add(t);const c=this.min,d=this.max;t.x<c.x?c.x=t.x:t.x>d.x&&(d.x=t.x),t.y<c.y?c.y=t.y:t.y>d.y&&(d.y=t.y),((t.x===0||t.x===gi)&&t.x===n.x)!=((t.y===0||t.y===gi)&&t.y===n.y)&&this.processBorderOverlap(t,n),n.x<0!=t.x<0&&this.addBorderIntersection(0,rs(n.y,t.y,(0-n.x)/(t.x-n.x))),n.x>gi!=t.x>gi&&this.addBorderIntersection(1,rs(n.y,t.y,(gi-n.x)/(t.x-n.x))),n.y<0!=t.y<0&&this.addBorderIntersection(2,rs(n.x,t.x,(0-n.y)/(t.y-n.y))),n.y>gi!=t.y>gi&&this.addBorderIntersection(3,rs(n.x,t.x,(gi-n.y)/(t.y-n.y)))}addBorderIntersection(t,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[t];n<c[0]&&(c[0]=n),n>c[1]&&(c[1]=n)}processBorderOverlap(t,n){if(t.x===n.x){if(t.y===n.y)return;const c=t.x===0?0:1;this.addBorderIntersection(c,n.y),this.addBorderIntersection(c,t.y)}else{const c=t.y===0?2:3;this.addBorderIntersection(c,n.x),this.addBorderIntersection(c,t.x)}}centroid(){const t=this.polyCount.reduce((n,c)=>n+c.edges,0);return t!==0?this.acc.div(t)._round():new Ut(0,0)}span(){return new Ut(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,n)=>t+ +(n[0]!==Number.MAX_VALUE),0)}}class Zd{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.layoutVertexArray=new xe,this.centroidVertexArray=new Do,this.indexArray=new mi,this.programConfigurations=new Yl(t.layers,t.zoom),this.segments=new yn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=t.enableTerrain}populate(t,n,c,d){this.features=[],this.hasPattern=Gm("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(_){const v=Math.exp(Math.PI*(1-_.y/(1<<_.z)*2));return 80150034*v/(v*v+1)/gi/(1<<_.z)}(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:_,id:v,index:E,sourceLayerIndex:k}of t){const L=this.layers[0]._featureFilter.needGeometry,N=Xc(_,L);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),N,c))continue;const V={id:v,sourceLayerIndex:k,index:E,geometry:L?N.geometry:fa(_,c,d),properties:_.properties,type:_.type,patterns:{}},W=this.layoutVertexArray.length;this.hasPattern?this.features.push(Wm("fill-extrusion",this.layers,V,this.zoom,n)):this.addFeature(V,V.geometry,E,c,{},n.availableImages,d),n.featureIndex.insert(_,V.geometry,E,k,this.index,W)}this.sortBorders()}addFeatures(t,n,c,d,_){for(const v of this.features){const{geometry:E}=v;this.addFeature(v,E,v.index,n,c,d,_)}this.sortBorders()}update(t,n,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,V_),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,U_.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,v0.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,c,d,_,v,E){const k=[new Ut(0,0),new Ut(gi,gi)],L=E.projection,N=L.name==="globe",V=this.enableTerrain&&!N?new X_:null,W=S0[t.type]==="Polygon";N&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new De);const Y=vp(n,500);for(let vt=Y.length-1;vt>=0;vt--){const Pt=Y[vt];(Pt.length===0||(K=Pt[0]).every(bt=>bt.x<=0)||K.every(bt=>bt.x>=gi)||K.every(bt=>bt.y<=0)||K.every(bt=>bt.y>=gi))&&Y.splice(vt,1)}var K;let st;if(N)st=Ym(Y,k,d);else{st=[];for(const vt of Y)st.push({polygon:vt,bounds:k})}const ut=W?this.edgeRadius:0;for(const{polygon:vt,bounds:Pt}of st){let bt=0,Ct=0;for(const Ot of vt)W&&!Ot[0].equals(Ot[Ot.length-1])&&Ot.push(Ot[0]),Ct+=W?Ot.length-1:Ot.length;const Ft=this.segments.prepareSegment((W?5:4)*Ct,this.layoutVertexArray,this.indexArray);if(W){const Ot=[],he=[];bt=Ft.vertexLength;for(const _e of vt){let Re,de;_e.length&&_e!==vt[0]&&he.push(Ot.length/2),Re=_e[1].sub(_e[0])._perp()._unit();for(let we=1;we<_e.length;we++){const Te=_e[we],Pe=_e[we===_e.length-1?1:we+1];let{x:Ne,y:me}=Te;if(ut){de=Pe.sub(Te)._perp()._unit();const qe=Re.add(de)._unit(),ui=ut*Math.min(4,1/(Re.x*qe.x+Re.y*qe.y));Ne+=ui*qe.x,me+=ui*qe.y,Re=de}Yc(this.layoutVertexArray,Ne,me,0,0,1,1,0),Ft.vertexLength++,Ot.push(Te.x,Te.y),N&&qd(this.layoutVertexExtArray,L.projectTilePoint(Ne,me,d),L.upVector(d,Ne,me))}}const oe=$m(Ot,he);for(let _e=0;_e<oe.length;_e+=3)this.indexArray.emplaceBack(bt+oe[_e],bt+oe[_e+2],bt+oe[_e+1]),Ft.primitiveLength++}for(const Ot of vt){V&&Ot.length&&V.startRing(Ot[0]);let he,oe,_e,Re=Ot.length>4&&Y_(Ot[Ot.length-2],Ot[0],Ot[1]),de=ut?M0(Ot[Ot.length-2],Ot[0],Ot[1],ut):0;oe=Ot[1].sub(Ot[0])._perp()._unit();let we=!0;for(let Te=1,Pe=0;Te<Ot.length;Te++){let Ne=Ot[Te-1],me=Ot[Te];const qe=Ot[Te===Ot.length-1?1:Te+1];if(V&&W&&V.currentPolyCount.top++,Yd(me,Ne,Pt)){ut&&(oe=qe.sub(me)._perp()._unit(),we=!we);continue}V&&V.append(me,Ne);const ui=me.sub(Ne)._perp(),Qe=ui.x/(Math.abs(ui.x)+Math.abs(ui.y)),Fi=ui.y>0?1:0,je=Ne.dist(me);if(Pe+je>32768&&(Pe=0),ut){_e=qe.sub(me)._perp()._unit();let ji=Z_(Ne,me,qe,q_(oe,_e),ut);isNaN(ji)&&(ji=0);const Mi=me.sub(Ne)._unit();Ne=Ne.add(Mi.mult(de))._round(),me=me.add(Mi.mult(-ji))._round(),de=ji,oe=_e}const bi=Ft.vertexLength,Ni=Ot.length>4&&Y_(Ne,me,qe);let _s=K_(Pe,Re,we);if(Yc(this.layoutVertexArray,Ne.x,Ne.y,Qe,Fi,0,0,_s),Yc(this.layoutVertexArray,Ne.x,Ne.y,Qe,Fi,0,1,_s),Pe+=je,_s=K_(Pe,Ni,!we),Re=Ni,Yc(this.layoutVertexArray,me.x,me.y,Qe,Fi,0,0,_s),Yc(this.layoutVertexArray,me.x,me.y,Qe,Fi,0,1,_s),Ft.vertexLength+=4,this.indexArray.emplaceBack(bi+0,bi+1,bi+2),this.indexArray.emplaceBack(bi+1,bi+3,bi+2),Ft.primitiveLength+=2,ut){const ji=bt+(Te===1?Ot.length-2:Te-2),Mi=Te===1?bt:ji+1;if(this.indexArray.emplaceBack(bi+1,ji,bi+3),this.indexArray.emplaceBack(ji,Mi,bi+3),Ft.primitiveLength+=2,he===void 0&&(he=bi),!Yd(qe,Ot[Te],Pt)){const Js=Te===Ot.length-1?he:Ft.vertexLength;this.indexArray.emplaceBack(bi+2,bi+3,Js),this.indexArray.emplaceBack(bi+3,Js+1,Js),this.indexArray.emplaceBack(bi+3,Mi,Js+1),Ft.primitiveLength+=3}we=!we}if(N){const ji=this.layoutVertexExtArray,Mi=L.projectTilePoint(Ne.x,Ne.y,d),Js=L.projectTilePoint(me.x,me.y,d),$i=L.upVector(d,Ne.x,Ne.y),Gi=L.upVector(d,me.x,me.y);qd(ji,Mi,$i),qd(ji,Mi,$i),qd(ji,Js,Gi),qd(ji,Js,Gi)}}W&&(bt+=Ot.length-1)}}if(V&&V.polyCount.length>0){if(V.borders){V.vertexArrayOffset=this.centroidVertexArray.length;const vt=V.borders,Pt=this.featuresOnBorder.push(V)-1;for(let bt=0;bt<4;bt++)vt[bt][0]!==Number.MAX_VALUE&&this.borders[bt].push(Pt)}this.encodeCentroid(V.borders?void 0:V.centroid(),V)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,_,v,d)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((n,c)=>this.featuresOnBorder[n].borders[t][0]-this.featuresOnBorder[c].borders[t][0])}encodeCentroid(t,n,c=!0){let d,_;if(t)if(t.y!==0){const E=n.span()._mult(this.tileToMeter);d=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(E.x/10)),_=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(E.y/10))}else d=Math.ceil(7*(t.x+450)),_=0;else d=0,_=+c;let v=c?this.centroidVertexArray.length:n.vertexArrayOffset;for(const E of n.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*E.edges+E.top);for(let k=0;k<E.top;k++)this.centroidVertexArray.emplace(v++,d,_);for(let k=0;k<2*E.edges;k++)this.centroidVertexArray.emplace(v++,0,_),this.centroidVertexArray.emplace(v++,d,_)}}}function q_(s,t){const n=s.add(t)._unit();return s.x*n.x+s.y*n.y}function M0(s,t,n,c){const d=t.sub(s)._perp()._unit(),_=n.sub(t)._perp()._unit();return Z_(s,t,n,q_(d,_),c)}function Z_(s,t,n,c,d){const _=Math.sqrt(1-c*c);return Math.min(s.dist(t)/3,t.dist(n)/3,d*_/c)}function Yd(s,t,n){return s.x<n[0].x&&t.x<n[0].x||s.x>n[1].x&&t.x>n[1].x||s.y<n[0].y&&t.y<n[0].y||s.y>n[1].y&&t.y>n[1].y}function Y_(s,t,n){if(s.x<0||s.x>=gi||t.x<0||t.x>=gi||n.x<0||n.x>=gi)return!1;const c=n.sub(t),d=c.perp(),_=s.sub(t);return(c.x*_.x+c.y*_.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(_.x*_.x+_.y*_.y))>-.866&&d.x*_.x+d.y*_.y<0}function K_(s,t,n){const c=t?2|s:-3&s;return n?1|c:-2&c}function J_(){const s=Math.PI/32,t=Math.tan(s),n=Dd;return n*Math.sqrt(1+2*t*t)-n}function Ym(s,t,n){const c=1<<n.z,d=fo(n.x/c),_=fo((n.x+1)/c),v=cr(n.y/c),E=cr((n.y+1)/c);return function(k,L,N,V,W=0,Y){const K=[];if(!k.length||!N||!V)return K;const st=(Ot,he)=>{for(const oe of Ot)K.push({polygon:oe,bounds:he})},ut=Math.ceil(Math.log2(N)),vt=Math.ceil(Math.log2(V)),Pt=ut-vt,bt=[];for(let Ot=0;Ot<Math.abs(Pt);Ot++)bt.push(Pt>0?0:1);for(let Ot=0;Ot<Math.min(ut,vt);Ot++)bt.push(0),bt.push(1);let Ct=k;if(Ct=Xd(Ct,L[0].y-W,L[1].y+W,1),Ct=Xd(Ct,L[0].x-W,L[1].x+W,0),!Ct.length)return K;const Ft=[];for(bt.length?Ft.push({polygons:Ct,bounds:L,depth:0}):st(Ct,L);Ft.length;){const Ot=Ft.pop(),he=Ot.depth,oe=bt[he],_e=Ot.bounds[0],Re=Ot.bounds[1],de=oe===0?_e.x:_e.y,we=oe===0?Re.x:Re.y,Te=Y?Y(oe,de,we):.5*(de+we),Pe=Xd(Ot.polygons,de-W,Te+W,oe),Ne=Xd(Ot.polygons,Te-W,we+W,oe);if(Pe.length){const me=[_e,new Ut(oe===0?Te:Re.x,oe===1?Te:Re.y)];bt.length>he+1?Ft.push({polygons:Pe,bounds:me,depth:he+1}):st(Pe,me)}if(Ne.length){const me=[new Ut(oe===0?Te:_e.x,oe===1?Te:_e.y),Re];bt.length>he+1?Ft.push({polygons:Ne,bounds:me,depth:he+1}):st(Ne,me)}}return K}(s,t,Math.ceil((_-d)/11.25),Math.ceil((v-E)/11.25),1,(k,L,N)=>{if(k===0)return .5*(L+N);{const V=cr((n.y+L/gi)/c);return(Bo(.5*(cr((n.y+N/gi)/c)+V))*c-n.y)*gi}})}oi(Zd,"FillExtrusionBucket",{omit:["layers","features"]}),oi(X_,"PartMetadata");const B=new Et({"fill-extrusion-edge-radius":new et(pe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var l={paint:new Et({"fill-extrusion-opacity":new et(pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ft(pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new et(pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new et(pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ft(pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ft(pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ft(pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new et(pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new et(pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new et(pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new et(pe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:B};function f(s,t,n){var c=2*Math.PI*6378137/256/Math.pow(2,n);return[s*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}class g{constructor(t,n,c){this.z=t,this.x=n,this.y=c,this.key=A(0,t,t,n,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n){const c=function(_,v,E){var k=f(256*_,256*(v=Math.pow(2,E)-v-1),E),L=f(256*(_+1),256*(v+1),E);return k[0]+","+k[1]+","+L[0]+","+L[1]}(this.x,this.y,this.z),d=function(_,v,E){let k,L="";for(let N=_;N>0;N--)k=1<<N-1,L+=(v&k?1:0)+(E&k?2:0);return L}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class b{constructor(t,n){this.wrap=t,this.canonical=n,this.key=A(t,n.z,n.z,n.x,n.y)}}class w{constructor(t,n,c,d,_){this.overscaledZ=t,this.wrap=n,this.canonical=new g(c,+d,+_),this.key=n===0&&t===c?this.canonical.key:A(n,t,c,d,_)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const n=this.canonical.z-t;return t>this.canonical.z?new w(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new w(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n=!0){if(this.overscaledZ===t&&n)return this.key;if(t>this.canonical.z)return A(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-t;return A(this.wrap*+n,t,t,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new w(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,c=2*this.canonical.x,d=2*this.canonical.y;return[new w(n,this.wrap,n,c,d),new w(n,this.wrap,n,c+1,d),new w(n,this.wrap,n,c,d+1),new w(n,this.wrap,n,c+1,d+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new w(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new w(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new b(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function A(s,t,n,c,d){const _=1<<Math.min(n,22);let v=_*(d%_)+c%_;return s&&n<22&&(v+=_*_*((s<0?-2*s-1:2*s)%(1<<2*(22-n)))),16*(32*v+n)+(t-n)}oi(g,"CanonicalTileID"),oi(w,"OverscaledTileID",{omit:["projMatrix"]});class C extends Ut{constructor(t,n,c){super(t,n),this.z=c}}function I(s,t){return s.x*t.x+s.y*t.y}function R(s,t){if(s.length===1){let n=0;const c=t[n++];let d;for(;!d||c.equals(d);)if(d=t[n++],!d)return 1/0;for(;n<t.length;n++){const _=t[n],v=s[0],E=d.sub(c),k=_.sub(c),L=v.sub(c),N=I(E,E),V=I(E,k),W=I(k,k),Y=I(L,E),K=I(L,k),st=N*W-V*V,ut=(W*Y-V*K)/st,vt=(N*K-V*Y)/st,Pt=c.z*(1-ut-vt)+d.z*ut+_.z*vt;if(isFinite(Pt))return Pt}return 1/0}{let n=1/0;for(const c of t)n=Math.min(n,c.z);return n}}function U(s,t,n,c,d,_,v,E){const k=v*d.getElevationAt(s,t,!0,!0),L=_[0]!==0,N=L?_[1]===0?v*(_[0]/7-450):v*function(V,W,Y){const K=Math.floor(W[0]/8),st=Math.floor(W[1]/8),ut=10*(W[0]-8*K),vt=10*(W[1]-8*st),Pt=V.getElevationAt(K,st,!0,!0),bt=V.getMeterToDEM(Y),Ct=Math.floor(.5*(ut*bt-1)),Ft=Math.floor(.5*(vt*bt-1)),Ot=V.tileCoordToPixel(K,st),he=2*Ct+1,oe=2*Ft+1,_e=function(Ne,me,qe,ui,Qe){return[Ne.getElevationAtPixel(me,qe,!0),Ne.getElevationAtPixel(me+Qe,qe,!0),Ne.getElevationAtPixel(me,qe+Qe,!0),Ne.getElevationAtPixel(me+ui,qe+Qe,!0)]}(V,Ot.x-Ct,Ot.y-Ft,he,oe),Re=Math.abs(_e[0]-_e[1]),de=Math.abs(_e[2]-_e[3]),we=Math.abs(_e[0]-_e[2])+Math.abs(_e[1]-_e[3]),Te=Math.min(.25,.5*bt*(Re+de)/he),Pe=Math.min(.25,.5*bt*we/oe);return Pt+Math.max(Te*ut,Pe*vt)}(d,_,E):k;return{base:k+(n===0)?-1:n,top:L?Math.max(N+c,k+n+2):k+c}}const F=Yt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:G}=F,Z=Yt([{name:"a_packed",components:4,type:"Float32"}]),{members:J}=Z,ot=Hd.types,rt=Math.cos(Math.PI/180*37.5);class it{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new ue,this.layoutVertexArray2=new Ie,this.indexArray=new mi,this.programConfigurations=new Yl(t.layers,t.zoom),this.segments=new yn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,c,d){this.hasPattern=Gm("line",this.layers,n);const _=this.layers[0].layout.get("line-sort-key"),v=[];for(const{feature:N,id:V,index:W,sourceLayerIndex:Y}of t){const K=this.layers[0]._featureFilter.needGeometry,st=Xc(N,K);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),st,c))continue;const ut=_?_.evaluate(st,{},c):void 0,vt={id:V,properties:N.properties,type:N.type,sourceLayerIndex:Y,index:W,geometry:K?st.geometry:fa(N,c,d),patterns:{},sortKey:ut};v.push(vt)}_&&v.sort((N,V)=>N.sortKey-V.sortKey);const{lineAtlas:E,featureIndex:k}=n,L=this.addConstantDashes(E);for(const N of v){const{geometry:V,index:W,sourceLayerIndex:Y}=N;if(L&&this.addFeatureDashes(N,E),this.hasPattern){const K=Wm("line",this.layers,N,this.zoom,n);this.patternFeatures.push(K)}else this.addFeature(N,V,W,c,E.positions,n.availableImages);k.insert(t[W].feature,V,W,Y,this.index)}}addConstantDashes(t){let n=!1;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,_=c.layout.get("line-cap").value;if(d.kind!=="constant"||_.kind!=="constant")n=!0;else{const v=_.value,E=d.value;if(!E)continue;t.addDash(E,v)}}return n}addFeatureDashes(t,n){const c=this.zoom;for(const d of this.layers){const _=d.paint.get("line-dasharray").value,v=d.layout.get("line-cap").value;if(_.kind==="constant"&&v.kind==="constant")continue;let E,k;if(_.kind==="constant"){if(E=_.value,!E)continue}else E=_.evaluate({zoom:c},t);k=v.kind==="constant"?v.value:v.evaluate({zoom:c},t),n.addDash(E,k),t.patterns[d.id]=n.getKey(E,k)}}update(t,n,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,c,d)}addFeatures(t,n,c,d,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,n,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,J)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,G),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,c,d,_,v){const E=this.layers[0].layout,k=E.get("line-join").evaluate(t,{}),L=E.get("line-cap").evaluate(t,{}),N=E.get("line-miter-limit"),V=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const W of n)this.addLine(W,t,k,L,N,V);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,_,v,d)}addLine(t,n,c,d,_,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let vt=0;vt<t.length-1;vt++)this.totalDistance+=t[vt].dist(t[vt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=ot[n.type]==="Polygon";let k=t.length;for(;k>=2&&t[k-1].equals(t[k-2]);)k--;let L=0;for(;L<k-1&&t[L].equals(t[L+1]);)L++;if(k<(E?3:2))return;c==="bevel"&&(_=1.05);const N=this.overscaling<=16?15*gi/(512*this.overscaling):0,V=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let W,Y,K,st,ut;this.e1=this.e2=-1,E&&(W=t[k-2],ut=t[L].sub(W)._unit()._perp());for(let vt=L;vt<k;vt++){if(K=vt===k-1?E?t[L+1]:void 0:t[vt+1],K&&t[vt].equals(K))continue;ut&&(st=ut),W&&(Y=W),W=t[vt],ut=K?K.sub(W)._unit()._perp():st,st=st||ut;let Pt=st.add(ut);Pt.x===0&&Pt.y===0||Pt._unit();const bt=st.x*ut.x+st.y*ut.y,Ct=Pt.x*ut.x+Pt.y*ut.y,Ft=Ct!==0?1/Ct:1/0,Ot=2*Math.sqrt(2-2*Ct),he=Ct<rt&&Y&&K,oe=st.x*ut.y-st.y*ut.x>0;if(he&&vt>L){const de=W.dist(Y);if(de>2*N){const we=W.sub(W.sub(Y)._mult(N/de)._round());this.updateDistance(Y,we),this.addCurrentVertex(we,st,0,0,V),Y=we}}const _e=Y&&K;let Re=_e?c:E?"butt":d;if(_e&&Re==="round"&&(Ft<v?Re="miter":Ft<=2&&(Re="fakeround")),Re==="miter"&&Ft>_&&(Re="bevel"),Re==="bevel"&&(Ft>2&&(Re="flipbevel"),Ft<_&&(Re="miter")),Y&&this.updateDistance(Y,W),Re==="miter")Pt._mult(Ft),this.addCurrentVertex(W,Pt,0,0,V);else if(Re==="flipbevel"){if(Ft>100)Pt=ut.mult(-1);else{const de=Ft*st.add(ut).mag()/st.sub(ut).mag();Pt._perp()._mult(de*(oe?-1:1))}this.addCurrentVertex(W,Pt,0,0,V),this.addCurrentVertex(W,Pt.mult(-1),0,0,V)}else if(Re==="bevel"||Re==="fakeround"){const de=-Math.sqrt(Ft*Ft-1),we=oe?de:0,Te=oe?0:de;if(Y&&this.addCurrentVertex(W,st,we,Te,V),Re==="fakeround"){const Pe=Math.round(180*Ot/Math.PI/20);for(let Ne=1;Ne<Pe;Ne++){let me=Ne/Pe;if(me!==.5){const ui=me-.5;me+=me*ui*(me-1)*((1.0904+bt*(bt*(3.55645-1.43519*bt)-3.2452))*ui*ui+(.848013+bt*(.215638*bt-1.06021)))}const qe=ut.sub(st)._mult(me)._add(st)._unit()._mult(oe?-1:1);this.addHalfVertex(W,qe.x,qe.y,!1,oe,0,V)}}K&&this.addCurrentVertex(W,ut,-we,-Te,V)}else if(Re==="butt")this.addCurrentVertex(W,Pt,0,0,V);else if(Re==="square"){const de=Y?1:-1;Y||this.addCurrentVertex(W,Pt,de,de,V),this.addCurrentVertex(W,Pt,0,0,V),Y&&this.addCurrentVertex(W,Pt,de,de,V)}else Re==="round"&&(Y&&(this.addCurrentVertex(W,st,0,0,V),this.addCurrentVertex(W,st,1,1,V,!0)),K&&(this.addCurrentVertex(W,ut,-1,-1,V,!0),this.addCurrentVertex(W,ut,0,0,V)));if(he&&vt<k-1){const de=W.dist(K);if(de>2*N){const we=W.add(K.sub(W)._mult(N/de)._round());this.updateDistance(W,we),this.addCurrentVertex(we,ut,0,0,V),W=we}}}}addCurrentVertex(t,n,c,d,_,v=!1){const E=n.y*d-n.x,k=-n.y-n.x*d;this.addHalfVertex(t,n.x+n.y*c,n.y-n.x*c,v,!1,c,_),this.addHalfVertex(t,E,k,v,!0,-d,_)}addHalfVertex({x:t,y:n},c,d,_,v,E,k){this.layoutVertexArray.emplaceBack((t<<1)+(_?1:0),(n<<1)+(v?1:0),Math.round(63*c)+128,Math.round(63*d)+128,1+(E===0?0:E<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const L=k.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),k.primitiveLength++),v?this.e2=L:this.e1=L}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}oi(it,"LineBucket",{omit:["layers","patternFeatures"]});const ct=new Et({"line-cap":new ft(pe.layout_line["line-cap"]),"line-join":new ft(pe.layout_line["line-join"]),"line-miter-limit":new et(pe.layout_line["line-miter-limit"]),"line-round-limit":new et(pe.layout_line["line-round-limit"]),"line-sort-key":new ft(pe.layout_line["line-sort-key"])});var dt={paint:new Et({"line-opacity":new ft(pe.paint_line["line-opacity"]),"line-color":new ft(pe.paint_line["line-color"]),"line-translate":new et(pe.paint_line["line-translate"]),"line-translate-anchor":new et(pe.paint_line["line-translate-anchor"]),"line-width":new ft(pe.paint_line["line-width"]),"line-gap-width":new ft(pe.paint_line["line-gap-width"]),"line-offset":new ft(pe.paint_line["line-offset"]),"line-blur":new ft(pe.paint_line["line-blur"]),"line-dasharray":new ft(pe.paint_line["line-dasharray"]),"line-pattern":new ft(pe.paint_line["line-pattern"]),"line-gradient":new St(pe.paint_line["line-gradient"]),"line-trim-offset":new et(pe.paint_line["line-trim-offset"])}),layout:ct};const Ht=new class extends ft{possiblyEvaluate(s,t){return t=new j(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(s,t)}evaluate(s,t,n,c){return t=Ji({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(s,t,n,c)}}(dt.paint.properties["line-width"].specification);function Bt(s,t){return t>0?t+2*s:s}Ht.useIntegerZoom=!0;const Vt=Yt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),le=Yt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Kt=Yt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Yt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ce=Yt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Ee=Yt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Yt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Be=Yt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$e=Yt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Yt([{name:"triangle",components:3,type:"Uint16"}]),Yt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Yt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Yt([{type:"Float32",name:"offsetX"}]),Yt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ae=24;const Je=128;function ri(s,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new j(s+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:d}=n;let _=0;for(;_<c.length&&c[_]<=s;)_++;_=Math.max(0,_-1);let v=_;for(;v<c.length&&c[v]<s+1;)v++;v=Math.min(c.length-1,v);const E=c[_],k=c[v];return n.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:k,interpolationType:d}:{kind:"camera",minZoom:E,maxZoom:k,minSize:n.evaluate(new j(E)),maxSize:n.evaluate(new j(k)),interpolationType:d}}}function Ii(s,{uSize:t,uSizeT:n},{lowerSize:c,upperSize:d}){return s.kind==="source"?c/Je:s.kind==="composite"?rs(c/Je,d/Je,n):t}function hi(s,t){let n=0,c=0;if(s.kind==="constant")c=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:d,minZoom:_,maxZoom:v}=s,E=d?pi(Fr.interpolationFactor(d,t,_,v),0,1):0;s.kind==="camera"?c=rs(s.minSize,s.maxSize,E):n=E}return{uSizeT:n,uSize:c}}var Li=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Je,evaluateSizeForFeature:Ii,evaluateSizeForZoom:hi,getSizeData:ri});function as(s,t,n){return s.sections.forEach(c=>{c.text=function(d,_,v){const E=_.layout.get("text-transform").evaluate(v,{});return E==="uppercase"?d=d.toLocaleUpperCase():E==="lowercase"&&(d=d.toLocaleLowerCase()),O.applyArabicShaping&&(d=O.applyArabicShaping(d)),d}(c.text,t,n)}),s}const Zi={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function ds(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}function gr(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}var ls=si,Ms=function(s,t,n,c,d){var _,v,E=8*d-c-1,k=(1<<E)-1,L=k>>1,N=-7,V=d-1,W=-1,Y=s[t+V];for(V+=W,_=Y&(1<<-N)-1,Y>>=-N,N+=E;N>0;_=256*_+s[t+V],V+=W,N-=8);for(v=_&(1<<-N)-1,_>>=-N,N+=c;N>0;v=256*v+s[t+V],V+=W,N-=8);if(_===0)_=1-L;else{if(_===k)return v?NaN:1/0*(Y?-1:1);v+=Math.pow(2,c),_-=L}return(Y?-1:1)*v*Math.pow(2,_-c)},Bi=function(s,t,n,c,d,_){var v,E,k,L=8*_-d-1,N=(1<<L)-1,V=N>>1,W=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,Y=0,K=1,st=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(E=isNaN(t)?1:0,v=N):(v=Math.floor(Math.log(t)/Math.LN2),t*(k=Math.pow(2,-v))<1&&(v--,k*=2),(t+=v+V>=1?W/k:W*Math.pow(2,1-V))*k>=2&&(v++,k/=2),v+V>=N?(E=0,v=N):v+V>=1?(E=(t*k-1)*Math.pow(2,d),v+=V):(E=t*Math.pow(2,V-1)*Math.pow(2,d),v=0));d>=8;s[n+Y]=255&E,Y+=K,E/=256,d-=8);for(v=v<<d|E,L+=d;L>0;s[n+Y]=255&v,Y+=K,v/=256,L-=8);s[n+Y-K]|=128*st};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function si(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}si.Varint=0,si.Fixed64=1,si.Bytes=2,si.Fixed32=5;var xn=4294967296,As=1/xn,$s=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ks(s){return s.type===si.Bytes?s.readVarint()+s.pos:s.pos+1}function Xr(s,t,n){return n?4294967296*t+(s>>>0):4294967296*(t>>>0)+(s>>>0)}function mo(s,t,n){var c=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(c);for(var d=n.pos-1;d>=s;d--)n.buf[d+c]=n.buf[d]}function Fo(s,t){for(var n=0;n<s.length;n++)t.writeVarint(s[n])}function Dr(s,t){for(var n=0;n<s.length;n++)t.writeSVarint(s[n])}function Rn(s,t){for(var n=0;n<s.length;n++)t.writeFloat(s[n])}function Kd(s,t){for(var n=0;n<s.length;n++)t.writeDouble(s[n])}function nc(s,t){for(var n=0;n<s.length;n++)t.writeBoolean(s[n])}function Kc(s,t){for(var n=0;n<s.length;n++)t.writeFixed32(s[n])}function Jd(s,t){for(var n=0;n<s.length;n++)t.writeSFixed32(s[n])}function pa(s,t){for(var n=0;n<s.length;n++)t.writeFixed64(s[n])}function lu(s,t){for(var n=0;n<s.length;n++)t.writeSFixed64(s[n])}function Qd(s,t){return(s[t]|s[t+1]<<8|s[t+2]<<16)+16777216*s[t+3]}function wp(s,t,n){s[n]=t,s[n+1]=t>>>8,s[n+2]=t>>>16,s[n+3]=t>>>24}function i1(s,t){return(s[t]|s[t+1]<<8|s[t+2]<<16)+(s[t+3]<<24)}si.prototype={destroy:function(){this.buf=null},readFields:function(s,t,n){for(n=n||this.length;this.pos<n;){var c=this.readVarint(),d=c>>3,_=this.pos;this.type=7&c,s(d,t,this),this.pos===_&&this.skip(c)}return t},readMessage:function(s,t){return this.readFields(s,t,this.readVarint()+this.pos)},readFixed32:function(){var s=Qd(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=i1(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Qd(this.buf,this.pos)+Qd(this.buf,this.pos+4)*xn;return this.pos+=8,s},readSFixed64:function(){var s=Qd(this.buf,this.pos)+i1(this.buf,this.pos+4)*xn;return this.pos+=8,s},readFloat:function(){var s=Ms(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Ms(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var t,n,c=this.buf;return t=127&(n=c[this.pos++]),n<128?t:(t|=(127&(n=c[this.pos++]))<<7,n<128?t:(t|=(127&(n=c[this.pos++]))<<14,n<128?t:(t|=(127&(n=c[this.pos++]))<<21,n<128?t:function(d,_,v){var E,k,L=v.buf;if(E=(112&(k=L[v.pos++]))>>4,k<128||(E|=(127&(k=L[v.pos++]))<<3,k<128)||(E|=(127&(k=L[v.pos++]))<<10,k<128)||(E|=(127&(k=L[v.pos++]))<<17,k<128)||(E|=(127&(k=L[v.pos++]))<<24,k<128)||(E|=(1&(k=L[v.pos++]))<<31,k<128))return Xr(d,E,_);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=c[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,t=this.pos;return this.pos=s,s-t>=12&&$s?function(n,c,d){return $s.decode(n.subarray(c,d))}(this.buf,t,s):function(n,c,d){for(var _="",v=c;v<d;){var E,k,L,N=n[v],V=null,W=N>239?4:N>223?3:N>191?2:1;if(v+W>d)break;W===1?N<128&&(V=N):W===2?(192&(E=n[v+1]))==128&&(V=(31&N)<<6|63&E)<=127&&(V=null):W===3?(k=n[v+2],(192&(E=n[v+1]))==128&&(192&k)==128&&((V=(15&N)<<12|(63&E)<<6|63&k)<=2047||V>=55296&&V<=57343)&&(V=null)):W===4&&(k=n[v+2],L=n[v+3],(192&(E=n[v+1]))==128&&(192&k)==128&&(192&L)==128&&((V=(15&N)<<18|(63&E)<<12|(63&k)<<6|63&L)<=65535||V>=1114112)&&(V=null)),V===null?(V=65533,W=1):V>65535&&(V-=65536,_+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),_+=String.fromCharCode(V),v+=W}return _}(this.buf,t,s)},readBytes:function(){var s=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,s);return this.pos=s,t},readPackedVarint:function(s,t){if(this.type!==si.Bytes)return s.push(this.readVarint(t));var n=Ks(this);for(s=s||[];this.pos<n;)s.push(this.readVarint(t));return s},readPackedSVarint:function(s){if(this.type!==si.Bytes)return s.push(this.readSVarint());var t=Ks(this);for(s=s||[];this.pos<t;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==si.Bytes)return s.push(this.readBoolean());var t=Ks(this);for(s=s||[];this.pos<t;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==si.Bytes)return s.push(this.readFloat());var t=Ks(this);for(s=s||[];this.pos<t;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==si.Bytes)return s.push(this.readDouble());var t=Ks(this);for(s=s||[];this.pos<t;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==si.Bytes)return s.push(this.readFixed32());var t=Ks(this);for(s=s||[];this.pos<t;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==si.Bytes)return s.push(this.readSFixed32());var t=Ks(this);for(s=s||[];this.pos<t;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==si.Bytes)return s.push(this.readFixed64());var t=Ks(this);for(s=s||[];this.pos<t;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==si.Bytes)return s.push(this.readSFixed64());var t=Ks(this);for(s=s||[];this.pos<t;)s.push(this.readSFixed64());return s},skip:function(s){var t=7&s;if(t===si.Varint)for(;this.buf[this.pos++]>127;);else if(t===si.Bytes)this.pos=this.readVarint()+this.pos;else if(t===si.Fixed32)this.pos+=4;else{if(t!==si.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(s,t){this.writeVarint(s<<3|t)},realloc:function(s){for(var t=this.length||16;t<this.pos+s;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),wp(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),wp(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),wp(this.buf,-1&s,this.pos),wp(this.buf,Math.floor(s*As),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),wp(this.buf,-1&s,this.pos),wp(this.buf,Math.floor(s*As),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(t,n){var c,d;if(t>=0?(c=t%4294967296|0,d=t/4294967296|0):(d=~(-t/4294967296),4294967295^(c=~(-t%4294967296))?c=c+1|0:(c=0,d=d+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(_,v,E){E.buf[E.pos++]=127&_|128,_>>>=7,E.buf[E.pos++]=127&_|128,_>>>=7,E.buf[E.pos++]=127&_|128,_>>>=7,E.buf[E.pos++]=127&_|128,E.buf[E.pos]=127&(_>>>=7)}(c,0,n),function(_,v){var E=(7&_)<<4;v.buf[v.pos++]|=E|((_>>>=3)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_)))))}(d,n)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var t=this.pos;this.pos=function(c,d,_){for(var v,E,k=0;k<d.length;k++){if((v=d.charCodeAt(k))>55295&&v<57344){if(!E){v>56319||k+1===d.length?(c[_++]=239,c[_++]=191,c[_++]=189):E=v;continue}if(v<56320){c[_++]=239,c[_++]=191,c[_++]=189,E=v;continue}v=E-55296<<10|v-56320|65536,E=null}else E&&(c[_++]=239,c[_++]=191,c[_++]=189,E=null);v<128?c[_++]=v:(v<2048?c[_++]=v>>6|192:(v<65536?c[_++]=v>>12|224:(c[_++]=v>>18|240,c[_++]=v>>12&63|128),c[_++]=v>>6&63|128),c[_++]=63&v|128)}return _}(this.buf,s,this.pos);var n=this.pos-t;n>=128&&mo(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(s){this.realloc(4),Bi(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Bi(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var t=s.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=s[n]},writeRawMessage:function(s,t){this.pos++;var n=this.pos;s(t,this);var c=this.pos-n;c>=128&&mo(n,c,this),this.pos=n-1,this.writeVarint(c),this.pos+=c},writeMessage:function(s,t,n){this.writeTag(s,si.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(s,t){t.length&&this.writeMessage(s,Fo,t)},writePackedSVarint:function(s,t){t.length&&this.writeMessage(s,Dr,t)},writePackedBoolean:function(s,t){t.length&&this.writeMessage(s,nc,t)},writePackedFloat:function(s,t){t.length&&this.writeMessage(s,Rn,t)},writePackedDouble:function(s,t){t.length&&this.writeMessage(s,Kd,t)},writePackedFixed32:function(s,t){t.length&&this.writeMessage(s,Kc,t)},writePackedSFixed32:function(s,t){t.length&&this.writeMessage(s,Jd,t)},writePackedFixed64:function(s,t){t.length&&this.writeMessage(s,pa,t)},writePackedSFixed64:function(s,t){t.length&&this.writeMessage(s,lu,t)},writeBytesField:function(s,t){this.writeTag(s,si.Bytes),this.writeBytes(t)},writeFixed32Field:function(s,t){this.writeTag(s,si.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(s,t){this.writeTag(s,si.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(s,t){this.writeTag(s,si.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(s,t){this.writeTag(s,si.Fixed64),this.writeSFixed64(t)},writeVarintField:function(s,t){this.writeTag(s,si.Varint),this.writeVarint(t)},writeSVarintField:function(s,t){this.writeTag(s,si.Varint),this.writeSVarint(t)},writeStringField:function(s,t){this.writeTag(s,si.Bytes),this.writeString(t)},writeFloatField:function(s,t){this.writeTag(s,si.Fixed32),this.writeFloat(t)},writeDoubleField:function(s,t){this.writeTag(s,si.Fixed64),this.writeDouble(t)},writeBooleanField:function(s,t){this.writeVarintField(s,!!t)}};var Q_=It(ls);const A0=3;function FA(s,t,n){t.glyphs=[],s===1&&n.readMessage(NA,t)}function NA(s,t,n){if(s===3){const{id:c,bitmap:d,width:_,height:v,left:E,top:k,advance:L}=n.readMessage(jA,{});t.glyphs.push({id:c,bitmap:new pl({width:_+2*A0,height:v+2*A0},d),metrics:{width:_,height:v,left:E,top:k,advance:L}})}else s===4?t.ascender=n.readSVarint():s===5&&(t.descender=n.readSVarint())}function jA(s,t,n){s===1?t.id=n.readVarint():s===2?t.bitmap=n.readBytes():s===3?t.width=n.readVarint():s===4?t.height=n.readVarint():s===5?t.left=n.readSVarint():s===6?t.top=n.readSVarint():s===7&&(t.advance=n.readVarint())}const UA=A0;function C0(s){let t=0,n=0;for(const v of s)t+=v.w*v.h,n=Math.max(n,v.w);s.sort((v,E)=>E.h-v.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let d=0,_=0;for(const v of s)for(let E=c.length-1;E>=0;E--){const k=c[E];if(!(v.w>k.w||v.h>k.h)){if(v.x=k.x,v.y=k.y,_=Math.max(_,v.y+v.h),d=Math.max(d,v.x+v.w),v.w===k.w&&v.h===k.h){const L=c.pop();E<c.length&&(c[E]=L)}else v.h===k.h?(k.x+=v.w,k.w-=v.w):v.w===k.w?(k.y+=v.h,k.h-=v.h):(c.push({x:k.x+v.w,y:k.y,w:k.w-v.w,h:v.h}),k.y+=v.h,k.h-=v.h);break}}return{w:d,h:_,fill:t/(d*_)||0}}const go=1;class k0{constructor(t,{pixelRatio:n,version:c,stretchX:d,stretchY:_,content:v}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=d,this.stretchY=_,this.content=v,this.version=c}get tl(){return[this.paddedRect.x+go,this.paddedRect.y+go]}get br(){return[this.paddedRect.x+this.paddedRect.w-go,this.paddedRect.y+this.paddedRect.h-go]}get displaySize(){return[(this.paddedRect.w-2*go)/this.pixelRatio,(this.paddedRect.h-2*go)/this.pixelRatio]}}class s1{constructor(t,n){const c={},d={};this.haveRenderCallbacks=[];const _=[];this.addImages(t,c,_),this.addImages(n,d,_);const{w:v,h:E}=C0(_),k=new Hr({width:v||1,height:E||1});for(const L in t){const N=t[L],V=c[L].paddedRect;Hr.copy(N.data,k,{x:0,y:0},{x:V.x+go,y:V.y+go},N.data)}for(const L in n){const N=n[L],V=d[L].paddedRect,W=V.x+go,Y=V.y+go,K=N.data.width,st=N.data.height;Hr.copy(N.data,k,{x:0,y:0},{x:W,y:Y},N.data),Hr.copy(N.data,k,{x:0,y:st-1},{x:W,y:Y-1},{width:K,height:1}),Hr.copy(N.data,k,{x:0,y:0},{x:W,y:Y+st},{width:K,height:1}),Hr.copy(N.data,k,{x:K-1,y:0},{x:W-1,y:Y},{width:1,height:st}),Hr.copy(N.data,k,{x:0,y:0},{x:W+K,y:Y},{width:1,height:st})}this.image=k,this.iconPositions=c,this.patternPositions=d}addImages(t,n,c){for(const d in t){const _=t[d],v={x:0,y:0,w:_.data.width+2*go,h:_.data.height+2*go};c.push(v),n[d]=new k0(v,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(t,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>t.hasImage(c)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in t.updatedImages)this.patchUpdatedImage(this.iconPositions[c],t.getImage(c),n),this.patchUpdatedImage(this.patternPositions[c],t.getImage(c),n)}patchUpdatedImage(t,n,c){if(!t||!n||t.version===n.version)return;t.version=n.version;const[d,_]=t.tl;c.update(n.data,void 0,{x:d,y:_})}}oi(k0,"ImagePosition"),oi(s1,"ImageAtlas");const ma={horizontal:1,vertical:2,horizontalOnly:3},n1=-17;class Km{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const c=new Km;return c.scale=t||1,c.fontStack=n,c}static forImage(t){const n=new Km;return n.imageName=t,n}}class Tp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const c=new Tp;for(let d=0;d<t.sections.length;d++){const _=t.sections[d];_.image?c.addImageSection(_):c.addTextSection(_,n)}return c}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(n,c){let d="";for(let _=0;_<n.length;_++){const v=n.charCodeAt(_+1)||null,E=n.charCodeAt(_-1)||null;d+=!c&&(v&&al(v)&&!Zi[n[_+1]]||E&&al(E)&&!Zi[n[_-1]])||!Zi[n[_]]?n[_]:Zi[n[_]]}return d}(this.text,t)}trim(){let t=0;for(let c=0;c<this.text.length&&ty[this.text.charCodeAt(c)];c++)t++;let n=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&ty[this.text.charCodeAt(c)];c--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const c=new Tp;return c.text=this.text.substring(t,n),c.sectionIndex=this.sectionIndex.slice(t,n),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(Km.forText(t.scale,t.fontStack||n));const c=this.sections.length-1;for(let d=0;d<t.text.length;++d)this.sectionIndex.push(c)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void Se("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Km.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Se("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function P0(s,t,n,c,d,_,v,E,k,L,N,V,W,Y,K){const st=Tp.fromFeature(s,d);V===ma.vertical&&st.verticalizePunctuation(W);let ut=[];const vt=function(Ot,he,oe,_e,Re,de){if(!Ot)return[];const we=[],Te=function(qe,ui,Qe,Fi,je,bi){let Ni=0;for(let _s=0;_s<qe.length();_s++){const ji=qe.getSection(_s);Ni+=r1(qe.getCharCode(_s),ji,Fi,je,ui,bi)}return Ni/Math.max(1,Math.ceil(Ni/Qe))}(Ot,he,oe,_e,Re,de),Pe=Ot.text.indexOf("")>=0;let Ne=0;for(let qe=0;qe<Ot.length();qe++){const ui=Ot.getSection(qe),Qe=Ot.getCharCode(qe);if(ty[Qe]||(Ne+=r1(Qe,ui,_e,Re,he,de)),qe<Ot.length()-1){const Fi=!((me=Qe)<11904||!(Ze["Bopomofo Extended"](me)||Ze.Bopomofo(me)||Ze["CJK Compatibility Forms"](me)||Ze["CJK Compatibility Ideographs"](me)||Ze["CJK Compatibility"](me)||Ze["CJK Radicals Supplement"](me)||Ze["CJK Strokes"](me)||Ze["CJK Symbols and Punctuation"](me)||Ze["CJK Unified Ideographs Extension A"](me)||Ze["CJK Unified Ideographs"](me)||Ze["Enclosed CJK Letters and Months"](me)||Ze["Halfwidth and Fullwidth Forms"](me)||Ze.Hiragana(me)||Ze["Ideographic Description Characters"](me)||Ze["Kangxi Radicals"](me)||Ze["Katakana Phonetic Extensions"](me)||Ze.Katakana(me)||Ze["Vertical Forms"](me)||Ze["Yi Radicals"](me)||Ze["Yi Syllables"](me)));(VA[Qe]||Fi||ui.imageName)&&we.push(a1(qe+1,Ne,Te,we,$A(Qe,Ot.getCharCode(qe+1),Fi&&Pe),!1))}}var me;return l1(a1(Ot.length(),Ne,Te,we,0,!0))}(st,L,_,t,c,Y),{processBidirectionalText:Pt,processStyledBidirectionalText:bt}=O;if(Pt&&st.sections.length===1){const Ot=Pt(st.toString(),vt);for(const he of Ot){const oe=new Tp;oe.text=he,oe.sections=st.sections;for(let _e=0;_e<he.length;_e++)oe.sectionIndex.push(0);ut.push(oe)}}else if(bt){const Ot=bt(st.text,st.sectionIndex,vt);for(const he of Ot){const oe=new Tp;oe.text=he[0],oe.sectionIndex=he[1],oe.sections=st.sections,ut.push(oe)}}else ut=function(Ot,he){const oe=[],_e=Ot.text;let Re=0;for(const de of he)oe.push(Ot.substring(Re,de)),Re=de;return Re<_e.length&&oe.push(Ot.substring(Re,_e.length)),oe}(st,vt);const Ct=[],Ft={positionedLines:Ct,text:st.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:V,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Ot,he,oe,_e,Re,de,we,Te,Pe,Ne,me,qe){let ui=0,Qe=0,Fi=0;const je=Te==="right"?1:Te==="left"?0:.5;let bi=!1;for(const $i of Re){const Gi=$i.getSections();for(const zs of Gi){if(zs.imageName)continue;const Gs=he[zs.fontStack];if(Gs&&(bi=Gs.ascender!==void 0&&Gs.descender!==void 0,!bi))break}if(!bi)break}let Ni=0;for(const $i of Re){$i.trim();const Gi=$i.getMaxScale(),zs=(Gi-1)*Ae,Gs={positionedGlyphs:[],lineOffset:0};Ot.positionedLines[Ni]=Gs;const Ws=Gs.positionedGlyphs;let Os=0;if(!$i.length()){Qe+=de,++Ni;continue}let un=0,Cn=0;for(let Rs=0;Rs<$i.length();Rs++){const Zn=$i.getSection(Rs),Fn=$i.getSectionIndex(Rs),vn=$i.getCharCode(Rs);let vs=Zn.scale,Nn=null,Hs=null,qr=null,jn=Ae,_r=0;const hr=!(Pe===ma.horizontal||!me&&!gd(vn)||me&&(ty[vn]||(_s=vn,Ze.Arabic(_s)||Ze["Arabic Supplement"](_s)||Ze["Arabic Extended-A"](_s)||Ze["Arabic Presentation Forms-A"](_s)||Ze["Arabic Presentation Forms-B"](_s))));if(Zn.imageName){const Zr=_e[Zn.imageName];if(!Zr)continue;qr=Zn.imageName,Ot.iconsInText=Ot.iconsInText||!0,Hs=Zr.paddedRect;const ur=Zr.displaySize;vs=vs*Ae/qe,Nn={width:ur[0],height:ur[1],left:go,top:-3,advance:hr?ur[1]:ur[0],localGlyph:!1},_r=bi?-Nn.height*vs:n1+Gi*Ae-ur[1]*vs,jn=Nn.advance;const _l=(hr?ur[0]:ur[1])*vs-Ae*Gi;_l>0&&_l>Os&&(Os=_l)}else{const Zr=oe[Zn.fontStack];if(!Zr)continue;Zr[vn]&&(Hs=Zr[vn]);const ur=he[Zn.fontStack];if(!ur)continue;const _l=ur.glyphs[vn];if(!_l)continue;if(Nn=_l.metrics,jn=vn!==8203?Ae:0,bi){const kp=ur.ascender!==void 0?Math.abs(ur.ascender):0,ag=ur.descender!==void 0?Math.abs(ur.descender):0,lg=(kp+ag)*vs;un<lg&&(un=lg,Cn=(kp-ag)/2*vs),_r=-kp*vs}else _r=n1+(Gi-vs)*Ae}hr?(Ot.verticalizable=!0,Ws.push({glyph:vn,imageName:qr,x:ui,y:Qe+_r,vertical:hr,scale:vs,localGlyph:Nn.localGlyph,fontStack:Zn.fontStack,sectionIndex:Fn,metrics:Nn,rect:Hs}),ui+=jn*vs+Ne):(Ws.push({glyph:vn,imageName:qr,x:ui,y:Qe+_r,vertical:hr,scale:vs,localGlyph:Nn.localGlyph,fontStack:Zn.fontStack,sectionIndex:Fn,metrics:Nn,rect:Hs}),ui+=Nn.advance*vs+Ne)}Ws.length!==0&&(Fi=Math.max(ui-Ne,Fi),bi?c1(Ws,je,Os,Cn,de*Gi/2):c1(Ws,je,Os,0,de/2)),ui=0;const Bn=de*Gi+Os;Gs.lineOffset=Math.max(Os,zs),Qe+=Bn,++Ni}var _s;const ji=Qe,{horizontalAlign:Mi,verticalAlign:Js}=I0(we);(function($i,Gi,zs,Gs,Ws,Os){const un=(Gi-zs)*Ws,Cn=-Os*Gs;for(const Bn of $i)for(const Rs of Bn.positionedGlyphs)Rs.x+=un,Rs.y+=Cn})(Ot.positionedLines,je,Mi,Js,Fi,ji),Ot.top+=-Js*ji,Ot.bottom=Ot.top+ji,Ot.left+=-Mi*Fi,Ot.right=Ot.left+Fi,Ot.hasBaseline=bi}(Ft,t,n,c,ut,v,E,k,V,L,W,K),!function(Ot){for(const he of Ot)if(he.positionedGlyphs.length!==0)return!1;return!0}(Ct)&&Ft}const ty={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},VA={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function r1(s,t,n,c,d,_){if(t.imageName){const v=c[t.imageName];return v?v.displaySize[0]*t.scale*Ae/_+d:0}{const v=n[t.fontStack],E=v&&v.glyphs[s];return E?E.metrics.advance*t.scale+d:0}}function o1(s,t,n,c){const d=Math.pow(s-t,2);return c?s<t?d/2:2*d:d+Math.abs(n)*n}function $A(s,t,n){let c=0;return s===10&&(c-=1e4),n&&(c+=150),s!==40&&s!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function a1(s,t,n,c,d,_){let v=null,E=o1(t,n,d,_);for(const k of c){const L=o1(t-k.x,n,d,_)+k.badness;L<=E&&(v=k,E=L)}return{index:s,x:t,priorBreak:v,badness:E}}function l1(s){return s?l1(s.priorBreak).concat(s.index):[]}function I0(s){let t=.5,n=.5;switch(s){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function c1(s,t,n,c,d){if(!(t||n||c||d))return;const _=s.length-1,v=s[_],E=(v.x+v.metrics.advance*v.scale)*t;for(let k=0;k<=_;k++)s[k].x-=E,s[k].y+=n+c+d}function GA(s,t,n){const{horizontalAlign:c,verticalAlign:d}=I0(n),_=t[0]-s.displaySize[0]*c,v=t[1]-s.displaySize[1]*d;return{image:s,top:v,bottom:v+s.displaySize[1],left:_,right:_+s.displaySize[0]}}function h1(s,t,n,c,d,_){const v=s.image;let E;if(v.content){const ut=v.content,vt=v.pixelRatio||1;E=[ut[0]/vt,ut[1]/vt,v.displaySize[0]-ut[2]/vt,v.displaySize[1]-ut[3]/vt]}const k=t.left*_,L=t.right*_;let N,V,W,Y;n==="width"||n==="both"?(Y=d[0]+k-c[3],V=d[0]+L+c[1]):(Y=d[0]+(k+L-v.displaySize[0])/2,V=Y+v.displaySize[0]);const K=t.top*_,st=t.bottom*_;return n==="height"||n==="both"?(N=d[1]+K-c[0],W=d[1]+st+c[2]):(N=d[1]+(K+st-v.displaySize[1])/2,W=N+v.displaySize[1]),{image:v,top:N,right:V,bottom:W,left:Y,collisionPadding:E}}class Jc extends Ut{constructor(t,n,c,d,_){super(t,n),this.angle=d,this.z=c,_!==void 0&&(this.segment=_)}clone(){return new Jc(this.x,this.y,this.z,this.angle,this.segment)}}function u1(s,t,n,c,d){if(t.segment===void 0)return!0;let _=t,v=t.segment+1,E=0;for(;E>-n/2;){if(v--,v<0)return!1;E-=s[v].dist(_),_=s[v]}E+=s[v].dist(s[v+1]),v++;const k=[];let L=0;for(;E<n/2;){const N=s[v],V=s[v+1];if(!V)return!1;let W=s[v-1].angleTo(N)-N.angleTo(V);for(W=Math.abs((W+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:E,angleDelta:W}),L+=W;E-k[0].distance>c;)L-=k.shift().angleDelta;if(L>d)return!1;v++,E+=N.dist(V)}return!0}function d1(s){let t=0;for(let n=0;n<s.length-1;n++)t+=s[n].dist(s[n+1]);return t}function f1(s,t,n){return s?.6*t*n:0}function p1(s,t){return Math.max(s?s.right-s.left:0,t?t.right-t.left:0)}function WA(s,t,n,c,d,_){const v=f1(n,d,_),E=p1(n,c)*_;let k=0;const L=d1(s)/2;for(let N=0;N<s.length-1;N++){const V=s[N],W=s[N+1],Y=V.dist(W);if(k+Y>L){const K=(L-k)/Y,st=rs(V.x,W.x,K),ut=rs(V.y,W.y,K),vt=new Jc(st,ut,0,W.angleTo(V),N);return!v||u1(s,vt,E,v,t)?vt:void 0}k+=Y}}function HA(s,t,n,c,d,_,v,E,k){const L=f1(c,_,v),N=p1(c,d),V=N*v,W=s[0].x===0||s[0].x===k||s[0].y===0||s[0].y===k;return t-V<t/4&&(t=V+t/4),m1(s,W?t/2*E%t:(N/2+2*_)*v*E%t,t,L,n,V,W,!1,k)}function m1(s,t,n,c,d,_,v,E,k){const L=_/2,N=d1(s);let V=0,W=t-n,Y=[];for(let K=0;K<s.length-1;K++){const st=s[K],ut=s[K+1],vt=st.dist(ut),Pt=ut.angleTo(st);for(;W+n<V+vt;){W+=n;const bt=(W-V)/vt,Ct=rs(st.x,ut.x,bt),Ft=rs(st.y,ut.y,bt);if(Ct>=0&&Ct<k&&Ft>=0&&Ft<k&&W-L>=0&&W+L<=N){const Ot=new Jc(Ct,Ft,0,Pt,K);Ot._round(),c&&!u1(s,Ot,_,c,d)||Y.push(Ot)}}V+=vt}return E||Y.length||v||(Y=m1(s,V/2,n,c,d,_,v,!0,k)),Y}function g1(s,t,n,c,d){const _=[];for(let v=0;v<s.length;v++){const E=s[v];let k;for(let L=0;L<E.length-1;L++){let N=E[L],V=E[L+1];N.x<t&&V.x<t||(N.x<t?N=new Ut(t,N.y+(t-N.x)/(V.x-N.x)*(V.y-N.y))._round():V.x<t&&(V=new Ut(t,N.y+(t-N.x)/(V.x-N.x)*(V.y-N.y))._round()),N.y<n&&V.y<n||(N.y<n?N=new Ut(N.x+(n-N.y)/(V.y-N.y)*(V.x-N.x),n)._round():V.y<n&&(V=new Ut(N.x+(n-N.y)/(V.y-N.y)*(V.x-N.x),n)._round()),N.x>=c&&V.x>=c||(N.x>=c?N=new Ut(c,N.y+(c-N.x)/(V.x-N.x)*(V.y-N.y))._round():V.x>=c&&(V=new Ut(c,N.y+(c-N.x)/(V.x-N.x)*(V.y-N.y))._round()),N.y>=d&&V.y>=d||(N.y>=d?N=new Ut(N.x+(d-N.y)/(V.y-N.y)*(V.x-N.x),d)._round():V.y>=d&&(V=new Ut(N.x+(d-N.y)/(V.y-N.y)*(V.x-N.x),d)._round()),k&&N.equals(k[k.length-1])||(k=[N],_.push(k)),k.push(V)))))}}return _}oi(Jc,"Anchor");const ey=1e20;function _1(s,t,n,c,d,_,v,E,k){for(let L=t;L<t+c;L++)y1(s,n*_+L,_,d,v,E,k);for(let L=n;L<n+d;L++)y1(s,L*_+t,1,c,v,E,k)}function y1(s,t,n,c,d,_,v){_[0]=0,v[0]=-1e20,v[1]=ey,d[0]=s[t];for(let E=1,k=0,L=0;E<c;E++){d[E]=s[t+E*n];const N=E*E;do{const V=_[k];L=(d[E]-d[V]+N-V*V)/(E-V)/2}while(L<=v[k]&&--k>-1);k++,_[k]=E,v[k]=L,v[k+1]=ey}for(let E=0,k=0;E<c;E++){for(;v[k+1]<E;)k++;const L=_[k],N=E-L;s[t+E*n]=d[L]+N*N}}const ml=2,L0={none:0,ideographs:1,all:2};class Sp{constructor(t,n,c){this.requestManager=t,this.localGlyphMode=n,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,n){const c=[];for(const d in t)for(const _ of t[d])c.push({stack:d,id:_});Yi(c,({stack:d,id:_},v)=>{let E=this.entries[d];E||(E=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let k=E.glyphs[_];if(k!==void 0)return void v(null,{stack:d,id:_,glyph:k});if(k=this._tinySDF(E,d,_),k)return E.glyphs[_]=k,void v(null,{stack:d,id:_,glyph:k});const L=Math.floor(_/256);if(256*L>65535)return void v(new Error("glyphs > 65535 not supported"));if(E.ranges[L])return void v(null,{stack:d,id:_,glyph:k});let N=E.requests[L];N||(N=E.requests[L]=[],Sp.loadGlyphRange(d,L,this.url,this.requestManager,(V,W)=>{if(W){E.ascender=W.ascender,E.descender=W.descender;for(const Y in W.glyphs)this._doesCharSupportLocalGlyph(+Y)||(E.glyphs[+Y]=W.glyphs[+Y]);E.ranges[L]=!0}for(const Y of N)Y(V,W);delete E.requests[L]})),N.push((V,W)=>{V?v(V):W&&v(null,{stack:d,id:_,glyph:W.glyphs[_]||null})})},(d,_)=>{if(d)n(d);else if(_){const v={};for(const{stack:E,id:k,glyph:L}of _)v[E]===void 0&&(v[E]={}),v[E].glyphs===void 0&&(v[E].glyphs={}),v[E].glyphs[k]=L&&{id:L.id,bitmap:L.bitmap.clone(),metrics:L.metrics},v[E].ascender=this.entries[E].ascender,v[E].descender=this.entries[E].descender;n(null,v)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==L0.none&&(this.localGlyphMode===L0.all?!!this.localFontFamily:!!this.localFontFamily&&(Ze["CJK Unified Ideographs"](t)||Ze["Hangul Syllables"](t)||Ze.Hiragana(t)||Ze.Katakana(t)||Ze["CJK Symbols and Punctuation"](t)))}_tinySDF(t,n,c){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(c))return;let _=t.tinySDF;if(!_){let st="400";/bold/i.test(n)?st="900":/medium/i.test(n)?st="500":/light/i.test(n)&&(st="200"),_=t.tinySDF=new Sp.TinySDF({fontFamily:d,fontWeight:st,fontSize:24*ml,buffer:3*ml,radius:8*ml}),_.fontWeight=st}if(this.localGlyphs[_.fontWeight][c])return this.localGlyphs[_.fontWeight][c];const v=String.fromCharCode(c),{data:E,width:k,height:L,glyphWidth:N,glyphHeight:V,glyphLeft:W,glyphTop:Y,glyphAdvance:K}=_.draw(v);return this.localGlyphs[_.fontWeight][c]={id:c,bitmap:new pl({width:k,height:L},E),metrics:{width:N/ml,height:V/ml,left:W/ml,top:Y/ml-27,advance:K/ml,localGlyph:!0}}}}Sp.loadGlyphRange=function(s,t,n,c,d){const _=256*t,v=_+255,E=c.transformRequest(c.normalizeGlyphsURL(n).replace("{fontstack}",s).replace("{range}",`${_}-${v}`),fr.Glyphs);Yn(E,(k,L)=>{if(k)d(k);else if(L){const N={},V=function(W){return new Q_(W).readFields(FA,{})}(L);for(const W of V.glyphs)N[W.id]=W;d(null,{glyphs:N,ascender:V.ascender,descender:V.descender})}})},Sp.TinySDF=class{constructor({fontSize:s=24,buffer:t=3,radius:n=8,cutoff:c=.25,fontFamily:d="sans-serif",fontWeight:_="normal",fontStyle:v="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=n;const E=this.size=s+4*t,k=this._createCanvas(E),L=this.ctx=k.getContext("2d",{willReadFrequently:!0});L.font=`${v} ${_} ${s}px ${d}`,L.textBaseline="alphabetic",L.textAlign="left",L.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(s){const t=document.createElement("canvas");return t.width=t.height=s,t}draw(s){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:c,actualBoundingBoxLeft:d,actualBoundingBoxRight:_}=this.ctx.measureText(s),v=Math.ceil(n),E=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-d))),k=Math.min(this.size-this.buffer,v+Math.ceil(c)),L=E+2*this.buffer,N=k+2*this.buffer,V=Math.max(L*N,0),W=new Uint8ClampedArray(V),Y={data:W,width:L,height:N,glyphWidth:E,glyphHeight:k,glyphTop:v,glyphLeft:0,glyphAdvance:t};if(E===0||k===0)return Y;const{ctx:K,buffer:st,gridInner:ut,gridOuter:vt}=this;K.clearRect(st,st,E,k),K.fillText(s,st,st+v);const Pt=K.getImageData(st,st,E,k);vt.fill(ey,0,V),ut.fill(0,0,V);for(let bt=0;bt<k;bt++)for(let Ct=0;Ct<E;Ct++){const Ft=Pt.data[4*(bt*E+Ct)+3]/255;if(Ft===0)continue;const Ot=(bt+st)*L+Ct+st;if(Ft===1)vt[Ot]=0,ut[Ot]=ey;else{const he=.5-Ft;vt[Ot]=he>0?he*he:0,ut[Ot]=he<0?he*he:0}}_1(vt,0,0,L,N,L,this.f,this.v,this.z),_1(ut,st,st,E,k,L,this.f,this.v,this.z);for(let bt=0;bt<V;bt++){const Ct=Math.sqrt(vt[bt])-Math.sqrt(ut[bt]);W[bt]=Math.round(255-255*(Ct/this.radius+this.cutoff))}return Y}};const Jm=go;function x1(s,t,n,c){const d=[],_=s.image,v=_.pixelRatio,E=_.paddedRect.w-2*Jm,k=_.paddedRect.h-2*Jm,L=s.right-s.left,N=s.bottom-s.top,V=_.stretchX||[[0,E]],W=_.stretchY||[[0,k]],Y=(de,we)=>de+we[1]-we[0],K=V.reduce(Y,0),st=W.reduce(Y,0),ut=E-K,vt=k-st;let Pt=0,bt=K,Ct=0,Ft=st,Ot=0,he=ut,oe=0,_e=vt;if(_.content&&c){const de=_.content;Pt=iy(V,0,de[0]),Ct=iy(W,0,de[1]),bt=iy(V,de[0],de[2]),Ft=iy(W,de[1],de[3]),Ot=de[0]-Pt,oe=de[1]-Ct,he=de[2]-de[0]-bt,_e=de[3]-de[1]-Ft}const Re=(de,we,Te,Pe)=>{const Ne=sy(de.stretch-Pt,bt,L,s.left),me=ny(de.fixed-Ot,he,de.stretch,K),qe=sy(we.stretch-Ct,Ft,N,s.top),ui=ny(we.fixed-oe,_e,we.stretch,st),Qe=sy(Te.stretch-Pt,bt,L,s.left),Fi=ny(Te.fixed-Ot,he,Te.stretch,K),je=sy(Pe.stretch-Ct,Ft,N,s.top),bi=ny(Pe.fixed-oe,_e,Pe.stretch,st),Ni=new Ut(Ne,qe),_s=new Ut(Qe,qe),ji=new Ut(Qe,je),Mi=new Ut(Ne,je),Js=new Ut(me/v,ui/v),$i=new Ut(Fi/v,bi/v),Gi=t*Math.PI/180;if(Gi){const Ws=Math.sin(Gi),Os=Math.cos(Gi),un=[Os,-Ws,Ws,Os];Ni._matMult(un),_s._matMult(un),Mi._matMult(un),ji._matMult(un)}const zs=de.stretch+de.fixed,Gs=we.stretch+we.fixed;return{tl:Ni,tr:_s,bl:Mi,br:ji,tex:{x:_.paddedRect.x+Jm+zs,y:_.paddedRect.y+Jm+Gs,w:Te.stretch+Te.fixed-zs,h:Pe.stretch+Pe.fixed-Gs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Js,pixelOffsetBR:$i,minFontScaleX:he/v/L,minFontScaleY:_e/v/N,isSDF:n}};if(c&&(_.stretchX||_.stretchY)){const de=v1(V,ut,K),we=v1(W,vt,st);for(let Te=0;Te<de.length-1;Te++){const Pe=de[Te],Ne=de[Te+1];for(let me=0;me<we.length-1;me++)d.push(Re(Pe,we[me],Ne,we[me+1]))}}else d.push(Re({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:k+1}));return d}function iy(s,t,n){let c=0;for(const d of s)c+=Math.max(t,Math.min(n,d[1]))-Math.max(t,Math.min(n,d[0]));return c}function v1(s,t,n){const c=[{fixed:-1,stretch:0}];for(const[d,_]of s){const v=c[c.length-1];c.push({fixed:d-v.stretch,stretch:v.stretch}),c.push({fixed:d-v.stretch,stretch:v.stretch+(_-d)})}return c.push({fixed:t+Jm,stretch:n}),c}function sy(s,t,n,c){return s/t*n+c}function ny(s,t,n,c){return s-t*n/c}function XA(s,t,n,c){const d=t+s.positionedLines[c].lineOffset;return c===0?n+d/2:n+(d+(t+s.positionedLines[c-1].lineOffset))/2}class qA{constructor(t=[],n=ZA){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:c}=this,d=n[t];for(;t>0;){const _=t-1>>1,v=n[_];if(c(d,v)>=0)break;n[t]=v,t=_}n[t]=d}_down(t){const{data:n,compare:c}=this,d=this.length>>1,_=n[t];for(;t<d;){let v=1+(t<<1),E=n[v];const k=v+1;if(k<this.length&&c(n[k],E)<0&&(v=k,E=n[k]),c(E,_)>=0)break;n[t]=E,t=v}n[t]=_}}function ZA(s,t){return s<t?-1:s>t?1:0}function YA(s,t=1,n=!1){let c=1/0,d=1/0,_=-1/0,v=-1/0;const E=s[0];for(let Y=0;Y<E.length;Y++){const K=E[Y];(!Y||K.x<c)&&(c=K.x),(!Y||K.y<d)&&(d=K.y),(!Y||K.x>_)&&(_=K.x),(!Y||K.y>v)&&(v=K.y)}const k=Math.min(_-c,v-d);let L=k/2;const N=new qA([],KA);if(k===0)return new Ut(c,d);for(let Y=c;Y<_;Y+=k)for(let K=d;K<v;K+=k)N.push(new Ep(Y+L,K+L,L,s));let V=function(Y){let K=0,st=0,ut=0;const vt=Y[0];for(let Pt=0,bt=vt.length,Ct=bt-1;Pt<bt;Ct=Pt++){const Ft=vt[Pt],Ot=vt[Ct],he=Ft.x*Ot.y-Ot.x*Ft.y;st+=(Ft.x+Ot.x)*he,ut+=(Ft.y+Ot.y)*he,K+=3*he}return new Ep(st/K,ut/K,0,Y)}(s),W=N.length;for(;N.length;){const Y=N.pop();(Y.d>V.d||!V.d)&&(V=Y,n&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,W)),Y.max-V.d<=t||(L=Y.h/2,N.push(new Ep(Y.p.x-L,Y.p.y-L,L,s)),N.push(new Ep(Y.p.x+L,Y.p.y-L,L,s)),N.push(new Ep(Y.p.x-L,Y.p.y+L,L,s)),N.push(new Ep(Y.p.x+L,Y.p.y+L,L,s)),W+=4)}return n&&(console.log(`num probes: ${W}`),console.log(`best distance: ${V.d}`)),V.p}function KA(s,t){return t.max-s.max}class Ep{constructor(t,n,c,d){this.p=new Ut(t,n),this.h=c,this.d=function(_,v){let E=!1,k=1/0;for(let L=0;L<v.length;L++){const N=v[L];for(let V=0,W=N.length,Y=W-1;V<W;Y=V++){const K=N[V],st=N[Y];K.y>_.y!=st.y>_.y&&_.x<(st.x-K.x)*(_.y-K.y)/(st.y-K.y)+K.x&&(E=!E),k=Math.min(k,iu(_,K,st))}}return(E?1:-1)*Math.sqrt(k)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const Mp=7,D0=Number.POSITIVE_INFINITY,JA=Math.sqrt(2);function b1(s,[t,n]){let c=0,d=0;if(n===D0){t<0&&(t=0);const _=t/JA;switch(s){case"top-right":case"top-left":d=_-Mp;break;case"bottom-right":case"bottom-left":d=-_+Mp;break;case"bottom":d=-t+Mp;break;case"top":d=t-Mp}switch(s){case"top-right":case"bottom-right":c=-_;break;case"top-left":case"bottom-left":c=_;break;case"left":c=t;break;case"right":c=-t}}else{switch(t=Math.abs(t),n=Math.abs(n),s){case"top-right":case"top-left":case"top":d=n-Mp;break;case"bottom-right":case"bottom-left":case"bottom":d=-n+Mp}switch(s){case"top-right":case"bottom-right":case"right":c=-t;break;case"top-left":case"bottom-left":case"left":c=t}}return[c,d]}function QA(s,t,n,c,d,_,v,E,k,L){s.createArrays(),s.tilePixelRatio=gi/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const N=s.layers[0].layout,V=s.layers[0]._unevaluatedLayout._values,W={};if(s.textSizeData.kind==="composite"){const{minZoom:st,maxZoom:ut}=s.textSizeData;W.compositeTextSizes=[V["text-size"].possiblyEvaluate(new j(st),E),V["text-size"].possiblyEvaluate(new j(ut),E)]}if(s.iconSizeData.kind==="composite"){const{minZoom:st,maxZoom:ut}=s.iconSizeData;W.compositeIconSizes=[V["icon-size"].possiblyEvaluate(new j(st),E),V["icon-size"].possiblyEvaluate(new j(ut),E)]}W.layoutTextSize=V["text-size"].possiblyEvaluate(new j(k+1),E),W.layoutIconSize=V["icon-size"].possiblyEvaluate(new j(k+1),E),W.textMaxSize=V["text-size"].possiblyEvaluate(new j(18),E);const Y=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",K=N.get("text-size");for(const st of s.features){const ut=N.get("text-font").evaluate(st,{},E).join(","),vt=K.evaluate(st,{},E),Pt=W.layoutTextSize.evaluate(st,{},E),bt=(W.layoutIconSize.evaluate(st,{},E),{horizontal:{},vertical:void 0}),Ct=st.text;let Ft,Ot=[0,0];if(Ct){const _e=Ct.toString(),Re=N.get("text-letter-spacing").evaluate(st,{},E)*Ae,de=N.get("text-line-height").evaluate(st,{},E)*Ae,we=vm(_e)?Re:0,Te=N.get("text-anchor").evaluate(st,{},E),Pe=N.get("text-variable-anchor");if(!Pe){const Qe=N.get("text-radial-offset").evaluate(st,{},E);Ot=Qe?b1(Te,[Qe*Ae,D0]):N.get("text-offset").evaluate(st,{},E).map(Fi=>Fi*Ae)}let Ne=Y?"center":N.get("text-justify").evaluate(st,{},E);const me=N.get("symbol-placement")==="point",qe=me?N.get("text-max-width").evaluate(st,{},E)*Ae:1/0,ui=Qe=>{s.allowVerticalPlacement&&md(_e)&&(bt.vertical=P0(Ct,t,n,d,ut,qe,de,Te,Qe,we,Ot,ma.vertical,!0,Pt,vt))};if(!Y&&Pe){const Qe=Ne==="auto"?Pe.map(je=>z0(je)):[Ne];let Fi=!1;for(let je=0;je<Qe.length;je++){const bi=Qe[je];if(!bt.horizontal[bi])if(Fi)bt.horizontal[bi]=bt.horizontal[0];else{const Ni=P0(Ct,t,n,d,ut,qe,de,"center",bi,we,Ot,ma.horizontal,!1,Pt,vt);Ni&&(bt.horizontal[bi]=Ni,Fi=Ni.positionedLines.length===1)}}ui("left")}else{if(Ne==="auto"&&(Ne=z0(Te)),me||N.get("text-writing-mode").indexOf("horizontal")>=0||!md(_e)){const Qe=P0(Ct,t,n,d,ut,qe,de,Te,Ne,we,Ot,ma.horizontal,!1,Pt,vt);Qe&&(bt.horizontal[Ne]=Qe)}ui(me?"left":Ne)}}let he=!1;if(st.icon&&st.icon.name){const _e=c[st.icon.name];_e&&(Ft=GA(d[st.icon.name],N.get("icon-offset").evaluate(st,{},E),N.get("icon-anchor").evaluate(st,{},E)),he=_e.sdf,s.sdfIcons===void 0?s.sdfIcons=_e.sdf:s.sdfIcons!==_e.sdf&&Se("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_e.pixelRatio!==s.pixelRatio||N.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}const oe=T1(bt.horizontal)||bt.vertical;s.iconsInText||(s.iconsInText=!!oe&&oe.iconsInText),(oe||Ft)&&tC(s,st,bt,Ft,c,W,Pt,0,Ot,he,v,E,L)}_&&s.generateCollisionDebugBuffers(k,s.collisionBoxArray)}function z0(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tC(s,t,n,c,d,_,v,E,k,L,N,V,W){let Y=_.textMaxSize.evaluate(t,{},V);Y===void 0&&(Y=v);const K=s.layers[0].layout,st=K.get("icon-offset").evaluate(t,{},V),ut=T1(n.horizontal)||n.vertical,vt=W.name==="globe",Pt=Ae,bt=v/Pt,Ct=s.tilePixelRatio*Y/Pt,Ft=(Te=s.overscaling,s.zoom>18&&Te>2&&(Te>>=1),Math.max(gi/(512*Te),1)*K.get("symbol-spacing")),Ot=K.get("text-padding")*s.tilePixelRatio,he=K.get("icon-padding")*s.tilePixelRatio,oe=Ce(K.get("text-max-angle")),_e=K.get("text-rotation-alignment")==="map"&&K.get("symbol-placement")!=="point",Re=K.get("icon-rotation-alignment")==="map"&&K.get("symbol-placement")!=="point",de=K.get("symbol-placement"),we=Ft/2;var Te;const Pe=K.get("icon-text-fit");let Ne;c&&Pe!=="none"&&(s.allowVerticalPlacement&&n.vertical&&(Ne=h1(c,n.vertical,Pe,K.get("icon-text-fit-padding"),st,bt)),ut&&(c=h1(c,ut,Pe,K.get("icon-text-fit-padding"),st,bt)));const me=(qe,ui,Qe)=>{if(ui.x<0||ui.x>=gi||ui.y<0||ui.y>=gi)return;let Fi=null;if(vt){const{x:je,y:bi,z:Ni}=W.projectTilePoint(ui.x,ui.y,Qe);Fi={anchor:new Jc(je,bi,Ni,0,void 0),up:W.upVector(Qe,ui.x,ui.y)}}(function(je,bi,Ni,_s,ji,Mi,Js,$i,Gi,zs,Gs,Ws,Os,un,Cn,Bn,Rs,Zn,Fn,vn,vs,Nn,Hs,qr,jn){const _r=je.addToLineVertexArray(bi,_s);let hr,Zr,ur,_l,kp,ag,lg,iw=0,sw=0,nw=0,rw=0,Z0=-1,Y0=-1;const lc={};let ow=Tm("");const sf=Ni?Ni.anchor:bi;let K0=0,J0=0;if(Gi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[K0,J0]=Gi.layout.get("text-offset").evaluate(vs,{},jn).map(No=>No*Ae):(K0=Gi.layout.get("text-radial-offset").evaluate(vs,{},jn)*Ae,J0=D0),je.allowVerticalPlacement&&ji.vertical){const No=ji.vertical;if(Cn)ag=O0(No),$i&&(lg=O0($i));else{const jo=Gi.layout.get("text-rotate").evaluate(vs,{},jn)+90;ur=ry(zs,sf,bi,Gs,Ws,Os,No,un,jo,Bn),$i&&(_l=ry(zs,sf,bi,Gs,Ws,Os,$i,Zn,jo))}}if(Mi){const No=Gi.layout.get("icon-rotate").evaluate(vs,{},jn),jo=Gi.layout.get("icon-text-fit")!=="none",cg=x1(Mi,No,Hs,jo),tv=$i?x1($i,No,Hs,jo):void 0;Zr=ry(zs,sf,bi,Gs,Ws,Os,Mi,Zn,No),iw=4*cg.length;const aw=je.iconSizeData;let nf=null;aw.kind==="source"?(nf=[Je*Gi.layout.get("icon-size").evaluate(vs,{},jn)],nf[0]>cu&&Se(`${je.layerIds[0]}: Value for "icon-size" is >= ${Qm}. Reduce your "icon-size".`)):aw.kind==="composite"&&(nf=[Je*Nn.compositeIconSizes[0].evaluate(vs,{},jn),Je*Nn.compositeIconSizes[1].evaluate(vs,{},jn)],(nf[0]>cu||nf[1]>cu)&&Se(`${je.layerIds[0]}: Value for "icon-size" is >= ${Qm}. Reduce your "icon-size".`)),je.addSymbols(je.icon,cg,nf,vn,Fn,vs,!1,Ni,bi,_r.lineStartIndex,_r.lineLength,-1,qr,jn),Z0=je.icon.placedSymbolArray.length-1,tv&&(sw=4*tv.length,je.addSymbols(je.icon,tv,nf,vn,Fn,vs,ma.vertical,Ni,bi,_r.lineStartIndex,_r.lineLength,-1,qr,jn),Y0=je.icon.placedSymbolArray.length-1)}for(const No in ji.horizontal){const jo=ji.horizontal[No];hr||(ow=Tm(jo.text),Cn?kp=O0(jo):hr=ry(zs,sf,bi,Gs,Ws,Os,jo,un,Gi.layout.get("text-rotate").evaluate(vs,{},jn),Bn));const cg=jo.positionedLines.length===1;if(nw+=w1(je,Ni,bi,jo,Js,Gi,Cn,vs,Bn,_r,ji.vertical?ma.horizontal:ma.horizontalOnly,cg?Object.keys(ji.horizontal):[No],lc,Z0,Nn,qr,jn),cg)break}ji.vertical&&(rw+=w1(je,Ni,bi,ji.vertical,Js,Gi,Cn,vs,Bn,_r,ma.vertical,["vertical"],lc,Y0,Nn,qr,jn));let mu=-1;const Q0=(No,jo)=>No?Math.max(No,jo):jo;mu=Q0(kp,mu),mu=Q0(ag,mu),mu=Q0(lg,mu);const CC=mu>-1?1:0;je.glyphOffsetArray.length>=uu.MAX_GLYPHS&&Se("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vs.sortKey!==void 0&&je.addToSortKeyRanges(je.symbolInstances.length,vs.sortKey),je.symbolInstances.emplaceBack(sf.x,sf.y,sf.z,bi.x,bi.y,lc.right>=0?lc.right:-1,lc.center>=0?lc.center:-1,lc.left>=0?lc.left:-1,lc.vertical>=0?lc.vertical:-1,Z0,Y0,ow,hr!==void 0?hr:je.collisionBoxArray.length,hr!==void 0?hr+1:je.collisionBoxArray.length,ur!==void 0?ur:je.collisionBoxArray.length,ur!==void 0?ur+1:je.collisionBoxArray.length,Zr!==void 0?Zr:je.collisionBoxArray.length,Zr!==void 0?Zr+1:je.collisionBoxArray.length,_l||je.collisionBoxArray.length,_l?_l+1:je.collisionBoxArray.length,Gs,nw,rw,iw,sw,CC,0,K0,J0,mu)})(s,ui,Fi,qe,n,c,d,Ne,s.layers[0],s.collisionBoxArray,t.index,t.sourceLayerIndex,s.index,Ot,_e,k,0,he,Re,st,t,_,L,N,V)};if(de==="line")for(const qe of g1(t.geometry,0,0,gi,gi)){const ui=HA(qe,Ft,oe,n.vertical||ut,c,Pt,Ct,s.overscaling,gi);for(const Qe of ui)ut&&eC(s,ut.text,we,Qe)||me(qe,Qe,V)}else if(de==="line-center"){for(const qe of t.geometry)if(qe.length>1){const ui=WA(qe,oe,n.vertical||ut,c,Pt,Ct);ui&&me(qe,ui,V)}}else if(t.type==="Polygon")for(const qe of vp(t.geometry,0)){const ui=YA(qe,16);me(qe[0],new Jc(ui.x,ui.y,0,0,void 0),V)}else if(t.type==="LineString")for(const qe of t.geometry)me(qe,new Jc(qe[0].x,qe[0].y,0,0,void 0),V);else if(t.type==="Point")for(const qe of t.geometry)for(const ui of qe)me([ui],new Jc(ui.x,ui.y,0,0,void 0),V)}const Qm=255,cu=Qm*Je;function w1(s,t,n,c,d,_,v,E,k,L,N,V,W,Y,K,st,ut){const vt=function(Ct,Ft,Ot,he,oe,_e,Re,de){const we=[];if(Ft.positionedLines.length===0)return we;const Te=he.layout.get("text-rotate").evaluate(_e,{})*Math.PI/180,Pe=function(Qe){const Fi=Qe[0],je=Qe[1],bi=Fi*je;return bi>0?[Fi,-je]:bi<0?[-Fi,je]:Fi===0?[je,Fi]:[je,-Fi]}(Ot);let Ne=Math.abs(Ft.top-Ft.bottom);for(const Qe of Ft.positionedLines)Ne-=Qe.lineOffset;const me=Ft.positionedLines.length,qe=Ne/me;let ui=Ft.top-Ot[1];for(let Qe=0;Qe<me;++Qe){const Fi=Ft.positionedLines[Qe];ui=XA(Ft,qe,ui,Qe);for(const je of Fi.positionedGlyphs){if(!je.rect)continue;const bi=je.rect||{};let Ni=UA+1,_s=!0,ji=1,Mi=0;if(je.imageName){const Hs=Re[je.imageName];if(!Hs)continue;if(Hs.sdf){Se("SDF images are not supported in formatted text and will be ignored.");continue}_s=!1,ji=Hs.pixelRatio,Ni=go/ji}const Js=(oe||de)&&je.vertical,$i=je.metrics.advance*je.scale/2,Gi=je.metrics,zs=je.rect;if(zs===null)continue;de&&Ft.verticalizable&&(Mi=je.imageName?$i-je.metrics.width*je.scale/2:0);const Gs=oe?[je.x+$i,je.y]:[0,0];let Ws=[0,0],Os=[0,0],un=!1;oe||(Js?(Os=[je.x+$i+Pe[0],je.y+Pe[1]-Mi],un=!0):Ws=[je.x+$i+Ot[0],je.y+Ot[1]-Mi]);const Cn=zs.w*je.scale/(ji*(je.localGlyph?ml:1)),Bn=zs.h*je.scale/(ji*(je.localGlyph?ml:1));let Rs,Zn,Fn,vn;if(Js){const Hs=je.y-ui,qr=new Ut(-$i,$i-Hs),jn=-Math.PI/2,_r=new Ut(...Os);Rs=new Ut(-$i+Ws[0],Ws[1]),Rs._rotateAround(jn,qr)._add(_r),Rs.x+=-Hs+$i,Rs.y-=(Gi.left-Ni)*je.scale;const hr=je.imageName?Gi.advance*je.scale:Ae*je.scale,Zr=String.fromCharCode(je.glyph);ds(Zr)?Rs.x+=(1-Ni)*je.scale:gr(Zr)?Rs.x+=hr-Gi.height*je.scale+(-Ni-1)*je.scale:Rs.x+=je.imageName||Gi.width+2*Ni===zs.w&&Gi.height+2*Ni===zs.h?(hr-Bn)/2:(hr-(Gi.height+2*Ni)*je.scale)/2,Zn=new Ut(Rs.x,Rs.y-Cn),Fn=new Ut(Rs.x+Bn,Rs.y),vn=new Ut(Rs.x+Bn,Rs.y-Cn)}else{const Hs=(Gi.left-Ni)*je.scale-$i+Ws[0],qr=(-Gi.top-Ni)*je.scale+Ws[1],jn=Hs+Cn,_r=qr+Bn;Rs=new Ut(Hs,qr),Zn=new Ut(jn,qr),Fn=new Ut(Hs,_r),vn=new Ut(jn,_r)}if(Te){let Hs;Hs=oe?new Ut(0,0):un?new Ut(Pe[0],Pe[1]):new Ut(Ot[0],Ot[1]),Rs._rotateAround(Te,Hs),Zn._rotateAround(Te,Hs),Fn._rotateAround(Te,Hs),vn._rotateAround(Te,Hs)}const vs=new Ut(0,0),Nn=new Ut(0,0);we.push({tl:Rs,tr:Zn,bl:Fn,br:vn,tex:bi,writingMode:Ft.writingMode,glyphOffset:Gs,sectionIndex:je.sectionIndex,isSDF:_s,pixelOffsetTL:vs,pixelOffsetBR:Nn,minFontScaleX:0,minFontScaleY:0})}}return we}(0,c,k,_,v,E,d,s.allowVerticalPlacement),Pt=s.textSizeData;let bt=null;Pt.kind==="source"?(bt=[Je*_.layout.get("text-size").evaluate(E,{},ut)],bt[0]>cu&&Se(`${s.layerIds[0]}: Value for "text-size" is >= ${Qm}. Reduce your "text-size".`)):Pt.kind==="composite"&&(bt=[Je*K.compositeTextSizes[0].evaluate(E,{},ut),Je*K.compositeTextSizes[1].evaluate(E,{},ut)],(bt[0]>cu||bt[1]>cu)&&Se(`${s.layerIds[0]}: Value for "text-size" is >= ${Qm}. Reduce your "text-size".`)),s.addSymbols(s.text,vt,bt,k,v,E,N,t,n,L.lineStartIndex,L.lineLength,Y,st,ut);for(const Ct of V)W[Ct]=s.text.placedSymbolArray.length-1;return 4*vt.length}function T1(s){for(const t in s)return s[t];return null}function ry(s,t,n,c,d,_,v,E,k,L){let N=v.top,V=v.bottom,W=v.left,Y=v.right;const K=v.collisionPadding;if(K&&(W-=K[0],N-=K[1],Y+=K[2],V+=K[3]),k){const st=new Ut(W,N),ut=new Ut(Y,N),vt=new Ut(W,V),Pt=new Ut(Y,V),bt=Ce(k);let Ct=new Ut(0,0);L&&(Ct=new Ut(L[0],L[1])),st._rotateAround(bt,Ct),ut._rotateAround(bt,Ct),vt._rotateAround(bt,Ct),Pt._rotateAround(bt,Ct),W=Math.min(st.x,ut.x,vt.x,Pt.x),Y=Math.max(st.x,ut.x,vt.x,Pt.x),N=Math.min(st.y,ut.y,vt.y,Pt.y),V=Math.max(st.y,ut.y,vt.y,Pt.y)}return s.emplaceBack(t.x,t.y,t.z,n.x,n.y,W,N,Y,V,E,c,d,_),s.length-1}function O0(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const t=s.bottom-s.top;return t>0?Math.max(10,t):null}function eC(s,t,n,c){const d=s.compareText;if(t in d){const _=d[t];for(let v=_.length-1;v>=0;v--)if(c.dist(_[v])<n)return!0}else d[t]=[];return d[t].push(c),!1}function S1(s,t){const n=s.fovAboveCenter,c=s.elevation?s.elevation.getMinElevationBelowMSL()*t:0,d=(s._camera.position[2]*s.worldSize-c)/Math.cos(s._pitch),_=Math.sin(n)*d/Math.sin(Math.max(Math.PI/2-s._pitch-n,.01)),v=Math.sin(s._pitch)*_+d;return Math.min(1.01*v,d*(1/s._horizonShift))}function tf(s,t){if(!t.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:t};const n=Math.pow(2,-s.z),c=s.x*n,d=(s.x+1)*n,_=s.y*n,v=(s.y+1)*n,E=fo(c),k=fo(d),L=cr(_),N=cr(v),V=t.project(E,L),W=t.project(k,L),Y=t.project(k,N),K=t.project(E,N);let st=Math.min(V.x,W.x,Y.x,K.x),ut=Math.min(V.y,W.y,Y.y,K.y),vt=Math.max(V.x,W.x,Y.x,K.x),Pt=Math.max(V.y,W.y,Y.y,K.y);const bt=n/16;function Ct(Ot,he,oe,_e,Re,de){const we=(oe+Re)/2,Te=(_e+de)/2,Pe=t.project(fo(we),cr(Te)),Ne=Math.max(0,st-Pe.x,ut-Pe.y,Pe.x-vt,Pe.y-Pt);st=Math.min(st,Pe.x),vt=Math.max(vt,Pe.x),ut=Math.min(ut,Pe.y),Pt=Math.max(Pt,Pe.y),Ne>bt&&(Ct(Ot,Pe,oe,_e,we,Te),Ct(Pe,he,we,Te,Re,de))}Ct(V,W,c,_,d,_),Ct(W,Y,d,_,d,v),Ct(Y,K,d,v,c,v),Ct(K,V,c,v,c,_),st-=bt,ut-=bt,vt+=bt,Pt+=bt;const Ft=1/Math.max(vt-st,Pt-ut);return{scale:Ft,x:st*Ft,y:ut*Ft,x2:vt*Ft,y2:Pt*Ft,projection:t}}const iC=co(new Float32Array(16));class hu{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,n){return{x:0,y:0,z:0}}unproject(t,n){return new Es(0,0)}projectTilePoint(t,n,c){return{x:t,y:n,z:0}}locationPoint(t,n,c=!0){return t._coordinatePoint(t.locationCoordinate(n),c)}pixelsPerMeter(t,n){return da(1,t)*n}pixelSpaceConversion(t,n,c){return 1}farthestPixelDistance(t){return S1(t,t.pixelsPerMeter)}pointCoordinate(t,n,c,d){const _=t.horizonLineFromTop(!1),v=new Ut(n,Math.max(_,c));return t.rayIntersectionCoordinate(t.pointRayIntersection(v,d))}pointCoordinate3D(t,n,c){const d=new Ut(n,c);if(t.elevation)return t.elevation.pointCoordinate(d);{const _=this.pointCoordinate(t,d.x,d.y,0);return[_.x,_.y,_.z]}}isPointAboveHorizon(t,n){if(t.elevation)return!this.pointCoordinate3D(t,n.x,n.y);const c=t.horizonLineFromTop();return n.y<c}createInversionMatrix(t,n){return iC}createTileMatrix(t,n,c){let d,_,v;const E=c.canonical,k=co(new Float64Array(16));if(this.isReprojectedInTileSpace){const L=tf(E,this);d=1,_=L.x+c.wrap*L.scale,v=L.y,fl(k,k,[d/L.scale,d/L.scale,t.pixelsPerMeter/n])}else d=n/t.zoomScale(E.z),_=(E.x+Math.pow(2,E.z)*c.wrap)*d,v=E.y*d;return wd(k,k,[_,v,0]),fl(k,k,[d/gi,d/gi,1]),k}upVector(t,n,c){return[0,0,1]}upVectorScale(t,n,c){return{metersToTile:1}}}class sC extends hu{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[n,c]=this.parallels=t.parallels||[29.5,45.5],d=Math.sin(Ce(n));this.n=(d+Math.sin(Ce(c)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(t,n){const{n:c,c:d,r0:_}=this,v=Ce(t-this.center[0]),E=Ce(n),k=Math.sqrt(d-2*c*Math.sin(E))/c;return{x:k*Math.sin(v*c),y:k*Math.cos(v*c)-_,z:0}}unproject(t,n){const{n:c,c:d,r0:_}=this,v=_+n;let E=Math.atan2(t,Math.abs(v))*Math.sign(v);v*c<0&&(E-=Math.PI*Math.sign(t)*Math.sign(v));const k=Ce(this.center[0])*c;E=hs(E,-Math.PI-k,Math.PI-k);const L=pi(di(E/c)+this.center[0],-180,180),N=Math.asin(pi((d-(t*t+v*v)*c*c)/(2*c),-1,1)),V=pi(di(N),-85.051129,po);return new Es(L,V)}}const tg=1.340264,eg=-.081106,ig=893e-6,sg=.003796,oy=Math.sqrt(3)/2;class nC extends hu{project(t,n){n=n/180*Math.PI,t=t/180*Math.PI;const c=Math.asin(oy*Math.sin(n)),d=c*c,_=d*d*d;return{x:.5*(t*Math.cos(c)/(oy*(tg+3*eg*d+_*(7*ig+9*sg*d)))/Math.PI+.5),y:1-.5*(c*(tg+eg*d+_*(ig+sg*d))/Math.PI+1),z:0}}unproject(t,n){t=(2*t-.5)*Math.PI;let c=n=(2*(1-n)-1)*Math.PI,d=c*c,_=d*d*d;for(let N,V,W,Y=0;Y<12&&(V=c*(tg+eg*d+_*(ig+sg*d))-n,W=tg+3*eg*d+_*(7*ig+9*sg*d),N=V/W,c=pi(c-N,-Math.PI/3,Math.PI/3),d=c*c,_=d*d*d,!(Math.abs(N)<1e-12));++Y);const v=oy*t*(tg+3*eg*d+_*(7*ig+9*sg*d))/Math.cos(c),E=Math.asin(Math.sin(c)/oy),k=pi(180*v/Math.PI,-180,180),L=pi(180*E/Math.PI,-85.051129,po);return new Es(k,L)}}class rC extends hu{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,n){return{x:.5+t/360,y:.5-n/360,z:0}}unproject(t,n){const c=360*(t-.5),d=pi(360*(.5-n),-85.051129,po);return new Es(c,d)}}const Ap=Math.PI/2;function ay(s){return Math.tan((Ap+s)/2)}class oC extends hu{constructor(t){super(t),this.center=t.center||[0,30];const[n,c]=this.parallels=t.parallels||[30,30];let d=Ce(n),_=Ce(c);this.southernCenter=d+_<0,this.southernCenter&&(d=-d,_=-_);const v=Math.cos(d),E=ay(d);this.n=d===_?Math.sin(d):Math.log(v/Math.cos(_))/Math.log(ay(_)/E),this.f=v*Math.pow(ay(d),this.n)/this.n}project(t,n){n=Ce(n),this.southernCenter&&(n=-n),t=Ce(t-this.center[0]);const c=1e-6,{n:d,f:_}=this;_>0?n<-Ap+c&&(n=-Ap+c):n>Ap-c&&(n=Ap-c);const v=_/Math.pow(ay(n),d);let E=v*Math.sin(d*t),k=_-v*Math.cos(d*t);return E=.5*(E/Math.PI+.5),k=.5*(k/Math.PI+.5),{x:E,y:this.southernCenter?k:1-k,z:0}}unproject(t,n){t=(2*t-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:c,f:d}=this,_=d-n,v=Math.sign(_),E=Math.sign(c)*Math.sqrt(t*t+_*_);let k=Math.atan2(t,Math.abs(_))*v;_*c<0&&(k-=Math.PI*Math.sign(t)*v);const L=pi(di(k/c)+this.center[0],-180,180),N=pi(di(2*Math.atan(Math.pow(d/E,1/c))-Ap),-85.051129,po);return new Es(L,this.southernCenter?-N:N)}}class E1 extends hu{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,n){return{x:ua(t),y:Bo(n),z:0}}unproject(t,n){const c=fo(t),d=cr(n);return new Es(c,d)}}const M1=Ce(po);class aC extends hu{project(t,n){const c=(n=Ce(n))*n,d=c*c;return{x:.5*((t=Ce(t))*(.8707-.131979*c+d*(d*(.003971*c-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+c*(.015085+d*(.028874*c-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(t,n){t=(2*t-.5)*Math.PI;let c=n=(2*(1-n)-1)*Math.PI,d=25,_=0,v=c*c;do{v=c*c;const L=v*v;_=(c*(1.007226+v*(.015085+L*(.028874*v-.044475-.005916*L)))-n)/(1.007226+v*(.045255+L*(.259866*v-.311325-.005916*11*L))),c=pi(c-_,-M1,M1)}while(Math.abs(_)>1e-6&&--d>0);v=c*c;const E=pi(di(t/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),k=di(c);return new Es(E,k)}}const A1=Ce(po);class lC extends hu{project(t,n){n=Ce(n),t=Ce(t);const c=Math.cos(n),d=2/Math.PI,_=Math.acos(c*Math.cos(t/2)),v=Math.sin(_)/_,E=.5*(t*d+2*c*Math.sin(t/2)/v)||0,k=.5*(n+Math.sin(n)/v)||0;return{x:.5*(E/Math.PI+.5),y:1-.5*(k/Math.PI+1),z:0}}unproject(t,n){let c=t=(2*t-.5)*Math.PI,d=n=(2*(1-n)-1)*Math.PI,_=25;const v=1e-6;let E=0,k=0;do{const L=Math.cos(d),N=Math.sin(d),V=2*N*L,W=N*N,Y=L*L,K=Math.cos(c/2),st=Math.sin(c/2),ut=2*K*st,vt=st*st,Pt=1-Y*K*K,bt=Pt?1/Pt:0,Ct=Pt?Math.acos(L*K)*Math.sqrt(1/Pt):0,Ft=.5*(2*Ct*L*st+2*c/Math.PI)-t,Ot=.5*(Ct*N+d)-n,he=.5*bt*(Y*vt+Ct*L*K*W)+1/Math.PI,oe=bt*(ut*V/4-Ct*N*st),_e=.125*bt*(V*st-Ct*N*Y*ut),Re=.5*bt*(W*K+Ct*vt*L)+.5,de=oe*_e-Re*he;E=(Ot*oe-Ft*Re)/de,k=(Ft*_e-Ot*he)/de,c=pi(c-E,-Math.PI,Math.PI),d=pi(d-k,-A1,A1)}while((Math.abs(E)>v||Math.abs(k)>v)&&--_>0);return new Es(di(c),di(d))}}class C1 extends hu{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ce(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,n){const{scale:c,cosPhi:d}=this;return{x:Ce(t)*d*c+.5,y:-Math.sin(Ce(n))/d*c+.5,z:0}}unproject(t,n){const{scale:c,cosPhi:d}=this,_=-(n-.5)/c,v=pi(di((t-.5)/c)/d,-180,180),E=Math.asin(pi(_*d,-1,1)),k=pi(di(E),-85.051129,po);return new Es(v,k)}}class cC extends E1{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,n,c){const d=Ld(t,n,c);return rn(d,d,Hc(Ro(c))),{x:d[0],y:d[1],z:d[2]}}locationPoint(t,n){const c=Yh(n.lat,n.lng),d=Mr([],c),_=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(n),t._centerAltitude):t._centerAltitude;Ed(c,c,d,da(1,0)*gi*_);const v=co(new Float64Array(16));return dl(v,t.pixelMatrix,t.globeMatrix),rn(c,c,v),new Ut(c[0],c[1])}pixelsPerMeter(t,n){return da(1,0)*n}pixelSpaceConversion(t,n,c){const d=da(1,t)*n,_=rs(da(1,45)*n,d,c);return this.pixelsPerMeter(t,n)/_}createTileMatrix(t,n,c){const d=Pm(Ro(c.canonical));return dl(new Float64Array(16),t.globeMatrix,d)}createInversionMatrix(t,n){const{center:c}=t,d=Hc(Ro(n));return Jf(d,d,Ce(c.lng)),Td(d,d,Ce(c.lat)),fl(d,d,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(t,n,c,d){return b_(t,n,c,!0)||new Qh(0,0)}pointCoordinate3D(t,n,c){const d=this.pointCoordinate(t,n,c,0);return[d.x,d.y,d.z]}isPointAboveHorizon(t,n){return!b_(t,n.x,n.y,!1)}farthestPixelDistance(t){const n=function(d,_){const v=d.cameraToCenterDistance,E=d._centerAltitude*_,k=d._camera,L=d._camera.forward(),N=ca([],Gr([],L,-v),[0,0,E]),V=d.worldSize/(2*Math.PI),W=[0,0,-V],Y=d.width/d.height,K=Math.tan(d.fovAboveCenter),st=Gr([],k.up(),K),ut=Gr([],k.right(),K*Y),vt=Mr([],ca([],ca([],L,st),ut)),Pt=[];let bt;if(new Am(N,vt).closestPointOnSphere(W,V,Pt)){const Ct=ca([],Pt,W),Ft=ho([],Ct,N);bt=Math.cos(d.fovAboveCenter)*qh(Ft)}else{const Ct=ho([],N,W),Ft=ho([],W,N);Mr(Ft,Ft);const Ot=qh(Ct)-V;bt=Math.sqrt(Ot*(Ot+2*V));const he=Math.acos(bt/(V+Ot))-Math.acos(Wr(L,Ft));bt*=Math.cos(he)}return 1.01*bt}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),c=Jh(t.zoom);if(c>0){const d=S1(t,da(1,t.center.lat)*t.worldSize),_=t.worldSize/(2*Math.PI),v=Math.max(t.width,t.height)/t.worldSize*Math.PI;return rs(n,d+_*(1-Math.cos(v)),Math.pow(c,10))}return n}upVector(t,n,c){return Ld(n,c,t,1)}upVectorScale(t){return{metersToTile:rp(Kh(Ro(t)))}}}function k1(s){const t=s.parallels,n=!!t&&Math.abs(t[0]+t[1])<.01;switch(s.name){case"mercator":return new E1(s);case"equirectangular":return new rC(s);case"naturalEarth":return new aC(s);case"equalEarth":return new nC(s);case"winkelTripel":return new lC(s);case"albers":return n?new C1(s):new sC(s);case"lambertConformalConic":return n?new C1(s):new oC(s);case"globe":return new cC(s)}throw new Error(`Invalid projection name: ${s.name}`)}const hC=Hd.types,uC=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ly(s,t,n,c,d,_,v,E,k,L,N,V,W){const Y=E?Math.min(cu,Math.round(E[0])):0,K=E?Math.min(cu,Math.round(E[1])):0;s.emplaceBack(t,n,Math.round(32*c),Math.round(32*d),_,v,(Y<<1)+(k?1:0),K,16*L,16*N,256*V,256*W)}function cy(s,t,n,c,d,_,v){s.emplaceBack(t,n,c,d,_,v)}function hy(s,t,n,c,d){s.emplaceBack(t,n,c,d),s.emplaceBack(t,n,c,d),s.emplaceBack(t,n,c,d),s.emplaceBack(t,n,c,d)}function dC(s){for(const t of s.sections)if(bm(t.text))return!0;return!1}class R0{constructor(t){this.layoutVertexArray=new ge,this.indexArray=new mi,this.programConfigurations=t,this.segments=new yn,this.dynamicLayoutVertexArray=new Ie,this.opacityVertexArray=new yi,this.placedSymbolArray=new Mn,this.globeExtVertexArray=new Oe}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,c,d){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vt.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Kt.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,uC,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,le.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||d)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}oi(R0,"SymbolBuffers");class B0{constructor(t,n,c){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new c,this.segments=new yn,this.collisionVertexArray=new Oi,this.collisionVertexArrayExt=new Ri}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,ce.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,Ee.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}oi(B0,"CollisionBuffers");class uu{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(v=>v.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=co([]),this.placementViewportMatrix=co([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ri(this.zoom,n["text-size"]),this.iconSizeData=ri(this.zoom,n["icon-size"]);const c=this.layers[0].layout,d=c.get("symbol-sort-key"),_=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(v=>ma[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new R0(new Yl(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new R0(new Yl(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new On,this.lineVertexArray=new Wh,this.symbolInstances=new Vs}calculateGlyphDependencies(t,n,c,d,_){for(let v=0;v<t.length;v++)if(n[t.charCodeAt(v)]=!0,d&&_){const E=Zi[t.charAt(v)];E&&(n[E.charCodeAt(0)]=!0)}}populate(t,n,c,d){const _=this.layers[0],v=_.layout,E=this.projection.name==="globe",k=v.get("text-font"),L=v.get("text-field"),N=v.get("icon-image"),V=(L.value.kind!=="constant"||L.value.value instanceof Sr&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&(k.value.kind!=="constant"||k.value.value.length>0),W=N.value.kind!=="constant"||!!N.value.value||Object.keys(N.parameters).length>0,Y=v.get("symbol-sort-key");if(this.features=[],!V&&!W)return;const K=n.iconDependencies,st=n.glyphDependencies,ut=n.availableImages,vt=new j(this.zoom);for(const{feature:Pt,id:bt,index:Ct,sourceLayerIndex:Ft}of t){const Ot=_._featureFilter.needGeometry,he=Xc(Pt,Ot);if(!_._featureFilter.filter(vt,he,c))continue;if(Ot||(he.geometry=fa(Pt,c,d)),E&&Pt.type!==1&&c.z<=5){const de=he.geometry,we=.98078528056,Te=(Pe,Ne)=>Wr(Ld(Pe.x,Pe.y,c,1),Ld(Ne.x,Ne.y,c,1))<we;for(let Pe=0;Pe<de.length;Pe++)de[Pe]=s0(de[Pe],Te)}let oe,_e;if(V){const de=_.getValueAndResolveTokens("text-field",he,c,ut),we=Sr.factory(de);dC(we)&&(this.hasRTLText=!0),(!this.hasRTLText||M()==="unavailable"||this.hasRTLText&&O.isParsed())&&(oe=as(we,_,he))}if(W){const de=_.getValueAndResolveTokens("icon-image",he,c,ut);_e=de instanceof pr?de:pr.fromString(de)}if(!oe&&!_e)continue;const Re=this.sortFeaturesByKey?Y.evaluate(he,{},c):void 0;if(this.features.push({id:bt,text:oe,icon:_e,index:Ct,sourceLayerIndex:Ft,geometry:he.geometry,properties:Pt.properties,type:hC[Pt.type],sortKey:Re}),_e&&(K[_e.name]=!0),oe){const de=k.evaluate(he,{},c).join(","),we=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ma.vertical)>=0;for(const Te of oe.sections)if(Te.image)K[Te.image.name]=!0;else{const Pe=md(oe.toString()),Ne=Te.fontStack||de,me=st[Ne]=st[Ne]||{};this.calculateGlyphDependencies(Te.text,me,we,this.allowVerticalPlacement,Pe)}}}v.get("symbol-placement")==="line"&&(this.features=function(Pt){const bt={},Ct={},Ft=[];let Ot=0;function he(de){Ft.push(Pt[de]),Ot++}function oe(de,we,Te){const Pe=Ct[de];return delete Ct[de],Ct[we]=Pe,Ft[Pe].geometry[0].pop(),Ft[Pe].geometry[0]=Ft[Pe].geometry[0].concat(Te[0]),Pe}function _e(de,we,Te){const Pe=bt[we];return delete bt[we],bt[de]=Pe,Ft[Pe].geometry[0].shift(),Ft[Pe].geometry[0]=Te[0].concat(Ft[Pe].geometry[0]),Pe}function Re(de,we,Te){const Pe=Te?we[0][we[0].length-1]:we[0][0];return`${de}:${Pe.x}:${Pe.y}`}for(let de=0;de<Pt.length;de++){const we=Pt[de],Te=we.geometry,Pe=we.text?we.text.toString():null;if(!Pe){he(de);continue}const Ne=Re(Pe,Te),me=Re(Pe,Te,!0);if(Ne in Ct&&me in bt&&Ct[Ne]!==bt[me]){const qe=_e(Ne,me,Te),ui=oe(Ne,me,Ft[qe].geometry);delete bt[Ne],delete Ct[me],Ct[Re(Pe,Ft[ui].geometry,!0)]=ui,Ft[qe].geometry=null}else Ne in Ct?oe(Ne,me,Te):me in bt?_e(Ne,me,Te):(he(de),bt[Ne]=Ot-1,Ct[me]=Ot-1)}return Ft.filter(de=>de.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Pt,bt)=>Pt.sortKey-bt.sortKey)}update(t,n,c,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,c,d),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,c,d))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=k1(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const c=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:d,y:_}of n)this.lineVertexArray.emplaceBack(d,_);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,n,c,d,_,v,E,k,L,N,V,W,Y,K){const st=t.indexArray,ut=t.layoutVertexArray,vt=t.globeExtVertexArray,Pt=t.segments.prepareSegment(4*n.length,ut,st,this.canOverlap?v.sortKey:void 0),bt=this.glyphOffsetArray.length,Ct=Pt.vertexLength,Ft=this.allowVerticalPlacement&&E===ma.vertical?Math.PI/2:0,Ot=v.text&&v.text.sections;for(let oe=0;oe<n.length;oe++){const{tl:_e,tr:Re,bl:de,br:we,tex:Te,pixelOffsetTL:Pe,pixelOffsetBR:Ne,minFontScaleX:me,minFontScaleY:qe,glyphOffset:ui,isSDF:Qe,sectionIndex:Fi}=n[oe],je=Pt.vertexLength,bi=ui[1];if(ly(ut,L.x,L.y,_e.x,bi+_e.y,Te.x,Te.y,c,Qe,Pe.x,Pe.y,me,qe),ly(ut,L.x,L.y,Re.x,bi+Re.y,Te.x+Te.w,Te.y,c,Qe,Ne.x,Pe.y,me,qe),ly(ut,L.x,L.y,de.x,bi+de.y,Te.x,Te.y+Te.h,c,Qe,Pe.x,Ne.y,me,qe),ly(ut,L.x,L.y,we.x,bi+we.y,Te.x+Te.w,Te.y+Te.h,c,Qe,Ne.x,Ne.y,me,qe),k){const{x:Ni,y:_s,z:ji}=k.anchor,[Mi,Js,$i]=k.up;cy(vt,Ni,_s,ji,Mi,Js,$i),cy(vt,Ni,_s,ji,Mi,Js,$i),cy(vt,Ni,_s,ji,Mi,Js,$i),cy(vt,Ni,_s,ji,Mi,Js,$i),hy(t.dynamicLayoutVertexArray,Ni,_s,ji,Ft)}else hy(t.dynamicLayoutVertexArray,L.x,L.y,L.z,Ft);st.emplaceBack(je,je+1,je+2),st.emplaceBack(je+1,je+2,je+3),Pt.vertexLength+=4,Pt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ui[0]),oe!==n.length-1&&Fi===n[oe+1].sectionIndex||t.programConfigurations.populatePaintArrays(ut.length,v,v.index,{},Y,K,Ot&&Ot[Fi])}const he=k?k.anchor:L;t.placedSymbolArray.emplaceBack(he.x,he.y,he.z,L.x,L.y,bt,this.glyphOffsetArray.length-bt,Ct,N,V,L.segment,c?c[0]:0,c?c[1]:0,d[0],d[1],E,0,!1,0,W,0)}_commitLayoutVertex(t,n,c,d,_,v,E){t.emplaceBack(n,c,d,_,v,Math.round(E.x),Math.round(E.y))}_addCollisionDebugVertices(t,n,c,d,_,v,E){const k=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),L=k.vertexLength,N=E.tileAnchorX,V=E.tileAnchorY;for(let Y=0;Y<4;Y++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(n,-t.padding,-t.padding),c.collisionVertexArrayExt.emplaceBack(n,t.padding,-t.padding),c.collisionVertexArrayExt.emplaceBack(n,t.padding,t.padding),c.collisionVertexArrayExt.emplaceBack(n,-t.padding,t.padding),this._commitLayoutVertex(c.layoutVertexArray,d,_,v,N,V,new Ut(t.x1,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,d,_,v,N,V,new Ut(t.x2,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,d,_,v,N,V,new Ut(t.x2,t.y2)),this._commitLayoutVertex(c.layoutVertexArray,d,_,v,N,V,new Ut(t.x1,t.y2)),k.vertexLength+=4;const W=c.indexArray;W.emplaceBack(L,L+1),W.emplaceBack(L+1,L+2),W.emplaceBack(L+2,L+3),W.emplaceBack(L+3,L),k.primitiveLength+=4}_addTextDebugCollisionBoxes(t,n,c,d,_,v){for(let E=d;E<_;E++){const k=c.get(E),L=this.getSymbolInstanceTextSize(t,v,n,E);this._addCollisionDebugVertices(k,L,this.textCollisionBox,k.projectedAnchorX,k.projectedAnchorY,k.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(t,n,c,d,_,v){for(let E=d;E<_;E++){const k=c.get(E),L=this.getSymbolInstanceIconSize(t,n,v.placedIconSymbolIndex);this._addCollisionDebugVertices(k,L,this.iconCollisionBox,k.projectedAnchorX,k.projectedAnchorY,k.projectedAnchorZ,v)}}generateCollisionDebugBuffers(t,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new B0(ai,Be.members,qn),this.iconCollisionBox=new B0(ai,Be.members,qn);const c=hi(this.iconSizeData,t),d=hi(this.textSizeData,t);for(let _=0;_<this.symbolInstances.length;_++){const v=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(d,t,n,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(d,t,n,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(c,t,n,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(c,t,n,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(t,n,c,d){const _=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:d),v=Ii(this.textSizeData,t,_)/Ae;return this.tilePixelRatio*v}getSymbolInstanceIconSize(t,n,c){const d=this.icon.placedSymbolArray.get(c),_=Ii(this.iconSizeData,t,d);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(t,n,c){t.emplaceBack(n,-c,-c),t.emplaceBack(n,c,-c),t.emplaceBack(n,c,c),t.emplaceBack(n,-c,c)}_updateTextDebugCollisionBoxes(t,n,c,d,_,v){for(let E=d;E<_;E++){const k=c.get(E),L=this.getSymbolInstanceTextSize(t,v,n,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,L,k.padding)}}_updateIconDebugCollisionBoxes(t,n,c,d,_,v){for(let E=d;E<_;E++){const k=c.get(E),L=this.getSymbolInstanceIconSize(t,n,v);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,L,k.padding)}}updateCollisionDebugBuffers(t,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=hi(this.iconSizeData,t),d=hi(this.textSizeData,t);for(let _=0;_<this.symbolInstances.length;_++){const v=this.symbolInstances.get(_);this._updateTextDebugCollisionBoxes(d,t,n,v.textBoxStartIndex,v.textBoxEndIndex,v),this._updateTextDebugCollisionBoxes(d,t,n,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._updateIconDebugCollisionBoxes(c,t,n,v.iconBoxStartIndex,v.iconBoxEndIndex,v.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(c,t,n,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,n,c,d,_,v,E,k,L){const N={};if(n<c){const{x1:V,y1:W,x2:Y,y2:K,padding:st,projectedAnchorX:ut,projectedAnchorY:vt,projectedAnchorZ:Pt,tileAnchorX:bt,tileAnchorY:Ct,featureIndex:Ft}=t.get(n);N.textBox={x1:V,y1:W,x2:Y,y2:K,padding:st,projectedAnchorX:ut,projectedAnchorY:vt,projectedAnchorZ:Pt,tileAnchorX:bt,tileAnchorY:Ct},N.textFeatureIndex=Ft}if(d<_){const{x1:V,y1:W,x2:Y,y2:K,padding:st,projectedAnchorX:ut,projectedAnchorY:vt,projectedAnchorZ:Pt,tileAnchorX:bt,tileAnchorY:Ct,featureIndex:Ft}=t.get(d);N.verticalTextBox={x1:V,y1:W,x2:Y,y2:K,padding:st,projectedAnchorX:ut,projectedAnchorY:vt,projectedAnchorZ:Pt,tileAnchorX:bt,tileAnchorY:Ct},N.verticalTextFeatureIndex=Ft}if(v<E){const{x1:V,y1:W,x2:Y,y2:K,padding:st,projectedAnchorX:ut,projectedAnchorY:vt,projectedAnchorZ:Pt,tileAnchorX:bt,tileAnchorY:Ct,featureIndex:Ft}=t.get(v);N.iconBox={x1:V,y1:W,x2:Y,y2:K,padding:st,projectedAnchorX:ut,projectedAnchorY:vt,projectedAnchorZ:Pt,tileAnchorX:bt,tileAnchorY:Ct},N.iconFeatureIndex=Ft}if(k<L){const{x1:V,y1:W,x2:Y,y2:K,padding:st,projectedAnchorX:ut,projectedAnchorY:vt,projectedAnchorZ:Pt,tileAnchorX:bt,tileAnchorY:Ct,featureIndex:Ft}=t.get(k);N.verticalIconBox={x1:V,y1:W,x2:Y,y2:K,padding:st,projectedAnchorX:ut,projectedAnchorY:vt,projectedAnchorZ:Pt,tileAnchorX:bt,tileAnchorY:Ct},N.verticalIconFeatureIndex=Ft}return N}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const c=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const c=t.placedSymbolArray.get(n),d=c.vertexStartIndex+4*c.numGlyphs;for(let _=c.vertexStartIndex;_<d;_+=4)t.indexArray.emplaceBack(_,_+1,_+2),t.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),c=Math.cos(t),d=[],_=[],v=[];for(let E=0;E<this.symbolInstances.length;++E){v.push(E);const k=this.symbolInstances.get(E);d.push(0|Math.round(n*k.tileAnchorX+c*k.tileAnchorY)),_.push(k.featureIndex)}return v.sort((E,k)=>d[E]-d[k]||_[k]-_[E]),v}addToSortKeyRanges(t,n){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===n?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const c=this.symbolInstances.get(n);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:_,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:E,placedIconSymbolIndex:k,verticalPlacedIconSymbolIndex:L}=c;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),_>=0&&_!==d&&this.addIndicesForPlacedSymbol(this.text,_),v>=0&&v!==_&&v!==d&&this.addIndicesForPlacedSymbol(this.text,v),E>=0&&this.addIndicesForPlacedSymbol(this.text,E),k>=0&&this.addIndicesForPlacedSymbol(this.icon,k),L>=0&&this.addIndicesForPlacedSymbol(this.icon,L)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}oi(uu,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),uu.MAX_GLYPHS=65535,uu.addDynamicAttributes=hy;const fC=new Et({"symbol-placement":new et(pe.layout_symbol["symbol-placement"]),"symbol-spacing":new et(pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new et(pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ft(pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new et(pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new et(pe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new et(pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new et(pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new et(pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new ft(pe.layout_symbol["icon-size"]),"icon-text-fit":new et(pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new et(pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new ft(pe.layout_symbol["icon-image"]),"icon-rotate":new ft(pe.layout_symbol["icon-rotate"]),"icon-padding":new et(pe.layout_symbol["icon-padding"]),"icon-keep-upright":new et(pe.layout_symbol["icon-keep-upright"]),"icon-offset":new ft(pe.layout_symbol["icon-offset"]),"icon-anchor":new ft(pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new et(pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new et(pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new et(pe.layout_symbol["text-rotation-alignment"]),"text-field":new ft(pe.layout_symbol["text-field"]),"text-font":new ft(pe.layout_symbol["text-font"]),"text-size":new ft(pe.layout_symbol["text-size"]),"text-max-width":new ft(pe.layout_symbol["text-max-width"]),"text-line-height":new ft(pe.layout_symbol["text-line-height"]),"text-letter-spacing":new ft(pe.layout_symbol["text-letter-spacing"]),"text-justify":new ft(pe.layout_symbol["text-justify"]),"text-radial-offset":new ft(pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new et(pe.layout_symbol["text-variable-anchor"]),"text-anchor":new ft(pe.layout_symbol["text-anchor"]),"text-max-angle":new et(pe.layout_symbol["text-max-angle"]),"text-writing-mode":new et(pe.layout_symbol["text-writing-mode"]),"text-rotate":new ft(pe.layout_symbol["text-rotate"]),"text-padding":new et(pe.layout_symbol["text-padding"]),"text-keep-upright":new et(pe.layout_symbol["text-keep-upright"]),"text-transform":new ft(pe.layout_symbol["text-transform"]),"text-offset":new ft(pe.layout_symbol["text-offset"]),"text-allow-overlap":new et(pe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new et(pe.layout_symbol["text-ignore-placement"]),"text-optional":new et(pe.layout_symbol["text-optional"])});var F0={paint:new Et({"icon-opacity":new ft(pe.paint_symbol["icon-opacity"]),"icon-color":new ft(pe.paint_symbol["icon-color"]),"icon-halo-color":new ft(pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new ft(pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ft(pe.paint_symbol["icon-halo-blur"]),"icon-translate":new et(pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new et(pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new ft(pe.paint_symbol["text-opacity"]),"text-color":new ft(pe.paint_symbol["text-color"],{runtimeType:br,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new ft(pe.paint_symbol["text-halo-color"]),"text-halo-width":new ft(pe.paint_symbol["text-halo-width"]),"text-halo-blur":new ft(pe.paint_symbol["text-halo-blur"]),"text-translate":new et(pe.paint_symbol["text-translate"]),"text-translate-anchor":new et(pe.paint_symbol["text-translate-anchor"])}),layout:fC};class P1{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Ml,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}oi(P1,"FormatSectionOverride",{omit:["defaultValue"]});class uy extends la{constructor(t){super(t,F0)}recalculate(t,n){super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const d=[];for(const _ of c)d.indexOf(_)<0&&d.push(_);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,n,c,d){const _=this.layout.get(t).evaluate(n,{},c,d),v=this._unevaluatedLayout._values[t];return v.isDataDriven()||ys(v.value)||!_?_:function(E,k){return k.replace(/{([^{}]+)}/g,(L,N)=>N in E?String(E[N]):"")}(n.properties,_)}createBucket(t){return new uu(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of F0.paint.overridableProperties){if(!uy.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),c=new P1(n),d=new nr(c,n.property.specification);let _=null;_=n.value.kind==="constant"||n.value.kind==="source"?new Bh("source",d):new sl("composite",d,n.value.zoomStops,n.value._interpolationType),this.paint._values[t]=new mt(n.property,_,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,c){return!(!this.layout||n.isDataDriven()||c.isDataDriven())&&uy.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const c=t.get("text-field"),d=F0.paint.properties[n];let _=!1;const v=E=>{for(const k of E)if(d.overrides&&d.overrides.hasOverride(k))return void(_=!0)};if(c.value.kind==="constant"&&c.value.value instanceof Sr)v(c.value.value.sections);else if(c.value.kind==="source"){const E=L=>{_||(L instanceof Ko&&ln(L.value)===ir?v(L.value.sections):L instanceof Qo?v(L.sections):L.eachChild(E))},k=c.value;k._styleExpression&&E(k._styleExpression.expression)}return _}getProgramConfiguration(t){return new Zl(this,t)}}var pC={paint:new Et({"background-color":new et(pe.paint_background["background-color"]),"background-pattern":new et(pe.paint_background["background-pattern"]),"background-opacity":new et(pe.paint_background["background-opacity"])})},mC={paint:new Et({"raster-opacity":new et(pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new et(pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new et(pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new et(pe.paint_raster["raster-brightness-max"]),"raster-saturation":new et(pe.paint_raster["raster-saturation"]),"raster-contrast":new et(pe.paint_raster["raster-contrast"]),"raster-resampling":new et(pe.paint_raster["raster-resampling"]),"raster-fade-duration":new et(pe.paint_raster["raster-fade-duration"])})};class gC extends la{constructor(t){super(t,{}),this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var _C={paint:new Et({"sky-type":new et(pe.paint_sky["sky-type"]),"sky-atmosphere-sun":new et(pe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new et(pe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new et(pe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new et(pe.paint_sky["sky-gradient-radius"]),"sky-gradient":new St(pe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new et(pe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new et(pe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new et(pe.paint_sky["sky-opacity"])})};function N0(s,t,n){const c=[0,0,1],d=lr([]);return Mm(d,d,n?-Ce(s)+Math.PI:Ce(s)),g_(d,d,-Ce(t)),gs(c,c,d),Mr(c,c)}const yC={circle:class extends la{constructor(s){super(s,ic)}createBucket(s){return new eu(s)}queryRadius(s){const t=s;return su("circle-radius",this,t)+su("circle-stroke-width",this,t)+Da(this.paint.get("circle-translate"))}queryIntersectsFeature(s,t,n,c,d,_,v,E){const k=dp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,s.pixelToTileUnitsFactor),L=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return nu(s,c,_,v,E,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",k,L)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new Zl(this,s)}},heatmap:class extends la{createBucket(s){return new Rm(s)}constructor(s){super(s,a0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Bm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return su("heatmap-radius",this,s)}queryIntersectsFeature(s,t,n,c,d,_,v,E){const k=this.paint.get("heatmap-radius").evaluate(t,n);return nu(s,c,_,v,E,!0,!0,new Ut(0,0),k)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new Zl(this,s)}},hillshade:class extends la{constructor(s){super(s,l0)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends la{constructor(s){super(s,y0)}getProgramIds(){const s=this.paint.get("fill-pattern"),t=s&&s.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(s){return new Zl(this,s)}recalculate(s,t){super.recalculate(s,t);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new Wd(s)}queryRadius(){return Da(this.paint.get("fill-translate"))}queryIntersectsFeature(s,t,n,c,d,_){return!s.queryGeometry.isAboveHorizon&&zm(Om(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,s.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends la{constructor(s){super(s,l)}createBucket(s){return new Zd(s)}queryRadius(){return Da(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new Zl(this,s)}queryIntersectsFeature(s,t,n,c,d,_,v,E,k){const L=dp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,s.pixelToTileUnitsFactor),N=this.paint.get("fill-extrusion-height").evaluate(t,n),V=this.paint.get("fill-extrusion-base").evaluate(t,n),W=[0,0],Y=E&&_.elevation,K=_.elevation?_.elevation.exaggeration():1,st=s.tile.getBucket(this);if(Y&&st instanceof Zd){const Ct=st.centroidVertexArray,Ft=k+1;Ft<Ct.length&&(W[0]=Ct.geta_centroid_pos0(Ft),W[1]=Ct.geta_centroid_pos1(Ft))}if(W[0]===0&&W[1]===1)return!1;_.projection.name==="globe"&&(c=Ym([c],[new Ut(0,0),new Ut(gi,gi)],s.tileID.canonical).map(Ct=>Ct.polygon).flat());const ut=Y?E:null,[vt,Pt]=function(Ct,Ft,Ot,he,oe,_e,Re,de,we,Te,Pe){return Ct.projection.name==="globe"?function(Ne,me,qe,ui,Qe,Fi,je,bi,Ni,_s,ji){const Mi=[],Js=[],$i=Ne.projection.upVectorScale(ji,Ne.center.lat,Ne.worldSize).metersToTile,Gi=[0,0,0,1],zs=[0,0,0,1],Gs=(Os,un,Cn,Bn)=>{Os[0]=un,Os[1]=Cn,Os[2]=Bn,Os[3]=1},Ws=J_();qe>0&&(qe+=Ws),ui+=Ws;for(const Os of me){const un=[],Cn=[];for(const Bn of Os){const Rs=Bn.x+Qe.x,Zn=Bn.y+Qe.y,Fn=Ne.projection.projectTilePoint(Rs,Zn,ji),vn=Ne.projection.upVector(ji,Bn.x,Bn.y);let vs=qe,Nn=ui;if(je){const Hs=U(Rs,Zn,qe,ui,je,bi,Ni,_s);vs+=Hs.base,Nn+=Hs.top}qe!==0?Gs(Gi,Fn.x+vn[0]*$i*vs,Fn.y+vn[1]*$i*vs,Fn.z+vn[2]*$i*vs):Gs(Gi,Fn.x,Fn.y,Fn.z),Gs(zs,Fn.x+vn[0]*$i*Nn,Fn.y+vn[1]*$i*Nn,Fn.z+vn[2]*$i*Nn),rn(Gi,Gi,Fi),rn(zs,zs,Fi),un.push(new C(Gi[0],Gi[1],Gi[2])),Cn.push(new C(zs[0],zs[1],zs[2]))}Mi.push(un),Js.push(Cn)}return[Mi,Js]}(Ct,Ft,Ot,he,oe,_e,Re,de,we,Te,Pe):Re?function(Ne,me,qe,ui,Qe,Fi,je,bi,Ni){const _s=[],ji=[],Mi=[0,0,0,1];for(const Js of Ne){const $i=[],Gi=[];for(const zs of Js){const Gs=zs.x+ui.x,Ws=zs.y+ui.y,Os=U(Gs,Ws,me,qe,Fi,je,bi,Ni);Mi[0]=Gs,Mi[1]=Ws,Mi[2]=Os.base,Mi[3]=1,Ar(Mi,Mi,Qe),Mi[3]=Math.max(Mi[3],1e-5);const un=new C(Mi[0]/Mi[3],Mi[1]/Mi[3],Mi[2]/Mi[3]);Mi[0]=Gs,Mi[1]=Ws,Mi[2]=Os.top,Mi[3]=1,Ar(Mi,Mi,Qe),Mi[3]=Math.max(Mi[3],1e-5);const Cn=new C(Mi[0]/Mi[3],Mi[1]/Mi[3],Mi[2]/Mi[3]);$i.push(un),Gi.push(Cn)}_s.push($i),ji.push(Gi)}return[_s,ji]}(Ft,Ot,he,oe,_e,Re,de,we,Te):function(Ne,me,qe,ui,Qe){const Fi=[],je=[],bi=Qe[8]*me,Ni=Qe[9]*me,_s=Qe[10]*me,ji=Qe[11]*me,Mi=Qe[8]*qe,Js=Qe[9]*qe,$i=Qe[10]*qe,Gi=Qe[11]*qe;for(const zs of Ne){const Gs=[],Ws=[];for(const Os of zs){const un=Os.x+ui.x,Cn=Os.y+ui.y,Bn=Qe[0]*un+Qe[4]*Cn+Qe[12],Rs=Qe[1]*un+Qe[5]*Cn+Qe[13],Zn=Qe[2]*un+Qe[6]*Cn+Qe[14],Fn=Qe[3]*un+Qe[7]*Cn+Qe[15],vn=Bn+bi,vs=Rs+Ni,Nn=Zn+_s,Hs=Math.max(Fn+ji,1e-5),qr=Bn+Mi,jn=Rs+Js,_r=Zn+$i,hr=Math.max(Fn+Gi,1e-5);Gs.push(new C(vn/Hs,vs/Hs,Nn/Hs)),Ws.push(new C(qr/hr,jn/hr,_r/hr))}Fi.push(Gs),je.push(Ws)}return[Fi,je]}(Ft,Ot,he,oe,_e)}(_,c,V,N,L,v,ut,W,K,_.center.lat,s.tileID.canonical),bt=s.queryGeometry;return function(Ct,Ft,Ot){let he=1/0;zm(Ot,Ft)&&(he=R(Ot,Ft[0]));for(let oe=0;oe<Ft.length;oe++){const _e=Ft[oe],Re=Ct[oe];for(let de=0;de<_e.length-1;de++){const we=_e[de],Te=[we,_e[de+1],Re[de+1],Re[de],we];Rd(Ot,Te)&&(he=Math.min(he,R(Ot,Te)))}}return he!==1/0&&he}(vt,Pt,bt.isPointQuery()?bt.screenBounds:bt.screenGeometry)}},line:class extends la{constructor(s){super(s,dt),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Zu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,t){super.recalculate(s,t),this.paint._values["line-floorwidth"]=Ht.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new it(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new Zl(this,s)}queryRadius(s){const t=s,n=Bt(su("line-width",this,t),su("line-gap-width",this,t)),c=su("line-offset",this,t);return n/2+Math.abs(c)+Da(this.paint.get("line-translate"))}queryIntersectsFeature(s,t,n,c,d,_){if(s.queryGeometry.isAboveHorizon)return!1;const v=Om(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,s.pixelToTileUnitsFactor),E=s.pixelToTileUnitsFactor/2*Bt(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),k=this.paint.get("line-offset").evaluate(t,n);return k&&(c=function(L,N){const V=[],W=new Ut(0,0);for(let Y=0;Y<L.length;Y++){const K=L[Y],st=[];for(let ut=0;ut<K.length;ut++){const vt=K[ut],Pt=K[ut+1],bt=ut===0?W:vt.sub(K[ut-1])._unit()._perp(),Ct=ut===K.length-1?W:Pt.sub(vt)._unit()._perp(),Ft=bt._add(Ct)._unit();Ft._mult(1/(Ft.x*Ct.x+Ft.y*Ct.y)),st.push(Ft._mult(N)._add(vt))}V.push(st)}return V}(c,k*s.pixelToTileUnitsFactor)),function(L,N,V){for(let W=0;W<N.length;W++){const Y=N[W];if(L.length>=3){for(let K=0;K<Y.length;K++)if(La(L,Y[K]))return!0}if(P_(L,Y,V))return!0}return!1}(v,c,E)}isTileClipped(){return!0}},symbol:uy,background:class extends la{constructor(s){super(s,pC)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends la{constructor(s){super(s,mC)}getProgramIds(){return["raster"]}},sky:class extends la{constructor(s){super(s,_C),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Bm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(s,t){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),d=!c,_=s.style.light,v=_.properties.get("position");return d&&_.properties.get("anchor")==="viewport"&&Se("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?N0(v.azimuthal,90-v.polar,t):N0(c[0],90-c[1],t)}const n=this.paint.get("sky-gradient-center");return N0(n[0],90-n[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}}};class ng{constructor(t,n,c,d){this.context=t,this.format=c,this.texture=t.gl.createTexture(),this.update(n,d)}update(t,n,c){const{width:d,height:_}=t,{context:v}=this,{gl:E}=v,{HTMLImageElement:k,HTMLCanvasElement:L,HTMLVideoElement:N,ImageData:V,ImageBitmap:W}=z;if(E.bindTexture(E.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!n||n.premultiply!==!1)),c||this.size&&this.size[0]===d&&this.size[1]===_){const{x:Y,y:K}=c||{x:0,y:0};t instanceof k||t instanceof L||t instanceof N||t instanceof V||W&&t instanceof W?E.texSubImage2D(E.TEXTURE_2D,0,Y,K,E.RGBA,E.UNSIGNED_BYTE,t):E.texSubImage2D(E.TEXTURE_2D,0,Y,K,d,_,E.RGBA,E.UNSIGNED_BYTE,t.data)}else this.size=[d,_],t instanceof k||t instanceof L||t instanceof N||t instanceof V||W&&t instanceof W?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,t):E.texImage2D(E.TEXTURE_2D,0,this.format,d,_,0,this.format,E.UNSIGNED_BYTE,t.data);this.useMipmap=!!(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&E.generateMipmap(E.TEXTURE_2D)}bind(t,n){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),t!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?t===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_NEAREST:t),this.filter=t),n!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class xC{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class vC{constructor(){this.tasks={},this.taskQueue=[],_i(["process"],this),this.invoker=new xC(this.process),this.nextId=0}add(t,n){const c=this.nextId++,d=function({type:_,isSymbolTile:v,zoom:E}){return E=E||0,_==="message"?0:_!=="maybePrepare"||v?_!=="parseTile"||v?_==="parseTile"&&v?300-E:_==="maybePrepare"&&v?400-E:500:200-E:100-E}(n);if(d===0){ei();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:t,metadata:n,priority:d,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){ei();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const n=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let t=null,n=1/0;for(let d=0;d<this.taskQueue.length;d++){const _=this.tasks[this.taskQueue[d]];_.priority<n&&(n=_.priority,t=d)}if(t===null)return null;const c=this.taskQueue[t];return this.taskQueue.splice(t,1),c}remove(){this.invoker.remove()}}class I1{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const c=t[n];this._stringToNumber[c]=n,this._numberToString[n]=c}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const bC=["tile","layer","source","sourceLayer","state"];class L1{constructor(t,n,c,d,_){this.type="Feature",this._vectorTileFeature=t,this._z=n,this._x=c,this._y=d,this.properties=t.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(t.id=this.id);for(const n of bC)this[n]!==void 0&&(t[n]=this[n]);return t}}const za=32,rc=33,du=new Uint16Array(8184);for(let s=0;s<2046;s++){let t=s+2,n=0,c=0,d=0,_=0,v=0,E=0;for(1&t?d=_=v=za:n=c=E=za;(t>>=1)>1;){const L=n+d>>1,N=c+_>>1;1&t?(d=n,_=c,n=v,c=E):(n=d,c=_,d=v,_=E),v=L,E=N}const k=4*s;du[k+0]=n,du[k+1]=c,du[k+2]=d,du[k+3]=_}const oc=new Uint16Array(2178),fu=new Uint8Array(1089),dy=new Uint16Array(1089);function D1(s){return s===0?-.03125:s===32?.03125:0}var z1=Yt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const O1={type:2,extent:gi,loadGeometry:()=>[[new Ut(0,0),new Ut(gi+1,0),new Ut(gi+1,gi+1),new Ut(0,gi+1),new Ut(0,0)]]};class j0{constructor(t,n,c,d,_){this.tileID=t,this.uid=Ds(),this.uses=0,this.tileSize=n,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,this.expiredRequestCount=0,this.state="loading",d&&d.transform&&(this.projection=d.transform.projection)}registerFadeDuration(t){const n=t+this.timeAdded;n<To.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=tf(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,c){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(d,_){const v={};if(!_)return v;for(const E of d){const k=E.layerIds.map(L=>_.getLayer(L)).filter(Boolean);if(k.length!==0){E.layers=k,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(L=>k.filter(N=>N.id===L)[0]));for(const L of k)v[L.id]=E}}return v}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof uu){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof uu&&_.hasRTLText){this.hasRTLText=!0,O.isLoading()||O.isLoaded()||M()!=="deferred"||D();break}}this.queryPadding=0;for(const d in this.buckets){const _=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(d).queryRadius(_))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new Ps}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const d=this.buckets[c];d.uploadPending()&&d.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ng(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ng(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ng(t,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,c,d,_,v,E,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:d,pixelPosMatrix:E,transform:v,params:_,tileTransform:this.tileTransform},t,n,c):{}}querySourceFeatures(t,n){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const d=c.loadVTLayers(),_=n?n.sourceLayer:"",v=d._geojsonTileLayer||d[_];if(!v)return;const E=Fh(n&&n.filter),{z:k,x:L,y:N}=this.tileID.canonical,V={z:k,x:L,y:N};for(let W=0;W<v.length;W++){const Y=v.feature(W);if(E.needGeometry){const ut=Xc(Y,!0);if(!E.filter(new j(this.tileID.overscaledZ),ut,this.tileID.canonical))continue}else if(!E.filter(new j(this.tileID.overscaledZ),Y))continue;const K=c.getId(Y,_),st=new L1(Y,k,L,N,K);st.tile=V,t.push(st)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const c=We(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let d=!1;if(this.expirationTime>c)d=!1;else if(n)if(this.expirationTime<n)d=!0;else{const _=this.expirationTime-n;_?this.expirationTime=c+Math.max(_,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0||!n)return;const c=this.latestFeatureIndex.loadVTLayers(),d=n.style.listImages();for(const _ in this.buckets){if(!n.style.hasLayer(_))continue;const v=this.buckets[_],E=v.layers[0].sourceLayer||"_geojsonTileLayer",k=c[E],L=t[E];if(!k||!L||Object.keys(L).length===0)continue;if(v.update(L,k,d,this.imageAtlas&&this.imageAtlas.patternPositions||{}),v instanceof it||v instanceof Wd){const V=n.style._getSourceCache(v.layers[0].source);n._terrain&&n._terrain.enabled&&V&&v.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(V.id,this.tileID)}const N=n&&n.style&&n.style.getLayer(_);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<To.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=To.now()+t}setTexture(t,n){const c=n.context,d=c.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new ng(c,t,d.RGBA,{useMipmap:!0}),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE))}setDependencies(t,n){const c={};for(const d of n)c[d]=!0;this.dependencies[t]=c}hasDependency(t,n){for(const c of t){const d=this.dependencies[c];if(d){for(const _ of n)if(d[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const c=fa(O1,this.tileID.canonical,this.tileTransform)[0],d=new ke,_=new Vr;for(let v=0;v<c.length;v++){const{x:E,y:k}=c[v];d.emplaceBack(E,k),_.emplaceBack(v)}_.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(_),this._tileDebugBuffer=t.createVertexBuffer(d,Oo.members),this._tileDebugSegments=yn.simpleSegment(0,0,d.length,_.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const c=fa(O1,this.tileID.canonical,this.tileTransform)[0];let d,_;if(this.isRaster){const v=function(E,k){const L=tf(E,k),N=Math.pow(2,E.z);for(let ut=0;ut<rc;ut++)for(let vt=0;vt<rc;vt++){const Pt=fo((E.x+(vt+D1(vt))/za)/N),bt=cr((E.y+(ut+D1(ut))/za)/N),Ct=k.project(Pt,bt),Ft=ut*rc+vt;oc[2*Ft+0]=Math.round((Ct.x*L.scale-L.x)*gi),oc[2*Ft+1]=Math.round((Ct.y*L.scale-L.y)*gi)}fu.fill(0),dy.fill(0);for(let ut=2045;ut>=0;ut--){const vt=4*ut,Pt=du[vt+0],bt=du[vt+1],Ct=du[vt+2],Ft=du[vt+3],Ot=Pt+Ct>>1,he=bt+Ft>>1,oe=Ot+he-bt,_e=he+Pt-Ot,Re=bt*rc+Pt,de=Ft*rc+Ct,we=he*rc+Ot,Te=Math.hypot((oc[2*Re+0]+oc[2*de+0])/2-oc[2*we+0],(oc[2*Re+1]+oc[2*de+1])/2-oc[2*we+1])>=16;fu[we]=fu[we]||(Te?1:0),ut<1022&&(fu[we]=fu[we]||fu[(bt+_e>>1)*rc+(Pt+oe>>1)]||fu[(Ft+_e>>1)*rc+(Ct+oe>>1)])}const V=new xe,W=new mi;let Y=0;function K(ut,vt){const Pt=vt*rc+ut;return dy[Pt]===0&&(V.emplaceBack(oc[2*Pt+0],oc[2*Pt+1],ut*gi/za,vt*gi/za),dy[Pt]=++Y),dy[Pt]-1}function st(ut,vt,Pt,bt,Ct,Ft){const Ot=ut+Pt>>1,he=vt+bt>>1;if(Math.abs(ut-Ct)+Math.abs(vt-Ft)>1&&fu[he*rc+Ot])st(Ct,Ft,ut,vt,Ot,he),st(Pt,bt,Ct,Ft,Ot,he);else{const oe=K(ut,vt),_e=K(Pt,bt),Re=K(Ct,Ft);W.emplaceBack(oe,_e,Re)}}return st(0,0,za,za,za,0),st(za,za,0,0,0,za),{vertices:V,indices:W}}(this.tileID.canonical,n);d=v.vertices,_=v.indices}else{d=new xe,_=new mi;for(const{x:E,y:k}of c)d.emplaceBack(E,k,0,0);const v=$m(d.int16,void 0,4);for(let E=0;E<v.length;E+=3)_.emplaceBack(v[E],v[E+1],v[E+2])}this._tileBoundsBuffer=t.createVertexBuffer(d,z1.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(_),this._tileBoundsSegments=yn.simpleSegment(0,0,d.length,_.length)}_makeGlobeTileDebugBuffers(t,n){const c=n.projection;if(!c||c.name!=="globe"||n.freezeTileCoverage)return;const d=this.tileID.canonical,_=Hc(km(d,n)),v=Jh(n.zoom);let E;v>0&&(E=Kf(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,d,n,_,E,v),this._makeGlobeTileDebugTextBuffer(t,d,n,_,E,v)}_globePoint(t,n,c,d,_,v,E){let k=Ld(t,n,c);if(v){const L=1<<c.z,N=ua(d.center.lng),V=Bo(d.center.lat),W=(c.x+.5)/L-N;let Y=0;W>.5?Y=-1:W<-.5&&(Y=1);let K=(t/gi+c.x)/L+Y,st=(n/gi+c.y)/L;K=(K-N)*d._pixelsPerMercatorPixel+N,st=(st-V)*d._pixelsPerMercatorPixel+V;const ut=[K*d.worldSize,st*d.worldSize,0];rn(ut,ut,v),k=ha(k,ut,E)}return rn(k,k,_)}_makeGlobeTileDebugBorderBuffer(t,n,c,d,_,v){const E=new ke,k=new Vr,L=new se,N=(W,Y,K,st,ut)=>{const vt=(K-W)/(ut-1),Pt=(st-Y)/(ut-1),bt=E.length;for(let Ct=0;Ct<ut;Ct++){const Ft=W+Ct*vt,Ot=Y+Ct*Pt;E.emplaceBack(Ft,Ot);const he=this._globePoint(Ft,Ot,n,c,d,_,v);L.emplaceBack(he[0],he[1],he[2]),k.emplaceBack(bt+Ct)}},V=gi;N(0,0,V,0,16),N(V,0,V,V,16),N(V,V,0,V,16),N(0,V,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(k),this._tileDebugBuffer=t.createVertexBuffer(E,Oo.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(L,x_.members),this._tileDebugSegments=yn.simpleSegment(0,0,E.length,k.length)}_makeGlobeTileDebugTextBuffer(t,n,c,d,_,v){const E=gi/4,k=new ke,L=new mi,N=new se,V=25;L.reserve(32),k.reserve(V),N.reserve(V);const W=(Y,K)=>V*Y+K;for(let Y=0;Y<V;Y++){const K=Y*E;for(let st=0;st<V;st++){const ut=st*E;k.emplaceBack(ut,K);const vt=this._globePoint(ut,K,n,c,d,_,v);N.emplaceBack(vt[0],vt[1],vt[2])}}for(let Y=0;Y<4;Y++)for(let K=0;K<4;K++){const st=W(Y,K),ut=W(Y,K+1),vt=W(Y+1,K),Pt=W(Y+1,K+1);L.emplaceBack(st,ut,vt),L.emplaceBack(vt,ut,Pt)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(L),this._tileDebugTextBuffer=t.createVertexBuffer(k,Oo.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(N,x_.members),this._tileDebugTextSegments=yn.simpleSegment(0,0,V,32)}}class wC{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,c){const d=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][d]=this.stateChanges[t][d]||{},Ji(this.stateChanges[t][d],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==d&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][d]===null){this.deletedStates[t][d]={};for(const _ in this.state[t][d])c[_]||(this.deletedStates[t][d][_]=null)}else for(const _ in c)this.deletedStates[t]&&this.deletedStates[t][d]&&this.deletedStates[t][d][_]===null&&delete this.deletedStates[t][d][_]}removeFeatureState(t,n,c){if(this.deletedStates[t]===null)return;const d=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&n!==void 0)this.deletedStates[t][d]!==null&&(this.deletedStates[t][d]=this.deletedStates[t][d]||{},this.deletedStates[t][d][c]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][d])for(c in this.deletedStates[t][d]={},this.stateChanges[t][d])this.deletedStates[t][d][c]=null;else this.deletedStates[t][d]=null;else this.deletedStates[t]=null}getState(t,n){const c=String(n),d=Ji({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const _=this.deletedStates[t][n];if(_===null)return{};for(const v in _)delete d[v]}return d}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const c={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const _={};for(const v in this.stateChanges[d])this.state[d][v]||(this.state[d][v]={}),Ji(this.state[d][v],this.stateChanges[d][v]),_[v]=this.state[d][v];c[d]=_}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const _={};if(this.deletedStates[d]===null)for(const v in this.state[d])_[v]={},this.state[d][v]={};else for(const v in this.deletedStates[d]){if(this.deletedStates[d][v]===null)this.state[d][v]={};else if(this.state[d][v])for(const E of Object.keys(this.deletedStates[d][v]))delete this.state[d][v][E];_[v]=this.state[d][v]}c[d]=c[d]||{},Ji(c[d],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const d in t)t[d].setFeatureState(c,n)}}class R1{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,n){const c=this.toIdx(t,n);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(t,n){return this.leaves[this.toIdx(t,n)]}toIdx(t,n){return n*this.size+t}}function B1(s,t,n,c){let d=0,_=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(c[v])<1e-15){if(n[v]<s[v]||n[v]>t[v])return null}else{const E=1/c[v];let k=(s[v]-n[v])*E,L=(t[v]-n[v])*E;if(k>L){const N=k;k=L,L=N}if(k>d&&(d=k),L<_&&(_=L),d>_)return null}return d}function F1(s,t,n,c,d,_,v,E,k,L,N){const V=c-s,W=d-t,Y=_-n,K=v-s,st=E-t,ut=k-n,vt=N[1]*ut-N[2]*st,Pt=N[2]*K-N[0]*ut,bt=N[0]*st-N[1]*K,Ct=V*vt+W*Pt+Y*bt;if(Math.abs(Ct)<1e-15)return null;const Ft=1/Ct,Ot=L[0]-s,he=L[1]-t,oe=L[2]-n,_e=(Ot*vt+he*Pt+oe*bt)*Ft;if(_e<0||_e>1)return null;const Re=he*Y-oe*W,de=oe*V-Ot*Y,we=Ot*W-he*V,Te=(N[0]*Re+N[1]*de+N[2]*we)*Ft;return Te<0||_e+Te>1?null:(K*Re+st*de+ut*we)*Ft}function N1(s,t,n){return(s-t)/(n-t)}function j1(s,t,n,c,d,_,v,E,k){const L=1<<n,N=_-c,V=v-d,W=(s+1)/L*N+c,Y=(t+0)/L*V+d,K=(t+1)/L*V+d;E[0]=(s+0)/L*N+c,E[1]=Y,k[0]=W,k[1]=K}class U1{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(_){const v=Math.ceil(Math.log2(_.dim/8)),E=[];let k=Math.ceil(Math.pow(2,v));const L=1/k,N=(Y,K,st,ut,vt)=>{const Pt=ut?1:0,bt=(Y+1)*st-Pt,Ct=K*st,Ft=(K+1)*st-Pt;vt[0]=Y*st,vt[1]=Ct,vt[2]=bt,vt[3]=Ft};let V=new R1(k);const W=[];for(let Y=0;Y<k*k;Y++){N(Y%k,Math.floor(Y/k),L,!1,W);const K=pu(W[0],W[1],_),st=pu(W[2],W[1],_),ut=pu(W[2],W[3],_),vt=pu(W[0],W[3],_);V.minimums.push(Math.min(K,st,ut,vt)),V.maximums.push(Math.max(K,st,ut,vt)),V.leaves.push(1)}for(E.push(V),k/=2;k>=1;k/=2){const Y=E[E.length-1];V=new R1(k);for(let K=0;K<k*k;K++){N(K%k,Math.floor(K/k),2,!0,W);const st=Y.getElevation(W[0],W[1]),ut=Y.getElevation(W[2],W[1]),vt=Y.getElevation(W[2],W[3]),Pt=Y.getElevation(W[0],W[3]),bt=Y.isLeaf(W[0],W[1]),Ct=Y.isLeaf(W[2],W[1]),Ft=Y.isLeaf(W[2],W[3]),Ot=Y.isLeaf(W[0],W[3]),he=Math.min(st.min,ut.min,vt.min,Pt.min),oe=Math.max(st.max,ut.max,vt.max,Pt.max),_e=bt&&Ct&&Ft&&Ot;V.maximums.push(oe),V.minimums.push(he),V.leaves.push(oe-he<=5&&_e?1:0)}E.push(V)}return E}(this.dem),c=n.length-1,d=n[c];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(n,0,0,c,0)}raycastRoot(t,n,c,d,_,v,E=1){return B1([t,n,-100],[c,d,this.maximums[0]*E],_,v)}raycast(t,n,c,d,_,v,E=1){if(!this.nodeCount)return null;const k=this.raycastRoot(t,n,c,d,_,v,E);if(k==null)return null;const L=[],N=[],V=[],W=[],Y=[{idx:0,t:k,nodex:0,nodey:0,depth:0}];for(;Y.length>0;){const{idx:K,t:st,nodex:ut,nodey:vt,depth:Pt}=Y.pop();if(this.leaves[K]){j1(ut,vt,Pt,t,n,c,d,V,W);const Ct=1<<Pt,Ft=(ut+0)/Ct,Ot=(ut+1)/Ct,he=(vt+0)/Ct,oe=(vt+1)/Ct,_e=pu(Ft,he,this.dem)*E,Re=pu(Ot,he,this.dem)*E,de=pu(Ot,oe,this.dem)*E,we=pu(Ft,oe,this.dem)*E,Te=F1(V[0],V[1],_e,W[0],V[1],Re,W[0],W[1],de,_,v),Pe=F1(W[0],W[1],de,V[0],W[1],we,V[0],V[1],_e,_,v),Ne=Math.min(Te!==null?Te:Number.MAX_VALUE,Pe!==null?Pe:Number.MAX_VALUE);if(Ne!==Number.MAX_VALUE)return Ne;{const me=Ed([],_,v,st);if(V1(_e,Re,we,de,N1(me[0],V[0],W[0]),N1(me[1],V[1],W[1]))>=me[2])return st}continue}let bt=0;for(let Ct=0;Ct<this._siblingOffset.length;Ct++){j1((ut<<1)+this._siblingOffset[Ct][0],(vt<<1)+this._siblingOffset[Ct][1],Pt+1,t,n,c,d,V,W),V[2]=-100,W[2]=this.maximums[this.childOffsets[K]+Ct]*E;const Ft=B1(V,W,_,v);if(Ft!=null){const Ot=Ft;L[Ct]=Ot;let he=!1;for(let oe=0;oe<bt&&!he;oe++)Ot>=L[N[oe]]&&(N.splice(oe,0,Ct),he=!0);he||(N[bt]=Ct),bt++}}for(let Ct=0;Ct<bt;Ct++){const Ft=N[Ct];Y.push({idx:this.childOffsets[K]+Ft,t:L[Ft],nodex:(ut<<1)+this._siblingOffset[Ft][0],nodey:(vt<<1)+this._siblingOffset[Ft][1],depth:Pt+1})}}return null}_addNode(t,n,c){return this.minimums.push(t),this.maximums.push(n),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(t,n,c,d,_){if(t[d].isLeaf(n,c)===1)return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const v=d-1,E=t[v];let k=0,L=0;for(let N=0;N<this._siblingOffset.length;N++){const V=2*n+this._siblingOffset[N][0],W=2*c+this._siblingOffset[N][1],Y=E.getElevation(V,W),K=E.isLeaf(V,W),st=this._addNode(Y.min,Y.max,K);K&&(k|=1<<N),L||(L=st)}for(let N=0;N<this._siblingOffset.length;N++)k&1<<N||this._construct(t,2*n+this._siblingOffset[N][0],2*c+this._siblingOffset[N][1],v,L+N)}}function V1(s,t,n,c,d,_){return rs(rs(s,n,_),rs(t,c,_),d)}function pu(s,t,n){const c=n.dim,d=pi(s*c-.5,0,c-1),_=pi(t*c-.5,0,c-1),v=Math.floor(d),E=Math.floor(_),k=Math.min(v+1,c-1),L=Math.min(E+1,c-1);return V1(n.get(v,E),n.get(k,E),n.get(v,L),n.get(k,L),d-v,_-E)}const $1={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function TC(s,t,n){return(256*s*256+256*t+n)/10-1e4}function SC(s,t,n){return 256*s+t+n/256-32768}class fy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,n,c,d=!1,_=!1){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return Se(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const v=this.dim=n.height-2,E=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=c||"mapbox",this.borderReady=d,!d){for(let k=0;k<v;k++)E[this._idx(-1,k)]=E[this._idx(0,k)],E[this._idx(v,k)]=E[this._idx(v-1,k)],E[this._idx(k,-1)]=E[this._idx(k,0)],E[this._idx(k,v)]=E[this._idx(k,v-1)];E[this._idx(-1,-1)]=E[this._idx(0,0)],E[this._idx(v,-1)]=E[this._idx(v-1,0)],E[this._idx(-1,v)]=E[this._idx(0,v-1)],E[this._idx(v,v)]=E[this._idx(v-1,v-1)],_&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new U1(this)}get(t,n,c=!1){c&&(t=pi(t,-1,this.dim),n=pi(n,-1,this.dim));const d=4*this._idx(t,n);return(this.encoding==="terrarium"?SC:TC)(this.pixels[d],this.pixels[d+1],this.pixels[d+2])}static getUnpackVector(t){return $1[t]}get unpackVector(){return $1[this.encoding]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}static pack(t,n){const c=[0,0,0,0],d=fy.getUnpackVector(n);let _=Math.floor((t+d[3])/d[2]);return c[2]=_%256,_=Math.floor(_/256),c[1]=_%256,_=Math.floor(_/256),c[0]=_,c}getPixels(){return new Hr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,n,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let d=n*this.dim,_=n*this.dim+this.dim,v=c*this.dim,E=c*this.dim+this.dim;switch(n){case-1:d=_-1;break;case 1:_=d+1}switch(c){case-1:v=E-1;break;case 1:E=v+1}const k=-n*this.dim,L=-c*this.dim;for(let N=v;N<E;N++)for(let V=d;V<_;V++){const W=4*this._idx(V,N),Y=4*this._idx(V+k,N+L);this.pixels[W+0]=t.pixels[Y+0],this.pixels[W+1]=t.pixels[Y+1],this.pixels[W+2]=t.pixels[Y+2],this.pixels[W+3]=t.pixels[Y+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}oi(fy,"DEMData"),oi(U1,"DemMinMaxQuadTree",{omit:["dem"]});class EC{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,c){const d=t.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const _={value:n,timeout:void 0};if(c!==void 0&&(_.timeout=setTimeout(()=>{this.remove(t,_)},c)),this.data[d].push(_),this.order.push(d),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const c=t.wrapped().key,d=n===void 0?0:this.data[c].indexOf(n),_=this.data[c][d];return this.data[c].splice(d,1),_.timeout&&clearTimeout(_.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(_.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const c in this.data)for(const d of this.data[c])t(d.value)||n.push(d);for(const c of n)this.remove(c.value.tileID,c)}}class Cp{constructor(t,n,c){this.func=t,this.mask=n,this.range=c}}Cp.ReadOnly=!1,Cp.ReadWrite=!0,Cp.disabled=new Cp(519,Cp.ReadOnly,[0,1]);const U0=7680;class V0{constructor(t,n,c,d,_,v){this.test=t,this.ref=n,this.mask=c,this.fail=d,this.depthFail=_,this.pass=v}}V0.disabled=new V0({func:519,mask:0},0,0,U0,U0,U0);class ac{constructor(t,n,c){this.blendFunction=t,this.blendColor=n,this.mask=c}}ac.Replace=[1,0],ac.disabled=new ac(ac.Replace,gn.transparent,[!1,!1,!1,!1]),ac.unblended=new ac(ac.Replace,gn.transparent,[!0,!0,!0,!0]),ac.alphaBlended=new ac([1,771],gn.transparent,[!0,!0,!0,!0]);const $0=1029,G0=2305;class gl{constructor(t,n,c){this.enable=t,this.mode=n,this.frontFace=c}}gl.disabled=new gl(!1,$0,G0),gl.backCCW=new gl(!0,$0,G0),gl.backCW=new gl(!0,$0,2304),gl.frontCW=new gl(!0,1028,2304),gl.frontCCW=new gl(!0,1028,G0);class ef extends Is{constructor(t,n,c){super(),this.id=t,this._onlySymbols=c,n.on("data",d=>{d.dataType==="source"&&d.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&d.dataType==="source"&&d.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new EC(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new wC,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,n){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const c=this._tiles[n];c.upload(t),c.prepare(this.map.style.imageManager)}}getIds(){return Zs(this._tiles).map(t=>t.tileID).sort(G1).map(t=>t.key)}getRenderableIds(t){const n=[];for(const c in this._tiles)this._isIdRenderable(+c,t)&&n.push(this._tiles[c]);return t?n.sort((c,d)=>{const _=c.tileID,v=d.tileID,E=new Ut(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),k=new Ut(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-v.overscaledZ||k.y-E.y||k.x-E.x}).map(c=>c.tileID.key):n.map(c=>c.tileID).sort(G1).map(c=>c.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,n){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=n),this._loadTile(c,this._tileLoaded.bind(this,c,t,n)))}_tileLoaded(t,n,c,d){if(d)if(t.state="errored",d.status!==404)this._source.fire(new qo(d,{tile:t}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=To.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new So("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const n=this.getRenderableIds();for(let d=0;d<n.length;d++){const _=n[d];if(t.neighboringTiles&&t.neighboringTiles[_]){const v=this.getTileByID(_);c(t,v),c(v,t)}}function c(d,_){if(!d.dem||d.dem.borderReady)return;d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0;let v=_.tileID.canonical.x-d.tileID.canonical.x;const E=_.tileID.canonical.y-d.tileID.canonical.y,k=Math.pow(2,d.tileID.canonical.z),L=_.tileID.key;v===0&&E===0||Math.abs(E)>1||(Math.abs(v)>1&&(Math.abs(v+k)===1?v+=k:Math.abs(v-k)===1&&(v-=k)),_.dem&&d.dem&&(d.dem.backfillBorder(_.dem,v,E),d.neighboringTiles&&d.neighboringTiles[L]&&(d.neighboringTiles[L].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,c,d){for(const _ in this._tiles){let v=this._tiles[_];if(d[_]||!v.hasData()||v.tileID.overscaledZ<=n||v.tileID.overscaledZ>c)continue;let E=v.tileID;for(;v&&v.tileID.overscaledZ>n+1;){const L=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[L.key],v&&v.hasData()&&(E=L)}let k=E;for(;k.overscaledZ>n;)if(k=k.scaledTo(k.overscaledZ-1),t[k.key]){d[E.key]=E;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=n?c:null}for(let c=t.overscaledZ-1;c>=n;c--){const d=t.scaledTo(c),_=this._getLoadedTile(d);if(_)return _}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,n){n=n||this._source.tileSize;const c=Math.ceil(t.width/n)+1,d=Math.ceil(t.height/n)+1,_=Math.floor(c*d*5),v=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(E)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const c={};for(const d in this._tiles){const _=this._tiles[d];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+n),c[_.tileID.key]=_}this._tiles=c;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(+d,this._tiles[d])}}update(t,n,c){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let d;this.updateCacheSize(t,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(E=>new w(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y)):(d=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(d=d.filter(E=>this._source.hasTile(E)))):d=[];const _=this._updateRetainedTiles(d);if(W1(this._source.type)&&d.length!==0){const E={},k={},L=Object.keys(_);for(const V of L){const W=_[V],Y=this._tiles[V];if(!Y||Y.fadeEndTime&&Y.fadeEndTime<=To.now())continue;const K=this.findLoadedParent(W,Math.max(W.overscaledZ-ef.maxOverzooming,this._source.minzoom));K&&(this._addTile(K.tileID),E[K.tileID.key]=K.tileID),k[V]=W}const N=d[d.length-1].overscaledZ;for(const V in this._tiles){const W=this._tiles[V];if(_[V]||!W.hasData())continue;let Y=W.tileID;for(;Y.overscaledZ>N;){Y=Y.scaledTo(Y.overscaledZ-1);const K=this._tiles[Y.key];if(K&&K.hasData()&&k[Y.key]){_[V]=W.tileID;break}}}for(const V in E)_[V]||(this._coveredTiles[V]=!0,_[V]=E[V])}for(const E in _)this._tiles[E].clearFadeHold();const v=function(E,k){const L=[];for(const N in E)N in k||L.push(N);return L}(this._tiles,_);for(const E of v){const k=this._tiles[E];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(+E)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const n={};if(t.length===0)return n;const c={},d=t.reduce((L,N)=>Math.min(L,N.overscaledZ),1/0),_=t[0].overscaledZ,v=Math.max(_-ef.maxOverzooming,this._source.minzoom),E=Math.max(_+ef.maxUnderzooming,this._source.minzoom),k={};for(const L of t){const N=this._addTile(L);n[L.key]=L,N.hasData()||d<this._source.maxzoom&&(k[L.key]=L)}this._retainLoadedChildren(k,d,E,n);for(const L of t){let N=this._tiles[L.key];if(N.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const W=L.children(this._source.maxzoom)[0],Y=this.getTile(W);if(Y&&Y.hasData()){n[W.key]=W;continue}}else{const W=L.children(this._source.maxzoom);if(n[W[0].key]&&n[W[1].key]&&n[W[2].key]&&n[W[3].key])continue}let V=N.wasRequested();for(let W=L.overscaledZ-1;W>=v;--W){const Y=L.scaledTo(W);if(c[Y.key]||(c[Y.key]=!0,N=this.getTile(Y),!N&&V&&(N=this._addTile(Y)),N&&(n[Y.key]=Y,V=N.wasRequested(),N.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let c,d=this._tiles[t].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){c=this._loadedParentTiles[d.key];break}n.push(d.key);const _=d.scaledTo(d.overscaledZ-1);if(c=this._getLoadedTile(_),c)break;d=_}for(const _ of n)this._loadedParentTiles[_]=c}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const c=!!n;if(!c){const d=this.map?this.map.painter:null;n=new j0(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,d,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n?(n.uses++,this._tiles[t.key]=n,c||this._source.fire(new So("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=n.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,c){const d=[],_=this.transform;if(!_)return d;const v=_.projection.name==="globe",E=ua(_.center.lng);for(const k in this._tiles){const L=this._tiles[k];if(c&&L.clearQueryDebugViz(),L.holdingForFade())continue;let N;if(v){const V=L.tileID.canonical;if(V.z===0){const W=[Math.abs(pi(E,...rg(V,-1))-E),Math.abs(pi(E,...rg(V,1))-E)];N=[0,2*W.indexOf(Math.min(...W))-1]}else{const W=[Math.abs(pi(E,...rg(V,-1))-E),Math.abs(pi(E,...rg(V,0))-E),Math.abs(pi(E,...rg(V,1))-E)];N=[W.indexOf(Math.min(...W))-1]}}else N=[0];for(const V of N){const W=t.containsTile(L,_,n,V);W&&d.push(W)}}return d}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(c=>this._tiles[c].tileID);for(const c of n)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(W1(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=To.now())return!0}return!1}setFeatureState(t,n,c){this._state.updateState(t=t||"_geojsonTileLayer",n,c)}removeFeatureState(t,n,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,c)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,c){const d=this._tiles[t];d&&d.setDependencies(n,c)}reloadTilesForDependencies(t,n){for(const c in this._tiles)this._tiles[c].hasDependency(t,n)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(t,n))}_preloadTiles(t,n){if(!this._sourceLoaded){const E=()=>{this._sourceLoaded&&(this._source.off("data",E),this._preloadTiles(t,n))};return void this._source.on("data",E)}const c=new Map,d=Array.isArray(t)?t:[t],_=this.map.painter.terrain,v=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const E of d){const k=E.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of k)c.set(L.key,L);this.usedForTerrain&&E.updateElevation(!1)}Yi(Array.from(c.values()),(E,k)=>{const L=new j0(E,this._source.tileSize*E.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(L,N=>{this._source.type==="raster-dem"&&L.dem&&this._backfillDEM(L),k(N,L)})},n)}}function G1(s,t){const n=Math.abs(2*s.wrap)-+(s.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return s.overscaledZ-t.overscaledZ||c-n||t.canonical.y-s.canonical.y||t.canonical.x-s.canonical.x}function W1(s){return s==="raster"||s==="image"||s==="video"||s==="custom"}function rg(s,t){const n=1<<s.z;return[s.x/n+t,(s.x+1)/n+t]}ef.maxOverzooming=10,ef.maxUnderzooming=3;class py{constructor(t,n,c){this._demTile=t,this._dem=this._demTile.dem,this._scale=n,this._offset=c}static create(t,n,c){const d=c||t.findDEMTileFor(n);if(!d||!d.dem)return;const _=d.dem,v=d.tileID,E=1<<n.canonical.z-v.canonical.z;return new py(d,d.tileSize/gi/E,[(n.canonical.x/E-v.canonical.x)*_.dim,(n.canonical.y/E-v.canonical.y)*_.dim])}tileCoordToPixel(t,n){const c=n*this._scale+this._offset[1],d=Math.floor(t*this._scale+this._offset[0]),_=Math.floor(c);return new Ut(d,_)}getElevationAt(t,n,c,d){const _=t*this._scale+this._offset[0],v=n*this._scale+this._offset[1],E=Math.floor(_),k=Math.floor(v),L=this._dem;return d=!!d,c?rs(rs(L.get(E,k,d),L.get(E,k+1,d),v-k),rs(L.get(E+1,k,d),L.get(E+1,k+1,d),v-k),_-E):L.get(E,k,d)}getElevationAtPixel(t,n,c){return this._dem.get(t,n,!!c)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*da(1,t)*this._dem.stride}}class H1{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new rl(gi,16,0),this.featureIndexArray=new ql,this.promoteId=n}insert(t,n,c,d,_,v=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,d,_,v);const k=this.grid;for(let L=0;L<n.length;L++){const N=n[L],V=[1/0,1/0,-1/0,-1/0];for(let W=0;W<N.length;W++){const Y=N[W];V[0]=Math.min(V[0],Y.x),V[1]=Math.min(V[1],Y.y),V[2]=Math.max(V[2],Y.x),V[3]=Math.max(V[3],Y.y)}V[0]<gi&&V[1]<gi&&V[2]>=0&&V[3]>=0&&k.insert(E,V[0],V[1],V[2],V[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Zm(new Q_(this.rawTileData)).layers,this.sourceLayerCoder=new I1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,n,c,d){this.loadVTLayers();const _=t.params||{},v=Fh(_.filter),E=t.tileResult,k=t.transform,L=E.bufferedTilespaceBounds,N=this.grid.query(L.min.x,L.min.y,L.max.x,L.max.y,(K,st,ut,vt)=>Fd(E.bufferedTilespaceGeometry,K,st,ut,vt));N.sort(MC);let V=null;k.elevation&&N.length>0&&(V=py.create(k.elevation,this.tileID));const W={};let Y;for(let K=0;K<N.length;K++){const st=N[K];if(st===Y)continue;Y=st;const ut=this.featureIndexArray.get(st);let vt=null;this.loadMatchingFeature(W,ut,v,_.layers,_.availableImages,n,c,d,(Pt,bt,Ct,Ft=0)=>(vt||(vt=fa(Pt,this.tileID.canonical,t.tileTransform)),bt.queryIntersectsFeature(E,Pt,Ct,vt,this.z,t.transform,t.pixelPosMatrix,V,Ft)))}return W}loadMatchingFeature(t,n,c,d,_,v,E,k,L){const{featureIndex:N,bucketIndex:V,sourceLayerIndex:W,layoutVertexArrayOffset:Y}=n,K=this.bucketLayerIDs[V];if(d&&!function(Pt,bt){for(let Ct=0;Ct<Pt.length;Ct++)if(bt.indexOf(Pt[Ct])>=0)return!0;return!1}(d,K))return;const st=this.sourceLayerCoder.decode(W),ut=this.vtLayers[st].feature(N);if(c.needGeometry){const Pt=Xc(ut,!0);if(!c.filter(new j(this.tileID.overscaledZ),Pt,this.tileID.canonical))return}else if(!c.filter(new j(this.tileID.overscaledZ),ut))return;const vt=this.getId(ut,st);for(let Pt=0;Pt<K.length;Pt++){const bt=K[Pt];if(d&&d.indexOf(bt)<0)continue;const Ct=v[bt];if(!Ct)continue;let Ft={};vt!==void 0&&k&&(Ft=k.getState(Ct.sourceLayer||"_geojsonTileLayer",vt));const Ot=Ji({},E[bt]);Ot.paint=X1(Ot.paint,Ct.paint,ut,Ft,_),Ot.layout=X1(Ot.layout,Ct.layout,ut,Ft,_);const he=!L||L(ut,Ct,Ft,Y);if(!he)continue;const oe=new L1(ut,this.z,this.x,this.y,vt);oe.layer=Ot;let _e=t[bt];_e===void 0&&(_e=t[bt]=[]),_e.push({featureIndex:N,feature:oe,intersectionZ:he})}}lookupSymbolFeatures(t,n,c,d,_,v,E,k){const L={};this.loadVTLayers();const N=Fh(_);for(const V of t)this.loadMatchingFeature(L,{bucketIndex:c,sourceLayerIndex:d,featureIndex:V,layoutVertexArrayOffset:0},N,v,E,k,n);return L}loadFeature(t){const{featureIndex:n,sourceLayerIndex:c}=t;this.loadVTLayers();const d=this.sourceLayerCoder.decode(c),_=this.vtFeatures[d];if(_[n])return _[n];const v=this.vtLayers[d].feature(n);return _[n]=v,v}hasLayer(t){for(const n of this.bucketLayerIDs)for(const c of n)if(t===c)return!0;return!1}getId(t,n){let c=t.id;if(this.promoteId){const d=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];d!=null&&(c=t.properties[d]),typeof c=="boolean"&&(c=Number(c))}return c}}function X1(s,t,n,c,d){return xi(s,(_,v)=>{const E=t instanceof xt?t.get(v):null;return E&&E.evaluate?E.evaluate(n,c,d):E})}function MC(s,t){return t-s}oi(H1,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class q1{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.image=new pl({width:t,height:n}),this.positions={},this.uploaded=!1}getDash(t,n){const c=this.getKey(t,n);return this.positions[c]}trim(){const t=this.width,n=this.height=ci(this.nextRow);this.image.resize({width:t,height:n})}getKey(t,n){return t.join(",")+n}getDashRanges(t,n,c){const d=[];let _=t.length%2==1?-t[t.length-1]*c:0,v=t[0]*c,E=!0;d.push({left:_,right:v,isDash:E,zeroLength:t[0]===0});let k=t[0];for(let L=1;L<t.length;L++){E=!E;const N=t[L];_=k*c,k+=N,v=k*c,d.push({left:_,right:v,isDash:E,zeroLength:N===0})}return d}addRoundDash(t,n,c){const d=n/2;for(let _=-c;_<=c;_++){const v=this.width*(this.nextRow+c+_);let E=0,k=t[E];for(let L=0;L<this.width;L++){L/k.right>1&&(k=t[++E]);const N=Math.abs(L-k.left),V=Math.abs(L-k.right),W=Math.min(N,V);let Y;const K=_/c*(d+1);if(k.isDash){const st=d-Math.abs(K);Y=Math.sqrt(W*W+st*st)}else Y=d-Math.sqrt(W*W+K*K);this.image.data[v+L]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(t,n){for(let k=t.length-1;k>=0;--k){const L=t[k],N=t[k+1];L.zeroLength?t.splice(k,1):N&&N.isDash===L.isDash&&(N.left=L.left,t.splice(k,1))}const c=t[0],d=t[t.length-1];c.isDash===d.isDash&&(c.left=d.left-this.width,d.right=c.right+this.width);const _=this.width*this.nextRow;let v=0,E=t[v];for(let k=0;k<this.width;k++){k/E.right>1&&(E=t[++v]);const L=Math.abs(k-E.left),N=Math.abs(k-E.right),V=Math.min(L,N);this.image.data[_+k]=Math.max(0,Math.min(255,(E.isDash?V:-V)+n+128))}}addDash(t,n){const c=this.getKey(t,n);if(this.positions[c])return this.positions[c];const d=n==="round",_=d?7:0,v=2*_+1;if(this.nextRow+v>this.height)return Se("LineAtlas out of space"),null;t.length===0&&t.push(1);let E=0;for(let N=0;N<t.length;N++)t[N]<0&&(Se("Negative value is found in line dasharray, replacing values with 0"),t[N]=0),E+=t[N];if(E!==0){const N=this.width/E,V=this.getDashRanges(t,this.width,N);d?this.addRoundDash(V,N,_):this.addRegularDash(V,n==="square"?.5*N:0)}const k=this.nextRow+_;this.nextRow+=v;const L={tl:[k,_],br:[E,0]};return this.positions[c]=L,L}}oi(q1,"LineAtlas");const Z1=1*ml;class Y1{constructor(t){const n={},c=[];for(const E in t){const k=t[E],L=n[E]={};for(const N in k.glyphs){const V=k.glyphs[+N];if(!V||V.bitmap.width===0||V.bitmap.height===0)continue;const W=V.metrics.localGlyph?Z1:1,Y={x:0,y:0,w:V.bitmap.width+2*W,h:V.bitmap.height+2*W};c.push(Y),L[N]=Y}}const{w:d,h:_}=C0(c),v=new pl({width:d||1,height:_||1});for(const E in t){const k=t[E];for(const L in k.glyphs){const N=k.glyphs[+L];if(!N||N.bitmap.width===0||N.bitmap.height===0)continue;const V=n[E][L],W=N.metrics.localGlyph?Z1:1;pl.copy(N.bitmap,v,{x:0,y:0},{x:V.x+W,y:V.y+W},N.bitmap)}}this.image=v,this.positions=n}}oi(Y1,"GlyphAtlas");class AC{constructor(t){this.tileID=new w(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=tf(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,n,c,d,_){this.status="parsing",this.data=t,this.collisionBoxArray=new Ps;const v=new I1(Object.keys(t.layers).sort()),E=new H1(this.tileID,this.promoteId);E.bucketLayerIDs=[];const k={},L=new q1(256,256),N={featureIndex:E,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:L,availableImages:c},V=n.familiesBySource[this.source];for(const Ft in V){const Ot=t.layers[Ft];if(!Ot)continue;let he=!1,oe=!1;for(const de of V[Ft])de[0].type==="symbol"?he=!0:oe=!0;if(this.isSymbolTile===!0&&!he||this.isSymbolTile===!1&&!oe)continue;Ot.version===1&&Se(`Vector tile source "${this.source}" layer "${Ft}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const _e=v.encode(Ft),Re=[];for(let de=0;de<Ot.length;de++){const we=Ot.feature(de),Te=E.getId(we,Ft);Re.push({feature:we,id:Te,index:de,sourceLayerIndex:_e})}for(const de of V[Ft]){const we=de[0];this.isSymbolTile!==void 0&&we.type==="symbol"!==this.isSymbolTile||we.minzoom&&this.zoom<Math.floor(we.minzoom)||we.maxzoom&&this.zoom>=we.maxzoom||we.visibility!=="none"&&(W0(de,this.zoom,c),(k[we.id]=we.createBucket({index:E.bucketLayerIDs.length,layers:de,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_e,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:c})).populate(Re,N,this.tileID.canonical,this.tileTransform),E.bucketLayerIDs.push(de.map(Te=>Te.id)))}}let W,Y,K,st;L.trim();const ut={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},vt=()=>{if(W)return _(W);if(Y&&K&&st){const Ft=new Y1(Y),Ot=new s1(K,st);for(const he in k){const oe=k[he];oe instanceof uu?(W0(oe.layers,this.zoom,c),QA(oe,Y,Ft.positions,K,Ot.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):oe.hasPattern&&(oe instanceof it||oe instanceof Wd||oe instanceof Zd)&&(W0(oe.layers,this.zoom,c),oe.addFeatures(N,this.tileID.canonical,Ot.patternPositions,c,this.tileTransform))}this.status="done",_(null,{buckets:Zs(k).filter(he=>!he.isEmpty()),featureIndex:E,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ft.image,lineAtlas:L,imageAtlas:Ot,glyphMap:this.returnDependencies?Y:null,iconMap:this.returnDependencies?K:null,glyphPositions:this.returnDependencies?Ft.positions:null})}},Pt=xi(N.glyphDependencies,Ft=>Object.keys(Ft).map(Number));Object.keys(Pt).length?d.send("getGlyphs",{uid:this.uid,stacks:Pt},(Ft,Ot)=>{W||(W=Ft,Y=Ot,vt())},void 0,!1,ut):Y={};const bt=Object.keys(N.iconDependencies);bt.length?d.send("getImages",{icons:bt,source:this.source,tileID:this.tileID,type:"icons"},(Ft,Ot)=>{W||(W=Ft,K=Ot,vt())},void 0,!1,ut):K={};const Ct=Object.keys(N.patternDependencies);Ct.length?d.send("getImages",{icons:Ct,source:this.source,tileID:this.tileID,type:"patterns"},(Ft,Ot)=>{W||(W=Ft,st=Ot,vt())},void 0,!1,ut):st={},vt()}}function W0(s,t,n){const c=new j(t);for(const d of s)d.recalculate(c,n)}class K1{constructor(t){this.entries={},this.scheduler=t}request(t,n,c,d){const _=this.entries[t]=this.entries[t]||{callbacks:[]};if(_.result){const[v,E]=_.result;return this.scheduler?this.scheduler.add(()=>{d(v,E)},n):d(v,E),()=>{}}return _.callbacks.push(d),_.cancel||(_.cancel=c((v,E)=>{_.result=[v,E];for(const k of _.callbacks)this.scheduler?this.scheduler.add(()=>{k(v,E)},n):k(v,E);setTimeout(()=>delete this.entries[t],3e3)})),()=>{_.result||(_.callbacks=_.callbacks.filter(v=>v!==d),_.callbacks.length||(_.cancel(),delete this.entries[t]))}}}function J1(s,t,n){const c=JSON.stringify(s.request);return s.data&&(this.deduped.entries[c]={result:[null,s.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},d=>{const _=Yn(s.request,(v,E,k,L)=>{v?d(v):E&&d(null,{vectorTile:n?void 0:new Zm(new Q_(E)),rawData:E,cacheControl:k,expires:L})});return()=>{_.cancel(),d()}},t)}const Q1=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class H0{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,c]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=c>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const _=Q1[15&c];if(!_)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(t,2,1),[E]=new Uint32Array(t,4,1);return new H0(E,v,_,t)}constructor(t,n=64,c=Float64Array,d){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const _=Q1.indexOf(this.ArrayType),v=2*t*this.ArrayType.BYTES_PER_ELEMENT,E=t*this.IndexArrayType.BYTES_PER_ELEMENT,k=(8-E%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${c}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+E+k,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+v+E+k),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+E+k,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=n,c}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return X0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,c,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:v,nodeSize:E}=this,k=[0,_.length-1,0],L=[];for(;k.length;){const N=k.pop()||0,V=k.pop()||0,W=k.pop()||0;if(V-W<=E){for(let ut=W;ut<=V;ut++){const vt=v[2*ut],Pt=v[2*ut+1];vt>=t&&vt<=c&&Pt>=n&&Pt<=d&&L.push(_[ut])}continue}const Y=W+V>>1,K=v[2*Y],st=v[2*Y+1];K>=t&&K<=c&&st>=n&&st<=d&&L.push(_[Y]),(N===0?t<=K:n<=st)&&(k.push(W),k.push(Y-1),k.push(1-N)),(N===0?c>=K:d>=st)&&(k.push(Y+1),k.push(V),k.push(1-N))}return L}within(t,n,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:_,nodeSize:v}=this,E=[0,d.length-1,0],k=[],L=c*c;for(;E.length;){const N=E.pop()||0,V=E.pop()||0,W=E.pop()||0;if(V-W<=v){for(let ut=W;ut<=V;ut++)ew(_[2*ut],_[2*ut+1],t,n)<=L&&k.push(d[ut]);continue}const Y=W+V>>1,K=_[2*Y],st=_[2*Y+1];ew(K,st,t,n)<=L&&k.push(d[Y]),(N===0?t-c<=K:n-c<=st)&&(E.push(W),E.push(Y-1),E.push(1-N)),(N===0?t+c>=K:n+c>=st)&&(E.push(Y+1),E.push(V),E.push(1-N))}return k}}function X0(s,t,n,c,d,_){if(d-c<=n)return;const v=c+d>>1;tw(s,t,v,c,d,_),X0(s,t,n,c,v-1,1-_),X0(s,t,n,v+1,d,1-_)}function tw(s,t,n,c,d,_){for(;d>c;){if(d-c>600){const L=d-c+1,N=n-c+1,V=Math.log(L),W=.5*Math.exp(2*V/3),Y=.5*Math.sqrt(V*W*(L-W)/L)*(N-L/2<0?-1:1);tw(s,t,n,Math.max(c,Math.floor(n-N*W/L+Y)),Math.min(d,Math.floor(n+(L-N)*W/L+Y)),_)}const v=t[2*n+_];let E=c,k=d;for(og(s,t,c,n),t[2*d+_]>v&&og(s,t,c,d);E<k;){for(og(s,t,E,k),E++,k--;t[2*E+_]<v;)E++;for(;t[2*k+_]>v;)k--}t[2*c+_]===v?og(s,t,c,k):(k++,og(s,t,k,d)),k<=n&&(c=k+1),n<=k&&(d=k-1)}}function og(s,t,n,c){q0(s,n,c),q0(t,2*n,2*c),q0(t,2*n+1,2*c+1)}function q0(s,t,n){const c=s[t];s[t]=s[n],s[n]=c}function ew(s,t,n,c){const d=s-n,_=t-c;return d*d+_*_}o.ARRAY_TYPE=$r,o.AUTH_ERR_MSG=jt,o.Aabb=Qn,o.Actor=class{constructor(s,t,n){this.target=s,this.parent=t,this.mapId=n,this.callbacks={},this.cancelCallbacks={},_i(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ei()?s:z,this.scheduler=new vC}send(s,t,n,c,d=!1,_){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=_,this.callbacks[v]=n);const E=Ve(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:s,hasCallback:!!n,targetMapId:c,mustQueue:d,sourceMapId:this.mapId,data:ol(t,E)},E),{cancel:()=>{n&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(s){const t=s.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){const c=this.cancelCallbacks[n];delete this.cancelCallbacks[n],c&&c.cancel()}else if(t.mustQueue||ei()){const c=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,t),c&&c.metadata||{type:"message"})}else this.processTask(n,t)}processTask(s,t){if(t.type==="<response>"){const n=this.callbacks[s];delete this.callbacks[s],n&&(t.error?n(Aa(t.error)):n(null,Aa(t.data)))}else{const n=Ve(this.globalScope)?void 0:[],c=t.hasCallback?(_,v)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:_?ol(_):null,data:ol(v,n)},n)}:_=>{},d=Aa(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,d,c);else if(this.parent.getWorkerSource){const _=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,_[0],d.source)[_[1]](d,c)}else c(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=g,o.Color=gn,o.ColorMode=ac,o.CullFaceMode=gl,o.DEMData=fy,o.DataConstantProperty=et,o.DedupedRequest=K1,o.DepthMode=Cp,o.EXTENT=gi,o.Elevation=class{isDataAvailableAtPoint(s){const t=this._source();if(this.isUsingMockSource()||!t||s.y<0||s.y>1)return!1;const n=t.getSource().maxzoom,c=1<<n,d=Math.floor(s.x),_=Math.floor((s.x-d)*c),v=Math.floor(s.y*c),E=this.findDEMTileFor(new w(n,d,n,_,v));return!(!E||!E.dem)}getAtPointOrZero(s,t=0){return this.getAtPoint(s,t)||0}getAtPoint(s,t,n=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const c=this._source();if(!c||s.y<0||s.y>1)return t;const d=c.getSource().maxzoom,_=1<<d,v=Math.floor(s.x),E=s.x-v,k=new w(d,v,d,Math.floor(E*_),Math.floor(s.y*_)),L=this.findDEMTileFor(k);if(!L||!L.dem)return t;const N=L.dem,V=1<<L.tileID.canonical.z,W=(E*V-L.tileID.canonical.x)*N.dim,Y=(s.y*V-L.tileID.canonical.y)*N.dim,K=Math.floor(W),st=Math.floor(Y);return(n?this.exaggeration():1)*rs(rs(N.get(K,st),N.get(K,st+1),Y-st),rs(N.get(K+1,st),N.get(K+1,st+1),Y-st),W-K)}getAtTileOffset(s,t,n){const c=1<<s.canonical.z;return this.getAtPointOrZero(new Qh(s.wrap+(s.canonical.x+t/gi)/c,(s.canonical.y+n/gi)/c))}getAtTileOffsetFunc(s,t,n,c){return d=>{const _=this.getAtTileOffset(s,d.x,d.y),v=c.upVector(s.canonical,d.x,d.y);return Gr(v,v,_*c.upVectorScale(s.canonical,t,n).metersToTile),v}}getForTilePoints(s,t,n,c){if(this.isUsingMockSource())return!1;const d=py.create(this,s,c);return!!d&&(t.forEach(_=>{_[2]=this.exaggeration()*d.getElevationAt(_[0],_[1],n)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(s);if(!t||!t.dem)return null;const n=t.dem.tree,c=t.tileID,d=1<<s.canonical.z-c.canonical.z;let _=s.canonical.x/d-c.canonical.x,v=s.canonical.y/d-c.canonical.y,E=0;for(let k=0;k<s.canonical.z-c.canonical.z&&!n.leaves[E];k++){_*=2,v*=2;const L=2*Math.floor(v)+Math.floor(_);E=n.childOffsets[E]+L,_%=1,v%=1}return{min:this.exaggeration()*n.minimums[E],max:this.exaggeration()*n.maximums[E]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,t,n){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=qo,o.EvaluationParameters=j,o.Event=So,o.Evented=Is,o.FillExtrusionBucket=Zd,o.Frustum=Pa,o.FrustumCorners=Cm,o.GLOBE_RADIUS=Ia,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=np,o.GLOBE_ZOOM_THRESHOLD_MIN=Cd,o.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_fillGridMeshWithLods(s,t){const n=new ke,c=new mi,d=[],_=s+1+2,v=t[0]+1,E=t[0]+1+(1+t.length),k=(L,N,V)=>{let W=L===_-1?L-2:L===0?L:L-1;return W+=V?24575:0,[W,N]};for(let L=0;L<_;++L)n.emplaceBack(...k(L,0,!0));for(let L=0;L<v;++L)for(let N=0;N<_;++N)n.emplaceBack(...k(N,L,(N===0||N===_-1)&&!0));for(let L=0;L<t.length;++L){const N=t[L];for(let V=0;V<_;++V)n.emplaceBack(...k(V,N,!0))}for(let L=0;L<t.length;++L){const N=c.length,V=t[L]+1+2,W=new mi;for(let st=0;st<V-1;st++){const ut=st===V-2,vt=ut?_*(E-t.length+L-st):_;for(let Pt=0;Pt<_-1;Pt++){const bt=st*_+Pt;st===0||ut||Pt===0||Pt===_-2?(W.emplaceBack(bt+1,bt,bt+vt),W.emplaceBack(bt+vt,bt+vt+1,bt+1)):(c.emplaceBack(bt+1,bt,bt+vt),c.emplaceBack(bt+vt,bt+vt+1,bt+1))}}const Y=yn.simpleSegment(0,N,n.length,c.length-N);for(let st=0;st<W.uint16.length;st+=3)c.emplaceBack(W.uint16[st],W.uint16[st+1],W.uint16[st+2]);const K=yn.simpleSegment(0,N,n.length,c.length-N);d.push({withoutSkirts:Y,withSkirts:K})}return{vertices:n,indices:c,segments:d}}_createGrid(s){const t=this._fillGridMeshWithLods(Ql,kd);this._gridSegments=t.segments,this._gridBuffer=s.createVertexBuffer(t.vertices,Oo.members),this._gridIndexBuffer=s.createIndexBuffer(t.indices,!0)}_createPoles(s){const t=new mi;for(let d=0;d<=Ql;d++)t.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=s.createIndexBuffer(t,!0);const n=new Ss,c=new Ss;this._poleSegments=[];for(let d=0,_=0;d<Cd;d++){const v=360/(1<<d);n.emplaceBack(0,-Ia,0,.5,0),c.emplaceBack(0,-Ia,0,.5,1);for(let E=0;E<=Ql;E++){const k=E/Ql,L=rs(0,v,k),[N,V,W]=Wc(e0,i0,L,Ia);n.emplaceBack(N,V,W,k,0),c.emplaceBack(N,V,W,k,1)}this._poleSegments.push(yn.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(n,y_,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(c,y_,!1)}getGridBuffers(s,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,t){if(!this._wireframeSegments){const n=new qn,c=Ql,d=c+1+2,_=1;this._wireframeSegments=[];for(let v=0,E=0;v<kd.length;v++){const k=kd[v];for(let N=_;N<k+_;N++)for(let V=_;V<c+_;V++){const W=N*d+V;n.emplaceBack(W,W+1),n.emplaceBack(W,W+d),n.emplaceBack(W,W+d+1)}const L=k*c*3;this._wireframeSegments.push(yn.simpleSegment(0,E,(k+1)*d,L)),E+=L}this._wireframeIndexBuffer=s.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},o.GlyphManager=Sp,o.ImagePosition=k0,o.KDBush=H0,o.LivePerformanceUtils=Ef,o.LngLat=Es,o.LngLatBounds=Jn,o.LocalGlyphMode=L0,o.MAX_MERCATOR_LATITUDE=po,o.MercatorCoordinate=Qh,o.ONE_EM=Ae,o.OverscaledTileID=w,o.PerformanceMarkers=mn,o.Point=Ut,o.Properties=Et,o.RGBAImage=Hr,o.Ray=Am,o.RequestManager=class{constructor(s,t,n){this._transformRequestFn=s,this._customAccessToken=t,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const s=function(){let t="";for(let n=0;n<10;n++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",wt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,t){return this._transformRequestFn&&this._transformRequestFn(s,t)||{url:s}}normalizeStyleURL(s,t){if(!Wt(s))return s;const n=He(s);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||t)}normalizeGlyphsURL(s,t){if(!Wt(s))return s;const n=He(s);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||t)}normalizeSourceURL(s,t,n,c){if(!Wt(s))return s;const d=He(s);return d.path=`/v4/${d.authority}.json`,d.params.push("secure"),n&&d.params.push(`language=${n}`),c&&d.params.push(`worldview=${c}`),this._makeAPIURL(d,this._customAccessToken||t)}normalizeSpriteURL(s,t,n,c){const d=He(s);return Wt(s)?(d.path=`/styles/v1${d.path}/sprite${t}${n}`,this._makeAPIURL(d,this._customAccessToken||c)):(d.path+=`${t}${n}`,ze(d))}normalizeTileURL(s,t,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Wt(s))return s;const c=He(s);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||n&&c.authority!=="raster"&&n===512?"@2x":""}${nt.supported?".webp":"$1"}`),c.authority==="raster"?c.path=`/${Q.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${Q.TILE_URL_VERSION}${c.path}`);const d=this._customAccessToken||function(_){for(const v of _){const E=v.match(/^access_token=(.*)$/);if(E)return E[1]}return null}(c.params)||Q.ACCESS_TOKEN;return Q.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,d)}canonicalizeTileURL(s,t){const n=He(s);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return s;let c="mapbox://";n.path.match(/^\/raster\/v1\//)?c+=`raster/${n.path.replace(`/${Q.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${n.path.replace(`/${Q.TILE_URL_VERSION}/`,"")}`;let d=n.params;return t&&(d=d.filter(_=>!_.match(/^access_token=/))),d.length&&(c+=`?${d.join("&")}`),c}canonicalizeTileset(s,t){const n=!!t&&Wt(t),c=[];for(const d of s.tiles||[])ie(d)?c.push(this.canonicalizeTileURL(d,n)):c.push(d);return c}_makeAPIURL(s,t){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",c=He(Q.API_URL);if(s.protocol=c.protocol,s.authority=c.authority,s.protocol==="http"){const d=s.params.indexOf("secure");d>=0&&s.params.splice(d,1)}if(c.path!=="/"&&(s.path=`${c.path}${s.path}`),!Q.REQUIRE_ACCESS_TOKEN)return ze(s);if(t=t||Q.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(t[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return s.params=s.params.filter(d=>d.indexOf("access_token")===-1),s.params.push(`access_token=${t||""}`),ze(s)}},o.ResourceType=fr,o.SegmentVector=yn,o.SourceCache=ef,o.StencilMode=V0,o.StructArrayLayout1ui2=Vr,o.StructArrayLayout2f1f2i16=vi,o.StructArrayLayout2i4=ke,o.StructArrayLayout2ui4=qn,o.StructArrayLayout3f12=Ri,o.StructArrayLayout3ui6=mi,o.StructArrayLayout4i8=xe,o.StructArrayLayout5f20=Ss,o.Texture=ng,o.Tile=j0,o.Transitionable=tt,o.Uniform1f=Ln,o.Uniform1i=class extends Ca{constructor(s){super(s),this.current=0}set(s,t,n){this.fetchUniformLocation(s,t)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},o.Uniform2f=class extends Ca{constructor(s){super(s),this.current=[0,0]}set(s,t,n){this.fetchUniformLocation(s,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}},o.Uniform3f=class extends Ca{constructor(s){super(s),this.current=[0,0,0]}set(s,t,n){this.fetchUniformLocation(s,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}},o.Uniform4f=h_,o.UniformColor=Xh,o.UniformMatrix2f=class extends Ca{constructor(s){super(s),this.current=Xx}set(s,t,n){if(this.fetchUniformLocation(s,t)){for(let c=0;c<4;c++)if(n[c]!==this.current[c]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}},o.UniformMatrix3f=class extends Ca{constructor(s){super(s),this.current=_n}set(s,t,n){if(this.fetchUniformLocation(s,t)){for(let c=0;c<9;c++)if(n[c]!==this.current[c]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},o.UniformMatrix4f=class extends Ca{constructor(s){super(s),this.current=Sm}set(s,t,n){if(this.fetchUniformLocation(s,t)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let c=1;c<16;c++)if(n[c]!==this.current[c]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}},o.UnwrappedTileID=b,o.ValidationError=ii,o.VectorTileFeature=Hd,o.VectorTileWorkerSource=class extends Is{constructor(s,t,n,c,d){super(),this.actor=s,this.layerIndex=t,this.availableImages=n,this.loadVectorData=d||J1,this.loading={},this.loaded={},this.deduped=new K1(s.scheduler),this.isSpriteLoaded=c,this.scheduler=s.scheduler}loadTile(s,t){const n=s.uid,c=s&&s.request,d=c&&c.collectResourceTiming,_=this.loading[n]=new AC(s);_.abort=this.loadVectorData(s,(v,E)=>{const k=!this.loading[n];if(delete this.loading[n],k||v||!E)return _.status="done",k||(this.loaded[n]=_),t(v);const L=E.rawData,N={};E.expires&&(N.expires=E.expires),E.cacheControl&&(N.cacheControl=E.cacheControl),_.vectorTile=E.vectorTile||new Zm(new Q_(L));const V=()=>{_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,(W,Y)=>{if(W||!Y)return t(W);const K={};if(d){const st=Nu(c);st.length>0&&(K.resourceTiming=JSON.parse(JSON.stringify(st)))}t(null,Ji({rawTileData:L.slice(0)},Y,N,K))})};this.isSpriteLoaded?V():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(V,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):V()}),this.loaded=this.loaded||{},this.loaded[n]=_})}reloadTile(s,t){const n=this.loaded,c=s.uid,d=this;if(n&&n[c]){const _=n[c];_.showCollisionBoxes=s.showCollisionBoxes,_.enableTerrain=!!s.enableTerrain,_.projection=s.projection,_.tileTransform=tf(s.tileID.canonical,s.projection);const v=(E,k)=>{const L=_.reloadCallback;L&&(delete _.reloadCallback,_.parse(_.vectorTile,d.layerIndex,this.availableImages,d.actor,L)),t(E,k)};_.status==="parsing"?_.reloadCallback=v:_.status==="done"&&(_.vectorTile?_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,v):v())}}abortTile(s,t){const n=s.uid,c=this.loading[n];c&&(c.abort&&c.abort(),delete this.loading[n]),t()}removeTile(s,t){const n=this.loaded,c=s.uid;n&&n[c]&&delete n[c],t()}},o.WritingMode=ma,o.ZoomDependentExpression=sl,o.add=ca,o.addDynamicAttributes=hy,o.adjoint=function(s,t){var n=t[0],c=t[1],d=t[2],_=t[3],v=t[4],E=t[5],k=t[6],L=t[7],N=t[8];return s[0]=v*N-E*L,s[1]=d*L-c*N,s[2]=c*E-d*v,s[3]=E*k-_*N,s[4]=n*N-d*k,s[5]=d*_-n*E,s[6]=_*L-v*k,s[7]=c*k-n*L,s[8]=n*v-c*_,s},o.asyncAll=Yi,o.bezier=li,o.bindAll=_i,o.boundsAttributes=z1,o.bufferConvexPolygon=function(s,t){const n=[];for(let c=0;c<s.length;c++){const d=hs(c-1,-1,s.length-1),_=hs(c+1,-1,s.length-1),v=s[c],E=s[_],k=s[d].sub(v).unit(),L=E.sub(v).unit(),N=L.angleWithSep(k.x,k.y),V=k.add(L).unit().mult(-1*t/Math.sin(N/2));n.push(v.add(V))}return n},o.cacheEntryPossiblyAdded=function(s){is++,is>ts&&(s.getActor().send("enforceCacheSizeLimit",Pi),is=0)},o.calculateGlobeLabelMatrix=function(s,t){const{x:n,y:c}=s.point,d=S_(n,c,s.worldSize/s._pixelsPerMercatorPixel,0,0);return dl(d,d,Pm(Ro(t)))},o.calculateGlobeMatrix=function(s){const{x:t,y:n}=s.point,{lng:c,lat:d}=s._center;return S_(t,n,s.worldSize,c,d)},o.calculateGlobeMercatorMatrix=function(s){const t=s.pixelsPerMeter,n=t/da(1,s.center.lat),c=co(new Float64Array(16));return wd(c,c,[s.point.x,s.point.y,0]),fl(c,c,[n,n,t]),Float32Array.from(c)},o.circumferenceAtLatitude=Lm,o.clamp=pi,o.clearTileCache=function(s){if(!zn())return;const t=z.caches.delete(wi);s&&t.catch(s).then(()=>s())},o.clipLine=g1,o.clone=function(s){var t=new $r(16);return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],t},o.clone$1=zt,o.collisionCircleLayout=$e,o.config=Q,o.conjugate=function(s,t){return s[0]=-t[0],s[1]=-t[1],s[2]=-t[2],s[3]=t[3],s},o.create=function(){var s=new $r(16);return $r!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},o.create$1=d_,o.createExpression=Vl,o.createLayout=Yt,o.createStyleLayer=function(s){return s.type==="custom"?new gC(s):new yC[s.type](s)},o.cross=ka,o.degToRad=Ce,o.distance=function(s,t){return Math.hypot(t[0]-s[0],t[1]-s[1],t[2]-s[2])},o.div=function(s,t,n){return s[0]=t[0]/n[0],s[1]=t[1]/n[1],s[2]=t[2]/n[2],s},o.dot=Wr,o.earthRadius=Dd,o.ease=fi,o.easeCubicInOut=Ge,o.ecefToLatLng=function([s,t,n]){const c=Math.hypot(s,t,n),d=Math.atan2(s,n),_=.5*Math.PI-Math.acos(-t/c);return new Es(di(d),di(_))},o.emitValidationErrors=$f,o.endsWith=ss,o.enforceCacheSizeLimit=function(s){tn(),es&&es.then(t=>{t.keys().then(n=>{for(let c=0;c<n.length-s;c++)t.delete(n[c])})})},o.evaluateSizeForFeature=Ii,o.evaluateSizeForZoom=hi,o.evaluateVariableOffset=b1,o.evented=S,o.exactEquals=function(s,t){return s[0]===t[0]&&s[1]===t[1]&&s[2]===t[2]&&s[3]===t[3]},o.exactEquals$1=function(s,t){return s[0]===t[0]&&s[1]===t[1]&&s[2]===t[2]},o.exported=To,o.exported$1=nt,o.extend=Ji,o.extend$1=Eo,o.fillExtrusionHeightLift=J_,o.filterObject=_t,o.fromMat4=function(s,t){return s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[4],s[4]=t[5],s[5]=t[6],s[6]=t[8],s[7]=t[9],s[8]=t[10],s},o.fromQuat=function(s,t){var n=t[0],c=t[1],d=t[2],_=t[3],v=n+n,E=c+c,k=d+d,L=n*v,N=c*v,V=c*E,W=d*v,Y=d*E,K=d*k,st=_*v,ut=_*E,vt=_*k;return s[0]=1-V-K,s[1]=N+vt,s[2]=W-ut,s[3]=0,s[4]=N-vt,s[5]=1-L-K,s[6]=Y+st,s[7]=0,s[8]=W+ut,s[9]=Y-st,s[10]=1-L-V,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},o.fromRotation=function(s,t){var n=Math.sin(t),c=Math.cos(t);return s[0]=c,s[1]=n,s[2]=0,s[3]=-n,s[4]=c,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},o.fromScaling=Em,o.furthestTileCorner=function(s){const t=Math.round((s+45+360)%360/90)%4;return Ti[t]},o.getAABBPointSquareDist=function(s,t,n){let c=0;for(let d=0;d<2;++d){const _=n?n[d]:0;s[d]>_&&(c+=(s[d]-_)*(s[d]-_)),t[d]<_&&(c+=(_-t[d])*(_-t[d]))}return c},o.getAnchorAlignment=I0,o.getAnchorJustification=z0,o.getBounds=function(s){let t=1/0,n=1/0,c=-1/0,d=-1/0;for(const _ of s)t=Math.min(t,_.x),n=Math.min(n,_.y),c=Math.max(c,_.x),d=Math.max(d,_.y);return{min:new Ut(t,n),max:new Ut(c,d)}},o.getColumn=ti,o.getDefaultExportFromCjs=It,o.getGridMatrix=function(s,t,n,c){const d=t.getNorth(),_=t.getSouth(),v=t.getWest(),E=t.getEast(),k=1<<s.z,L=E-v,N=d-_,V=L/Ql,W=-N/kd[n],Y=[0,V,0,W,0,0,d,v,0];if(s.z>0){const K=180/c;f_(Y,Y,[K/L+1,0,0,0,K/N+1,0,-.5*K/V,.5*K/W,1])}return Y[2]=k,Y[5]=s.x,Y[8]=s.y,Y},o.getImage=Mt,o.getJSON=function(s,t){return $n(Ji(s,{type:"json"}),t)},o.getLatitudinalLod=function(s){const t=po-5;s=pi(s,-80.051129,t)/t*90;const n=Math.pow(Math.abs(Math.sin(Ce(s))),3);return Math.round(n*(kd.length-1))},o.getMapSessionAPI=In,o.getPerformanceMeasurement=Nu,o.getProjection=k1,o.getRTLTextPluginStatus=M,o.getReferrer=Sn,o.getTilePoint=function(s,{x:t,y:n},c=0){return new Ut(((t-c)*s.scale-s.x)*gi,(n*s.scale-s.y)*gi)},o.getTileVec3=function(s,t,n=0){return Jl(((t.x-n)*s.scale-s.x)*gi,(t.y*s.scale-s.y)*gi,zd(t.z,t.y))},o.getVideo=function(s,t){const n=z.document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(let c=0;c<s.length;c++){const d=z.document.createElement("source");El(s[c])||(n.crossOrigin="Anonymous"),d.src=s[c],n.appendChild(d)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(s){const t=[0,0,0],n=co(new Float64Array(16));return dl(n,s.pixelMatrix,s.globeMatrix),rn(t,t,n),new Ut(t[0],t[1])},o.globeDenormalizeECEF=Pm,o.globeECEFOrigin=function(s,t){const n=[0,0,0];return rn(n,n,Hc(Ro(t.canonical))),rn(n,n,s),n},o.globeMetersToEcef=rp,o.globeNormalizeECEF=Hc,o.globePixelsToTileUnits=function(s,t){return gi/(512*Math.pow(2,s))*Kh(Ro(t))},o.globePoleMatrixForTile=function(s,t,n){const c=co(new Float64Array(16)),d=(t/(1<<s)-.5)*Math.PI*2;return Jf(c,n.globeMatrix,d),Float32Array.from(c)},o.globeTileBounds=Ro,o.globeTiltAtLngLat=E_,o.globeToMercatorTransition=Jh,o.globeUseCustomAntiAliasing=function(s,t,n){const c=Jh(n.zoom),d=s.style.map._antialias,_=!!t.extStandardDerivatives,v=t.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return c===0&&!d&&!v&&_},o.identity=co,o.identity$1=lr,o.invert=Kf,o.isFullscreen=function(){return!!z.document.fullscreenElement||!!z.document.webkitFullscreenElement},o.isLngLatBehindGlobe=Im,o.isMapAuthenticated=function(s){return er.has(s)},o.isMapboxURL=Wt,o.isSafariWithAntialiasingBug=function(s){const t=s.navigator?s.navigator.userAgent:null;return!!Ve(s)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=cr,o.latLngToECEF=Yh,o.len=Zh,o.length=qh,o.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},o.lngFromMercatorX=fo,o.loadVectorTile=J1,o.makeRequest=$n,o.mapValue=function(s,t,n,c,d){return pi((s-t)/(n-t)*(d-c)+c,c,d)},o.mercatorScale=Dm,o.mercatorXfromLng=ua,o.mercatorYfromLat=Bo,o.mercatorZfromAltitude=da,o.mul=Sd,o.mul$1=Jx,o.multiply=dl,o.multiply$1=f_,o.multiply$2=ep,o.nextPowerOfTwo=ci,o.normalize=Mr,o.normalize$1=__,o.normalize$2=Ad,o.number=rs,o.ortho=function(s,t,n,c,d,_,v){var E=1/(t-n),k=1/(c-d),L=1/(_-v);return s[0]=-2*E,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*k,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*L,s[11]=0,s[12]=(t+n)*E,s[13]=(d+c)*k,s[14]=(v+_)*L,s[15]=1,s},o.pbf=ls,o.perspective=function(s,t,n,c,d){var _,v=1/Math.tan(t/2);return s[0]=v/n,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=v,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,d!=null&&d!==1/0?(s[10]=(d+c)*(_=1/(c-d)),s[14]=2*d*c*_):(s[10]=-1,s[14]=-2*c),s},o.pick=function(s,t){const n={};for(let c=0;c<t.length;c++){const d=t[c];d in s&&(n[d]=s[d])}return n},o.plugin=O,o.pointGeometry=kt,o.polesInViewport=function(s){const t=co(new Float64Array(16));dl(t,s.pixelMatrix,s.globeMatrix);const n=[0,uo,0],c=[0,Cr,0];return rn(n,n,t),rn(c,c,t),[n[0]>0&&n[0]<=s.width&&n[1]>0&&n[1]<=s.height&&!Im(s,new Es(s.center.lat,90)),c[0]>0&&c[0]<=s.width&&c[1]>0&&c[1]<=s.height&&!Im(s,new Es(s.center.lat,-90))]},o.polygonContainsPoint=La,o.polygonIntersectsBox=Fd,o.polygonIntersectsPolygon=Rd,o.polygonizeBounds=function(s,t,n=0,c=!0){const d=new Ut(n,n),_=s.sub(d),v=t.add(d),E=[_,new Ut(v.x,_.y),v,new Ut(_.x,v.y)];return c&&E.push(_.clone()),E},o.posAttributes=Oo,o.postMapLoadEvent=an,o.postPerformanceEvent=Pn,o.postTurnstileEvent=Qi,o.potpack=C0,o.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},o.radToDeg=di,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(s){return s({pluginStatus:m,pluginURL:r}),S.on("pluginStateChange",s),s},o.removeAuthState=function(s){er.delete(s)},o.renderColorRamp=Bm,o.resample=op,o.rotateX=Td,o.rotateX$1=g_,o.rotateY=Jf,o.rotateY$1=Mm,o.rotateZ=function(s,t,n){var c=Math.sin(n),d=Math.cos(n),_=t[0],v=t[1],E=t[2],k=t[3],L=t[4],N=t[5],V=t[6],W=t[7];return t!==s&&(s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s[0]=_*d+L*c,s[1]=v*d+N*c,s[2]=E*d+V*c,s[3]=k*d+W*c,s[4]=L*d-_*c,s[5]=N*d-v*c,s[6]=V*d-E*c,s[7]=W*d-k*c,s},o.rotateZ$1=function(s,t,n){n*=.5;var c=t[0],d=t[1],_=t[2],v=t[3],E=Math.sin(n),k=Math.cos(n);return s[0]=c*k+d*E,s[1]=d*k-c*E,s[2]=_*k+v*E,s[3]=v*k-_*E,s},o.scale=fl,o.scale$1=m_,o.scale$2=Gr,o.scaleAndAdd=Ed,o.set=function(s,t,n,c){return s[0]=t,s[1]=n,s[2]=c,s},o.setCacheLimits=function(s,t){Pi=s,ts=t},o.setColumn=function(s,t,n){s[4*t+0]=n[0],s[4*t+1]=n[1],s[4*t+2]=n[2],s[4*t+3]=n[3]},o.setRTLTextPlugin=function(s,t,n=!1){if(m===Vc||m===Gh||m===yd)throw new Error("setRTLTextPlugin cannot be called multiple times.");r=To.resolveURL(s),m=Vc,Xl=t,y(),n||D()},o.smoothstep=Ns,o.spec=pe,o.squaredLength=function(s){var t=s[0],n=s[1],c=s[2];return t*t+n*n+c*c},o.storeAuthState=function(s,t){t?er.add(s):er.delete(s)},o.sub=ho,o.subtract=tp,o.symbolSize=Li,o.tileAABB=function(s,t,n,c,d,_,v,E,k){if(k.name==="globe")return t0(s,t,new g(n,c,d));const L=tf({z:n,x:c,y:d},k);return new Qn([(_+L.x/L.scale)*t,t*(L.y/L.scale),v],[(_+L.x2/L.scale)*t,t*(L.y2/L.scale),E])},o.tileCornersToBounds=Id,o.tileTransform=tf,o.transformMat3=function(s,t,n){var c=t[0],d=t[1],_=t[2];return s[0]=c*n[0]+d*n[3]+_*n[6],s[1]=c*n[1]+d*n[4]+_*n[7],s[2]=c*n[2]+d*n[5]+_*n[8],s},o.transformMat4=rn,o.transformMat4$1=Ar,o.transformQuat=gs,o.transitionTileAABBinECEF=km,o.translate=wd,o.transpose=function(s,t){if(s===t){var n=t[1],c=t[2],d=t[5];s[1]=t[3],s[2]=t[6],s[3]=n,s[5]=t[7],s[6]=c,s[7]=d}else s[0]=t[0],s[1]=t[3],s[2]=t[6],s[3]=t[1],s[4]=t[4],s[5]=t[7],s[6]=t[2],s[7]=t[5],s[8]=t[8];return s},o.triggerPluginCompletionEvent=u,o.uniqueId=Ds,o.updateGlobeVertexNormal=function(s,t,n,c,d){const _=5*t+2;s.float32[_+0]=n,s.float32[_+1]=c,s.float32[_+2]=d},o.validateCustomStyleLayer=function(s){const t=[],n=s.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),s.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},o.validateFilter=s=>Ur(Nc(s)),o.validateFog=s=>Ur(Uf(s)),o.validateLayer=s=>Ur(Nf(s)),o.validateLight=s=>Ur(jf(s)),o.validateSource=s=>Ur(hd(s)),o.validateStyle=Uc,o.validateTerrain=s=>Ur(ud(s)),o.values=Zs,o.vectorTile=bp,o.version=$,o.warnOnce=Se,o.window=z,o.wrap=hs}),T(["./shared"],function(o){function z(At){if(typeof At=="number"||typeof At=="boolean"||typeof At=="string"||At==null)return JSON.stringify(At);if(Array.isArray(At)){let lt="[";for(const Mt of At)lt+=`${z(Mt)},`;return`${lt}]`}let at="{";for(const lt of Object.keys(At).sort())at+=`${lt}:${z(At[lt])},`;return`${at}}`}function $(At){let at="";for(const lt of o.refProperties)at+=`/${z(At[lt])}`;return at}class q{constructor(at){this.keyCache={},at&&this.replace(at)}replace(at){this._layerConfigs={},this._layers={},this.update(at,[])}update(at,lt){for(const jt of at)this._layerConfigs[jt.id]=jt,(this._layers[jt.id]=o.createStyleLayer(jt)).compileFilter(),this.keyCache[jt.id]&&delete this.keyCache[jt.id];for(const jt of lt)delete this.keyCache[jt],delete this._layerConfigs[jt],delete this._layers[jt];this.familiesBySource={};const Mt=function(jt,Wt){const ie={};for(let qt=0;qt<jt.length;qt++){const Qt=Wt&&Wt[jt[qt].id]||$(jt[qt]);Wt&&(Wt[jt[qt].id]=Qt);let Fe=ie[Qt];Fe||(Fe=ie[Qt]=[]),Fe.push(jt[qt])}const te=[];for(const qt in ie)te.push(ie[qt]);return te}(o.values(this._layerConfigs),this.keyCache);for(const jt of Mt){const Wt=jt.map(He=>this._layers[He.id]),ie=Wt[0];if(ie.visibility==="none")continue;const te=ie.source||"";let qt=this.familiesBySource[te];qt||(qt=this.familiesBySource[te]={});const Qt=ie.sourceLayer||"_geojsonTileLayer";let Fe=qt[Qt];Fe||(Fe=qt[Qt]=[]),Fe.push(Wt)}}}class Q{loadTile(at,lt){const{uid:Mt,encoding:jt,rawImageData:Wt,padding:ie,buildQuadTree:te}=at,qt=o.window.ImageBitmap&&Wt instanceof o.window.ImageBitmap?this.getImageData(Wt,ie):Wt;lt(null,new o.DEMData(Mt,qt,jt,ie<1,te))}getImageData(at,lt){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(at.width,at.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=at.width,this.offscreenCanvas.height=at.height,this.offscreenCanvasContext.drawImage(at,0,0,at.width,at.height);const Mt=this.offscreenCanvasContext.getImageData(-lt,-lt,at.width+2*lt,at.height+2*lt);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Mt}}function nt(At,at){if(At.length!==0){Tt(At[0],at);for(var lt=1;lt<At.length;lt++)Tt(At[lt],!at)}}function Tt(At,at){for(var lt=0,Mt=0,jt=0,Wt=At.length,ie=Wt-1;jt<Wt;ie=jt++){var te=(At[jt][0]-At[ie][0])*(At[ie][1]+At[jt][1]),qt=lt+te;Mt+=Math.abs(lt)>=Math.abs(te)?lt-qt+te:te-qt+lt,lt=qt}lt+Mt>=0!=!!at&&At.reverse()}var yt=o.getDefaultExportFromCjs(function At(at,lt){var Mt,jt=at&&at.type;if(jt==="FeatureCollection")for(Mt=0;Mt<at.features.length;Mt++)At(at.features[Mt],lt);else if(jt==="GeometryCollection")for(Mt=0;Mt<at.geometries.length;Mt++)At(at.geometries[Mt],lt);else if(jt==="Feature")At(at.geometry,lt);else if(jt==="Polygon")nt(at.coordinates,lt);else if(jt==="MultiPolygon")for(Mt=0;Mt<at.coordinates.length;Mt++)nt(at.coordinates[Mt],lt);return at});const Lt=o.VectorTileFeature.prototype.toGeoJSON;var Nt={exports:{}},Dt=o.pointGeometry,wt=o.vectorTile.VectorTileFeature,It=Xt;function Xt(At,at){this.options=at||{},this.features=At,this.length=At.length}function Zt(At,at){this.id=typeof At.id=="number"?At.id:void 0,this.type=At.type,this.rawGeometry=At.type===1?[At.geometry]:At.geometry,this.properties=At.tags,this.extent=at||4096}Xt.prototype.feature=function(At){return new Zt(this.features[At],this.options.extent)},Zt.prototype.loadGeometry=function(){var At=this.rawGeometry;this.geometry=[];for(var at=0;at<At.length;at++){for(var lt=At[at],Mt=[],jt=0;jt<lt.length;jt++)Mt.push(new Dt(lt[jt][0],lt[jt][1]));this.geometry.push(Mt)}return this.geometry},Zt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var At=this.geometry,at=1/0,lt=-1/0,Mt=1/0,jt=-1/0,Wt=0;Wt<At.length;Wt++)for(var ie=At[Wt],te=0;te<ie.length;te++){var qt=ie[te];at=Math.min(at,qt.x),lt=Math.max(lt,qt.x),Mt=Math.min(Mt,qt.y),jt=Math.max(jt,qt.y)}return[at,Mt,lt,jt]},Zt.prototype.toGeoJSON=wt.prototype.toGeoJSON;var re=o.pbf,kt=It;function ne(At){var at=new re;return function(lt,Mt){for(var jt in lt.layers)Mt.writeMessage(3,Ut,lt.layers[jt])}(At,at),at.finish()}function Ut(At,at){var lt;at.writeVarintField(15,At.version||1),at.writeStringField(1,At.name||""),at.writeVarintField(5,At.extent||4096);var Mt={keys:[],values:[],keycache:{},valuecache:{}};for(lt=0;lt<At.length;lt++)Mt.feature=At.feature(lt),at.writeMessage(2,Le,Mt);var jt=Mt.keys;for(lt=0;lt<jt.length;lt++)at.writeStringField(3,jt[lt]);var Wt=Mt.values;for(lt=0;lt<Wt.length;lt++)at.writeMessage(4,Ge,Wt[lt])}function Le(At,at){var lt=At.feature;lt.id!==void 0&&at.writeVarintField(1,lt.id),at.writeMessage(2,ye,At),at.writeVarintField(3,lt.type),at.writeMessage(4,Ti,lt)}function ye(At,at){var lt=At.feature,Mt=At.keys,jt=At.values,Wt=At.keycache,ie=At.valuecache;for(var te in lt.properties){var qt=lt.properties[te],Qt=Wt[te];if(qt!==null){Qt===void 0&&(Mt.push(te),Wt[te]=Qt=Mt.length-1),at.writeVarint(Qt);var Fe=typeof qt;Fe!=="string"&&Fe!=="boolean"&&Fe!=="number"&&(qt=JSON.stringify(qt));var He=Fe+":"+qt,ze=ie[He];ze===void 0&&(jt.push(qt),ie[He]=ze=jt.length-1),at.writeVarint(ze)}}}function Ce(At,at){return(at<<3)+(7&At)}function di(At){return At<<1^At>>31}function Ti(At,at){for(var lt=At.loadGeometry(),Mt=At.type,jt=0,Wt=0,ie=lt.length,te=0;te<ie;te++){var qt=lt[te],Qt=1;Mt===1&&(Qt=qt.length),at.writeVarint(Ce(1,Qt));for(var Fe=Mt===3?qt.length-1:qt.length,He=0;He<Fe;He++){He===1&&Mt!==1&&at.writeVarint(Ce(2,Fe-1));var ze=qt[He].x-jt,Di=qt[He].y-Wt;at.writeVarint(di(ze)),at.writeVarint(di(Di)),jt+=ze,Wt+=Di}Mt===3&&at.writeVarint(Ce(7,1))}}function Ge(At,at){var lt=typeof At;lt==="string"?at.writeStringField(1,At):lt==="boolean"?at.writeBooleanField(7,At):lt==="number"&&(At%1!=0?at.writeDoubleField(3,At):At<0?at.writeSVarintField(6,At):at.writeVarintField(5,At))}Nt.exports=ne,Nt.exports.fromVectorTileJs=ne,Nt.exports.fromGeojsonVt=function(At,at){at=at||{};var lt={};for(var Mt in At)lt[Mt]=new kt(At[Mt].features,at),lt[Mt].name=Mt,lt[Mt].version=at.version,lt[Mt].extent=at.extent;return ne({layers:lt})},Nt.exports.GeoJSONWrapper=kt;var li=o.getDefaultExportFromCjs(Nt.exports);const fi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:At=>At},pi=Math.fround||(Ns=new Float32Array(1),At=>(Ns[0]=+At,Ns[0]));var Ns;const hs=3,Yi=5,Zs=6;class Ji{constructor(at){this.options=Object.assign(Object.create(fi),at),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(at){const{log:lt,minZoom:Mt,maxZoom:jt}=this.options;lt&&console.time("total time");const Wt=`prepare ${at.length} points`;lt&&console.time(Wt),this.points=at;const ie=[];for(let qt=0;qt<at.length;qt++){const Qt=at[qt];if(!Qt.geometry)continue;const[Fe,He]=Qt.geometry.coordinates,ze=pi(Me(Fe)),Di=pi(ci(He));ie.push(ze,Di,1/0,qt,-1,1),this.options.reduce&&ie.push(0)}let te=this.trees[jt+1]=this._createTree(ie);lt&&console.timeEnd(Wt);for(let qt=jt;qt>=Mt;qt--){const Qt=+Date.now();te=this.trees[qt]=this._createTree(this._cluster(te,qt)),lt&&console.log("z%d: %d clusters in %dms",qt,te.numItems,+Date.now()-Qt)}return lt&&console.timeEnd("total time"),this}getClusters(at,lt){let Mt=((at[0]+180)%360+360)%360-180;const jt=Math.max(-90,Math.min(90,at[1]));let Wt=at[2]===180?180:((at[2]+180)%360+360)%360-180;const ie=Math.max(-90,Math.min(90,at[3]));if(at[2]-at[0]>=360)Mt=-180,Wt=180;else if(Mt>Wt){const He=this.getClusters([Mt,jt,180,ie],lt),ze=this.getClusters([-180,jt,Wt,ie],lt);return He.concat(ze)}const te=this.trees[this._limitZoom(lt)],qt=te.range(Me(Mt),ci(ie),Me(Wt),ci(jt)),Qt=te.data,Fe=[];for(const He of qt){const ze=this.stride*He;Fe.push(Qt[ze+Yi]>1?Tn(Qt,ze,this.clusterProps):this.points[Qt[ze+hs]])}return Fe}getChildren(at){const lt=this._getOriginId(at),Mt=this._getOriginZoom(at),jt="No cluster with the specified id.",Wt=this.trees[Mt];if(!Wt)throw new Error(jt);const ie=Wt.data;if(lt*this.stride>=ie.length)throw new Error(jt);const te=this.options.radius/(this.options.extent*Math.pow(2,Mt-1)),qt=Wt.within(ie[lt*this.stride],ie[lt*this.stride+1],te),Qt=[];for(const Fe of qt){const He=Fe*this.stride;ie[He+4]===at&&Qt.push(ie[He+Yi]>1?Tn(ie,He,this.clusterProps):this.points[ie[He+hs]])}if(Qt.length===0)throw new Error(jt);return Qt}getLeaves(at,lt,Mt){const jt=[];return this._appendLeaves(jt,at,lt=lt||10,Mt=Mt||0,0),jt}getTile(at,lt,Mt){const jt=this.trees[this._limitZoom(at)],Wt=Math.pow(2,at),{extent:ie,radius:te}=this.options,qt=te/ie,Qt=(Mt-qt)/Wt,Fe=(Mt+1+qt)/Wt,He={features:[]};return this._addTileFeatures(jt.range((lt-qt)/Wt,Qt,(lt+1+qt)/Wt,Fe),jt.data,lt,Mt,Wt,He),lt===0&&this._addTileFeatures(jt.range(1-qt/Wt,Qt,1,Fe),jt.data,Wt,Mt,Wt,He),lt===Wt-1&&this._addTileFeatures(jt.range(0,Qt,qt/Wt,Fe),jt.data,-1,Mt,Wt,He),He.features.length?He:null}getClusterExpansionZoom(at){let lt=this._getOriginZoom(at)-1;for(;lt<=this.options.maxZoom;){const Mt=this.getChildren(at);if(lt++,Mt.length!==1)break;at=Mt[0].properties.cluster_id}return lt}_appendLeaves(at,lt,Mt,jt,Wt){const ie=this.getChildren(lt);for(const te of ie){const qt=te.properties;if(qt&&qt.cluster?Wt+qt.point_count<=jt?Wt+=qt.point_count:Wt=this._appendLeaves(at,qt.cluster_id,Mt,jt,Wt):Wt<jt?Wt++:at.push(te),at.length===Mt)break}return Wt}_createTree(at){const lt=new o.KDBush(at.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Mt=0;Mt<at.length;Mt+=this.stride)lt.add(at[Mt],at[Mt+1]);return lt.finish(),lt.data=at,lt}_addTileFeatures(at,lt,Mt,jt,Wt,ie){for(const te of at){const qt=te*this.stride,Qt=lt[qt+Yi]>1;let Fe,He,ze;if(Qt)Fe=Ds(lt,qt,this.clusterProps),He=lt[qt],ze=lt[qt+1];else{const zi=this.points[lt[qt+hs]];Fe=zi.properties;const[Xi,Qi]=zi.geometry.coordinates;He=Me(Xi),ze=ci(Qi)}const Di={type:1,geometry:[[Math.round(this.options.extent*(He*Wt-Mt)),Math.round(this.options.extent*(ze*Wt-jt))]],tags:Fe};let Ei;Ei=Qt||this.options.generateId?lt[qt+hs]:this.points[lt[qt+hs]].id,Ei!==void 0&&(Di.id=Ei),ie.features.push(Di)}}_limitZoom(at){return Math.max(this.options.minZoom,Math.min(Math.floor(+at),this.options.maxZoom+1))}_cluster(at,lt){const{radius:Mt,extent:jt,reduce:Wt,minPoints:ie}=this.options,te=Mt/(jt*Math.pow(2,lt)),qt=at.data,Qt=[],Fe=this.stride;for(let He=0;He<qt.length;He+=Fe){if(qt[He+2]<=lt)continue;qt[He+2]=lt;const ze=qt[He],Di=qt[He+1],Ei=at.within(qt[He],qt[He+1],te),zi=qt[He+Yi];let Xi=zi;for(const Qi of Ei){const en=Qi*Fe;qt[en+2]>lt&&(Xi+=qt[en+Yi])}if(Xi>zi&&Xi>=ie){let Qi,en=ze*zi,an=Di*zi,Kn=-1;const Pn=((He/Fe|0)<<5)+(lt+1)+this.points.length;for(const wo of Ei){const In=wo*Fe;if(qt[In+2]<=lt)continue;qt[In+2]=lt;const er=qt[In+Yi];en+=qt[In]*er,an+=qt[In+1]*er,qt[In+4]=Pn,Wt&&(Qi||(Qi=this._map(qt,He,!0),Kn=this.clusterProps.length,this.clusterProps.push(Qi)),Wt(Qi,this._map(qt,In)))}qt[He+4]=Pn,Qt.push(en/Xi,an/Xi,1/0,Pn,-1,Xi),Wt&&Qt.push(Kn)}else{for(let Qi=0;Qi<Fe;Qi++)Qt.push(qt[He+Qi]);if(Xi>1)for(const Qi of Ei){const en=Qi*Fe;if(!(qt[en+2]<=lt)){qt[en+2]=lt;for(let an=0;an<Fe;an++)Qt.push(qt[en+an])}}}}return Qt}_getOriginId(at){return at-this.points.length>>5}_getOriginZoom(at){return(at-this.points.length)%32}_map(at,lt,Mt){if(at[lt+Yi]>1){const ie=this.clusterProps[at[lt+Zs]];return Mt?Object.assign({},ie):ie}const jt=this.points[at[lt+hs]].properties,Wt=this.options.map(jt);return Mt&&Wt===jt?Object.assign({},Wt):Wt}}function Tn(At,at,lt){return{type:"Feature",id:At[at+hs],properties:Ds(At,at,lt),geometry:{type:"Point",coordinates:[(Mt=At[at],360*(Mt-.5)),ni(At[at+1])]}};var Mt}function Ds(At,at,lt){const Mt=At[at+Yi],jt=Mt>=1e4?`${Math.round(Mt/1e3)}k`:Mt>=1e3?Math.round(Mt/100)/10+"k":Mt,Wt=At[at+Zs],ie=Wt===-1?{}:Object.assign({},lt[Wt]);return Object.assign(ie,{cluster:!0,cluster_id:At[at+hs],point_count:Mt,point_count_abbreviated:jt})}function Me(At){return At/360+.5}function ci(At){const at=Math.sin(At*Math.PI/180),lt=.5-.25*Math.log((1+at)/(1-at))/Math.PI;return lt<0?0:lt>1?1:lt}function ni(At){const at=(180-360*At)*Math.PI/180;return 360*Math.atan(Math.exp(at))/Math.PI-90}function _i(At,at,lt,Mt){for(var jt,Wt=Mt,ie=lt-at>>1,te=lt-at,qt=At[at],Qt=At[at+1],Fe=At[lt],He=At[lt+1],ze=at+3;ze<lt;ze+=3){var Di=ss(At[ze],At[ze+1],qt,Qt,Fe,He);if(Di>Wt)jt=ze,Wt=Di;else if(Di===Wt){var Ei=Math.abs(ze-ie);Ei<te&&(jt=ze,te=Ei)}}Wt>Mt&&(jt-at>3&&_i(At,at,jt,Mt),At[jt+2]=Wt,lt-jt>3&&_i(At,jt,lt,Mt))}function ss(At,at,lt,Mt,jt,Wt){var ie=jt-lt,te=Wt-Mt;if(ie!==0||te!==0){var qt=((At-lt)*ie+(at-Mt)*te)/(ie*ie+te*te);qt>1?(lt=jt,Mt=Wt):qt>0&&(lt+=ie*qt,Mt+=te*qt)}return(ie=At-lt)*ie+(te=at-Mt)*te}function xi(At,at,lt,Mt){var jt={id:At===void 0?null:At,type:at,geometry:lt,tags:Mt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Wt){var ie=Wt.geometry,te=Wt.type;if(te==="Point"||te==="MultiPoint"||te==="LineString")_t(Wt,ie);else if(te==="Polygon"||te==="MultiLineString")for(var qt=0;qt<ie.length;qt++)_t(Wt,ie[qt]);else if(te==="MultiPolygon")for(qt=0;qt<ie.length;qt++)for(var Qt=0;Qt<ie[qt].length;Qt++)_t(Wt,ie[qt][Qt])}(jt),jt}function _t(At,at){for(var lt=0;lt<at.length;lt+=3)At.minX=Math.min(At.minX,at[lt]),At.minY=Math.min(At.minY,at[lt+1]),At.maxX=Math.max(At.maxX,at[lt]),At.maxY=Math.max(At.maxY,at[lt+1])}function zt(At,at,lt,Mt){if(at.geometry){var jt=at.geometry.coordinates,Wt=at.geometry.type,ie=Math.pow(lt.tolerance/((1<<lt.maxZoom)*lt.extent),2),te=[],qt=at.id;if(lt.promoteId?qt=at.properties[lt.promoteId]:lt.generateId&&(qt=Mt||0),Wt==="Point")fe(jt,te);else if(Wt==="MultiPoint")for(var Qt=0;Qt<jt.length;Qt++)fe(jt[Qt],te);else if(Wt==="LineString")Se(jt,te,ie,!1);else if(Wt==="MultiLineString"){if(lt.lineMetrics){for(Qt=0;Qt<jt.length;Qt++)Se(jt[Qt],te=[],ie,!1),At.push(xi(qt,"LineString",te,at.properties));return}be(jt,te,ie,!1)}else if(Wt==="Polygon")be(jt,te,ie,!0);else{if(Wt!=="MultiPolygon"){if(Wt==="GeometryCollection"){for(Qt=0;Qt<at.geometry.geometries.length;Qt++)zt(At,{id:qt,geometry:at.geometry.geometries[Qt],properties:at.properties},lt,Mt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Qt=0;Qt<jt.length;Qt++){var Fe=[];be(jt[Qt],Fe,ie,!0),te.push(Fe)}}At.push(xi(qt,Wt,te,at.properties))}}function fe(At,at){at.push(Ue(At[0])),at.push(ei(At[1])),at.push(0)}function Se(At,at,lt,Mt){for(var jt,Wt,ie=0,te=0;te<At.length;te++){var qt=Ue(At[te][0]),Qt=ei(At[te][1]);at.push(qt),at.push(Qt),at.push(0),te>0&&(ie+=Mt?(jt*Qt-qt*Wt)/2:Math.sqrt(Math.pow(qt-jt,2)+Math.pow(Qt-Wt,2))),jt=qt,Wt=Qt}var Fe=at.length-3;at[2]=1,_i(at,0,Fe,lt),at[Fe+2]=1,at.size=Math.abs(ie),at.start=0,at.end=at.size}function be(At,at,lt,Mt){for(var jt=0;jt<At.length;jt++){var Wt=[];Se(At[jt],Wt,lt,Mt),at.push(Wt)}}function Ue(At){return At/360+.5}function ei(At){var at=Math.sin(At*Math.PI/180),lt=.5-.25*Math.log((1+at)/(1-at))/Math.PI;return lt<0?0:lt>1?1:lt}function We(At,at,lt,Mt,jt,Wt,ie,te){if(Mt/=at,Wt>=(lt/=at)&&ie<Mt)return At;if(ie<lt||Wt>=Mt)return null;for(var qt=[],Qt=0;Qt<At.length;Qt++){var Fe=At[Qt],He=Fe.geometry,ze=Fe.type,Di=jt===0?Fe.minX:Fe.minY,Ei=jt===0?Fe.maxX:Fe.maxY;if(Di>=lt&&Ei<Mt)qt.push(Fe);else if(!(Ei<lt||Di>=Mt)){var zi=[];if(ze==="Point"||ze==="MultiPoint")Xe(He,zi,lt,Mt,jt);else if(ze==="LineString")Ve(He,zi,lt,Mt,jt,!1,te.lineMetrics);else if(ze==="MultiLineString")ti(He,zi,lt,Mt,jt,!1);else if(ze==="Polygon")ti(He,zi,lt,Mt,jt,!0);else if(ze==="MultiPolygon")for(var Xi=0;Xi<He.length;Xi++){var Qi=[];ti(He[Xi],Qi,lt,Mt,jt,!0),Qi.length&&zi.push(Qi)}if(zi.length){if(te.lineMetrics&&ze==="LineString"){for(Xi=0;Xi<zi.length;Xi++)qt.push(xi(Fe.id,ze,zi[Xi],Fe.tags));continue}ze!=="LineString"&&ze!=="MultiLineString"||(zi.length===1?(ze="LineString",zi=zi[0]):ze="MultiLineString"),ze!=="Point"&&ze!=="MultiPoint"||(ze=zi.length===3?"Point":"MultiPoint"),qt.push(xi(Fe.id,ze,zi,Fe.tags))}}}return qt.length?qt:null}function Xe(At,at,lt,Mt,jt){for(var Wt=0;Wt<At.length;Wt+=3){var ie=At[Wt+jt];ie>=lt&&ie<=Mt&&(at.push(At[Wt]),at.push(At[Wt+1]),at.push(At[Wt+2]))}}function Ve(At,at,lt,Mt,jt,Wt,ie){for(var te,qt,Qt=Ci(At),Fe=jt===0?Pi:ts,He=At.start,ze=0;ze<At.length-3;ze+=3){var Di=At[ze],Ei=At[ze+1],zi=At[ze+2],Xi=At[ze+3],Qi=At[ze+4],en=jt===0?Di:Ei,an=jt===0?Xi:Qi,Kn=!1;ie&&(te=Math.sqrt(Math.pow(Di-Xi,2)+Math.pow(Ei-Qi,2))),en<lt?an>lt&&(qt=Fe(Qt,Di,Ei,Xi,Qi,lt),ie&&(Qt.start=He+te*qt)):en>Mt?an<Mt&&(qt=Fe(Qt,Di,Ei,Xi,Qi,Mt),ie&&(Qt.start=He+te*qt)):wi(Qt,Di,Ei,zi),an<lt&&en>=lt&&(qt=Fe(Qt,Di,Ei,Xi,Qi,lt),Kn=!0),an>Mt&&en<=Mt&&(qt=Fe(Qt,Di,Ei,Xi,Qi,Mt),Kn=!0),!Wt&&Kn&&(ie&&(Qt.end=He+te*qt),at.push(Qt),Qt=Ci(At)),ie&&(He+=te)}var Pn=At.length-3;Di=At[Pn],Ei=At[Pn+1],zi=At[Pn+2],(en=jt===0?Di:Ei)>=lt&&en<=Mt&&wi(Qt,Di,Ei,zi),Pn=Qt.length-3,Wt&&Pn>=3&&(Qt[Pn]!==Qt[0]||Qt[Pn+1]!==Qt[1])&&wi(Qt,Qt[0],Qt[1],Qt[2]),Qt.length&&at.push(Qt)}function Ci(At){var at=[];return at.size=At.size,at.start=At.start,at.end=At.end,at}function ti(At,at,lt,Mt,jt,Wt){for(var ie=0;ie<At.length;ie++)Ve(At[ie],at,lt,Mt,jt,Wt,!1)}function wi(At,at,lt,Mt){At.push(at),At.push(lt),At.push(Mt)}function Pi(At,at,lt,Mt,jt,Wt){var ie=(Wt-at)/(Mt-at);return At.push(Wt),At.push(lt+(jt-lt)*ie),At.push(1),ie}function ts(At,at,lt,Mt,jt,Wt){var ie=(Wt-lt)/(jt-lt);return At.push(at+(Mt-at)*ie),At.push(Wt),At.push(1),ie}function es(At,at){for(var lt=[],Mt=0;Mt<At.length;Mt++){var jt,Wt=At[Mt],ie=Wt.type;if(ie==="Point"||ie==="MultiPoint"||ie==="LineString")jt=ns(Wt.geometry,at);else if(ie==="MultiLineString"||ie==="Polygon"){jt=[];for(var te=0;te<Wt.geometry.length;te++)jt.push(ns(Wt.geometry[te],at))}else if(ie==="MultiPolygon")for(jt=[],te=0;te<Wt.geometry.length;te++){for(var qt=[],Qt=0;Qt<Wt.geometry[te].length;Qt++)qt.push(ns(Wt.geometry[te][Qt],at));jt.push(qt)}lt.push(xi(Wt.id,ie,jt,Wt.tags))}return lt}function ns(At,at){var lt=[];lt.size=At.size,At.start!==void 0&&(lt.start=At.start,lt.end=At.end);for(var Mt=0;Mt<At.length;Mt+=3)lt.push(At[Mt]+at,At[Mt+1],At[Mt+2]);return lt}function zn(At,at){if(At.transformed)return At;var lt,Mt,jt,Wt=1<<At.z,ie=At.x,te=At.y;for(lt=0;lt<At.features.length;lt++){var qt=At.features[lt],Qt=qt.geometry,Fe=qt.type;if(qt.geometry=[],Fe===1)for(Mt=0;Mt<Qt.length;Mt+=2)qt.geometry.push(tn(Qt[Mt],Qt[Mt+1],at,Wt,ie,te));else for(Mt=0;Mt<Qt.length;Mt++){var He=[];for(jt=0;jt<Qt[Mt].length;jt+=2)He.push(tn(Qt[Mt][jt],Qt[Mt][jt+1],at,Wt,ie,te));qt.geometry.push(He)}}return At.transformed=!0,At}function tn(At,at,lt,Mt,jt,Wt){return[Math.round(lt*(At*Mt-jt)),Math.round(lt*(at*Mt-Wt))]}function Vn(At,at,lt,Mt,jt){for(var Wt=at===jt.maxZoom?0:jt.tolerance/((1<<at)*jt.extent),ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:lt,y:Mt,z:at,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},te=0;te<At.length;te++){ie.numFeatures++,is(ie,At[te],Wt,jt);var qt=At[te].minX,Qt=At[te].minY,Fe=At[te].maxX,He=At[te].maxY;qt<ie.minX&&(ie.minX=qt),Qt<ie.minY&&(ie.minY=Qt),Fe>ie.maxX&&(ie.maxX=Fe),He>ie.maxY&&(ie.maxY=He)}return ie}function is(At,at,lt,Mt){var jt=at.geometry,Wt=at.type,ie=[];if(Wt==="Point"||Wt==="MultiPoint")for(var te=0;te<jt.length;te+=3)ie.push(jt[te]),ie.push(jt[te+1]),At.numPoints++,At.numSimplified++;else if(Wt==="LineString")fr(ie,jt,At,lt,!1,!1);else if(Wt==="MultiLineString"||Wt==="Polygon")for(te=0;te<jt.length;te++)fr(ie,jt[te],At,lt,Wt==="Polygon",te===0);else if(Wt==="MultiPolygon")for(var qt=0;qt<jt.length;qt++){var Qt=jt[qt];for(te=0;te<Qt.length;te++)fr(ie,Qt[te],At,lt,!0,te===0)}if(ie.length){var Fe=at.tags||null;if(Wt==="LineString"&&Mt.lineMetrics){for(var He in Fe={},at.tags)Fe[He]=at.tags[He];Fe.mapbox_clip_start=jt.start/jt.size,Fe.mapbox_clip_end=jt.end/jt.size}var ze={geometry:ie,type:Wt==="Polygon"||Wt==="MultiPolygon"?3:Wt==="LineString"||Wt==="MultiLineString"?2:1,tags:Fe};at.id!==null&&(ze.id=at.id),At.features.push(ze)}}function fr(At,at,lt,Mt,jt,Wt){var ie=Mt*Mt;if(Mt>0&&at.size<(jt?ie:Mt))lt.numPoints+=at.length/3;else{for(var te=[],qt=0;qt<at.length;qt+=3)(Mt===0||at[qt+2]>ie)&&(lt.numSimplified++,te.push(at[qt]),te.push(at[qt+1])),lt.numPoints++;jt&&function(Qt,Fe){for(var He=0,ze=0,Di=Qt.length,Ei=Di-2;ze<Di;Ei=ze,ze+=2)He+=(Qt[ze]-Qt[Ei])*(Qt[ze+1]+Qt[Ei+1]);if(He>0===Fe)for(ze=0,Di=Qt.length;ze<Di/2;ze+=2){var zi=Qt[ze],Xi=Qt[ze+1];Qt[ze]=Qt[Di-2-ze],Qt[ze+1]=Qt[Di-1-ze],Qt[Di-2-ze]=zi,Qt[Di-1-ze]=Xi}}(te,Wt),At.push(te)}}function to(At,at){var lt=(at=this.options=function(jt,Wt){for(var ie in Wt)jt[ie]=Wt[ie];return jt}(Object.create(this.options),at)).debug;if(lt&&console.time("preprocess data"),at.maxZoom<0||at.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(at.promoteId&&at.generateId)throw new Error("promoteId and generateId cannot be used together.");var Mt=function(jt,Wt){var ie=[];if(jt.type==="FeatureCollection")for(var te=0;te<jt.features.length;te++)zt(ie,jt.features[te],Wt,te);else zt(ie,jt.type==="Feature"?jt:{geometry:jt},Wt);return ie}(At,at);this.tiles={},this.tileCoords=[],lt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",at.indexMaxZoom,at.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Mt=function(jt,Wt){var ie=Wt.buffer/Wt.extent,te=jt,qt=We(jt,1,-1-ie,ie,0,-1,2,Wt),Qt=We(jt,1,1-ie,2+ie,0,-1,2,Wt);return(qt||Qt)&&(te=We(jt,1,-ie,1+ie,0,-1,2,Wt)||[],qt&&(te=es(qt,1).concat(te)),Qt&&(te=te.concat(es(Qt,-1)))),te}(Mt,at),Mt.length&&this.splitTile(Mt,0,0,0),lt&&(Mt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Sn(At,at,lt){return 32*((1<<At)*lt+at)+At}function $n(At,at){const lt=At.tileID.canonical;if(!this._geoJSONIndex)return at(null,null);const Mt=this._geoJSONIndex.getTile(lt.z,lt.x,lt.y);if(!Mt)return at(null,null);const jt=new class{constructor(ie){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=ie.length,this._features=ie}feature(ie){return new class{constructor(te){this._feature=te,this.extent=o.EXTENT,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const qt of this._feature.geometry)te.push([new o.Point(qt[0],qt[1])]);return te}{const te=[];for(const qt of this._feature.geometry){const Qt=[];for(const Fe of qt)Qt.push(new o.Point(Fe[0],Fe[1]));te.push(Qt)}return te}}toGeoJSON(te,qt,Qt){return Lt.call(this,te,qt,Qt)}}(this._features[ie])}}(Mt.features);let Wt=li(jt);Wt.byteOffset===0&&Wt.byteLength===Wt.buffer.byteLength||(Wt=new Uint8Array(Wt)),at(null,{vectorTile:jt,rawData:Wt.buffer})}to.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},to.prototype.splitTile=function(At,at,lt,Mt,jt,Wt,ie){for(var te=[At,at,lt,Mt],qt=this.options,Qt=qt.debug;te.length;){Mt=te.pop(),lt=te.pop(),at=te.pop(),At=te.pop();var Fe=1<<at,He=Sn(at,lt,Mt),ze=this.tiles[He];if(!ze&&(Qt>1&&console.time("creation"),ze=this.tiles[He]=Vn(At,at,lt,Mt,qt),this.tileCoords.push({z:at,x:lt,y:Mt}),Qt)){Qt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",at,lt,Mt,ze.numFeatures,ze.numPoints,ze.numSimplified),console.timeEnd("creation"));var Di="z"+at;this.stats[Di]=(this.stats[Di]||0)+1,this.total++}if(ze.source=At,jt){if(at===qt.maxZoom||at===jt)continue;var Ei=1<<jt-at;if(lt!==Math.floor(Wt/Ei)||Mt!==Math.floor(ie/Ei))continue}else if(at===qt.indexMaxZoom||ze.numPoints<=qt.indexMaxPoints)continue;if(ze.source=null,At.length!==0){Qt>1&&console.time("clipping");var zi,Xi,Qi,en,an,Kn,Pn=.5*qt.buffer/qt.extent,wo=.5-Pn,In=.5+Pn,er=1+Pn;zi=Xi=Qi=en=null,an=We(At,Fe,lt-Pn,lt+In,0,ze.minX,ze.maxX,qt),Kn=We(At,Fe,lt+wo,lt+er,0,ze.minX,ze.maxX,qt),At=null,an&&(zi=We(an,Fe,Mt-Pn,Mt+In,1,ze.minY,ze.maxY,qt),Xi=We(an,Fe,Mt+wo,Mt+er,1,ze.minY,ze.maxY,qt),an=null),Kn&&(Qi=We(Kn,Fe,Mt-Pn,Mt+In,1,ze.minY,ze.maxY,qt),en=We(Kn,Fe,Mt+wo,Mt+er,1,ze.minY,ze.maxY,qt),Kn=null),Qt>1&&console.timeEnd("clipping"),te.push(zi||[],at+1,2*lt,2*Mt),te.push(Xi||[],at+1,2*lt,2*Mt+1),te.push(Qi||[],at+1,2*lt+1,2*Mt),te.push(en||[],at+1,2*lt+1,2*Mt+1)}}},to.prototype.getTile=function(At,at,lt){var Mt=this.options,jt=Mt.extent,Wt=Mt.debug;if(At<0||At>24)return null;var ie=1<<At,te=Sn(At,at=(at%ie+ie)%ie,lt);if(this.tiles[te])return zn(this.tiles[te],jt);Wt>1&&console.log("drilling down to z%d-%d-%d",At,at,lt);for(var qt,Qt=At,Fe=at,He=lt;!qt&&Qt>0;)Qt--,Fe=Math.floor(Fe/2),He=Math.floor(He/2),qt=this.tiles[Sn(Qt,Fe,He)];return qt&&qt.source?(Wt>1&&console.log("found parent tile z%d-%d-%d",Qt,Fe,He),Wt>1&&console.time("drilling down"),this.splitTile(qt.source,Qt,Fe,He,At,at,lt),Wt>1&&console.timeEnd("drilling down"),this.tiles[te]?zn(this.tiles[te],jt):null):null};class Yn extends o.VectorTileWorkerSource{constructor(at,lt,Mt,jt,Wt){super(at,lt,Mt,jt,$n),Wt&&(this.loadGeoJSON=Wt)}loadData(at,lt){const Mt=at&&at.request,jt=Mt&&Mt.collectResourceTiming;this.loadGeoJSON(at,(Wt,ie)=>{if(Wt||!ie)return lt(Wt);if(typeof ie!="object")return lt(new Error(`Input data given to '${at.source}' is not a valid GeoJSON object.`));{yt(ie,!0);try{if(at.filter){const qt=o.createExpression(at.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(qt.result==="error")throw new Error(qt.value.map(Fe=>`${Fe.key}: ${Fe.message}`).join(", "));ie={type:"FeatureCollection",features:ie.features.filter(Fe=>qt.value.evaluate({zoom:0},Fe))}}this._geoJSONIndex=at.cluster?new Ji(function({superclusterOptions:qt,clusterProperties:Qt}){if(!Qt||!qt)return qt;const Fe={},He={},ze={accumulated:null,zoom:0},Di={properties:null},Ei=Object.keys(Qt);for(const zi of Ei){const[Xi,Qi]=Qt[zi],en=o.createExpression(Qi),an=o.createExpression(typeof Xi=="string"?[Xi,["accumulated"],["get",zi]]:Xi);Fe[zi]=en.value,He[zi]=an.value}return qt.map=zi=>{Di.properties=zi;const Xi={};for(const Qi of Ei)Xi[Qi]=Fe[Qi].evaluate(ze,Di);return Xi},qt.reduce=(zi,Xi)=>{Di.properties=Xi;for(const Qi of Ei)ze.accumulated=zi[Qi],zi[Qi]=He[Qi].evaluate(ze,Di)},qt}(at)).load(ie.features):function(qt,Qt){return new to(qt,Qt)}(ie,at.geojsonVtOptions)}catch(qt){return lt(qt)}this.loaded={};const te={};if(jt){const qt=o.getPerformanceMeasurement(Mt);qt&&(te.resourceTiming={},te.resourceTiming[at.source]=JSON.parse(JSON.stringify(qt)))}lt(null,te)}})}reloadTile(at,lt){const Mt=this.loaded;return Mt&&Mt[at.uid]?super.reloadTile(at,lt):this.loadTile(at,lt)}loadGeoJSON(at,lt){if(at.request)o.getJSON(at.request,lt);else{if(typeof at.data!="string")return lt(new Error(`Input data given to '${at.source}' is not a valid GeoJSON object.`));try{return lt(null,JSON.parse(at.data))}catch{return lt(new Error(`Input data given to '${at.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(at,lt){try{lt(null,this._geoJSONIndex.getClusterExpansionZoom(at.clusterId))}catch(Mt){lt(Mt)}}getClusterChildren(at,lt){try{lt(null,this._geoJSONIndex.getChildren(at.clusterId))}catch(Mt){lt(Mt)}}getClusterLeaves(at,lt){try{lt(null,this._geoJSONIndex.getLeaves(at.clusterId,at.limit,at.offset))}catch(Mt){lt(Mt)}}}class El{constructor(at){this.self=at,this.actor=new o.Actor(at,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:Yn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(lt,Mt)=>{if(this.workerSourceTypes[lt])throw new Error(`Worker source with name "${lt}" already registered.`);this.workerSourceTypes[lt]=Mt},this.self.registerRTLTextPlugin=lt=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=lt.applyArabicShaping,o.plugin.processBidirectionalText=lt.processBidirectionalText,o.plugin.processStyledBidirectionalText=lt.processStyledBidirectionalText}}clearCaches(at,lt,Mt){delete this.layerIndexes[at],delete this.availableImages[at],delete this.workerSources[at],delete this.demWorkerSources[at],Mt()}checkIfReady(at,lt,Mt){Mt()}setReferrer(at,lt){this.referrer=lt}spriteLoaded(at,lt){this.isSpriteLoaded[at]=lt;for(const Mt in this.workerSources[at]){const jt=this.workerSources[at][Mt];for(const Wt in jt)jt[Wt]instanceof o.VectorTileWorkerSource&&(jt[Wt].isSpriteLoaded=lt,jt[Wt].fire(new o.Event("isSpriteLoaded")))}}setImages(at,lt,Mt){this.availableImages[at]=lt;for(const jt in this.workerSources[at]){const Wt=this.workerSources[at][jt];for(const ie in Wt)Wt[ie].availableImages=lt}Mt()}enableTerrain(at,lt,Mt){this.terrain=lt,Mt()}setProjection(at,lt){this.projections[at]=o.getProjection(lt)}setLayers(at,lt,Mt){this.getLayerIndex(at).replace(lt),Mt()}updateLayers(at,lt,Mt){this.getLayerIndex(at).update(lt.layers,lt.removedIds),Mt()}loadTile(at,lt,Mt){const jt=this.enableTerrain?o.extend({enableTerrain:this.terrain},lt):lt;jt.projection=this.projections[at]||this.defaultProjection,this.getWorkerSource(at,lt.type,lt.source).loadTile(jt,Mt)}loadDEMTile(at,lt,Mt){const jt=this.enableTerrain?o.extend({buildQuadTree:this.terrain},lt):lt;this.getDEMWorkerSource(at,lt.source).loadTile(jt,Mt)}reloadTile(at,lt,Mt){const jt=this.enableTerrain?o.extend({enableTerrain:this.terrain},lt):lt;jt.projection=this.projections[at]||this.defaultProjection,this.getWorkerSource(at,lt.type,lt.source).reloadTile(jt,Mt)}abortTile(at,lt,Mt){this.getWorkerSource(at,lt.type,lt.source).abortTile(lt,Mt)}removeTile(at,lt,Mt){this.getWorkerSource(at,lt.type,lt.source).removeTile(lt,Mt)}removeSource(at,lt,Mt){if(!this.workerSources[at]||!this.workerSources[at][lt.type]||!this.workerSources[at][lt.type][lt.source])return;const jt=this.workerSources[at][lt.type][lt.source];delete this.workerSources[at][lt.type][lt.source],jt.removeSource!==void 0?jt.removeSource(lt,Mt):Mt()}loadWorkerSource(at,lt,Mt){try{this.self.importScripts(lt.url),Mt()}catch(jt){Mt(jt.toString())}}syncRTLPluginState(at,lt,Mt){try{o.plugin.setState(lt);const jt=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&jt!=null){this.self.importScripts(jt);const Wt=o.plugin.isParsed();Mt(Wt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${jt}`),Wt)}}catch(jt){Mt(jt.toString())}}getAvailableImages(at){let lt=this.availableImages[at];return lt||(lt=[]),lt}getLayerIndex(at){let lt=this.layerIndexes[at];return lt||(lt=this.layerIndexes[at]=new q),lt}getWorkerSource(at,lt,Mt){if(this.workerSources[at]||(this.workerSources[at]={}),this.workerSources[at][lt]||(this.workerSources[at][lt]={}),!this.workerSources[at][lt][Mt]){const jt={send:(Wt,ie,te,qt,Qt,Fe)=>{this.actor.send(Wt,ie,te,at,Qt,Fe)},scheduler:this.actor.scheduler};this.workerSources[at][lt][Mt]=new this.workerSourceTypes[lt](jt,this.getLayerIndex(at),this.getAvailableImages(at),this.isSpriteLoaded[at])}return this.workerSources[at][lt][Mt]}getDEMWorkerSource(at,lt){return this.demWorkerSources[at]||(this.demWorkerSources[at]={}),this.demWorkerSources[at][lt]||(this.demWorkerSources[at][lt]=new Q),this.demWorkerSources[at][lt]}enforceCacheSizeLimit(at,lt){o.enforceCacheSizeLimit(lt)}getWorkerPerformanceMetrics(at,lt,Mt){Mt(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new El(self)),El}),T(["./shared"],function(o){function z(m,r){if(Array.isArray(m)){if(!Array.isArray(r)||m.length!==r.length)return!1;for(let u=0;u<m.length;u++)if(!z(m[u],r[u]))return!1;return!0}if(typeof m=="object"&&m!==null&&r!==null){if(typeof r!="object"||Object.keys(m).length!==Object.keys(r).length)return!1;for(const u in m)if(!z(m[u],r[u]))return!1;return!0}return m===r}var $=q;function q(m){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,S,M=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(M);try{S=new Worker(D),y=!0}catch{y=!1}return S&&S.terminate(),URL.revokeObjectURL(D),y}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var y=document.createElement("canvas");y.width=y.height=1;var S=y.getContext("2d");if(!S)return!1;var M=S.getImageData(0,0,1,1);return M&&M.width===y.width}()?(Q[u=r&&r.failIfMajorPerformanceCaveat]===void 0&&(Q[u]=function(y){var S,M=function(D){var O=document.createElement("canvas"),j=Object.create(q.webGLContextAttributes);return j.failIfMajorPerformanceCaveat=D,O.getContext("webgl",j)||O.getContext("experimental-webgl",j)}(y);if(!M)return!1;try{S=M.createShader(M.VERTEX_SHADER)}catch{return!1}return!(!S||M.isContextLost())&&(M.shaderSource(S,"void main() {}"),M.compileShader(S),M.getShaderParameter(S,M.COMPILE_STATUS)===!0)}(u)),Q[u]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var u}(m)}var Q={};function nt(m,r,u){const y=o.window.document.createElement(m);return r!==void 0&&(y.className=r),u&&u.appendChild(y),y}function Tt(m,r,u){const y=o.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(const S of Object.keys(r))y.setAttributeNS(null,S,r[S]);return u&&u.appendChild(y),y}q.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const yt=o.window.document&&o.window.document.documentElement.style,Lt=yt&&yt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Nt;function Dt(){yt&&Lt&&(Nt=yt[Lt],yt[Lt]="none")}function wt(){yt&&Lt&&(yt[Lt]=Nt)}function It(m){m.preventDefault(),m.stopPropagation(),o.window.removeEventListener("click",It,!0)}function Xt(){o.window.addEventListener("click",It,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",It,!0)},0)}function Zt(m,r){const u=m.getBoundingClientRect();return ne(m,u,r)}function re(m,r){const u=m.getBoundingClientRect(),y=[];for(let S=0;S<r.length;S++)y.push(ne(m,u,r[S]));return y}function kt(m){return o.window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function ne(m,r,u){const y=m.offsetWidth===r.width?1:m.offsetWidth/r.width;return new o.Point((u.clientX-r.left)*y,(u.clientY-r.top)*y)}function Ut(m,r){var u=r[0],y=r[1],S=r[2],M=r[3],D=u*M-S*y;return D?(m[0]=M*(D=1/D),m[1]=-y*D,m[2]=-S*D,m[3]=u*D,m):null}function Le(m){const{userImage:r}=m;return!!(r&&r.render&&r.render())&&(m.data.replace(new Uint8Array(r.data.buffer)),!0)}class ye extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:u,callback:y}of this.requestors)this._notify(u,y);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,u){this._validate(r,u)&&(this.images[r]=u)}_validate(r,u){let y=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),y=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),y=!1),this._validateContent(u.content,u)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),y=!1),y}_validateStretch(r,u){if(!r)return!0;let y=0;for(const S of r){if(S[0]<y||S[1]<S[0]||u<S[1])return!1;y=S[1]}return!0}_validateContent(r,u){return!(r&&(r.length!==4||r[0]<0||u.data.width<r[0]||r[1]<0||u.data.height<r[1]||r[2]<0||u.data.width<r[2]||r[3]<0||u.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,u){u.version=this.images[r].version+1,this.images[r]=u,this.updatedImages[r]=!0}removeImage(r){const u=this.images[r];delete this.images[r],delete this.patterns[r],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,u){let y=!0;if(!this.isLoaded())for(const S of r)this.images[S]||(y=!1);this.isLoaded()||y?this._notify(r,u):this.requestors.push({ids:r,callback:u})}_notify(r,u){const y={};for(const S of r){this.images[S]||this.fire(new o.Event("styleimagemissing",{id:S}));const M=this.images[S];M?y[S]={data:M.data.clone(),pixelRatio:M.pixelRatio,sdf:M.sdf,version:M.version,stretchX:M.stretchX,stretchY:M.stretchY,content:M.content,hasRenderCallback:!!(M.userImage&&M.userImage.render)}:o.warnOnce(`Image "${S}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,y)}getPixelSize(){const{width:r,height:u}=this.atlasImage;return{width:r,height:u}}getPattern(r){const u=this.patterns[r],y=this.getImage(r);if(!y)return null;if(u&&u.position.version===y.version)return u.position;if(u)u.position.version=y.version;else{const S={w:y.data.width+2,h:y.data.height+2,x:0,y:0},M=new o.ImagePosition(S,y);this.patterns[r]={bin:S,position:M}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const u=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(r,this.atlasImage,u.RGBA),this.atlasTexture&&this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const M in this.patterns)r.push(this.patterns[M].bin);const{w:u,h:y}=o.potpack(r),S=this.atlasImage;S.resize({width:u||1,height:y||1});for(const M in this.patterns){const{bin:D}=this.patterns[M],O=D.x+1,j=D.y+1,H=this.images[M].data,X=H.width,tt=H.height;o.RGBAImage.copy(H,S,{x:0,y:0},{x:O,y:j},{width:X,height:tt}),o.RGBAImage.copy(H,S,{x:0,y:tt-1},{x:O,y:j-1},{width:X,height:1}),o.RGBAImage.copy(H,S,{x:0,y:0},{x:O,y:j+tt},{width:X,height:1}),o.RGBAImage.copy(H,S,{x:X-1,y:0},{x:O-1,y:j},{width:1,height:tt}),o.RGBAImage.copy(H,S,{x:0,y:0},{x:O+X,y:j},{width:1,height:tt})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const u of r){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const y=this.images[u];Le(y)&&this.updateImage(u,y)}}}const Ce=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(m,r){return function([u,y,S]){const M=o.degToRad(y+90),D=o.degToRad(S);return{x:u*Math.cos(M)*Math.sin(D),y:u*Math.sin(M)*Math.sin(D),z:u*Math.cos(D),azimuthal:y,polar:S}}(m.expression.evaluate(r))}interpolate(m,r,u){return{x:o.number(m.x,r.x,u),y:o.number(m.y,r.y,u),z:o.number(m.z,r.z,u),azimuthal:o.number(m.azimuthal,r.azimuthal,u),polar:o.number(m.polar,r.polar,u)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)});class di extends o.Evented{constructor(r){super(),this._transitionable=new o.Transitionable(Ce),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,u={}){if(!this._validate(o.validateLight,r,u))for(const y in r){const S=r[y];o.endsWith(y,"-transition")?this._transitionable.setTransition(y.slice(0,-11),S):this._transitionable.setValue(y,S)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,u,y){return(!y||y.validate!==!1)&&o.emitValidationErrors(this,r.call(o.validateStyle,o.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const Ti=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)});let Ge=class extends o.Evented{constructor(m,r){super(),this._transitionable=new o.Transitionable(Ti),this.set(m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(m){for(const r in m){const u=m[r];o.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-11),u):this._transitionable.setValue(r,u)}}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}};function li(m,r,u,y){const S=o.smoothstep(45,65,u),[M,D]=fi(m,y),O=o.length(r);let j=1-Math.min(1,Math.exp((O-M)/(D-M)*-6));return j*=j*j,j=Math.min(1,1.00747*j),j*S*m.alpha}function fi(m,r){const u=.5/Math.tan(.5*r);return[m.range[0]+u,m.range[1]+u]}const pi=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])});class Ns extends o.Evented{constructor(r,u){super(),this._transitionable=new o.Transitionable(pi),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=u}get state(){const r=this._transform,u=r.projection.name==="globe",y=o.globeToMercatorTransition(r.zoom),S=this.properties.get("range"),M=[.5,3];return{range:u?[o.number(M[0],S[0],y),o.number(M[1],S[1],y)]:S,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,u={}){if(!this._validate(o.validateFog,r,u)){for(const y of Object.keys(o.spec.fog))r&&r[y]===void 0&&(r[y]=o.spec.fog[y].default);for(const y in r){const S=r[y];o.endsWith(y,"-transition")?this._transitionable.setTransition(y.slice(0,-11),S):this._transitionable.setValue(y,S)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,r))*u.a}getOpacityAtLatLng(r,u){return this._transform.projection.supportsFog?function(y,S,M){const D=o.MercatorCoordinate.fromLngLat(S),O=M.elevation?M.elevation.getAtPointOrZero(D):0,j=[D.x,D.y,O];return o.transformMat4(j,j,M.mercatorFogMatrix),li(y,j,M.pitch,M._fov)}(this.state,r,u):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?fi(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,u,y){return(!y||y.validate!==!1)&&o.emitValidationErrors(this,r.call(o.validateStyle,o.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class hs{constructor(r,u){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const y=this.workerPool.acquire(this.id);for(let S=0;S<y.length;S++){const M=new hs.Actor(y[S],u,this.id);M.name=`Worker ${S}`,this.actors.push(M)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,u,y){o.asyncAll(this.actors,(S,M)=>{S.send(r,u,M)},y=y||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Yi(m,r,u){return r*(o.EXTENT/(m.tileSize*Math.pow(2,u-m.tileID.overscaledZ)))}hs.Actor=o.Actor;class Zs{constructor(r,u,y,S){this.screenBounds=r,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,S)}static createFromScreenPoints(r,u){let y,S;if(r instanceof o.Point||typeof r[0]=="number"){const M=o.Point.convert(r);y=[M],S=u.isPointAboveHorizon(M)}else{const M=o.Point.convert(r[0]),D=o.Point.convert(r[1]);y=[M,D],S=o.polygonizeBounds(M,D).every(O=>u.isPointAboveHorizon(O))}return new Zs(y,u.getCameraPoint(),S,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const u=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new o.Point(1,1)):this.screenBounds[1],S=o.polygonizeBounds(u,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<y.x?S.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?S[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(S[3]=this.cameraPoint)),o.bufferConvexPolygon(S,r)}bufferedCameraGeometryGlobe(r){const u=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new o.Point(1,1)):this.screenBounds[1],S=o.polygonizeBounds(u,y,r),M=this.cameraPoint.clone();switch(3*((M.y>u.y)+(M.y>y.y))+((M.x>u.x)+(M.x>y.x))){case 0:S[0]=M,S[4]=M.clone();break;case 1:S.splice(1,0,M);break;case 2:S[1]=M;break;case 3:S.splice(4,0,M);break;case 5:S.splice(2,0,M);break;case 6:S[3]=M;break;case 7:S.splice(3,0,M);break;case 8:S[2]=M}return S}containsTile(r,u,y,S=0){const M=r.queryPadding/u._pixelsPerMercatorPixel+1,D=y?this._bufferedCameraMercator(M,u):this._bufferedScreenMercator(M,u);let O=r.tileID.wrap+(D.unwrapped?S:0);const j=D.polygon.map(xt=>o.getTilePoint(r.tileTransform,xt,O));if(!o.polygonIntersectsBox(j,0,0,o.EXTENT,o.EXTENT))return;O=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?S:0);const H=this.screenGeometryMercator.polygon.map(xt=>o.getTileVec3(r.tileTransform,xt,O)),X=H.map(xt=>new o.Point(xt[0],xt[1])),tt=u.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),ht=o.getTileVec3(r.tileTransform,tt,O),pt=H.map(xt=>{const et=o.sub(xt,xt,ht);return o.normalize(et,et),new o.Ray(ht,et)}),gt=Yi(r,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:X,tilespaceRays:pt,bufferedTilespaceGeometry:j,bufferedTilespaceBounds:(mt=o.getBounds(j),mt.min.x=o.clamp(mt.min.x,0,o.EXTENT),mt.min.y=o.clamp(mt.min.y,0,o.EXTENT),mt.max.x=o.clamp(mt.max.x,0,o.EXTENT),mt.max.y=o.clamp(mt.max.y,0,o.EXTENT),mt),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:gt};var mt}_bufferedScreenMercator(r,u){const y=Ds(r);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let S;return S=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),u):{polygon:this.bufferedScreenGeometry(r).map(M=>u.pointCoordinate3D(M)),unwrapped:!0},this._screenRaycastCache[y]=S,S}}_bufferedCameraMercator(r,u){const y=Ds(r);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let S;return S=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),u):{polygon:this.bufferedCameraGeometry(r).map(M=>u.pointCoordinate3D(M)),unwrapped:!0},this._cameraRaycastCache[y]=S,S}}_projectAndResample(r,u){const y=function(M,D){const O=o.multiply([],D.pixelMatrix,D.globeMatrix),j=[0,-o.GLOBE_RADIUS,0,1],H=[0,o.GLOBE_RADIUS,0,1],X=[0,0,0,1];o.transformMat4$1(j,j,O),o.transformMat4$1(H,H,O),o.transformMat4$1(X,X,O);const tt=new o.Point(j[0]/j[3],j[1]/j[3]),ht=new o.Point(H[0]/H[3],H[1]/H[3]),pt=o.polygonContainsPoint(M,tt)&&j[3]<X[3],gt=o.polygonContainsPoint(M,ht)&&H[3]<X[3];if(!pt&&!gt)return null;const mt=function(Gt,Jt,Yt){for(let ae=1;ae<Gt.length;ae++){const ke=Tn(Jt.pointCoordinate3D(Gt[ae-1]).x),se=Tn(Jt.pointCoordinate3D(Gt[ae]).x);if(Yt<0){if(ke<se)return{idx:ae,t:-ke/(se-1-ke)}}else if(se<ke)return{idx:ae,t:(1-ke)/(se+1-ke)}}return null}(M,D,pt?-1:1);if(!mt)return null;const{idx:xt,t:et}=mt;let ft=xt>1?Ji(M.slice(0,xt),D):[],St=xt<M.length?Ji(M.slice(xt),D):[];ft=ft.map(Gt=>new o.Point(Tn(Gt.x),Gt.y)),St=St.map(Gt=>new o.Point(Tn(Gt.x),Gt.y));const Et=[...ft];Et.length===0&&Et.push(St[St.length-1]);const $t=o.number(Et[Et.length-1].y,(St.length===0?ft[0]:St[0]).y,et);let Rt;return Rt=pt?[new o.Point(0,$t),new o.Point(0,0),new o.Point(1,0),new o.Point(1,$t)]:[new o.Point(1,$t),new o.Point(1,1),new o.Point(0,1),new o.Point(0,$t)],Et.push(...Rt),St.length===0?Et.push(ft[0]):Et.push(...St),{polygon:Et.map(Gt=>new o.MercatorCoordinate(Gt.x,Gt.y)),unwrapped:!1}}(r,u);if(y)return y;const S=function(M,D){let O=!1,j=-1/0,H=0;for(let tt=0;tt<M.length-1;tt++)M[tt].x>j&&(j=M[tt].x,H=tt);for(let tt=0;tt<M.length-1;tt++){const ht=(H+tt)%(M.length-1),pt=M[ht],gt=M[ht+1];Math.abs(pt.x-gt.x)>.5&&(pt.x<gt.x?(pt.x+=1,ht===0&&(M[M.length-1].x+=1)):(gt.x+=1,ht+1===M.length-1&&(M[0].x+=1)),O=!0)}const X=o.mercatorXfromLng(D.center.lng);return O&&X<Math.abs(X-1)&&M.forEach(tt=>{tt.x-=1}),{polygon:M,unwrapped:O}}(Ji(r,u).map(M=>new o.Point(Tn(M.x),M.y)),u);return{polygon:S.polygon.map(M=>new o.MercatorCoordinate(M.x,M.y)),unwrapped:S.unwrapped}}}function Ji(m,r){return o.resample(m,u=>{const y=r.pointCoordinate3D(u);u.x=y.x,u.y=y.y},1/256)}function Tn(m){return m<0?1+m%1:m%1}function Ds(m){return 100*m|0}function Me(m,r,u,y,S){const M=function(D,O){if(D)return S(D);if(O){m.url&&O.tiles&&m.tiles&&delete m.tiles;const j=o.pick(o.extend(O,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);O.vector_layers&&(j.vectorLayers=O.vector_layers,j.vectorLayerIds=j.vectorLayers.map(H=>H.id)),j.tiles=r.canonicalizeTileset(j,m.url),S(null,j)}};return m.url?o.getJSON(r.transformRequest(r.normalizeSourceURL(m.url,null,u,y),o.ResourceType.Source),M):o.exported.frame(()=>M(null,m))}class ci{constructor(r,u,y){this.bounds=o.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=u||0,this.maxzoom=y||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const u=Math.pow(2,r.z),y=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*u),S=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*u),M=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*u),D=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*u);return r.x>=y&&r.x<M&&r.y>=S&&r.y<D}}class ni{constructor(r,u,y){this.context=r;const S=r.gl;this.buffer=S.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const _i={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ss{constructor(r,u,y,S){this.length=u.length,this.attributes=y,this.itemSize=u.bytesPerElement,this.dynamicDraw=S,this.context=r;const M=r.gl;this.buffer=M.createBuffer(),r.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,u){for(let y=0;y<this.attributes.length;y++){const S=u.attributes[this.attributes[y].name];S!==void 0&&r.enableVertexAttribArray(S)}}setVertexAttribPointers(r,u,y){for(let S=0;S<this.attributes.length;S++){const M=this.attributes[S],D=u.attributes[M.name];D!==void 0&&r.vertexAttribPointer(D,M.components,r[_i[M.type]],!1,this.itemSize,M.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class xi{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class _t extends xi{getDefault(){return o.Color.transparent}set(r){const u=this.current;(r.r!==u.r||r.g!==u.g||r.b!==u.b||r.a!==u.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class zt extends xi{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class fe extends xi{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Se extends xi{getDefault(){return[!0,!0,!0,!0]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class be extends xi{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Ue extends xi{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class ei extends xi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const u=this.current;(r.func!==u.func||r.ref!==u.ref||r.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class We extends xi{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Xe extends xi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=r,this.dirty=!1}}class Ve extends xi{getDefault(){return[0,1]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Ci extends xi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=r,this.dirty=!1}}class ti extends xi{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class wi extends xi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.BLEND):u.disable(u.BLEND),this.current=r,this.dirty=!1}}class Pi extends xi{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class ts extends xi{getDefault(){return o.Color.transparent}set(r){const u=this.current;(r.r!==u.r||r.g!==u.g||r.b!==u.b||r.a!==u.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class es extends xi{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class ns extends xi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=r,this.dirty=!1}}class zn extends xi{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class tn extends xi{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let Vn,is=class extends xi{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class fr extends xi{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class to extends xi{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Sn extends xi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class $n extends xi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Yn extends xi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class El extends xi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class At extends xi{getDefault(){return null}set(r){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class at extends xi{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class lt extends xi{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Mt extends xi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class jt extends xi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Wt extends xi{constructor(r,u){super(r),this.context=r,this.parent=u}getDefault(){return null}}class ie extends Wt{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class te extends Wt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class qt extends te{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Qt{constructor(r,u,y,S){this.context=r,this.width=u,this.height=y;const M=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new ie(r,M),S&&(this.depthAttachment=new te(r,M))}destroy(){const r=this.context.gl,u=this.colorAttachment.get();if(u&&r.deleteTexture(u),this.depthAttachment){const y=this.depthAttachment.get();y&&r.deleteRenderbuffer(y)}r.deleteFramebuffer(this.framebuffer)}}class Fe{constructor(r,u=!1){if(this.gl=r,this.isWebGL2=u,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),u){const y=r;this.extVertexArrayObject={createVertexArrayOES:y.createVertexArray.bind(r),deleteVertexArrayOES:y.deleteVertexArray.bind(r),bindVertexArrayOES:y.bindVertexArray.bind(r)}}this.clearColor=new _t(this),this.clearDepth=new zt(this),this.clearStencil=new fe(this),this.colorMask=new Se(this),this.depthMask=new be(this),this.stencilMask=new Ue(this),this.stencilFunc=new ei(this),this.stencilOp=new We(this),this.stencilTest=new Xe(this),this.depthRange=new Ve(this),this.depthTest=new Ci(this),this.depthFunc=new ti(this),this.blend=new wi(this),this.blendFunc=new Pi(this),this.blendColor=new ts(this),this.blendEquation=new es(this),this.cullFace=new ns(this),this.cullFaceSide=new zn(this),this.frontFace=new tn(this),this.program=new is(this),this.activeTexture=new fr(this),this.viewport=new to(this),this.bindFramebuffer=new Sn(this),this.bindRenderbuffer=new $n(this),this.bindTexture=new Yn(this),this.bindVertexBuffer=new El(this),this.bindElementBuffer=new At(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new at(this),this.pixelStoreUnpack=new lt(this),this.pixelStoreUnpackPremultiplyAlpha=new Mt(this),this.pixelStoreUnpackFlipY=new jt(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),u||(this.extTextureHalfFloat=r.getExtension("OES_texture_half_float")),(u||this.extTextureHalfFloat&&r.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=u||r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,u){return new ni(this,r,u)}createVertexBuffer(r,u,y){return new ss(this,r,u,y)}createRenderbuffer(r,u,y){const S=this.gl,M=S.createRenderbuffer();return this.bindRenderbuffer.set(M),S.renderbufferStorage(S.RENDERBUFFER,r,u,y),this.bindRenderbuffer.set(null),M}createFramebuffer(r,u,y){return new Qt(this,r,u,y)}clear({color:r,depth:u,stencil:y}){const S=this.gl;let M=0;r&&(M|=S.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(M|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),y!==void 0&&(M|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),S.clear(M)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){z(r.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class He extends o.Evented{constructor(r,u,y,S){if(super(),this.id=r,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(u,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(S),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(r){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map._worldview;this._tileJSONRequest=Me(this._options,this.map._requestManager,u,y,(S,M)=>{this._tileJSONRequest=null,this._loaded=!0,S?(u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),y&&y.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new o.ErrorEvent(S))):M&&(o.extend(this,M),M.bounds&&(this.tileBounds=new ci(M.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(M.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(S)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(r,u){const y=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),S={request:this.map._requestManager.transformRequest(y,o.ResourceType.Tile),data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile};if(S.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=u:r.request=r.actor.send("reloadTile",S,M.bind(this));else if(r.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",S,M.bind(this),void 0,!0);else{const D=o.loadVectorTile.call({deduped:this._deduped},S,(O,j)=>{O||!j?M.call(this,O):(S.data={cacheControl:j.cacheControl,expires:j.expires,rawData:j.rawData.slice(0)},r.actor&&r.actor.send("loadTile",S,M.bind(this),void 0,!0))},!0);r.request={cancel:D}}function M(D,O){return delete r.request,r.aborted?u(null):D&&D.status!==404?u(D):(O&&O.resourceTiming&&(r.resourceTiming=O.resourceTiming),this.map._refreshExpiredTiles&&O&&r.setExpiryData(O),r.loadVectorData(O,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),u(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id})}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ze extends o.Evented{constructor(r,u,y,S){super(),this.id=r,this.dispatcher=y,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},u),o.extend(this,o.pick(u,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Me(this._options,this.map._requestManager,null,null,(u,y)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new o.ErrorEvent(u)):y&&(o.extend(this,y),y.bounds&&(this.tileBounds=new ci(y.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(y.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(u)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,u){const y=o.exported.devicePixelRatio>=2,S=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);r.request=o.getImage(this.map._requestManager.transformRequest(S,o.ResourceType.Tile),(M,D,O,j)=>(delete r.request,r.aborted?(r.state="unloaded",u(null)):M?(r.state="errored",u(M)):D?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:O,expires:j}),r.setTexture(D,this.map.painter),r.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void u(null)):u(null)))}static loadTileData(r,u,y){r.setTexture(u,y)}static unloadTileData(r,u){r.texture&&u.saveTileTexture(r.texture)}abortTile(r,u){r.request&&(r.request.cancel(),delete r.request),u()}unloadTile(r,u){r.texture&&this.map.painter.saveTileTexture(r.texture),u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Di(m,r,u,y,S,M,D,O){const j=[m,u,S,r,y,M,1,1,1],H=[D,O,1],X=o.adjoint([],j),[tt,ht,pt]=o.transformMat3(H,H,o.transpose(X,X));return o.multiply$1(j,[tt,0,0,0,ht,0,0,0,pt],j)}class Ei extends o.Evented{constructor(r,u,y,S){super(),this.id=r,this.dispatcher=y,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(S),this.options=u,this._dirty=!1}load(r,u){this._loaded=u||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(y,S)=>{if(this._imageRequest=null,this._loaded=!0,y)this.fire(new o.ErrorEvent(y));else if(S){const{HTMLImageElement:M}=o.window;this.image=S instanceof M?o.exported.getImageData(S):S,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const u=r.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(y){let S=1/0,M=1/0,D=-1/0,O=-1/0;for(const tt of y)S=Math.min(S,tt.x),M=Math.min(M,tt.y),D=Math.max(D,tt.x),O=Math.max(O,tt.y);const j=Math.max(D-S,O-M),H=Math.max(0,Math.floor(-Math.log(j)/Math.LN2)),X=Math.pow(2,H);return new o.CanonicalTileID(H,Math.floor((S+D)/2*X),Math.floor((M+O)/2*X))}(u),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const j in this.tiles){const H=this.tiles[j];H.state!=="loaded"&&(H.state="loaded",H.texture=this.texture)}if(this._boundsArray)return;const u=o.tileTransform(this.tileID,this.map.transform.projection),[y,S,M,D]=this.coordinates.map(j=>{const H=u.projection.project(j[0],j[1]);return o.getTilePoint(u,H)._round()});this.perspectiveTransform=function(j,H,X,tt,ht,pt,gt,mt,xt,et){const ft=Di(0,0,j,0,0,H,j,H),St=Di(X,tt,ht,pt,gt,mt,xt,et);return o.multiply$1(St,o.adjoint(ft,ft),St),[St[6]/St[8]*j/o.EXTENT,St[7]/St[8]*H/o.EXTENT]}(this.width,this.height,y.x,y.y,S.x,S.y,D.x,D.y,M.x,M.y);const O=this._boundsArray=new o.StructArrayLayout4i8;O.emplaceBack(y.x,y.y,0,0),O.emplaceBack(S.x,S.y,o.EXTENT,0),O.emplaceBack(D.x,D.y,0,o.EXTENT),O.emplaceBack(M.x,M.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(O,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,u=r.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(r,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(r)}loadTile(r,u){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},u(null)):(r.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const zi={vector:He,raster:ze,"raster-dem":class extends ze{constructor(m,r,u,y){super(m,r,u,y),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(m,r){const u=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(S,M){S&&(m.state="errored",r(S)),M&&(m.dem=M,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",r(null))}m.request=o.getImage(this.map._requestManager.transformRequest(u,o.ResourceType.Tile),(function(S,M,D,O){if(delete m.request,m.aborted)m.state="unloaded",r(null);else if(S)m.state="errored",r(S);else if(M){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:D,expires:O});const j=o.window.ImageBitmap&&M instanceof o.window.ImageBitmap&&(Vn==null&&(Vn=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),Vn),H=1-(M.width-o.prevPowerOfTwo(M.width))/2;H<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const X=j?M:o.exported.getImageData(M,H),tt={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:X,encoding:this.encoding,padding:H};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",tt,y.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){const r=m.canonical,u=Math.pow(2,r.z),y=(r.x-1+u)%u,S=r.x===0?m.wrap-1:m.wrap,M=(r.x+1+u)%u,D=r.x+1===u?m.wrap+1:m.wrap,O={};return O[new o.OverscaledTileID(m.overscaledZ,S,r.z,y,r.y).key]={backfilled:!1},O[new o.OverscaledTileID(m.overscaledZ,D,r.z,M,r.y).key]={backfilled:!1},r.y>0&&(O[new o.OverscaledTileID(m.overscaledZ,S,r.z,y,r.y-1).key]={backfilled:!1},O[new o.OverscaledTileID(m.overscaledZ,m.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},O[new o.OverscaledTileID(m.overscaledZ,D,r.z,M,r.y-1).key]={backfilled:!1}),r.y+1<u&&(O[new o.OverscaledTileID(m.overscaledZ,S,r.z,y,r.y+1).key]={backfilled:!1},O[new o.OverscaledTileID(m.overscaledZ,m.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},O[new o.OverscaledTileID(m.overscaledZ,D,r.z,M,r.y+1).key]={backfilled:!1}),O}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends o.Evented{constructor(m,r,u,y){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(y),this._data=r.data,this._options=o.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const S=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*S,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*S,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.EXTENT,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*S,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},r),this}getClusterChildren(m,r){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},r),this}getClusterLeaves(m,r,u,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:r,offset:u},y),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const m=o.extend({},this.workerOptions),r=this._data;typeof r=="string"?(m.request=this.map._requestManager.transformRequest(o.exported.resolveURL(r),o.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(u,y)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new o.ErrorEvent(u));else{const S={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(S.resourceTiming=y.resourceTiming[this.id]),this.fire(new o.Event("data",S)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,r){const u=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(u,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(y,S)=>(delete m.request,m.unloadVectorData(),m.aborted?r(null):y?r(y):(m.loadVectorData(S,this.map.painter,u==="reloadTile"),r(null))),void 0,u==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ei{constructor(m,r,u,y){super(m,r,u,y),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const r of m.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.ResourceType.Source).url);o.getVideo(this.urls,(r,u)=>{this._loaded=!0,r?this.fire(new o.ErrorEvent(r)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const r=this.video.seekable;m<r.start(0)||m>r.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,r=m.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(m,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ei,canvas:class extends Ei{constructor(m,r,u,y){super(m,r,u,y),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(S=>!Array.isArray(S)||S.length!==2||S.some(M=>typeof M!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends o.Evented{constructor(m,r,u,y){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=r,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ci(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:r,y:u,z:y}=m.canonical;return this._implementation.hasTile({x:r,y:u,z:y})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,r){const{x:u,y,z:S}=m.tileID.canonical,M=new o.window.AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:u,y,z:S},{signal:M.signal})).then((function(D){return delete m.request,m.aborted?(m.state="unloaded",r(null)):D===void 0?(m.state="errored",r(null)):D===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",r(null)):function(O){return O instanceof o.window.ImageData||O instanceof o.window.HTMLCanvasElement||O instanceof o.window.ImageBitmap||O instanceof o.window.HTMLImageElement}(D)?(this.loadTileData(m,D),m.state="loaded",void r(null)):(m.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(D=>{D.code!==20&&(m.state="errored",r(D))}),m.request.cancel=()=>M.abort()}loadTileData(m,r){ze.loadTileData(m,r,this._map.painter)}unloadTileData(m){ze.unloadTileData(m,this._map.painter)}unloadTile(m,r){if(this.unloadTileData(m),this._implementation.unloadTile){const{x:u,y,z:S}=m.tileID.canonical;this._implementation.unloadTile({x:u,y,z:S})}r()}abortTile(m,r){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Xi=function(m,r,u,y){const S=new zi[r.type](m,r,u,y);if(S.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${S.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],S),S};function Qi(m,r){const u=o.identity([]);return o.scale(u,u,[.5*m.width,.5*-m.height,1]),o.translate(u,u,[1,-1,0]),o.multiply(u,u,m.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(u)}function en(m,r,u,y,S,M,D,O=!1){const j=m.tilesIn(y,D,O);j.sort(Kn);const H=[];for(const tt of j)H.push({wrappedTileID:tt.tile.tileID.wrapped().key,queryResults:tt.tile.queryRenderedFeatures(r,u,m._state,tt,S,M,Qi(m.transform,tt.tile.tileID),O)});const X=function(tt){const ht={},pt={};for(const gt of tt){const mt=gt.queryResults,xt=gt.wrappedTileID,et=pt[xt]=pt[xt]||{};for(const ft in mt){const St=mt[ft],Et=et[ft]=et[ft]||{},$t=ht[ft]=ht[ft]||[];for(const Rt of St)Et[Rt.featureIndex]||(Et[Rt.featureIndex]=!0,$t.push(Rt))}}return ht}(H);for(const tt in X)X[tt].forEach(ht=>{const pt=ht.feature,gt=pt.layer;gt&&gt.type!=="background"&&gt.type!=="sky"&&(pt.source=gt.source,gt["source-layer"]&&(pt.sourceLayer=gt["source-layer"]),pt.state=pt.id!==void 0?m.getFeatureState(gt["source-layer"],pt.id):{})});return X}function an(m,r){const u=m.getRenderableIds().map(M=>m.getTileByID(M)),y=[],S={};for(let M=0;M<u.length;M++){const D=u[M],O=D.tileID.canonical.key;S[O]||(S[O]=!0,D.querySourceFeatures(y,r))}return y}function Kn(m,r){const u=m.tileID,y=r.tileID;return u.overscaledZ-y.overscaledZ||u.canonical.y-y.canonical.y||u.wrap-y.wrap||u.canonical.x-y.canonical.x}function Pn(){return Xl.workerClass!=null?new Xl.workerClass:new o.window.Worker(Xl.workerUrl)}const wo="mapboxgl_preloaded_worker_pool";class In{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<In.workerCount;)this.workers.push(new Pn);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[wo]}numActive(){return Object.keys(this.active).length}}let er;function mn(){return er||(er=new In),er}function Ef(m,r){const u={};for(const y in m)y!=="ref"&&(u[y]=m[y]);return o.refProperties.forEach(y=>{y in r&&(u[y]=r[y])}),u}function Mf(m){m=m.slice();const r=Object.create(null);for(let u=0;u<m.length;u++)r[m[u].id]=m[u];for(let u=0;u<m.length;u++)"ref"in m[u]&&(m[u]=Ef(m[u],r[m[u].ref]));return m}In.workerCount=2;const ms={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Nu(m,r,u){u.push({command:ms.addSource,args:[m,r[m]]})}function yc(m,r,u){r.push({command:ms.removeSource,args:[m]}),u[m]=!0}function mh(m,r,u,y){yc(m,u,y),Nu(m,r,u)}function gh(m,r,u){let y;for(y in m[u])if(m[u].hasOwnProperty(y)&&y!=="data"&&!z(m[u][y],r[u][y]))return!1;for(y in r[u])if(r[u].hasOwnProperty(y)&&y!=="data"&&!z(m[u][y],r[u][y]))return!1;return!0}function eo(m,r,u,y,S,M){let D;for(D in r=r||{},m=m||{})m.hasOwnProperty(D)&&(z(m[D],r[D])||u.push({command:M,args:[y,D,r[D],S]}));for(D in r)r.hasOwnProperty(D)&&!m.hasOwnProperty(D)&&(z(m[D],r[D])||u.push({command:M,args:[y,D,r[D],S]}))}function To(m){return m.id}function ju(m,r){return m[r.id]=r,m}class xc{constructor(r,u){this.reset(r,u)}reset(r,u){this.points=r||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.clamp(r,0,1);let u=1,y=this._distances[u];const S=r*this.paddedLength+this.padding;for(;y<S&&u<this._distances.length;)y=this._distances[++u];const M=u-1,D=this._distances[M],O=y-D,j=O>0?(S-D)/O:0;return this.points[M].mult(1-j).add(this.points[u].mult(j))}}class So{constructor(r,u,y){const S=this.boxCells=[],M=this.circleCells=[];this.xCellCount=Math.ceil(r/y),this.yCellCount=Math.ceil(u/y);for(let D=0;D<this.xCellCount*this.yCellCount;D++)S.push([]),M.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=u,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,u,y,S,M){this._forEachCell(u,y,S,M,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(u),this.bboxes.push(y),this.bboxes.push(S),this.bboxes.push(M)}insertCircle(r,u,y,S){this._forEachCell(u-S,y-S,u+S,y+S,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(u),this.circles.push(y),this.circles.push(S)}_insertBoxCell(r,u,y,S,M,D){this.boxCells[M].push(D)}_insertCircleCell(r,u,y,S,M,D){this.circleCells[M].push(D)}_query(r,u,y,S,M,D){if(y<0||r>this.width||S<0||u>this.height)return!M&&[];const O=[];if(r<=0&&u<=0&&this.width<=y&&this.height<=S){if(M)return!0;for(let j=0;j<this.boxKeys.length;j++)O.push({key:this.boxKeys[j],x1:this.bboxes[4*j],y1:this.bboxes[4*j+1],x2:this.bboxes[4*j+2],y2:this.bboxes[4*j+3]});for(let j=0;j<this.circleKeys.length;j++){const H=this.circles[3*j],X=this.circles[3*j+1],tt=this.circles[3*j+2];O.push({key:this.circleKeys[j],x1:H-tt,y1:X-tt,x2:H+tt,y2:X+tt})}return D?O.filter(D):O}return this._forEachCell(r,u,y,S,this._queryCell,O,{hitTest:M,seenUids:{box:{},circle:{}}},D),M?O.length>0:O}_queryCircle(r,u,y,S,M){const D=r-y,O=r+y,j=u-y,H=u+y;if(O<0||D>this.width||H<0||j>this.height)return!S&&[];const X=[];return this._forEachCell(D,j,O,H,this._queryCellCircle,X,{hitTest:S,circle:{x:r,y:u,radius:y},seenUids:{box:{},circle:{}}},M),S?X.length>0:X}query(r,u,y,S,M){return this._query(r,u,y,S,!1,M)}hitTest(r,u,y,S,M){return this._query(r,u,y,S,!0,M)}hitTestCircle(r,u,y,S){return this._queryCircle(r,u,y,!0,S)}_queryCell(r,u,y,S,M,D,O,j){const H=O.seenUids,X=this.boxCells[M];if(X!==null){const ht=this.bboxes;for(const pt of X)if(!H.box[pt]){H.box[pt]=!0;const gt=4*pt;if(r<=ht[gt+2]&&u<=ht[gt+3]&&y>=ht[gt+0]&&S>=ht[gt+1]&&(!j||j(this.boxKeys[pt]))){if(O.hitTest)return D.push(!0),!0;D.push({key:this.boxKeys[pt],x1:ht[gt],y1:ht[gt+1],x2:ht[gt+2],y2:ht[gt+3]})}}}const tt=this.circleCells[M];if(tt!==null){const ht=this.circles;for(const pt of tt)if(!H.circle[pt]){H.circle[pt]=!0;const gt=3*pt;if(this._circleAndRectCollide(ht[gt],ht[gt+1],ht[gt+2],r,u,y,S)&&(!j||j(this.circleKeys[pt]))){if(O.hitTest)return D.push(!0),!0;{const mt=ht[gt],xt=ht[gt+1],et=ht[gt+2];D.push({key:this.circleKeys[pt],x1:mt-et,y1:xt-et,x2:mt+et,y2:xt+et})}}}}}_queryCellCircle(r,u,y,S,M,D,O,j){const H=O.circle,X=O.seenUids,tt=this.boxCells[M];if(tt!==null){const pt=this.bboxes;for(const gt of tt)if(!X.box[gt]){X.box[gt]=!0;const mt=4*gt;if(this._circleAndRectCollide(H.x,H.y,H.radius,pt[mt+0],pt[mt+1],pt[mt+2],pt[mt+3])&&(!j||j(this.boxKeys[gt])))return D.push(!0),!0}}const ht=this.circleCells[M];if(ht!==null){const pt=this.circles;for(const gt of ht)if(!X.circle[gt]){X.circle[gt]=!0;const mt=3*gt;if(this._circlesCollide(pt[mt],pt[mt+1],pt[mt+2],H.x,H.y,H.radius)&&(!j||j(this.circleKeys[gt])))return D.push(!0),!0}}}_forEachCell(r,u,y,S,M,D,O,j){const H=this._convertToXCellCoord(r),X=this._convertToYCellCoord(u),tt=this._convertToXCellCoord(y),ht=this._convertToYCellCoord(S);for(let pt=H;pt<=tt;pt++)for(let gt=X;gt<=ht;gt++)if(M.call(this,r,u,y,S,this.xCellCount*gt+pt,D,O,j))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,u,y,S,M,D){const O=S-r,j=M-u,H=y+D;return H*H>O*O+j*j}_circleAndRectCollide(r,u,y,S,M,D,O){const j=(D-S)/2,H=Math.abs(r-(S+j));if(H>j+y)return!1;const X=(O-M)/2,tt=Math.abs(u-(M+X));if(tt>X+y)return!1;if(H<=j||tt<=X)return!0;const ht=H-j,pt=tt-X;return ht*ht+pt*pt<=y*y}}const qo={unknown:0,flipRequired:1,flipNotRequired:2},Is=Math.tan(85*Math.PI/180);function pe(m,r,u,y,S,M,D){const O=o.create();if(u)if(M.name==="globe"){const j=o.calculateGlobeLabelMatrix(S,r);o.multiply(O,O,j)}else{const j=Ut([],D);O[0]=j[0],O[1]=j[1],O[4]=j[2],O[5]=j[3],y||o.rotateZ(O,O,S.angle)}else o.multiply(O,S.labelPlaneMatrix,m);return O}function Eo(m,r,u,y,S,M,D){const O=pe(m,r,u,y,S,M,D);return M.name==="globe"&&u||(O[2]=O[6]=O[10]=O[14]=0),O}function En(m,r,u,y,S,M,D){if(u){if(M.name==="globe"){const O=pe(m,r,u,y,S,M,D);return o.invert(O,O),o.multiply(O,m,O),O}{const O=o.clone(m),j=o.identity([]);return j[0]=D[0],j[1]=D[1],j[4]=D[2],j[5]=D[3],o.multiply(O,O,j),y||o.rotateZ(O,O,-S.angle),O}}return S.glCoordMatrix}function Gn(m,r,u,y){const S=[m,r,u,1];u?o.transformMat4$1(S,S,y):Vi(S,S,y);const M=S[3];return S[0]/=M,S[1]/=M,S[2]/=M,S}function Af(m,r){return Math.min(.5+m/r*.5,1.5)}function Mo(m,r){const u=m[0]/m[3],y=m[1]/m[3];return u>=-r[0]&&u<=r[0]&&y>=-r[1]&&y<=r[1]}function _h(m,r,u,y,S,M,D,O,j,H){const X=u.transform,tt=y?m.textSizeData:m.iconSizeData,ht=o.evaluateSizeForZoom(tt,u.transform.zoom),pt=X.projection.name==="globe",gt=[256/u.width*2+1,256/u.height*2+1],mt=y?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;mt.clear();let xt=null;pt&&(xt=y?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const et=m.lineVertexArray,ft=y?m.text.placedSymbolArray:m.icon.placedSymbolArray,St=u.transform.width/u.transform.height;let Et,$t=!1;for(let Rt=0;Rt<ft.length;Rt++){const Gt=ft.get(Rt),{numGlyphs:Jt,writingMode:Yt}=Gt;if(Yt!==o.WritingMode.vertical||$t||Et===o.WritingMode.horizontal||($t=!0),Et=Yt,(Gt.hidden||Yt===o.WritingMode.vertical)&&!$t){Or(Jt,mt);continue}$t=!1;const ae=new o.Point(Gt.tileAnchorX,Gt.tileAnchorY);let{x:ke,y:se,z:xe}=X.projection.projectTilePoint(ae.x,ae.y,H.canonical);if(j){const[ki,ai,vi]=j(ae);ke+=ki,se+=ai,xe+=vi}const ue=[ke,se,xe,1];if(o.transformMat4$1(ue,ue,r),!Mo(ue,gt)){Or(Jt,mt);continue}const Ie=Af(u.transform.cameraToCenterDistance,ue[3]),ee=o.evaluateSizeForFeature(tt,ht,Gt),ve=D?ee/Ie:ee*Ie,De=Gn(ke,se,xe,S);if(De[3]<=0){Or(Jt,mt);continue}let ge={};const Oe=D?null:j,yi=Ke(Gt,ve,!1,O,r,S,M,m.glyphOffsetArray,et,mt,xt,De,ae,ge,St,Oe,X.projection,H,D);$t=yi.useVertical,Oe&&yi.needsFlipping&&(ge={}),(yi.notEnoughRoom||$t||yi.needsFlipping&&Ke(Gt,ve,!0,O,r,S,M,m.glyphOffsetArray,et,mt,xt,De,ae,ge,St,Oe,X.projection,H,D).notEnoughRoom)&&Or(Jt,mt)}y?(m.text.dynamicLayoutVertexBuffer.updateData(mt),xt&&m.text.globeExtVertexBuffer.updateData(xt)):(m.icon.dynamicLayoutVertexBuffer.updateData(mt),xt&&m.icon.globeExtVertexBuffer.updateData(xt))}function Cf(m,r,u,y,S,M,D,O,j,H,X,tt,ht,pt,gt,mt){const{lineStartIndex:xt,glyphStartIndex:et,segment:ft}=O,St=et+O.numGlyphs,Et=xt+O.lineLength,$t=r.getoffsetX(et),Rt=r.getoffsetX(St-1),Gt=br(m*$t,u,y,S,M,D,ft,xt,Et,j,H,X,tt,ht,!0,pt,gt,mt);if(!Gt)return null;const Jt=br(m*Rt,u,y,S,M,D,ft,xt,Et,j,H,X,tt,ht,!0,pt,gt,mt);return Jt?{first:Gt,last:Jt}:null}function Ml(m,r,u,y){return m===o.WritingMode.horizontal&&Math.abs(y)>Math.abs(u)?{useVertical:!0}:m===o.WritingMode.vertical?y>0?{needsFlipping:!0}:null:r!==qo.unknown&&function(S,M){return S===0||Math.abs(M/S)>Is}(u,y)?r===qo.flipRequired?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null}function Ke(m,r,u,y,S,M,D,O,j,H,X,tt,ht,pt,gt,mt,xt,et,ft){const St=r/24,Et=m.lineOffsetX*St,$t=m.lineOffsetY*St,{lineStartIndex:Rt,glyphStartIndex:Gt,numGlyphs:Jt,segment:Yt,writingMode:ae,flipState:ke}=m,se=Rt+m.lineLength,xe=ue=>{if(X){const[De,ge,Oe]=ue.up,yi=H.length;o.updateGlobeVertexNormal(X,yi+0,De,ge,Oe),o.updateGlobeVertexNormal(X,yi+1,De,ge,Oe),o.updateGlobeVertexNormal(X,yi+2,De,ge,Oe),o.updateGlobeVertexNormal(X,yi+3,De,ge,Oe)}const[Ie,ee,ve]=ue.point;o.addDynamicAttributes(H,Ie,ee,ve,ue.angle)};if(Jt>1){const ue=Cf(St,O,Et,$t,u,tt,ht,m,j,M,pt,mt,!1,xt,et,ft);if(!ue)return{notEnoughRoom:!0};if(y&&!u){let[Ie,ee,ve]=ue.first.point,[De,ge,Oe]=ue.last.point;[Ie,ee]=Gn(Ie,ee,ve,D),[De,ge]=Gn(De,ge,Oe,D);const yi=Ml(ae,ke,(De-Ie)*gt,ge-ee);if(m.flipState=yi&&yi.needsFlipping?qo.flipRequired:qo.flipNotRequired,yi)return yi}xe(ue.first);for(let Ie=Gt+1;Ie<Gt+Jt-1;Ie++){const ee=br(St*O.getoffsetX(Ie),Et,$t,u,tt,ht,Yt,Rt,se,j,M,pt,mt,!1,!1,xt,et,ft);if(!ee)return H.length-=4*(Ie-Gt),{notEnoughRoom:!0};xe(ee)}xe(ue.last)}else{if(y&&!u){const Ie=Gn(ht.x,ht.y,0,S),ee=Rt+Yt+1,ve=new o.Point(j.getx(ee),j.gety(ee)),De=Gn(ve.x,ve.y,0,S),ge=De[3]>0?De:Ui(ht,ve,Ie,1,S,void 0,xt,et.canonical),Oe=Ml(ae,ke,(ge[0]-Ie[0])*gt,ge[1]-Ie[1]);if(m.flipState=Oe&&Oe.needsFlipping?qo.flipRequired:qo.flipNotRequired,Oe)return Oe}const ue=br(St*O.getoffsetX(Gt),Et,$t,u,tt,ht,Yt,Rt,se,j,M,pt,mt,!1,!1,xt,et,ft);if(!ue)return{notEnoughRoom:!0};xe(ue)}return{}}function Ki(m,r,u,y,S){const{x:M,y:D,z:O}=y.projectTilePoint(m.x,m.y,r);if(!S)return Gn(M,D,O,u);const[j,H,X]=S(m);return Gn(M+j,D+H,O+X,u)}function Ui(m,r,u,y,S,M,D,O){const j=Ki(m.sub(r)._unit()._add(m),O,S,D,M);return o.sub(j,u,j),o.normalize(j,j),o.scaleAndAdd(j,u,j,y)}function br(m,r,u,y,S,M,D,O,j,H,X,tt,ht,pt,gt,mt,xt,et){const ft=y?m-r:m+r;let St=ft>0?1:-1,Et=0;y&&(St*=-1,Et=Math.PI),St<0&&(Et+=Math.PI);let $t=O+D+(St>0?0:1)|0,Rt=S,Gt=S,Jt=0,Yt=0;const ae=Math.abs(ft),ke=[],se=[];let xe=M,ue=xe;const Ie=()=>Ui(ue,xe,Gt,ae-Jt+1,X,ht,mt,xt.canonical);for(;Jt+Yt<=ae;){if($t+=St,$t<O||$t>=j)return null;if(Gt=Rt,ue=xe,ke.push(Gt),pt&&se.push(ue),xe=new o.Point(H.getx($t),H.gety($t)),Rt=tt[$t],!Rt){const vi=Ki(xe,xt.canonical,X,mt,ht);Rt=vi[3]>0?tt[$t]=vi:Ie()}Jt+=Yt,Yt=o.distance(Gt,Rt)}gt&&ht&&(tt[$t]&&(Rt=Ie(),Yt=o.distance(Gt,Rt)),tt[$t]=Rt);const ee=(ae-Jt)/Yt,ve=xe.sub(ue)._mult(ee)._add(ue),De=o.sub([],Rt,Gt),ge=o.scaleAndAdd([],Gt,De,ee);let Oe=[0,0,1],yi=De[0],ki=De[1];if(et&&(Oe=mt.upVector(xt.canonical,ve.x,ve.y),Oe[0]!==0||Oe[1]!==0||Oe[2]!==1)){const vi=[Oe[2],0,-Oe[0]],Oi=o.cross([],Oe,vi);o.normalize(vi,vi),o.normalize(Oi,Oi),yi=o.dot(De,vi),ki=o.dot(De,Oi)}if(u){const vi=o.cross([],Oe,De);o.normalize(vi,vi),o.scaleAndAdd(ge,ge,vi,u*St)}const ai=Et+Math.atan2(ki,yi);return ke.push(ge),pt&&se.push(ve),{point:ge,angle:ai,path:ke,tilePath:se,up:Oe}}function Or(m,r){const u=r.length,y=u+4*m;r.resize(y),r.float32.fill(-1/0,4*u,4*y)}function Vi(m,r,u){const y=r[0],S=r[1];return m[0]=u[0]*y+u[4]*S+u[12],m[1]=u[1]*y+u[5]*S+u[13],m[3]=u[3]*y+u[7]*S+u[15],m}const wr=100;class ir{constructor(r,u,y=new So(r.width+200,r.height+200,25),S=new So(r.width+200,r.height+200,25)){this.transform=r,this.grid=y,this.ignoredGrid=S,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+wr,this.screenBottomBoundary=r.height+wr,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=u}placeCollisionBox(r,u,y,S,M,D,O,j){let H=y.projectedAnchorX,X=y.projectedAnchorY,tt=y.projectedAnchorZ;const ht=y.elevation,pt=y.tileID,gt=r.getProjection();if(ht&&pt){const[Rt,Gt,Jt]=gt.upVector(pt.canonical,y.tileAnchorX,y.tileAnchorY),Yt=gt.upVectorScale(pt.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;H+=Rt*ht*Yt,X+=Gt*ht*Yt,tt+=Jt*ht*Yt}const mt=this.projectAndGetPerspectiveRatio(O,H,X,tt,y.tileID,gt.name==="globe"||!!ht||this.transform.pitch>0,gt),xt=D*mt.perspectiveRatio,et=(y.x1*u+S.x-y.padding)*xt+mt.point.x,ft=(y.y1*u+S.y-y.padding)*xt+mt.point.y,St=(y.x2*u+S.x+y.padding)*xt+mt.point.x,Et=(y.y2*u+S.y+y.padding)*xt+mt.point.y,$t=mt.perspectiveRatio<=.55||mt.occluded;return!this.isInsideGrid(et,ft,St,Et)||!M&&this.grid.hitTest(et,ft,St,Et,j)||$t?{box:[],offscreen:!1,occluded:mt.occluded}:{box:[et,ft,St,Et],offscreen:this.isOffscreen(et,ft,St,Et),occluded:!1}}placeCollisionCircles(r,u,y,S,M,D,O,j,H,X,tt,ht,pt,gt,mt){const xt=[],et=this.transform.elevation,ft=r.getProjection(),St=et?et.getAtTileOffsetFunc(mt,this.transform.center.lat,this.transform.worldSize,ft):null,Et=new o.Point(y.tileAnchorX,y.tileAnchorY);let{x:$t,y:Rt,z:Gt}=ft.projectTilePoint(Et.x,Et.y,mt.canonical);if(St){const[ve,De,ge]=St(Et);$t+=ve,Rt+=De,Gt+=ge}const Jt=ft.name==="globe",Yt=this.projectAndGetPerspectiveRatio(O,$t,Rt,Gt,mt,Jt||!!et||this.transform.pitch>0,ft),{perspectiveRatio:ae}=Yt,ke=(tt?D/ae:D*ae)/o.ONE_EM,se=Gn($t,Rt,Gt,j),xe=Yt.signedDistanceFromCamera>0?Cf(ke,M,y.lineOffsetX*ke,y.lineOffsetY*ke,!1,se,Et,y,S,j,{},et&&!tt?St:null,tt&&!!et,ft,mt,tt):null;let ue=!1,Ie=!1,ee=!0;if(xe&&!Yt.occluded){const ve=.5*pt*ae+gt,De=new o.Point(-100,-100),ge=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),Oe=new xc,{first:yi,last:ki}=xe,ai=yi.path.length;let vi=[];for(let mi=ai-1;mi>=1;mi--)vi.push(yi.path[mi]);for(let mi=1;mi<ki.path.length;mi++)vi.push(ki.path[mi]);const Oi=2.5*ve;H&&(vi=vi.map(([mi,xs,ws],Ts)=>(St&&!Jt&&(ws=St(Ts<ai-1?yi.tilePath[ai-1-Ts]:ki.tilePath[Ts-ai+2])[2]),Gn(mi,xs,ws,H))),vi.some(mi=>mi[3]<=0)&&(vi=[]));let Ri=[];if(vi.length>0){let mi=1/0,xs=-1/0,ws=1/0,Ts=-1/0;for(const Ss of vi)mi=Math.min(mi,Ss[0]),ws=Math.min(ws,Ss[1]),xs=Math.max(xs,Ss[0]),Ts=Math.max(Ts,Ss[1]);xs>=De.x&&mi<=ge.x&&Ts>=De.y&&ws<=ge.y&&(Ri=[vi.map(Ss=>new o.Point(Ss[0],Ss[1]))],(mi<De.x||xs>ge.x||ws<De.y||Ts>ge.y)&&(Ri=o.clipLine(Ri,De.x,De.y,ge.x,ge.y)))}for(const mi of Ri){Oe.reset(mi,.25*ve);let xs=0;xs=Oe.length<=.5*ve?1:Math.ceil(Oe.paddedLength/Oi)+1;for(let ws=0;ws<xs;ws++){const Ts=ws/Math.max(xs-1,1),Ss=Oe.lerp(Ts),or=Ss.x+wr,qn=Ss.y+wr;xt.push(or,qn,ve,0);const Vr=or-ve,bs=qn-ve,Us=or+ve,Ps=qn+ve;if(ee=ee&&this.isOffscreen(Vr,bs,Us,Ps),Ie=Ie||this.isInsideGrid(Vr,bs,Us,Ps),!u&&this.grid.hitTestCircle(or,qn,ve,ht)&&(ue=!0,!X))return{circles:[],offscreen:!1,collisionDetected:ue,occluded:!1}}}}return{circles:!X&&ue||!Ie?[]:xt,offscreen:ee,collisionDetected:ue,occluded:Yt.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let y=1/0,S=1/0,M=-1/0,D=-1/0;for(const X of r){const tt=new o.Point(X.x+wr,X.y+wr);y=Math.min(y,tt.x),S=Math.min(S,tt.y),M=Math.max(M,tt.x),D=Math.max(D,tt.y),u.push(tt)}const O=this.grid.query(y,S,M,D).concat(this.ignoredGrid.query(y,S,M,D)),j={},H={};for(const X of O){const tt=X.key;if(j[tt.bucketInstanceId]===void 0&&(j[tt.bucketInstanceId]={}),j[tt.bucketInstanceId][tt.featureIndex])continue;const ht=[new o.Point(X.x1,X.y1),new o.Point(X.x2,X.y1),new o.Point(X.x2,X.y2),new o.Point(X.x1,X.y2)];o.polygonIntersectsPolygon(u,ht)&&(j[tt.bucketInstanceId][tt.featureIndex]=!0,H[tt.bucketInstanceId]===void 0&&(H[tt.bucketInstanceId]=[]),H[tt.bucketInstanceId].push(tt.featureIndex))}return H}insertCollisionBox(r,u,y,S,M){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:S,collisionGroupID:M},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,u,y,S,M){const D=u?this.ignoredGrid:this.grid,O={bucketInstanceId:y,featureIndex:S,collisionGroupID:M};for(let j=0;j<r.length;j+=4)D.insertCircle(O,r[j],r[j+1],r[j+2])}projectAndGetPerspectiveRatio(r,u,y,S,M,D,O){const j=[u,y,S,1];let H=!1;S||this.transform.pitch>0?(o.transformMat4$1(j,j,r),this.fogState&&M&&O.name!=="globe"&&(H=function(ht,pt,gt,mt,xt,et){const ft=et.calculateFogTileMatrix(xt),St=[pt,gt,mt];return o.transformMat4(St,St,ft),li(ht,St,et.pitch,et._fov)}(this.fogState,u,y,S,M.toUnwrapped(),this.transform)>.9)):Vi(j,j,r);const X=j[3];return{point:new o.Point((j[0]/X+1)/2*this.transform.width+wr,(-j[1]/X+1)/2*this.transform.height+wr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(O)/X*.5,1.5),signedDistanceFromCamera:X,occluded:D&&j[2]>X||H}}isOffscreen(r,u,y,S){return y<wr||r>=this.screenRightBoundary||S<wr||u>this.screenBottomBoundary}isInsideGrid(r,u,y,S){return y>=0&&r<this.gridRightBoundary&&S>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const r=o.identity([]);return o.translate(r,r,[-100,-100,0]),r}}function io(m,r,u){const y=r.createTileMatrix(m,m.worldSize,u.toUnwrapped());return o.multiply(new Float32Array(16),m.projMatrix,y)}function Rr(m,r,u){if(r.projection.name===u.projection.name)return m.projMatrix;const y=u.clone();return y.setProjection(r.projection),io(y,r.getProjection(),m)}function Ys(m,r,u){return r.name===u.projection.name?m.projMatrix:io(u,r,m)}class kf{constructor(r,u,y,S){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?u:-u))):S&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class so{constructor(r,u,y,S,M,D=!1){this.text=new kf(r?r.text:null,u,y,M),this.icon=new kf(r?r.icon:null,u,S,M),this.clipped=D}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xa{constructor(r,u,y,S=!1){this.text=r,this.icon=u,this.skipFade=y,this.clipped=S}}class vc{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Uu{constructor(r,u,y,S,M){this.bucketInstanceId=r,this.featureIndex=u,this.sourceLayerIndex=y,this.bucketIndex=S,this.tileID=M}}class Vu{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const u=++this.maxGroupID;this.collisionGroups[r]={ID:u,predicate:y=>y.collisionGroupID===u}}return this.collisionGroups[r]}}function Al(m,r,u,y,S){const{horizontalAlign:M,verticalAlign:D}=o.getAnchorAlignment(m),O=-(M-.5)*r,j=-(D-.5)*u,H=o.evaluateVariableOffset(m,y);return new o.Point(O+H[0]*S,j+H[1]*S)}function Ao(m,r,u,y,S){const M=new o.Point(m,r);return u&&M._rotate(y?S:-S),M}class yh{constructor(r,u,y,S,M){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new ir(this.transform,M),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Vu(y),this.collisionCircleArrays={},this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,u,y,S){const M=y.getBucket(u),D=y.latestFeatureIndex;if(!M||!D||u.id!==M.layerIds[0])return;const O=M.layers[0].layout,j=y.collisionBoxArray,H=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),X=y.tileSize/o.EXTENT,tt=y.tileID.toUnwrapped();this.transform.setProjection(M.projection);const ht=(pt=y.tileID,gt=M.getProjection(),mt=this.transform,gt.name===this.projection?mt.calculateProjMatrix(pt.toUnwrapped()):io(mt,gt,pt));var pt,gt,mt;const xt=O.get("text-pitch-alignment")==="map",et=O.get("text-rotation-alignment")==="map";u.compileFilter();const ft=u.dynamicFilter(),St=u.dynamicFilterNeedsFeature(),Et=this.transform.calculatePixelsToTileUnitsMatrix(y),$t=Eo(ht,y.tileID.canonical,xt,et,this.transform,M.getProjection(),Et);let Rt=null;if(xt){const Yt=En(ht,y.tileID.canonical,xt,et,this.transform,M.getProjection(),Et);Rt=o.multiply([],this.transform.labelPlaneMatrix,Yt)}let Gt=null;ft&&y.latestFeatureIndex&&(Gt={unwrappedTileID:tt,dynamicFilter:ft,dynamicFilterNeedsFeature:St,featureIndex:y.latestFeatureIndex}),this.retainedQueryData[M.bucketInstanceId]=new Uu(M.bucketInstanceId,D,M.sourceLayerIndex,M.index,y.tileID);const Jt={bucket:M,layout:O,posMatrix:ht,textLabelPlaneMatrix:$t,labelToScreenMatrix:Rt,clippingData:Gt,scale:H,textPixelRatio:X,holdingForFade:y.holdingForFade(),collisionBoxArray:j,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(M.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(M.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(M.sourceID)};if(S)for(const Yt of M.sortKeyRanges){const{sortKey:ae,symbolInstanceStart:ke,symbolInstanceEnd:se}=Yt;r.push({sortKey:ae,symbolInstanceStart:ke,symbolInstanceEnd:se,parameters:Jt})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:M.symbolInstances.length,parameters:Jt})}attemptAnchorPlacement(r,u,y,S,M,D,O,j,H,X,tt,ht,pt,gt,mt,xt,et,ft){const{textOffset0:St,textOffset1:Et,crossTileID:$t}=ht,Rt=[St,Et],Gt=Al(r,y,S,Rt,M),Jt=this.collisionIndex.placeCollisionBox(gt,M,u,Ao(Gt.x,Gt.y,D,O,this.transform.angle),tt,j,H,X.predicate);if(xt){const Yt=gt.getSymbolInstanceIconSize(ft,this.transform.zoom,ht.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(gt,Yt,xt,Ao(Gt.x,Gt.y,D,O,this.transform.angle),tt,j,H,X.predicate).box.length===0)return}if(Jt.box.length>0){let Yt;return this.prevPlacement&&this.prevPlacement.variableOffsets[$t]&&this.prevPlacement.placements[$t]&&this.prevPlacement.placements[$t].text&&(Yt=this.prevPlacement.variableOffsets[$t].anchor),this.variableOffsets[$t]={textOffset:Rt,width:y,height:S,anchor:r,textScale:M,prevAnchor:Yt},this.markUsedJustification(gt,r,ht,mt),gt.allowVerticalPlacement&&(this.markUsedOrientation(gt,mt,ht),this.placedOrientations[$t]=mt),{shift:Gt,placedGlyphBoxes:Jt}}}placeLayerBucketPart(r,u,y,S){const{bucket:M,layout:D,posMatrix:O,textLabelPlaneMatrix:j,labelToScreenMatrix:H,clippingData:X,textPixelRatio:tt,holdingForFade:ht,collisionBoxArray:pt,partiallyEvaluatedTextSize:gt,partiallyEvaluatedIconSize:mt,collisionGroup:xt}=r.parameters,et=D.get("text-optional"),ft=D.get("icon-optional"),St=D.get("text-allow-overlap"),Et=D.get("icon-allow-overlap"),$t=D.get("text-rotation-alignment")==="map",Rt=D.get("text-pitch-alignment")==="map",Gt=D.get("icon-text-fit")!=="none",Jt=D.get("symbol-z-order")==="viewport-y";this.transform.setProjection(M.projection);let Yt=St&&(Et||!M.hasIconData()||ft),ae=Et&&(St||!M.hasTextData()||et);!M.collisionArrays&&pt&&M.deserializeCollisionBoxes(pt),y&&S&&M.updateCollisionDebugBuffers(this.transform.zoom,pt);const ke=(se,xe,ue)=>{const{crossTileID:Ie,numVerticalGlyphVertices:ee}=se;if(X){const Us={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ps=null;if(X.dynamicFilterNeedsFeature){const os=this.retainedQueryData[M.bucketInstanceId];Ps=X.featureIndex.loadFeature({featureIndex:se.featureIndex,bucketIndex:os.bucketIndex,sourceLayerIndex:os.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,X.dynamicFilter)(Us,Ps,this.retainedQueryData[M.bucketInstanceId].tileID.canonical,new o.Point(se.tileAnchorX,se.tileAnchorY),this.transform.calculateDistanceTileData(X.unwrappedTileID)))return this.placements[Ie]=new xa(!1,!1,!1,!0),void u.add(Ie)}if(u.has(Ie))return;if(ht)return void(this.placements[Ie]=new xa(!1,!1,!1));let ve=!1,De=!1,ge=!0,Oe=!1,yi=!1,ki=null,ai={box:null,offscreen:null,occluded:null},vi={box:null},Oi=null,Ri=null,mi=null,xs=0,ws=0,Ts=0;ue.textFeatureIndex?xs=ue.textFeatureIndex:se.useRuntimeCollisionCircles&&(xs=se.featureIndex),ue.verticalTextFeatureIndex&&(ws=ue.verticalTextFeatureIndex);const Ss=Us=>{Us.tileID=this.retainedQueryData[M.bucketInstanceId].tileID;const Ps=this.transform.elevation;(Ps||Us.elevation)&&(Us.elevation=Ps?Ps.getAtTileOffset(Us.tileID,Us.tileAnchorX,Us.tileAnchorY):0)},or=ue.textBox;if(or){Ss(or);const Us=os=>{let Mn=o.WritingMode.horizontal;if(M.allowVerticalPlacement&&!os&&this.prevPlacement){const mr=this.prevPlacement.placedOrientations[Ie];mr&&(this.placedOrientations[Ie]=mr,Mn=mr,this.markUsedOrientation(M,Mn,se))}return Mn},Ps=(os,Mn)=>{if(M.allowVerticalPlacement&&ee>0&&ue.verticalTextBox){for(const mr of M.writingModes)if(mr===o.WritingMode.vertical?(ai=Mn(),vi=ai):ai=os(),ai&&ai.box&&ai.box.length)break}else ai=os()};if(D.get("text-variable-anchor")){let os=D.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ie]){const Vs=this.prevPlacement.variableOffsets[Ie];os.indexOf(Vs.anchor)>0&&(os=os.filter(On=>On!==Vs.anchor),os.unshift(Vs.anchor))}const Mn=(Vs,On,Wh)=>{const ra=M.getSymbolInstanceTextSize(gt,se,this.transform.zoom,xe),ql=(Vs.x2-Vs.x1)*ra+2*Vs.padding,Do=(Vs.y2-Vs.y1)*ra+2*Vs.padding,oa=Gt&&!Et?On:null;oa&&Ss(oa);let ll={box:[],offscreen:!1,occluded:!1};const hn=St?2*os.length:os.length;for(let $c=0;$c<hn;++$c){const xd=this.attemptAnchorPlacement(os[$c%os.length],Vs,ql,Do,ra,$t,Rt,tt,O,xt,$c>=os.length,se,xe,M,Wh,oa,gt,mt);if(xd&&(ll=xd.placedGlyphBoxes,ll&&ll.box&&ll.box.length)){ve=!0,ki=xd.shift;break}}return ll};Ps(()=>Mn(or,ue.iconBox,o.WritingMode.horizontal),()=>{const Vs=ue.verticalTextBox;return Vs&&Ss(Vs),M.allowVerticalPlacement&&!(ai&&ai.box&&ai.box.length)&&ee>0&&Vs?Mn(Vs,ue.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),ai&&(ve=ai.box,ge=ai.offscreen,Oe=ai.occluded);const mr=Us(!(!ai||!ai.box));if(!ve&&this.prevPlacement){const Vs=this.prevPlacement.variableOffsets[Ie];Vs&&(this.variableOffsets[Ie]=Vs,this.markUsedJustification(M,Vs.anchor,se,mr))}}else{const os=(Mn,mr)=>{const Vs=M.getSymbolInstanceTextSize(gt,se,this.transform.zoom,xe),On=this.collisionIndex.placeCollisionBox(M,Vs,Mn,new o.Point(0,0),St,tt,O,xt.predicate);return On&&On.box&&On.box.length&&(this.markUsedOrientation(M,mr,se),this.placedOrientations[Ie]=mr),On};Ps(()=>os(or,o.WritingMode.horizontal),()=>{const Mn=ue.verticalTextBox;return M.allowVerticalPlacement&&ee>0&&Mn?(Ss(Mn),os(Mn,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Us(!!(ai&&ai.box&&ai.box.length))}}if(Oi=ai,ve=Oi&&Oi.box&&Oi.box.length>0,ge=Oi&&Oi.offscreen,Oe=Oi&&Oi.occluded,se.useRuntimeCollisionCircles){const Us=M.text.placedSymbolArray.get(se.centerJustifiedTextSymbolIndex>=0?se.centerJustifiedTextSymbolIndex:se.verticalPlacedTextSymbolIndex),Ps=o.evaluateSizeForFeature(M.textSizeData,gt,Us),os=D.get("text-padding");Ri=this.collisionIndex.placeCollisionCircles(M,St,Us,M.lineVertexArray,M.glyphOffsetArray,Ps,O,j,H,y,Rt,xt.predicate,se.collisionCircleDiameter*Ps/o.ONE_EM,os,this.retainedQueryData[M.bucketInstanceId].tileID),ve=St||Ri.circles.length>0&&!Ri.collisionDetected,ge=ge&&Ri.offscreen,Oe=Ri.occluded}if(ue.iconFeatureIndex&&(Ts=ue.iconFeatureIndex),ue.iconBox){const Us=Ps=>{Ss(Ps);const os=Gt&&ki?Ao(ki.x,ki.y,$t,Rt,this.transform.angle):new o.Point(0,0),Mn=M.getSymbolInstanceIconSize(mt,this.transform.zoom,se.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(M,Mn,Ps,os,Et,tt,O,xt.predicate)};vi&&vi.box&&vi.box.length&&ue.verticalIconBox?(mi=Us(ue.verticalIconBox),De=mi.box.length>0):(mi=Us(ue.iconBox),De=mi.box.length>0),ge=ge&&mi.offscreen,yi=mi.occluded}const qn=et||se.numHorizontalGlyphVertices===0&&ee===0,Vr=ft||se.numIconVertices===0;if(qn||Vr?Vr?qn||(De=De&&ve):ve=De&&ve:De=ve=De&&ve,ve&&Oi&&Oi.box&&this.collisionIndex.insertCollisionBox(Oi.box,D.get("text-ignore-placement"),M.bucketInstanceId,vi&&vi.box&&ws?ws:xs,xt.ID),De&&mi&&this.collisionIndex.insertCollisionBox(mi.box,D.get("icon-ignore-placement"),M.bucketInstanceId,Ts,xt.ID),Ri&&(ve&&this.collisionIndex.insertCollisionCircles(Ri.circles,D.get("text-ignore-placement"),M.bucketInstanceId,xs,xt.ID),y)){const Us=M.bucketInstanceId;let Ps=this.collisionCircleArrays[Us];Ps===void 0&&(Ps=this.collisionCircleArrays[Us]=new vc);for(let os=0;os<Ri.circles.length;os+=4)Ps.circles.push(Ri.circles[os+0]),Ps.circles.push(Ri.circles[os+1]),Ps.circles.push(Ri.circles[os+2]),Ps.circles.push(Ri.collisionDetected?1:0)}const bs=M.projection.name!=="globe";Yt=Yt&&(bs||!Oe),ae=ae&&(bs||!yi),this.placements[Ie]=new xa(ve||Yt,De||ae,ge||M.justReloaded),u.add(Ie)};if(Jt){const se=M.getSortedSymbolIndexes(this.transform.angle);for(let xe=se.length-1;xe>=0;--xe){const ue=se[xe];ke(M.symbolInstances.get(ue),ue,M.collisionArrays[ue])}}else for(let se=r.symbolInstanceStart;se<r.symbolInstanceEnd;se++)ke(M.symbolInstances.get(se),se,M.collisionArrays[se]);if(y&&M.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[M.bucketInstanceId];o.invert(se.invProjMatrix,O),se.viewportMatrix=this.collisionIndex.getViewportMatrix()}M.justReloaded=!1}markUsedJustification(r,u,y,S){const{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:D,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:j,crossTileID:H}=y,X=o.getAnchorJustification(u),tt=S===o.WritingMode.vertical?j:X==="left"?M:X==="center"?D:X==="right"?O:-1;M>=0&&(r.text.placedSymbolArray.get(M).crossTileID=tt>=0&&M!==tt?0:H),D>=0&&(r.text.placedSymbolArray.get(D).crossTileID=tt>=0&&D!==tt?0:H),O>=0&&(r.text.placedSymbolArray.get(O).crossTileID=tt>=0&&O!==tt?0:H),j>=0&&(r.text.placedSymbolArray.get(j).crossTileID=tt>=0&&j!==tt?0:H)}markUsedOrientation(r,u,y){const S=u===o.WritingMode.horizontal||u===o.WritingMode.horizontalOnly?u:0,M=u===o.WritingMode.vertical?u:0,{leftJustifiedTextSymbolIndex:D,centerJustifiedTextSymbolIndex:O,rightJustifiedTextSymbolIndex:j,verticalPlacedTextSymbolIndex:H}=y,X=r.text.placedSymbolArray;D>=0&&(X.get(D).placedOrientation=S),O>=0&&(X.get(O).placedOrientation=S),j>=0&&(X.get(j).placedOrientation=S),H>=0&&(X.get(H).placedOrientation=M)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let y=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const S=u?u.symbolFadeChange(r):1,M=u?u.opacities:{},D=u?u.variableOffsets:{},O=u?u.placedOrientations:{};for(const j in this.placements){const H=this.placements[j],X=M[j];X?(this.opacities[j]=new so(X,S,H.text,H.icon,null,H.clipped),y=y||H.text!==X.text.placed||H.icon!==X.icon.placed):(this.opacities[j]=new so(null,S,H.text,H.icon,H.skipFade,H.clipped),y=y||H.text||H.icon)}for(const j in M){const H=M[j];if(!this.opacities[j]){const X=new so(H,S,!1,!1);X.isHidden()||(this.opacities[j]=X,y=y||H.text.placed||H.icon.placed)}}for(const j in D)this.variableOffsets[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.variableOffsets[j]=D[j]);for(const j in O)this.placedOrientations[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.placedOrientations[j]=O[j]);y?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:r)}updateLayerOpacities(r,u){const y=new Set;for(const S of u){const M=S.getBucket(r);M&&S.latestFeatureIndex&&r.id===M.layerIds[0]&&this.updateBucketOpacities(M,y,S.collisionBoxArray)}}updateBucketOpacities(r,u,y){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const S=r.layers[0].layout,M=!!r.layers[0].dynamicFilter(),D=new so(null,0,!1,!1,!0),O=S.get("text-allow-overlap"),j=S.get("icon-allow-overlap"),H=S.get("text-variable-anchor"),X=S.get("text-rotation-alignment")==="map",tt=S.get("text-pitch-alignment")==="map",ht=S.get("icon-text-fit")!=="none",pt=new so(null,0,O&&(j||!r.hasIconData()||S.get("icon-optional")),j&&(O||!r.hasTextData()||S.get("text-optional")),!0);!r.collisionArrays&&y&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(y);const gt=(xt,et,ft)=>{for(let St=0;St<et/4;St++)xt.opacityVertexArray.emplaceBack(ft)};let mt=0;for(let xt=0;xt<r.symbolInstances.length;xt++){const et=r.symbolInstances.get(xt),{numHorizontalGlyphVertices:ft,numVerticalGlyphVertices:St,crossTileID:Et,numIconVertices:$t}=et,Rt=u.has(Et);let Gt=this.opacities[Et];Rt?Gt=D:Gt||(Gt=pt,this.opacities[Et]=Gt),u.add(Et);const Jt=ft>0||St>0,Yt=$t>0,ae=this.placedOrientations[Et],ke=ae===o.WritingMode.vertical,se=ae===o.WritingMode.horizontal||ae===o.WritingMode.horizontalOnly;if(!Jt&&!Yt||Gt.isHidden()||mt++,Jt){const xe=Er(Gt.text);gt(r.text,ft,ke?ln:xe),gt(r.text,St,se?ln:xe);const ue=Gt.text.isHidden(),{leftJustifiedTextSymbolIndex:Ie,centerJustifiedTextSymbolIndex:ee,rightJustifiedTextSymbolIndex:ve,verticalPlacedTextSymbolIndex:De}=et,ge=r.text.placedSymbolArray,Oe=ue||ke?1:0;Ie>=0&&(ge.get(Ie).hidden=Oe),ee>=0&&(ge.get(ee).hidden=Oe),ve>=0&&(ge.get(ve).hidden=Oe),De>=0&&(ge.get(De).hidden=ue||se?1:0);const yi=this.variableOffsets[Et];yi&&this.markUsedJustification(r,yi.anchor,et,ae);const ki=this.placedOrientations[Et];ki&&(this.markUsedJustification(r,"left",et,ki),this.markUsedOrientation(r,ki,et))}if(Yt){const xe=Er(Gt.icon),{placedIconSymbolIndex:ue,verticalPlacedIconSymbolIndex:Ie}=et,ee=r.icon.placedSymbolArray,ve=Gt.icon.isHidden()?1:0;ue>=0&&(gt(r.icon,$t,ke?ln:xe),ee.get(ue).hidden=ve),Ie>=0&&(gt(r.icon,et.numVerticalIconVertices,se?ln:xe),ee.get(Ie).hidden=ve)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const xe=r.collisionArrays[xt];if(xe){let ue=new o.Point(0,0),Ie=!0;if(xe.textBox||xe.verticalTextBox){if(H){const ve=this.variableOffsets[Et];ve?(ue=Al(ve.anchor,ve.width,ve.height,ve.textOffset,ve.textScale),X&&ue._rotate(tt?this.transform.angle:-this.transform.angle)):Ie=!1}M&&(Ie=!Gt.clipped),xe.textBox&&Zo(r.textCollisionBox.collisionVertexArray,Gt.text.placed,!Ie||ke,ue.x,ue.y),xe.verticalTextBox&&Zo(r.textCollisionBox.collisionVertexArray,Gt.text.placed,!Ie||se,ue.x,ue.y)}const ee=Ie&&!!(!se&&xe.verticalIconBox);xe.iconBox&&Zo(r.iconCollisionBox.collisionVertexArray,Gt.icon.placed,ee,ht?ue.x:0,ht?ue.y:0),xe.verticalIconBox&&Zo(r.iconCollisionBox.collisionVertexArray,Gt.icon.placed,!ee,ht?ue.x:0,ht?ue.y:0)}}}if(r.fullyClipped=mt===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const xt=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=xt.invProjMatrix,r.placementViewportMatrix=xt.viewportMatrix,r.collisionCircleArray=xt.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,u){const y=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*y>r}setStale(){this.stale=!0}}function Zo(m,r,u,y,S){m.emplaceBack(r?1:0,u?1:0,y||0,S||0),m.emplaceBack(r?1:0,u?1:0,y||0,S||0),m.emplaceBack(r?1:0,u?1:0,y||0,S||0),m.emplaceBack(r?1:0,u?1:0,y||0,S||0)}const Tr=Math.pow(2,25),gn=Math.pow(2,24),$u=Math.pow(2,17),bc=Math.pow(2,16),Sr=Math.pow(2,9),pr=Math.pow(2,8),Gu=Math.pow(2,1);function Er(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const r=m.placed?1:0,u=Math.floor(127*m.opacity);return u*Tr+r*gn+u*$u+r*bc+u*Sr+r*pr+u*Gu+r}const ln=0;class Yo{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,u,y,S,M){const D=this._bucketParts;for(;this._currentTileIndex<r.length;)if(u.getBucketParts(D,S,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,M())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((O,j)=>O.sortKey-j.sortKey));this._currentPartIndex<D.length;){const O=D[this._currentPartIndex];if(u.placeLayerBucketPart(O,this._seenCrossTileIDs,y,O.symbolInstanceStart===0),this._currentPartIndex++,M())return!0}return!1}}class wc{constructor(r,u,y,S,M,D,O,j){this.placement=new yh(r,M,D,O,j),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(r,u,y){const S=o.exported.now(),M=()=>{const D=o.exported.now()-S;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=u[r[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(D.type==="symbol"&&(!D.minzoom||D.minzoom<=O)&&(!D.maxzoom||D.maxzoom>O)){if(this._inProgressLayer||(this._inProgressLayer=new Yo(D)),this._inProgressLayer.continuePlacement(y[D.source],this.placement,this._showCollisionBoxes,D,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Ko=512/o.EXTENT/2;class Wn{constructor(r,u,y){this.tileID=r,this.bucketInstanceId=y,this.index=new o.KDBush(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const S=r.canonical.x*o.EXTENT,M=r.canonical.y*o.EXTENT;for(let D=0;D<u.length;D++){const{key:O,crossTileID:j,tileAnchorX:H,tileAnchorY:X}=u.get(D),tt=Math.floor((S+H)*Ko),ht=Math.floor((M+X)*Ko);this.index.add(tt,ht),this.keys.push(O),this.crossTileIDs.push(j)}this.index.finish()}findMatches(r,u,y){const S=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),M=Ko/Math.pow(2,u.canonical.z-this.tileID.canonical.z),D=u.canonical.x*o.EXTENT,O=u.canonical.y*o.EXTENT;for(let j=0;j<r.length;j++){const H=r.get(j);if(H.crossTileID)continue;const{key:X,tileAnchorX:tt,tileAnchorY:ht}=H,pt=Math.floor((D+tt)*M),gt=Math.floor((O+ht)*M),mt=this.index.range(pt-S,gt-S,pt+S,gt+S);for(const xt of mt){const et=this.crossTileIDs[xt];if(this.keys[xt]===X&&!y.has(et)){y.add(et),H.crossTileID=et;break}}}}}class xh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Wu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const u=Math.round((r-this.lng)/360);if(u!==0)for(const y in this.indexes){const S=this.indexes[y],M={};for(const D in S){const O=S[D];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+u),M[O.tileID.key]=O}this.indexes[y]=M}this.lng=r}addBucket(r,u,y){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let M=0;M<u.symbolInstances.length;M++)u.symbolInstances.get(M).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const S=this.usedCrossTileIDs[r.overscaledZ];for(const M in this.indexes){const D=this.indexes[M];if(Number(M)>r.overscaledZ)for(const O in D){const j=D[O];j.tileID.isChildOf(r)&&j.findMatches(u.symbolInstances,r,S)}else{const O=D[r.scaledTo(Number(M)).key];O&&O.findMatches(u.symbolInstances,r,S)}}for(let M=0;M<u.symbolInstances.length;M++){const D=u.symbolInstances.get(M);D.crossTileID||(D.crossTileID=y.generate(),S.add(D.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Wn(r,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(r,u){for(const y of u.crossTileIDs)this.usedCrossTileIDs[r].delete(y)}removeStaleBuckets(r){let u=!1;for(const y in this.indexes){const S=this.indexes[y];for(const M in S)r[S[M].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,S[M]),delete S[M],u=!0)}return u}}class Jo{constructor(){this.layerIndexes={},this.crossTileIDs=new xh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,u,y,S){let M=this.layerIndexes[r.id];M===void 0&&(M=this.layerIndexes[r.id]=new Wu);let D=!1;const O={};S.name!=="globe"&&M.handleWrapJump(y);for(const j of u){const H=j.getBucket(r);H&&r.id===H.layerIds[0]&&(H.bucketInstanceId||(H.bucketInstanceId=++this.maxBucketInstanceId),M.addBucket(j.tileID,H,this.crossTileIDs)&&(D=!0),O[H.bucketInstanceId]=!0)}return M.removeStaleBuckets(O)&&(D=!0),D}pruneUnusedLayers(r){const u={};r.forEach(y=>{u[y]=!0});for(const y in this.layerIndexes)u[y]||delete this.layerIndexes[y]}}const Qo=(m,r)=>o.emitValidationErrors(m,r&&r.filter(u=>u.identifier!=="source.canvas")),Cl=o.pick(ms,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),kl=o.pick(ms,["setCenter","setZoom","setBearing","setPitch"]),no={version:8,layers:[],sources:{}},ta={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Co extends o.Evented{constructor(r,u={}){super(),this.map=r,this.dispatcher=new hs(mn(),this),this.imageManager=new ye,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(r._requestManager,u.localFontFamily?o.LocalGlyphMode.all:u.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,u.localFontFamily||u.localIdeographFontFamily),this.crossTileSymbolIndex=new Jo,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const y=this;this._rtlTextPluginCallback=Co.registerForPluginStateChange(S=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:S.pluginStatus,pluginURL:S.pluginURL},(M,D)=>{if(o.triggerPluginCompletionEvent(M),D&&D.every(O=>O))for(const O in y._sourceCaches){const j=y._sourceCaches[O],H=j.getSource().type;H!=="vector"&&H!=="geojson"||j.reload()}})}),this.on("data",S=>{if(S.dataType!=="source"||S.sourceDataType!=="metadata")return;const M=this.getSource(S.sourceId);if(M&&M.vectorLayerIds)for(const D in this._layers){const O=this._layers[D];O.source===M.id&&this._validateLayer(O)}})}loadURL(r,u={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const y=typeof u.validate=="boolean"?u.validate:!o.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,u.accessToken);const S=this.map._requestManager.transformRequest(r,o.ResourceType.Style);this._request=o.getJSON(S,(M,D)=>{this._request=null,M?this.fire(new o.ErrorEvent(M)):D&&this._load(D,y)})}loadJSON(r,u={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(r,u.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(no,!1)}_updateLayerCount(r,u){const y=u?1:-1;r.is3D()&&(this._num3DLayers+=y),r.type==="circle"&&(this._numCircleLayers+=y),r.type==="symbol"&&(this._numSymbolLayers+=y)}_load(r,u){if(u&&Qo(this,o.validateStyle(r)))return;this._loaded=!0,this.stylesheet=o.clone$1(r),this._updateMapProjection();for(const S in r.sources)this.addSource(S,r.sources[S],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const y=Mf(this.stylesheet.layers);this._order=y.map(S=>S.id),this._layers={},this._serializedLayers={};for(const S of y){const M=o.createStyleLayer(S);M.setEventedParent(this,{layer:{id:M.id}}),this._layers[M.id]=M,this._serializedLayers[M.id]=M.serialize(),this._updateLayerCount(M,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new di(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(u,y,S){let M,D,O;const j=o.exported.devicePixelRatio>1?"@2x":"";let H=o.getJSON(y.transformRequest(y.normalizeSpriteURL(u,j,".json"),o.ResourceType.SpriteJSON),(ht,pt)=>{H=null,O||(O=ht,M=pt,tt())}),X=o.getImage(y.transformRequest(y.normalizeSpriteURL(u,j,".png"),o.ResourceType.SpriteImage),(ht,pt)=>{X=null,O||(O=ht,D=pt,tt())});function tt(){if(O)S(O);else if(M&&D){const ht=o.exported.getImageData(D),pt={};for(const gt in M){const{width:mt,height:xt,x:et,y:ft,sdf:St,pixelRatio:Et,stretchX:$t,stretchY:Rt,content:Gt}=M[gt],Jt=new o.RGBAImage({width:mt,height:xt});o.RGBAImage.copy(ht,Jt,{x:et,y:ft},{x:0,y:0},{width:mt,height:xt}),pt[gt]={data:Jt,pixelRatio:Et,sdf:St,stretchX:$t,stretchY:Rt,content:Gt}}S(null,pt)}}return{cancel(){H&&(H.cancel(),H=null),X&&(X.cancel(),X=null)}}}(r,this.map._requestManager,(u,y)=>{if(this._spriteRequest=null,u)this.fire(new o.ErrorEvent(u));else if(y)for(const S in y)this.imageManager.addImage(S,y[S]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(r){const u=this.getSource(r.source);if(!u)return;const y=r.sourceLayer;y&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(y)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${y}" does not exist on source "${u.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const u=[];for(const y of r){const S=this._layers[y];S.type!=="custom"&&u.push(S.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&(typeof r.isLayerDraped=="function"?r.isLayerDraped():ta[r.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const u=this._changed;if(this._changed){const S=Object.keys(this._updatedLayers),M=Object.keys(this._removedLayers);(S.length||M.length)&&this._updateWorkerLayers(S,M);for(const D in this._updatedSources){const O=this._updatedSources[D];O==="reload"?this._reloadSource(D):O==="clear"&&this._clearSource(D)}this._updateTilesForChangedImages();for(const D in this._updatedPaintProps)this._layers[D].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const y={};for(const S in this._sourceCaches){const M=this._sourceCaches[S];y[S]=M.used,M.used=!1}for(const S of this._order){const M=this._layers[S];if(M.recalculate(r,this._availableImages),!M.isHidden(r.zoom)){const O=this._getLayerSourceCache(M);O&&(O.used=!0)}const D=this.map.painter;if(D){const O=M.getProgramIds();if(!O)continue;const j=M.getProgramConfiguration(r.zoom);for(const H of O)D.useProgram(H,j)}}for(const S in y){const M=this._sourceCaches[S];y[S]!==M.used&&M.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),Qo(this,o.validateStyle(r)))return!1;(r=o.clone$1(r)).layers=Mf(r.layers);const u=function(S,M){if(!S)return[{command:ms.setStyle,args:[M]}];let D=[];try{if(!z(S.version,M.version))return[{command:ms.setStyle,args:[M]}];z(S.center,M.center)||D.push({command:ms.setCenter,args:[M.center]}),z(S.zoom,M.zoom)||D.push({command:ms.setZoom,args:[M.zoom]}),z(S.bearing,M.bearing)||D.push({command:ms.setBearing,args:[M.bearing]}),z(S.pitch,M.pitch)||D.push({command:ms.setPitch,args:[M.pitch]}),z(S.sprite,M.sprite)||D.push({command:ms.setSprite,args:[M.sprite]}),z(S.glyphs,M.glyphs)||D.push({command:ms.setGlyphs,args:[M.glyphs]}),z(S.transition,M.transition)||D.push({command:ms.setTransition,args:[M.transition]}),z(S.light,M.light)||D.push({command:ms.setLight,args:[M.light]}),z(S.fog,M.fog)||D.push({command:ms.setFog,args:[M.fog]}),z(S.projection,M.projection)||D.push({command:ms.setProjection,args:[M.projection]});const O={},j=[];(function(tt,ht,pt,gt){let mt;for(mt in ht=ht||{},tt=tt||{})tt.hasOwnProperty(mt)&&(ht.hasOwnProperty(mt)||yc(mt,pt,gt));for(mt in ht){if(!ht.hasOwnProperty(mt))continue;const xt=ht[mt];tt.hasOwnProperty(mt)?z(tt[mt],xt)||(tt[mt].type==="geojson"&&xt.type==="geojson"&&gh(tt,ht,mt)?pt.push({command:ms.setGeoJSONSourceData,args:[mt,xt.data]}):mh(mt,ht,pt,gt)):Nu(mt,ht,pt)}})(S.sources,M.sources,j,O);const H=[];S.layers&&S.layers.forEach(tt=>{tt.source&&O[tt.source]?D.push({command:ms.removeLayer,args:[tt.id]}):H.push(tt)});let X=S.terrain;X&&O[X.source]&&(D.push({command:ms.setTerrain,args:[void 0]}),X=void 0),D=D.concat(j),z(X,M.terrain)||D.push({command:ms.setTerrain,args:[M.terrain]}),function(tt,ht,pt){ht=ht||[];const gt=(tt=tt||[]).map(To),mt=ht.map(To),xt=tt.reduce(ju,{}),et=ht.reduce(ju,{}),ft=gt.slice(),St=Object.create(null);let Et,$t,Rt,Gt,Jt,Yt,ae;for(Et=0,$t=0;Et<gt.length;Et++)Rt=gt[Et],et.hasOwnProperty(Rt)?$t++:(pt.push({command:ms.removeLayer,args:[Rt]}),ft.splice(ft.indexOf(Rt,$t),1));for(Et=0,$t=0;Et<mt.length;Et++)Rt=mt[mt.length-1-Et],ft[ft.length-1-Et]!==Rt&&(xt.hasOwnProperty(Rt)?(pt.push({command:ms.removeLayer,args:[Rt]}),ft.splice(ft.lastIndexOf(Rt,ft.length-$t),1)):$t++,Yt=ft[ft.length-Et],pt.push({command:ms.addLayer,args:[et[Rt],Yt]}),ft.splice(ft.length-Et,0,Rt),St[Rt]=!0);for(Et=0;Et<mt.length;Et++)if(Rt=mt[Et],Gt=xt[Rt],Jt=et[Rt],!St[Rt]&&!z(Gt,Jt))if(z(Gt.source,Jt.source)&&z(Gt["source-layer"],Jt["source-layer"])&&z(Gt.type,Jt.type)){for(ae in eo(Gt.layout,Jt.layout,pt,Rt,null,ms.setLayoutProperty),eo(Gt.paint,Jt.paint,pt,Rt,null,ms.setPaintProperty),z(Gt.filter,Jt.filter)||pt.push({command:ms.setFilter,args:[Rt,Jt.filter]}),z(Gt.minzoom,Jt.minzoom)&&z(Gt.maxzoom,Jt.maxzoom)||pt.push({command:ms.setLayerZoomRange,args:[Rt,Jt.minzoom,Jt.maxzoom]}),Gt)Gt.hasOwnProperty(ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&(ae.indexOf("paint.")===0?eo(Gt[ae],Jt[ae],pt,Rt,ae.slice(6),ms.setPaintProperty):z(Gt[ae],Jt[ae])||pt.push({command:ms.setLayerProperty,args:[Rt,ae,Jt[ae]]}));for(ae in Jt)Jt.hasOwnProperty(ae)&&!Gt.hasOwnProperty(ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&(ae.indexOf("paint.")===0?eo(Gt[ae],Jt[ae],pt,Rt,ae.slice(6),ms.setPaintProperty):z(Gt[ae],Jt[ae])||pt.push({command:ms.setLayerProperty,args:[Rt,ae,Jt[ae]]}))}else pt.push({command:ms.removeLayer,args:[Rt]}),Yt=ft[ft.lastIndexOf(Rt)+1],pt.push({command:ms.addLayer,args:[Jt,Yt]})}(H,M.layers,D)}catch(O){console.warn("Unable to compute style diff:",O),D=[{command:ms.setStyle,args:[M]}]}return D}(this.serialize(),r).filter(S=>!(S.command in kl));if(u.length===0)return!1;const y=u.filter(S=>!(S.command in Cl));if(y.length>0)throw new Error(`Unimplemented: ${y.map(S=>S.command).join(", ")}.`);return u.forEach(S=>{S.command!=="setTransition"&&S.command!=="setProjection"&&this[S.command].apply(this,S.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,u){return this.getImage(r)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,u),this._afterImageUpdated(r),this)}updateImage(r,u){this.imageManager.updateImage(r,u)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,u,y={}){if(this._checkLoaded(),this.getSource(r)!==void 0)throw new Error("There is already a source with this ID");if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(o.validateSource,`sources.${r}`,u,null,y))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const S=Xi(r,u,this.dispatcher,this);S.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:S.serialize(),sourceId:r}));const M=D=>{const O=(D?"symbol:":"other:")+r,j=this._sourceCaches[O]=new o.SourceCache(O,S,D);(D?this._symbolSourceCaches:this._otherSourceCaches)[r]=j,j.style=this,j.onAdd(this.map)};M(!1),u.type!=="vector"&&u.type!=="geojson"||M(!0),S.onAdd&&S.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const u=this.getSource(r);if(!u)throw new Error("There is no source with this ID");for(const S in this._layers)if(this._layers[S].source===r)return this.fire(new o.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${S}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new o.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const y=this._getSourceCaches(r);for(const S of y)delete this._sourceCaches[S.id],delete this._updatedSources[S.id],S.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:S.getSource().id})),S.setEventedParent(null),S.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,u){this._checkLoaded(),this.getSource(r).setData(u),this._changed=!0}getSource(r){const u=this._getSourceCache(r);return u&&u.getSource()}_getSources(){const r=[];for(const u in this._otherSourceCaches){const y=this._getSourceCache(u);y&&r.push(y.getSource())}return r}addLayer(r,u,y={}){this._checkLoaded();const S=r.id;if(this.getLayer(S))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${S}" already exists on this map`)));let M;if(r.type==="custom"){if(Qo(this,o.validateCustomStyleLayer(r)))return;M=o.createStyleLayer(r)}else{if(typeof r.source=="object"&&(this.addSource(S,r.source),r=o.clone$1(r),r=o.extend(r,{source:S})),this._validate(o.validateLayer,`layers.${S}`,r,{arrayIndex:-1},y))return;M=o.createStyleLayer(r),this._validateLayer(M),M.setEventedParent(this,{layer:{id:S}}),this._serializedLayers[M.id]=M.serialize(),this._updateLayerCount(M,!0)}const D=u?this._order.indexOf(u):this._order.length;if(u&&D===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`)));this._order.splice(D,0,S),this._layerOrderChanged=!0,this._layers[S]=M;const O=this._getLayerSourceCache(M);if(this._removedLayers[S]&&M.source&&O&&M.type!=="custom"){const j=this._removedLayers[S];delete this._removedLayers[S],j.type!==M.type?this._updatedSources[M.source]="clear":(this._updatedSources[M.source]="reload",O.pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,u){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===u)return;const y=this._order.indexOf(r);this._order.splice(y,1);const S=u?this._order.indexOf(u):this._order.length;u&&S===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`))):(this._order.splice(S,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const u=this._layers[r];if(!u)return void this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));u.setEventedParent(null),this._updateLayerCount(u,!1);const y=this._order.indexOf(r);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=u,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],u.onRemove&&u.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const u in this._layers)if(this._layers[u].type===r)return!0;return!1}setLayerZoomRange(r,u,y){this._checkLoaded();const S=this.getLayer(r);S?S.minzoom===u&&S.maxzoom===y||(u!=null&&(S.minzoom=u),y!=null&&(S.maxzoom=y),this._updateLayer(S)):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,u,y={}){this._checkLoaded();const S=this.getLayer(r);if(S){if(!z(S.filter,u))return u==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(o.validateFilter,`layers.${S.id}.filter`,u,{layerType:S.type},y)||(S.filter=o.clone$1(u),this._updateLayer(S)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const u=this.getLayer(r);return u&&o.clone$1(u.filter)}setLayoutProperty(r,u,y,S={}){this._checkLoaded();const M=this.getLayer(r);M?z(M.getLayoutProperty(u),y)||(M.setLayoutProperty(u,y,S),this._updateLayer(M)):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,u){const y=this.getLayer(r);if(y)return y.getLayoutProperty(u);this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,u,y,S={}){this._checkLoaded();const M=this.getLayer(r);M?z(M.getPaintProperty(u),y)||(M.setPaintProperty(u,y,S)&&this._updateLayer(M),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,u){const y=this.getLayer(r);return y&&y.getPaintProperty(u)}setFeatureState(r,u){this._checkLoaded();const y=r.source,S=r.sourceLayer,M=this.getSource(y);if(!M)return void this.fire(new o.ErrorEvent(new Error(`The source '${y}' does not exist in the map's style.`)));const D=M.type;if(D==="geojson"&&S)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(D==="vector"&&!S)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const O=this._getSourceCaches(y);for(const j of O)j.setFeatureState(S,r.id,u)}removeFeatureState(r,u){this._checkLoaded();const y=r.source,S=this.getSource(y);if(!S)return void this.fire(new o.ErrorEvent(new Error(`The source '${y}' does not exist in the map's style.`)));const M=S.type,D=M==="vector"?r.sourceLayer:void 0;if(M==="vector"&&!D)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const O=this._getSourceCaches(y);for(const j of O)j.removeFeatureState(D,r.id,u)}getFeatureState(r){this._checkLoaded();const u=r.source,y=r.sourceLayer,S=this.getSource(u);if(S){if(S.type!=="vector"||y)return r.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(u)[0].getFeatureState(y,r.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const u in this._sourceCaches){const y=this._sourceCaches[u].getSource();r[y.id]||(r[y.id]=y.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0;const u=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&u&&u.getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",u.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const u=D=>this._layers[D].type==="fill-extrusion",y={},S=[];for(let D=this._order.length-1;D>=0;D--){const O=this._order[D];if(u(O)){y[O]=D;for(const j of r){const H=j[O];if(H)for(const X of H)S.push(X)}}}S.sort((D,O)=>O.intersectionZ-D.intersectionZ);const M=[];for(let D=this._order.length-1;D>=0;D--){const O=this._order[D];if(u(O))for(let j=S.length-1;j>=0;j--){const H=S[j].feature;if(y[H.layer.id]<D)break;M.push(H),S.pop()}else for(const j of r){const H=j[O];if(H)for(const X of H)M.push(X.feature)}}return M}queryRenderedFeatures(r,u,y){u&&u.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",u.filter,null,u);const S={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const j of u.layers){const H=this._layers[j];if(!H)return this.fire(new o.ErrorEvent(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];S[H.source]=!0}}const M=[];u.availableImages=this._availableImages;const D=u&&u.layers?u.layers.some(j=>{const H=this.getLayer(j);return H&&H.is3D()}):this.has3DLayers(),O=Zs.createFromScreenPoints(r,y);for(const j in this._sourceCaches){const H=this._sourceCaches[j].getSource().id;u.layers&&!S[H]||M.push(en(this._sourceCaches[j],this._layers,this._serializedLayers,O,u,y,D,!!this.map._showQueryGeometry))}return this.placement&&M.push(function(j,H,X,tt,ht,pt,gt){const mt={},xt=pt.queryRenderedSymbols(tt),et=[];for(const ft of Object.keys(xt).map(Number))et.push(gt[ft]);et.sort(Kn);for(const ft of et){const St=ft.featureIndex.lookupSymbolFeatures(xt[ft.bucketInstanceId],H,ft.bucketIndex,ft.sourceLayerIndex,ht.filter,ht.layers,ht.availableImages,j);for(const Et in St){const $t=mt[Et]=mt[Et]||[],Rt=St[Et];Rt.sort((Gt,Jt)=>{const Yt=ft.featureSortOrder;if(Yt){const ae=Yt.indexOf(Gt.featureIndex);return Yt.indexOf(Jt.featureIndex)-ae}return Jt.featureIndex-Gt.featureIndex});for(const Gt of Rt)$t.push(Gt)}}for(const ft in mt)mt[ft].forEach(St=>{const Et=St.feature,$t=X(j[ft]);if(!$t)return;const Rt=$t.getFeatureState(Et.layer["source-layer"],Et.id);Et.source=Et.layer.source,Et.layer["source-layer"]&&(Et.sourceLayer=Et.layer["source-layer"]),Et.state=Rt});return mt}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),O.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(M)}querySourceFeatures(r,u){u&&u.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",u.filter,null,u);const y=this._getSourceCaches(r);let S=[];for(const M of y)S=S.concat(an(M,u));return S}addSourceType(r,u,y){return Co.getSourceType(r)?y(new Error(`A source type called "${r}" already exists.`)):(Co.setSourceType(r,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:u.workerSourceURL},y):y(null,null))}getLight(){return this.light.getLight()}setLight(r,u={}){this._checkLoaded();const y=this.light.getLight();let S=!1;for(const D in r)if(!z(r[D],y[D])){S=!0;break}if(!S)return;const M=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,u),this.light.updateTransitions(M)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,u=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let y=r;if(u===1){if(typeof y.source=="object"){const S="terrain-dem-src";this.addSource(S,y.source),y=o.clone$1(y),y=o.extend(y,{source:S})}if(this._validate(o.validateTerrain,"terrain",y))return}if(!this.terrain||this.terrain&&u!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,u)}else{const S=this.terrain,M=S.get();for(const D of Object.keys(o.spec.terrain))!y.hasOwnProperty(D)&&o.spec.terrain[D].default&&(y[D]=o.spec.terrain[D].default);for(const D in y)if(!z(y[D],M[D])){S.set(y),this.stylesheet.terrain=y;const O=this._setTransitionParameters({duration:0});S.updateTransitions(O);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const u=this.fog=new Ns(r,this.map.transform);this.stylesheet.fog=r;const y=this._setTransitionParameters({duration:0});u.updateTransitions(y)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog,y=u.get();Object.keys(r).length===0&&u.set(r);for(const S in r)if(!z(r[S],y[S])){u.set(r),this.stylesheet.fog=r;const M=this._setTransitionParameters({duration:0});u.updateTransitions(M);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:o.exported.now(),transition:o.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(y=>this.isLayerDraped(this._layers[y])),u=this._order.filter(y=>!this.isLayerDraped(this._layers[y]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...u)}_createTerrain(r,u){const y=this.terrain=new Ge(r,u);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const S=this._setTransitionParameters({duration:0});y.updateTransitions(S)}_force3DLayerUpdate(){for(const r in this._layers){const u=this._layers[r];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const u=this._layers[r];u.type==="symbol"&&this._updateLayer(u)}}_validate(r,u,y,S,M={}){return(!M||M.validate!==!1)&&Qo(this,r.call(o.validateStyle,o.extend({key:u,style:this.serialize(),value:y,styleSpec:o.spec},S)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const u=this._getSourceCaches(r);for(const y of u)y.clearTiles()}_reloadSource(r){const u=this._getSourceCaches(r);for(const y of u)y.resume(),y.reload()}_reloadSources(){for(const r of this._getSources())r.reload&&r.reload()}_updateSources(r){for(const u in this._sourceCaches)this._sourceCaches[u].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const u=this._sourceCaches[r];u.resume(),u.reload()}}_updatePlacement(r,u,y,S,M=!1){let D=!1,O=!1;const j={};for(const H of this._order){const X=this._layers[H];if(X.type!=="symbol")continue;if(!j[X.source]){const ht=this._getLayerSourceCache(X);if(!ht)continue;j[X.source]=ht.getRenderableIds(!0).map(pt=>ht.getTileByID(pt)).sort((pt,gt)=>gt.tileID.overscaledZ-pt.tileID.overscaledZ||(pt.tileID.isLessThan(gt.tileID)?-1:1))}const tt=this.crossTileSymbolIndex.addLayer(X,j[X.source],r.center.lng,r.projection);D=D||tt}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),M=M||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(M||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),r.zoom))&&(this.pauseablePlacement=new wc(r,this._order,M,u,y,S,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,j),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),O=!0),D&&this.pauseablePlacement.placement.setStale()),O||D)for(const H of this._order){const X=this._layers[H];X.type==="symbol"&&this.placement.updateLayerOpacities(X,j[X.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,u,y){this.imageManager.getImages(u.icons,y),this._updateTilesForChangedImages();const S=M=>{M&&M.setDependencies(u.tileID.key,u.type,u.icons)};S(this._otherSourceCaches[u.source]),S(this._symbolSourceCaches[u.source])}getGlyphs(r,u,y){this.glyphManager.getGlyphs(u.stacks,y)}getResource(r,u,y){return o.makeRequest(u,y)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const u=[];return this._otherSourceCaches[r]&&u.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&u.push(this._symbolSourceCaches[r]),u}_isSourceCacheLoaded(r){const u=this._getSourceCaches(r);return u.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):u.every(y=>y.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Co.getSourceType=function(m){return zi[m]},Co.setSourceType=function(m,r){zi[m]=r},Co.registerForPluginStateChange=o.registerForPluginStateChange;var Hu=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Xa="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ko=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,cn=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Hn=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Tc={},Pl={};const Il=[];Br(Hu,Il),Br(ko,Il),Br(cn,Il),Br(Hn,Il),Tc=ps("",ko),Pl=ps(Hn,cn);const Ll=ps(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),vh=Hu,Dl=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var bh={background:ps(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ps(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ps(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ps("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ps(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ps(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ps("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ps("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ps("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:ps(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:ps(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ps(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ps(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ps(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:ps(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:ps(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ps(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ps(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:ps(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:ps(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:ps(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:ps(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:ps(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:ps(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:ps(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ps(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Xa),skyboxGradient:ps(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Xa),skyboxCapture:ps(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ps(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ps(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Br(m,r){const u=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let y of u)if(y=y.trim(),y[0]==="#"&&y.includes("if")&&!y.includes("endif")){y=y.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const S=y.split(" ");for(const M of S)r.includes(M)||r.push(M)}}function ps(m,r){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),S={},M=[...Il];return Br(m,M),Br(r,M),{fragmentSource:m=m.replace(u,(D,O,j,H,X)=>(S[X]=!0,O==="define"?`
#ifndef HAS_UNIFORM_u_${X}
varying ${j} ${H} ${X};
#else
uniform ${j} ${H} u_${X};
#endif
`:`
#ifdef HAS_UNIFORM_u_${X}
    ${j} ${H} ${X} = u_${X};
#endif
`)),vertexSource:r=r.replace(u,(D,O,j,H,X)=>{const tt=H==="float"?"vec2":"vec4",ht=X.match(/color/)?"color":tt;return S[X]?O==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
attribute ${j} ${tt} a_${X};
varying ${j} ${H} ${X};
#else
uniform ${j} ${H} u_${X};
#endif
`:ht==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = a_${X};
#else
    ${j} ${H} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = unpack_mix_${ht}(a_${X}, u_${X}_t);
#else
    ${j} ${H} ${X} = u_${X};
#endif
`:O==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
attribute ${j} ${tt} a_${X};
#else
uniform ${j} ${H} u_${X};
#endif
`:ht==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${j} ${H} ${X} = a_${X};
#else
    ${j} ${H} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${j} ${H} ${X} = unpack_mix_${ht}(a_${X}, u_${X}_t);
#else
    ${j} ${H} ${X} = u_${X};
#endif
`}),staticAttributes:y,usedDefines:M}}class cm{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,u,y,S,M,D,O){this.context=r;let j=this.boundPaintVertexBuffers.length!==S.length;for(let X=0;!j&&X<S.length;X++)this.boundPaintVertexBuffers[X]!==S[X]&&(j=!0);let H=this.boundDynamicVertexBuffers.length!==O.length;for(let X=0;!H&&X<O.length;X++)this.boundDynamicVertexBuffers[X]!==O[X]&&(H=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==y||j||H||this.boundIndexBuffer!==M||this.boundVertexOffset!==D)this.freshBind(u,y,S,M,D,O);else{r.bindVertexArrayOES.set(this.vao);for(const X of O)X&&X.bind();M&&M.dynamicDraw&&M.bind()}}freshBind(r,u,y,S,M,D){let O;const j=r.numAttributes,H=this.context,X=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),O=0,this.boundProgram=r,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=S,this.boundVertexOffset=M,this.boundDynamicVertexBuffers=D;else{O=H.currentNumAttributes||0;for(let tt=j;tt<O;tt++)X.disableVertexAttribArray(tt)}u.enableAttributes(X,r),u.bind(),u.setVertexAttribPointers(X,r,M);for(const tt of y)tt.enableAttributes(X,r),tt.bind(),tt.setVertexAttribPointers(X,r,M);for(const tt of D)tt&&(tt.enableAttributes(X,r),tt.bind(),tt.setVertexAttribPointers(X,r,M));S&&S.bind(),H.currentNumAttributes=j}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function qa(m,r){const u=Math.pow(2,r.canonical.z),y=r.canonical.y;return[new o.MercatorCoordinate(0,y/u).toLngLat().lat,new o.MercatorCoordinate(0,(y+1)/u).toLngLat().lat]}function Xu(m,r,u,y,S,M,D){const O=m.context,j=O.gl,H=u.fbo;if(!H)return;m.prepareDrawTile();const X=m.useProgram("hillshade");O.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,H.colorAttachment.get());const tt=((mt,xt,et,ft)=>{const St=et.paint.get("hillshade-shadow-color"),Et=et.paint.get("hillshade-highlight-color"),$t=et.paint.get("hillshade-accent-color");let Rt=et.paint.get("hillshade-illumination-direction")*(Math.PI/180);et.paint.get("hillshade-illumination-anchor")==="viewport"&&(Rt-=mt.transform.angle);const Gt=!mt.options.moving;return{u_matrix:ft||mt.transform.calculateProjMatrix(xt.tileID.toUnwrapped(),Gt),u_image:0,u_latrange:qa(0,xt.tileID),u_light:[et.paint.get("hillshade-exaggeration"),Rt],u_shadow:St,u_highlight:Et,u_accent:$t}})(m,u,y,m.terrain?r.projMatrix:null);m.prepareDrawProgram(O,X,r.toUnwrapped());const{tileBoundsBuffer:ht,tileBoundsIndexBuffer:pt,tileBoundsSegments:gt}=m.getTileBoundsBuffers(u);X.draw(O,j.TRIANGLES,S,M,D,o.CullFaceMode.disabled,tt,y.id,ht,pt,gt)}function wh(m,r,u){if(!r.needsDEMTextureUpload)return;const y=m.context,S=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||m.getTileTexture(u.stride);const M=u.getPixels();r.demTexture?r.demTexture.update(M,{premultiply:!1}):r.demTexture=new o.Texture(y,M,S.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Th(m,r,u,y,S,M){const D=m.context,O=D.gl;if(!r.dem)return;const j=r.dem;if(D.activeTexture.set(O.TEXTURE1),wh(m,r,j),!r.demTexture)return;r.demTexture.bind(O.NEAREST,O.CLAMP_TO_EDGE);const H=j.dim;D.activeTexture.set(O.TEXTURE0);let X=r.fbo;if(!X){const gt=new o.Texture(D,{width:H,height:H,data:null},O.RGBA);gt.bind(O.LINEAR,O.CLAMP_TO_EDGE),X=r.fbo=D.createFramebuffer(H,H,!0),X.colorAttachment.set(gt.texture)}D.bindFramebuffer.set(X.framebuffer),D.viewport.set([0,0,H,H]);const{tileBoundsBuffer:tt,tileBoundsIndexBuffer:ht,tileBoundsSegments:pt}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(D,O.TRIANGLES,y,S,M,o.CullFaceMode.disabled,((gt,mt)=>{const xt=mt.stride,et=o.create();return o.ortho(et,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(et,et,[0,-o.EXTENT,0]),{u_matrix:et,u_image:1,u_dimension:[xt,xt],u_zoom:gt.overscaledZ,u_unpack:mt.unpackVector}})(r.tileID,j),u.id,tt,ht,pt),r.needsHillshadePrepare=!1}const Sh=m=>({u_matrix:new o.UniformMatrix4f(m),u_image0:new o.Uniform1i(m),u_skirt_height:new o.Uniform1f(m)}),va=(m,r)=>({u_matrix:m,u_image0:0,u_skirt_height:r}),Eh=(m,r,u,y,S,M,D,O,j,H,X,tt,ht,pt,gt)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:u,u_zoom_transition:S,u_merc_center:M,u_image0:0,u_frustum_tl:D,u_frustum_tr:O,u_frustum_br:j,u_frustum_bl:H,u_globe_pos:X,u_globe_radius:tt,u_viewport:ht,u_grid_matrix:gt?Float32Array.from(gt):new Float32Array(9),u_skirt_height:pt});function Za(m,r){return m!=null&&r!=null&&!(!m.hasData()||!r.hasData())&&m.demTexture!=null&&r.demTexture!=null&&m.tileID.key!==r.tileID.key}const ro=new class{constructor(){this.operations={}}newMorphing(m,r,u,y,S){if(m in this.operations){const M=this.operations[m];M.to.tileID.key!==u.tileID.key&&(M.queued=u)}else this.operations[m]={startTime:y,phase:0,duration:S,from:r,to:u,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const r=this.operations[m];return{from:r.from,to:r.to,phase:r.phase}}update(m){for(const r in this.operations){const u=this.operations[r];for(u.phase=(m-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,m)){delete this.operations[r];break}}}_nextOp(m,r){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=r,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},Ya={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Mh(m){return 6*Math.pow(1.5,22-m)}function Pf(m,r){const u=1<<m.z;return!r&&(m.x===0||m.x===u-1)||m.y===0||m.y===u-1}const Sc=m=>({u_matrix:m});function qu(m,r,u,y,S){if(S>0){const M=o.exported.now(),D=(M-m.timeAdded)/S,O=r?(M-r.timeAdded)/S:-1,j=u.getSource(),H=y.coveringZoomLevel({tileSize:j.tileSize,roundZoom:j.roundZoom}),X=!r||Math.abs(r.tileID.overscaledZ-H)>Math.abs(m.tileID.overscaledZ-H),tt=X&&m.refreshedUponExpiration?1:o.clamp(X?D:1-O,0,1);return m.refreshedUponExpiration&&D>=1&&(m.refreshedUponExpiration=!1),r?{opacity:1,mix:1-tt}:{opacity:tt,mix:0}}return{opacity:1,mix:0}}class Ec extends o.SourceCache{constructor(r){const u={type:"raster-dem",maxzoom:r.transform.maxZoom},y=new hs(mn(),null),S=Xi("mock-dem",u,y,r.style);super("mock-dem",S,!1),S.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,u){r.state="loaded",u(null)}}class Ah extends o.SourceCache{constructor(r){const u=Xi("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new hs(mn(),null),r.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,u,y){if(r.freezeTileCoverage)return;this.transform=r;const S=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((M,D)=>{if(M[D.key]="",!this._tiles[D.key]){const O=new o.Tile(D,this._source.tileSize*D.overscaleFactor(),r.tileZoom);O.state="loaded",this._tiles[D.key]=O}return M},{});for(const M in this._tiles)M in S||(this.freeFBO(M),this._tiles[M].unloadVectorData(),delete this._tiles[M])}freeFBO(r){const u=this.proxyCachedFBO[r];if(u!==void 0){const y=Object.values(u);this.renderCachePool.push(...y),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ch extends o.OverscaledTileID{constructor(r,u,y){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=u,this.projMatrix=y}}class Zu extends o.Elevation{constructor(r,u){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,S,M]=function(j){const H=new o.StructArrayLayout2i4,X=new o.StructArrayLayout3ui6,tt=131;H.reserve(17161),X.reserve(33800);const ht=o.EXTENT/128,pt=o.EXTENT+ht/2,gt=pt+ht;for(let xt=-ht;xt<gt;xt+=ht)for(let et=-ht;et<gt;et+=ht){const ft=et<0||et>pt||xt<0||xt>pt?24575:0,St=o.clamp(Math.round(et),0,o.EXTENT),Et=o.clamp(Math.round(xt),0,o.EXTENT);H.emplaceBack(St+ft,Et)}const mt=(xt,et)=>{const ft=et*tt+xt;X.emplaceBack(ft+1,ft,ft+tt),X.emplaceBack(ft+tt,ft+tt+1,ft+1)};for(let xt=1;xt<129;xt++)for(let et=1;et<129;et++)mt(et,xt);return[0,129].forEach(xt=>{for(let et=0;et<130;et++)mt(et,xt),mt(xt,et)}),[H,X,32768]}(),D=r.context;this.gridBuffer=D.createVertexBuffer(y,o.posAttributes.members),this.gridIndexBuffer=D.createIndexBuffer(S),this.gridSegments=o.SegmentVector.simpleSegment(0,0,y.length,S.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,y.length,M),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ah(u.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.EXTENT,0,o.EXTENT,0,1);const O=D.gl;this._overlapStencilMode=new o.StencilMode({func:O.GEQUAL,mask:255},0,255,O.KEEP,O.KEEP,O.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ec(u.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,u,y){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const S=r.terrain.properties;this.sourceCache=r.terrain.drapeRenderMode===0?this._mockSourceCache:r._getSourceCache(S.get("source")),this._exaggeration=S.get("exaggeration");const M=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const D=this.getScaledDemTileSize();this.sourceCache.update(u,D,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,M(),this._initializing=!0),M(),u.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||r.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=y._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(y.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const S=this.proxyCoords=u.getIds().map(j=>{const H=u.getTileByID(j).tileID;return H.projMatrix=y.calculateProjMatrix(H.toUnwrapped()),H});(function(j,H){const X=H.transform.pointCoordinate(H.transform.getCameraPoint()),tt=new o.Point(X.x,X.y);j.sort((ht,pt)=>{if(pt.overscaledZ-ht.overscaledZ)return pt.overscaledZ-ht.overscaledZ;const gt=new o.Point(ht.canonical.x+(1<<ht.canonical.z)*ht.wrap,ht.canonical.y),mt=new o.Point(pt.canonical.x+(1<<pt.canonical.z)*pt.wrap,pt.canonical.y),xt=tt.mult(1<<ht.canonical.z);return xt.x-=.5,xt.y-=.5,xt.distSqr(gt)-xt.distSqr(mt)})})(S,this.painter),this._previousZoom=y.zoom;const M=this.proxyToSource||{};this.proxyToSource={},S.forEach(j=>{this.proxyToSource[j.key]={}}),this.terrainTileForTile={};const D=this._style._sourceCaches;for(const j in D){const H=D[j];if(!H.used||(H!==this.sourceCache&&this.resetTileLookupCache(H.id),this._setupProxiedCoordsForOrtho(H,r[j],M),H.usedForTerrain))continue;const X=r[j];H.getSource().reparseOverscaled&&this._assignTerrainTiles(X)}this.proxiedCoords[u.id]=S.map(j=>new Ch(j,j.key,this.orthoMatrix)),this._assignTerrainTiles(S),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(M),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const O={};this._visibleDemTiles=[];for(const j of this.proxyCoords){const H=this.terrainTileForTile[j.key];if(!H)continue;const X=H.tileID.key;X in O||(this._visibleDemTiles.push(H),O[X]=X)}}_assignTerrainTiles(r){this._initializing||r.forEach(u=>{if(this.terrainTileForTile[u.key])return;const y=this._findTileCoveringTileID(u,this.sourceCache);y&&(this.terrainTileForTile[u.key]=y)})}_prepareDEMTextures(){const r=this.painter.context,u=r.gl;for(const y in this.terrainTileForTile){const S=this.terrainTileForTile[y],M=S.dem;!M||S.demTexture&&!S.needsDEMTextureUpload||(r.activeTexture.set(u.TEXTURE1),wh(this.painter,S,M))}}_prepareDemTileUniforms(r,u,y,S){if(!u||u.demTexture==null)return!1;const M=r.tileID.canonical,D=Math.pow(2,u.tileID.canonical.z-M.z),O=S||"";return y[`u_dem_tl${O}`]=[M.x*D%1,M.y*D%1],y[`u_dem_scale${O}`]=D,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,u=r.gl;if(!this._emptyDepthBufferTexture){const y=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(r,y,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const u=this._visibleDemTiles.reduce((y,S)=>{if(!S.dem)return y;const M=S.dem.tree.minimums[0];return M>0&&r++,y+M},0);return r?u/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,u=r.gl;r.activeTexture.set(u.TEXTURE2);const y=this._getLoadedAreaMinimum(),S=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(y,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let M=this._emptyDEMTexture;return M?M.update(S,{premultiply:!1}):M=this._emptyDEMTexture=new o.Texture(r,S,u.RGBA,{premultiply:!1}),M}setupElevationDraw(r,u,y){const S=this.painter.context,M=S.gl,D=(O=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(O),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var O;D.u_dem_size=this.sourceCache.getSource().tileSize,D.u_exaggeration=this.exaggeration();let j=null,H=null,X=1;if(y&&y.morphing&&this._useVertexMorphing){const tt=y.morphing.srcDemTile,ht=y.morphing.dstDemTile;X=y.morphing.phase,tt&&ht&&(this._prepareDemTileUniforms(r,tt,D,"_prev")&&(H=tt),this._prepareDemTileUniforms(r,ht,D)&&(j=ht))}if(H&&j?(S.activeTexture.set(M.TEXTURE2),j.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE,M.NEAREST),S.activeTexture.set(M.TEXTURE4),H.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE,M.NEAREST),D.u_dem_lerp=X):(j=this.terrainTileForTile[r.tileID.key],S.activeTexture.set(M.TEXTURE2),(this._prepareDemTileUniforms(r,j,D)?j.demTexture:this.emptyDEMTexture).bind(M.NEAREST,M.CLAMP_TO_EDGE)),S.activeTexture.set(M.TEXTURE3),y&&y.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),this._depthFBO&&(D.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),D.u_depth_size_inv=[1,1]),y&&y.useMeterToDem&&j){const tt=(1<<j.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;D.u_meter_to_dem=tt}if(y&&y.labelPlaneMatrixInv&&(D.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),u.setTerrainUniformValues(S,D),this.painter.transform.projection.name==="globe"){const tt=this.globeUniformValues(this.painter.transform,r.tileID.canonical,y&&y.useDenormalizedUpVectorScale);u.setGlobeUniformValues(S,tt)}}globeUniformValues(r,u,y){const S=r.projection;return{u_tile_tl_up:S.upVector(u,0,0),u_tile_tr_up:S.upVector(u,o.EXTENT,0),u_tile_br_up:S.upVector(u,o.EXTENT,o.EXTENT),u_tile_bl_up:S.upVector(u,0,o.EXTENT),u_tile_up_scale:y?o.globeMetersToEcef(1):S.upVectorScale(u,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const u=this.painter,y=this.painter.context;r.length!==0&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(S,M,D,O,j){if(S.transform.projection.name==="globe")(function(H,X,tt,ht,pt){const gt=H.context,mt=gt.gl;let xt,et;const ft=H.options.showTerrainWireframe?2:0,St=H.transform,Et=o.globeUseCustomAntiAliasing(H,gt,St),$t=(Ie,ee)=>{if(et===Ie)return;const ve=[Ya[Ie],"PROJECTION_GLOBE_VIEW"];Et&&ve.push("CUSTOM_ANTIALIASING"),ee&&ve.push(Ya[ft]),xt=H.useProgram("globeRaster",null,ve),et=Ie},Rt=H.colorModeForRenderPass(),Gt=new o.DepthMode(mt.LEQUAL,o.DepthMode.ReadWrite,H.depthRangeFor3D);ro.update(pt);const Jt=o.calculateGlobeMercatorMatrix(St),Yt=[o.mercatorXfromLng(St.center.lng),o.mercatorYfromLat(St.center.lat)],ae=ft?[!1,!0]:[!1],ke=H.globeSharedBuffers,se=[St.width*o.exported.devicePixelRatio,St.height*o.exported.devicePixelRatio],xe=Float32Array.from(St.globeMatrix),ue={useDenormalizedUpVectorScale:!0};if(ae.forEach(Ie=>{const ee=H.transform,ve=Mh(ee.zoom)*X.exaggeration();et=-1;const De=Ie?mt.LINES:mt.TRIANGLES;for(const ge of ht){const Oe=tt.getTile(ge),yi=o.StencilMode.disabled,ki=X.prevTerrainTileForTile[ge.key],ai=X.terrainTileForTile[ge.key];Za(ki,ai)&&ro.newMorphing(ge.key,ki,ai,pt,250),gt.activeTexture.set(mt.TEXTURE0),Oe.texture.bind(mt.LINEAR,mt.CLAMP_TO_EDGE);const vi=ro.getMorphValuesForProxy(ge.key),Oi=vi?1:0;vi&&o.extend$1(ue,{morphing:{srcDemTile:vi.from,dstDemTile:vi.to,phase:o.easeCubicInOut(vi.phase)}});const Ri=o.tileCornersToBounds(ge.canonical),mi=o.getLatitudinalLod(Ri.getCenter().lat),xs=o.getGridMatrix(ge.canonical,Ri,mi,ee.worldSize/ee._pixelsPerMercatorPixel),ws=o.globeNormalizeECEF(o.globeTileBounds(ge.canonical)),Ts=Eh(ee.projMatrix,xe,Jt,ws,o.globeToMercatorTransition(ee.zoom),Yt,ee.frustumCorners.TL,ee.frustumCorners.TR,ee.frustumCorners.BR,ee.frustumCorners.BL,ee.globeCenterInViewSpace,ee.globeRadius,se,ve,xs);if($t(Oi,Ie),X.setupElevationDraw(Oe,xt,ue),H.prepareDrawProgram(gt,xt,ge.toUnwrapped()),ke){const[Ss,or,qn]=Ie?ke.getWirefameBuffers(H.context,mi):ke.getGridBuffers(mi,ve!==0);xt.draw(gt,De,Gt,yi,Rt,o.CullFaceMode.backCCW,Ts,"globe_raster",Ss,or,qn)}}}),ke){const Ie=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Et&&Ie.push("CUSTOM_ANTIALIASING"),xt=H.useProgram("globeRaster",null,Ie);for(const ee of ht){const{x:ve,y:De,z:ge}=ee.canonical,Oe=De===0,yi=De===(1<<ge)-1,[ki,ai,vi,Oi]=ke.getPoleBuffers(ge);if(Oi&&(Oe||yi)){const Ri=tt.getTile(ee);gt.activeTexture.set(mt.TEXTURE0),Ri.texture.bind(mt.LINEAR,mt.CLAMP_TO_EDGE);let mi=o.globePoleMatrixForTile(ge,ve,St);const xs=o.globeNormalizeECEF(o.globeTileBounds(ee.canonical)),ws=(Ts,Ss)=>Ts.draw(gt,mt.TRIANGLES,Gt,o.StencilMode.disabled,Rt,o.CullFaceMode.disabled,Eh(St.projMatrix,mi,mi,xs,0,Yt,St.frustumCorners.TL,St.frustumCorners.TR,St.frustumCorners.BR,St.frustumCorners.BL,St.globeCenterInViewSpace,St.globeRadius,se,0),"globe_pole_raster",Ss,vi,Oi);X.setupElevationDraw(Ri,xt,ue),H.prepareDrawProgram(gt,xt,ee.toUnwrapped()),Oe&&ws(xt,ki),yi&&(mi=o.scale(o.create(),mi,[1,-1,1]),ws(xt,ai))}}}})(S,M,D,O,j);else{const H=S.context,X=H.gl;let tt,ht;const pt=S.options.showTerrainWireframe?2:0,gt=(St,Et)=>{if(ht===St)return;const $t=[Ya[St]];Et&&$t.push(Ya[pt]),tt=S.useProgram("terrainRaster",null,$t),ht=St},mt=S.colorModeForRenderPass(),xt=new o.DepthMode(X.LEQUAL,o.DepthMode.ReadWrite,S.depthRangeFor3D);ro.update(j);const et=S.transform,ft=Mh(et.zoom)*M.exaggeration();(pt?[!1,!0]:[!1]).forEach(St=>{ht=-1;const Et=St?X.LINES:X.TRIANGLES,[$t,Rt]=St?M.getWirefameBuffer():[M.gridIndexBuffer,M.gridSegments];for(const Gt of O){const Jt=D.getTile(Gt),Yt=o.StencilMode.disabled,ae=M.prevTerrainTileForTile[Gt.key],ke=M.terrainTileForTile[Gt.key];Za(ae,ke)&&ro.newMorphing(Gt.key,ae,ke,j,250),H.activeTexture.set(X.TEXTURE0),Jt.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST);const se=ro.getMorphValuesForProxy(Gt.key),xe=se?1:0;let ue;se&&(ue={morphing:{srcDemTile:se.from,dstDemTile:se.to,phase:o.easeCubicInOut(se.phase)}});const Ie=va(Gt.projMatrix,Pf(Gt.canonical,et.renderWorldCopies)?ft/10:ft);gt(xe,St),M.setupElevationDraw(Jt,tt,ue),S.prepareDrawProgram(H,tt,Gt.toUnwrapped()),tt.draw(H,Et,xt,Yt,mt,o.CullFaceMode.backCCW,Ie,"terrain_raster",M.gridBuffer,$t,Rt)}})}}(u,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const u=this.painter,y=this.painter.context,S=this.proxySourceCache,M=this.proxiedCoords[S.id],D=this._drapedRenderBatches.shift(),O=[],j=u.style.order;let H=0;for(const X of M){const tt=S.getTileByID(X.proxyTileKey),ht=S.proxyCachedFBO[X.key]?S.proxyCachedFBO[X.key][r]:void 0,pt=ht!==void 0?S.renderCache[ht]:this.pool[H++],gt=ht!==void 0;if(tt.texture=pt.tex,gt&&!pt.dirty){O.push(tt.tileID);continue}let mt;y.bindFramebuffer.set(pt.fb.framebuffer),this.renderedToTile=!1,pt.dirty&&(y.clear({color:o.Color.transparent,stencil:0}),pt.dirty=!1);for(let xt=D.start;xt<=D.end;++xt){const et=u.style._layers[j[xt]];if(et.isHidden(u.transform.zoom))continue;const ft=u.style._getLayerSourceCache(et),St=ft?this.proxyToSource[X.key][ft.id]:[X];if(!St)continue;const Et=St;y.viewport.set([0,0,pt.fb.width,pt.fb.height]),mt!==(ft?ft.id:null)&&(this._setupStencil(pt,St,et,ft),mt=ft?ft.id:null),u.renderLayer(u,ft,et,Et)}this.renderedToTile?(pt.dirty=!0,O.push(tt.tileID)):gt||--H,H===5&&(H=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,u.width,u.height]),D.end+1}postRender(){}renderCacheEfficiency(r){const u=r.order.length;if(u===0)return{efficiency:100};let y,S=0,M=0,D=!1;for(let O=0;O<u;++O){const j=r._layers[r.order[O]];this._style.isLayerDraped(j)?(D&&++S,++M):D||(D=!0,y=j.id)}return M===0?{efficiency:100}:{efficiency:100*(1-S/M),firstUndrapedLayer:y}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{r=Math.min(r,u.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,u,y){if(!this._visibleDemTiles)return null;const S=this._visibleDemTiles.filter(M=>M.dem).map(M=>{const D=M.tileID,O=1<<D.overscaledZ,{x:j,y:H}=D.canonical,X=j/O,tt=(j+1)/O,ht=H/O,pt=(H+1)/O;return{minx:X,miny:ht,maxx:tt,maxy:pt,t:M.dem.tree.raycastRoot(X,ht,tt,pt,r,u,y),tile:M}});S.sort((M,D)=>(M.t!==null?M.t:Number.MAX_VALUE)-(D.t!==null?D.t:Number.MAX_VALUE));for(const M of S){if(M.t==null)return null;const D=M.tile.dem.tree.raycast(M.minx,M.miny,M.maxx,M.maxy,r,u,y);if(D!=null)return D}return null}_createFBO(){const r=this.painter.context,u=r.gl,y=this.drapeBufferSize;r.activeTexture.set(u.TEXTURE0);const S=new o.Texture(r,{width:y[0],height:y[1],data:null},u.RGBA);S.bind(u.LINEAR,u.CLAMP_TO_EDGE);const M=r.createFramebuffer(y[0],y[1],!1);return M.colorAttachment.set(S.texture),M.depthAttachment=new qt(r,M.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,M.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):M.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&u.texParameterf(u.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:M,tex:S,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const u=this._style._layers[r],y=u.isHidden(this.painter.transform.zoom);return u.type==="custom"?!y&&u.shouldRedrape():!y&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const y of this._style._getSources())if(y instanceof He){r=!0;break}if(!r)return;const u={};for(let y=0;y<this._style.order.length;++y){const S=this._style._layers[this._style.order[y]],M=this._style._getLayerSourceCache(S);if(M&&!u[M.id]&&!S.isHidden(this.painter.transform.zoom)&&S.type==="line"&&S.widthExpression()instanceof o.ZoomDependentExpression){u[M.id]=!0;for(const D of this.proxyCoords){const O=this.proxyToSource[D.key][M.id];if(O)for(const j of O)this._clearRenderCacheForTile(M.id,j)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const y in this._style._sourceCaches)if(this._style._sourceCaches[y]._source instanceof ze){r=!0;break}if(!r)return;const u={};for(let y=0;y<this._style.order.length;++y){const S=this._style._layers[this._style.order[y]],M=this._style._getLayerSourceCache(S);if(!M||u[M.id]||S.isHidden(this.painter.transform.zoom)||S.type!=="raster")continue;const D=S.paint.get("raster-fade-duration");for(const O of this.proxyCoords){const j=this.proxyToSource[O.key][M.id];if(j)for(const H of j){const X=qu(M.getTile(H),M.findLoadedParent(H,0),M,this.painter.transform,D);(X.opacity!==1||X.mix!==0)&&this._clearRenderCacheForTile(M.id,H)}}}}_setupDrapedRenderBatches(){const r=this._style.order,u=r.length;if(u===0)return;const y=[];let S,M=0,D=this._style._layers[r[M]];for(;!this._style.isLayerDraped(D)&&D.isHidden(this.painter.transform.zoom)&&++M<u;)D=this._style._layers[r[M]];for(;M<u;++M){const O=this._style._layers[r[M]];O.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(O)?S===void 0&&(S=M):S!==void 0&&(y.push({start:S,end:M-1}),S=void 0))}S!==void 0&&y.push({start:S,end:M-1}),this._drapedRenderBatches=y}_setupRenderCache(r){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const D=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let O=0;O<D.length;++O){const j=Object.values(D[O]);u.renderCachePool.push(...j)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,S=this._tilesDirty;for(let D=y.length-1;D>=0;D--){const O=y[D];if(u.getTileByID(O.key),u.proxyCachedFBO[O.key]!==void 0){const j=r[O.key],H=this.proxyToSource[O.key];let X=0;for(const tt in H){const ht=H[tt],pt=j[tt];if(!pt||pt.length!==ht.length||ht.some((gt,mt)=>gt!==pt[mt]||S[tt]&&S[tt].hasOwnProperty(gt.key))){X=-1;break}++X}for(const tt in u.proxyCachedFBO[O.key])u.renderCache[u.proxyCachedFBO[O.key][tt]].dirty=X<0||X!==Object.values(j).length}}const M=[...this._drapedRenderBatches];M.sort((D,O)=>O.end-O.start-(D.end-D.start));for(const D of M)for(const O of y){if(u.proxyCachedFBO[O.key])continue;let j=u.renderCachePool.pop();j===void 0&&u.renderCache.length<50&&(j=u.renderCache.length,u.renderCache.push(this._createFBO())),j!==void 0&&(u.proxyCachedFBO[O.key]={},u.proxyCachedFBO[O.key][D.start]=j,u.renderCache[j].dirty=!0)}this._tilesDirty={}}_setupStencil(r,u,y,S){if(!S||!this._sourceTilesOverlap[S.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const M=this.painter.context,D=M.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let O;if(y.isTileClipped())O=u.length,this._overlapStencilMode.test={func:D.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);O=1,this._overlapStencilMode.test={func:D.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+O>255&&(M.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=O,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(r,u){const y=this.painter,S=this.painter.context,M=S.gl;y._tileClippingMaskIDs={},S.setColorMode(o.ColorMode.disabled),S.setDepthMode(o.DepthMode.disabled);const D=y.useProgram("clippingMask");for(const O of r){const j=y._tileClippingMaskIDs[O.key]=--u;D.draw(S,M.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:M.ALWAYS,mask:0},j,255,M.KEEP,M.KEEP,M.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Sc(O.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(r){const u=this.painter.transform;if(r.x<0||r.x>u.width||r.y<0||r.y>u.height)return null;const y=[r.x,r.y,1,1];o.transformMat4$1(y,y,u.pixelMatrixInverse),o.scale$1(y,y,1/y[3]),y[0]/=u.worldSize,y[1]/=u.worldSize;const S=u._camera.position,M=o.mercatorZfromAltitude(1,u.center.lat),D=[S[0],S[1],S[2]/M,0],O=o.subtract([],y.slice(0,3),D);o.normalize(O,O);const j=this.raycast(D,O,this._exaggeration);return j!==null&&j?(o.scaleAndAdd(D,D,O,j),D[3]=D[2],D[2]*=M,D):null}drawDepth(){const r=this.painter,u=r.context,y=this.proxySourceCache,S=Math.ceil(r.width),M=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===S&&this._depthFBO.height===M||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const D=u.gl,O=u.createFramebuffer(S,M,!0);u.activeTexture.set(D.TEXTURE0);const j=new o.Texture(u,{width:S,height:M,data:null},D.RGBA);j.bind(D.NEAREST,D.CLAMP_TO_EDGE),O.colorAttachment.set(j.texture);const H=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,S,M);O.depthAttachment.set(H),this._depthFBO=O,this._depthTexture=j}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,S,M]),function(D,O,j,H){if(D.transform.projection.name==="globe")return;const X=D.context,tt=X.gl;X.clear({depth:1});const ht=D.useProgram("terrainDepth"),pt=new o.DepthMode(tt.LESS,o.DepthMode.ReadWrite,D.depthRangeFor3D);for(const gt of H){const mt=j.getTile(gt),xt=va(gt.projMatrix,0);O.setupElevationDraw(mt,ht),ht.draw(X,tt.TRIANGLES,pt,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,xt,"terrain_depth",O.gridBuffer,O.gridIndexBuffer,O.gridNoSkirtSegments)}}(r,this,y,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,u,y){if(r.getSource()instanceof Ei)return this._setupProxiedCoordsForImageSource(r,u,y);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const S=this.proxiedCoords[r.id]=[],M=this.proxyCoords;for(let O=0;O<M.length;O++){const j=M[O],H=this._findTileCoveringTileID(j,r);if(H){const X=this._createProxiedId(j,H,y[j.key]&&y[j.key][r.id]);S.push(X),this.proxyToSource[j.key][r.id]=[X]}}let D=!1;for(let O=0;O<u.length;O++){const j=r.getTile(u[O]);if(!j||!j.hasData())continue;const H=this._findTileCoveringTileID(j.tileID,this.proxySourceCache);if(H&&H.tileID.canonical.z!==j.tileID.canonical.z){const X=this.proxyToSource[H.tileID.key][r.id],tt=this._createProxiedId(H.tileID,j,y[H.tileID.key]&&y[H.tileID.key][r.id]);X?X.splice(X.length-1,0,tt):this.proxyToSource[H.tileID.key][r.id]=[tt],S.push(tt),D=!0}}this._sourceTilesOverlap[r.id]=D}_setupProxiedCoordsForImageSource(r,u,y){if(!r.getSource().loaded())return;const S=this.proxiedCoords[r.id]=[],M=this.proxyCoords,D=r.getSource(),O=new o.Point(D.tileID.x,D.tileID.y)._div(1<<D.tileID.z),j=D.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((X,tt)=>(X.min.x=Math.min(X.min.x,tt.x-O.x),X.min.y=Math.min(X.min.y,tt.y-O.y),X.max.x=Math.max(X.max.x,tt.x-O.x),X.max.y=Math.max(X.max.y,tt.y-O.y),X),{min:new o.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),H=(X,tt)=>{const ht=X.wrap+X.canonical.x/(1<<X.canonical.z),pt=X.canonical.y/(1<<X.canonical.z),gt=o.EXTENT/(1<<X.canonical.z),mt=tt.wrap+tt.canonical.x/(1<<tt.canonical.z),xt=tt.canonical.y/(1<<tt.canonical.z);return ht+gt<mt+j.min.x||ht>mt+j.max.x||pt+gt<xt+j.min.y||pt>xt+j.max.y};for(let X=0;X<M.length;X++){const tt=M[X];for(let ht=0;ht<u.length;ht++){const pt=r.getTile(u[ht]);if(!pt||!pt.hasData()||H(tt,pt.tileID))continue;const gt=this._createProxiedId(tt,pt,y[tt.key]&&y[tt.key][r.id]),mt=this.proxyToSource[tt.key][r.id];mt?mt.push(gt):this.proxyToSource[tt.key][r.id]=[gt],S.push(gt)}}}_createProxiedId(r,u,y){let S=this.orthoMatrix;if(y){const M=y.find(D=>D.key===u.tileID.key);if(M)return M}if(u.tileID.key!==r.key){const M=r.canonical.z-u.tileID.canonical.z;let D,O,j;S=o.create();const H=u.tileID.wrap-r.wrap<<r.overscaledZ;M>0?(D=o.EXTENT>>M,O=D*((u.tileID.canonical.x<<M)-r.canonical.x+H),j=D*((u.tileID.canonical.y<<M)-r.canonical.y)):(D=o.EXTENT<<-M,O=o.EXTENT*(u.tileID.canonical.x-(r.canonical.x+H<<-M)),j=o.EXTENT*(u.tileID.canonical.y-(r.canonical.y<<-M))),o.ortho(S,0,D,0,D,0,1),o.translate(S,S,[O,j,0])}return new Ch(u.tileID,r.key,S)}_findTileCoveringTileID(r,u){let y=u.getTile(r);if(y&&y.hasData())return y;const S=this._findCoveringTileCache[u.id],M=S[r.key];if(y=M?u.getTileByID(M):null,y&&y.hasData()||M===null)return y;let D=y?y.tileID:r,O=D.overscaledZ;const j=u.getSource().minzoom,H=[];if(!M){const tt=u.getSource().maxzoom;if(r.canonical.z>=tt){const ht=r.canonical.z-tt;u.getSource().reparseOverscaled?(O=Math.max(r.canonical.z+2,u.transform.tileZoom),D=new o.OverscaledTileID(O,r.wrap,tt,r.canonical.x>>ht,r.canonical.y>>ht)):ht!==0&&(O=tt,D=new o.OverscaledTileID(O,r.wrap,tt,r.canonical.x>>ht,r.canonical.y>>ht))}D.key!==r.key&&(H.push(D.key),y=u.getTile(D))}const X=tt=>{H.forEach(ht=>{S[ht]=tt}),H.length=0};for(O-=1;O>=j&&(!y||!y.hasData());O--){y&&X(y.tileID.key);const tt=D.calculateScaledKey(O);if(y=u.getTileByID(tt),y&&y.hasData())break;const ht=S[tt];if(ht===null)break;ht===void 0?H.push(tt):y=u.getTileByID(ht)}return X(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,u){let y=this._tilesDirty[r];y||(y=this._tilesDirty[r]={}),y[u.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(u){let y=0;const S=new o.StructArrayLayout2ui4,M=131;for(let D=1;D<129;D++){for(let O=1;O<129;O++)y=D*M+O,S.emplaceBack(y,y+1),S.emplaceBack(y,y+M),S.emplaceBack(y+1,y+M),D===128&&S.emplaceBack(y+M,y+M+1);S.emplaceBack(y+1,y+1+M)}return S}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class rs{static cacheKey(r,u,y,S){let M=`${u}${S?S.cacheKey:""}`;for(const D of y)r.usedDefines.includes(D)&&(M+=`/${D}`);return M}constructor(r,u,y,S,M,D){const O=r.gl;this.program=O.createProgram();const j=function(et){const ft=[];for(let St=0;St<et.length;St++){if(et[St]===null)continue;const Et=et[St].split(" ");ft.push(Et.pop())}return ft}(y.staticAttributes),H=S?S.getBinderAttributes():[],X=j.concat(H);let tt=S?S.defines():[];tt=tt.concat(D.map(et=>`#define ${et}`));const ht=r.isWebGL2?`#version 300 es
`:"",pt=ht+tt.concat(r.extStandardDerivatives&&ht.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(Dl):Dl,Dl,vh,Ll.fragmentSource,Pl.fragmentSource,y.fragmentSource).join(`
`),gt=ht+tt.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,vh,Ll.vertexSource,Pl.vertexSource,Tc.vertexSource,y.vertexSource).join(`
`),mt=O.createShader(O.FRAGMENT_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);O.shaderSource(mt,pt),O.compileShader(mt),O.attachShader(this.program,mt);const xt=O.createShader(O.VERTEX_SHADER);if(O.isContextLost())this.failedToCreate=!0;else{O.shaderSource(xt,gt),O.compileShader(xt),O.attachShader(this.program,xt),this.attributes={},this.numAttributes=X.length;for(let et=0;et<this.numAttributes;et++)X[et]&&(O.bindAttribLocation(this.program,et,X[et]),this.attributes[X[et]]=et);O.linkProgram(this.program),O.deleteShader(xt),O.deleteShader(mt),this.fixedUniforms=M(r),this.binderUniforms=S?S.getUniforms(r):[],D.includes("TERRAIN")&&(this.terrainUniforms=(et=>({u_dem:new o.Uniform1i(et),u_dem_prev:new o.Uniform1i(et),u_dem_unpack:new o.Uniform4f(et),u_dem_tl:new o.Uniform2f(et),u_dem_scale:new o.Uniform1f(et),u_dem_tl_prev:new o.Uniform2f(et),u_dem_scale_prev:new o.Uniform1f(et),u_dem_size:new o.Uniform1f(et),u_dem_lerp:new o.Uniform1f(et),u_exaggeration:new o.Uniform1f(et),u_depth:new o.Uniform1i(et),u_depth_size_inv:new o.Uniform2f(et),u_meter_to_dem:new o.Uniform1f(et),u_label_plane_matrix_inv:new o.UniformMatrix4f(et)}))(r)),D.includes("GLOBE")&&(this.globeUniforms=(et=>({u_tile_tl_up:new o.Uniform3f(et),u_tile_tr_up:new o.Uniform3f(et),u_tile_br_up:new o.Uniform3f(et),u_tile_bl_up:new o.Uniform3f(et),u_tile_up_scale:new o.Uniform1f(et)}))(r)),D.includes("FOG")&&(this.fogUniforms=(et=>({u_fog_matrix:new o.UniformMatrix4f(et),u_fog_range:new o.Uniform2f(et),u_fog_color:new o.Uniform4f(et),u_fog_horizon_blend:new o.Uniform1f(et),u_fog_temporal_offset:new o.Uniform1f(et),u_frustum_tl:new o.Uniform3f(et),u_frustum_tr:new o.Uniform3f(et),u_frustum_br:new o.Uniform3f(et),u_frustum_bl:new o.Uniform3f(et),u_globe_pos:new o.Uniform3f(et),u_globe_radius:new o.Uniform1f(et),u_globe_transition:new o.Uniform1f(et),u_is_globe:new o.Uniform1i(et),u_viewport:new o.Uniform2f(et)}))(r))}}setTerrainUniformValues(r,u){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const S in u)y[S]&&y[S].set(this.program,S,u[S])}}setGlobeUniformValues(r,u){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const S in u)y[S]&&y[S].set(this.program,S,u[S])}}setFogUniformValues(r,u){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const S in u)y[S].set(this.program,S,u[S])}}draw(r,u,y,S,M,D,O,j,H,X,tt,ht,pt,gt,mt){const xt=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(y),r.setStencilMode(S),r.setColorMode(M),r.setCullFace(D);for(const ft of Object.keys(this.fixedUniforms))this.fixedUniforms[ft].set(this.program,ft,O[ft]);gt&&gt.setUniforms(this.program,r,this.binderUniforms,ht,{zoom:pt});const et={[xt.LINES]:2,[xt.TRIANGLES]:3,[xt.LINE_STRIP]:1}[u];for(const ft of tt.get()){const St=ft.vaos||(ft.vaos={});(St[j]||(St[j]=new cm)).bind(r,this,H,gt?gt.getPaintVertexBuffers():[],X,ft.vertexOffset,mt||[]),xt.drawElements(u,ft.primitiveLength*et,xt.UNSIGNED_SHORT,ft.primitiveOffset*et*2)}}}function Po(m,r){const u=Math.pow(2,r.tileID.overscaledZ),y=r.tileSize*Math.pow(2,m.transform.tileZoom)/u,S=y*(r.tileID.canonical.x+r.tileID.wrap*u),M=y*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_tile_units_to_pixels:1/Yi(r,1,m.transform.tileZoom),u_pixel_coord_upper:[S>>16,M>>16],u_pixel_coord_lower:[65535&S,65535&M]}}const Yu=o.create(),kh=(m,r,u,y,S,M,D,O,j,H,X)=>{const tt=r.style.light,ht=tt.properties.get("position"),pt=[ht.x,ht.y,ht.z],gt=o.create$1();tt.properties.get("anchor")==="viewport"&&(o.fromRotation(gt,-r.transform.angle),o.transformMat3(pt,pt,gt));const mt=tt.properties.get("color"),xt=r.transform,et={u_matrix:m,u_lightpos:pt,u_lightintensity:tt.properties.get("intensity"),u_lightcolor:[mt.r,mt.g,mt.b],u_vertical_gradient:+u,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Yu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:S,u_edge_radius:M};return xt.projection.name==="globe"&&(et.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],et.u_zoom_transition=j,et.u_inv_rot_matrix=X,et.u_merc_center=H,et.u_up_dir=xt.projection.upVector(new o.CanonicalTileID(0,0,0),H[0]*o.EXTENT,H[1]*o.EXTENT),et.u_height_lift=O),et},If=(m,r,u,y,S,M,D,O,j,H,X,tt)=>{const ht=kh(m,r,u,y,S,M,D,j,H,X,tt),pt={u_height_factor:-Math.pow(2,D.overscaledZ)/O.tileSize/8};return o.extend(ht,Po(r,O),pt)},Ka=m=>({u_matrix:m}),Ku=(m,r,u)=>o.extend(Ka(m),Po(r,u)),Ju=(m,r)=>({u_matrix:m,u_world:r}),Qu=(m,r,u,y)=>o.extend(Ku(m,r,u),{u_world:y}),Ph=o.create(),zl=(m,r,u,y,S,M)=>{const D=m.transform,O=D.projection.name==="globe";let j;if(M.paint.get("circle-pitch-alignment")==="map")if(O){const X=o.globePixelsToTileUnits(D.zoom,r.canonical)*D._pixelsPerMercatorPixel;j=Float32Array.from([X,0,0,X])}else j=D.calculatePixelsToTileUnitsMatrix(u);else j=new Float32Array([D.pixelsToGLUnits[0],0,0,D.pixelsToGLUnits[1]]);const H={u_camera_to_center_distance:D.cameraToCenterDistance,u_matrix:m.translatePosMatrix(r.projMatrix,u,M.paint.get("circle-translate"),M.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:j,u_inv_rot_matrix:Ph,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){H.u_inv_rot_matrix=y,H.u_merc_center=S,H.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],H.u_zoom_transition=o.globeToMercatorTransition(D.zoom);const X=S[0]*o.EXTENT,tt=S[1]*o.EXTENT;H.u_up_dir=D.projection.upVector(new o.CanonicalTileID(0,0,0),X,tt)}return H},td=m=>{const r=[];return m.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),m.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r},Ih=(m,r,u,y)=>{const S=o.EXTENT/u.tileSize;return{u_matrix:m,u_camera_to_center_distance:r.getCameraToCenterDistance(y),u_extrude_scale:[r.pixelsToGLUnits[0]/S,r.pixelsToGLUnits[1]/S]}},Ja=(m,r,u=1)=>({u_matrix:m,u_color:r,u_overlay:0,u_overlay_scale:u}),ba=o.create(),Lf=(m,r,u,y,S,M,D)=>{const O=m.transform,j=O.projection.name==="globe",H=j?o.globePixelsToTileUnits(O.zoom,r.canonical)*O._pixelsPerMercatorPixel:Yi(u,1,M),X={u_matrix:r.projMatrix,u_extrude_scale:H,u_intensity:D,u_inv_rot_matrix:ba,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(j){X.u_inv_rot_matrix=y,X.u_merc_center=S,X.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],X.u_zoom_transition=o.globeToMercatorTransition(O.zoom);const tt=S[0]*o.EXTENT,ht=S[1]*o.EXTENT;X.u_up_dir=O.projection.upVector(new o.CanonicalTileID(0,0,0),tt,ht)}return X},Qa=(m,r,u,y,S,M,D)=>{const O=m.transform,j=O.calculatePixelsToTileUnitsMatrix(r);return{u_matrix:tl(m,r,u,y),u_pixels_to_tile_units:j,u_device_pixel_ratio:M,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:S,u_texsize:Ac(u)?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:oo(r,m.transform),u_alpha_discard_threshold:0,u_trim_offset:D}},Mc=(m,r,u,y,S)=>{const M=m.transform;return{u_matrix:tl(m,r,u,y),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:S,u_image:0,u_tile_units_to_pixels:oo(r,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function oo(m,r){return 1/Yi(m,1,r.tileZoom)}function tl(m,r,u,y){return m.translatePosMatrix(y||r.tileID.projMatrix,r,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}function Ac(m){const r=m.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}const Cc=(m,r,u,y,S,M)=>{return{u_matrix:m,u_tl_parent:r,u_scale_parent:u,u_fade_t:y.mix,u_opacity:y.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(O=S.paint.get("raster-saturation"),O>0?1-1/(1.001-O):-O),u_contrast_factor:(D=S.paint.get("raster-contrast"),D>0?1/(1-D):1+D),u_spin_weights:Fr(S.paint.get("raster-hue-rotate")),u_perspective_transform:M};var D,O};function Fr(m){m*=Math.PI/180;const r=Math.sin(m),u=Math.cos(m);return[(2*u+1)/3,(-Math.sqrt(3)*r-u+1)/3,(Math.sqrt(3)*r-u+1)/3]}const Lh=o.create(),ed=(m,r,u,y,S,M,D,O,j,H,X,tt,ht,pt,gt,mt)=>{const xt=S.transform,et={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:xt.cameraToCenterDistance,u_rotate_symbol:+u,u_aspect_ratio:xt.width/xt.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:D,u_coord_matrix:O,u_is_text:+j,u_pitch_with_map:+y,u_texsize:H,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Lh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Lh,u_up_vector:[0,-1,0]};return mt.name==="globe"&&(et.u_tile_id=[X.canonical.x,X.canonical.y,1<<X.canonical.z],et.u_zoom_transition=tt,et.u_inv_rot_matrix=pt,et.u_merc_center=ht,et.u_camera_forward=xt._camera.forward(),et.u_ecef_origin=o.globeECEFOrigin(xt.globeMatrix,X.toUnwrapped()),et.u_tile_matrix=Float32Array.from(xt.globeMatrix),et.u_up_vector=gt),et},Dh=(m,r,u,y,S,M,D,O,j,H,X,tt,ht,pt,gt,mt,xt)=>o.extend(ed(m,r,u,y,S,M,D,O,j,H,tt,ht,pt,gt,mt,xt),{u_gamma_scale:y?S.transform.cameraToCenterDistance*Math.cos(S.terrain?0:S.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:1}),kc=(m,r,u,y,S,M,D,O,j,H,X,tt,ht,pt,gt,mt)=>o.extend(Dh(m,r,u,y,S,M,D,O,!0,j,!0,X,tt,ht,pt,gt,mt),{u_texsize_icon:H,u_texture_icon:1}),id=(m,r,u)=>({u_matrix:m,u_opacity:r,u_color:u}),hm=(m,r,u,y,S)=>o.extend(function(M,D,O){const j=D.imageManager.getPattern(M.toString()),{width:H,height:X}=D.imageManager.getPixelSize(),tt=Math.pow(2,O.tileID.overscaledZ),ht=O.tileSize*Math.pow(2,D.transform.tileZoom)/tt,pt=ht*(O.tileID.canonical.x+O.tileID.wrap*tt),gt=ht*O.tileID.canonical.y;return{u_image:0,u_pattern_tl:j.tl,u_pattern_br:j.br,u_texsize:[H,X],u_pattern_size:j.displaySize,u_tile_units_to_pixels:1/Yi(O,1,D.transform.tileZoom),u_pixel_coord_upper:[pt>>16,gt>>16],u_pixel_coord_lower:[65535&pt,65535&gt]}}(y,u,S),{u_matrix:m,u_opacity:r}),sd={fillExtrusion:m=>({u_matrix:new o.UniformMatrix4f(m),u_lightpos:new o.Uniform3f(m),u_lightintensity:new o.Uniform1f(m),u_lightcolor:new o.Uniform3f(m),u_vertical_gradient:new o.Uniform1f(m),u_opacity:new o.Uniform1f(m),u_edge_radius:new o.Uniform1f(m),u_ao:new o.Uniform2f(m),u_tile_id:new o.Uniform3f(m),u_zoom_transition:new o.Uniform1f(m),u_inv_rot_matrix:new o.UniformMatrix4f(m),u_merc_center:new o.Uniform2f(m),u_up_dir:new o.Uniform3f(m),u_height_lift:new o.Uniform1f(m)}),fillExtrusionPattern:m=>({u_matrix:new o.UniformMatrix4f(m),u_lightpos:new o.Uniform3f(m),u_lightintensity:new o.Uniform1f(m),u_lightcolor:new o.Uniform3f(m),u_vertical_gradient:new o.Uniform1f(m),u_height_factor:new o.Uniform1f(m),u_edge_radius:new o.Uniform1f(m),u_ao:new o.Uniform2f(m),u_tile_id:new o.Uniform3f(m),u_zoom_transition:new o.Uniform1f(m),u_inv_rot_matrix:new o.UniformMatrix4f(m),u_merc_center:new o.Uniform2f(m),u_up_dir:new o.Uniform3f(m),u_height_lift:new o.Uniform1f(m),u_image:new o.Uniform1i(m),u_texsize:new o.Uniform2f(m),u_pixel_coord_upper:new o.Uniform2f(m),u_pixel_coord_lower:new o.Uniform2f(m),u_tile_units_to_pixels:new o.Uniform1f(m),u_opacity:new o.Uniform1f(m)}),fill:m=>({u_matrix:new o.UniformMatrix4f(m)}),fillPattern:m=>({u_matrix:new o.UniformMatrix4f(m),u_image:new o.Uniform1i(m),u_texsize:new o.Uniform2f(m),u_pixel_coord_upper:new o.Uniform2f(m),u_pixel_coord_lower:new o.Uniform2f(m),u_tile_units_to_pixels:new o.Uniform1f(m)}),fillOutline:m=>({u_matrix:new o.UniformMatrix4f(m),u_world:new o.Uniform2f(m)}),fillOutlinePattern:m=>({u_matrix:new o.UniformMatrix4f(m),u_world:new o.Uniform2f(m),u_image:new o.Uniform1i(m),u_texsize:new o.Uniform2f(m),u_pixel_coord_upper:new o.Uniform2f(m),u_pixel_coord_lower:new o.Uniform2f(m),u_tile_units_to_pixels:new o.Uniform1f(m)}),circle:m=>({u_camera_to_center_distance:new o.Uniform1f(m),u_extrude_scale:new o.UniformMatrix2f(m),u_device_pixel_ratio:new o.Uniform1f(m),u_matrix:new o.UniformMatrix4f(m),u_inv_rot_matrix:new o.UniformMatrix4f(m),u_merc_center:new o.Uniform2f(m),u_tile_id:new o.Uniform3f(m),u_zoom_transition:new o.Uniform1f(m),u_up_dir:new o.Uniform3f(m)}),collisionBox:m=>({u_matrix:new o.UniformMatrix4f(m),u_camera_to_center_distance:new o.Uniform1f(m),u_extrude_scale:new o.Uniform2f(m)}),collisionCircle:m=>({u_matrix:new o.UniformMatrix4f(m),u_inv_matrix:new o.UniformMatrix4f(m),u_camera_to_center_distance:new o.Uniform1f(m),u_viewport_size:new o.Uniform2f(m)}),debug:m=>({u_color:new o.UniformColor(m),u_matrix:new o.UniformMatrix4f(m),u_overlay:new o.Uniform1i(m),u_overlay_scale:new o.Uniform1f(m)}),clippingMask:m=>({u_matrix:new o.UniformMatrix4f(m)}),heatmap:m=>({u_extrude_scale:new o.Uniform1f(m),u_intensity:new o.Uniform1f(m),u_matrix:new o.UniformMatrix4f(m),u_inv_rot_matrix:new o.UniformMatrix4f(m),u_merc_center:new o.Uniform2f(m),u_tile_id:new o.Uniform3f(m),u_zoom_transition:new o.Uniform1f(m),u_up_dir:new o.Uniform3f(m)}),heatmapTexture:m=>({u_image:new o.Uniform1i(m),u_color_ramp:new o.Uniform1i(m),u_opacity:new o.Uniform1f(m)}),hillshade:m=>({u_matrix:new o.UniformMatrix4f(m),u_image:new o.Uniform1i(m),u_latrange:new o.Uniform2f(m),u_light:new o.Uniform2f(m),u_shadow:new o.UniformColor(m),u_highlight:new o.UniformColor(m),u_accent:new o.UniformColor(m)}),hillshadePrepare:m=>({u_matrix:new o.UniformMatrix4f(m),u_image:new o.Uniform1i(m),u_dimension:new o.Uniform2f(m),u_zoom:new o.Uniform1f(m),u_unpack:new o.Uniform4f(m)}),line:m=>({u_matrix:new o.UniformMatrix4f(m),u_pixels_to_tile_units:new o.UniformMatrix2f(m),u_device_pixel_ratio:new o.Uniform1f(m),u_units_to_pixels:new o.Uniform2f(m),u_dash_image:new o.Uniform1i(m),u_gradient_image:new o.Uniform1i(m),u_image_height:new o.Uniform1f(m),u_texsize:new o.Uniform2f(m),u_tile_units_to_pixels:new o.Uniform1f(m),u_alpha_discard_threshold:new o.Uniform1f(m),u_trim_offset:new o.Uniform2f(m)}),linePattern:m=>({u_matrix:new o.UniformMatrix4f(m),u_texsize:new o.Uniform2f(m),u_pixels_to_tile_units:new o.UniformMatrix2f(m),u_device_pixel_ratio:new o.Uniform1f(m),u_image:new o.Uniform1i(m),u_units_to_pixels:new o.Uniform2f(m),u_tile_units_to_pixels:new o.Uniform1f(m),u_alpha_discard_threshold:new o.Uniform1f(m)}),raster:m=>({u_matrix:new o.UniformMatrix4f(m),u_tl_parent:new o.Uniform2f(m),u_scale_parent:new o.Uniform1f(m),u_fade_t:new o.Uniform1f(m),u_opacity:new o.Uniform1f(m),u_image0:new o.Uniform1i(m),u_image1:new o.Uniform1i(m),u_brightness_low:new o.Uniform1f(m),u_brightness_high:new o.Uniform1f(m),u_saturation_factor:new o.Uniform1f(m),u_contrast_factor:new o.Uniform1f(m),u_spin_weights:new o.Uniform3f(m),u_perspective_transform:new o.Uniform2f(m)}),symbolIcon:m=>({u_is_size_zoom_constant:new o.Uniform1i(m),u_is_size_feature_constant:new o.Uniform1i(m),u_size_t:new o.Uniform1f(m),u_size:new o.Uniform1f(m),u_camera_to_center_distance:new o.Uniform1f(m),u_rotate_symbol:new o.Uniform1i(m),u_aspect_ratio:new o.Uniform1f(m),u_fade_change:new o.Uniform1f(m),u_matrix:new o.UniformMatrix4f(m),u_label_plane_matrix:new o.UniformMatrix4f(m),u_coord_matrix:new o.UniformMatrix4f(m),u_is_text:new o.Uniform1i(m),u_pitch_with_map:new o.Uniform1i(m),u_texsize:new o.Uniform2f(m),u_tile_id:new o.Uniform3f(m),u_zoom_transition:new o.Uniform1f(m),u_inv_rot_matrix:new o.UniformMatrix4f(m),u_merc_center:new o.Uniform2f(m),u_camera_forward:new o.Uniform3f(m),u_tile_matrix:new o.UniformMatrix4f(m),u_up_vector:new o.Uniform3f(m),u_ecef_origin:new o.Uniform3f(m),u_texture:new o.Uniform1i(m)}),symbolSDF:m=>({u_is_size_zoom_constant:new o.Uniform1i(m),u_is_size_feature_constant:new o.Uniform1i(m),u_size_t:new o.Uniform1f(m),u_size:new o.Uniform1f(m),u_camera_to_center_distance:new o.Uniform1f(m),u_rotate_symbol:new o.Uniform1i(m),u_aspect_ratio:new o.Uniform1f(m),u_fade_change:new o.Uniform1f(m),u_matrix:new o.UniformMatrix4f(m),u_label_plane_matrix:new o.UniformMatrix4f(m),u_coord_matrix:new o.UniformMatrix4f(m),u_is_text:new o.Uniform1i(m),u_pitch_with_map:new o.Uniform1i(m),u_texsize:new o.Uniform2f(m),u_texture:new o.Uniform1i(m),u_gamma_scale:new o.Uniform1f(m),u_device_pixel_ratio:new o.Uniform1f(m),u_tile_id:new o.Uniform3f(m),u_zoom_transition:new o.Uniform1f(m),u_inv_rot_matrix:new o.UniformMatrix4f(m),u_merc_center:new o.Uniform2f(m),u_camera_forward:new o.Uniform3f(m),u_tile_matrix:new o.UniformMatrix4f(m),u_up_vector:new o.Uniform3f(m),u_ecef_origin:new o.Uniform3f(m),u_is_halo:new o.Uniform1i(m)}),symbolTextAndIcon:m=>({u_is_size_zoom_constant:new o.Uniform1i(m),u_is_size_feature_constant:new o.Uniform1i(m),u_size_t:new o.Uniform1f(m),u_size:new o.Uniform1f(m),u_camera_to_center_distance:new o.Uniform1f(m),u_rotate_symbol:new o.Uniform1i(m),u_aspect_ratio:new o.Uniform1f(m),u_fade_change:new o.Uniform1f(m),u_matrix:new o.UniformMatrix4f(m),u_label_plane_matrix:new o.UniformMatrix4f(m),u_coord_matrix:new o.UniformMatrix4f(m),u_is_text:new o.Uniform1i(m),u_pitch_with_map:new o.Uniform1i(m),u_texsize:new o.Uniform2f(m),u_texsize_icon:new o.Uniform2f(m),u_texture:new o.Uniform1i(m),u_texture_icon:new o.Uniform1i(m),u_gamma_scale:new o.Uniform1f(m),u_device_pixel_ratio:new o.Uniform1f(m),u_is_halo:new o.Uniform1i(m)}),background:m=>({u_matrix:new o.UniformMatrix4f(m),u_opacity:new o.Uniform1f(m),u_color:new o.UniformColor(m)}),backgroundPattern:m=>({u_matrix:new o.UniformMatrix4f(m),u_opacity:new o.Uniform1f(m),u_image:new o.Uniform1i(m),u_pattern_tl:new o.Uniform2f(m),u_pattern_br:new o.Uniform2f(m),u_texsize:new o.Uniform2f(m),u_pattern_size:new o.Uniform2f(m),u_pixel_coord_upper:new o.Uniform2f(m),u_pixel_coord_lower:new o.Uniform2f(m),u_tile_units_to_pixels:new o.Uniform1f(m)}),terrainRaster:Sh,terrainDepth:Sh,skybox:m=>({u_matrix:new o.UniformMatrix4f(m),u_sun_direction:new o.Uniform3f(m),u_cubemap:new o.Uniform1i(m),u_opacity:new o.Uniform1f(m),u_temporal_offset:new o.Uniform1f(m)}),skyboxGradient:m=>({u_matrix:new o.UniformMatrix4f(m),u_color_ramp:new o.Uniform1i(m),u_center_direction:new o.Uniform3f(m),u_radius:new o.Uniform1f(m),u_opacity:new o.Uniform1f(m),u_temporal_offset:new o.Uniform1f(m)}),skyboxCapture:m=>({u_matrix_3f:new o.UniformMatrix3f(m),u_sun_direction:new o.Uniform3f(m),u_sun_intensity:new o.Uniform1f(m),u_color_tint_r:new o.Uniform4f(m),u_color_tint_m:new o.Uniform4f(m),u_luminance:new o.Uniform1f(m)}),globeRaster:m=>({u_proj_matrix:new o.UniformMatrix4f(m),u_globe_matrix:new o.UniformMatrix4f(m),u_normalize_matrix:new o.UniformMatrix4f(m),u_merc_matrix:new o.UniformMatrix4f(m),u_zoom_transition:new o.Uniform1f(m),u_merc_center:new o.Uniform2f(m),u_image0:new o.Uniform1i(m),u_grid_matrix:new o.UniformMatrix3f(m),u_skirt_height:new o.Uniform1f(m),u_frustum_tl:new o.Uniform3f(m),u_frustum_tr:new o.Uniform3f(m),u_frustum_br:new o.Uniform3f(m),u_frustum_bl:new o.Uniform3f(m),u_globe_pos:new o.Uniform3f(m),u_globe_radius:new o.Uniform1f(m),u_viewport:new o.Uniform2f(m)}),globeAtmosphere:m=>({u_frustum_tl:new o.Uniform3f(m),u_frustum_tr:new o.Uniform3f(m),u_frustum_br:new o.Uniform3f(m),u_frustum_bl:new o.Uniform3f(m),u_horizon:new o.Uniform1f(m),u_transition:new o.Uniform1f(m),u_fadeout_range:new o.Uniform1f(m),u_color:new o.Uniform4f(m),u_high_color:new o.Uniform4f(m),u_space_color:new o.Uniform4f(m),u_star_intensity:new o.Uniform1f(m),u_star_density:new o.Uniform1f(m),u_star_size:new o.Uniform1f(m),u_temporal_offset:new o.Uniform1f(m),u_horizon_angle:new o.Uniform1f(m),u_rotation_matrix:new o.UniformMatrix4f(m)})};let ao;function Pc(m,r,u,y,S,M,D){const O=m.context,j=O.gl,H=m.transform,X=m.useProgram("collisionBox"),tt=[];let ht=0,pt=0;for(let Et=0;Et<y.length;Et++){const $t=y[Et],Rt=r.getTile($t),Gt=Rt.getBucket(u);if(!Gt)continue;const Jt=Rr($t,Gt,H);let Yt=Jt;S[0]===0&&S[1]===0||(Yt=m.translatePosMatrix(Jt,Rt,S,M));const ae=D?Gt.textCollisionBox:Gt.iconCollisionBox,ke=Gt.collisionCircleArray;if(ke.length>0){const se=o.create(),xe=Yt;o.mul(se,Gt.placementInvProjMatrix,H.glCoordMatrix),o.mul(se,se,Gt.placementViewportMatrix),tt.push({circleArray:ke,circleOffset:pt,transform:xe,invTransform:se,projection:Gt.getProjection()}),ht+=ke.length/4,pt=ht}ae&&(m.terrain&&m.terrain.setupElevationDraw(Rt,X),X.draw(O,j.LINES,o.DepthMode.disabled,o.StencilMode.disabled,m.colorModeForRenderPass(),o.CullFaceMode.disabled,Ih(Yt,H,Rt,Gt.getProjection()),u.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,null,H.zoom,null,[ae.collisionVertexBuffer,ae.collisionVertexBufferExt]))}if(!D||!tt.length)return;const gt=m.useProgram("collisionCircle"),mt=new o.StructArrayLayout2f1f2i16;mt.resize(4*ht),mt._trim();let xt=0;for(const Et of tt)for(let $t=0;$t<Et.circleArray.length/4;$t++){const Rt=4*$t,Gt=Et.circleArray[Rt+0],Jt=Et.circleArray[Rt+1],Yt=Et.circleArray[Rt+2],ae=Et.circleArray[Rt+3];mt.emplace(xt++,Gt,Jt,Yt,ae,0),mt.emplace(xt++,Gt,Jt,Yt,ae,1),mt.emplace(xt++,Gt,Jt,Yt,ae,2),mt.emplace(xt++,Gt,Jt,Yt,ae,3)}(!ao||ao.length<2*ht)&&(ao=function(Et){const $t=2*Et,Rt=new o.StructArrayLayout3ui6;Rt.resize($t),Rt._trim();for(let Gt=0;Gt<$t;Gt++){const Jt=6*Gt;Rt.uint16[Jt+0]=4*Gt+0,Rt.uint16[Jt+1]=4*Gt+1,Rt.uint16[Jt+2]=4*Gt+2,Rt.uint16[Jt+3]=4*Gt+2,Rt.uint16[Jt+4]=4*Gt+3,Rt.uint16[Jt+5]=4*Gt+0}return Rt}(ht));const et=O.createIndexBuffer(ao,!0),ft=O.createVertexBuffer(mt,o.collisionCircleLayout.members,!0);for(const Et of tt){const $t={u_matrix:Et.transform,u_inv_matrix:Et.invTransform,u_camera_to_center_distance:(St=H).getCameraToCenterDistance(Et.projection),u_viewport_size:[St.width,St.height]};gt.draw(O,j.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,m.colorModeForRenderPass(),o.CullFaceMode.disabled,$t,u.id,ft,et,o.SegmentVector.simpleSegment(0,2*Et.circleOffset,Et.circleArray.length,Et.circleArray.length/2),null,H.zoom)}var St;ft.destroy(),et.destroy()}const nd=o.create();function rd({width:m,height:r,anchor:u,textOffset:y,textScale:S},M){const{horizontalAlign:D,verticalAlign:O}=o.getAnchorAlignment(u),j=-(D-.5)*m,H=-(O-.5)*r,X=o.evaluateVariableOffset(u,y);return new o.Point((j/S+X[0])*M,(H/S+X[1])*M)}function um(m,r,u,y,S,M,D,O,j,H,X){const tt=m.text.placedSymbolArray,ht=m.text.dynamicLayoutVertexArray,pt=m.icon.dynamicLayoutVertexArray,gt={},mt=m.getProjection(),xt=Ys(O,mt,M),et=M.elevation,ft=mt.upVectorScale(O.canonical,M.center.lat,M.worldSize).metersToTile;ht.clear();for(let St=0;St<tt.length;St++){const Et=tt.get(St),{tileAnchorX:$t,tileAnchorY:Rt,numGlyphs:Gt}=Et,Jt=Et.hidden||!Et.crossTileID||m.allowVerticalPlacement&&!Et.placedOrientation?null:y[Et.crossTileID];if(Jt){let Yt=0,ae=0,ke=0;if(et){const Oe=et?et.getAtTileOffset(O,$t,Rt):0,[yi,ki,ai]=mt.upVector(O.canonical,$t,Rt);Yt=Oe*yi*ft,ae=Oe*ki*ft,ke=Oe*ai*ft}let[se,xe,ue,Ie]=Gn(Et.projectedAnchorX+Yt,Et.projectedAnchorY+ae,Et.projectedAnchorZ+ke,u?xt:D);const ee=Af(M.getCameraToCenterDistance(mt),Ie);let ve=S.evaluateSizeForFeature(m.textSizeData,H,Et)*ee/o.ONE_EM;u&&(ve*=m.tilePixelRatio/j);const De=rd(Jt,ve);u?({x:se,y:xe,z:ue}=mt.projectTilePoint($t+De.x,Rt+De.y,O.canonical),[se,xe,ue]=Gn(se+Yt,xe+ae,ue+ke,D)):(r&&De._rotate(-M.angle),se+=De.x,xe+=De.y,ue=0);const ge=m.allowVerticalPlacement&&Et.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Oe=0;Oe<Gt;Oe++)o.addDynamicAttributes(ht,se,xe,ue,ge);X&&Et.associatedIconIndex>=0&&(gt[Et.associatedIconIndex]={x:se,y:xe,z:ue,angle:ge})}else Or(Gt,ht)}if(X){pt.clear();const St=m.icon.placedSymbolArray;for(let Et=0;Et<St.length;Et++){const $t=St.get(Et),{numGlyphs:Rt}=$t,Gt=gt[Et];if($t.hidden||!Gt)Or(Rt,pt);else{const{x:Jt,y:Yt,z:ae,angle:ke}=Gt;for(let se=0;se<Rt;se++)o.addDynamicAttributes(pt,Jt,Yt,ae,ke)}}m.icon.dynamicLayoutVertexBuffer.updateData(pt)}m.text.dynamicLayoutVertexBuffer.updateData(ht)}function Ol(m,r,u){return u.iconsInText&&r?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Df(m,r,u,y,S,M,D,O,j,H,X,tt){const ht=m.context,pt=ht.gl,gt=m.transform,mt=O==="map",xt=j==="map",et=mt&&u.layout.get("symbol-placement")!=="point",ft=mt&&!xt&&!et,St=u.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Et=!1;const $t=m.depthModeForSublayer(0,o.DepthMode.ReadOnly),Rt=[o.mercatorXfromLng(gt.center.lng),o.mercatorYfromLat(gt.center.lat)],Gt=u.layout.get("text-variable-anchor"),Jt=gt.projection.name==="globe",Yt=[],ae=[0,-1,0];let ke=ae;!Jt&&!gt.mercatorFromTransition||mt||(ke=function(se){const xe=se._camera.getWorldToCamera(se.worldSize,1),ue=o.multiply([],xe,se.globeMatrix);o.invert(ue,ue);const Ie=[0,0,0],ee=[0,1,0,0];return o.transformMat4$1(ee,ee,ue),Ie[0]=ee[0],Ie[1]=ee[1],Ie[2]=ee[2],o.normalize(Ie,Ie),Ie}(gt));for(const se of y){const xe=r.getTile(se),ue=xe.getBucket(u);if(!ue||ue.projection.name==="mercator"&&Jt)continue;const Ie=S?ue.text:ue.icon;if(!Ie||ue.fullyClipped||!Ie.segments.get().length)continue;const ee=Ie.programConfigurations.get(u.id),ve=S||ue.sdfIcons,De=S?ue.textSizeData:ue.iconSizeData,ge=xt||gt.pitch!==0,Oe=o.evaluateSizeForZoom(De,gt.zoom);let yi,ki,ai,vi,Oi=[0,0],Ri=null;if(S)ki=xe.glyphAtlasTexture,ai=pt.LINEAR,yi=xe.glyphAtlasTexture.size,ue.iconsInText&&(Oi=xe.imageAtlasTexture.size,Ri=xe.imageAtlasTexture,vi=ge||m.options.rotating||m.options.zooming||De.kind==="composite"||De.kind==="camera"?pt.LINEAR:pt.NEAREST);else{const Do=u.layout.get("icon-size").constantOr(0)!==1||ue.iconsNeedLinear;ki=xe.imageAtlasTexture,ai=ve||m.options.rotating||m.options.zooming||Do||ge?pt.LINEAR:pt.NEAREST,yi=xe.imageAtlasTexture.size}const mi=ue.projection.name==="globe",xs=mi?ke:ae,ws=mi?o.globeToMercatorTransition(gt.zoom):0,Ts=Ys(se,ue.getProjection(),gt),Ss=gt.calculatePixelsToTileUnitsMatrix(xe),or=pe(Ts,xe.tileID.canonical,xt,mt,gt,ue.getProjection(),Ss),qn=m.terrain&&xt&&et?o.invert(o.create(),or):nd,Vr=En(Ts,xe.tileID.canonical,xt,mt,gt,ue.getProjection(),Ss),bs=Gt&&ue.hasTextData(),Us=u.layout.get("icon-text-fit")!=="none"&&bs&&ue.hasIconData();if(et){const Do=gt.elevation,oa=Do?Do.getAtTileOffsetFunc(se,gt.center.lat,gt.worldSize,ue.getProjection()):null,ll=Eo(Ts,xe.tileID.canonical,xt,mt,gt,ue.getProjection(),Ss);_h(ue,Ts,m,S,ll,Vr,xt,H,oa,se)}const Ps=et||S&&Gt||Us,os=m.translatePosMatrix(Ts,xe,M,D),Mn=Ps?nd:or,mr=m.translatePosMatrix(Vr,xe,M,D,!0),Vs=ue.getProjection().createInversionMatrix(gt,se.canonical),On=[];m.terrainRenderModeElevated()&&xt&&On.push("PITCH_WITH_MAP_TERRAIN"),mi&&On.push("PROJECTION_GLOBE_VIEW"),Ps&&On.push("PROJECTED_POS_ON_VIEWPORT");const Wh=ve&&u.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ra;ra=ve?ue.iconsInText?kc(De.kind,Oe,ft,xt,m,os,Mn,mr,yi,Oi,se,ws,Rt,Vs,xs,ue.getProjection()):Dh(De.kind,Oe,ft,xt,m,os,Mn,mr,S,yi,!0,se,ws,Rt,Vs,xs,ue.getProjection()):ed(De.kind,Oe,ft,xt,m,os,Mn,mr,S,yi,se,ws,Rt,Vs,xs,ue.getProjection());const ql={program:m.useProgram(Ol(ve,S,ue),ee,On),buffers:Ie,uniformValues:ra,atlasTexture:ki,atlasTextureIcon:Ri,atlasInterpolation:ai,atlasInterpolationIcon:vi,isSDF:ve,hasHalo:Wh,tile:xe,labelPlaneMatrixInv:qn};if(St&&ue.canOverlap){Et=!0;const Do=Ie.segments.get();for(const oa of Do)Yt.push({segments:new o.SegmentVector([oa]),sortKey:oa.sortKey,state:ql})}else Yt.push({segments:Ie.segments,sortKey:0,state:ql})}Et&&Yt.sort((se,xe)=>se.sortKey-xe.sortKey);for(const se of Yt){const xe=se.state;if(m.terrain&&m.terrain.setupElevationDraw(xe.tile,xe.program,{useDepthForOcclusion:!Jt,labelPlaneMatrixInv:xe.labelPlaneMatrixInv}),ht.activeTexture.set(pt.TEXTURE0),xe.atlasTexture.bind(xe.atlasInterpolation,pt.CLAMP_TO_EDGE),xe.atlasTextureIcon&&(ht.activeTexture.set(pt.TEXTURE1),xe.atlasTextureIcon&&xe.atlasTextureIcon.bind(xe.atlasInterpolationIcon,pt.CLAMP_TO_EDGE)),xe.isSDF){const ue=xe.uniformValues;xe.hasHalo&&(ue.u_is_halo=1,Ic(xe.buffers,se.segments,u,m,xe.program,$t,X,tt,ue)),ue.u_is_halo=0}Ic(xe.buffers,se.segments,u,m,xe.program,$t,X,tt,xe.uniformValues)}}function Ic(m,r,u,y,S,M,D,O,j){const H=y.context,X=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.globeExtVertexBuffer];S.draw(H,H.gl.TRIANGLES,M,D,O,o.CullFaceMode.disabled,j,u.id,m.layoutVertexBuffer,m.indexBuffer,r,u.paint,y.transform.zoom,m.programConfigurations.get(u.id),X)}function od(m,r,u,y,S,M,D){const O=m.context.gl,j=u.paint.get("fill-pattern"),H=j&&j.constantOr(1);let X,tt,ht,pt,gt;D?(tt=H&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",X=O.LINES):(tt=H?"fillPattern":"fill",X=O.TRIANGLES);for(const mt of y){const xt=r.getTile(mt);if(H&&!xt.patternsLoaded())continue;const et=xt.getBucket(u);if(!et)continue;m.prepareDrawTile();const ft=et.programConfigurations.get(u.id),St=m.useProgram(tt,ft);H&&(m.context.activeTexture.set(O.TEXTURE0),xt.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),ft.updatePaintBuffers());const Et=j.constantOr(null);if(Et&&xt.imageAtlas){const Rt=xt.imageAtlas.patternPositions[Et.toString()];Rt&&ft.setConstantPatternPositions(Rt)}const $t=m.translatePosMatrix(mt.projMatrix,xt,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(D){pt=et.indexBuffer2,gt=et.segments2;const Rt=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[O.drawingBufferWidth,O.drawingBufferHeight];ht=tt==="fillOutlinePattern"&&H?Qu($t,m,xt,Rt):Ju($t,Rt)}else pt=et.indexBuffer,gt=et.segments,ht=H?Ku($t,m,xt):Ka($t);m.prepareDrawProgram(m.context,St,mt.toUnwrapped()),St.draw(m.context,X,S,m.stencilModeForClipping(mt),M,o.CullFaceMode.disabled,ht,u.id,et.layoutVertexBuffer,pt,gt,u.paint,m.transform.zoom,ft)}}function zh(m,r,u,y,S,M,D){const O=m.context,j=O.gl,H=m.transform,X=u.paint.get("fill-extrusion-pattern"),tt=X.constantOr(1),ht=u.paint.get("fill-extrusion-opacity"),pt=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),u.paint.get("fill-extrusion-ambient-occlusion-radius")],gt=u.layout.get("fill-extrusion-edge-radius"),mt=gt>0&&!u.paint.get("fill-extrusion-rounded-roof"),xt=mt?0:gt,et=H.projection.name==="globe"?o.fillExtrusionHeightLift():0,ft=H.projection.name==="globe",St=ft?o.globeToMercatorTransition(H.zoom):0,Et=[o.mercatorXfromLng(H.center.lng),o.mercatorYfromLat(H.center.lat)],$t=[];ft&&$t.push("PROJECTION_GLOBE_VIEW"),pt[0]>0&&$t.push("FAUX_AO"),mt&&$t.push("ZERO_ROOF_RADIUS");for(const Rt of y){const Gt=r.getTile(Rt),Jt=Gt.getBucket(u);if(!Jt||Jt.projection.name!==H.projection.name)continue;const Yt=Jt.programConfigurations.get(u.id),ae=m.useProgram(tt?"fillExtrusionPattern":"fillExtrusion",Yt,$t);if(m.terrain){const ve=m.terrain;if(m.style.terrainSetForDrapingOnly())ve.setupElevationDraw(Gt,ae,{useMeterToDem:!0});else{if(!Jt.enableTerrain)continue;if(ve.setupElevationDraw(Gt,ae,{useMeterToDem:!0}),el(O,r,Rt,Jt,u,ve),!Jt.centroidVertexBuffer){const De=ae.attributes.a_centroid_pos;De!==void 0&&j.vertexAttrib2f(De,0,0)}}}tt&&(m.context.activeTexture.set(j.TEXTURE0),Gt.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Yt.updatePaintBuffers());const ke=X.constantOr(null);if(ke&&Gt.imageAtlas){const ve=Gt.imageAtlas.patternPositions[ke.toString()];ve&&Yt.setConstantPatternPositions(ve)}const se=m.translatePosMatrix(Rt.projMatrix,Gt,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),xe=H.projection.createInversionMatrix(H,Rt.canonical),ue=u.paint.get("fill-extrusion-vertical-gradient"),Ie=tt?If(se,m,ue,ht,pt,xt,Rt,Gt,et,St,Et,xe):kh(se,m,ue,ht,pt,xt,Rt,et,St,Et,xe);m.prepareDrawProgram(O,ae,Rt.toUnwrapped());const ee=[];m.terrain&&ee.push(Jt.centroidVertexBuffer),ft&&ee.push(Jt.layoutVertexExtBuffer),ae.draw(O,O.gl.TRIANGLES,S,M,D,o.CullFaceMode.backCCW,Ie,u.id,Jt.layoutVertexBuffer,Jt.indexBuffer,Jt.segments,u.paint,m.transform.zoom,Yt,ee)}}function el(m,r,u,y,S,M){const D=[et=>{let ft=et.canonical.x-1,St=et.wrap;return ft<0&&(ft=(1<<et.canonical.z)-1,St--),new o.OverscaledTileID(et.overscaledZ,St,et.canonical.z,ft,et.canonical.y)},et=>{let ft=et.canonical.x+1,St=et.wrap;return ft===1<<et.canonical.z&&(ft=0,St++),new o.OverscaledTileID(et.overscaledZ,St,et.canonical.z,ft,et.canonical.y)},et=>new o.OverscaledTileID(et.overscaledZ,et.wrap,et.canonical.z,et.canonical.x,(et.canonical.y===0?1<<et.canonical.z:et.canonical.y)-1),et=>new o.OverscaledTileID(et.overscaledZ,et.wrap,et.canonical.z,et.canonical.x,et.canonical.y===(1<<et.canonical.z)-1?0:et.canonical.y+1)],O=et=>{const ft=r.getSource().minzoom,St=$t=>{const Rt=r.getTileByID($t);if(Rt&&Rt.hasData())return Rt.getBucket(S)},Et=[0,-1,1];for(const $t of Et){if(et.overscaledZ+$t<ft)continue;const Rt=St(et.calculateScaledKey(et.overscaledZ+$t));if(Rt)return Rt}},j=[0,0,0],H=(et,ft)=>(j[0]=Math.min(et.min.y,ft.min.y),j[1]=Math.max(et.max.y,ft.max.y),j[2]=o.EXTENT-ft.min.x>et.max.x?ft.min.x-o.EXTENT:et.max.x,j),X=(et,ft)=>(j[0]=Math.min(et.min.x,ft.min.x),j[1]=Math.max(et.max.x,ft.max.x),j[2]=o.EXTENT-ft.min.y>et.max.y?ft.min.y-o.EXTENT:et.max.y,j),tt=[(et,ft)=>H(et,ft),(et,ft)=>H(ft,et),(et,ft)=>X(et,ft),(et,ft)=>X(ft,et)],ht=new o.Point(0,0);let pt,gt,mt;const xt=(et,ft,St,Et,$t)=>{const Rt=[[Et?St:et,Et?et:St,0],[Et?St:ft,Et?ft:St,0]],Gt=$t<0?o.EXTENT+$t:$t,Jt=[Et?Gt:(et+ft)/2,Et?(et+ft)/2:Gt,0];return St===0&&$t<0||St!==0&&$t>0?M.getForTilePoints(mt,[Jt],!0,gt):Rt.push(Jt),M.getForTilePoints(u,Rt,!0,pt),Math.max(Rt[0][2],Rt[1][2],Jt[2])/M.exaggeration()};for(let et=0;et<4;et++){const ft=(et<2?1:5)-et,St=y.borders[et];if(St.length===0)continue;const Et=mt=D[et](u),$t=O(Et);if(!($t&&$t instanceof o.FillExtrusionBucket&&$t.enableTerrain)||y.borderDoneWithNeighborZ[et]===$t.canonical.z&&$t.borderDoneWithNeighborZ[ft]===y.canonical.z||(gt=M.findDEMTileFor(Et),!gt||!gt.dem))continue;if(!pt){const Yt=M.findDEMTileFor(u);if(!Yt||!Yt.dem)return;pt=Yt}const Rt=$t.borders[ft];let Gt=0;const Jt=$t.borderDoneWithNeighborZ[ft]!==y.canonical.z;if(y.canonical.z===$t.canonical.z){for(let Yt=0;Yt<St.length;Yt++){const ae=y.featuresOnBorder[St[Yt]],ke=ae.borders[et];let se;for(;Gt<Rt.length&&(se=$t.featuresOnBorder[Rt[Gt]],!(se.borders[ft][1]>ke[0]+3));)Jt&&$t.encodeCentroid(void 0,se,!1),Gt++;if(se&&Gt<Rt.length){const xe=Gt;let ue=0;for(;!(se.borders[ft][0]>ke[1]-3)&&(ue++,++Gt!==Rt.length);)se=$t.featuresOnBorder[Rt[Gt]];if(se=$t.featuresOnBorder[Rt[xe]],ae.intersectsCount()>1||se.intersectsCount()>1||ue!==1){ue!==1&&(Gt=xe),y.encodeCentroid(void 0,ae,!1),Jt&&$t.encodeCentroid(void 0,se,!1);continue}const Ie=tt[et](ae,se),ee=et%2?o.EXTENT-1:0;ht.x=xt(Ie[0],Math.min(o.EXTENT-1,Ie[1]),ee,et<2,Ie[2]),ht.y=0,y.encodeCentroid(ht,ae,!1),Jt&&$t.encodeCentroid(ht,se,!1)}else y.encodeCentroid(void 0,ae,!1)}y.borderDoneWithNeighborZ[et]=$t.canonical.z,y.needsCentroidUpdate=!0,Jt&&($t.borderDoneWithNeighborZ[ft]=y.canonical.z,$t.needsCentroidUpdate=!0)}else{for(const Yt of St)y.encodeCentroid(void 0,y.featuresOnBorder[Yt],!1);if(Jt){for(const Yt of Rt)$t.encodeCentroid(void 0,$t.featuresOnBorder[Yt],!1);$t.borderDoneWithNeighborZ[ft]=y.canonical.z,$t.needsCentroidUpdate=!0}y.borderDoneWithNeighborZ[et]=$t.canonical.z,y.needsCentroidUpdate=!0}}(y.needsCentroidUpdate||!y.centroidVertexBuffer&&y.centroidVertexArray.length!==0)&&y.uploadCentroid(m)}const Nr=new o.Color(1,0,0,1),dm=new o.Color(0,1,0,1),fm=new o.Color(0,0,1,1),pm=new o.Color(1,0,1,1),mm=new o.Color(0,1,1,1);function gm(m,r,u){const y=m.context,S=m.transform,M=y.gl,D=S.projection.name==="globe",O=D?["PROJECTION_GLOBE_VIEW"]:null;let j=u.projMatrix;if(D&&o.globeToMercatorTransition(S.zoom)>0){const ae=o.transitionTileAABBinECEF(u.canonical,S),ke=o.globeDenormalizeECEF(ae);j=o.multiply(new Float32Array(16),S.globeMatrix,ke),o.multiply(j,S.projMatrix,j)}const H=m.useProgram("debug",null,O),X=r.getTileByID(u.key);m.terrain&&m.terrain.setupElevationDraw(X,H);const tt=o.DepthMode.disabled,ht=o.StencilMode.disabled,pt=m.colorModeForRenderPass(),gt="$debug";y.activeTexture.set(M.TEXTURE0),m.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),D?X._makeGlobeTileDebugBuffers(m.context,S):X._makeDebugTileBoundsBuffers(m.context,S.projection);const mt=X._tileDebugBuffer||m.debugBuffer,xt=X._tileDebugIndexBuffer||m.debugIndexBuffer,et=X._tileDebugSegments||m.debugSegments;H.draw(y,M.LINE_STRIP,tt,ht,pt,o.CullFaceMode.disabled,Ja(j,o.Color.red),gt,mt,xt,et,null,null,null,[X._globeTileDebugBorderBuffer]);const ft=X.latestRawTileData,St=Math.floor((ft&&ft.byteLength||0)/1024),Et=r.getTile(u).tileSize,$t=512/Math.min(Et,512)*(u.overscaledZ/S.zoom)*.5;let Rt=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(Rt+=` => ${u.overscaledZ}`),Rt+=` ${St}kb`,function(ae,ke){ae.initDebugOverlayCanvas();const se=ae.debugOverlayCanvas,xe=ae.context.gl,ue=ae.debugOverlayCanvas.getContext("2d");ue.clearRect(0,0,se.width,se.height),ue.shadowColor="white",ue.shadowBlur=2,ue.lineWidth=1.5,ue.strokeStyle="white",ue.textBaseline="top",ue.font="bold 36px Open Sans, sans-serif",ue.fillText(ke,5,5),ue.strokeText(ke,5,5),ae.debugOverlayTexture.update(se),ae.debugOverlayTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE)}(m,Rt);const Gt=X._tileDebugTextBuffer||m.debugBuffer,Jt=X._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Yt=X._tileDebugTextSegments||m.debugSegments;H.draw(y,M.TRIANGLES,tt,ht,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,Ja(j,o.Color.transparent,$t),gt,Gt,Jt,Yt,null,null,null,[X._globeTileDebugTextBuffer])}function Lc(m,r,u,y){Bl(m,0,r+u/2,m.transform.width,u,y)}function Rl(m,r,u,y){Bl(m,r-u/2,0,u,m.transform.height,y)}function Bl(m,r,u,y,S,M){const D=m.context,O=D.gl;O.enable(O.SCISSOR_TEST),O.scissor(r*o.exported.devicePixelRatio,u*o.exported.devicePixelRatio,y*o.exported.devicePixelRatio,S*o.exported.devicePixelRatio),D.clear({color:M}),O.disable(O.SCISSOR_TEST)}const Dc=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Oh}=Dc;function ea(m,r,u,y){m.emplaceBack(r,u,y)}class zc{constructor(r){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,ea(this.vertexArray,-1,-1,1),ea(this.vertexArray,1,-1,1),ea(this.vertexArray,-1,1,1),ea(this.vertexArray,1,1,1),ea(this.vertexArray,-1,-1,-1),ea(this.vertexArray,1,-1,-1),ea(this.vertexArray,-1,1,-1),ea(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Oh),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function sr(m,r,u,y,S,M){const D=m.gl,O=r.paint.get("sky-atmosphere-color"),j=r.paint.get("sky-atmosphere-halo-color"),H=r.paint.get("sky-atmosphere-sun-intensity"),X=((tt,ht,pt,gt,mt)=>({u_matrix_3f:tt,u_sun_direction:ht,u_sun_intensity:pt,u_color_tint_r:[gt.r,gt.g,gt.b,gt.a],u_color_tint_m:[mt.r,mt.g,mt.b,mt.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),y),S,H,O,j);D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_CUBE_MAP_POSITIVE_X+M,r.skyboxTexture,0),u.draw(m,D.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,X,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Oc=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Rc{constructor(r){const u=new o.StructArrayLayout5f20;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const y=new o.StructArrayLayout3ui6;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(u,Oc.members),this.indexBuffer=r.createIndexBuffer(y),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const il={symbol:function(m,r,u,y,S){if(m.renderPass!=="translucent")return;const M=o.StencilMode.disabled,D=m.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(O,j,H,X,tt,ht,pt){const gt=j.transform,mt=tt==="map",xt=ht==="map";for(const et of O){const ft=X.getTile(et),St=ft.getBucket(H);if(!St||!St.text||!St.text.segments.get().length)continue;const Et=o.evaluateSizeForZoom(St.textSizeData,gt.zoom),$t=Ys(et,St.getProjection(),gt),Rt=gt.calculatePixelsToTileUnitsMatrix(ft),Gt=pe($t,ft.tileID.canonical,xt,mt,gt,St.getProjection(),Rt),Jt=H.layout.get("icon-text-fit")!=="none"&&St.hasIconData();if(Et){const Yt=Math.pow(2,gt.zoom-ft.tileID.overscaledZ);um(St,mt,xt,pt,o.symbolSize,gt,Gt,et,Yt,Et,Jt)}}}(y,m,u,r,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),S),u.paint.get("icon-opacity").constantOr(1)!==0&&Df(m,r,u,y,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),M,D),u.paint.get("text-opacity").constantOr(1)!==0&&Df(m,r,u,y,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),M,D),r.map.showCollisionBoxes&&(Pc(m,r,u,y,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Pc(m,r,u,y,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(m,r,u,y){if(m.renderPass!=="translucent")return;const S=u.paint.get("circle-opacity"),M=u.paint.get("circle-stroke-width"),D=u.paint.get("circle-stroke-opacity"),O=u.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)===0&&(M.constantOr(1)===0||D.constantOr(1)===0))return;const j=m.context,H=j.gl,X=m.transform,tt=m.depthModeForSublayer(0,o.DepthMode.ReadOnly),ht=o.StencilMode.disabled,pt=m.colorModeForRenderPass(),gt=X.projection.name==="globe",mt=[o.mercatorXfromLng(X.center.lng),o.mercatorYfromLat(X.center.lat)],xt=[];for(let ft=0;ft<y.length;ft++){const St=y[ft],Et=r.getTile(St),$t=Et.getBucket(u);if(!$t||$t.projection.name!==X.projection.name)continue;const Rt=$t.programConfigurations.get(u.id),Gt=td(u);gt&&Gt.push("PROJECTION_GLOBE_VIEW");const Jt=m.useProgram("circle",Rt,Gt),Yt=$t.layoutVertexBuffer,ae=$t.globeExtVertexBuffer,ke=$t.indexBuffer,se=X.projection.createInversionMatrix(X,St.canonical),xe={programConfiguration:Rt,program:Jt,layoutVertexBuffer:Yt,globeExtVertexBuffer:ae,indexBuffer:ke,uniformValues:zl(m,St,Et,se,mt,u),tile:Et};if(O){const ue=$t.segments.get();for(const Ie of ue)xt.push({segments:new o.SegmentVector([Ie]),sortKey:Ie.sortKey,state:xe})}else xt.push({segments:$t.segments,sortKey:0,state:xe})}O&&xt.sort((ft,St)=>ft.sortKey-St.sortKey);const et={useDepthForOcclusion:!gt};for(const ft of xt){const{programConfiguration:St,program:Et,layoutVertexBuffer:$t,globeExtVertexBuffer:Rt,indexBuffer:Gt,uniformValues:Jt,tile:Yt}=ft.state,ae=ft.segments;m.terrain&&m.terrain.setupElevationDraw(Yt,Et,et),m.prepareDrawProgram(j,Et,Yt.tileID.toUnwrapped()),Et.draw(j,H.TRIANGLES,tt,ht,pt,o.CullFaceMode.disabled,Jt,u.id,$t,Gt,ae,u.paint,X.zoom,St,[Rt])}},heatmap:function(m,r,u,y){if(u.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const S=m.context,M=S.gl,D=o.StencilMode.disabled,O=new o.ColorMode([M.ONE,M.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(pt,gt,mt,xt){const et=pt.gl,ft=gt.width*xt,St=gt.height*xt;pt.activeTexture.set(et.TEXTURE1),pt.viewport.set([0,0,ft,St]);let Et=mt.heatmapFbo;if(!Et||Et&&(Et.width!==ft||Et.height!==St)){Et&&Et.destroy();const $t=et.createTexture();et.bindTexture(et.TEXTURE_2D,$t),et.texParameteri(et.TEXTURE_2D,et.TEXTURE_WRAP_S,et.CLAMP_TO_EDGE),et.texParameteri(et.TEXTURE_2D,et.TEXTURE_WRAP_T,et.CLAMP_TO_EDGE),et.texParameteri(et.TEXTURE_2D,et.TEXTURE_MIN_FILTER,et.LINEAR),et.texParameteri(et.TEXTURE_2D,et.TEXTURE_MAG_FILTER,et.LINEAR),Et=mt.heatmapFbo=pt.createFramebuffer(ft,St,!1),function(Rt,Gt,Jt,Yt,ae,ke){const se=Rt.gl;se.texImage2D(se.TEXTURE_2D,0,Rt.isWebGL2&&Rt.extRenderToTextureHalfFloat?se.RGBA16F:se.RGBA,ae,ke,0,se.RGBA,Rt.extRenderToTextureHalfFloat?Rt.isWebGL2?se.HALF_FLOAT:Rt.extTextureHalfFloat.HALF_FLOAT_OES:se.UNSIGNED_BYTE,null),Yt.colorAttachment.set(Jt)}(pt,0,$t,Et,ft,St)}else et.bindTexture(et.TEXTURE_2D,Et.colorAttachment.get()),pt.bindFramebuffer.set(Et.framebuffer)})(S,m,u,m.transform.projection.name==="globe"?.5:.25),S.clear({color:o.Color.transparent});const j=m.transform,H=j.projection.name==="globe",X=H?["PROJECTION_GLOBE_VIEW"]:null,tt=H?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,ht=[o.mercatorXfromLng(j.center.lng),o.mercatorYfromLat(j.center.lat)];for(let pt=0;pt<y.length;pt++){const gt=y[pt];if(r.hasRenderableParent(gt))continue;const mt=r.getTile(gt),xt=mt.getBucket(u);if(!xt||xt.projection.name!==j.projection.name)continue;const et=xt.programConfigurations.get(u.id),ft=m.useProgram("heatmap",et,X),{zoom:St}=m.transform;m.terrain&&m.terrain.setupElevationDraw(mt,ft),m.prepareDrawProgram(S,ft,gt.toUnwrapped());const Et=j.projection.createInversionMatrix(j,gt.canonical);ft.draw(S,M.TRIANGLES,o.DepthMode.disabled,D,O,tt,Lf(m,gt,mt,Et,ht,St,u.paint.get("heatmap-intensity")),u.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,u.paint,m.transform.zoom,et,H?[xt.globeExtVertexBuffer]:null)}S.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(S,M){const D=S.context,O=D.gl,j=M.heatmapFbo;if(!j)return;D.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,j.colorAttachment.get()),D.activeTexture.set(O.TEXTURE1);let H=M.colorRampTexture;H||(H=M.colorRampTexture=new o.Texture(D,M.colorRamp,O.RGBA)),H.bind(O.LINEAR,O.CLAMP_TO_EDGE),S.useProgram("heatmapTexture").draw(D,O.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,S.colorModeForRenderPass(),o.CullFaceMode.disabled,((X,tt,ht,pt)=>({u_image:0,u_color_ramp:1,u_opacity:tt.paint.get("heatmap-opacity")}))(0,M),M.id,S.viewportBuffer,S.quadTriangleIndexBuffer,S.viewportSegments,M.paint,S.transform.zoom)}(m,u))},line:function(m,r,u,y){if(m.renderPass!=="translucent")return;const S=u.paint.get("line-opacity"),M=u.paint.get("line-width");if(S.constantOr(1)===0||M.constantOr(1)===0)return;const D=m.depthModeForSublayer(0,o.DepthMode.ReadOnly),O=m.colorModeForRenderPass(),j=m.terrain&&m.terrain.renderingToTexture?1:o.exported.devicePixelRatio,H=u.paint.get("line-dasharray"),X=H.constantOr(1),tt=u.layout.get("line-cap"),ht=u.paint.get("line-pattern"),pt=ht.constantOr(1),gt=u.paint.get("line-gradient"),mt=pt?"linePattern":"line",xt=m.context,et=xt.gl,ft=(Et=>{const $t=[];Ac(Et)&&$t.push("RENDER_LINE_DASH"),Et.paint.get("line-gradient")&&$t.push("RENDER_LINE_GRADIENT");const Rt=Et.paint.get("line-trim-offset");Rt[0]===0&&Rt[1]===0||$t.push("RENDER_LINE_TRIM_OFFSET");const Gt=Et.paint.get("line-pattern").constantOr(1),Jt=Et.paint.get("line-opacity").constantOr(1)!==1;return!Gt&&Jt&&$t.push("RENDER_LINE_ALPHA_DISCARD"),$t})(u);let St=ft.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(St=!1);for(const Et of y){const $t=r.getTile(Et);if(pt&&!$t.patternsLoaded())continue;const Rt=$t.getBucket(u);if(!Rt)continue;m.prepareDrawTile();const Gt=Rt.programConfigurations.get(u.id),Jt=m.useProgram(mt,Gt,ft),Yt=ht.constantOr(null);if(Yt&&$t.imageAtlas){const ve=$t.imageAtlas.patternPositions[Yt.toString()];ve&&Gt.setConstantPatternPositions(ve)}const ae=H.constantOr(null),ke=tt.constantOr(null);if(!pt&&ae&&ke&&$t.lineAtlas){const ve=$t.lineAtlas.getDash(ae,ke);ve&&Gt.setConstantPatternPositions(ve)}let[se,xe]=u.paint.get("line-trim-offset");(ke==="round"||ke==="square")&&se!==xe&&(se===0&&(se-=1),xe===1&&(xe+=1));const ue=m.terrain?Et.projMatrix:null,Ie=pt?Mc(m,$t,u,ue,j):Qa(m,$t,u,ue,Rt.lineClipsArray.length,j,[se,xe]);if(gt){const ve=Rt.gradients[u.id];let De=ve.texture;if(u.gradientVersion!==ve.version){let ge=256;if(u.stepInterpolant){const Oe=r.getSource().maxzoom,yi=Et.canonical.z===Oe?Math.ceil(1<<m.transform.maxZoom-Et.canonical.z):1;ge=o.clamp(o.nextPowerOfTwo(Rt.maxLineLength/o.EXTENT*1024*yi),256,xt.maxTextureSize)}ve.gradient=o.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:ge,image:ve.gradient||void 0,clips:Rt.lineClipsArray}),ve.texture?ve.texture.update(ve.gradient):ve.texture=new o.Texture(xt,ve.gradient,et.RGBA),ve.version=u.gradientVersion,De=ve.texture}xt.activeTexture.set(et.TEXTURE1),De.bind(u.stepInterpolant?et.NEAREST:et.LINEAR,et.CLAMP_TO_EDGE)}X&&(xt.activeTexture.set(et.TEXTURE0),$t.lineAtlasTexture.bind(et.LINEAR,et.REPEAT),Gt.updatePaintBuffers()),pt&&(xt.activeTexture.set(et.TEXTURE0),$t.imageAtlasTexture.bind(et.LINEAR,et.CLAMP_TO_EDGE),Gt.updatePaintBuffers()),m.prepareDrawProgram(xt,Jt,Et.toUnwrapped());const ee=ve=>{Jt.draw(xt,et.TRIANGLES,D,ve,O,o.CullFaceMode.disabled,Ie,u.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Rt.segments,u.paint,m.transform.zoom,Gt,[Rt.layoutVertexBuffer2])};if(St){const ve=m.stencilModeForClipping(Et).ref;ve===0&&m.terrain&&xt.clear({stencil:0});const De={func:et.EQUAL,mask:255};Ie.u_alpha_discard_threshold=.8,ee(new o.StencilMode(De,ve,255,et.KEEP,et.KEEP,et.INVERT)),Ie.u_alpha_discard_threshold=0,ee(new o.StencilMode(De,ve,255,et.KEEP,et.KEEP,et.KEEP))}else ee(m.stencilModeForClipping(Et))}St&&(m.resetStencilClippingMasks(),m.terrain&&xt.clear({stencil:0}))},fill:function(m,r,u,y){const S=u.paint.get("fill-color"),M=u.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const D=m.colorModeForRenderPass(),O=u.paint.get("fill-pattern"),j=m.opaquePassEnabledForLayer()&&!O.constantOr(1)&&S.constantOr(o.Color.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===j){const H=m.depthModeForSublayer(1,m.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);od(m,r,u,y,H,D,!1)}if(m.renderPass==="translucent"&&u.paint.get("fill-antialias")){const H=m.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);od(m,r,u,y,H,D,!0)}},"fill-extrusion":function(m,r,u,y){const S=u.paint.get("fill-extrusion-opacity");if(S!==0&&m.renderPass==="translucent"){const M=new o.DepthMode(m.context.gl.LEQUAL,o.DepthMode.ReadWrite,m.depthRangeFor3D);if(S!==1||u.paint.get("fill-extrusion-pattern").constantOr(1))zh(m,r,u,y,M,o.StencilMode.disabled,o.ColorMode.disabled),zh(m,r,u,y,M,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{const D=m.colorModeForRenderPass();zh(m,r,u,y,M,o.StencilMode.disabled,D)}}},hillshade:function(m,r,u,y){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const S=m.context,M=m.depthModeForSublayer(0,o.DepthMode.ReadOnly),D=m.colorModeForRenderPass(),O=m.terrain&&m.terrain.renderingToTexture,[j,H]=m.renderPass!=="translucent"||O?[{},y]:m.stencilConfigForOverlap(y);for(const X of H){const tt=r.getTile(X);if(tt.needsHillshadePrepare&&m.renderPass==="offscreen")Th(m,tt,u,M,o.StencilMode.disabled,D);else if(m.renderPass==="translucent"){const ht=O&&m.terrain?m.terrain.stencilModeForRTTOverlap(X):j[X.overscaledZ];Xu(m,X,tt,u,M,ht,D)}}S.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,r,u,y,S,M){if(m.renderPass!=="translucent"||u.paint.get("raster-opacity")===0||!y.length)return;const D=m.context,O=D.gl,j=r.getSource(),H=m.useProgram("raster"),X=m.colorModeForRenderPass(),tt=m.terrain&&m.terrain.renderingToTexture,[ht,pt]=j instanceof Ei||tt?[{},y]:m.stencilConfigForOverlap(y),gt=pt[pt.length-1].overscaledZ,mt=!m.options.moving;for(const xt of pt){const et=tt?o.DepthMode.disabled:m.depthModeForSublayer(xt.overscaledZ-gt,u.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,O.LESS),ft=xt.toUnwrapped(),St=r.getTile(xt);if(tt&&(!St||!St.hasData()))continue;const Et=tt?xt.projMatrix:m.transform.calculateProjMatrix(ft,mt),$t=m.terrain&&tt?m.terrain.stencilModeForRTTOverlap(xt):ht[xt.overscaledZ],Rt=M?0:u.paint.get("raster-fade-duration");St.registerFadeDuration(Rt);const Gt=r.findLoadedParent(xt,0),Jt=qu(St,Gt,r,m.transform,Rt);let Yt,ae;m.terrain&&m.terrain.prepareDrawTile();const ke=u.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;D.activeTexture.set(O.TEXTURE0),St.texture.bind(ke,O.CLAMP_TO_EDGE),D.activeTexture.set(O.TEXTURE1),Gt?(Gt.texture.bind(ke,O.CLAMP_TO_EDGE),Yt=Math.pow(2,Gt.tileID.overscaledZ-St.tileID.overscaledZ),ae=[St.tileID.canonical.x*Yt%1,St.tileID.canonical.y*Yt%1]):St.texture.bind(ke,O.CLAMP_TO_EDGE),St.texture.useMipmap&&D.extTextureFilterAnisotropic&&m.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const se=Cc(Et,ae||[0,0],Yt||1,Jt,u,j instanceof Ei?j.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(D,H,ft),j instanceof Ei)j.boundsBuffer&&j.boundsSegments&&H.draw(D,O.TRIANGLES,et,o.StencilMode.disabled,X,o.CullFaceMode.disabled,se,u.id,j.boundsBuffer,m.quadTriangleIndexBuffer,j.boundsSegments);else{const{tileBoundsBuffer:xe,tileBoundsIndexBuffer:ue,tileBoundsSegments:Ie}=m.getTileBoundsBuffers(St);H.draw(D,O.TRIANGLES,et,$t,X,o.CullFaceMode.disabled,se,u.id,xe,ue,Ie)}}m.resetStencilClippingMasks()},background:function(m,r,u,y){const S=u.paint.get("background-color"),M=u.paint.get("background-opacity");if(M===0)return;const D=m.context,O=D.gl,j=m.transform,H=j.tileSize,X=u.paint.get("background-pattern");if(m.isPatternMissing(X))return;const tt=!X&&S.a===1&&M===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==tt)return;const ht=o.StencilMode.disabled,pt=m.depthModeForSublayer(0,tt==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),gt=m.colorModeForRenderPass(),mt=m.useProgram(X?"backgroundPattern":"background");let xt,et=y;et||(xt=m.getBackgroundTiles(),et=Object.values(xt).map(ft=>ft.tileID)),X&&(D.activeTexture.set(O.TEXTURE0),m.imageManager.bind(m.context));for(const ft of et){const St=ft.toUnwrapped(),Et=y?ft.projMatrix:m.transform.calculateProjMatrix(St);m.prepareDrawTile();const $t=r?r.getTile(ft):xt?xt[ft.key]:new o.Tile(ft,H,j.zoom,m),Rt=X?hm(Et,M,m,X,{tileID:ft,tileSize:H}):id(Et,M,S);m.prepareDrawProgram(D,mt,St);const{tileBoundsBuffer:Gt,tileBoundsIndexBuffer:Jt,tileBoundsSegments:Yt}=m.getTileBoundsBuffers($t);mt.draw(D,O.TRIANGLES,pt,ht,gt,o.CullFaceMode.disabled,Rt,u.id,Gt,Jt,Yt)}},sky:function(m,r,u){const y=m.transform,S=y.projection.name==="mercator"||y.projection.name==="globe"?1:o.smoothstep(7,8,y.zoom),M=u.paint.get("sky-opacity")*S;if(M===0)return;const D=m.context,O=u.paint.get("sky-type"),j=new o.DepthMode(D.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),H=m.frameCounter/1e3%1;O==="atmosphere"?m.renderPass==="offscreen"?u.needsSkyboxCapture(m)&&(function(X,tt,ht,pt){const gt=X.context,mt=gt.gl;let xt=tt.skyboxFbo;if(!xt){xt=tt.skyboxFbo=gt.createFramebuffer(32,32,!1),tt.skyboxGeometry=new zc(gt),tt.skyboxTexture=gt.gl.createTexture(),mt.bindTexture(mt.TEXTURE_CUBE_MAP,tt.skyboxTexture),mt.texParameteri(mt.TEXTURE_CUBE_MAP,mt.TEXTURE_WRAP_S,mt.CLAMP_TO_EDGE),mt.texParameteri(mt.TEXTURE_CUBE_MAP,mt.TEXTURE_WRAP_T,mt.CLAMP_TO_EDGE),mt.texParameteri(mt.TEXTURE_CUBE_MAP,mt.TEXTURE_MIN_FILTER,mt.LINEAR),mt.texParameteri(mt.TEXTURE_CUBE_MAP,mt.TEXTURE_MAG_FILTER,mt.LINEAR);for(let Et=0;Et<6;++Et)mt.texImage2D(mt.TEXTURE_CUBE_MAP_POSITIVE_X+Et,0,mt.RGBA,32,32,0,mt.RGBA,mt.UNSIGNED_BYTE,null)}gt.bindFramebuffer.set(xt.framebuffer),gt.viewport.set([0,0,32,32]);const et=tt.getCenter(X,!0),ft=X.useProgram("skyboxCapture"),St=new Float64Array(16);o.identity(St),o.rotateY(St,St,.5*-Math.PI),sr(gt,tt,ft,St,et,0),o.identity(St),o.rotateY(St,St,.5*Math.PI),sr(gt,tt,ft,St,et,1),o.identity(St),o.rotateX(St,St,.5*-Math.PI),sr(gt,tt,ft,St,et,2),o.identity(St),o.rotateX(St,St,.5*Math.PI),sr(gt,tt,ft,St,et,3),o.identity(St),sr(gt,tt,ft,St,et,4),o.identity(St),o.rotateY(St,St,Math.PI),sr(gt,tt,ft,St,et,5),gt.viewport.set([0,0,X.width,X.height])}(m,u),u.markSkyboxValid(m)):m.renderPass==="sky"&&function(X,tt,ht,pt,gt){const mt=X.context,xt=mt.gl,et=X.transform,ft=X.useProgram("skybox");mt.activeTexture.set(xt.TEXTURE0),xt.bindTexture(xt.TEXTURE_CUBE_MAP,tt.skyboxTexture);const St=((Et,$t,Rt,Gt,Jt)=>({u_matrix:Et,u_sun_direction:$t,u_cubemap:0,u_opacity:Gt,u_temporal_offset:Jt}))(et.skyboxMatrix,tt.getCenter(X,!1),0,pt,gt);X.prepareDrawProgram(mt,ft),ft.draw(mt,xt.TRIANGLES,ht,o.StencilMode.disabled,X.colorModeForRenderPass(),o.CullFaceMode.backCW,St,"skybox",tt.skyboxGeometry.vertexBuffer,tt.skyboxGeometry.indexBuffer,tt.skyboxGeometry.segment)}(m,u,j,M,H):O==="gradient"&&m.renderPass==="sky"&&function(X,tt,ht,pt,gt){const mt=X.context,xt=mt.gl,et=X.transform,ft=X.useProgram("skyboxGradient");tt.skyboxGeometry||(tt.skyboxGeometry=new zc(mt)),mt.activeTexture.set(xt.TEXTURE0);let St=tt.colorRampTexture;St||(St=tt.colorRampTexture=new o.Texture(mt,tt.colorRamp,xt.RGBA)),St.bind(xt.LINEAR,xt.CLAMP_TO_EDGE);const Et=(($t,Rt,Gt,Jt,Yt)=>({u_matrix:$t,u_color_ramp:0,u_center_direction:Rt,u_radius:o.degToRad(Gt),u_opacity:Jt,u_temporal_offset:Yt}))(et.skyboxMatrix,tt.getCenter(X,!1),tt.paint.get("sky-gradient-radius"),pt,gt);X.prepareDrawProgram(mt,ft),ft.draw(mt,xt.TRIANGLES,ht,o.StencilMode.disabled,X.colorModeForRenderPass(),o.CullFaceMode.backCW,Et,"skyboxGradient",tt.skyboxGeometry.vertexBuffer,tt.skyboxGeometry.indexBuffer,tt.skyboxGeometry.segment)}(m,u,j,M,H)},debug:function(m,r,u){for(let y=0;y<u.length;y++)gm(m,r,u[y])},custom:function(m,r,u,y){const S=m.context,M=u.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&u.isLayerDraped()){if(m.renderPass==="offscreen"){const D=M.prerender;if(D){if(m.setCustomLayerDefaults(),S.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const O=m.transform.pointMerc;D.call(M,S.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(m.transform.zoom),[O.x,O.y],m.transform.pixelsPerMeterRatio)}else D.call(M,S.gl,m.transform.customLayerMatrix());S.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const O=M.renderToTile;if(O){const j=y[0].canonical,H=new o.MercatorCoordinate(j.x+y[0].wrap*(1<<j.z),j.y,j.z);S.setDepthMode(o.DepthMode.disabled),S.setStencilMode(o.StencilMode.disabled),S.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),O.call(M,S.gl,H),S.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),S.setColorMode(m.colorModeForRenderPass()),S.setStencilMode(o.StencilMode.disabled);const D=M.renderingMode==="3d"?new o.DepthMode(m.context.gl.LEQUAL,o.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,o.DepthMode.ReadOnly);if(S.setDepthMode(D),m.transform.projection.name==="globe"){const O=m.transform.pointMerc;M.render(S.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(m.transform.zoom),[O.x,O.y],m.transform.pixelsPerMeterRatio)}else M.render(S.gl,m.transform.customLayerMatrix());S.setDirty(),m.setBaseState(),S.bindFramebuffer.set(null)}}else o.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Fl{constructor(r,u,y=!1){this.context=new Fe(r,y),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,u){const y=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Zu(this,r));const S=this._terrain;this.transform.elevation=y?S:null,S.update(r,this.transform,u)}_updateFog(r){const u=r.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,S]=u.getFovAdjustedRange(this.transform._fov);if(y>S)return void(this.transform.fogCullDistSq=null);const M=y+.78*(S-y);this.transform.fogCullDistSq=M*M}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,u){if(this.width=r*o.exported.devicePixelRatio,this.height=u*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._layers[y].resize()}setup(){const r=this.context,u=new o.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(o.EXTENT,0),u.emplaceBack(0,o.EXTENT),u.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(u,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const y=new o.StructArrayLayout2i4;y.emplaceBack(0,0),y.emplaceBack(o.EXTENT,0),y.emplaceBack(0,o.EXTENT),y.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=r.createVertexBuffer(y,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const S=new o.StructArrayLayout2i4;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(-1,1),S.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(S,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const M=new o.StructArrayLayout4i8;M.emplaceBack(0,0,0,0),M.emplaceBack(o.EXTENT,0,o.EXTENT,0),M.emplaceBack(0,o.EXTENT,0,o.EXTENT),M.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(M,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const D=new o.StructArrayLayout3ui6;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(D);const O=new o.StructArrayLayout1ui2;for(const H of[0,1,3,2,0])O.emplaceBack(H);this.debugIndexBuffer=r.createIndexBuffer(O),this.emptyTexture=new o.Texture(r,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=o.create();const j=this.context.gl;this.stencilClearMode=new o.StencilMode({func:j.ALWAYS,mask:0},0,255,j.ZERO,j.ZERO,j.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new Rc(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,u=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,u.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,Sc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,u,y){if(!u||this.currentStencilSource===u.id||!r.isTileClipped()||!y||y.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let O=!1;for(const j of y)if(this._tileClippingMaskIDs[j.key]===void 0){O=!0;break}if(!O)return}this.currentStencilSource=u.id;const S=this.context,M=S.gl;this.nextStencilID+y.length>256&&this.clearStencil(),S.setColorMode(o.ColorMode.disabled),S.setDepthMode(o.DepthMode.disabled);const D=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const O of y){const j=u.getTile(O),H=this._tileClippingMaskIDs[O.key]=this.nextStencilID++,{tileBoundsBuffer:X,tileBoundsIndexBuffer:tt,tileBoundsSegments:ht}=this.getTileBoundsBuffers(j);D.draw(S,M.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:M.ALWAYS,mask:0},H,255,M.KEEP,M.KEEP,M.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Sc(O.projMatrix),"$clipping",X,tt,ht)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,u=this.context.gl;return new o.StencilMode({func:u.NOTEQUAL,mask:255},r,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const u=this.context.gl;return new o.StencilMode({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(r){const u=this.context.gl,y=r.sort((D,O)=>O.overscaledZ-D.overscaledZ),S=y[y.length-1].overscaledZ,M=y[0].overscaledZ-S+1;if(M>1){this.currentStencilSource=void 0,this.nextStencilID+M>256&&this.clearStencil();const D={};for(let O=0;O<M;O++)D[O+S]=new o.StencilMode({func:u.GEQUAL,mask:255},O+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=M,[D,y]}return[{[S]:o.StencilMode.disabled},y]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([r.CONSTANT_COLOR,r.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(r,u,y){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const S=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new o.DepthMode(y||this.context.gl.LEQUAL,u,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,u){this.style=r,this.options=u,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const y=this.style.order,S=this.style._sourceCaches;for(const H in S){const X=S[H];X.used&&X.prepare(this.context)}const M={},D={},O={};for(const H in S){const X=S[H];M[H]=X.getVisibleCoordinates(),D[H]=M[H].slice().reverse(),O[H]=X.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let H=0;H<y.length;H++)if(this.style._layers[y[H]].is3D()){this.opaquePassCutoff=H;break}if(this.terrain&&(this.terrain.updateTileBinding(O),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const H of y){const X=this.style._layers[H],tt=r._getLayerSourceCache(X);if(!X.hasOffscreenPass()||X.isHidden(this.transform.zoom))continue;const ht=tt?D[tt.id]:void 0;(X.type==="custom"||X.isSky()||ht&&ht.length)&&this.renderLayer(this,tt,X,ht)}this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon];const j=this.terrain;if(j&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&j.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:u.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const H=this.style._layers[y[this.currentLayer]],X=r._getLayerSourceCache(H);if(H.isSky())continue;const tt=X?D[X.id]:void 0;this._renderTileClippingMasks(H,X,tt),this.renderLayer(this,X,H,tt)}if(this.style.fog&&this.transform.projection.supportsFog&&function(H,X){const tt=H.context,ht=tt.gl,pt=H.transform,gt=new o.DepthMode(ht.LEQUAL,o.DepthMode.ReadOnly,[0,1]),mt=H.useProgram("globeAtmosphere",null,pt.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),xt=o.globeToMercatorTransition(pt.zoom),et=X.properties.get("color").toArray01(),ft=X.properties.get("high-color").toArray01(),St=X.properties.get("space-color").toArray01PremultipliedAlpha(),Et=o.identity$1([]);o.rotateY$1(Et,Et,-o.degToRad(pt._center.lng)),o.rotateX$1(Et,Et,o.degToRad(pt._center.lat)),o.rotateZ$1(Et,Et,pt.angle),o.rotateX$1(Et,Et,-pt._pitch);const $t=o.fromQuat(new Float32Array(16),Et),Rt=o.mapValue(X.properties.get("star-intensity"),0,1,0,.25),Gt=5e-4,Jt=o.mapValue(X.properties.get("horizon-blend"),0,1,Gt,.25),Yt=o.globeUseCustomAntiAliasing(H,tt,pt)&&Jt===Gt?pt.worldSize/(2*Math.PI*1.025)-1:pt.globeRadius,ae=H.frameCounter/1e3%1,ke=o.length(pt.globeCenterInViewSpace),se=Math.sqrt(Math.pow(ke,2)-Math.pow(Yt,2)),xe=Math.acos(se/ke),ue=((ee,ve,De,ge,Oe,yi,ki,ai,vi,Oi,Ri,mi,xs,ws)=>({u_frustum_tl:ee,u_frustum_tr:ve,u_frustum_br:De,u_frustum_bl:ge,u_horizon:Oe,u_transition:yi,u_fadeout_range:ki,u_color:ai,u_high_color:vi,u_space_color:Oi,u_star_intensity:Ri,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:mi,u_horizon_angle:xs,u_rotation_matrix:ws}))(pt.frustumCorners.TL,pt.frustumCorners.TR,pt.frustumCorners.BR,pt.frustumCorners.BL,pt.frustumCorners.horizon,xt,Jt,et,ft,St,Rt,ae,xe,$t);H.prepareDrawProgram(tt,mt);const Ie=H.atmosphereBuffer;Ie&&mt.draw(tt,ht.TRIANGLES,gt,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,ue,"skybox",Ie.vertexBuffer,Ie.indexBuffer,Ie.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const H=this.style._layers[y[this.currentLayer]],X=r._getLayerSourceCache(H);H.isSky()&&this.renderLayer(this,X,H,X?D[X.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;){const H=this.style._layers[y[this.currentLayer]],X=r._getLayerSourceCache(H);if(H.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(H)){if(H.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const tt=X?(H.type==="symbol"?O:D)[X.id]:void 0;this._renderTileClippingMasks(H,X,X?M[X.id]:void 0),this.renderLayer(this,X,H,tt),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let H=null;o.values(this.style._layers).forEach(X=>{const tt=r._getLayerSourceCache(X);tt&&!X.isHidden(this.transform.zoom)&&(!H||H.getSource().maxzoom<tt.getSource().maxzoom)&&(H=tt)}),H&&this.options.showTileBoundaries&&il.debug(this,H,H.getVisibleCoordinates())}this.options.showPadding&&function(H){const X=H.transform.padding;Lc(H,H.transform.height-(X.top||0),3,Nr),Lc(H,X.bottom||0,3,dm),Rl(H,X.left||0,3,fm),Rl(H,H.transform.width-(X.right||0),3,pm);const tt=H.transform.centerPoint;(function(ht,pt,gt,mt){Bl(ht,pt-1,gt-10,2,20,mt),Bl(ht,pt-10,gt-1,20,2,mt)})(H,tt.x,H.transform.height-tt.y,mm)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(r,u,y,S){y.isHidden(this.transform.zoom)||(y.type==="background"||y.type==="sky"||y.type==="custom"||S&&S.length)&&(this.id=y.id,this.gpuTimingStart(y),(!r.transform.projection.unsupportedLayers||!r.transform.projection.unsupportedLayers.includes(y.type)||r.terrain&&y.type==="custom")&&il[y.type](r,u,y,S,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let y=this.gpuTimers[r.id];y||(y=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),y.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,u=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(u),r.beginQueryEXT(r.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const u={};for(const y in r){const S=r[y],M=this.context.extTimerQuery,D=M.getQueryObjectEXT(S.query,M.QUERY_RESULT_EXT)/1e6;M.deleteQueryEXT(S.query),u[y]=D}return u}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.extTimerQuery;let y=0;for(const S of r)y+=u.getQueryObjectEXT(S,u.QUERY_RESULT_EXT)/1e6,u.deleteQueryEXT(S);return y}translatePosMatrix(r,u,y,S,M){if(!y[0]&&!y[1])return r;const D=M?S==="map"?this.transform.angle:0:S==="viewport"?-this.transform.angle:0;if(D){const H=Math.sin(D),X=Math.cos(D);y=[y[0]*X-y[1]*H,y[0]*H+y[1]*X]}const O=[M?y[0]:Yi(u,y[0],this.transform.zoom),M?y[1]:Yi(u,y[1],this.transform.zoom),0],j=new Float32Array(16);return o.translate(j,r,O),j}saveTileTexture(r){const u=this._tileTextures[r.size[0]];u?u.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const u=this._tileTextures[r];return u&&u.length>0?u.pop():null}isPatternMissing(r){return r===null||r!==void 0&&!this.imageManager.getPattern(r.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,u=this.terrain&&this.terrain.exaggeration()===0,y=this.style&&this.style.fog,S=[];return this.terrainRenderModeElevated()&&S.push("TERRAIN"),this.transform.projection.name==="globe"&&S.push("GLOBE"),u&&S.push("ZERO_EXAGGERATION"),y&&!r&&y.getOpacity(this.transform.pitch)!==0&&S.push("FOG"),r&&S.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&S.push("OVERDRAW_INSPECTOR"),S}useProgram(r,u,y){this.cache=this.cache||{};const S=y||[],M=this.currentGlobalDefines().concat(S),D=rs.cacheKey(bh[r],r,M,u);return this.cache[D]||(this.cache[D]=new rs(this.context,r,bh[r],u,sd[r],M)),this.cache[D]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,u,y){if(this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const M=S.getOpacity(this.transform.pitch),D=((O,j,H,X,tt,ht,pt,gt,mt,xt,et)=>{const ft=O.transform,St=j.properties.get("color").toArray01();St[3]=X;const Et=O.frameCounter/1e3%1;return{u_fog_matrix:H?ft.calculateFogTileMatrix(H):O.identityMat,u_fog_range:j.getFovAdjustedRange(ft._fov),u_fog_color:St,u_fog_horizon_blend:j.properties.get("horizon-blend"),u_fog_temporal_offset:Et,u_frustum_tl:tt,u_frustum_tr:ht,u_frustum_br:pt,u_frustum_bl:gt,u_globe_pos:mt,u_globe_radius:xt,u_viewport:et,u_globe_transition:o.globeToMercatorTransition(ft.zoom),u_is_globe:+(ft.projection.name==="globe")}})(this,S,y,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);u.setFogUniformValues(r,D)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,u=r.createTexture();return r.bindTexture(r.TEXTURE_2D,u),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,u=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const S of y)u[S.key]=r[S.key]||new o.Tile(S,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}}class Pr{constructor(r=0,u=0,y=0,S=0){if(isNaN(r)||r<0||isNaN(u)||u<0||isNaN(y)||y<0||isNaN(S)||S<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=u,this.left=y,this.right=S}interpolate(r,u,y){return u.top!=null&&r.top!=null&&(this.top=o.number(r.top,u.top,y)),u.bottom!=null&&r.bottom!=null&&(this.bottom=o.number(r.bottom,u.bottom,y)),u.left!=null&&r.left!=null&&(this.left=o.number(r.left,u.left,y)),u.right!=null&&r.right!=null&&(this.right=o.number(r.right,u.right,y)),this}getCenter(r,u){const y=o.clamp((this.left+r-this.right)/2,0,r),S=o.clamp((this.top+u-this.bottom)/2,0,u);return new o.Point(y,S)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Pr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ia(m,r){const u=o.getColumn(m,3);o.fromQuat(m,r),o.setColumn(m,3,u)}function us(m,r){const u=o.identity$1([]);return o.rotateZ$1(u,u,-r),o.rotateX$1(u,u,-m),u}function Nl(m,r){const u=[m[0],m[1],0],y=[r[0],r[1],0];if(o.length(u)>=1e-15){const D=o.normalize([],u);o.scale$2(y,D,o.dot(y,D)),r[0]=y[0],r[1]=y[1]}const S=o.cross([],r,m);if(o.len(S)<1e-15)return null;const M=Math.atan2(-S[1],S[0]);return us(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),M)}class zf{constructor(r,u){this.position=r,this.orientation=u}get position(){return this._position}set position(r){if(r){const u=r instanceof o.MercatorCoordinate?r:new o.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(u.x=o.wrap(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(r,u){if(this.orientation=null,!this.position)return;const y=this.position,S=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(r)):0,M=o.MercatorCoordinate.fromLngLat(r,S),D=[M.x-y.x,M.y-y.y,M.z-y.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=Nl(D,u)}setPitchBearing(r,u){this.orientation=us(o.degToRad(r),o.degToRad(-u))}}class jl{constructor(r,u){this._transform=o.identity([]),this.orientation=u,this.position=r}get mercatorPosition(){const r=this.position;return new o.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=o.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var u;r&&o.setColumn(this._transform,3,[(u=r)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||o.identity$1([]),r&&ia(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,u){this._orientation=us(r,u),ia(this._transform,this._orientation)}forward(){const r=o.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=o.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=o.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,u){const y=new Float64Array(16);return o.invert(y,this.getWorldToCamera(r,u)),y}getWorldToCameraPosition(r,u,y){const S=this.position;o.scale$2(S,S,-r);const M=new Float64Array(16);return o.fromScaling(M,[y,y,y]),o.translate(M,M,S),M[10]*=u,M}getWorldToCamera(r,u){const y=new Float64Array(16),S=new Float64Array(4),M=this.position;return o.conjugate(S,this._orientation),o.scale$2(M,M,-r),o.fromQuat(y,S),o.translate(y,y,M),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=u,y[9]*=u,y[10]*=u,y[11]*=u,y}getCameraToClipPerspective(r,u,y,S){const M=new Float64Array(16);return o.perspective(M,r,u,y,S),M}getDistanceToElevation(r,u=!1){const y=r===0?0:o.mercatorZfromAltitude(r,u?o.latFromMercatorY(this.position[1]):this.position[1]),S=this.forward();return(y-this.position[2])/S[2]}clone(){return new jl([...this.position],[...this.orientation])}}function Ul(m,r){const u=Bc(m.projection,m.zoom,m.width,m.height),y=function(M,D,O,j,H){const X=new o.LngLat(O.lng-180*sa,O.lat),tt=new o.LngLat(O.lng+180*sa,O.lat),ht=M.project(X.lng,X.lat),pt=M.project(tt.lng,tt.lat),gt=-Math.atan2(pt.y-ht.y,pt.x-ht.x),mt=o.MercatorCoordinate.fromLngLat(O);mt.y=o.clamp(mt.y,-1+sa,1-sa);const xt=mt.toLngLat(),et=M.project(xt.lng,xt.lat),ft=o.MercatorCoordinate.fromLngLat(xt);ft.x+=sa;const St=ft.toLngLat(),Et=M.project(St.lng,St.lat),$t=nr(Et.x-et.x,Et.y-et.y,gt),Rt=o.MercatorCoordinate.fromLngLat(xt);Rt.y+=sa;const Gt=Rt.toLngLat(),Jt=M.project(Gt.lng,Gt.lat),Yt=nr(Jt.x-et.x,Jt.y-et.y,gt),ae=Math.abs($t.x)/Math.abs(Yt.y),ke=o.identity([]);o.rotateZ(ke,ke,-gt*(1-(H?0:j)));const se=o.identity([]);return o.scale(se,se,[1,1-(1-ae)*j,1]),se[4]=-Yt.x/Yt.y*j,o.rotateZ(se,se,gt),o.multiply(se,ke,se),se}(m.projection,0,m.center,u,r),S=Of(m);return o.scale(y,y,[S,S,1]),y}function Of(m){const r=m.projection,u=Bc(m.projection,m.zoom,m.width,m.height),y=Rh(r,m.center),S=Rh(r,o.LngLat.convert(r.center));return Math.pow(2,y*u+(1-u)*S)}function Bc(m,r,u,y,S=1/0){const M=m.range;if(!M)return 0;const D=Math.min(S,Math.max(u,y)),O=Math.log(D/1024)/Math.LN2;return o.smoothstep(M[0]+O,M[1]+O,r)}const sa=1/4e4;function Rh(m,r){const u=o.clamp(r.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),y=new o.LngLat(r.lng-180*sa,u),S=new o.LngLat(r.lng+180*sa,u),M=m.project(y.lng,u),D=m.project(S.lng,u),O=o.MercatorCoordinate.fromLngLat(y),j=o.MercatorCoordinate.fromLngLat(S),H=D.x-M.x,X=D.y-M.y,tt=j.x-O.x,ht=j.y-O.y,pt=Math.sqrt((tt*tt+ht*ht)/(H*H+X*X));return Math.log(pt)/Math.LN2}function nr(m,r,u){const y=Math.cos(u),S=Math.sin(u);return{x:m*y-r*S,y:m*S+r*y}}class ys{constructor(r,u,y,S,M,D,O){this.tileSize=512,this._renderWorldCopies=M===void 0||M,this._minZoom=r||0,this._maxZoom=u||22,this._minPitch=y??0,this._maxPitch=S??60,this.setProjection(D),this.setMaxBounds(O),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Pr,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new jl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new ys(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r,u=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||y)&&this._updateCameraOnTerrain(),(r||y)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const y=!z(u,this.getProjection());return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const u=r!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.Point(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const u=-r*Math.PI/180;var y;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(y=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y),function(S,M,D){var O=M[0],j=M[1],H=M[2],X=M[3],tt=Math.sin(D),ht=Math.cos(D);S[0]=O*ht+H*tt,S[1]=j*ht+X*tt,S[2]=O*-tt+H*ht,S[3]=j*-tt+X*ht}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const u=o.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=o.degToRad(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const u=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let S=0,M=0;for(let D=0;D<u.length;D++){const O=new o.Point(u[D][0]*this.width,y+u[D][1]*(this.height-y)),j=r.pointCoordinate(O);if(!j)continue;const H=1/Math.hypot(j[0]-this._camera.position[0],j[1]-this._camera.position[1]);S+=j[3]*H,M+=H}return M===0?NaN:S/M}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*u,S=this._mercatorZfromZoom(r),M=this._mercatorZfromZoom(this._maxZoom),D=Math.max(S-y,M);this._setZoom(this._zoomFromMercatorZ(D))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let y;y=r.z<this._camera.position[2]?[u.x,u.y,u.z]:[r.x,r.y,r.z];const S=o.length(o.sub([],this._camera.position,y));return o.clamp(this._zoomFromMercatorZ(S),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let u=!1;if(r.orientation&&!o.exactEquals(r.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(r.orientation)),r.position){const y=[r.position.x,r.position.y,r.position.z];o.exactEquals$1(y,this._camera.position)||(this._setCameraPosition(y),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,u=new zf;return u.position=new o.MercatorCoordinate(r[0],r[1],r[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(r){if(!o.length$1(r))return!1;o.normalize$1(r,r);const u=o.transformQuat([],[0,0,-1],r),y=o.transformQuat([],[0,-1,0],r);if(y[2]<0)return!1;const S=Nl(u,y);return!!S&&(this._camera.orientation=S,!0)}_setCameraPosition(r){const u=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,S=this.cameraToCenterDistance;r[2]=o.clamp(r[2],S/y,S/u),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,u,y){this._unmodified=!1,this._edgeInsets.interpolate(r,u,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const u=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(r){const u=[new o.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const y=this.pointCoordinate(new o.Point(0,0)),S=this.pointCoordinate(new o.Point(this.width,0)),M=this.pointCoordinate(new o.Point(this.width,this.height)),D=this.pointCoordinate(new o.Point(0,this.height)),O=Math.floor(Math.min(y.x,S.x,M.x,D.x)),j=Math.floor(Math.max(y.x,S.x,M.x,D.x)),H=1;for(let X=O-H;X<=j+H;X++)X!==0&&u.push(new o.UnwrappedTileID(X,r))}return u}coveringTiles(r){let u=this.coveringZoomLevel(r);const y=u,S=this.elevation&&!r.isTerrainDEM,M=this.projection.name==="mercator";if(r.minzoom!==void 0&&u<r.minzoom)return[];r.maxzoom!==void 0&&u>r.maxzoom&&(u=r.maxzoom);const D=this.locationCoordinate(this.center),O=this.center.lat,j=1<<u,H=[j*D.x,j*D.y,0],X=this.projection.name==="globe",tt=!X,ht=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,tt),pt=X?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),gt=j*o.mercatorZfromAltitude(1,this.center.lat),mt=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),xt=[j*pt.x,j*pt.y,mt*(tt?1:gt)],et=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),ft=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?u:0,St=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Et=r.isTerrainDEM?-St:this._elevation?this._elevation.getMinElevationBelowMSL():0,$t=this.projection.isReprojectedInTileSpace?Of(this):1,Rt=ee=>{const De=new o.MercatorCoordinate(ee.x+25e-6,ee.y,ee.z),ge=new o.MercatorCoordinate(ee.x,ee.y+25e-6,ee.z),Oe=ee.toLngLat(),yi=De.toLngLat(),ki=ge.toLngLat(),ai=this.locationCoordinate(Oe),vi=this.locationCoordinate(yi),Oi=this.locationCoordinate(ki),Ri=Math.hypot(vi.x-ai.x,vi.y-ai.y),mi=Math.hypot(Oi.x-ai.x,Oi.y-ai.y);return Math.sqrt(Ri*mi)*$t/25e-6},Gt=ee=>{const ve=St,De=Et;return{aabb:o.tileAABB(this,j,0,0,0,ee,De,ve,this.projection),zoom:0,x:0,y:0,minZ:De,maxZ:ve,wrap:ee,fullyVisible:!1}},Jt=[];let Yt=[];const ae=u,ke=r.reparseOverscaled?y:u,se=ee=>ee*ee,xe=se((mt-this._centerAltitude)*gt),ue=ee=>{if(!this._elevation||!ee.tileID||!M)return;const ve=this._elevation.getMinMaxForTile(ee.tileID),De=ee.aabb;ve?(De.min[2]=ve.min,De.max[2]=ve.max,De.center[2]=(De.min[2]+De.max[2])/2):(ee.shouldSplit=Ie(ee),ee.shouldSplit||(De.min[2]=De.max[2]=De.center[2]=this._centerAltitude))},Ie=ee=>{if(ee.zoom<ft)return!0;if(ee.zoom===ae)return!1;if(ee.shouldSplit!=null)return ee.shouldSplit;const ve=ee.aabb.distanceX(xt),De=ee.aabb.distanceY(xt);let ge=xe,Oe=1;if(X){ge=se(ee.aabb.distanceZ(xt));const ai=Math.pow(2,ee.zoom),vi=o.latFromMercatorY((ee.y+1)/ai),Oi=o.latFromMercatorY(ee.y/ai),Ri=Math.min(Math.max(O,vi),Oi),mi=o.circumferenceAtLatitude(Ri)/o.circumferenceAtLatitude(O);if(Oe=Ri===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,mi/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&ee.zoom===ae-1&&mi>=.9)return!0}else if(S&&(ge=se(ee.aabb.distanceZ(xt)*gt)),this.projection.isReprojectedInTileSpace&&y<=5){const ai=Math.pow(2,ee.zoom),vi=Rt(new o.MercatorCoordinate((ee.x+.5)/ai,(ee.y+.5)/ai));Oe=vi>.85?1:vi}const yi=ve*ve+De*De+ge,ki=se((1<<ae-ee.zoom)*et*Oe*((ai,vi)=>{if(vi*se(.707)<ai)return 1;const Oi=Math.sqrt(vi/ai);return Oi/(1.4144271570014144+(Math.pow(1.1,Oi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ge,xe),yi));return yi<ki};if(this.renderWorldCopies)for(let ee=1;ee<=3;ee++)Jt.push(Gt(-ee)),Jt.push(Gt(ee));for(Jt.push(Gt(0));Jt.length>0;){const ee=Jt.pop(),ve=ee.x,De=ee.y;let ge=ee.fullyVisible;if(!ge){const Oe=ee.aabb.intersects(ht);if(Oe===0)continue;ge=Oe===2}if(ee.zoom!==ae&&Ie(ee))for(let Oe=0;Oe<4;Oe++){const yi=(ve<<1)+Oe%2,ki=(De<<1)+(Oe>>1),ai={aabb:M?ee.aabb.quadrant(Oe):o.tileAABB(this,j,ee.zoom+1,yi,ki,ee.wrap,ee.minZ,ee.maxZ,this.projection),zoom:ee.zoom+1,x:yi,y:ki,wrap:ee.wrap,fullyVisible:ge,tileID:void 0,shouldSplit:void 0,minZ:ee.minZ,maxZ:ee.maxZ};S&&!X&&(ai.tileID=new o.OverscaledTileID(ee.zoom+1===ae?ke:ee.zoom+1,ee.wrap,ee.zoom+1,yi,ki),ue(ai)),Jt.push(ai)}else{const Oe=ee.zoom===ae?ke:ee.zoom;if(r.minzoom&&r.minzoom>Oe)continue;const yi=H[0]-(.5+ve+(ee.wrap<<ee.zoom))*(1<<u-ee.zoom),ki=H[1]-.5-De,ai=ee.tileID?ee.tileID:new o.OverscaledTileID(Oe,ee.wrap,ee.zoom,ve,De);Yt.push({tileID:ai,distanceSq:yi*yi+ki*ki})}}if(this.fogCullDistSq){const ee=this.fogCullDistSq,ve=this.horizonLineFromTop();Yt=Yt.filter(De=>{const ge=[0,0,0,1],Oe=[o.EXTENT,o.EXTENT,0,1],yi=this.calculateFogTileMatrix(De.tileID.toUnwrapped());o.transformMat4$1(ge,ge,yi),o.transformMat4$1(Oe,Oe,yi);const ki=o.getAABBPointSquareDist(ge,Oe);if(ki===0)return!0;let ai=!1;const vi=this._elevation;if(vi&&ki>ee&&ve!==0){const Oi=this.calculateProjMatrix(De.tileID.toUnwrapped());let Ri;r.isTerrainDEM||(Ri=vi.getMinMaxForTile(De.tileID)),Ri||(Ri={min:Et,max:St});const mi=o.furthestTileCorner(this.rotation),xs=[mi[0]*o.EXTENT,mi[1]*o.EXTENT,Ri.max];o.transformMat4(xs,xs,Oi),ai=(1-xs[1])*this.height*.5<ve}return ki<ee||ai})}return Yt.sort((ee,ve)=>ee.distanceSq-ve.distanceSq).map(ee=>ee.tileID)}resize(r,u){this.width=r,this.height=u,this.pixelsToGLUnits=[2/r,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const u=o.clamp(r.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),y=this.projection.project(r.lng,u);return new o.Point(y.x*this.worldSize,y.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,u){let y,S;const M=this.centerPoint;if(this.projection.name==="globe"){const O=this.worldSize;y=(u.x-M.x)/O,S=(u.y-M.y)/O}else{const O=this.pointCoordinate(u),j=this.pointCoordinate(M);y=O.x-j.x,S=O.y-j.y}const D=this.locationCoordinate(r);this.setLocation(new o.MercatorCoordinate(D.x-y,D.y-S))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,u){const y=u?o.mercatorZfromAltitude(u,r.lat):void 0,S=this.projection.project(r.lng,r.lat);return new o.MercatorCoordinate(S.x,S.y,y)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,u){const y=u??this._centerAltitude,S=[r.x,r.y,0,1],M=[r.x,r.y,1,1];o.transformMat4$1(S,S,this.pixelMatrixInverse),o.transformMat4$1(M,M,this.pixelMatrixInverse);const D=M[3];o.scale$1(S,S,1/S[3]),o.scale$1(M,M,1/D);const O=S[2],j=M[2];return{p0:S,p1:M,t:O===j?0:(y-O)/(j-O)}}screenPointToMercatorRay(r){const u=[r.x,r.y,0,1],y=[r.x,r.y,1,1];return o.transformMat4$1(u,u,this.pixelMatrixInverse),o.transformMat4$1(y,y,this.pixelMatrixInverse),o.scale$1(u,u,1/u[3]),o.scale$1(y,y,1/y[3]),u[2]=o.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,y[2]=o.mercatorZfromAltitude(y[2],this._center.lat)*this.worldSize,o.scale$1(u,u,1/this.worldSize),o.scale$1(y,y,1/this.worldSize),new o.Ray([u[0],u[1],u[2]],o.normalize([],o.sub([],y,u)))}rayIntersectionCoordinate(r){const{p0:u,p1:y,t:S}=r,M=o.mercatorZfromAltitude(u[2],this._center.lat),D=o.mercatorZfromAltitude(y[2],this._center.lat);return new o.MercatorCoordinate(o.number(u[0],y[0],S)/this.worldSize,o.number(u[1],y[1],S)/this.worldSize,o.number(M,D,S))}pointCoordinate(r,u=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,u)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let u=this.projection.pointCoordinate3D(this,r.x,r.y);if(u)return new o.MercatorCoordinate(u[0],u[1],u[2]);let y=0,S=this.horizonLineFromTop();if(r.y>S)return this.pointCoordinate(r);const M=.02*S,D=r.clone();for(let O=0;O<10&&S-y>M;O++){D.y=o.number(y,S,.66);const j=this.projection.pointCoordinate3D(this,D.x,D.y);j?(S=D.y,u=j):y=D.y}return u?new o.MercatorCoordinate(u[0],u[1],u[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(r);const u=this.pointCoordinate(r);return u.y>=0&&u.y<=1}_coordinatePoint(r,u){const y=u&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,S=[r.x*this.worldSize,r.y*this.worldSize,y+r.toAltitude(),1];return o.transformMat4$1(S,S,this.pixelMatrix),S[3]>0?new o.Point(S[0]/S[3],S[1]/S[3]):new o.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:u}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,M=this.pointLocation3D(new o.Point(u,r)),D=this.pointLocation3D(new o.Point(S,r)),O=this.pointLocation3D(new o.Point(S,y)),j=this.pointLocation3D(new o.Point(u,y));let H=Math.min(M.lng,D.lng,O.lng,j.lng),X=Math.max(M.lng,D.lng,O.lng,j.lng),tt=Math.min(M.lat,D.lat,O.lat,j.lat),ht=Math.max(M.lat,D.lat,O.lat,j.lat);const pt=Math.pow(2,-this.zoom)/16*270,gt=this.projection.name==="globe"?1:4,mt=(xt,et,ft,St,Et)=>{const $t=(xt+ft)/2,Rt=(et+St)/2,Gt=new o.Point($t,Rt),{lng:Jt,lat:Yt}=this.pointLocation3D(Gt),ae=Math.max(0,H-Jt,tt-Yt,Jt-X,Yt-ht);H=Math.min(H,Jt),X=Math.max(X,Jt),tt=Math.min(tt,Yt),ht=Math.max(ht,Yt),(Et<gt||ae>pt)&&(mt(xt,et,$t,Rt,Et+1),mt($t,Rt,ft,St,Et+1))};if(mt(u,r,S,r,1),mt(S,r,S,y,1),mt(S,y,u,y,1),mt(u,y,u,r,1),this.projection.name==="globe"){const[xt,et]=o.polesInViewport(this);xt?(ht=90,X=180,H=-180):et&&(tt=-90,X=180,H=-180)}return new o.LngLatBounds(new o.LngLat(H,tt),new o.LngLat(X,ht))}_getBoundsRectangular(r,u){const{top:y,left:S}=this._edgeInsets,M=this.height-this._edgeInsets.bottom,D=this.width-this._edgeInsets.right,O=new o.Point(S,y),j=new o.Point(D,y),H=new o.Point(D,M),X=new o.Point(S,M);let tt=this.pointCoordinate(O,r),ht=this.pointCoordinate(j,r);const pt=this.pointCoordinate(H,u),gt=this.pointCoordinate(X,u),mt=(xt,et)=>(et.y-xt.y)/(et.x-xt.x);return tt.y>1&&ht.y>=0?tt=new o.MercatorCoordinate((1-gt.y)/mt(gt,tt)+gt.x,1):tt.y<0&&ht.y<=1&&(tt=new o.MercatorCoordinate(-gt.y/mt(gt,tt)+gt.x,0)),ht.y>1&&tt.y>=0?ht=new o.MercatorCoordinate((1-pt.y)/mt(pt,ht)+pt.x,1):ht.y<0&&tt.y<=1&&(ht=new o.MercatorCoordinate(-pt.y/mt(pt,ht)+pt.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(tt)).extend(this.coordinateLocation(ht)).extend(this.coordinateLocation(gt)).extend(this.coordinateLocation(pt))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const u=r.visibleDemTiles.reduce((y,S)=>{if(S.dem){const M=S.dem.tree;y.min=Math.min(y.min,M.minimums[0]),y.max=Math.max(y.max,M.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*r.exaggeration(),u.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,y=this.height/2-u*(1-this._horizonShift);return r?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,u){return this.projection.createTileMatrix(this,u,r)}calculateDistanceTileData(r){const u=r.key,y=this._distanceTileDataCache;if(y[u])return y[u];const S=r.canonical,M=1/this.height,D=this.cameraWorldSize,O=D/this.zoomScale(S.z),j=(S.x+Math.pow(2,S.z)*r.wrap)*O,H=S.y*O,X=this.point;X.x*=D/this.worldSize,X.y*=D/this.worldSize;const tt=this.angle,ht=Math.sin(-tt),pt=-Math.cos(-tt);return y[u]={bearing:[ht,pt],center:[(X.x-j)*M,(X.y-H)*M],scale:O/o.EXTENT*M},y[u]}calculateFogTileMatrix(r){const u=r.key,y=this._fogTileMatrixCache;if(y[u])return y[u];const S=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return o.multiply(S,this.worldToFogMatrix,S),y[u]=new Float32Array(S),y[u]}calculateProjMatrix(r,u=!1){const y=r.key,S=u?this._alignedProjMatrixCache:this._projMatrixCache;if(S[y])return S[y];const M=this.calculatePosMatrix(r,this.worldSize);return o.multiply(M,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.alignedProjMatrix:this.projMatrix,M),S[y]=new Float32Array(M),S[y]}calculatePixelsToTileUnitsMatrix(r){const u=r.tileID.key,y=this._pixelsToTileUnitsCache;if(y[u])return y[u];const S=function(M,D){const{scale:O}=M.tileTransform,j=O*o.EXTENT/(M.tileSize*Math.pow(2,D.zoom-M.tileID.overscaledZ+M.tileID.canonical.z));return H=new Float32Array(4),ht=(X=D.inverseAdjustmentMatrix)[1],pt=X[2],gt=X[3],xt=(tt=[j,j])[1],H[0]=X[0]*(mt=tt[0]),H[1]=ht*mt,H[2]=pt*xt,H[3]=gt*xt,H;var H,X,tt,ht,pt,gt,mt,xt}(r,this);return y[u]=S,y[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,u=o.fromScaling([],[r,r,r]);return o.multiply(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const u=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(u),S=this._camera.forward(),M=o.mercatorZfromAltitude(1,this._center.lat);y[2]/=M,S[2]/=M,o.normalize(S,S);const D=r.raycast(y,S,r.exaggeration());if(D){const O=o.scaleAndAdd([],y,S,D),j=new o.MercatorCoordinate(O[0],O[1],o.mercatorZfromAltitude(O[2],o.latFromMercatorY(O[1]))),H=(j.z+o.length([j.x-y[0],j.y-y[1],j.z-y[2]*M]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(H),this._centerAltitude=j.toAltitude(),this._center=this.coordinateLocation(j),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const u=this._elevation,y=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,S=this._computeCameraPosition(y),M=u.getAtPointOrZero(new o.MercatorCoordinate(...S)),D=this.pixelsPerMeter/this.worldSize*M,O=this._minimumHeightOverTerrain(),j=S[2]-D;if(j<=O)if(j<0||r){const H=this.locationCoordinate(this._center,this._centerAltitude),X=[S[0],S[1],H.z-S[2]],tt=o.length(X);X[2]-=(O-j)/this._pixelsPerMercatorPixel;const ht=o.length(X);if(ht===0)return;o.scale$2(X,X,tt/ht*this._pixelsPerMercatorPixel),this._camera.position=[S[0],S[1],H.z*this._pixelsPerMercatorPixel-X[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const ht=this.center;return ht.lat=o.clamp(ht.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(ht.lng=o.clamp(ht.lng,this.minLng,this.maxLng)),this.center=ht,void(this._constraining=!1)}const u=this._unmodified,{x:y,y:S}=this.point;let M=0,D=y,O=S;const j=this.width/2,H=this.height/2,X=this.worldMinY*this.scale,tt=this.worldMaxY*this.scale;if(S-H<X&&(O=X+H),S+H>tt&&(O=tt-H),tt-X<this.height&&(M=Math.max(M,this.height/(tt-X)),O=(tt+X)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ht=this.worldMinX*this.scale,pt=this.worldMaxX*this.scale,gt=this.worldSize/2-(ht+pt)/2;D=(y+gt+this.worldSize)%this.worldSize-gt,D-j<ht&&(D=ht+j),D+j>pt&&(D=pt-j),pt-ht<this.width&&(M=Math.max(M,this.width/(pt-ht)),D=(pt+ht)/2)}D===y&&O===S||(this.center=this.unproject(new o.Point(D,O))),M&&(this.zoom+=this.scaleZoom(M)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const y=Bc(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const S=this.projection.zAxisUnit==="meters"?u:1,M=this._camera.getWorldToCamera(this.worldSize,S),D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);D[8]=2*-r.x/this.width,D[9]=2*r.y/this.height;let O=o.mul([],D,M);if(this.projection.isReprojectedInTileSpace){const Rt=this.locationCoordinate(this.center),Gt=o.identity([]);o.translate(Gt,Gt,[Rt.x*this.worldSize,Rt.y*this.worldSize,0]),o.multiply(Gt,Gt,Ul(this)),o.translate(Gt,Gt,[-Rt.x*this.worldSize,-Rt.y*this.worldSize,0]),o.multiply(O,O,Gt),this.inverseAdjustmentMatrix=function(Jt){const Yt=Ul(Jt,!0);return Ut([],[Yt[0],Yt[1],Yt[4],Yt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],O,[this.worldSize,this.worldSize,this.worldSize/S,1]),this.projMatrix=O,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const j=o.invert([],D);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(j,this.horizonLineFromTop(),this.height);const H=new Float32Array(16);o.identity(H),o.scale(H,H,[1,-1,1]),o.rotateX(H,H,this._pitch),o.rotateZ(H,H,this.angle);const X=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),tt=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;X[8]=2*-r.x/this.width,X[9]=2*(r.y+tt)/this.height,this.skyboxMatrix=o.multiply(H,X,H);const ht=this.point,pt=ht.x,gt=ht.y,mt=this.width%2/2,xt=this.height%2/2,et=Math.cos(this.angle),ft=Math.sin(this.angle),St=pt-Math.round(pt)+et*mt+ft*xt,Et=gt-Math.round(gt)+et*xt+ft*mt,$t=new Float64Array(O);if(o.translate($t,$t,[St>.5?St-1:St,Et>.5?Et-1:Et,0]),this.alignedProjMatrix=$t,O=o.create(),o.scale(O,O,[this.width/2,-this.height/2,1]),o.translate(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=o.create(),o.scale(O,O,[1,-1,1]),o.translate(O,O,[-1,-1,0]),o.scale(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},O=o.invert(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const Rt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(Rt,Rt,M),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,y=this._camera.position,S=1/this.height/this._pixelsPerMercatorPixel,M=[r,r,u];o.scale$2(M,M,S),o.scale$2(y,y,-1),o.multiply$2(y,y,M);const D=o.create();o.translate(D,D,y),o.scale(D,D,M),this.mercatorFogMatrix=D,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,u,S)}_computeCameraPosition(r){const u=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),S=this.point,M=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-r/this.worldSize*this._centerAltitude;return[S.x/this.worldSize-y[0]*M,S.y/this.worldSize-y[1]*M,r/this.worldSize*this._centerAltitude-y[2]*M]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],S=r[2];let M=1;this.projection.wrap&&(this.center=this.center.wrap()),S>0&&(M=Math.min((u-y)/S,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,r,M),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,u=this._camera.forward(),{pitch:y,bearing:S}=this._camera.getPitchBearing(),M=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,D=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),O=Math.max((r[2]-M)/Math.cos(y),D),j=this._zoomFromMercatorZ(O);o.scaleAndAdd(r,r,u,O),this._pitch=o.clamp(y,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(S,-Math.PI,Math.PI),this._setZoom(o.clamp(j,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let u=0,y=o.GLOBE_ZOOM_THRESHOLD_MAX,S=0,M=1/0;for(;y-u>1e-6&&y>u;){const D=u+.5*(y-u),O=this.tileSize*Math.pow(2,D),j=this.getCameraToCenterDistance(this.projection,D,O),H=this.scaleZoom(j/(r*this.tileSize)),X=Math.abs(D-H);X<M&&(M=X,S=D),D<H?u=D:y=D}return S}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,u){const y=Math.min(r.x,u.x),S=Math.max(r.x,u.x),M=Math.min(r.y,u.y),D=Math.max(r.y,u.y);if(M<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const O=[new o.Point(y,M),new o.Point(S,D),new o.Point(y,D),new o.Point(S,M)],j=this.renderWorldCopies?-3:0,H=this.renderWorldCopies?4:1;for(const X of O){const tt=this.pointRayIntersection(X);if(tt.t<0)return!0;const ht=this.rayIntersectionCoordinate(tt);if(ht.x<j||ht.y<0||ht.x>H||ht.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.Point(0,0),new o.Point(this.width,this.height))}zoomDeltaToMovement(r,u){const y=o.length(o.sub([],this._camera.position,r)),S=this._zoomFromMercatorZ(y)+u;return y-this._mercatorZfromZoom(S)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([u,y,S],M){const D=[u,y,S,1];o.transformMat4$1(D,D,M);const O=D[3]=Math.max(D[3],1e-6);return D[0]/=O,D[1]/=O,D[2]/=O,D}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.Point(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,r))}}getCameraToCenterDistance(r,u=this.zoom,y=this.worldSize){const S=Bc(r,u,this.width,this.height,1024),M=r.pixelSpaceConversion(this.center.lat,y,S);return .5/Math.tan(.5*this._fov)*this.height*M}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.multiply(r,r,this.globeMatrix),r}}function Vl(m,r){let u=!1,y=null;const S=()=>{y=null,u&&(m(),y=setTimeout(S,r),u=!1)};return()=>(u=!0,y||S(),y)}class Bh{constructor(r){this._hashName=r&&encodeURIComponent(r),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Vl(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,o.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const u=sl(r);if(this._hashName){const y=this._hashName;let S=!1;const M=o.window.location.hash.slice(1).split("&").map(D=>{const O=D.split("=")[0];return O===y?(S=!0,`${O}=${u}`):D}).filter(D=>D);return S||M.push(`${y}=${u}`),`#${M.join("&")}`}return`#${u}`}_getCurrentHash(){const r=o.window.location.hash.replace("#","");if(this._hashName){let u;return r.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(u=y)}),(u&&u[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(y=>isNaN(y))){const y=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(u[3]||0):r.getBearing();return r.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:y,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,r)}}function sl(m,r){const u=m.getCenter(),y=Math.round(100*m.getZoom())/100,S=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),M=Math.pow(10,S),D=Math.round(u.lng*M)/M,O=Math.round(u.lat*M)/M,j=m.getBearing(),H=m.getPitch();let X=r?`/${D}/${O}/${y}`:`${y}/${O}/${D}`;return(j||H)&&(X+="/"+Math.round(10*j)/10),H&&(X+=`/${Math.round(H)}`),X}const wa={linearity:.3,easing:o.bezier(0,0,.3,1)},js=o.extend({deceleration:2500,maxSpeed:1400},wa),Fc=o.extend({deceleration:20,maxSpeed:1400},wa),ii=o.extend({deceleration:1e3,maxSpeed:360},wa),jr=o.extend({deceleration:1e3,maxSpeed:90},wa);class Ai{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,u=o.exported.now();for(;r.length>0&&u-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const u={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:M}of this._inertiaBuffer)u.zoom+=M.zoomDelta||0,u.bearing+=M.bearingDelta||0,u.pitch+=M.pitchDelta||0,M.panDelta&&u.pan._add(M.panDelta),M.around&&(u.around=M.around),M.pinchAround&&(u.pinchAround=M.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,S={};if(u.pan.mag()){const M=Ta(u.pan.mag(),y,o.extend({},js,r||{}));S.offset=u.pan.mult(M.amount/u.pan.mag()),S.center=this._map.transform.center,$l(S,M)}if(u.zoom){const M=Ta(u.zoom,y,Fc);S.zoom=this._map.transform.zoom+M.amount,$l(S,M)}if(u.bearing){const M=Ta(u.bearing,y,ii);S.bearing=this._map.transform.bearing+o.clamp(M.amount,-179,179),$l(S,M)}if(u.pitch){const M=Ta(u.pitch,y,jr);S.pitch=this._map.transform.pitch+M.amount,$l(S,M)}if(S.zoom||S.bearing){const M=u.pinchAround===void 0?u.around:u.pinchAround;S.around=M?this._map.unproject(M):this._map.getCenter()}return this.clear(),S.noMoveStart=!0,S}}function $l(m,r){(!m.duration||m.duration<r.duration)&&(m.duration=r.duration,m.easing=r.easing)}function Ta(m,r,u){const{maxSpeed:y,linearity:S,deceleration:M}=u,D=o.clamp(m*S/(r/1e3),-y,y),O=Math.abs(D)/(M*S);return{easing:u.easing,duration:1e3*O,amount:D*(O/2)}}class Xn extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,y,S={}){const M=Zt(u.getCanvasContainer(),y),D=u.unproject(M);super(r,o.extend({point:M,lngLat:D,originalEvent:y},S)),this._defaultPrevented=!1,this.target=u}}class Sa extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,y){const S=r==="touchend"?y.changedTouches:y.touches,M=re(u.getCanvasContainer(),S),D=M.map(j=>u.unproject(j)),O=M.reduce((j,H,X,tt)=>j.add(H.div(tt.length)),new o.Point(0,0));super(r,{points:M,point:O,lngLats:D,lngLat:u.unproject(O),originalEvent:y}),this._defaultPrevented=!1}}class Hi extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,y){super(r,{originalEvent:y}),this._defaultPrevented=!1}}class Gl{constructor(r,u){this._map=r,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Hi(r.type,this._map,r))}mousedown(r,u){return this._mousedownPos=u,this._firePreventable(new Xn(r.type,this._map,r))}mouseup(r){this._map.fire(new Xn(r.type,this._map,r))}preclick(r){const u=o.extend({},r);u.type="preclick",this._map.fire(new Xn(u.type,this._map,u))}click(r,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Xn(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Xn(r.type,this._map,r))}mouseover(r){this._map.fire(new Xn(r.type,this._map,r))}mouseout(r){this._map.fire(new Xn(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Sa(r.type,this._map,r))}touchmove(r){this._map.fire(new Sa(r.type,this._map,r))}touchend(r){this._map.fire(new Sa(r.type,this._map,r))}touchcancel(r){this._map.fire(new Sa(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fh{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Xn(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Xn(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rf{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,u){this.isEnabled()&&r.shiftKey&&r.button===0&&(Dt(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(r,u){if(!this._active)return;const y=u,S=this._startPos,M=this._lastPos;if(!S||!M||M.equals(y)||!this._box&&y.dist(S)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=nt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const D=Math.min(S.x,y.x),O=Math.max(S.x,y.x),j=Math.min(S.y,y.y),H=Math.max(S.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${D}px,${j}px)`,this._box.style.width=O-D+"px",this._box.style.height=H-j+"px")})}mouseupWindow(r,u){if(!this._active)return;const y=this._startPos,S=u;if(y&&r.button===0){if(this.reset(),Xt(),y.x!==S.x||y.y!==S.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:M=>M.fitScreenCoordinates(y,S,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),wt(),delete this._startPos,delete this._lastPos}_fireEvent(r,u){return this._map.fire(new o.Event(r,{originalEvent:u}))}}function Nh(m,r){const u={};for(let y=0;y<m.length;y++)u[m[y].identifier]=r[y];return u}class nl{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,u,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),y.length===this.numTouches&&(this.centroid=function(S){const M=new o.Point(0,0);for(const D of S)M._add(D);return M.div(S.length)}(u),this.touches=Nh(y,u)))}touchmove(r,u,y){if(this.aborted||!this.centroid)return;const S=Nh(y,u);for(const M in this.touches){const D=S[M];(!D||D.dist(this.touches[M])>30)&&(this.aborted=!0)}}touchend(r,u,y){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const S=!this.aborted&&this.centroid;if(this.reset(),S)return S}}}class Ea{constructor(r){this.singleTap=new nl(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,u,y){this.singleTap.touchstart(r,u,y)}touchmove(r,u,y){this.singleTap.touchmove(r,u,y)}touchend(r,u,y){const S=this.singleTap.touchend(r,u,y);if(S){const M=r.timeStamp-this.lastTime<500,D=!this.lastTap||this.lastTap.dist(S)<30;if(M&&D||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=S,this.count===this.numTaps)return this.reset(),S}}}class _m{constructor(){this._zoomIn=new Ea({numTouches:1,numTaps:2}),this._zoomOut=new Ea({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,u,y){this._zoomIn.touchstart(r,u,y),this._zoomOut.touchstart(r,u,y)}touchmove(r,u,y){this._zoomIn.touchmove(r,u,y),this._zoomOut.touchmove(r,u,y)}touchend(r,u,y){const S=this._zoomIn.touchend(r,u,y),M=this._zoomOut.touchend(r,u,y);return S?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()+1,around:D.unproject(S)},{originalEvent:r})}):M?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()-1,around:D.unproject(M)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Bf={0:1,2:2};class Wl{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,u){return!1}_move(r,u){return{}}mousedown(r,u){if(this._lastPoint)return;const y=kt(r);this._correctButton(r,y)&&(this._lastPoint=u,this._eventButton=y)}mousemoveWindow(r,u){const y=this._lastPoint;if(y){if(r.preventDefault(),this._eventButton!=null&&function(S,M){const D=Bf[M];return S.buttons===void 0||(S.buttons&D)!==D}(r,this._eventButton))this.reset();else if(this._moved||!(u.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(y,u)}}mouseupWindow(r){this._lastPoint&&kt(r)===this._eventButton&&(this._moved&&Xt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hl extends Wl{mousedown(r,u){super.mousedown(r,u),this._lastPoint&&(this._active=!0)}_correctButton(r,u){return u===0&&!r.ctrlKey}_move(r,u){return{around:u,panDelta:u.sub(r)}}}class ad extends Wl{_correctButton(r,u){return u===0&&r.ctrlKey||u===2}_move(r,u){const y=.8*(u.x-r.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(r){r.preventDefault()}}class jh extends Wl{_correctButton(r,u){return u===0&&r.ctrlKey||u===2}_move(r,u){const y=-.5*(u.y-r.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(r){r.preventDefault()}}class Uh{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.Point(0,0)}touchstart(r,u,y){return this._calculateTransform(r,u,y)}touchmove(r,u,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(y.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,u,y)}}touchend(r,u,y){this._calculateTransform(r,u,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,u,y){y.length>0&&(this._active=!0);const S=Nh(y,u),M=new o.Point(0,0),D=new o.Point(0,0);let O=0;for(const H in S){const X=S[H],tt=this._touches[H];tt&&(M._add(X),D._add(X.sub(tt)),O++,S[H]=X)}if(this._touches=S,O<this._minTouches||!D.mag())return;const j=D.div(O);return this._sum._add(j),this._sum.mag()<this._clickTolerance?void 0:{around:M.div(O),panDelta:j}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=nt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Nc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,u,y){return{}}touchstart(r,u,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([u[0],u[1]]))}touchmove(r,u,y){const S=this._firstTwoTouches;if(!S)return;r.preventDefault();const[M,D]=S,O=jc(y,u,M),j=jc(y,u,D);if(!O||!j)return;const H=this._aroundCenter?null:O.add(j).div(2);return this._move([O,j],H,r)}touchend(r,u,y){if(!this._firstTwoTouches)return;const[S,M]=this._firstTwoTouches,D=jc(y,u,S),O=jc(y,u,M);D&&O||(this._active&&Xt(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function jc(m,r,u){for(let y=0;y<m.length;y++)if(m[y].identifier===u)return r[y]}function ld(m,r){return Math.log(m/r)/Math.LN2}class Ff extends Nc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,u){const y=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(ld(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ld(this._distance,y),pinchAround:u}}}function Vh(m,r){return 180*m.angleWith(r)/Math.PI}class Nf extends Nc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,u){const y=this._vector;if(this._vector=r[0].sub(r[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Vh(this._vector,y),pinchAround:u}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const u=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const S=Vh(r,y);return Math.abs(S)<u}}function Ma(m){return Math.abs(m.y)>Math.abs(m.x)}class cd extends Nc{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Ma(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,u,y){const S=this._lastPoints;if(!S)return;const M=r[0].sub(S[0]),D=r[1].sub(S[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(M,D,y.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(M.y+D.y)/2*-.5})}gestureBeginsVertically(r,u,y){if(this._valid!==void 0)return this._valid;const S=r.mag()>=2,M=u.mag()>=2;if(!S&&!M)return;if(!S||!M)return this._firstMove==null&&(this._firstMove=y),y-this._firstMove<100&&void 0;const D=r.y>0==u.y>0;return Ma(r)&&Ma(u)&&D}}const hd={panStep:100,bearingStep:15,pitchStep:10};class Io{constructor(){const r=hd;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let u=0,y=0,S=0,M=0,D=0;switch(r.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:r.shiftKey?y=-1:(r.preventDefault(),M=-1);break;case 39:r.shiftKey?y=1:(r.preventDefault(),M=1);break;case 38:r.shiftKey?S=1:(r.preventDefault(),D=-1);break;case 40:r.shiftKey?S=-1:(r.preventDefault(),D=1);break;default:return}return this._rotationDisabled&&(y=0,S=0),{cameraAnimation:O=>{const j=O.getZoom();O.easeTo({duration:300,easeId:"keyboardHandler",easing:jf,zoom:u?Math.round(j)+u*(r.shiftKey?2:1):j,bearing:O.getBearing()+y*this._bearingStep,pitch:O.getPitch()+S*this._pitchStep,offset:[-M*this._panStep,-D*this._panStep],center:O.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function jf(m){return m*(2-m)}const ud=4.000244140625;class Uf{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=r.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const y=o.exported.now(),S=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,u!==0&&u%ud==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":S>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(S*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),r.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=r,this._delta-=u,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=Zt(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const u=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const j=this._type==="wheel"&&Math.abs(this._delta)>ud?this._wheelZoomRate:this._defaultZoomRate;let H=2/(1+Math.exp(-Math.abs(this._delta*j)));this._delta<0&&H!==0&&(H=1/H);const X=u(),tt=Math.pow(2,X),ht=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):tt;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(ht*H))),this._type==="wheel"&&(this._startZoom=X,this._easing=this._smoothOutEasing(200)),this._delta=0}const y=typeof this._targetZoom=="number"?this._targetZoom:u(),S=this._startZoom,M=this._easing;let D,O=!1;if(this._type==="wheel"&&S&&M){const j=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),H=M(j);D=o.number(S,y,H),j<1?this._frameId||(this._frameId=!0):O=!0}else D=y,O=!0;return this._active=!0,O&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!O,zoomDelta:D-u(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let u=o.ease;if(this._prevEase){const y=this._prevEase,S=(o.exported.now()-y.start)/y.duration,M=y.easing(S+.01)-y.easing(S),D=.27/Math.sqrt(M*M+1e-4)*.01,O=Math.sqrt(.0729-D*D);u=o.bezier(D,O,.25,1)}return this._prevEase={start:o.exported.now(),duration:r,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=nt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class dd{constructor(r,u){this._clickZoom=r,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class rr{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,u){return r.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(r.shiftKey?-1:1),around:y.unproject(u)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ym{constructor(){this._tap=new Ea({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,u,y){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=u[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(r,u,y))}touchmove(r,u,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const S=u[0],M=S.y-this._swipePoint.y;return this._swipePoint=S,r.preventDefault(),this._active=!0,{zoomDelta:M/128}}}else this._tap.touchmove(r,u,y)}touchend(r,u,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():this._tap.touchend(r,u,y)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uc{constructor(r,u,y){this._el=r,this._mousePan=u,this._touchPan=y}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class xm{constructor(r,u,y){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=u,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Vf{constructor(r,u,y,S){this._el=r,this._touchZoom=u,this._touchRotate=y,this._tapDragZoom=S,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ur=m=>m.zoom||m.drag||m.pitch||m.rotate;class $f extends o.Event{}class Gf{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,u){const y=o.sub([],u,r);this.radius=o.length(y[2]<0?o.div([],y,this.constants):[y[0],y[1],0])}projectRay(r){o.div(r,r,this.constants),o.normalize(r,r),o.mul$1(r,r,this.constants);const u=o.scale$2([],r,this.radius);if(u[2]>0){const y=o.scale$2([],[0,0,1],o.dot(u,[0,0,1])),S=o.scale$2([],o.normalize([],[u[0],u[1],0]),this.radius),M=o.add([],u,o.scale$2([],o.sub([],o.add([],S,y),u),2));u[0]=M[0],u[1]=M[1]}return u}}function lo(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Lo{constructor(r,u){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ai(r),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Gf,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),o.bindAll(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[S,M,D]of this._listeners)S.addEventListener(M,S===o.window.document?this.handleWindowEvent:this.handleEvent,D)}destroy(){for(const[r,u,y]of this._listeners)r.removeEventListener(u,r===o.window.document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(r){const u=this._map,y=u.getCanvasContainer();this._add("mapEvent",new Gl(u,r));const S=u.boxZoom=new Rf(u,r);this._add("boxZoom",S);const M=new _m,D=new rr;u.doubleClickZoom=new dd(D,M),this._add("tapZoom",M),this._add("clickZoom",D);const O=new ym;this._add("tapDragZoom",O);const j=u.touchPitch=new cd(u);this._add("touchPitch",j);const H=new ad(r),X=new jh(r);u.dragRotate=new xm(r,H,X),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]);const tt=new Hl(r),ht=new Uh(u,r);u.dragPan=new Uc(y,tt,ht),this._add("mousePan",tt),this._add("touchPan",ht,["touchZoom","touchRotate"]);const pt=new Nf,gt=new Ff;u.touchZoomRotate=new Vf(y,gt,pt,O),this._add("touchRotate",pt,["touchPan","touchZoom"]),this._add("touchZoom",gt,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Fh(u));const mt=u.scrollZoom=new Uf(u,this);this._add("scrollZoom",mt,["mousePan"]);const xt=u.keyboard=new Io;this._add("keyboard",xt);for(const et of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[et]&&u[et].enable(r[et])}_add(r,u,y){this._handlers.push({handlerName:r,handler:u,allowed:y}),this._handlersById[r]=u}stop(r){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ur(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,u,y){for(const S in r)if(S!==y&&(!u||u.indexOf(S)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const u=[];for(const y of r)this._el.contains(y.target)&&u.push(y);return u}handleEvent(r,u){this._updatingCamera=!0;const y=r.type==="renderFrame",S=y?void 0:r,M={needsRenderFrame:!1},D={},O={},j=r.touches?this._getMapTouches(r.touches):void 0,H=j?re(this._el,j):y?void 0:Zt(this._el,r);for(const{handlerName:ht,handler:pt,allowed:gt}of this._handlers){if(!pt.isEnabled())continue;let mt;this._blockedByActive(O,gt,ht)?pt.reset():pt[u||r.type]&&(mt=pt[u||r.type](r,H,j),this.mergeHandlerResult(M,D,mt,ht,S),mt&&mt.needsRenderFrame&&this._triggerRenderFrame()),(mt||pt.isActive())&&(O[ht]=pt)}const X={};for(const ht in this._previousActiveHandlers)O[ht]||(X[ht]=S);this._previousActiveHandlers=O,(Object.keys(X).length||lo(M))&&(this._changes.push([M,D,X]),this._triggerRenderFrame()),(Object.keys(O).length||lo(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:tt}=M;tt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],tt(this._map))}mergeHandlerResult(r,u,y,S,M){if(!y)return;o.extend(r,y);const D={handlerName:S,originalEvent:y.originalEvent||M};y.zoomDelta!==void 0&&(u.zoom=D),y.panDelta!==void 0&&(u.drag=D),y.pitchDelta!==void 0&&(u.pitch=D),y.bearingDelta!==void 0&&(u.rotate=D)}_applyChanges(){const r={},u={},y={};for(const[S,M,D]of this._changes)S.panDelta&&(r.panDelta=(r.panDelta||new o.Point(0,0))._add(S.panDelta)),S.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+S.zoomDelta),S.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+S.bearingDelta),S.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+S.pitchDelta),S.around!==void 0&&(r.around=S.around),S.aroundCoord!==void 0&&(r.aroundCoord=S.aroundCoord),S.pinchAround!==void 0&&(r.pinchAround=S.pinchAround),S.noInertia&&(r.noInertia=S.noInertia),o.extend(u,M),o.extend(y,D);this._updateMapTransform(r,u,y),this._changes=[]}_updateMapTransform(r,u,y){const S=this._map,M=S.transform,D=ft=>[ft.x,ft.y,ft.z];if((ft=>{const St=this._eventsInProgress.drag;return St&&!this._handlersById[St.handlerName].isActive()})()&&!lo(r)){const ft=M.zoom;M.cameraElevationReference="sea",M.recenterOnTerrain(),M.cameraElevationReference="ground",ft!==M.zoom&&this._map._update(!0)}if(M._isCameraConstrained&&S._stop(!0),!lo(r))return void this._fireEvents(u,y,!0);let{panDelta:O,zoomDelta:j,bearingDelta:H,pitchDelta:X,around:tt,aroundCoord:ht,pinchAround:pt}=r;M._isCameraConstrained&&(j>0&&(j=0),M._isCameraConstrained=!1),pt!==void 0&&(tt=pt),(j||(ft=>u[ft]&&!this._eventsInProgress[ft])("drag"))&&tt&&(this._dragOrigin=D(M.pointCoordinate3D(tt)),this._trackingEllipsoid.setup(M._camera.position,this._dragOrigin)),M.cameraElevationReference="sea",S._stop(!0),tt=tt||S.transform.centerPoint,H&&(M.bearing+=H),X&&(M.pitch+=X),M._updateCameraState();const gt=[0,0,0];if(O)if(M.projection.name==="mercator"){const ft=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(tt).dir),St=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(tt.sub(O)).dir);gt[0]=St[0]-ft[0],gt[1]=St[1]-ft[1]}else{const ft=M.pointCoordinate(tt);if(M.projection.name==="globe"){O=O.rotate(-M.angle);const St=M._pixelsPerMercatorPixel/M.worldSize;gt[0]=-O.x*o.mercatorScale(o.latFromMercatorY(ft.y))*St,gt[1]=-O.y*o.mercatorScale(M.center.lat)*St}else{const St=M.pointCoordinate(tt.sub(O));ft&&St&&(gt[0]=St.x-ft.x,gt[1]=St.y-ft.y)}}const mt=M.zoom,xt=[0,0,0];if(j){const ft=D(ht||M.pointCoordinate3D(tt)),St={dir:o.normalize([],o.sub([],ft,M._camera.position))};if(St.dir[2]<0){const Et=M.zoomDeltaToMovement(ft,j);o.scale$2(xt,St.dir,Et)}}const et=o.add(gt,gt,xt);M._translateCameraConstrained(et),j&&Math.abs(M.zoom-mt)>1e-4&&M.recenterOnTerrain(),M.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(u,y,!0)}_fireEvents(r,u,y){const S=Ur(this._eventsInProgress),M=Ur(r),D={};for(const X in r){const{originalEvent:tt}=r[X];this._eventsInProgress[X]||(D[`${X}start`]=tt),this._eventsInProgress[X]=r[X]}!S&&M&&this._fireEvent("movestart",M.originalEvent);for(const X in D)this._fireEvent(X,D[X]);M&&this._fireEvent("move",M.originalEvent);for(const X in r){const{originalEvent:tt}=r[X];this._fireEvent(X,tt)}const O={};let j;for(const X in this._eventsInProgress){const{handlerName:tt,originalEvent:ht}=this._eventsInProgress[X];this._handlersById[tt].isActive()||(delete this._eventsInProgress[X],j=u[tt]||ht,O[`${X}end`]=j)}for(const X in O)this._fireEvent(X,O[X]);const H=Ur(this._eventsInProgress);if(y&&(S||M)&&!H){this._updatingCamera=!0;const X=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),tt=ht=>ht!==0&&-this._bearingSnap<ht&&ht<this._bearingSnap;X?(tt(X.bearing||this._map.getBearing())&&(X.bearing=0),this._map.easeTo(X,{originalEvent:j})):(this._map.fire(new o.Event("moveend",{originalEvent:j})),tt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,u){this._map.fire(new o.Event(r,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new $f("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const rl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class na extends o.Evented{constructor(r,u){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=u.respectPrefersReducedMotion!==!1,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,u){return this.jumpTo({center:r},u)}panBy(r,u,y){return r=o.Point.convert(r).mult(-1),this.panTo(this.transform.center,o.extend({offset:r},u),y)}panTo(r,u,y){return this.easeTo(o.extend({center:r},u),y)}getZoom(){return this.transform.zoom}setZoom(r,u){return this.jumpTo({zoom:r},u),this}zoomTo(r,u,y){return this.easeTo(o.extend({zoom:r},u),y)}zoomIn(r,u){return this.zoomTo(this.getZoom()+1,r,u),this}zoomOut(r,u){return this.zoomTo(this.getZoom()-1,r,u),this}getBearing(){return this.transform.bearing}setBearing(r,u){return this.jumpTo({bearing:r},u),this}getPadding(){return this.transform.padding}setPadding(r,u){return this.jumpTo({padding:r},u),this}rotateTo(r,u,y){return this.easeTo(o.extend({bearing:r},u),y)}resetNorth(r,u){return this.rotateTo(0,o.extend({duration:1e3},r),u),this}resetNorthPitch(r,u){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},r),u),this}snapToNorth(r,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,u):this}getPitch(){return this.transform.pitch}setPitch(r,u){return this.jumpTo({pitch:r},u),this}cameraForBounds(r,u){r=o.LngLatBounds.convert(r);const y=u&&u.bearing||0,S=u&&u.pitch||0,M=r.getNorthWest(),D=r.getSouthEast();return this._cameraForBounds(this.transform,M,D,y,S,u)}_extendCameraOptions(r){const u={top:0,bottom:0,right:0,left:0};if(typeof(r=o.extend({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){const y=r.padding;r.padding={top:y,bottom:y,right:y,left:y}}return r.padding=o.extend(u,r.padding),r}_minimumAABBFrustumDistance(r,u){const y=u.max[0]-u.min[0],S=u.max[1]-u.min[1];return y/S>r.aspect?y/(2*Math.tan(.5*r.fovX)*r.aspect):S/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,u,y,S,M,D){const O=r.clone(),j=this._extendCameraOptions(D);O.bearing=S,O.pitch=M;const H=o.LngLat.convert(u),X=o.LngLat.convert(y),tt=.5*(H.lat+X.lat),ht=.5*(H.lng+X.lng),pt=o.latLngToECEF(tt,ht),gt=o.normalize([],pt),mt=o.normalize([],o.cross([],gt,[0,1,0])),xt=o.cross([],mt,gt),et=[mt[0],mt[1],mt[2],0,xt[0],xt[1],xt[2],0,gt[0],gt[1],gt[2],0,0,0,0,1],ft=[pt,o.latLngToECEF(H.lat,H.lng),o.latLngToECEF(X.lat,H.lng),o.latLngToECEF(X.lat,X.lng),o.latLngToECEF(H.lat,X.lng),o.latLngToECEF(tt,H.lng),o.latLngToECEF(tt,X.lng),o.latLngToECEF(H.lat,ht),o.latLngToECEF(X.lat,ht)];let St=o.Aabb.fromPoints(ft.map(ge=>[o.dot(mt,ge),o.dot(xt,ge),o.dot(gt,ge)]));const Et=o.transformMat4([],St.center,et);o.squaredLength(Et)===0&&o.set(Et,0,0,1),o.normalize(Et,Et),o.scale$2(Et,Et,o.GLOBE_RADIUS),O.center=o.ecefToLatLng(Et);const $t=O.getWorldToCameraMatrix(),Rt=o.invert(new Float64Array(16),$t);St=o.Aabb.applyTransform(St,o.multiply([],$t,et)),o.transformMat4(Et,Et,$t);const Gt=.5*(St.max[2]-St.min[2]),Jt=this._minimumAABBFrustumDistance(O,St),Yt=o.scale$2([],[0,0,1],Gt),ae=o.add(Yt,Et,Yt),ke=Jt+(O.pitch===0?0:o.distance(Et,ae)),se=O.globeCenterInViewSpace,xe=o.sub([],Et,[se[0],se[1],se[2]]);o.normalize(xe,xe),o.scale$2(xe,xe,ke);const ue=o.add([],Et,xe);o.transformMat4(ue,ue,Rt);const Ie=o.earthRadius/o.GLOBE_RADIUS,ee=o.length(ue),ve=o.mercatorZfromAltitude(Math.max(ee*Ie-o.earthRadius,Number.EPSILON),0),De=Math.min(O.zoomFromMercatorZAdjusted(ve),j.maxZoom);return De>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(O.setProjection({name:"mercator"}),O.zoom=De,this._cameraForBounds(O,u,y,S,M,D)):{center:O.center,zoom:De,bearing:S,pitch:M}}queryTerrainElevation(r,u){const y=this.transform.elevation;return y?(u=o.extend({},{exaggerated:!0},u),y.getAtPoint(o.MercatorCoordinate.fromLngLat(r),null,u.exaggerated)):null}_cameraForBounds(r,u,y,S,M,D){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,u,y,S,M,D);const O=r.clone(),j=this._extendCameraOptions(D),H=O.padding;O.bearing=S,O.pitch=M;const X=o.LngLat.convert(u),tt=o.LngLat.convert(y),ht=new o.LngLat(X.lng,tt.lat),pt=new o.LngLat(tt.lng,X.lat),gt=O.project(X),mt=O.project(tt),xt=this.queryTerrainElevation(X),et=this.queryTerrainElevation(tt),ft=this.queryTerrainElevation(ht),St=this.queryTerrainElevation(pt),Et=[[gt.x,gt.y,Math.min(xt||0,et||0,ft||0,St||0)],[mt.x,mt.y,Math.max(xt||0,et||0,ft||0,St||0)]];let $t=o.Aabb.fromPoints(Et);const Rt=O.getWorldToCameraMatrix(),Gt=o.invert(new Float64Array(16),Rt);$t=o.Aabb.applyTransform($t,Rt);const Jt=o.sub([],$t.max,$t.min),Yt=H.left||0,ae=H.right||0,ke=H.bottom||0,se=H.top||0,{left:xe,right:ue,top:Ie,bottom:ee}=j.padding,ve=.5*(Yt+ae),De=.5*(se+ke),ge=Math.min(O.scaleZoom(O.scale*Math.min((O.width-(Yt+ae+xe+ue))/Jt[0],(O.height-(ke+se+ee+Ie))/Jt[1])),j.maxZoom),Oe=O.scale/O.zoomScale(ge);$t=new o.Aabb([$t.min[0]-(xe+ve)*Oe,$t.min[1]-(ee+De)*Oe,$t.min[2]],[$t.max[0]+(ue+ve)*Oe,$t.max[1]+(Ie+De)*Oe,$t.max[2]]);const yi=.5*Jt[2],ki=this._minimumAABBFrustumDistance(O,$t),ai=[0,0,1,0];o.transformMat4$1(ai,ai,Rt),o.normalize$2(ai,ai);const vi=o.scale$2([],ai,ki+yi),Oi=o.add([],$t.center,vi),Ri=(typeof j.offset.x=="number"&&typeof j.offset.y=="number"?new o.Point(j.offset.x,j.offset.y):o.Point.convert(j.offset)).rotate(-o.degToRad(S));$t.center[0]-=Ri.x*Oe,$t.center[1]+=Ri.y*Oe,o.transformMat4($t.center,$t.center,Gt),o.transformMat4(Oi,Oi,Gt);const mi=[$t.center[0],$t.center[1],Oi[2]*O.pixelsPerMeter];o.scale$2(mi,mi,1/O.worldSize);const xs=o.lngFromMercatorX(mi[0]),ws=o.latFromMercatorY(mi[1]),Ts=Math.min(O._zoomFromMercatorZ(mi[2]),j.maxZoom),Ss=new o.LngLat(xs,ws);return O.mercatorFromTransition&&Ts<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(O.setProjection({name:"globe"}),O.zoom=Ts,this._cameraForBounds(O,u,y,S,M,D)):{center:Ss,zoom:Ts,bearing:S,pitch:M}}fitBounds(r,u,y){const S=this.cameraForBounds(r,u);return this._fitInternal(S,u,y)}fitScreenCoordinates(r,u,y,S,M){const D=o.Point.convert(r),O=o.Point.convert(u),j=new o.Point(Math.min(D.x,O.x),Math.min(D.y,O.y)),H=new o.Point(Math.max(D.x,O.x),Math.max(D.y,O.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(D,O))return this;const X=this.transform.pointLocation3D(j),tt=this.transform.pointLocation3D(H),ht=this.transform.pointLocation3D(new o.Point(j.x,H.y)),pt=this.transform.pointLocation3D(new o.Point(H.x,j.y)),gt=[Math.min(X.lng,tt.lng,ht.lng,pt.lng),Math.min(X.lat,tt.lat,ht.lat,pt.lat)],mt=[Math.max(X.lng,tt.lng,ht.lng,pt.lng),Math.max(X.lat,tt.lat,ht.lat,pt.lat)],xt=S&&S.pitch?S.pitch:this.getPitch(),et=this._cameraForBounds(this.transform,gt,mt,y,xt,S);return this._fitInternal(et,S,M)}_fitInternal(r,u,y){return r?(delete(u=o.extend(r,u)).padding,u.linear?this.easeTo(u,y):this.flyTo(u,y)):this}jumpTo(r,u){this.stop();const y=r.preloadOnly?this.transform.clone():this.transform;let S=!1,M=!1,D=!1;return"zoom"in r&&y.zoom!==+r.zoom&&(S=!0,y.zoom=+r.zoom),r.center!==void 0&&(y.center=o.LngLat.convert(r.center)),"bearing"in r&&y.bearing!==+r.bearing&&(M=!0,y.bearing=+r.bearing),"pitch"in r&&y.pitch!==+r.pitch&&(D=!0,y.pitch=+r.pitch),r.padding==null||y.isPaddingEqual(r.padding)||(y.padding=r.padding),r.preloadOnly?(this._preloadTiles(y),this):(this.fire(new o.Event("movestart",u)).fire(new o.Event("move",u)),S&&this.fire(new o.Event("zoomstart",u)).fire(new o.Event("zoom",u)).fire(new o.Event("zoomend",u)),M&&this.fire(new o.Event("rotatestart",u)).fire(new o.Event("rotate",u)).fire(new o.Event("rotateend",u)),D&&this.fire(new o.Event("pitchstart",u)).fire(new o.Event("pitch",u)).fire(new o.Event("pitchend",u)),this.fire(new o.Event("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(rl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,u){const y=this.transform;if(!y.projection.supportsFreeCamera)return o.warnOnce(rl),this;this.stop();const S=y.zoom,M=y.pitch,D=y.bearing;y.setFreeCameraOptions(r);const O=S!==y.zoom,j=M!==y.pitch,H=D!==y.bearing;return this.fire(new o.Event("movestart",u)).fire(new o.Event("move",u)),O&&this.fire(new o.Event("zoomstart",u)).fire(new o.Event("zoom",u)).fire(new o.Event("zoomend",u)),H&&this.fire(new o.Event("rotatestart",u)).fire(new o.Event("rotate",u)).fire(new o.Event("rotateend",u)),j&&this.fire(new o.Event("pitchstart",u)).fire(new o.Event("pitch",u)).fire(new o.Event("pitchend",u)),this.fire(new o.Event("moveend",u)),this}easeTo(r,u){this._stop(!1,r.easeId),((r=o.extend({offset:[0,0],duration:500,easing:o.ease},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const y=this.transform,S=this.getZoom(),M=this.getBearing(),D=this.getPitch(),O=this.getPadding(),j="zoom"in r?+r.zoom:S,H="bearing"in r?this._normalizeBearing(r.bearing,M):M,X="pitch"in r?+r.pitch:D,tt="padding"in r?r.padding:y.padding,ht=o.Point.convert(r.offset);let pt,gt,mt;if(y.projection.name==="globe"){const Yt=o.MercatorCoordinate.fromLngLat(y.center),ae=ht.rotate(-y.angle);Yt.x+=ae.x/y.worldSize,Yt.y+=ae.y/y.worldSize;const ke=Yt.toLngLat(),se=o.LngLat.convert(r.center||ke);this._normalizeCenter(se),pt=y.centerPoint.add(ae),gt=new o.Point(Yt.x,Yt.y).mult(y.worldSize),mt=new o.Point(o.mercatorXfromLng(se.lng),o.mercatorYfromLat(se.lat)).mult(y.worldSize).sub(gt)}else{pt=y.centerPoint.add(ht);const Yt=y.pointLocation(pt),ae=o.LngLat.convert(r.center||Yt);this._normalizeCenter(ae),gt=y.project(Yt),mt=y.project(ae).sub(gt)}const xt=y.zoomScale(j-S);let et,ft;r.around&&(et=o.LngLat.convert(r.around),ft=y.locationPoint(et));const St=this._zooming||j!==S,Et=this._rotating||M!==H,$t=this._pitching||X!==D,Rt=!y.isPaddingEqual(tt),Gt=Yt=>ae=>{if(St&&(Yt.zoom=o.number(S,j,ae)),Et&&(Yt.bearing=o.number(M,H,ae)),$t&&(Yt.pitch=o.number(D,X,ae)),Rt&&(Yt.interpolatePadding(O,tt,ae),pt=Yt.centerPoint.add(ht)),et)Yt.setLocationAtPoint(et,ft);else{const ke=Yt.zoomScale(Yt.zoom-S),se=j>S?Math.min(2,xt):Math.max(.5,xt),xe=Math.pow(se,1-ae),ue=Yt.unproject(gt.add(mt.mult(ae*xe)).mult(ke));Yt.setLocationAtPoint(Yt.renderWorldCopies?ue.wrap():ue,pt)}return r.preloadOnly||this._fireMoveEvents(u),Yt};if(r.preloadOnly){const Yt=this._emulate(Gt,r.duration,y);return this._preloadTiles(Yt),this}const Jt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=St,this._rotating=Et,this._pitching=$t,this._padding=Rt,this._easeId=r.easeId,this._prepareEase(u,r.noMoveStart,Jt),this._ease(Gt(y),Yt=>{y.recenterOnTerrain(),this._afterEase(u,Yt)},r),this}_prepareEase(r,u,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",u||y.moving||this.fire(new o.Event("movestart",r)),this._zooming&&!y.zooming&&this.fire(new o.Event("zoomstart",r)),this._rotating&&!y.rotating&&this.fire(new o.Event("rotatestart",r)),this._pitching&&!y.pitching&&this.fire(new o.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new o.Event("move",r)),this._zooming&&this.fire(new o.Event("zoom",r)),this._rotating&&this.fire(new o.Event("rotate",r)),this._pitching&&this.fire(new o.Event("pitch",r))}_afterEase(r,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,S=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new o.Event("zoomend",r)),S&&this.fire(new o.Event("rotateend",r)),M&&this.fire(new o.Event("pitchend",r)),this.fire(new o.Event("moveend",r))}flyTo(r,u){if(this._prefersReducedMotion(r)){const ge=o.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ge,u)}this.stop(),r=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},r);const y=this.transform,S=this.getZoom(),M=this.getBearing(),D=this.getPitch(),O=this.getPadding(),j="zoom"in r?o.clamp(+r.zoom,y.minZoom,y.maxZoom):S,H="bearing"in r?this._normalizeBearing(r.bearing,M):M,X="pitch"in r?+r.pitch:D,tt="padding"in r?r.padding:y.padding,ht=y.zoomScale(j-S),pt=o.Point.convert(r.offset);let gt=y.centerPoint.add(pt);const mt=y.pointLocation(gt),xt=o.LngLat.convert(r.center||mt);this._normalizeCenter(xt);const et=y.project(mt),ft=y.project(xt).sub(et);let St=r.curve;const Et=Math.max(y.width,y.height),$t=Et/ht,Rt=ft.mag();if("minZoom"in r){const ge=o.clamp(Math.min(r.minZoom,S,j),y.minZoom,y.maxZoom),Oe=Et/y.zoomScale(ge-S);St=Math.sqrt(Oe/Rt*2)}const Gt=St*St;function Jt(ge){const Oe=($t*$t-Et*Et+(ge?-1:1)*Gt*Gt*Rt*Rt)/(2*(ge?$t:Et)*Gt*Rt);return Math.log(Math.sqrt(Oe*Oe+1)-Oe)}function Yt(ge){return(Math.exp(ge)-Math.exp(-ge))/2}function ae(ge){return(Math.exp(ge)+Math.exp(-ge))/2}const ke=Jt(0);let se=function(ge){return ae(ke)/ae(ke+St*ge)},xe=function(ge){return Et*((ae(ke)*(Yt(Oe=ke+St*ge)/ae(Oe))-Yt(ke))/Gt)/Rt;var Oe},ue=(Jt(1)-ke)/St;if(Math.abs(Rt)<1e-6||!isFinite(ue)){if(Math.abs(Et-$t)<1e-6)return this.easeTo(r,u);const ge=$t<Et?-1:1;ue=Math.abs(Math.log($t/Et))/St,xe=function(){return 0},se=function(Oe){return Math.exp(ge*St*Oe)}}r.duration="duration"in r?+r.duration:1e3*ue/("screenSpeed"in r?+r.screenSpeed/St:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Ie=M!==H,ee=X!==D,ve=!y.isPaddingEqual(tt),De=ge=>Oe=>{const yi=Oe*ue,ki=1/se(yi);ge.zoom=Oe===1?j:S+ge.scaleZoom(ki),Ie&&(ge.bearing=o.number(M,H,Oe)),ee&&(ge.pitch=o.number(D,X,Oe)),ve&&(ge.interpolatePadding(O,tt,Oe),gt=ge.centerPoint.add(pt));const ai=Oe===1?xt:ge.unproject(et.add(ft.mult(xe(yi))).mult(ki));return ge.setLocationAtPoint(ge.renderWorldCopies?ai.wrap():ai,gt),ge._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(u),ge};if(r.preloadOnly){const ge=this._emulate(De,r.duration,y);return this._preloadTiles(ge),this}return this._zooming=!0,this._rotating=Ie,this._pitching=ee,this._padding=ve,this._prepareEase(u,!1),this._ease(De(y),()=>this._afterEase(u),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,u)}if(!r){const y=this.handlers;y&&y.stop(!1)}return this}_ease(r,u,y){y.animate===!1||y.duration===0?(r(1),u()):(this._easeStart=o.exported.now(),this._easeOptions=y,this._onEaseFrame=r,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,u){r=o.wrap(r,-180,180);const y=Math.abs(r-u);return Math.abs(r-360-u)<y&&(r-=360),Math.abs(r+360-u)<y&&(r+=360),r}_normalizeCenter(r){const u=this.transform;if(!u.renderWorldCopies||u.maxBounds)return;const y=r.lng-u.center.lng;r.lng+=y>180?-360:y<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&o.exported.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,u,y){const S=Math.ceil(15*u/1e3),M=[],D=r(y.clone());for(let O=0;O<=S;O++){const j=D(O/S);M.push(j.clone())}return M}}class oi{constructor(r={}){this.options=r,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const u=this.options&&this.options.compact;return this._map=r,this._container=nt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=nt("button","mapboxgl-ctrl-attrib-button",this._container),nt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=nt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,u){const y=this._map._getUIString(`AttributionControl.${u}`);r.setAttribute("aria-label",y),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",y)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(r){const y=u.reduce((S,M,D)=>(M.value&&(S+=`${M.key}=${M.value}${D<u.length-1?"&":""}`),S),"?");r.href=`${o.config.FEEDBACK_URL}/${y}#${sl(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const S=this._map.style.stylesheet;this.styleOwner=S.owner,this.styleId=S.id}const u=this._map.style._sourceCaches;for(const S in u){const M=u[S];if(M.used){const D=M.getSource();D.attribution&&r.indexOf(D.attribution)<0&&r.push(D.attribution)}}r.sort((S,M)=>S.length-M.length),r=r.filter((S,M)=>{for(let D=M+1;D<r.length;D++)if(r[D].indexOf(S)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const y=r.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,r.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class fd{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=nt("div","mapboxgl-ctrl");const u=nt("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const u in r){const y=r[u].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const u=r[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class pd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const u=++this._id;return this._queue.push({callback:r,id:u,cancelled:!1}),u}remove(r){const u=this._currentlyRunning,y=u?this._queue.concat(u):this._queue;for(const S of y)if(S.id===r)return void(S.cancelled=!0)}run(r=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const y of u)if(!y.cancelled&&(y.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ol(m,r,u){if(m=new o.LngLat(m.lng,m.lat),r){const y=new o.LngLat(m.lng-360,m.lat),S=new o.LngLat(m.lng+360,m.lat),M=360*Math.ceil(Math.abs(m.lng-u.center.lng)/360),D=u.locationPoint(m).distSqr(r),O=r.x<0||r.y<0||r.x>u.width||r.y>u.height;u.locationPoint(y).distSqr(r)<D&&(O||Math.abs(y.lng-u.center.lng)<M)?m=y:u.locationPoint(S).distSqr(r)<D&&(O||Math.abs(S.lng-u.center.lng)<M)&&(m=S)}for(;Math.abs(m.lng-u.center.lng)>180;){const y=u.locationPoint(m);if(y.x>=0&&y.y>=0&&y.x<=u.width&&y.y<=u.height)break;m.lng>u.center.lng?m.lng-=360:m.lng+=360}return m}const Aa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ze extends o.Evented{constructor(r,u){if(super(),(r instanceof o.window.HTMLElement||u)&&(r=o.extend({element:r},u)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=o.Point.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=nt("div");const S=41,M=27,D=Tt("svg",{display:"block",height:S*this._scale+"px",width:M*this._scale+"px",viewBox:`0 0 ${M} ${S}`},this._element),O=Tt("radialGradient",{id:"shadowGradient"},Tt("defs",{},D));Tt("stop",{offset:"10%","stop-opacity":.4},O),Tt("stop",{offset:"100%","stop-opacity":.05},O),Tt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},D),Tt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},D),Tt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},D),Tt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},D),this._offset=o.Point.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",S=>{S.preventDefault()}),this._element.addEventListener("mousedown",S=>{S.preventDefault()});const y=this._element.classList;for(const S in Aa)y.remove(`mapboxgl-marker-anchor-${S}`);y.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const S=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[S,-1*(38.1-13.5+S)],"bottom-right":[-S,-1*(38.1-13.5+S)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const u=r.code,y=r.charCode||r.keyCode;u!=="Space"&&u!=="Enter"&&y!==32&&y!==13||this.togglePopup()}_onMapClick(r){const u=r.originalEvent.target,y=this._element;this._popup&&(u===y||y.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,u=this._pos;if(!r||!u)return!1;const y=r.unproject(u),S=r.getFreeCameraOptions();if(!S.position)return!1;const M=S.position.toLngLat();return M.distanceTo(y)<.9*M.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const u=this._pos;if(!u||u.x<0||u.x>r.transform.width||u.y<0||u.y>r.transform.height)return void this._clearFadeTimer();const y=r.unproject(u);let S;r._showingGlobe()&&o.isLngLatBehindGlobe(r.transform,this._lngLat)?S=0:(S=1-r._queryFogOpacity(y),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(S*=this._occludedOpacity)),this._element.style.opacity=`${S}`,this._element.style.pointerEvents=S>0?"auto":"none",this._popup&&this._popup._setOpacity(S),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${Aa[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${u.x}px,${u.y}px)
        `}_calculateXYTransform(){const r=this._pos,u=this._map,y=this.getPitchAlignment();if(!u||!r||y!=="map")return"";if(!u._showingGlobe()){const j=u.getPitch();return j?`rotateX(${j}deg)`:""}const S=o.radToDeg(o.globeTiltAtLngLat(u.transform,this._lngLat)),M=r.sub(o.globeCenterToScreenPoint(u.transform)),D=Math.abs(M.x)+Math.abs(M.y);if(D===0)return"";const O=S/D;return`rotateX(${-M.y*O}deg) rotateY(${M.x*O}deg)`}_calculateZTransform(){const r=this._pos,u=this._map;if(!u||!r)return"";let y=0;const S=this.getRotationAlignment();if(S==="map")if(u._showingGlobe()){const M=u.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),D=u.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(M);y=o.radToDeg(Math.atan2(D.y,D.x))-90}else y=-u.getBearing();else if(S==="horizon"){const M=o.smoothstep(4,6,u.getZoom()),D=o.globeCenterToScreenPoint(u.transform);D.y+=M*u.transform.height;const O=r.sub(D),j=o.radToDeg(Math.atan2(O.y,O.x));y=(j>90?j-270:j+90)*(1-M)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(r){o.window.cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=ol(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),r===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=o.Point.convert(r),this._update(),this}_onMove(r){const u=this._map;if(!u)return;const y=this._pointerdownPos,S=this._positionDelta;if(y&&S){if(!this._isDragging){const M=this._clickTolerance||u._clickTolerance;if(r.point.dist(y)<M)return;this._isDragging=!0}this._pos=r.point.sub(S),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(r){const u=this._map,y=this._pos;u&&y&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(y),this._pointerdownPos=r.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const u=this._map;return u&&(r?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const md={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},vm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function $h(m=new o.Point(0,0),r="bottom"){if(typeof m=="number"){const u=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(r){case"top":return new o.Point(0,m);case"top-left":return new o.Point(u,u);case"top-right":return new o.Point(-u,u);case"bottom":return new o.Point(0,-m);case"bottom-left":return new o.Point(u,-u);case"bottom-right":return new o.Point(-u,-u);case"left":return new o.Point(m,0);case"right":return new o.Point(-m,0)}return new o.Point(0,0)}return m instanceof o.Point||Array.isArray(m)?o.Point.convert(m):o.Point.convert(m[r]||[0,0])}class gd{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const u=o.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,u,y){this._start=this.getValue(u),this._end=r,this._startTime=u,this._endTime=u+y}}const al={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Wf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},_d={showCompass:!0,showZoom:!0,visualizePitch:!1};class bm{constructor(r,u,y=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new ad({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,y&&(this.mousePitch=new jh({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(r,u){this.mouseRotate.mousedown(r,u),this.mousePitch&&this.mousePitch.mousedown(r,u),Dt()}move(r,u){const y=this.map,S=this.mouseRotate.mousemoveWindow(r,u),M=S&&S.bearingDelta;if(M&&y.setBearing(y.getBearing()+M),this.mousePitch){const D=this.mousePitch.mousemoveWindow(r,u),O=D&&D.pitchDelta;O&&y.setPitch(y.getPitch()+O)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){wt(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(o.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Zt(this.element,r)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,Zt(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=re(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=re(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Vc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Gh={maxWidth:100,unit:"metric"},yd={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Xl={version:o.version,supported:$,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends na{constructor(m){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),(m=o.extend({},Wf,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(m.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ys(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._useWebGL2=m.useWebGL2,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new pd,this._domRenderTaskQueue=new pd,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},al,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new gd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,typeof m.container=="string"){if(this._container=o.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Lo(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new Bh(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,o.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new oi({customAttribution:m.customAttribution})),this._logoControl=new fd,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new o.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new o.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(m,r){if(r===void 0&&(r=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=m.onAdd(this);this._controls.push(m);const y=this._controlPositions[r];return r.indexOf("bottom")!==-1?y.insertBefore(u,y.firstChild):y.appendChild(u),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(m);return r>-1&&this._controls.splice(r,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new o.Event("movestart",m)).fire(new o.Event("move",m)),this.fire(new o.Event("resize",m)),r&&this.fire(new o.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(o.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?o.window.navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(r=>r==="auto"?o.window.navigator.language:r):m}setLanguage(m){const r=this._parseLanguage(m);if(!this.style||r===this._language)return this;this._language=r,this.style._reloadSources();for(const u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,r=m.projection.name;let u;r==="globe"&&m.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(m.setMercatorFromTransition(),u=!0):r==="mercator"&&m.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(m.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,r){return this._updateProjection(m||r||{name:"mercator"})}_updateProjection(m){let r;if(r=m.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const u in this.style._sourceCaches)this.style._sourceCaches[u].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(m){return this.transform.locationPoint3D(o.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(o.Point.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,r,u){if(m==="mouseenter"||m==="mouseover"){let y=!1;const S=D=>{const O=r.filter(H=>this.getLayer(H)),j=O.length?this.queryRenderedFeatures(D.point,{layers:O}):[];j.length?y||(y=!0,u.call(this,new Xn(m,this,D.originalEvent,{features:j}))):y=!1},M=()=>{y=!1};return{layers:new Set(r),listener:u,delegates:{mousemove:S,mouseout:M}}}if(m==="mouseleave"||m==="mouseout"){let y=!1;const S=D=>{const O=r.filter(j=>this.getLayer(j));(O.length?this.queryRenderedFeatures(D.point,{layers:O}):[]).length?y=!0:y&&(y=!1,u.call(this,new Xn(m,this,D.originalEvent)))},M=D=>{y&&(y=!1,u.call(this,new Xn(m,this,D.originalEvent)))};return{layers:new Set(r),listener:u,delegates:{mousemove:S,mouseout:M}}}{const y=S=>{const M=r.filter(O=>this.getLayer(O)),D=M.length?this.queryRenderedFeatures(S.point,{layers:M}):[];D.length&&(S.features=D,u.call(this,S),delete S.features)};return{layers:new Set(r),listener:u,delegates:{[m]:y}}}}on(m,r,u){if(u===void 0)return super.on(m,r);Array.isArray(r)||(r=[r]);const y=this._createDelegatedListener(m,r,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(y);for(const S in y.delegates)this.on(S,y.delegates[S]);return this}once(m,r,u){if(u===void 0)return super.once(m,r);Array.isArray(r)||(r=[r]);const y=this._createDelegatedListener(m,r,u);for(const S in y.delegates)this.once(S,y.delegates[S]);return this}off(m,r,u){if(u===void 0)return super.off(m,r);r=new Set(Array.isArray(r)?r:[r]);const y=(M,D)=>{if(M.size!==D.size)return!1;for(const O of M)if(!D.has(O))return!1;return!0},S=this._delegatedListeners?this._delegatedListeners[m]:void 0;return S&&(M=>{for(let D=0;D<M.length;D++){const O=M[D];if(O.listener===u&&y(O.layers,r)){for(const j in O.delegates)this.off(j,O.delegates[j]);return M.splice(D,1),this}}})(S),this}queryRenderedFeatures(m,r){return this.style?(r!==void 0||m===void 0||m instanceof o.Point||Array.isArray(m)||(r=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(m,r){return this.style.querySourceFeatures(m,r)}isPointOnSurface(m){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&o.warnOnce(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.Point.convert(m))}setStyle(m,r){return(r=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(m,r))}_getUIString(m){const r=this._locale[m];if(r==null)throw new Error(`Missing UI string '${m}'`);return r}_updateStyle(m,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m&&(this.style=new Co(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Co(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,r){if(typeof m=="string"){const u=this._requestManager.normalizeStyleURL(m),y=this._requestManager.transformRequest(u,o.ResourceType.Style);o.getJSON(y,(S,M)=>{S?this.fire(new o.ErrorEvent(S)):M&&this._updateDiff(M,r)})}else typeof m=="object"&&this._updateDiff(m,r)}_updateDiff(m,r){try{this.style.setState(m)&&this._update(!0)}catch(u){o.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(m,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(m,r){return this._lazyInitEmptyStyle(),this.style.addSource(m,r),this._update(!0)}isSourceLoaded(m){return!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){const m=this.style&&this.style._sourceCaches;for(const r in m){const u=m[r]._tiles;for(const y in u){const S=u[y];if(S.state!=="loaded"&&S.state!=="errored")return!1}}return!0}addSourceType(m,r,u){this._lazyInitEmptyStyle(),this.style.addSourceType(m,r,u)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,r,{pixelRatio:u=1,sdf:y=!1,stretchX:S,stretchY:M,content:D}={}){if(this._lazyInitEmptyStyle(),r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap){const{width:O,height:j,data:H}=o.exported.getImageData(r);this.style.addImage(m,{data:new o.RGBAImage({width:O,height:j},H),pixelRatio:u,stretchX:S,stretchY:M,content:D,sdf:y,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:O,height:j}=r,H=r;this.style.addImage(m,{data:new o.RGBAImage({width:O,height:j},new Uint8Array(H.data)),pixelRatio:u,stretchX:S,stretchY:M,content:D,sdf:y,version:0,userImage:H}),H.onAdd&&H.onAdd(this,m)}}updateImage(m,r){const u=this.style.getImage(m);if(!u)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap?o.exported.getImageData(r):r,{width:S,height:M}=y;S!==void 0&&M!==void 0?S===u.data.width&&M===u.data.height?(u.data.replace(y.data,!(r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap)),this.style.updateImage(m,u)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${S}, ${M})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,r){o.getImage(this._requestManager.transformRequest(m,o.ResourceType.Image),(u,y)=>{r(u,y instanceof o.window.HTMLImageElement?o.exported.getImageData(y):y)})}listImages(){return this.style.listImages()}addLayer(m,r){return this._lazyInitEmptyStyle(),this.style.addLayer(m,r),this._update(!0)}moveLayer(m,r){return this.style.moveLayer(m,r),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,r,u){return this.style.setLayerZoomRange(m,r,u),this._update(!0)}setFilter(m,r,u={}){return this.style.setFilter(m,r,u),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,r,u,y={}){return this.style.setPaintProperty(m,r,u,y),this._update(!0)}getPaintProperty(m,r){return this.style.getPaintProperty(m,r)}setLayoutProperty(m,r,u,y={}){return this.style.setLayoutProperty(m,r,u,y),this._update(!0)}getLayoutProperty(m,r){return this.style.getLayoutProperty(m,r)}setLight(m,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(m),this.transform):0}setFeatureState(m,r){return this.style.setFeatureState(m,r),this._update()}removeFeatureState(m,r){return this.style.removeFeatureState(m,r),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let u,y,S,M=this._container;for(;M&&(!y||!S);){const D=o.window.getComputedStyle(M).transform;D&&D!=="none"&&(u=D.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(y=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(S=u[3])),M=M.parentElement}this._containerWidth=y?Math.abs(m/y):m,this._containerHeight=S?Math.abs(r/S):r}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=nt("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=nt("div","mapboxgl-canvas-container",m);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=nt("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=nt("div","mapboxgl-control-container",m),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(S=>{y[S]=nt("div",`mapboxgl-ctrl-${S}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,r){const u=o.exported.devicePixelRatio||1;this._canvas.width=u*Math.ceil(m),this._canvas.height=u*Math.ceil(r),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${r}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const r=this._markers.indexOf(m);r!==-1&&this._markers.splice(r,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const r=this._popups.indexOf(m);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const m=o.extend({},$.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._useWebGL2&&this._canvas.getContext("webgl2",m),u=r||this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);u?(this._useWebGL2&&!r&&o.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),o.storeAuthState(u,!0),this.painter=new Fl(u,this.transform,!!r),this.on("data",y=>{y.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(u)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let r;const u=this.painter.context.extTimerQuery,y=o.exported.now();if(this.listens("gpu-timing-frame")&&(r=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const S=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const O=this.transform.zoom,j=this.transform.pitch,H=o.exported.now(),X=new o.EvaluationParameters(O,{now:H,fadeDuration:S,pitch:j,transition:this.style.getTransition()});this.style.update(X)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let M=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),M=this._updateAverageElevation(y),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):M=this._updateAverageElevation(y),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,S,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const O=o.exported.now()-y;u.endQueryEXT(u.TIME_ELAPSED_EXT,r),setTimeout(()=>{const j=u.getQueryObjectEXT(r,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(r),this.fire(new o.Event("gpu-timing-frame",{cpuTime:O,gpuTime:j})),o.window.performance.mark("frame-gpu",{startTime:y,detail:{gpuTime:j}})},50)}if(this.listens("gpu-timing-layer")){const O=this.painter.collectGpuTimers();setTimeout(()=>{const j=this.painter.queryGpuTimers(O);this.fire(new o.Event("gpu-timing-layer",{layerTimes:j}))},50)}if(this.listens("gpu-timing-deferred-render")){const O=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const j=this.painter.queryGpuTimeDeferredRender(O);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:j}))},50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||M;if(D||this._repaint)this.triggerRepaint();else{const O=!this.isMoving()&&this.loaded();if(O&&(M=this._updateAverageElevation(y,!0)),M)this.triggerRepaint();else if(this._triggerFrame(!1),O&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const j=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:j})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const r of this._markers)m&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!m||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(m,r=!1){const u=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);if((r||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const y=this.transform.averageElevation;let S=this.transform.sampleAverageElevation(),M=!1;this.transform.elevation&&(M=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(S)?S=0:this._averageElevationLastSampledAt=m;const D=Math.abs(y-S);if(D>1){if(this._isInitialLoad||M)return this._averageElevation.jumpTo(S),u(S);this._averageElevation.easeTo(S,m,300)}else if(D>1e-4)return this._averageElevation.jumpTo(S),u(S)}return!!this._averageElevation.isEasing(m)&&u(this._averageElevation.getValue(m))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===o.AUTH_ERR_MSG||m.status===401)){const r=this.painter.context.gl;o.storeAuthState(r,!1),this._logoControl instanceof fd&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const u=this.painter.context.gl,y=u.createFramebuffer();function S(M){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,M,0);const D=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,D),D}return u.bindFramebuffer(u.FRAMEBUFFER,y),this._canvasPixelComparison(S(m),r.canvasCopies.map(S),r.timeStamps)}_canvasPixelComparison(m,r,u){let y=u[1]-u[0];const S=m.length/4;for(let M=0;M<r.length;M++){const D=r[M];let O=0;for(let j=0;j<D.length;j+=4)D[j]===m[j]&&D[j+1]===m[j+1]&&D[j+2]===m[j+2]&&D[j+3]===m[j+3]&&(O+=1);y+=(u[M+2]-u[M+1])*(1-O/S)}return y}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=o.exported.frame(r=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(r)}))}_preloadTiles(m){const r=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(r,(u,y)=>u._preloadTiles(m,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){o.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,r){o.setCacheLimits(m,r)}get version(){return o.version}},NavigationControl:class{constructor(m){this.options=o.extend({},_d,m),this._container=nt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),nt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),nt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:r}):u.resetNorth({},{originalEvent:r}))}),this._compassIcon=nt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const r=m.getZoom(),u=r===m.getMaxZoom(),y=r===m.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new bm(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,r){const u=nt("button",m,this._container);return u.type="button",u.addEventListener("click",r),u}_setButtonTitle(m,r){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${r}`);m.setAttribute("aria-label",u),m.firstElementChild&&m.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends o.Evented{constructor(m){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},Vc,m),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Vl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=nt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const r=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,m(u)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(u=>r(u.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(m){const r=this._map.getMaxBounds(),u=m.coords;return!!r&&(u.longitude<r.getWest()||u.longitude>r.getEast()||u.latitude<r.getSouth()||u.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",m)),this._finish()}}_updateCamera(m){const r=new o.LngLat(m.coords.longitude,m.coords.latitude),u=m.coords.accuracy,y=this._map.getBearing(),S=o.extend({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(u),S,{geolocateSource:!0})}_updateMarker(m){if(m){const r=new o.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,r=o.mercatorZfromAltitude(1,m._center.lat)*m.worldSize,u=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=nt("button","mapboxgl-ctrl-geolocate",this._container),nt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=nt("div","mapboxgl-user-location"),this._dotElement.appendChild(nt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(nt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ze({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=nt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ze({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:oi,ScaleControl:class{constructor(m){this.options=o.extend({},Gh,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,r=this._map,u=r._containerHeight/2,y=r._containerWidth/2-m/2,S=r.unproject([y,u]),M=r.unproject([y+m,u]),D=S.distanceTo(M);if(this.options.unit==="imperial"){const O=3.2808*D;O>5280?this._setScale(m,O/5280,"mile"):this._setScale(m,O,"foot")}else this.options.unit==="nautical"?this._setScale(m,D/1852,"nautical-mile"):D>=1e3?this._setScale(m,D/1e3,"kilometer"):this._setScale(m,D,"meter")}_setScale(m,r,u){this._map._requestDomTask(()=>{const y=function(M){const D=Math.pow(10,`${Math.floor(M)}`.length-1);let O=M/D;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:function(j){const H=Math.pow(10,Math.ceil(-Math.log(j)/Math.LN10));return Math.round(j*H)/H}(O),D*O}(r),S=y/r;this._container.innerHTML=this._isNumberFormatSupported&&u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(y):`${y}&nbsp;${yd[u]}`,this._container.style.width=m*S+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=nt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof o.window.HTMLElement?this._container=m.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=nt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=nt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);nt("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(m){super(),this.options=o.extend(Object.create(md),m),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=o.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(o.window.document.createTextNode(m))}setHTML(m){const r=o.window.document.createDocumentFragment(),u=o.window.document.createElement("body");let y;for(u.innerHTML=m;y=u.firstChild,y;)r.appendChild(y);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=nt("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(m),this.options.closeButton){const u=this._closeButton=nt("button","mapboxgl-popup-close-button",r);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let r;return this._classList.delete(m)?r=!1:(this._classList.add(m),r=!0),this._updateClassList(),r}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const r=this._map,u=this._container,y=this._pos;if(!r||!u||!y)return"bottom";const S=u.offsetWidth,M=u.offsetHeight,D=y.x<S/2,O=y.x>r.transform.width-S/2;if(y.y+m<M)return D?"top-left":O?"top-right":"top";if(y.y>r.transform.height-M){if(D)return"bottom-left";if(O)return"bottom-right"}return D?"left":O?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),m.className=r.join(" ")}_update(m){const r=this._map,u=this._content;if(!r||!this._lngLat&&!this._trackPointer||!u)return;let y=this._container;if(y||(y=this._container=nt("div","mapboxgl-popup",r.getContainer()),this._tip=nt("div","mapboxgl-popup-tip",y),y.appendChild(u)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ol(this._lngLat,this._pos,r.transform)),!this._trackPointer||m){const S=this._pos=this._trackPointer&&m?m:r.project(this._lngLat),M=$h(this.options.offset),D=this._anchor=this._getAnchor(M.y),O=$h(this.options.offset,D),j=S.add(O).round();r._requestDomTask(()=>{this._container&&D&&(this._container.style.transform=`${Aa[D]} translate(${j.x}px,${j.y}px)`)})}if(!this._marker&&r._showingGlobe()){const S=o.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(S)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(vm);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Ze,Style:Co,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.Point,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:zf,Evented:o.Evented,config:o.config,prewarm:function(){mn().acquire(wo)},clearPrewarmedResources:function(){const m=er;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(wo),er=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(m){o.config.ACCESS_TOKEN=m},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(m){o.config.API_URL=m},get workerCount(){return In.workerCount},set workerCount(m){In.workerCount=m},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){o.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){o.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return Xl});var P=x;return P})})(KM);var RD=KM.exports;const Hp=YM(RD),Vb=zD("map",{state:()=>({map:null,boundaries:{},visibleLayer:null}),actions:{setMap(i){this.map=i},setBoundaries(i){this.boundaries=i},highlightFeature(i,e){var o,z;if(!this.map||!i)return;const a={country:"countries-outline",watershed:"watersheds-outline",commune:"communes-outline"},h=a[e],p=Object.values(a);for(const $ of p)(o=this.map)!=null&&o.getLayer($)&&(this.map.setLayoutProperty($,"visibility","none"),this.map.setPaintProperty($,"line-color","rgba(0,0,0,0)"));(z=this.map)!=null&&z.getLayer(h)&&(this.map.setLayoutProperty(h,"visibility","visible"),this.map.setPaintProperty(h,"line-color","#000000"),this.map.setPaintProperty(h,"line-width",4)),this.visibleLayer=e;const x=i.geometry.coordinates.flat(1/0),T=x.filter(($,q)=>q%2===0),P=x.filter(($,q)=>q%2!==0);if(T.length&&P.length){const $=new Hp.LngLatBounds([Math.min(...T),Math.min(...P)],[Math.max(...T),Math.max(...P)]);this.map.fitBounds($,{padding:40})}},resetView(){if(!this.map)return;this.map.flyTo({center:[1.8,11.5],zoom:4.2,essential:!0});const i=["countries-outline","watersheds-outline","communes-outline"];for(const e of i)this.map.getLayer(e)&&this.map.setLayoutProperty(e,"visibility","none");this.visibleLayer=null}}}),BD="/projects/soil_values/assets/LC_MAPLAYERS-SEb8qRKn.png",FD="/projects/soil_values/assets/LC_BIOPHYSICAL_HEALTH_2-HHlmRK23.png",ND="/projects/soil_values/assets/LC_BIOPHYSICAL_HEALTH-BGgneVEh.png",jD="/projects/soil_values/assets/LC_LANDCOVER-BTufKOfp.png",UD="/projects/soil_values/assets/LC_LANDCOVER_%202-Dfxvtyu_.png",VD={class:"biophysical-panel"},$D=bo({__name:"BiophysicalMonitoringPanel",setup(i){return(e,a)=>(qi(),cs("div",VD,a[0]||(a[0]=[Fx('<h2 class="panel-title" data-v-7853e14a>Biophysical Monitoring</h2><p class="panel-description" data-v-7853e14a> Monitors key environmental variables including land cover, vegetation indices (NDVI, EVI), topography, and water availability. It offers a holistic view of the landscapes biophysical condition for better planning and resource management. </p><section class="image-section" data-v-7853e14a><h3 class="chart-title" data-v-7853e14a>Map Layers</h3><img src="'+BD+'" alt="Map Layers" class="chart-image" data-v-7853e14a></section><section class="image-section" data-v-7853e14a><h3 class="chart-title" data-v-7853e14a>Cumulative EVI</h3><img src="'+FD+'" alt="EVI Trend" class="chart-image" data-v-7853e14a></section><section class="image-section" data-v-7853e14a><h3 class="chart-title" data-v-7853e14a>Biophysical Health (20102023)</h3><img src="'+ND+'" alt="Biophysical Donut" class="chart-image" data-v-7853e14a></section><section class="image-section" data-v-7853e14a><h3 class="chart-title" data-v-7853e14a>Land Cover  Baseline Period (20032008)</h3><img src="'+jD+'" alt="Baseline Chart" class="chart-image" data-v-7853e14a></section><section class="image-section" data-v-7853e14a><h3 class="chart-title" data-v-7853e14a>Land Cover  Evaluation Period (20102023)</h3><img src="'+UD+'" alt="Evaluation Chart" class="chart-image" data-v-7853e14a></section>',7)])))}}),GD=Ha($D,[["__scopeId","data-v-7853e14a"]]),WD={class:"fertility-panel"},HD={class:"indicator-title"},XD={class:"baseline-current"},qD={class:"baseline"},ZD={class:"current"},YD={class:"progress-bar"},KD=bo({__name:"FertilityMonitoringPanel",setup(i){const e=[{name:"Organic Matter",baseline:"2.4%",current:"2.8%",change:"+15.92%",changeClass:"change-positive",progress:65},{name:"Nutrient Levels",baseline:"Medium",current:"High",change:"+16.35%",changeClass:"change-positive",progress:75},{name:"Erosion Risk",baseline:"Moderate",current:"No Change",change:"No Change",changeClass:"change-neutral",progress:50},{name:"Water Retention",baseline:"Low",current:"Moderate",change:"+8.42%",changeClass:"change-positive",progress:40}];return(a,h)=>(qi(),cs("div",WD,[h[2]||(h[2]=Ye("h2",{class:"panel-title"},"Soil Fertility Monitoring",-1)),h[3]||(h[3]=Ye("p",{class:"panel-description"}," Assesses soil fertility dynamics through indicators such as organic carbon content, nutrient availability, and land use practices. The tool guides stakeholders in making data-informed decisions for improved soil health and productivity. ",-1)),(qi(),cs(dn,null,gc(e,p=>Ye("div",{key:p.name,class:"indicator-card"},[Ye("div",HD,[Ye("strong",null,Dn(p.name),1),Ye("span",{class:nm(p.changeClass)},Dn(p.change),3)]),Ye("div",XD,[Ye("span",qD,[h[0]||(h[0]=Na("Baseline: ")),Ye("strong",null,Dn(p.baseline),1)]),Ye("span",ZD,[h[1]||(h[1]=Na("Current: ")),Ye("strong",null,Dn(p.current),1)])]),Ye("div",YD,[Ye("div",{class:"progress",style:wf({width:p.progress+"%"})},null,4)])])),64))]))}}),JD=Ha(KD,[["__scopeId","data-v-de08c49d"]]),QD={class:"toolbox-container"},tz={class:"toolbox-content"},ez=["onClick","title"],iz={class:"tool-icon"},sz={class:"icon-label"},nz={key:0,class:"floating-panel"},rz={key:2},oz={class:"text-lg font-semibold mb-2"},az={class:"text-gray-700 text-sm leading-relaxed whitespace-pre-line"},lz=bo({__name:"Toolbox",setup(i){const e=Bs(null),a=Vb(),h=[{id:"landcover",name:"Biophysical Monitoring",emoji:"",description:"Monitors key environmental variables including land cover, vegetation indices (NDVI, EVI), topography, and water availability. It offers a holistic view of the landscapes biophysical condition for better planning and resource management."},{id:"crop",name:"Crop Monitoring",emoji:"",description:"This tool provides spatial insights into crop distribution, health, and seasonal performance using remote sensing data. It supports early detection of crop stress, tracking of growth stages, and estimation of yields to inform timely agricultural interventions."},{id:"degradation",name:"Degradation Monitoring",emoji:"",description:"Tracks land degradation over time by analysing vegetation cover, erosion risk, and human impact. It helps identify hotspots of land degradation, supporting targeted land restoration and sustainable land management efforts."},{id:"drought",name:"Drought Monitoring",emoji:"",description:"Detects and visualizes drought events using climatic and remote sensing indicators like rainfall anomalies, vegetation stress, and soil moisture. It supports early warning systems and helps stakeholders prepare and respond to climate risks."},{id:"fertility",name:"Fertility Monitoring",emoji:"",description:"Assesses soil fertility dynamics through indicators such as organic carbon content, nutrient availability, and land use practices. The tool guides stakeholders in making data-informed decisions for improved soil health and productivity."},{id:"risk",name:"Risk Monitoring",emoji:"",description:"Identify environmental risks by monitoring exposure to climate extremes, soil degradation, and water scarcity to prioritize resilience interventions."}];function p(T){const P=e.value===T;e.value=P?null:T;const o=a.map;if(!o)return;const z=e.value==="landcover";o.getLayer("komadougou-highlight")&&o.setLayoutProperty("komadougou-highlight","visibility",z?"visible":"none"),T==="landcover"&&!P&&o.flyTo({center:[3.3,14.5],zoom:7,speed:1.2,curve:1.3,essential:!0})}function x(T,P){const[o,...z]=T.split(" ");return P===0?o:z.join(" ")||"Monitoring"}return(T,P)=>(qi(),cs("div",QD,[P[1]||(P[1]=Ye("div",{class:"toolbox-header"},[Ye("span",{class:"header-text"},"Tools")],-1)),Ye("div",tz,[(qi(),cs(dn,null,gc(h,o=>Ye("div",{key:o.id,class:"tool-item",onClick:z=>p(o.id),title:o.name},[Ye("div",iz,Dn(o.emoji),1),Ye("div",sz,[Ye("strong",null,Dn(x(o.name,0)),1),P[0]||(P[0]=Ye("br",null,null,-1)),Ye("span",null,Dn(x(o.name,1)),1)]),fs(Ob,{name:"slide"},{default:Fa(()=>[e.value===o.id?(qi(),cs("div",nz,[o.id==="landcover"?(qi(),yf(GD,{key:0})):o.id==="fertility"?(qi(),yf(JD,{key:1})):(qi(),cs("div",rz,[Ye("h3",oz,Dn(o.name),1),Ye("p",az,Dn(o.description),1)]))])):Ba("",!0)]),_:2},1024)],8,ez)),64))])]))}}),cz=Ha(lz,[["__scopeId","data-v-479366e5"]]),hz=bo({__name:"MapboxMap",setup(i){const e=Bs(null),a=Vb(),h="pk.eyJ1Ijoib3N1bWFpIiwiYSI6ImNtOThheGt3bDAxMDYyanM1cDVoZG5jaGIifQ.rhfXn8CCj3FZ-OTeH-z-Ag",p="http://127.0.0.1:8000/api/v1";return ph(()=>{const x=new Hp.Map({container:e.value,style:"mapbox://styles/mapbox/light-v10",center:[1,12],zoom:4.2,accessToken:h});a.setMap(x),x.on("load",()=>{x.addSource("komadogou-landcover",{type:"raster",tiles:[`${p}/proxy_geoserver/komadogou-landcover/{z}/{x}/{y}.png`],tileSize:256}),x.addLayer({id:"komadogou-landcover",type:"raster",source:"komadogou-landcover",paint:{"raster-opacity":.6}}),x.addSource("komadogou-rivers",{type:"raster",tiles:[`${p}/proxy_geoserver/komadogou-river-streams/{z}/{x}/{y}.png`],tileSize:256}),x.addLayer({id:"komadogou-rivers",type:"raster",source:"komadogou-rivers",paint:{"raster-opacity":.1}}),x.addSource("boundaries",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),[{id:"countries-outline",key:"country"},{id:"watersheds-outline",key:"watershed"},{id:"communes-outline",key:"commune"}].forEach(({id:P,key:o})=>{x.addLayer({id:P,type:"line",source:"boundaries",filter:["==",["get","layer"],o],layout:{visibility:"none"},paint:{"line-color":"#000000","line-width":2}})}),x.addSource("kobo-avocados",{type:"geojson",data:`${p}/kobo/avocado-submissions`}),x.addLayer({id:"kobo-avocados-layer",type:"circle",source:"kobo-avocados",paint:{"circle-radius":6,"circle-color":"#00A86B","circle-stroke-width":1,"circle-stroke-color":"#004225"}}),x.on("click","kobo-avocados-layer",P=>{const o=P.features[0].properties;new Hp.Popup().setLngLat(P.lngLat).setHTML(`
          <strong>Enumerator:</strong> ${o.enumerator}<br/>
          <strong>Trees:</strong> ${o.trees}<br/>
          <strong>Submitted:</strong> ${o.submitted}
        `).addTo(x)})})}),(x,T)=>(qi(),cs("div",{ref_key:"mapContainer",ref:e,class:"mapbox-map w-full h-full"},null,512))}}),uz=Ha(hz,[["__scopeId","data-v-9e9e134e"]]),dz={class:"map-control-wrapper"},fz={key:0,class:"map-control-panel"},pz={class:"panel-header"},mz={class:"dropdown-group"},gz=["value"],_z={key:0,class:"spinner"},yz={key:0,class:"dropdown-group"},xz=["value"],vz={key:0,class:"spinner"},bz={key:1,class:"dropdown-group"},wz=["value"],Tz={key:0,class:"spinner"},Sz=bo({__name:"MapControlPanel",setup(i){const e=Vb(),a=Bs(!0),h=Bs(null),p=Bs(null),x=Bs(null),T=Bs(!1),P=Bs(!1),o=Bs(!1),z=Bs([]),$=Bs([]),q=Bs([]);async function Q(){try{const Zt=await(await fetch("http://127.0.0.1:8000/api/v1/boundaries/all")).json();z.value=Zt.countries.features,$.value=Zt.watersheds.features,q.value=Zt.communes.features,e.setBoundaries(Zt)}catch(Xt){console.error("Failed to load boundaries:",Xt)}}ph(async()=>{T.value=!0,await Q(),T.value=!1}),ya(()=>h.value,()=>{p.value=null,x.value=null}),ya(()=>p.value,()=>{x.value=null});const nt=Jr(()=>{if(!h.value)return[];const Xt=yt(h.value);return $.value.filter(Zt=>Lt(Zt,Xt))}),Tt=Jr(()=>{if(!p.value)return[];const Xt=yt(p.value);return q.value.filter(Zt=>Lt(Zt,Xt))});function yt(Xt){const Zt=Xt.geometry.coordinates.flat(1/0),re=Zt.filter((ne,Ut)=>Ut%2===0),kt=Zt.filter((ne,Ut)=>Ut%2!==0);return[Math.min(...re),Math.min(...kt),Math.max(...re),Math.max(...kt)]}function Lt(Xt,[Zt,re,kt,ne]){const[Ut,Le,ye,Ce]=yt(Xt);return!(ye<Zt||Ut>kt||Ce<re||Le>ne)}function Nt(){P.value=!0,e.highlightFeature(h.value,"country"),setTimeout(()=>P.value=!1,500)}function Dt(){o.value=!0,e.highlightFeature(p.value,"watershed"),setTimeout(()=>o.value=!1,500)}function wt(){e.highlightFeature(x.value,"commune")}function It(){h.value=null,p.value=null,x.value=null,e.resetView()}return(Xt,Zt)=>(qi(),cs("div",dz,[a.value?Ba("",!0):(qi(),cs("button",{key:0,class:"reopen-button",onClick:Zt[0]||(Zt[0]=re=>a.value=!0)},"  Map Controls ")),fs(Ob,{name:"fade-slide"},{default:Fa(()=>[a.value?(qi(),cs("div",fz,[Ye("div",pz,[Zt[5]||(Zt[5]=Ye("h3",{class:"panel-title"},"Map",-1)),Ye("button",{class:"close-button",onClick:Zt[1]||(Zt[1]=re=>a.value=!1)},"")]),Ye("div",mz,[Zt[7]||(Zt[7]=Ye("label",{class:"dropdown-label"},"Country",-1)),Ag(Ye("select",{"onUpdate:modelValue":Zt[2]||(Zt[2]=re=>h.value=re),onChange:Nt},[Zt[6]||(Zt[6]=Ye("option",{disabled:"",value:""},"Select",-1)),(qi(!0),cs(dn,null,gc(z.value,re=>(qi(),cs("option",{key:re.properties.id,value:re},Dn(re.properties.name),9,gz))),128))],544),[[Wp,h.value]]),T.value?(qi(),cs("span",_z,"")):Ba("",!0)]),nt.value.length?(qi(),cs("div",yz,[Zt[9]||(Zt[9]=Ye("label",{class:"dropdown-label"},"Watershed",-1)),Ag(Ye("select",{"onUpdate:modelValue":Zt[3]||(Zt[3]=re=>p.value=re),onChange:Dt},[Zt[8]||(Zt[8]=Ye("option",{disabled:"",value:""},"Select",-1)),(qi(!0),cs(dn,null,gc(nt.value,re=>(qi(),cs("option",{key:re.properties.id,value:re},Dn(re.properties.name),9,xz))),128))],544),[[Wp,p.value]]),P.value?(qi(),cs("span",vz,"")):Ba("",!0)])):Ba("",!0),Tt.value.length?(qi(),cs("div",bz,[Zt[11]||(Zt[11]=Ye("label",{class:"dropdown-label"},"Commune",-1)),Ag(Ye("select",{"onUpdate:modelValue":Zt[4]||(Zt[4]=re=>x.value=re),onChange:wt},[Zt[10]||(Zt[10]=Ye("option",{disabled:"",value:""},"Select",-1)),(qi(!0),cs(dn,null,gc(Tt.value,re=>(qi(),cs("option",{key:re.properties.id,value:re},Dn(re.properties.name),9,wz))),128))],544),[[Wp,x.value]]),o.value?(qi(),cs("span",Tz,"")):Ba("",!0)])):Ba("",!0),Ye("button",{class:"reset-btn",onClick:It},"Reset")])):Ba("",!0)]),_:1})]))}}),Ez=Ha(Sz,[["__scopeId","data-v-1afe0ae6"]]),Mz={key:0,class:"legend-container"},Az={class:"legend-header"},Cz={class:"legend-list"},kz=bo({__name:"MapLegend",props:{show:{type:Boolean}},emits:["close"],setup(i){const e={Water:"#2b83ba",Forest:"#1a9850",Cropland:"#d7191c",Grassland:"#fdae61",Shrubland:"#abdda4",Wetland:"#66c2a5",Bareland:"#ffffbf",Urban:"#f46d43","Boundary Outline":"#000000"};return(a,h)=>a.show?(qi(),cs("div",Mz,[Ye("div",Az,[h[1]||(h[1]=Ye("h4",{class:"legend-title"},"Map Legend",-1)),Ye("button",{class:"legend-close",onClick:h[0]||(h[0]=p=>a.$emit("close"))},"")]),Ye("ul",Cz,[(qi(),cs(dn,null,gc(e,(p,x)=>Ye("li",{key:x},[Ye("span",{class:"legend-swatch",style:wf({backgroundColor:p})},null,4),Na(" "+Dn(x),1)])),64))])])):Ba("",!0)}}),Pz=Ha(kz,[["__scopeId","data-v-58895c91"]]),Iz={class:"dashboard-container"},Lz={class:"map-area"},Dz={class:"overlay-panels"},zz=bo({__name:"MapView",setup(i){const e=Bs(!0),a=Bs(!0);return(h,p)=>(qi(),cs("div",Iz,[fs(cz),Ye("div",Lz,[fs(uz),Ye("div",Dz,[e.value?(qi(),yf(Ez,{key:0,onClose:p[0]||(p[0]=x=>e.value=!1)})):Ba("",!0),fs(Pz,{show:a.value,onClose:p[1]||(p[1]=x=>a.value=!1)},null,8,["show"])])])]))}}),Oz=Ha(zz,[["__scopeId","data-v-db5665bc"]]);/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function a_(i){return i+.5|0}const Eu=(i,e,a)=>Math.max(Math.min(i,a),e);function bg(i){return Eu(a_(i*2.55),0,255)}function Pu(i){return Eu(a_(i*255),0,255)}function rh(i){return Eu(a_(i/2.55)/100,0,1)}function fT(i){return Eu(a_(i*100),0,100)}const Ra={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},eb=[..."0123456789ABCDEF"],Rz=i=>eb[i&15],Bz=i=>eb[(i&240)>>4]+eb[i&15],Ey=i=>(i&240)>>4===(i&15),Fz=i=>Ey(i.r)&&Ey(i.g)&&Ey(i.b)&&Ey(i.a);function Nz(i){var e=i.length,a;return i[0]==="#"&&(e===4||e===5?a={r:255&Ra[i[1]]*17,g:255&Ra[i[2]]*17,b:255&Ra[i[3]]*17,a:e===5?Ra[i[4]]*17:255}:(e===7||e===9)&&(a={r:Ra[i[1]]<<4|Ra[i[2]],g:Ra[i[3]]<<4|Ra[i[4]],b:Ra[i[5]]<<4|Ra[i[6]],a:e===9?Ra[i[7]]<<4|Ra[i[8]]:255})),a}const jz=(i,e)=>i<255?e(i):"";function Uz(i){var e=Fz(i)?Rz:Bz;return i?"#"+e(i.r)+e(i.g)+e(i.b)+jz(i.a,e):void 0}const Vz=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function QM(i,e,a){const h=e*Math.min(a,1-a),p=(x,T=(x+i/30)%12)=>a-h*Math.max(Math.min(T-3,9-T,1),-1);return[p(0),p(8),p(4)]}function $z(i,e,a){const h=(p,x=(p+i/60)%6)=>a-a*e*Math.max(Math.min(x,4-x,1),0);return[h(5),h(3),h(1)]}function Gz(i,e,a){const h=QM(i,1,.5);let p;for(e+a>1&&(p=1/(e+a),e*=p,a*=p),p=0;p<3;p++)h[p]*=1-e-a,h[p]+=e;return h}function Wz(i,e,a,h,p){return i===p?(e-a)/h+(e<a?6:0):e===p?(a-i)/h+2:(i-e)/h+4}function $b(i){const a=i.r/255,h=i.g/255,p=i.b/255,x=Math.max(a,h,p),T=Math.min(a,h,p),P=(x+T)/2;let o,z,$;return x!==T&&($=x-T,z=P>.5?$/(2-x-T):$/(x+T),o=Wz(a,h,p,$,x),o=o*60+.5),[o|0,z||0,P]}function Gb(i,e,a,h){return(Array.isArray(e)?i(e[0],e[1],e[2]):i(e,a,h)).map(Pu)}function Wb(i,e,a){return Gb(QM,i,e,a)}function Hz(i,e,a){return Gb(Gz,i,e,a)}function Xz(i,e,a){return Gb($z,i,e,a)}function tA(i){return(i%360+360)%360}function qz(i){const e=Vz.exec(i);let a=255,h;if(!e)return;e[5]!==h&&(a=e[6]?bg(+e[5]):Pu(+e[5]));const p=tA(+e[2]),x=+e[3]/100,T=+e[4]/100;return e[1]==="hwb"?h=Hz(p,x,T):e[1]==="hsv"?h=Xz(p,x,T):h=Wb(p,x,T),{r:h[0],g:h[1],b:h[2],a}}function Zz(i,e){var a=$b(i);a[0]=tA(a[0]+e),a=Wb(a),i.r=a[0],i.g=a[1],i.b=a[2]}function Yz(i){if(!i)return;const e=$b(i),a=e[0],h=fT(e[1]),p=fT(e[2]);return i.a<255?`hsla(${a}, ${h}%, ${p}%, ${rh(i.a)})`:`hsl(${a}, ${h}%, ${p}%)`}const pT={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},mT={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Kz(){const i={},e=Object.keys(mT),a=Object.keys(pT);let h,p,x,T,P;for(h=0;h<e.length;h++){for(T=P=e[h],p=0;p<a.length;p++)x=a[p],P=P.replace(x,pT[x]);x=parseInt(mT[T],16),i[P]=[x>>16&255,x>>8&255,x&255]}return i}let My;function Jz(i){My||(My=Kz(),My.transparent=[0,0,0,0]);const e=My[i.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const Qz=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function tO(i){const e=Qz.exec(i);let a=255,h,p,x;if(e){if(e[7]!==h){const T=+e[7];a=e[8]?bg(T):Eu(T*255,0,255)}return h=+e[1],p=+e[3],x=+e[5],h=255&(e[2]?bg(h):Eu(h,0,255)),p=255&(e[4]?bg(p):Eu(p,0,255)),x=255&(e[6]?bg(x):Eu(x,0,255)),{r:h,g:p,b:x,a}}}function eO(i){return i&&(i.a<255?`rgba(${i.r}, ${i.g}, ${i.b}, ${rh(i.a)})`:`rgb(${i.r}, ${i.g}, ${i.b})`)}const _v=i=>i<=.0031308?i*12.92:Math.pow(i,1/2.4)*1.055-.055,Dp=i=>i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4);function iO(i,e,a){const h=Dp(rh(i.r)),p=Dp(rh(i.g)),x=Dp(rh(i.b));return{r:Pu(_v(h+a*(Dp(rh(e.r))-h))),g:Pu(_v(p+a*(Dp(rh(e.g))-p))),b:Pu(_v(x+a*(Dp(rh(e.b))-x))),a:i.a+a*(e.a-i.a)}}function Ay(i,e,a){if(i){let h=$b(i);h[e]=Math.max(0,Math.min(h[e]+h[e]*a,e===0?360:1)),h=Wb(h),i.r=h[0],i.g=h[1],i.b=h[2]}}function eA(i,e){return i&&Object.assign(e||{},i)}function gT(i){var e={r:0,g:0,b:0,a:255};return Array.isArray(i)?i.length>=3&&(e={r:i[0],g:i[1],b:i[2],a:255},i.length>3&&(e.a=Pu(i[3]))):(e=eA(i,{r:0,g:0,b:0,a:1}),e.a=Pu(e.a)),e}function sO(i){return i.charAt(0)==="r"?tO(i):qz(i)}class Kg{constructor(e){if(e instanceof Kg)return e;const a=typeof e;let h;a==="object"?h=gT(e):a==="string"&&(h=Nz(e)||Jz(e)||sO(e)),this._rgb=h,this._valid=!!h}get valid(){return this._valid}get rgb(){var e=eA(this._rgb);return e&&(e.a=rh(e.a)),e}set rgb(e){this._rgb=gT(e)}rgbString(){return this._valid?eO(this._rgb):void 0}hexString(){return this._valid?Uz(this._rgb):void 0}hslString(){return this._valid?Yz(this._rgb):void 0}mix(e,a){if(e){const h=this.rgb,p=e.rgb;let x;const T=a===x?.5:a,P=2*T-1,o=h.a-p.a,z=((P*o===-1?P:(P+o)/(1+P*o))+1)/2;x=1-z,h.r=255&z*h.r+x*p.r+.5,h.g=255&z*h.g+x*p.g+.5,h.b=255&z*h.b+x*p.b+.5,h.a=T*h.a+(1-T)*p.a,this.rgb=h}return this}interpolate(e,a){return e&&(this._rgb=iO(this._rgb,e._rgb,a)),this}clone(){return new Kg(this.rgb)}alpha(e){return this._rgb.a=Pu(e),this}clearer(e){const a=this._rgb;return a.a*=1-e,this}greyscale(){const e=this._rgb,a=a_(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=a,this}opaquer(e){const a=this._rgb;return a.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Ay(this._rgb,2,e),this}darken(e){return Ay(this._rgb,2,-e),this}saturate(e){return Ay(this._rgb,1,e),this}desaturate(e){return Ay(this._rgb,1,-e),this}rotate(e){return Zz(this._rgb,e),this}}/*!
 * Chart.js v4.5.0
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function eh(){}const nO=(()=>{let i=0;return()=>i++})();function fn(i){return i==null}function kr(i){if(Array.isArray&&Array.isArray(i))return!0;const e=Object.prototype.toString.call(i);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function Fs(i){return i!==null&&Object.prototype.toString.call(i)==="[object Object]"}function Ga(i){return(typeof i=="number"||i instanceof Number)&&isFinite(+i)}function cc(i,e){return Ga(i)?i:e}function qs(i,e){return typeof i>"u"?e:i}const rO=(i,e)=>typeof i=="string"&&i.endsWith("%")?parseFloat(i)/100*e:+i;function kn(i,e,a){if(i&&typeof i.call=="function")return i.apply(a,e)}function sn(i,e,a,h){let p,x,T;if(kr(i))for(x=i.length,p=0;p<x;p++)e.call(a,i[p],p);else if(Fs(i))for(T=Object.keys(i),x=T.length,p=0;p<x;p++)e.call(a,i[T[p]],T[p])}function ux(i,e){let a,h,p,x;if(!i||!e||i.length!==e.length)return!1;for(a=0,h=i.length;a<h;++a)if(p=i[a],x=e[a],p.datasetIndex!==x.datasetIndex||p.index!==x.index)return!1;return!0}function dx(i){if(kr(i))return i.map(dx);if(Fs(i)){const e=Object.create(null),a=Object.keys(i),h=a.length;let p=0;for(;p<h;++p)e[a[p]]=dx(i[a[p]]);return e}return i}function iA(i){return["__proto__","prototype","constructor"].indexOf(i)===-1}function oO(i,e,a,h){if(!iA(i))return;const p=e[i],x=a[i];Fs(p)&&Fs(x)?Jg(p,x,h):e[i]=dx(x)}function Jg(i,e,a){const h=kr(e)?e:[e],p=h.length;if(!Fs(i))return i;a=a||{};const x=a.merger||oO;let T;for(let P=0;P<p;++P){if(T=h[P],!Fs(T))continue;const o=Object.keys(T);for(let z=0,$=o.length;z<$;++z)x(o[z],i,T,a)}return i}function Rg(i,e){return Jg(i,e,{merger:aO})}function aO(i,e,a){if(!iA(i))return;const h=e[i],p=a[i];Fs(h)&&Fs(p)?Rg(h,p):Object.prototype.hasOwnProperty.call(e,i)||(e[i]=dx(p))}const _T={"":i=>i,x:i=>i.x,y:i=>i.y};function lO(i){const e=i.split("."),a=[];let h="";for(const p of e)h+=p,h.endsWith("\\")?h=h.slice(0,-1)+".":(a.push(h),h="");return a}function cO(i){const e=lO(i);return a=>{for(const h of e){if(h==="")break;a=a&&a[h]}return a}}function em(i,e){return(_T[e]||(_T[e]=cO(e)))(i)}function Hb(i){return i.charAt(0).toUpperCase()+i.slice(1)}const Qg=i=>typeof i<"u",Ru=i=>typeof i=="function",yT=(i,e)=>{if(i.size!==e.size)return!1;for(const a of i)if(!e.has(a))return!1;return!0};function hO(i){return i.type==="mouseup"||i.type==="click"||i.type==="contextmenu"}const Xo=Math.PI,Iu=2*Xo,fx=Number.POSITIVE_INFINITY,uO=Xo/180,xl=Xo/2,af=Xo/4,xT=Xo*2/3,sA=Math.log10,Lu=Math.sign;function $y(i,e,a){return Math.abs(i-e)<a}function vT(i){const e=Math.round(i);i=$y(i,e,i/1e3)?e:i;const a=Math.pow(10,Math.floor(sA(i))),h=i/a;return(h<=1?1:h<=2?2:h<=5?5:10)*a}function dO(i){const e=[],a=Math.sqrt(i);let h;for(h=1;h<a;h++)i%h===0&&(e.push(h),e.push(i/h));return a===(a|0)&&e.push(a),e.sort((p,x)=>p-x).pop(),e}function fO(i){return typeof i=="symbol"||typeof i=="object"&&i!==null&&!(Symbol.toPrimitive in i||"toString"in i||"valueOf"in i)}function px(i){return!fO(i)&&!isNaN(parseFloat(i))&&isFinite(i)}function pO(i,e){const a=Math.round(i);return a-e<=i&&a+e>=i}function mO(i,e,a){let h,p,x;for(h=0,p=i.length;h<p;h++)x=i[h][a],isNaN(x)||(e.min=Math.min(e.min,x),e.max=Math.max(e.max,x))}function df(i){return i*(Xo/180)}function gO(i){return i*(180/Xo)}function bT(i){if(!Ga(i))return;let e=1,a=0;for(;Math.round(i*e)/e!==i;)e*=10,a++;return a}function _O(i,e){const a=e.x-i.x,h=e.y-i.y,p=Math.sqrt(a*a+h*h);let x=Math.atan2(h,a);return x<-.5*Xo&&(x+=Iu),{angle:x,distance:p}}function yO(i,e){return Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2))}function lf(i){return(i%Iu+Iu)%Iu}function xO(i,e,a,h){const p=lf(i),x=lf(e),T=lf(a),P=lf(x-p),o=lf(T-p),z=lf(p-x),$=lf(p-T);return p===x||p===T||h||P>o&&z<$}function vl(i,e,a){return Math.max(e,Math.min(a,i))}function vO(i){return vl(i,-32768,32767)}function Fp(i,e,a,h=1e-6){return i>=Math.min(e,a)-h&&i<=Math.max(e,a)+h}function Xb(i,e,a){a=a||(T=>i[T]<e);let h=i.length-1,p=0,x;for(;h-p>1;)x=p+h>>1,a(x)?p=x:h=x;return{lo:p,hi:h}}const ib=(i,e,a,h)=>Xb(i,a,h?p=>{const x=i[p][e];return x<a||x===a&&i[p+1][e]===a}:p=>i[p][e]<a),bO=(i,e,a)=>Xb(i,a,h=>i[h][e]>=a);function wO(i,e,a){let h=0,p=i.length;for(;h<p&&i[h]<e;)h++;for(;p>h&&i[p-1]>a;)p--;return h>0||p<i.length?i.slice(h,p):i}const nA=["push","pop","shift","splice","unshift"];function TO(i,e){if(i._chartjs){i._chartjs.listeners.push(e);return}Object.defineProperty(i,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),nA.forEach(a=>{const h="_onData"+Hb(a),p=i[a];Object.defineProperty(i,a,{configurable:!0,enumerable:!1,value(...x){const T=p.apply(this,x);return i._chartjs.listeners.forEach(P=>{typeof P[h]=="function"&&P[h](...x)}),T}})})}function wT(i,e){const a=i._chartjs;if(!a)return;const h=a.listeners,p=h.indexOf(e);p!==-1&&h.splice(p,1),!(h.length>0)&&(nA.forEach(x=>{delete i[x]}),delete i._chartjs)}function rA(i){const e=new Set(i);return e.size===i.length?i:Array.from(e)}const oA=function(){return typeof window>"u"?function(i){return i()}:window.requestAnimationFrame}();function aA(i,e){let a=[],h=!1;return function(...p){a=p,h||(h=!0,oA.call(window,()=>{h=!1,i.apply(e,a)}))}}function SO(i,e){let a;return function(...h){return e?(clearTimeout(a),a=setTimeout(i,e,h)):i.apply(this,h),e}}const lA=i=>i==="start"?"left":i==="end"?"right":"center",ga=(i,e,a)=>i==="start"?e:i==="end"?a:(e+a)/2,EO=(i,e,a,h)=>i===(h?"left":"right")?a:i==="center"?(e+a)/2:e,Cy=i=>i===0||i===1,TT=(i,e,a)=>-(Math.pow(2,10*(i-=1))*Math.sin((i-e)*Iu/a)),ST=(i,e,a)=>Math.pow(2,-10*i)*Math.sin((i-e)*Iu/a)+1,Bg={linear:i=>i,easeInQuad:i=>i*i,easeOutQuad:i=>-i*(i-2),easeInOutQuad:i=>(i/=.5)<1?.5*i*i:-.5*(--i*(i-2)-1),easeInCubic:i=>i*i*i,easeOutCubic:i=>(i-=1)*i*i+1,easeInOutCubic:i=>(i/=.5)<1?.5*i*i*i:.5*((i-=2)*i*i+2),easeInQuart:i=>i*i*i*i,easeOutQuart:i=>-((i-=1)*i*i*i-1),easeInOutQuart:i=>(i/=.5)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2),easeInQuint:i=>i*i*i*i*i,easeOutQuint:i=>(i-=1)*i*i*i*i+1,easeInOutQuint:i=>(i/=.5)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2),easeInSine:i=>-Math.cos(i*xl)+1,easeOutSine:i=>Math.sin(i*xl),easeInOutSine:i=>-.5*(Math.cos(Xo*i)-1),easeInExpo:i=>i===0?0:Math.pow(2,10*(i-1)),easeOutExpo:i=>i===1?1:-Math.pow(2,-10*i)+1,easeInOutExpo:i=>Cy(i)?i:i<.5?.5*Math.pow(2,10*(i*2-1)):.5*(-Math.pow(2,-10*(i*2-1))+2),easeInCirc:i=>i>=1?i:-(Math.sqrt(1-i*i)-1),easeOutCirc:i=>Math.sqrt(1-(i-=1)*i),easeInOutCirc:i=>(i/=.5)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1),easeInElastic:i=>Cy(i)?i:TT(i,.075,.3),easeOutElastic:i=>Cy(i)?i:ST(i,.075,.3),easeInOutElastic(i){return Cy(i)?i:i<.5?.5*TT(i*2,.1125,.45):.5+.5*ST(i*2-1,.1125,.45)},easeInBack(i){return i*i*((1.70158+1)*i-1.70158)},easeOutBack(i){return(i-=1)*i*((1.70158+1)*i+1.70158)+1},easeInOutBack(i){let e=1.70158;return(i/=.5)<1?.5*(i*i*(((e*=1.525)+1)*i-e)):.5*((i-=2)*i*(((e*=1.525)+1)*i+e)+2)},easeInBounce:i=>1-Bg.easeOutBounce(1-i),easeOutBounce(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},easeInOutBounce:i=>i<.5?Bg.easeInBounce(i*2)*.5:Bg.easeOutBounce(i*2-1)*.5+.5};function cA(i){if(i&&typeof i=="object"){const e=i.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function ET(i){return cA(i)?i:new Kg(i)}function yv(i){return cA(i)?i:new Kg(i).saturate(.5).darken(.1).hexString()}const MO=["x","y","borderWidth","radius","tension"],AO=["color","borderColor","backgroundColor"];function CO(i){i.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),i.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),i.set("animations",{colors:{type:"color",properties:AO},numbers:{type:"number",properties:MO}}),i.describe("animations",{_fallback:"animation"}),i.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function kO(i){i.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const MT=new Map;function PO(i,e){e=e||{};const a=i+JSON.stringify(e);let h=MT.get(a);return h||(h=new Intl.NumberFormat(i,e),MT.set(a,h)),h}function hA(i,e,a){return PO(e,a).format(i)}const IO={values(i){return kr(i)?i:""+i},numeric(i,e,a){if(i===0)return"0";const h=this.chart.options.locale;let p,x=i;if(a.length>1){const z=Math.max(Math.abs(a[0].value),Math.abs(a[a.length-1].value));(z<1e-4||z>1e15)&&(p="scientific"),x=LO(i,a)}const T=sA(Math.abs(x)),P=isNaN(T)?1:Math.max(Math.min(-1*Math.floor(T),20),0),o={notation:p,minimumFractionDigits:P,maximumFractionDigits:P};return Object.assign(o,this.options.ticks.format),hA(i,h,o)}};function LO(i,e){let a=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(a)>=1&&i!==Math.floor(i)&&(a=i-Math.floor(i)),a}var uA={formatters:IO};function DO(i){i.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,a)=>a.lineWidth,tickColor:(e,a)=>a.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:uA.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),i.route("scale.ticks","color","","color"),i.route("scale.grid","color","","borderColor"),i.route("scale.border","color","","borderColor"),i.route("scale.title","color","","color"),i.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),i.describe("scales",{_fallback:"scale"}),i.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const vf=Object.create(null),sb=Object.create(null);function Fg(i,e){if(!e)return i;const a=e.split(".");for(let h=0,p=a.length;h<p;++h){const x=a[h];i=i[x]||(i[x]=Object.create(null))}return i}function xv(i,e,a){return typeof e=="string"?Jg(Fg(i,e),a):Jg(Fg(i,""),e)}class zO{constructor(e,a){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=h=>h.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(h,p)=>yv(p.backgroundColor),this.hoverBorderColor=(h,p)=>yv(p.borderColor),this.hoverColor=(h,p)=>yv(p.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(a)}set(e,a){return xv(this,e,a)}get(e){return Fg(this,e)}describe(e,a){return xv(sb,e,a)}override(e,a){return xv(vf,e,a)}route(e,a,h,p){const x=Fg(this,e),T=Fg(this,h),P="_"+a;Object.defineProperties(x,{[P]:{value:x[a],writable:!0},[a]:{enumerable:!0,get(){const o=this[P],z=T[p];return Fs(o)?Object.assign({},z,o):qs(o,z)},set(o){this[P]=o}}})}apply(e){e.forEach(a=>a(this))}}var tr=new zO({_scriptable:i=>!i.startsWith("on"),_indexable:i=>i!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[CO,kO,DO]);function OO(i){return!i||fn(i.size)||fn(i.family)?null:(i.style?i.style+" ":"")+(i.weight?i.weight+" ":"")+i.size+"px "+i.family}function AT(i,e,a,h,p){let x=e[p];return x||(x=e[p]=i.measureText(p).width,a.push(p)),x>h&&(h=x),h}function cf(i,e,a){const h=i.currentDevicePixelRatio,p=a!==0?Math.max(a/2,.5):0;return Math.round((e-p)*h)/h+p}function CT(i,e){!e&&!i||(e=e||i.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,i.width,i.height),e.restore())}function kT(i,e,a,h){dA(i,e,a,h,null)}function dA(i,e,a,h,p){let x,T,P,o,z,$,q,Q;const nt=e.pointStyle,Tt=e.rotation,yt=e.radius;let Lt=(Tt||0)*uO;if(nt&&typeof nt=="object"&&(x=nt.toString(),x==="[object HTMLImageElement]"||x==="[object HTMLCanvasElement]")){i.save(),i.translate(a,h),i.rotate(Lt),i.drawImage(nt,-nt.width/2,-nt.height/2,nt.width,nt.height),i.restore();return}if(!(isNaN(yt)||yt<=0)){switch(i.beginPath(),nt){default:p?i.ellipse(a,h,p/2,yt,0,0,Iu):i.arc(a,h,yt,0,Iu),i.closePath();break;case"triangle":$=p?p/2:yt,i.moveTo(a+Math.sin(Lt)*$,h-Math.cos(Lt)*yt),Lt+=xT,i.lineTo(a+Math.sin(Lt)*$,h-Math.cos(Lt)*yt),Lt+=xT,i.lineTo(a+Math.sin(Lt)*$,h-Math.cos(Lt)*yt),i.closePath();break;case"rectRounded":z=yt*.516,o=yt-z,T=Math.cos(Lt+af)*o,q=Math.cos(Lt+af)*(p?p/2-z:o),P=Math.sin(Lt+af)*o,Q=Math.sin(Lt+af)*(p?p/2-z:o),i.arc(a-q,h-P,z,Lt-Xo,Lt-xl),i.arc(a+Q,h-T,z,Lt-xl,Lt),i.arc(a+q,h+P,z,Lt,Lt+xl),i.arc(a-Q,h+T,z,Lt+xl,Lt+Xo),i.closePath();break;case"rect":if(!Tt){o=Math.SQRT1_2*yt,$=p?p/2:o,i.rect(a-$,h-o,2*$,2*o);break}Lt+=af;case"rectRot":q=Math.cos(Lt)*(p?p/2:yt),T=Math.cos(Lt)*yt,P=Math.sin(Lt)*yt,Q=Math.sin(Lt)*(p?p/2:yt),i.moveTo(a-q,h-P),i.lineTo(a+Q,h-T),i.lineTo(a+q,h+P),i.lineTo(a-Q,h+T),i.closePath();break;case"crossRot":Lt+=af;case"cross":q=Math.cos(Lt)*(p?p/2:yt),T=Math.cos(Lt)*yt,P=Math.sin(Lt)*yt,Q=Math.sin(Lt)*(p?p/2:yt),i.moveTo(a-q,h-P),i.lineTo(a+q,h+P),i.moveTo(a+Q,h-T),i.lineTo(a-Q,h+T);break;case"star":q=Math.cos(Lt)*(p?p/2:yt),T=Math.cos(Lt)*yt,P=Math.sin(Lt)*yt,Q=Math.sin(Lt)*(p?p/2:yt),i.moveTo(a-q,h-P),i.lineTo(a+q,h+P),i.moveTo(a+Q,h-T),i.lineTo(a-Q,h+T),Lt+=af,q=Math.cos(Lt)*(p?p/2:yt),T=Math.cos(Lt)*yt,P=Math.sin(Lt)*yt,Q=Math.sin(Lt)*(p?p/2:yt),i.moveTo(a-q,h-P),i.lineTo(a+q,h+P),i.moveTo(a+Q,h-T),i.lineTo(a-Q,h+T);break;case"line":T=p?p/2:Math.cos(Lt)*yt,P=Math.sin(Lt)*yt,i.moveTo(a-T,h-P),i.lineTo(a+T,h+P);break;case"dash":i.moveTo(a,h),i.lineTo(a+Math.cos(Lt)*(p?p/2:yt),h+Math.sin(Lt)*yt);break;case!1:i.closePath();break}i.fill(),e.borderWidth>0&&i.stroke()}}function fA(i,e,a){return a=a||.5,!e||i&&i.x>e.left-a&&i.x<e.right+a&&i.y>e.top-a&&i.y<e.bottom+a}function qb(i,e){i.save(),i.beginPath(),i.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),i.clip()}function Zb(i){i.restore()}function RO(i,e){e.translation&&i.translate(e.translation[0],e.translation[1]),fn(e.rotation)||i.rotate(e.rotation),e.color&&(i.fillStyle=e.color),e.textAlign&&(i.textAlign=e.textAlign),e.textBaseline&&(i.textBaseline=e.textBaseline)}function BO(i,e,a,h,p){if(p.strikethrough||p.underline){const x=i.measureText(h),T=e-x.actualBoundingBoxLeft,P=e+x.actualBoundingBoxRight,o=a-x.actualBoundingBoxAscent,z=a+x.actualBoundingBoxDescent,$=p.strikethrough?(o+z)/2:z;i.strokeStyle=i.fillStyle,i.beginPath(),i.lineWidth=p.decorationWidth||2,i.moveTo(T,$),i.lineTo(P,$),i.stroke()}}function FO(i,e){const a=i.fillStyle;i.fillStyle=e.color,i.fillRect(e.left,e.top,e.width,e.height),i.fillStyle=a}function mx(i,e,a,h,p,x={}){const T=kr(e)?e:[e],P=x.strokeWidth>0&&x.strokeColor!=="";let o,z;for(i.save(),i.font=p.string,RO(i,x),o=0;o<T.length;++o)z=T[o],x.backdrop&&FO(i,x.backdrop),P&&(x.strokeColor&&(i.strokeStyle=x.strokeColor),fn(x.strokeWidth)||(i.lineWidth=x.strokeWidth),i.strokeText(z,a,h,x.maxWidth)),i.fillText(z,a,h,x.maxWidth),BO(i,a,h,z,x),h+=Number(p.lineHeight);i.restore()}function gx(i,e){const{x:a,y:h,w:p,h:x,radius:T}=e;i.arc(a+T.topLeft,h+T.topLeft,T.topLeft,1.5*Xo,Xo,!0),i.lineTo(a,h+x-T.bottomLeft),i.arc(a+T.bottomLeft,h+x-T.bottomLeft,T.bottomLeft,Xo,xl,!0),i.lineTo(a+p-T.bottomRight,h+x),i.arc(a+p-T.bottomRight,h+x-T.bottomRight,T.bottomRight,xl,0,!0),i.lineTo(a+p,h+T.topRight),i.arc(a+p-T.topRight,h+T.topRight,T.topRight,0,-xl,!0),i.lineTo(a+T.topLeft,h)}const NO=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,jO=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function UO(i,e){const a=(""+i).match(NO);if(!a||a[1]==="normal")return e*1.2;switch(i=+a[2],a[3]){case"px":return i;case"%":i/=100;break}return e*i}const VO=i=>+i||0;function pA(i,e){const a={},h=Fs(e),p=h?Object.keys(e):e,x=Fs(i)?h?T=>qs(i[T],i[e[T]]):T=>i[T]:()=>i;for(const T of p)a[T]=VO(x(T));return a}function mA(i){return pA(i,{top:"y",right:"x",bottom:"y",left:"x"})}function Xp(i){return pA(i,["topLeft","topRight","bottomLeft","bottomRight"])}function Sl(i){const e=mA(i);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function Ho(i,e){i=i||{},e=e||tr.font;let a=qs(i.size,e.size);typeof a=="string"&&(a=parseInt(a,10));let h=qs(i.style,e.style);h&&!(""+h).match(jO)&&(console.warn('Invalid font style specified: "'+h+'"'),h=void 0);const p={family:qs(i.family,e.family),lineHeight:UO(qs(i.lineHeight,e.lineHeight),a),size:a,style:h,weight:qs(i.weight,e.weight),string:""};return p.string=OO(p),p}function ky(i,e,a,h){let p,x,T;for(p=0,x=i.length;p<x;++p)if(T=i[p],T!==void 0&&T!==void 0)return T}function $O(i,e,a){const{min:h,max:p}=i,x=rO(e,(p-h)/2),T=(P,o)=>a&&P===0?0:P+o;return{min:T(h,-Math.abs(x)),max:T(p,x)}}function am(i,e){return Object.assign(Object.create(i),e)}function Yb(i,e=[""],a,h,p=()=>i[0]){const x=a||i;typeof h>"u"&&(h=xA("_fallback",i));const T={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:i,_rootScopes:x,_fallback:h,_getTarget:p,override:P=>Yb([P,...i],e,x,h)};return new Proxy(T,{deleteProperty(P,o){return delete P[o],delete P._keys,delete i[0][o],!0},get(P,o){return _A(P,o,()=>KO(o,e,i,P))},getOwnPropertyDescriptor(P,o){return Reflect.getOwnPropertyDescriptor(P._scopes[0],o)},getPrototypeOf(){return Reflect.getPrototypeOf(i[0])},has(P,o){return IT(P).includes(o)},ownKeys(P){return IT(P)},set(P,o,z){const $=P._storage||(P._storage=p());return P[o]=$[o]=z,delete P._keys,!0}})}function im(i,e,a,h){const p={_cacheable:!1,_proxy:i,_context:e,_subProxy:a,_stack:new Set,_descriptors:gA(i,h),setContext:x=>im(i,x,a,h),override:x=>im(i.override(x),e,a,h)};return new Proxy(p,{deleteProperty(x,T){return delete x[T],delete i[T],!0},get(x,T,P){return _A(x,T,()=>WO(x,T,P))},getOwnPropertyDescriptor(x,T){return x._descriptors.allKeys?Reflect.has(i,T)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(i,T)},getPrototypeOf(){return Reflect.getPrototypeOf(i)},has(x,T){return Reflect.has(i,T)},ownKeys(){return Reflect.ownKeys(i)},set(x,T,P){return i[T]=P,delete x[T],!0}})}function gA(i,e={scriptable:!0,indexable:!0}){const{_scriptable:a=e.scriptable,_indexable:h=e.indexable,_allKeys:p=e.allKeys}=i;return{allKeys:p,scriptable:a,indexable:h,isScriptable:Ru(a)?a:()=>a,isIndexable:Ru(h)?h:()=>h}}const GO=(i,e)=>i?i+Hb(e):e,Kb=(i,e)=>Fs(e)&&i!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function _A(i,e,a){if(Object.prototype.hasOwnProperty.call(i,e)||e==="constructor")return i[e];const h=a();return i[e]=h,h}function WO(i,e,a){const{_proxy:h,_context:p,_subProxy:x,_descriptors:T}=i;let P=h[e];return Ru(P)&&T.isScriptable(e)&&(P=HO(e,P,i,a)),kr(P)&&P.length&&(P=XO(e,P,i,T.isIndexable)),Kb(e,P)&&(P=im(P,p,x&&x[e],T)),P}function HO(i,e,a,h){const{_proxy:p,_context:x,_subProxy:T,_stack:P}=a;if(P.has(i))throw new Error("Recursion detected: "+Array.from(P).join("->")+"->"+i);P.add(i);let o=e(x,T||h);return P.delete(i),Kb(i,o)&&(o=Jb(p._scopes,p,i,o)),o}function XO(i,e,a,h){const{_proxy:p,_context:x,_subProxy:T,_descriptors:P}=a;if(typeof x.index<"u"&&h(i))return e[x.index%e.length];if(Fs(e[0])){const o=e,z=p._scopes.filter($=>$!==o);e=[];for(const $ of o){const q=Jb(z,p,i,$);e.push(im(q,x,T&&T[i],P))}}return e}function yA(i,e,a){return Ru(i)?i(e,a):i}const qO=(i,e)=>i===!0?e:typeof i=="string"?em(e,i):void 0;function ZO(i,e,a,h,p){for(const x of e){const T=qO(a,x);if(T){i.add(T);const P=yA(T._fallback,a,p);if(typeof P<"u"&&P!==a&&P!==h)return P}else if(T===!1&&typeof h<"u"&&a!==h)return null}return!1}function Jb(i,e,a,h){const p=e._rootScopes,x=yA(e._fallback,a,h),T=[...i,...p],P=new Set;P.add(h);let o=PT(P,T,a,x||a,h);return o===null||typeof x<"u"&&x!==a&&(o=PT(P,T,x,o,h),o===null)?!1:Yb(Array.from(P),[""],p,x,()=>YO(e,a,h))}function PT(i,e,a,h,p){for(;a;)a=ZO(i,e,a,h,p);return a}function YO(i,e,a){const h=i._getTarget();e in h||(h[e]={});const p=h[e];return kr(p)&&Fs(a)?a:p||{}}function KO(i,e,a,h){let p;for(const x of e)if(p=xA(GO(x,i),a),typeof p<"u")return Kb(i,p)?Jb(a,h,i,p):p}function xA(i,e){for(const a of e){if(!a)continue;const h=a[i];if(typeof h<"u")return h}}function IT(i){let e=i._keys;return e||(e=i._keys=JO(i._scopes)),e}function JO(i){const e=new Set;for(const a of i)for(const h of Object.keys(a).filter(p=>!p.startsWith("_")))e.add(h);return Array.from(e)}function Qb(){return typeof window<"u"&&typeof document<"u"}function t1(i){let e=i.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function _x(i,e,a){let h;return typeof i=="string"?(h=parseInt(i,10),i.indexOf("%")!==-1&&(h=h/100*e.parentNode[a])):h=i,h}const $x=i=>i.ownerDocument.defaultView.getComputedStyle(i,null);function QO(i,e){return $x(i).getPropertyValue(e)}const tR=["top","right","bottom","left"];function gf(i,e,a){const h={};a=a?"-"+a:"";for(let p=0;p<4;p++){const x=tR[p];h[x]=parseFloat(i[e+"-"+x+a])||0}return h.width=h.left+h.right,h.height=h.top+h.bottom,h}const eR=(i,e,a)=>(i>0||e>0)&&(!a||!a.shadowRoot);function iR(i,e){const a=i.touches,h=a&&a.length?a[0]:i,{offsetX:p,offsetY:x}=h;let T=!1,P,o;if(eR(p,x,i.target))P=p,o=x;else{const z=e.getBoundingClientRect();P=h.clientX-z.left,o=h.clientY-z.top,T=!0}return{x:P,y:o,box:T}}function uf(i,e){if("native"in i)return i;const{canvas:a,currentDevicePixelRatio:h}=e,p=$x(a),x=p.boxSizing==="border-box",T=gf(p,"padding"),P=gf(p,"border","width"),{x:o,y:z,box:$}=iR(i,a),q=T.left+($&&P.left),Q=T.top+($&&P.top);let{width:nt,height:Tt}=e;return x&&(nt-=T.width+P.width,Tt-=T.height+P.height),{x:Math.round((o-q)/nt*a.width/h),y:Math.round((z-Q)/Tt*a.height/h)}}function sR(i,e,a){let h,p;if(e===void 0||a===void 0){const x=i&&t1(i);if(!x)e=i.clientWidth,a=i.clientHeight;else{const T=x.getBoundingClientRect(),P=$x(x),o=gf(P,"border","width"),z=gf(P,"padding");e=T.width-z.width-o.width,a=T.height-z.height-o.height,h=_x(P.maxWidth,x,"clientWidth"),p=_x(P.maxHeight,x,"clientHeight")}}return{width:e,height:a,maxWidth:h||fx,maxHeight:p||fx}}const Py=i=>Math.round(i*10)/10;function nR(i,e,a,h){const p=$x(i),x=gf(p,"margin"),T=_x(p.maxWidth,i,"clientWidth")||fx,P=_x(p.maxHeight,i,"clientHeight")||fx,o=sR(i,e,a);let{width:z,height:$}=o;if(p.boxSizing==="content-box"){const Q=gf(p,"border","width"),nt=gf(p,"padding");z-=nt.width+Q.width,$-=nt.height+Q.height}return z=Math.max(0,z-x.width),$=Math.max(0,h?z/h:$-x.height),z=Py(Math.min(z,T,o.maxWidth)),$=Py(Math.min($,P,o.maxHeight)),z&&!$&&($=Py(z/2)),(e!==void 0||a!==void 0)&&h&&o.height&&$>o.height&&($=o.height,z=Py(Math.floor($*h))),{width:z,height:$}}function LT(i,e,a){const h=e||1,p=Math.floor(i.height*h),x=Math.floor(i.width*h);i.height=Math.floor(i.height),i.width=Math.floor(i.width);const T=i.canvas;return T.style&&(a||!T.style.height&&!T.style.width)&&(T.style.height=`${i.height}px`,T.style.width=`${i.width}px`),i.currentDevicePixelRatio!==h||T.height!==p||T.width!==x?(i.currentDevicePixelRatio=h,T.height=p,T.width=x,i.ctx.setTransform(h,0,0,h,0,0),!0):!1}const rR=function(){let i=!1;try{const e={get passive(){return i=!0,!1}};Qb()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return i}();function DT(i,e){const a=QO(i,e),h=a&&a.match(/^(\d+)(\.\d+)?px$/);return h?+h[1]:void 0}const oR=function(i,e){return{x(a){return i+i+e-a},setWidth(a){e=a},textAlign(a){return a==="center"?a:a==="right"?"left":"right"},xPlus(a,h){return a-h},leftForLtr(a,h){return a-h}}},aR=function(){return{x(i){return i},setWidth(i){},textAlign(i){return i},xPlus(i,e){return i+e},leftForLtr(i,e){return i}}};function qp(i,e,a){return i?oR(e,a):aR()}function vA(i,e){let a,h;(e==="ltr"||e==="rtl")&&(a=i.canvas.style,h=[a.getPropertyValue("direction"),a.getPropertyPriority("direction")],a.setProperty("direction",e,"important"),i.prevTextDirection=h)}function bA(i,e){e!==void 0&&(delete i.prevTextDirection,i.canvas.style.setProperty("direction",e[0],e[1]))}function Iy(i,e,a){return i.options.clip?i[a]:e[a]}function lR(i,e){const{xScale:a,yScale:h}=i;return a&&h?{left:Iy(a,e,"left"),right:Iy(a,e,"right"),top:Iy(h,e,"top"),bottom:Iy(h,e,"bottom")}:e}function cR(i,e){const a=e._clip;if(a.disabled)return!1;const h=lR(e,i.chartArea);return{left:a.left===!1?0:h.left-(a.left===!0?0:a.left),right:a.right===!1?i.width:h.right+(a.right===!0?0:a.right),top:a.top===!1?0:h.top-(a.top===!0?0:a.top),bottom:a.bottom===!1?i.height:h.bottom+(a.bottom===!0?0:a.bottom)}}/*!
 * Chart.js v4.5.0
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class hR{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,a,h,p){const x=a.listeners[p],T=a.duration;x.forEach(P=>P({chart:e,initial:a.initial,numSteps:T,currentStep:Math.min(h-a.start,T)}))}_refresh(){this._request||(this._running=!0,this._request=oA.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let a=0;this._charts.forEach((h,p)=>{if(!h.running||!h.items.length)return;const x=h.items;let T=x.length-1,P=!1,o;for(;T>=0;--T)o=x[T],o._active?(o._total>h.duration&&(h.duration=o._total),o.tick(e),P=!0):(x[T]=x[x.length-1],x.pop());P&&(p.draw(),this._notify(p,h,e,"progress")),x.length||(h.running=!1,this._notify(p,h,e,"complete"),h.initial=!1),a+=x.length}),this._lastDate=e,a===0&&(this._running=!1)}_getAnims(e){const a=this._charts;let h=a.get(e);return h||(h={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},a.set(e,h)),h}listen(e,a,h){this._getAnims(e).listeners[a].push(h)}add(e,a){!a||!a.length||this._getAnims(e).items.push(...a)}has(e){return this._getAnims(e).items.length>0}start(e){const a=this._charts.get(e);a&&(a.running=!0,a.start=Date.now(),a.duration=a.items.reduce((h,p)=>Math.max(h,p._duration),0),this._refresh())}running(e){if(!this._running)return!1;const a=this._charts.get(e);return!(!a||!a.running||!a.items.length)}stop(e){const a=this._charts.get(e);if(!a||!a.items.length)return;const h=a.items;let p=h.length-1;for(;p>=0;--p)h[p].cancel();a.items=[],this._notify(e,a,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var ih=new hR;const zT="transparent",uR={boolean(i,e,a){return a>.5?e:i},color(i,e,a){const h=ET(i||zT),p=h.valid&&ET(e||zT);return p&&p.valid?p.mix(h,a).hexString():e},number(i,e,a){return i+(e-i)*a}};class dR{constructor(e,a,h,p){const x=a[h];p=ky([e.to,p,x,e.from]);const T=ky([e.from,x,p]);this._active=!0,this._fn=e.fn||uR[e.type||typeof T],this._easing=Bg[e.easing]||Bg.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=a,this._prop=h,this._from=T,this._to=p,this._promises=void 0}active(){return this._active}update(e,a,h){if(this._active){this._notify(!1);const p=this._target[this._prop],x=h-this._start,T=this._duration-x;this._start=h,this._duration=Math.floor(Math.max(T,e.duration)),this._total+=x,this._loop=!!e.loop,this._to=ky([e.to,a,p,e.from]),this._from=ky([e.from,p,a])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const a=e-this._start,h=this._duration,p=this._prop,x=this._from,T=this._loop,P=this._to;let o;if(this._active=x!==P&&(T||a<h),!this._active){this._target[p]=P,this._notify(!0);return}if(a<0){this._target[p]=x;return}o=a/h%2,o=T&&o>1?2-o:o,o=this._easing(Math.min(1,Math.max(0,o))),this._target[p]=this._fn(x,P,o)}wait(){const e=this._promises||(this._promises=[]);return new Promise((a,h)=>{e.push({res:a,rej:h})})}_notify(e){const a=e?"res":"rej",h=this._promises||[];for(let p=0;p<h.length;p++)h[p][a]()}}class wA{constructor(e,a){this._chart=e,this._properties=new Map,this.configure(a)}configure(e){if(!Fs(e))return;const a=Object.keys(tr.animation),h=this._properties;Object.getOwnPropertyNames(e).forEach(p=>{const x=e[p];if(!Fs(x))return;const T={};for(const P of a)T[P]=x[P];(kr(x.properties)&&x.properties||[p]).forEach(P=>{(P===p||!h.has(P))&&h.set(P,T)})})}_animateOptions(e,a){const h=a.options,p=pR(e,h);if(!p)return[];const x=this._createAnimations(p,h);return h.$shared&&fR(e.options.$animations,h).then(()=>{e.options=h},()=>{}),x}_createAnimations(e,a){const h=this._properties,p=[],x=e.$animations||(e.$animations={}),T=Object.keys(a),P=Date.now();let o;for(o=T.length-1;o>=0;--o){const z=T[o];if(z.charAt(0)==="$")continue;if(z==="options"){p.push(...this._animateOptions(e,a));continue}const $=a[z];let q=x[z];const Q=h.get(z);if(q)if(Q&&q.active()){q.update(Q,$,P);continue}else q.cancel();if(!Q||!Q.duration){e[z]=$;continue}x[z]=q=new dR(Q,e,z,$),p.push(q)}return p}update(e,a){if(this._properties.size===0){Object.assign(e,a);return}const h=this._createAnimations(e,a);if(h.length)return ih.add(this._chart,h),!0}}function fR(i,e){const a=[],h=Object.keys(e);for(let p=0;p<h.length;p++){const x=i[h[p]];x&&x.active()&&a.push(x.wait())}return Promise.all(a)}function pR(i,e){if(!e)return;let a=i.options;if(!a){i.options=e;return}return a.$shared&&(i.options=a=Object.assign({},a,{$shared:!1,$animations:{}})),a}function OT(i,e){const a=i&&i.options||{},h=a.reverse,p=a.min===void 0?e:0,x=a.max===void 0?e:0;return{start:h?x:p,end:h?p:x}}function mR(i,e,a){if(a===!1)return!1;const h=OT(i,a),p=OT(e,a);return{top:p.end,right:h.end,bottom:p.start,left:h.start}}function gR(i){let e,a,h,p;return Fs(i)?(e=i.top,a=i.right,h=i.bottom,p=i.left):e=a=h=p=i,{top:e,right:a,bottom:h,left:p,disabled:i===!1}}function TA(i,e){const a=[],h=i._getSortedDatasetMetas(e);let p,x;for(p=0,x=h.length;p<x;++p)a.push(h[p].index);return a}function RT(i,e,a,h={}){const p=i.keys,x=h.mode==="single";let T,P,o,z;if(e===null)return;let $=!1;for(T=0,P=p.length;T<P;++T){if(o=+p[T],o===a){if($=!0,h.all)continue;break}z=i.values[o],Ga(z)&&(x||e===0||Lu(e)===Lu(z))&&(e+=z)}return!$&&!h.all?0:e}function _R(i,e){const{iScale:a,vScale:h}=e,p=a.axis==="x"?"x":"y",x=h.axis==="x"?"x":"y",T=Object.keys(i),P=new Array(T.length);let o,z,$;for(o=0,z=T.length;o<z;++o)$=T[o],P[o]={[p]:$,[x]:i[$]};return P}function vv(i,e){const a=i&&i.options.stacked;return a||a===void 0&&e.stack!==void 0}function yR(i,e,a){return`${i.id}.${e.id}.${a.stack||a.type}`}function xR(i){const{min:e,max:a,minDefined:h,maxDefined:p}=i.getUserBounds();return{min:h?e:Number.NEGATIVE_INFINITY,max:p?a:Number.POSITIVE_INFINITY}}function vR(i,e,a){const h=i[e]||(i[e]={});return h[a]||(h[a]={})}function BT(i,e,a,h){for(const p of e.getMatchingVisibleMetas(h).reverse()){const x=i[p.index];if(a&&x>0||!a&&x<0)return p.index}return null}function FT(i,e){const{chart:a,_cachedMeta:h}=i,p=a._stacks||(a._stacks={}),{iScale:x,vScale:T,index:P}=h,o=x.axis,z=T.axis,$=yR(x,T,h),q=e.length;let Q;for(let nt=0;nt<q;++nt){const Tt=e[nt],{[o]:yt,[z]:Lt}=Tt,Nt=Tt._stacks||(Tt._stacks={});Q=Nt[z]=vR(p,$,yt),Q[P]=Lt,Q._top=BT(Q,T,!0,h.type),Q._bottom=BT(Q,T,!1,h.type);const Dt=Q._visualValues||(Q._visualValues={});Dt[P]=Lt}}function bv(i,e){const a=i.scales;return Object.keys(a).filter(h=>a[h].axis===e).shift()}function bR(i,e){return am(i,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function wR(i,e,a){return am(i,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:a,index:e,mode:"default",type:"data"})}function pg(i,e){const a=i.controller.index,h=i.vScale&&i.vScale.axis;if(h){e=e||i._parsed;for(const p of e){const x=p._stacks;if(!x||x[h]===void 0||x[h][a]===void 0)return;delete x[h][a],x[h]._visualValues!==void 0&&x[h]._visualValues[a]!==void 0&&delete x[h]._visualValues[a]}}}const wv=i=>i==="reset"||i==="none",NT=(i,e)=>e?i:Object.assign({},i),TR=(i,e,a)=>i&&!e.hidden&&e._stacked&&{keys:TA(a,!0),values:null};class Ng{constructor(e,a){this.chart=e,this._ctx=e.ctx,this.index=a,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=vv(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&pg(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,a=this._cachedMeta,h=this.getDataset(),p=(q,Q,nt,Tt)=>q==="x"?Q:q==="r"?Tt:nt,x=a.xAxisID=qs(h.xAxisID,bv(e,"x")),T=a.yAxisID=qs(h.yAxisID,bv(e,"y")),P=a.rAxisID=qs(h.rAxisID,bv(e,"r")),o=a.indexAxis,z=a.iAxisID=p(o,x,T,P),$=a.vAxisID=p(o,T,x,P);a.xScale=this.getScaleForId(x),a.yScale=this.getScaleForId(T),a.rScale=this.getScaleForId(P),a.iScale=this.getScaleForId(z),a.vScale=this.getScaleForId($)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const a=this._cachedMeta;return e===a.iScale?a.vScale:a.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&wT(this._data,this),e._stacked&&pg(e)}_dataCheck(){const e=this.getDataset(),a=e.data||(e.data=[]),h=this._data;if(Fs(a)){const p=this._cachedMeta;this._data=_R(a,p)}else if(h!==a){if(h){wT(h,this);const p=this._cachedMeta;pg(p),p._parsed=[]}a&&Object.isExtensible(a)&&TO(a,this),this._syncList=[],this._data=a}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const a=this._cachedMeta,h=this.getDataset();let p=!1;this._dataCheck();const x=a._stacked;a._stacked=vv(a.vScale,a),a.stack!==h.stack&&(p=!0,pg(a),a.stack=h.stack),this._resyncElements(e),(p||x!==a._stacked)&&(FT(this,a._parsed),a._stacked=vv(a.vScale,a))}configure(){const e=this.chart.config,a=e.datasetScopeKeys(this._type),h=e.getOptionScopes(this.getDataset(),a,!0);this.options=e.createResolver(h,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,a){const{_cachedMeta:h,_data:p}=this,{iScale:x,_stacked:T}=h,P=x.axis;let o=e===0&&a===p.length?!0:h._sorted,z=e>0&&h._parsed[e-1],$,q,Q;if(this._parsing===!1)h._parsed=p,h._sorted=!0,Q=p;else{kr(p[e])?Q=this.parseArrayData(h,p,e,a):Fs(p[e])?Q=this.parseObjectData(h,p,e,a):Q=this.parsePrimitiveData(h,p,e,a);const nt=()=>q[P]===null||z&&q[P]<z[P];for($=0;$<a;++$)h._parsed[$+e]=q=Q[$],o&&(nt()&&(o=!1),z=q);h._sorted=o}T&&FT(this,Q)}parsePrimitiveData(e,a,h,p){const{iScale:x,vScale:T}=e,P=x.axis,o=T.axis,z=x.getLabels(),$=x===T,q=new Array(p);let Q,nt,Tt;for(Q=0,nt=p;Q<nt;++Q)Tt=Q+h,q[Q]={[P]:$||x.parse(z[Tt],Tt),[o]:T.parse(a[Tt],Tt)};return q}parseArrayData(e,a,h,p){const{xScale:x,yScale:T}=e,P=new Array(p);let o,z,$,q;for(o=0,z=p;o<z;++o)$=o+h,q=a[$],P[o]={x:x.parse(q[0],$),y:T.parse(q[1],$)};return P}parseObjectData(e,a,h,p){const{xScale:x,yScale:T}=e,{xAxisKey:P="x",yAxisKey:o="y"}=this._parsing,z=new Array(p);let $,q,Q,nt;for($=0,q=p;$<q;++$)Q=$+h,nt=a[Q],z[$]={x:x.parse(em(nt,P),Q),y:T.parse(em(nt,o),Q)};return z}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,a,h){const p=this.chart,x=this._cachedMeta,T=a[e.axis],P={keys:TA(p,!0),values:a._stacks[e.axis]._visualValues};return RT(P,T,x.index,{mode:h})}updateRangeFromParsed(e,a,h,p){const x=h[a.axis];let T=x===null?NaN:x;const P=p&&h._stacks[a.axis];p&&P&&(p.values=P,T=RT(p,x,this._cachedMeta.index)),e.min=Math.min(e.min,T),e.max=Math.max(e.max,T)}getMinMax(e,a){const h=this._cachedMeta,p=h._parsed,x=h._sorted&&e===h.iScale,T=p.length,P=this._getOtherScale(e),o=TR(a,h,this.chart),z={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:$,max:q}=xR(P);let Q,nt;function Tt(){nt=p[Q];const yt=nt[P.axis];return!Ga(nt[e.axis])||$>yt||q<yt}for(Q=0;Q<T&&!(!Tt()&&(this.updateRangeFromParsed(z,e,nt,o),x));++Q);if(x){for(Q=T-1;Q>=0;--Q)if(!Tt()){this.updateRangeFromParsed(z,e,nt,o);break}}return z}getAllParsedValues(e){const a=this._cachedMeta._parsed,h=[];let p,x,T;for(p=0,x=a.length;p<x;++p)T=a[p][e.axis],Ga(T)&&h.push(T);return h}getMaxOverflow(){return!1}getLabelAndValue(e){const a=this._cachedMeta,h=a.iScale,p=a.vScale,x=this.getParsed(e);return{label:h?""+h.getLabelForValue(x[h.axis]):"",value:p?""+p.getLabelForValue(x[p.axis]):""}}_update(e){const a=this._cachedMeta;this.update(e||"default"),a._clip=gR(qs(this.options.clip,mR(a.xScale,a.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,a=this.chart,h=this._cachedMeta,p=h.data||[],x=a.chartArea,T=[],P=this._drawStart||0,o=this._drawCount||p.length-P,z=this.options.drawActiveElementsOnTop;let $;for(h.dataset&&h.dataset.draw(e,x,P,o),$=P;$<P+o;++$){const q=p[$];q.hidden||(q.active&&z?T.push(q):q.draw(e,x))}for($=0;$<T.length;++$)T[$].draw(e,x)}getStyle(e,a){const h=a?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(h):this.resolveDataElementOptions(e||0,h)}getContext(e,a,h){const p=this.getDataset();let x;if(e>=0&&e<this._cachedMeta.data.length){const T=this._cachedMeta.data[e];x=T.$context||(T.$context=wR(this.getContext(),e,T)),x.parsed=this.getParsed(e),x.raw=p.data[e],x.index=x.dataIndex=e}else x=this.$context||(this.$context=bR(this.chart.getContext(),this.index)),x.dataset=p,x.index=x.datasetIndex=this.index;return x.active=!!a,x.mode=h,x}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,a){return this._resolveElementOptions(this.dataElementType.id,a,e)}_resolveElementOptions(e,a="default",h){const p=a==="active",x=this._cachedDataOpts,T=e+"-"+a,P=x[T],o=this.enableOptionSharing&&Qg(h);if(P)return NT(P,o);const z=this.chart.config,$=z.datasetElementScopeKeys(this._type,e),q=p?[`${e}Hover`,"hover",e,""]:[e,""],Q=z.getOptionScopes(this.getDataset(),$),nt=Object.keys(tr.elements[e]),Tt=()=>this.getContext(h,p,a),yt=z.resolveNamedOptions(Q,nt,Tt,q);return yt.$shared&&(yt.$shared=o,x[T]=Object.freeze(NT(yt,o))),yt}_resolveAnimations(e,a,h){const p=this.chart,x=this._cachedDataOpts,T=`animation-${a}`,P=x[T];if(P)return P;let o;if(p.options.animation!==!1){const $=this.chart.config,q=$.datasetAnimationScopeKeys(this._type,a),Q=$.getOptionScopes(this.getDataset(),q);o=$.createResolver(Q,this.getContext(e,h,a))}const z=new wA(p,o&&o.animations);return o&&o._cacheable&&(x[T]=Object.freeze(z)),z}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,a){return!a||wv(e)||this.chart._animationsDisabled}_getSharedOptions(e,a){const h=this.resolveDataElementOptions(e,a),p=this._sharedOptions,x=this.getSharedOptions(h),T=this.includeOptions(a,x)||x!==p;return this.updateSharedOptions(x,a,h),{sharedOptions:x,includeOptions:T}}updateElement(e,a,h,p){wv(p)?Object.assign(e,h):this._resolveAnimations(a,p).update(e,h)}updateSharedOptions(e,a,h){e&&!wv(a)&&this._resolveAnimations(void 0,a).update(e,h)}_setStyle(e,a,h,p){e.active=p;const x=this.getStyle(a,p);this._resolveAnimations(a,h,p).update(e,{options:!p&&this.getSharedOptions(x)||x})}removeHoverStyle(e,a,h){this._setStyle(e,h,"active",!1)}setHoverStyle(e,a,h){this._setStyle(e,h,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const a=this._data,h=this._cachedMeta.data;for(const[P,o,z]of this._syncList)this[P](o,z);this._syncList=[];const p=h.length,x=a.length,T=Math.min(x,p);T&&this.parse(0,T),x>p?this._insertElements(p,x-p,e):x<p&&this._removeElements(x,p-x)}_insertElements(e,a,h=!0){const p=this._cachedMeta,x=p.data,T=e+a;let P;const o=z=>{for(z.length+=a,P=z.length-1;P>=T;P--)z[P]=z[P-a]};for(o(x),P=e;P<T;++P)x[P]=new this.dataElementType;this._parsing&&o(p._parsed),this.parse(e,a),h&&this.updateElements(x,e,a,"reset")}updateElements(e,a,h,p){}_removeElements(e,a){const h=this._cachedMeta;if(this._parsing){const p=h._parsed.splice(e,a);h._stacked&&pg(h,p)}h.data.splice(e,a)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[a,h,p]=e;this[a](h,p)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,a){a&&this._sync(["_removeElements",e,a]);const h=arguments.length-2;h&&this._sync(["_insertElements",e,h])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}Ls(Ng,"defaults",{}),Ls(Ng,"datasetElementType",null),Ls(Ng,"dataElementType",null);function SR(i,e){if(!i._cache.$bar){const a=i.getMatchingVisibleMetas(e);let h=[];for(let p=0,x=a.length;p<x;p++)h=h.concat(a[p].controller.getAllParsedValues(i));i._cache.$bar=rA(h.sort((p,x)=>p-x))}return i._cache.$bar}function ER(i){const e=i.iScale,a=SR(e,i.type);let h=e._length,p,x,T,P;const o=()=>{T===32767||T===-32768||(Qg(P)&&(h=Math.min(h,Math.abs(T-P)||h)),P=T)};for(p=0,x=a.length;p<x;++p)T=e.getPixelForValue(a[p]),o();for(P=void 0,p=0,x=e.ticks.length;p<x;++p)T=e.getPixelForTick(p),o();return h}function MR(i,e,a,h){const p=a.barThickness;let x,T;return fn(p)?(x=e.min*a.categoryPercentage,T=a.barPercentage):(x=p*h,T=1),{chunk:x/h,ratio:T,start:e.pixels[i]-x/2}}function AR(i,e,a,h){const p=e.pixels,x=p[i];let T=i>0?p[i-1]:null,P=i<p.length-1?p[i+1]:null;const o=a.categoryPercentage;T===null&&(T=x-(P===null?e.end-e.start:P-x)),P===null&&(P=x+x-T);const z=x-(x-Math.min(T,P))/2*o;return{chunk:Math.abs(P-T)/2*o/h,ratio:a.barPercentage,start:z}}function CR(i,e,a,h){const p=a.parse(i[0],h),x=a.parse(i[1],h),T=Math.min(p,x),P=Math.max(p,x);let o=T,z=P;Math.abs(T)>Math.abs(P)&&(o=P,z=T),e[a.axis]=z,e._custom={barStart:o,barEnd:z,start:p,end:x,min:T,max:P}}function SA(i,e,a,h){return kr(i)?CR(i,e,a,h):e[a.axis]=a.parse(i,h),e}function jT(i,e,a,h){const p=i.iScale,x=i.vScale,T=p.getLabels(),P=p===x,o=[];let z,$,q,Q;for(z=a,$=a+h;z<$;++z)Q=e[z],q={},q[p.axis]=P||p.parse(T[z],z),o.push(SA(Q,q,x,z));return o}function Tv(i){return i&&i.barStart!==void 0&&i.barEnd!==void 0}function kR(i,e,a){return i!==0?Lu(i):(e.isHorizontal()?1:-1)*(e.min>=a?1:-1)}function PR(i){let e,a,h,p,x;return i.horizontal?(e=i.base>i.x,a="left",h="right"):(e=i.base<i.y,a="bottom",h="top"),e?(p="end",x="start"):(p="start",x="end"),{start:a,end:h,reverse:e,top:p,bottom:x}}function IR(i,e,a,h){let p=e.borderSkipped;const x={};if(!p){i.borderSkipped=x;return}if(p===!0){i.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:T,end:P,reverse:o,top:z,bottom:$}=PR(i);p==="middle"&&a&&(i.enableBorderRadius=!0,(a._top||0)===h?p=z:(a._bottom||0)===h?p=$:(x[UT($,T,P,o)]=!0,p=z)),x[UT(p,T,P,o)]=!0,i.borderSkipped=x}function UT(i,e,a,h){return h?(i=LR(i,e,a),i=VT(i,a,e)):i=VT(i,e,a),i}function LR(i,e,a){return i===e?a:i===a?e:i}function VT(i,e,a){return i==="start"?e:i==="end"?a:i}function DR(i,{inflateAmount:e},a){i.inflateAmount=e==="auto"?a===1?.33:0:e}class Gy extends Ng{parsePrimitiveData(e,a,h,p){return jT(e,a,h,p)}parseArrayData(e,a,h,p){return jT(e,a,h,p)}parseObjectData(e,a,h,p){const{iScale:x,vScale:T}=e,{xAxisKey:P="x",yAxisKey:o="y"}=this._parsing,z=x.axis==="x"?P:o,$=T.axis==="x"?P:o,q=[];let Q,nt,Tt,yt;for(Q=h,nt=h+p;Q<nt;++Q)yt=a[Q],Tt={},Tt[x.axis]=x.parse(em(yt,z),Q),q.push(SA(em(yt,$),Tt,T,Q));return q}updateRangeFromParsed(e,a,h,p){super.updateRangeFromParsed(e,a,h,p);const x=h._custom;x&&a===this._cachedMeta.vScale&&(e.min=Math.min(e.min,x.min),e.max=Math.max(e.max,x.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const a=this._cachedMeta,{iScale:h,vScale:p}=a,x=this.getParsed(e),T=x._custom,P=Tv(T)?"["+T.start+", "+T.end+"]":""+p.getLabelForValue(x[p.axis]);return{label:""+h.getLabelForValue(x[h.axis]),value:P}}initialize(){this.enableOptionSharing=!0,super.initialize();const e=this._cachedMeta;e.stack=this.getDataset().stack}update(e){const a=this._cachedMeta;this.updateElements(a.data,0,a.data.length,e)}updateElements(e,a,h,p){const x=p==="reset",{index:T,_cachedMeta:{vScale:P}}=this,o=P.getBasePixel(),z=P.isHorizontal(),$=this._getRuler(),{sharedOptions:q,includeOptions:Q}=this._getSharedOptions(a,p);for(let nt=a;nt<a+h;nt++){const Tt=this.getParsed(nt),yt=x||fn(Tt[P.axis])?{base:o,head:o}:this._calculateBarValuePixels(nt),Lt=this._calculateBarIndexPixels(nt,$),Nt=(Tt._stacks||{})[P.axis],Dt={horizontal:z,base:yt.base,enableBorderRadius:!Nt||Tv(Tt._custom)||T===Nt._top||T===Nt._bottom,x:z?yt.head:Lt.center,y:z?Lt.center:yt.head,height:z?Lt.size:Math.abs(yt.size),width:z?Math.abs(yt.size):Lt.size};Q&&(Dt.options=q||this.resolveDataElementOptions(nt,e[nt].active?"active":p));const wt=Dt.options||e[nt].options;IR(Dt,wt,Nt,T),DR(Dt,wt,$.ratio),this.updateElement(e[nt],nt,Dt,p)}}_getStacks(e,a){const{iScale:h}=this._cachedMeta,p=h.getMatchingVisibleMetas(this._type).filter($=>$.controller.options.grouped),x=h.options.stacked,T=[],P=this._cachedMeta.controller.getParsed(a),o=P&&P[h.axis],z=$=>{const q=$._parsed.find(nt=>nt[h.axis]===o),Q=q&&q[$.vScale.axis];if(fn(Q)||isNaN(Q))return!0};for(const $ of p)if(!(a!==void 0&&z($))&&((x===!1||T.indexOf($.stack)===-1||x===void 0&&$.stack===void 0)&&T.push($.stack),$.index===e))break;return T.length||T.push(void 0),T}_getStackCount(e){return this._getStacks(void 0,e).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const e=this.chart.scales,a=this.chart.options.indexAxis;return Object.keys(e).filter(h=>e[h].axis===a).shift()}_getAxis(){const e={},a=this.getFirstScaleIdForIndexAxis();for(const h of this.chart.data.datasets)e[qs(this.chart.options.indexAxis==="x"?h.xAxisID:h.yAxisID,a)]=!0;return Object.keys(e)}_getStackIndex(e,a,h){const p=this._getStacks(e,h),x=a!==void 0?p.indexOf(a):-1;return x===-1?p.length-1:x}_getRuler(){const e=this.options,a=this._cachedMeta,h=a.iScale,p=[];let x,T;for(x=0,T=a.data.length;x<T;++x)p.push(h.getPixelForValue(this.getParsed(x)[h.axis],x));const P=e.barThickness;return{min:P||ER(a),pixels:p,start:h._startPixel,end:h._endPixel,stackCount:this._getStackCount(),scale:h,grouped:e.grouped,ratio:P?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:a,_stacked:h,index:p},options:{base:x,minBarLength:T}}=this,P=x||0,o=this.getParsed(e),z=o._custom,$=Tv(z);let q=o[a.axis],Q=0,nt=h?this.applyStack(a,o,h):q,Tt,yt;nt!==q&&(Q=nt-q,nt=q),$&&(q=z.barStart,nt=z.barEnd-z.barStart,q!==0&&Lu(q)!==Lu(z.barEnd)&&(Q=0),Q+=q);const Lt=!fn(x)&&!$?x:Q;let Nt=a.getPixelForValue(Lt);if(this.chart.getDataVisibility(e)?Tt=a.getPixelForValue(Q+nt):Tt=Nt,yt=Tt-Nt,Math.abs(yt)<T){yt=kR(yt,a,P)*T,q===P&&(Nt-=yt/2);const Dt=a.getPixelForDecimal(0),wt=a.getPixelForDecimal(1),It=Math.min(Dt,wt),Xt=Math.max(Dt,wt);Nt=Math.max(Math.min(Nt,Xt),It),Tt=Nt+yt,h&&!$&&(o._stacks[a.axis]._visualValues[p]=a.getValueForPixel(Tt)-a.getValueForPixel(Nt))}if(Nt===a.getPixelForValue(P)){const Dt=Lu(yt)*a.getLineWidthForValue(P)/2;Nt+=Dt,yt-=Dt}return{size:yt,base:Nt,head:Tt,center:Tt+yt/2}}_calculateBarIndexPixels(e,a){const h=a.scale,p=this.options,x=p.skipNull,T=qs(p.maxBarThickness,1/0);let P,o;const z=this._getAxisCount();if(a.grouped){const $=x?this._getStackCount(e):a.stackCount,q=p.barThickness==="flex"?AR(e,a,p,$*z):MR(e,a,p,$*z),Q=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,nt=this._getAxis().indexOf(qs(Q,this.getFirstScaleIdForIndexAxis())),Tt=this._getStackIndex(this.index,this._cachedMeta.stack,x?e:void 0)+nt;P=q.start+q.chunk*Tt+q.chunk/2,o=Math.min(T,q.chunk*q.ratio)}else P=h.getPixelForValue(this.getParsed(e)[h.axis],e),o=Math.min(T,a.min*a.ratio);return{base:P-o/2,head:P+o/2,center:P,size:o}}draw(){const e=this._cachedMeta,a=e.vScale,h=e.data,p=h.length;let x=0;for(;x<p;++x)this.getParsed(x)[a.axis]!==null&&!h[x].hidden&&h[x].draw(this._ctx)}}Ls(Gy,"id","bar"),Ls(Gy,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),Ls(Gy,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});function hf(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class e1{constructor(e){Ls(this,"options");this.options=e||{}}static override(e){Object.assign(e1.prototype,e)}init(){}formats(){return hf()}parse(){return hf()}format(){return hf()}add(){return hf()}diff(){return hf()}startOf(){return hf()}endOf(){return hf()}}var zR={_date:e1};function OR(i,e,a,h){const{controller:p,data:x,_sorted:T}=i,P=p._cachedMeta.iScale,o=i.dataset&&i.dataset.options?i.dataset.options.spanGaps:null;if(P&&e===P.axis&&e!=="r"&&T&&x.length){const z=P._reversePixels?bO:ib;if(h){if(p._sharedOptions){const $=x[0],q=typeof $.getRange=="function"&&$.getRange(e);if(q){const Q=z(x,e,a-q),nt=z(x,e,a+q);return{lo:Q.lo,hi:nt.hi}}}}else{const $=z(x,e,a);if(o){const{vScale:q}=p._cachedMeta,{_parsed:Q}=i,nt=Q.slice(0,$.lo+1).reverse().findIndex(yt=>!fn(yt[q.axis]));$.lo-=Math.max(0,nt);const Tt=Q.slice($.hi).findIndex(yt=>!fn(yt[q.axis]));$.hi+=Math.max(0,Tt)}return $}}return{lo:0,hi:x.length-1}}function Gx(i,e,a,h,p){const x=i.getSortedVisibleDatasetMetas(),T=a[e];for(let P=0,o=x.length;P<o;++P){const{index:z,data:$}=x[P],{lo:q,hi:Q}=OR(x[P],e,T,p);for(let nt=q;nt<=Q;++nt){const Tt=$[nt];Tt.skip||h(Tt,z,nt)}}}function RR(i){const e=i.indexOf("x")!==-1,a=i.indexOf("y")!==-1;return function(h,p){const x=e?Math.abs(h.x-p.x):0,T=a?Math.abs(h.y-p.y):0;return Math.sqrt(Math.pow(x,2)+Math.pow(T,2))}}function Sv(i,e,a,h,p){const x=[];return!p&&!i.isPointInArea(e)||Gx(i,a,e,function(P,o,z){!p&&!fA(P,i.chartArea,0)||P.inRange(e.x,e.y,h)&&x.push({element:P,datasetIndex:o,index:z})},!0),x}function BR(i,e,a,h){let p=[];function x(T,P,o){const{startAngle:z,endAngle:$}=T.getProps(["startAngle","endAngle"],h),{angle:q}=_O(T,{x:e.x,y:e.y});xO(q,z,$)&&p.push({element:T,datasetIndex:P,index:o})}return Gx(i,a,e,x),p}function FR(i,e,a,h,p,x){let T=[];const P=RR(a);let o=Number.POSITIVE_INFINITY;function z($,q,Q){const nt=$.inRange(e.x,e.y,p);if(h&&!nt)return;const Tt=$.getCenterPoint(p);if(!(!!x||i.isPointInArea(Tt))&&!nt)return;const Lt=P(e,Tt);Lt<o?(T=[{element:$,datasetIndex:q,index:Q}],o=Lt):Lt===o&&T.push({element:$,datasetIndex:q,index:Q})}return Gx(i,a,e,z),T}function Ev(i,e,a,h,p,x){return!x&&!i.isPointInArea(e)?[]:a==="r"&&!h?BR(i,e,a,p):FR(i,e,a,h,p,x)}function $T(i,e,a,h,p){const x=[],T=a==="x"?"inXRange":"inYRange";let P=!1;return Gx(i,a,e,(o,z,$)=>{o[T]&&o[T](e[a],p)&&(x.push({element:o,datasetIndex:z,index:$}),P=P||o.inRange(e.x,e.y,p))}),h&&!P?[]:x}var NR={modes:{index(i,e,a,h){const p=uf(e,i),x=a.axis||"x",T=a.includeInvisible||!1,P=a.intersect?Sv(i,p,x,h,T):Ev(i,p,x,!1,h,T),o=[];return P.length?(i.getSortedVisibleDatasetMetas().forEach(z=>{const $=P[0].index,q=z.data[$];q&&!q.skip&&o.push({element:q,datasetIndex:z.index,index:$})}),o):[]},dataset(i,e,a,h){const p=uf(e,i),x=a.axis||"xy",T=a.includeInvisible||!1;let P=a.intersect?Sv(i,p,x,h,T):Ev(i,p,x,!1,h,T);if(P.length>0){const o=P[0].datasetIndex,z=i.getDatasetMeta(o).data;P=[];for(let $=0;$<z.length;++$)P.push({element:z[$],datasetIndex:o,index:$})}return P},point(i,e,a,h){const p=uf(e,i),x=a.axis||"xy",T=a.includeInvisible||!1;return Sv(i,p,x,h,T)},nearest(i,e,a,h){const p=uf(e,i),x=a.axis||"xy",T=a.includeInvisible||!1;return Ev(i,p,x,a.intersect,h,T)},x(i,e,a,h){const p=uf(e,i);return $T(i,p,"x",a.intersect,h)},y(i,e,a,h){const p=uf(e,i);return $T(i,p,"y",a.intersect,h)}}};const EA=["left","top","right","bottom"];function mg(i,e){return i.filter(a=>a.pos===e)}function GT(i,e){return i.filter(a=>EA.indexOf(a.pos)===-1&&a.box.axis===e)}function gg(i,e){return i.sort((a,h)=>{const p=e?h:a,x=e?a:h;return p.weight===x.weight?p.index-x.index:p.weight-x.weight})}function jR(i){const e=[];let a,h,p,x,T,P;for(a=0,h=(i||[]).length;a<h;++a)p=i[a],{position:x,options:{stack:T,stackWeight:P=1}}=p,e.push({index:a,box:p,pos:x,horizontal:p.isHorizontal(),weight:p.weight,stack:T&&x+T,stackWeight:P});return e}function UR(i){const e={};for(const a of i){const{stack:h,pos:p,stackWeight:x}=a;if(!h||!EA.includes(p))continue;const T=e[h]||(e[h]={count:0,placed:0,weight:0,size:0});T.count++,T.weight+=x}return e}function VR(i,e){const a=UR(i),{vBoxMaxWidth:h,hBoxMaxHeight:p}=e;let x,T,P;for(x=0,T=i.length;x<T;++x){P=i[x];const{fullSize:o}=P.box,z=a[P.stack],$=z&&P.stackWeight/z.weight;P.horizontal?(P.width=$?$*h:o&&e.availableWidth,P.height=p):(P.width=h,P.height=$?$*p:o&&e.availableHeight)}return a}function $R(i){const e=jR(i),a=gg(e.filter(z=>z.box.fullSize),!0),h=gg(mg(e,"left"),!0),p=gg(mg(e,"right")),x=gg(mg(e,"top"),!0),T=gg(mg(e,"bottom")),P=GT(e,"x"),o=GT(e,"y");return{fullSize:a,leftAndTop:h.concat(x),rightAndBottom:p.concat(o).concat(T).concat(P),chartArea:mg(e,"chartArea"),vertical:h.concat(p).concat(o),horizontal:x.concat(T).concat(P)}}function WT(i,e,a,h){return Math.max(i[a],e[a])+Math.max(i[h],e[h])}function MA(i,e){i.top=Math.max(i.top,e.top),i.left=Math.max(i.left,e.left),i.bottom=Math.max(i.bottom,e.bottom),i.right=Math.max(i.right,e.right)}function GR(i,e,a,h){const{pos:p,box:x}=a,T=i.maxPadding;if(!Fs(p)){a.size&&(i[p]-=a.size);const q=h[a.stack]||{size:0,count:1};q.size=Math.max(q.size,a.horizontal?x.height:x.width),a.size=q.size/q.count,i[p]+=a.size}x.getPadding&&MA(T,x.getPadding());const P=Math.max(0,e.outerWidth-WT(T,i,"left","right")),o=Math.max(0,e.outerHeight-WT(T,i,"top","bottom")),z=P!==i.w,$=o!==i.h;return i.w=P,i.h=o,a.horizontal?{same:z,other:$}:{same:$,other:z}}function WR(i){const e=i.maxPadding;function a(h){const p=Math.max(e[h]-i[h],0);return i[h]+=p,p}i.y+=a("top"),i.x+=a("left"),a("right"),a("bottom")}function HR(i,e){const a=e.maxPadding;function h(p){const x={left:0,top:0,right:0,bottom:0};return p.forEach(T=>{x[T]=Math.max(e[T],a[T])}),x}return h(i?["left","right"]:["top","bottom"])}function wg(i,e,a,h){const p=[];let x,T,P,o,z,$;for(x=0,T=i.length,z=0;x<T;++x){P=i[x],o=P.box,o.update(P.width||e.w,P.height||e.h,HR(P.horizontal,e));const{same:q,other:Q}=GR(e,a,P,h);z|=q&&p.length,$=$||Q,o.fullSize||p.push(P)}return z&&wg(p,e,a,h)||$}function Ly(i,e,a,h,p){i.top=a,i.left=e,i.right=e+h,i.bottom=a+p,i.width=h,i.height=p}function HT(i,e,a,h){const p=a.padding;let{x,y:T}=e;for(const P of i){const o=P.box,z=h[P.stack]||{placed:0,weight:1},$=P.stackWeight/z.weight||1;if(P.horizontal){const q=e.w*$,Q=z.size||o.height;Qg(z.start)&&(T=z.start),o.fullSize?Ly(o,p.left,T,a.outerWidth-p.right-p.left,Q):Ly(o,e.left+z.placed,T,q,Q),z.start=T,z.placed+=q,T=o.bottom}else{const q=e.h*$,Q=z.size||o.width;Qg(z.start)&&(x=z.start),o.fullSize?Ly(o,x,p.top,Q,a.outerHeight-p.bottom-p.top):Ly(o,x,e.top+z.placed,Q,q),z.start=x,z.placed+=q,x=o.right}}e.x=x,e.y=T}var Mu={addBox(i,e){i.boxes||(i.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(a){e.draw(a)}}]},i.boxes.push(e)},removeBox(i,e){const a=i.boxes?i.boxes.indexOf(e):-1;a!==-1&&i.boxes.splice(a,1)},configure(i,e,a){e.fullSize=a.fullSize,e.position=a.position,e.weight=a.weight},update(i,e,a,h){if(!i)return;const p=Sl(i.options.layout.padding),x=Math.max(e-p.width,0),T=Math.max(a-p.height,0),P=$R(i.boxes),o=P.vertical,z=P.horizontal;sn(i.boxes,yt=>{typeof yt.beforeLayout=="function"&&yt.beforeLayout()});const $=o.reduce((yt,Lt)=>Lt.box.options&&Lt.box.options.display===!1?yt:yt+1,0)||1,q=Object.freeze({outerWidth:e,outerHeight:a,padding:p,availableWidth:x,availableHeight:T,vBoxMaxWidth:x/2/$,hBoxMaxHeight:T/2}),Q=Object.assign({},p);MA(Q,Sl(h));const nt=Object.assign({maxPadding:Q,w:x,h:T,x:p.left,y:p.top},p),Tt=VR(o.concat(z),q);wg(P.fullSize,nt,q,Tt),wg(o,nt,q,Tt),wg(z,nt,q,Tt)&&wg(o,nt,q,Tt),WR(nt),HT(P.leftAndTop,nt,q,Tt),nt.x+=nt.w,nt.y+=nt.h,HT(P.rightAndBottom,nt,q,Tt),i.chartArea={left:nt.left,top:nt.top,right:nt.left+nt.w,bottom:nt.top+nt.h,height:nt.h,width:nt.w},sn(P.chartArea,yt=>{const Lt=yt.box;Object.assign(Lt,i.chartArea),Lt.update(nt.w,nt.h,{left:0,top:0,right:0,bottom:0})})}};class AA{acquireContext(e,a){}releaseContext(e){return!1}addEventListener(e,a,h){}removeEventListener(e,a,h){}getDevicePixelRatio(){return 1}getMaximumSize(e,a,h,p){return a=Math.max(0,a||e.width),h=h||e.height,{width:a,height:Math.max(0,p?Math.floor(a/p):h)}}isAttached(e){return!0}updateConfig(e){}}class XR extends AA{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const Wy="$chartjs",qR={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},XT=i=>i===null||i==="";function ZR(i,e){const a=i.style,h=i.getAttribute("height"),p=i.getAttribute("width");if(i[Wy]={initial:{height:h,width:p,style:{display:a.display,height:a.height,width:a.width}}},a.display=a.display||"block",a.boxSizing=a.boxSizing||"border-box",XT(p)){const x=DT(i,"width");x!==void 0&&(i.width=x)}if(XT(h))if(i.style.height==="")i.height=i.width/(e||2);else{const x=DT(i,"height");x!==void 0&&(i.height=x)}return i}const CA=rR?{passive:!0}:!1;function YR(i,e,a){i&&i.addEventListener(e,a,CA)}function KR(i,e,a){i&&i.canvas&&i.canvas.removeEventListener(e,a,CA)}function JR(i,e){const a=qR[i.type]||i.type,{x:h,y:p}=uf(i,e);return{type:a,chart:e,native:i,x:h!==void 0?h:null,y:p!==void 0?p:null}}function yx(i,e){for(const a of i)if(a===e||a.contains(e))return!0}function QR(i,e,a){const h=i.canvas,p=new MutationObserver(x=>{let T=!1;for(const P of x)T=T||yx(P.addedNodes,h),T=T&&!yx(P.removedNodes,h);T&&a()});return p.observe(document,{childList:!0,subtree:!0}),p}function t3(i,e,a){const h=i.canvas,p=new MutationObserver(x=>{let T=!1;for(const P of x)T=T||yx(P.removedNodes,h),T=T&&!yx(P.addedNodes,h);T&&a()});return p.observe(document,{childList:!0,subtree:!0}),p}const t_=new Map;let qT=0;function kA(){const i=window.devicePixelRatio;i!==qT&&(qT=i,t_.forEach((e,a)=>{a.currentDevicePixelRatio!==i&&e()}))}function e3(i,e){t_.size||window.addEventListener("resize",kA),t_.set(i,e)}function i3(i){t_.delete(i),t_.size||window.removeEventListener("resize",kA)}function s3(i,e,a){const h=i.canvas,p=h&&t1(h);if(!p)return;const x=aA((P,o)=>{const z=p.clientWidth;a(P,o),z<p.clientWidth&&a()},window),T=new ResizeObserver(P=>{const o=P[0],z=o.contentRect.width,$=o.contentRect.height;z===0&&$===0||x(z,$)});return T.observe(p),e3(i,x),T}function Mv(i,e,a){a&&a.disconnect(),e==="resize"&&i3(i)}function n3(i,e,a){const h=i.canvas,p=aA(x=>{i.ctx!==null&&a(JR(x,i))},i);return YR(h,e,p),p}class r3 extends AA{acquireContext(e,a){const h=e&&e.getContext&&e.getContext("2d");return h&&h.canvas===e?(ZR(e,a),h):null}releaseContext(e){const a=e.canvas;if(!a[Wy])return!1;const h=a[Wy].initial;["height","width"].forEach(x=>{const T=h[x];fn(T)?a.removeAttribute(x):a.setAttribute(x,T)});const p=h.style||{};return Object.keys(p).forEach(x=>{a.style[x]=p[x]}),a.width=a.width,delete a[Wy],!0}addEventListener(e,a,h){this.removeEventListener(e,a);const p=e.$proxies||(e.$proxies={}),T={attach:QR,detach:t3,resize:s3}[a]||n3;p[a]=T(e,a,h)}removeEventListener(e,a){const h=e.$proxies||(e.$proxies={}),p=h[a];if(!p)return;({attach:Mv,detach:Mv,resize:Mv}[a]||KR)(e,a,p),h[a]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,a,h,p){return nR(e,a,h,p)}isAttached(e){const a=e&&t1(e);return!!(a&&a.isConnected)}}function o3(i){return!Qb()||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas?XR:r3}var Fy;let l_=(Fy=class{constructor(){Ls(this,"x");Ls(this,"y");Ls(this,"active",!1);Ls(this,"options");Ls(this,"$animations")}tooltipPosition(e){const{x:a,y:h}=this.getProps(["x","y"],e);return{x:a,y:h}}hasValue(){return px(this.x)&&px(this.y)}getProps(e,a){const h=this.$animations;if(!a||!h)return this;const p={};return e.forEach(x=>{p[x]=h[x]&&h[x].active()?h[x]._to:this[x]}),p}},Ls(Fy,"defaults",{}),Ls(Fy,"defaultRoutes"),Fy);function a3(i,e){const a=i.options.ticks,h=l3(i),p=Math.min(a.maxTicksLimit||h,h),x=a.major.enabled?h3(e):[],T=x.length,P=x[0],o=x[T-1],z=[];if(T>p)return u3(e,z,x,T/p),z;const $=c3(x,e,p);if(T>0){let q,Q;const nt=T>1?Math.round((o-P)/(T-1)):null;for(Dy(e,z,$,fn(nt)?0:P-nt,P),q=0,Q=T-1;q<Q;q++)Dy(e,z,$,x[q],x[q+1]);return Dy(e,z,$,o,fn(nt)?e.length:o+nt),z}return Dy(e,z,$),z}function l3(i){const e=i.options.offset,a=i._tickSize(),h=i._length/a+(e?0:1),p=i._maxLength/a;return Math.floor(Math.min(h,p))}function c3(i,e,a){const h=d3(i),p=e.length/a;if(!h)return Math.max(p,1);const x=dO(h);for(let T=0,P=x.length-1;T<P;T++){const o=x[T];if(o>p)return o}return Math.max(p,1)}function h3(i){const e=[];let a,h;for(a=0,h=i.length;a<h;a++)i[a].major&&e.push(a);return e}function u3(i,e,a,h){let p=0,x=a[0],T;for(h=Math.ceil(h),T=0;T<i.length;T++)T===x&&(e.push(i[T]),p++,x=a[p*h])}function Dy(i,e,a,h,p){const x=qs(h,0),T=Math.min(qs(p,i.length),i.length);let P=0,o,z,$;for(a=Math.ceil(a),p&&(o=p-h,a=o/Math.floor(o/a)),$=x;$<0;)P++,$=Math.round(x+P*a);for(z=Math.max(x,0);z<T;z++)z===$&&(e.push(i[z]),P++,$=Math.round(x+P*a))}function d3(i){const e=i.length;let a,h;if(e<2)return!1;for(h=i[0],a=1;a<e;++a)if(i[a]-i[a-1]!==h)return!1;return h}const f3=i=>i==="left"?"right":i==="right"?"left":i,ZT=(i,e,a)=>e==="top"||e==="left"?i[e]+a:i[e]-a,YT=(i,e)=>Math.min(e||i,i);function KT(i,e){const a=[],h=i.length/e,p=i.length;let x=0;for(;x<p;x+=h)a.push(i[Math.floor(x)]);return a}function p3(i,e,a){const h=i.ticks.length,p=Math.min(e,h-1),x=i._startPixel,T=i._endPixel,P=1e-6;let o=i.getPixelForTick(p),z;if(!(a&&(h===1?z=Math.max(o-x,T-o):e===0?z=(i.getPixelForTick(1)-o)/2:z=(o-i.getPixelForTick(p-1))/2,o+=p<e?z:-z,o<x-P||o>T+P)))return o}function m3(i,e){sn(i,a=>{const h=a.gc,p=h.length/2;let x;if(p>e){for(x=0;x<p;++x)delete a.data[h[x]];h.splice(0,p)}})}function _g(i){return i.drawTicks?i.tickLength:0}function JT(i,e){if(!i.display)return 0;const a=Ho(i.font,e),h=Sl(i.padding);return(kr(i.text)?i.text.length:1)*a.lineHeight+h.height}function g3(i,e){return am(i,{scale:e,type:"scale"})}function _3(i,e,a){return am(i,{tick:a,index:e,type:"tick"})}function y3(i,e,a){let h=lA(i);return(a&&e!=="right"||!a&&e==="right")&&(h=f3(h)),h}function x3(i,e,a,h){const{top:p,left:x,bottom:T,right:P,chart:o}=i,{chartArea:z,scales:$}=o;let q=0,Q,nt,Tt;const yt=T-p,Lt=P-x;if(i.isHorizontal()){if(nt=ga(h,x,P),Fs(a)){const Nt=Object.keys(a)[0],Dt=a[Nt];Tt=$[Nt].getPixelForValue(Dt)+yt-e}else a==="center"?Tt=(z.bottom+z.top)/2+yt-e:Tt=ZT(i,a,e);Q=P-x}else{if(Fs(a)){const Nt=Object.keys(a)[0],Dt=a[Nt];nt=$[Nt].getPixelForValue(Dt)-Lt+e}else a==="center"?nt=(z.left+z.right)/2-Lt+e:nt=ZT(i,a,e);Tt=ga(h,T,p),q=a==="left"?-xl:xl}return{titleX:nt,titleY:Tt,maxWidth:Q,rotation:q}}class lm extends l_{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,a){return e}getUserBounds(){let{_userMin:e,_userMax:a,_suggestedMin:h,_suggestedMax:p}=this;return e=cc(e,Number.POSITIVE_INFINITY),a=cc(a,Number.NEGATIVE_INFINITY),h=cc(h,Number.POSITIVE_INFINITY),p=cc(p,Number.NEGATIVE_INFINITY),{min:cc(e,h),max:cc(a,p),minDefined:Ga(e),maxDefined:Ga(a)}}getMinMax(e){let{min:a,max:h,minDefined:p,maxDefined:x}=this.getUserBounds(),T;if(p&&x)return{min:a,max:h};const P=this.getMatchingVisibleMetas();for(let o=0,z=P.length;o<z;++o)T=P[o].controller.getMinMax(this,e),p||(a=Math.min(a,T.min)),x||(h=Math.max(h,T.max));return a=x&&a>h?h:a,h=p&&a>h?a:h,{min:cc(a,cc(h,a)),max:cc(h,cc(a,h))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){kn(this.options.beforeUpdate,[this])}update(e,a,h){const{beginAtZero:p,grace:x,ticks:T}=this.options,P=T.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=a,this._margins=h=Object.assign({left:0,right:0,top:0,bottom:0},h),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+h.left+h.right:this.height+h.top+h.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=$O(this,x,p),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const o=P<this.ticks.length;this._convertTicksToLabels(o?KT(this.ticks,P):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),T.display&&(T.autoSkip||T.source==="auto")&&(this.ticks=a3(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),o&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,a,h;this.isHorizontal()?(a=this.left,h=this.right):(a=this.top,h=this.bottom,e=!e),this._startPixel=a,this._endPixel=h,this._reversePixels=e,this._length=h-a,this._alignToPixels=this.options.alignToPixels}afterUpdate(){kn(this.options.afterUpdate,[this])}beforeSetDimensions(){kn(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){kn(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),kn(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){kn(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const a=this.options.ticks;let h,p,x;for(h=0,p=e.length;h<p;h++)x=e[h],x.label=kn(a.callback,[x.value,h,e],this)}afterTickToLabelConversion(){kn(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){kn(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,a=e.ticks,h=YT(this.ticks.length,e.ticks.maxTicksLimit),p=a.minRotation||0,x=a.maxRotation;let T=p,P,o,z;if(!this._isVisible()||!a.display||p>=x||h<=1||!this.isHorizontal()){this.labelRotation=p;return}const $=this._getLabelSizes(),q=$.widest.width,Q=$.highest.height,nt=vl(this.chart.width-q,0,this.maxWidth);P=e.offset?this.maxWidth/h:nt/(h-1),q+6>P&&(P=nt/(h-(e.offset?.5:1)),o=this.maxHeight-_g(e.grid)-a.padding-JT(e.title,this.chart.options.font),z=Math.sqrt(q*q+Q*Q),T=gO(Math.min(Math.asin(vl(($.highest.height+6)/P,-1,1)),Math.asin(vl(o/z,-1,1))-Math.asin(vl(Q/z,-1,1)))),T=Math.max(p,Math.min(x,T))),this.labelRotation=T}afterCalculateLabelRotation(){kn(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){kn(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:a,options:{ticks:h,title:p,grid:x}}=this,T=this._isVisible(),P=this.isHorizontal();if(T){const o=JT(p,a.options.font);if(P?(e.width=this.maxWidth,e.height=_g(x)+o):(e.height=this.maxHeight,e.width=_g(x)+o),h.display&&this.ticks.length){const{first:z,last:$,widest:q,highest:Q}=this._getLabelSizes(),nt=h.padding*2,Tt=df(this.labelRotation),yt=Math.cos(Tt),Lt=Math.sin(Tt);if(P){const Nt=h.mirror?0:Lt*q.width+yt*Q.height;e.height=Math.min(this.maxHeight,e.height+Nt+nt)}else{const Nt=h.mirror?0:yt*q.width+Lt*Q.height;e.width=Math.min(this.maxWidth,e.width+Nt+nt)}this._calculatePadding(z,$,Lt,yt)}}this._handleMargins(),P?(this.width=this._length=a.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=a.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,a,h,p){const{ticks:{align:x,padding:T},position:P}=this.options,o=this.labelRotation!==0,z=P!=="top"&&this.axis==="x";if(this.isHorizontal()){const $=this.getPixelForTick(0)-this.left,q=this.right-this.getPixelForTick(this.ticks.length-1);let Q=0,nt=0;o?z?(Q=p*e.width,nt=h*a.height):(Q=h*e.height,nt=p*a.width):x==="start"?nt=a.width:x==="end"?Q=e.width:x!=="inner"&&(Q=e.width/2,nt=a.width/2),this.paddingLeft=Math.max((Q-$+T)*this.width/(this.width-$),0),this.paddingRight=Math.max((nt-q+T)*this.width/(this.width-q),0)}else{let $=a.height/2,q=e.height/2;x==="start"?($=0,q=e.height):x==="end"&&($=a.height,q=0),this.paddingTop=$+T,this.paddingBottom=q+T}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){kn(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:a}=this.options;return a==="top"||a==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let a,h;for(a=0,h=e.length;a<h;a++)fn(e[a].label)&&(e.splice(a,1),h--,a--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const a=this.options.ticks.sampleSize;let h=this.ticks;a<h.length&&(h=KT(h,a)),this._labelSizes=e=this._computeLabelSizes(h,h.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,a,h){const{ctx:p,_longestTextCache:x}=this,T=[],P=[],o=Math.floor(a/YT(a,h));let z=0,$=0,q,Q,nt,Tt,yt,Lt,Nt,Dt,wt,It,Xt;for(q=0;q<a;q+=o){if(Tt=e[q].label,yt=this._resolveTickFontOptions(q),p.font=Lt=yt.string,Nt=x[Lt]=x[Lt]||{data:{},gc:[]},Dt=yt.lineHeight,wt=It=0,!fn(Tt)&&!kr(Tt))wt=AT(p,Nt.data,Nt.gc,wt,Tt),It=Dt;else if(kr(Tt))for(Q=0,nt=Tt.length;Q<nt;++Q)Xt=Tt[Q],!fn(Xt)&&!kr(Xt)&&(wt=AT(p,Nt.data,Nt.gc,wt,Xt),It+=Dt);T.push(wt),P.push(It),z=Math.max(wt,z),$=Math.max(It,$)}m3(x,a);const Zt=T.indexOf(z),re=P.indexOf($),kt=ne=>({width:T[ne]||0,height:P[ne]||0});return{first:kt(0),last:kt(a-1),widest:kt(Zt),highest:kt(re),widths:T,heights:P}}getLabelForValue(e){return e}getPixelForValue(e,a){return NaN}getValueForPixel(e){}getPixelForTick(e){const a=this.ticks;return e<0||e>a.length-1?null:this.getPixelForValue(a[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const a=this._startPixel+e*this._length;return vO(this._alignToPixels?cf(this.chart,a,0):a)}getDecimalForPixel(e){const a=(e-this._startPixel)/this._length;return this._reversePixels?1-a:a}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:a}=this;return e<0&&a<0?a:e>0&&a>0?e:0}getContext(e){const a=this.ticks||[];if(e>=0&&e<a.length){const h=a[e];return h.$context||(h.$context=_3(this.getContext(),e,h))}return this.$context||(this.$context=g3(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,a=df(this.labelRotation),h=Math.abs(Math.cos(a)),p=Math.abs(Math.sin(a)),x=this._getLabelSizes(),T=e.autoSkipPadding||0,P=x?x.widest.width+T:0,o=x?x.highest.height+T:0;return this.isHorizontal()?o*h>P*p?P/h:o/p:o*p<P*h?o/h:P/p}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const a=this.axis,h=this.chart,p=this.options,{grid:x,position:T,border:P}=p,o=x.offset,z=this.isHorizontal(),q=this.ticks.length+(o?1:0),Q=_g(x),nt=[],Tt=P.setContext(this.getContext()),yt=Tt.display?Tt.width:0,Lt=yt/2,Nt=function(Ge){return cf(h,Ge,yt)};let Dt,wt,It,Xt,Zt,re,kt,ne,Ut,Le,ye,Ce;if(T==="top")Dt=Nt(this.bottom),re=this.bottom-Q,ne=Dt-Lt,Le=Nt(e.top)+Lt,Ce=e.bottom;else if(T==="bottom")Dt=Nt(this.top),Le=e.top,Ce=Nt(e.bottom)-Lt,re=Dt+Lt,ne=this.top+Q;else if(T==="left")Dt=Nt(this.right),Zt=this.right-Q,kt=Dt-Lt,Ut=Nt(e.left)+Lt,ye=e.right;else if(T==="right")Dt=Nt(this.left),Ut=e.left,ye=Nt(e.right)-Lt,Zt=Dt+Lt,kt=this.left+Q;else if(a==="x"){if(T==="center")Dt=Nt((e.top+e.bottom)/2+.5);else if(Fs(T)){const Ge=Object.keys(T)[0],li=T[Ge];Dt=Nt(this.chart.scales[Ge].getPixelForValue(li))}Le=e.top,Ce=e.bottom,re=Dt+Lt,ne=re+Q}else if(a==="y"){if(T==="center")Dt=Nt((e.left+e.right)/2);else if(Fs(T)){const Ge=Object.keys(T)[0],li=T[Ge];Dt=Nt(this.chart.scales[Ge].getPixelForValue(li))}Zt=Dt-Lt,kt=Zt-Q,Ut=e.left,ye=e.right}const di=qs(p.ticks.maxTicksLimit,q),Ti=Math.max(1,Math.ceil(q/di));for(wt=0;wt<q;wt+=Ti){const Ge=this.getContext(wt),li=x.setContext(Ge),fi=P.setContext(Ge),pi=li.lineWidth,Ns=li.color,hs=fi.dash||[],Yi=fi.dashOffset,Zs=li.tickWidth,Ji=li.tickColor,Tn=li.tickBorderDash||[],Ds=li.tickBorderDashOffset;It=p3(this,wt,o),It!==void 0&&(Xt=cf(h,It,pi),z?Zt=kt=Ut=ye=Xt:re=ne=Le=Ce=Xt,nt.push({tx1:Zt,ty1:re,tx2:kt,ty2:ne,x1:Ut,y1:Le,x2:ye,y2:Ce,width:pi,color:Ns,borderDash:hs,borderDashOffset:Yi,tickWidth:Zs,tickColor:Ji,tickBorderDash:Tn,tickBorderDashOffset:Ds}))}return this._ticksLength=q,this._borderValue=Dt,nt}_computeLabelItems(e){const a=this.axis,h=this.options,{position:p,ticks:x}=h,T=this.isHorizontal(),P=this.ticks,{align:o,crossAlign:z,padding:$,mirror:q}=x,Q=_g(h.grid),nt=Q+$,Tt=q?-$:nt,yt=-df(this.labelRotation),Lt=[];let Nt,Dt,wt,It,Xt,Zt,re,kt,ne,Ut,Le,ye,Ce="middle";if(p==="top")Zt=this.bottom-Tt,re=this._getXAxisLabelAlignment();else if(p==="bottom")Zt=this.top+Tt,re=this._getXAxisLabelAlignment();else if(p==="left"){const Ti=this._getYAxisLabelAlignment(Q);re=Ti.textAlign,Xt=Ti.x}else if(p==="right"){const Ti=this._getYAxisLabelAlignment(Q);re=Ti.textAlign,Xt=Ti.x}else if(a==="x"){if(p==="center")Zt=(e.top+e.bottom)/2+nt;else if(Fs(p)){const Ti=Object.keys(p)[0],Ge=p[Ti];Zt=this.chart.scales[Ti].getPixelForValue(Ge)+nt}re=this._getXAxisLabelAlignment()}else if(a==="y"){if(p==="center")Xt=(e.left+e.right)/2-nt;else if(Fs(p)){const Ti=Object.keys(p)[0],Ge=p[Ti];Xt=this.chart.scales[Ti].getPixelForValue(Ge)}re=this._getYAxisLabelAlignment(Q).textAlign}a==="y"&&(o==="start"?Ce="top":o==="end"&&(Ce="bottom"));const di=this._getLabelSizes();for(Nt=0,Dt=P.length;Nt<Dt;++Nt){wt=P[Nt],It=wt.label;const Ti=x.setContext(this.getContext(Nt));kt=this.getPixelForTick(Nt)+x.labelOffset,ne=this._resolveTickFontOptions(Nt),Ut=ne.lineHeight,Le=kr(It)?It.length:1;const Ge=Le/2,li=Ti.color,fi=Ti.textStrokeColor,pi=Ti.textStrokeWidth;let Ns=re;T?(Xt=kt,re==="inner"&&(Nt===Dt-1?Ns=this.options.reverse?"left":"right":Nt===0?Ns=this.options.reverse?"right":"left":Ns="center"),p==="top"?z==="near"||yt!==0?ye=-Le*Ut+Ut/2:z==="center"?ye=-di.highest.height/2-Ge*Ut+Ut:ye=-di.highest.height+Ut/2:z==="near"||yt!==0?ye=Ut/2:z==="center"?ye=di.highest.height/2-Ge*Ut:ye=di.highest.height-Le*Ut,q&&(ye*=-1),yt!==0&&!Ti.showLabelBackdrop&&(Xt+=Ut/2*Math.sin(yt))):(Zt=kt,ye=(1-Le)*Ut/2);let hs;if(Ti.showLabelBackdrop){const Yi=Sl(Ti.backdropPadding),Zs=di.heights[Nt],Ji=di.widths[Nt];let Tn=ye-Yi.top,Ds=0-Yi.left;switch(Ce){case"middle":Tn-=Zs/2;break;case"bottom":Tn-=Zs;break}switch(re){case"center":Ds-=Ji/2;break;case"right":Ds-=Ji;break;case"inner":Nt===Dt-1?Ds-=Ji:Nt>0&&(Ds-=Ji/2);break}hs={left:Ds,top:Tn,width:Ji+Yi.width,height:Zs+Yi.height,color:Ti.backdropColor}}Lt.push({label:It,font:ne,textOffset:ye,options:{rotation:yt,color:li,strokeColor:fi,strokeWidth:pi,textAlign:Ns,textBaseline:Ce,translation:[Xt,Zt],backdrop:hs}})}return Lt}_getXAxisLabelAlignment(){const{position:e,ticks:a}=this.options;if(-df(this.labelRotation))return e==="top"?"left":"right";let p="center";return a.align==="start"?p="left":a.align==="end"?p="right":a.align==="inner"&&(p="inner"),p}_getYAxisLabelAlignment(e){const{position:a,ticks:{crossAlign:h,mirror:p,padding:x}}=this.options,T=this._getLabelSizes(),P=e+x,o=T.widest.width;let z,$;return a==="left"?p?($=this.right+x,h==="near"?z="left":h==="center"?(z="center",$+=o/2):(z="right",$+=o)):($=this.right-P,h==="near"?z="right":h==="center"?(z="center",$-=o/2):(z="left",$=this.left)):a==="right"?p?($=this.left+x,h==="near"?z="right":h==="center"?(z="center",$-=o/2):(z="left",$-=o)):($=this.left+P,h==="near"?z="left":h==="center"?(z="center",$+=o/2):(z="right",$=this.right)):z="right",{textAlign:z,x:$}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,a=this.options.position;if(a==="left"||a==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(a==="top"||a==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:a},left:h,top:p,width:x,height:T}=this;a&&(e.save(),e.fillStyle=a,e.fillRect(h,p,x,T),e.restore())}getLineWidthForValue(e){const a=this.options.grid;if(!this._isVisible()||!a.display)return 0;const p=this.ticks.findIndex(x=>x.value===e);return p>=0?a.setContext(this.getContext(p)).lineWidth:0}drawGrid(e){const a=this.options.grid,h=this.ctx,p=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let x,T;const P=(o,z,$)=>{!$.width||!$.color||(h.save(),h.lineWidth=$.width,h.strokeStyle=$.color,h.setLineDash($.borderDash||[]),h.lineDashOffset=$.borderDashOffset,h.beginPath(),h.moveTo(o.x,o.y),h.lineTo(z.x,z.y),h.stroke(),h.restore())};if(a.display)for(x=0,T=p.length;x<T;++x){const o=p[x];a.drawOnChartArea&&P({x:o.x1,y:o.y1},{x:o.x2,y:o.y2},o),a.drawTicks&&P({x:o.tx1,y:o.ty1},{x:o.tx2,y:o.ty2},{color:o.tickColor,width:o.tickWidth,borderDash:o.tickBorderDash,borderDashOffset:o.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:a,options:{border:h,grid:p}}=this,x=h.setContext(this.getContext()),T=h.display?x.width:0;if(!T)return;const P=p.setContext(this.getContext(0)).lineWidth,o=this._borderValue;let z,$,q,Q;this.isHorizontal()?(z=cf(e,this.left,T)-T/2,$=cf(e,this.right,P)+P/2,q=Q=o):(q=cf(e,this.top,T)-T/2,Q=cf(e,this.bottom,P)+P/2,z=$=o),a.save(),a.lineWidth=x.width,a.strokeStyle=x.color,a.beginPath(),a.moveTo(z,q),a.lineTo($,Q),a.stroke(),a.restore()}drawLabels(e){if(!this.options.ticks.display)return;const h=this.ctx,p=this._computeLabelArea();p&&qb(h,p);const x=this.getLabelItems(e);for(const T of x){const P=T.options,o=T.font,z=T.label,$=T.textOffset;mx(h,z,0,$,o,P)}p&&Zb(h)}drawTitle(){const{ctx:e,options:{position:a,title:h,reverse:p}}=this;if(!h.display)return;const x=Ho(h.font),T=Sl(h.padding),P=h.align;let o=x.lineHeight/2;a==="bottom"||a==="center"||Fs(a)?(o+=T.bottom,kr(h.text)&&(o+=x.lineHeight*(h.text.length-1))):o+=T.top;const{titleX:z,titleY:$,maxWidth:q,rotation:Q}=x3(this,o,a,P);mx(e,h.text,0,0,x,{color:h.color,maxWidth:q,rotation:Q,textAlign:y3(P,a,p),textBaseline:"middle",translation:[z,$]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,a=e.ticks&&e.ticks.z||0,h=qs(e.grid&&e.grid.z,-1),p=qs(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==lm.prototype.draw?[{z:a,draw:x=>{this.draw(x)}}]:[{z:h,draw:x=>{this.drawBackground(),this.drawGrid(x),this.drawTitle()}},{z:p,draw:()=>{this.drawBorder()}},{z:a,draw:x=>{this.drawLabels(x)}}]}getMatchingVisibleMetas(e){const a=this.chart.getSortedVisibleDatasetMetas(),h=this.axis+"AxisID",p=[];let x,T;for(x=0,T=a.length;x<T;++x){const P=a[x];P[h]===this.id&&(!e||P.type===e)&&p.push(P)}return p}_resolveTickFontOptions(e){const a=this.options.ticks.setContext(this.getContext(e));return Ho(a.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class zy{constructor(e,a,h){this.type=e,this.scope=a,this.override=h,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const a=Object.getPrototypeOf(e);let h;w3(a)&&(h=this.register(a));const p=this.items,x=e.id,T=this.scope+"."+x;if(!x)throw new Error("class does not have id: "+e);return x in p||(p[x]=e,v3(e,T,h),this.override&&tr.override(e.id,e.overrides)),T}get(e){return this.items[e]}unregister(e){const a=this.items,h=e.id,p=this.scope;h in a&&delete a[h],p&&h in tr[p]&&(delete tr[p][h],this.override&&delete vf[h])}}function v3(i,e,a){const h=Jg(Object.create(null),[a?tr.get(a):{},tr.get(e),i.defaults]);tr.set(e,h),i.defaultRoutes&&b3(e,i.defaultRoutes),i.descriptors&&tr.describe(e,i.descriptors)}function b3(i,e){Object.keys(e).forEach(a=>{const h=a.split("."),p=h.pop(),x=[i].concat(h).join("."),T=e[a].split("."),P=T.pop(),o=T.join(".");tr.route(x,p,o,P)})}function w3(i){return"id"in i&&"defaults"in i}class T3{constructor(){this.controllers=new zy(Ng,"datasets",!0),this.elements=new zy(l_,"elements"),this.plugins=new zy(Object,"plugins"),this.scales=new zy(lm,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,a,h){[...a].forEach(p=>{const x=h||this._getRegistryForType(p);h||x.isForType(p)||x===this.plugins&&p.id?this._exec(e,x,p):sn(p,T=>{const P=h||this._getRegistryForType(T);this._exec(e,P,T)})})}_exec(e,a,h){const p=Hb(e);kn(h["before"+p],[],h),a[e](h),kn(h["after"+p],[],h)}_getRegistryForType(e){for(let a=0;a<this._typedRegistries.length;a++){const h=this._typedRegistries[a];if(h.isForType(e))return h}return this.plugins}_get(e,a,h){const p=a.get(e);if(p===void 0)throw new Error('"'+e+'" is not a registered '+h+".");return p}}var fc=new T3;class S3{constructor(){this._init=[]}notify(e,a,h,p){a==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const x=p?this._descriptors(e).filter(p):this._descriptors(e),T=this._notify(x,e,a,h);return a==="afterDestroy"&&(this._notify(x,e,"stop"),this._notify(this._init,e,"uninstall")),T}_notify(e,a,h,p){p=p||{};for(const x of e){const T=x.plugin,P=T[h],o=[a,p,x.options];if(kn(P,o,T)===!1&&p.cancelable)return!1}return!0}invalidate(){fn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const a=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),a}_createDescriptors(e,a){const h=e&&e.config,p=qs(h.options&&h.options.plugins,{}),x=E3(h);return p===!1&&!a?[]:A3(e,x,p,a)}_notifyStateChanges(e){const a=this._oldCache||[],h=this._cache,p=(x,T)=>x.filter(P=>!T.some(o=>P.plugin.id===o.plugin.id));this._notify(p(a,h),e,"stop"),this._notify(p(h,a),e,"start")}}function E3(i){const e={},a=[],h=Object.keys(fc.plugins.items);for(let x=0;x<h.length;x++)a.push(fc.getPlugin(h[x]));const p=i.plugins||[];for(let x=0;x<p.length;x++){const T=p[x];a.indexOf(T)===-1&&(a.push(T),e[T.id]=!0)}return{plugins:a,localIds:e}}function M3(i,e){return!e&&i===!1?null:i===!0?{}:i}function A3(i,{plugins:e,localIds:a},h,p){const x=[],T=i.getContext();for(const P of e){const o=P.id,z=M3(h[o],p);z!==null&&x.push({plugin:P,options:C3(i.config,{plugin:P,local:a[o]},z,T)})}return x}function C3(i,{plugin:e,local:a},h,p){const x=i.pluginScopeKeys(e),T=i.getOptionScopes(h,x);return a&&e.defaults&&T.push(e.defaults),i.createResolver(T,p,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function nb(i,e){const a=tr.datasets[i]||{};return((e.datasets||{})[i]||{}).indexAxis||e.indexAxis||a.indexAxis||"x"}function k3(i,e){let a=i;return i==="_index_"?a=e:i==="_value_"&&(a=e==="x"?"y":"x"),a}function P3(i,e){return i===e?"_index_":"_value_"}function QT(i){if(i==="x"||i==="y"||i==="r")return i}function I3(i){if(i==="top"||i==="bottom")return"x";if(i==="left"||i==="right")return"y"}function rb(i,...e){if(QT(i))return i;for(const a of e){const h=a.axis||I3(a.position)||i.length>1&&QT(i[0].toLowerCase());if(h)return h}throw new Error(`Cannot determine type of '${i}' axis. Please provide 'axis' or 'position' option.`)}function tS(i,e,a){if(a[e+"AxisID"]===i)return{axis:e}}function L3(i,e){if(e.data&&e.data.datasets){const a=e.data.datasets.filter(h=>h.xAxisID===i||h.yAxisID===i);if(a.length)return tS(i,"x",a[0])||tS(i,"y",a[0])}return{}}function D3(i,e){const a=vf[i.type]||{scales:{}},h=e.scales||{},p=nb(i.type,e),x=Object.create(null);return Object.keys(h).forEach(T=>{const P=h[T];if(!Fs(P))return console.error(`Invalid scale configuration for scale: ${T}`);if(P._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${T}`);const o=rb(T,P,L3(T,i),tr.scales[P.type]),z=P3(o,p),$=a.scales||{};x[T]=Rg(Object.create(null),[{axis:o},P,$[o],$[z]])}),i.data.datasets.forEach(T=>{const P=T.type||i.type,o=T.indexAxis||nb(P,e),$=(vf[P]||{}).scales||{};Object.keys($).forEach(q=>{const Q=k3(q,o),nt=T[Q+"AxisID"]||Q;x[nt]=x[nt]||Object.create(null),Rg(x[nt],[{axis:Q},h[nt],$[q]])})}),Object.keys(x).forEach(T=>{const P=x[T];Rg(P,[tr.scales[P.type],tr.scale])}),x}function PA(i){const e=i.options||(i.options={});e.plugins=qs(e.plugins,{}),e.scales=D3(i,e)}function IA(i){return i=i||{},i.datasets=i.datasets||[],i.labels=i.labels||[],i}function z3(i){return i=i||{},i.data=IA(i.data),PA(i),i}const eS=new Map,LA=new Set;function Oy(i,e){let a=eS.get(i);return a||(a=e(),eS.set(i,a),LA.add(a)),a}const yg=(i,e,a)=>{const h=em(e,a);h!==void 0&&i.add(h)};class O3{constructor(e){this._config=z3(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=IA(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),PA(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return Oy(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,a){return Oy(`${e}.transition.${a}`,()=>[[`datasets.${e}.transitions.${a}`,`transitions.${a}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,a){return Oy(`${e}-${a}`,()=>[[`datasets.${e}.elements.${a}`,`datasets.${e}`,`elements.${a}`,""]])}pluginScopeKeys(e){const a=e.id,h=this.type;return Oy(`${h}-plugin-${a}`,()=>[[`plugins.${a}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,a){const h=this._scopeCache;let p=h.get(e);return(!p||a)&&(p=new Map,h.set(e,p)),p}getOptionScopes(e,a,h){const{options:p,type:x}=this,T=this._cachedScopes(e,h),P=T.get(a);if(P)return P;const o=new Set;a.forEach($=>{e&&(o.add(e),$.forEach(q=>yg(o,e,q))),$.forEach(q=>yg(o,p,q)),$.forEach(q=>yg(o,vf[x]||{},q)),$.forEach(q=>yg(o,tr,q)),$.forEach(q=>yg(o,sb,q))});const z=Array.from(o);return z.length===0&&z.push(Object.create(null)),LA.has(a)&&T.set(a,z),z}chartOptionScopes(){const{options:e,type:a}=this;return[e,vf[a]||{},tr.datasets[a]||{},{type:a},tr,sb]}resolveNamedOptions(e,a,h,p=[""]){const x={$shared:!0},{resolver:T,subPrefixes:P}=iS(this._resolverCache,e,p);let o=T;if(B3(T,a)){x.$shared=!1,h=Ru(h)?h():h;const z=this.createResolver(e,h,P);o=im(T,h,z)}for(const z of a)x[z]=o[z];return x}createResolver(e,a,h=[""],p){const{resolver:x}=iS(this._resolverCache,e,h);return Fs(a)?im(x,a,void 0,p):x}}function iS(i,e,a){let h=i.get(e);h||(h=new Map,i.set(e,h));const p=a.join();let x=h.get(p);return x||(x={resolver:Yb(e,a),subPrefixes:a.filter(P=>!P.toLowerCase().includes("hover"))},h.set(p,x)),x}const R3=i=>Fs(i)&&Object.getOwnPropertyNames(i).some(e=>Ru(i[e]));function B3(i,e){const{isScriptable:a,isIndexable:h}=gA(i);for(const p of e){const x=a(p),T=h(p),P=(T||x)&&i[p];if(x&&(Ru(P)||R3(P))||T&&kr(P))return!0}return!1}var F3="4.5.0";const N3=["top","bottom","left","right","chartArea"];function sS(i,e){return i==="top"||i==="bottom"||N3.indexOf(i)===-1&&e==="x"}function nS(i,e){return function(a,h){return a[i]===h[i]?a[e]-h[e]:a[i]-h[i]}}function rS(i){const e=i.chart,a=e.options.animation;e.notifyPlugins("afterRender"),kn(a&&a.onComplete,[i],e)}function j3(i){const e=i.chart,a=e.options.animation;kn(a&&a.onProgress,[i],e)}function DA(i){return Qb()&&typeof i=="string"?i=document.getElementById(i):i&&i.length&&(i=i[0]),i&&i.canvas&&(i=i.canvas),i}const Hy={},oS=i=>{const e=DA(i);return Object.values(Hy).filter(a=>a.canvas===e).pop()};function U3(i,e,a){const h=Object.keys(i);for(const p of h){const x=+p;if(x>=e){const T=i[p];delete i[p],(a>0||x>e)&&(i[x+a]=T)}}}function V3(i,e,a,h){return!a||i.type==="mouseout"?null:h?e:i}class oh{static register(...e){fc.add(...e),aS()}static unregister(...e){fc.remove(...e),aS()}constructor(e,a){const h=this.config=new O3(a),p=DA(e),x=oS(p);if(x)throw new Error("Canvas is already in use. Chart with ID '"+x.id+"' must be destroyed before the canvas with ID '"+x.canvas.id+"' can be reused.");const T=h.createResolver(h.chartOptionScopes(),this.getContext());this.platform=new(h.platform||o3(p)),this.platform.updateConfig(h);const P=this.platform.acquireContext(p,T.aspectRatio),o=P&&P.canvas,z=o&&o.height,$=o&&o.width;if(this.id=nO(),this.ctx=P,this.canvas=o,this.width=$,this.height=z,this._options=T,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new S3,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=SO(q=>this.update(q),T.resizeDelay||0),this._dataChanges=[],Hy[this.id]=this,!P||!o){console.error("Failed to create chart: can't acquire context from the given item");return}ih.listen(this,"complete",rS),ih.listen(this,"progress",j3),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:a},width:h,height:p,_aspectRatio:x}=this;return fn(e)?a&&x?x:p?h/p:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return fc}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():LT(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return CT(this.canvas,this.ctx),this}stop(){return ih.stop(this),this}resize(e,a){ih.running(this)?this._resizeBeforeDraw={width:e,height:a}:this._resize(e,a)}_resize(e,a){const h=this.options,p=this.canvas,x=h.maintainAspectRatio&&this.aspectRatio,T=this.platform.getMaximumSize(p,e,a,x),P=h.devicePixelRatio||this.platform.getDevicePixelRatio(),o=this.width?"resize":"attach";this.width=T.width,this.height=T.height,this._aspectRatio=this.aspectRatio,LT(this,P,!0)&&(this.notifyPlugins("resize",{size:T}),kn(h.onResize,[this,T],this),this.attached&&this._doResize(o)&&this.render())}ensureScalesHaveIDs(){const a=this.options.scales||{};sn(a,(h,p)=>{h.id=p})}buildOrUpdateScales(){const e=this.options,a=e.scales,h=this.scales,p=Object.keys(h).reduce((T,P)=>(T[P]=!1,T),{});let x=[];a&&(x=x.concat(Object.keys(a).map(T=>{const P=a[T],o=rb(T,P),z=o==="r",$=o==="x";return{options:P,dposition:z?"chartArea":$?"bottom":"left",dtype:z?"radialLinear":$?"category":"linear"}}))),sn(x,T=>{const P=T.options,o=P.id,z=rb(o,P),$=qs(P.type,T.dtype);(P.position===void 0||sS(P.position,z)!==sS(T.dposition))&&(P.position=T.dposition),p[o]=!0;let q=null;if(o in h&&h[o].type===$)q=h[o];else{const Q=fc.getScale($);q=new Q({id:o,type:$,ctx:this.ctx,chart:this}),h[q.id]=q}q.init(P,e)}),sn(p,(T,P)=>{T||delete h[P]}),sn(h,T=>{Mu.configure(this,T,T.options),Mu.addBox(this,T)})}_updateMetasets(){const e=this._metasets,a=this.data.datasets.length,h=e.length;if(e.sort((p,x)=>p.index-x.index),h>a){for(let p=a;p<h;++p)this._destroyDatasetMeta(p);e.splice(a,h-a)}this._sortedMetasets=e.slice(0).sort(nS("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:a}}=this;e.length>a.length&&delete this._stacks,e.forEach((h,p)=>{a.filter(x=>x===h._dataset).length===0&&this._destroyDatasetMeta(p)})}buildOrUpdateControllers(){const e=[],a=this.data.datasets;let h,p;for(this._removeUnreferencedMetasets(),h=0,p=a.length;h<p;h++){const x=a[h];let T=this.getDatasetMeta(h);const P=x.type||this.config.type;if(T.type&&T.type!==P&&(this._destroyDatasetMeta(h),T=this.getDatasetMeta(h)),T.type=P,T.indexAxis=x.indexAxis||nb(P,this.options),T.order=x.order||0,T.index=h,T.label=""+x.label,T.visible=this.isDatasetVisible(h),T.controller)T.controller.updateIndex(h),T.controller.linkScales();else{const o=fc.getController(P),{datasetElementType:z,dataElementType:$}=tr.datasets[P];Object.assign(o,{dataElementType:fc.getElement($),datasetElementType:z&&fc.getElement(z)}),T.controller=new o(this,h),e.push(T.controller)}}return this._updateMetasets(),e}_resetElements(){sn(this.data.datasets,(e,a)=>{this.getDatasetMeta(a).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const a=this.config;a.update();const h=this._options=a.createResolver(a.chartOptionScopes(),this.getContext()),p=this._animationsDisabled=!h.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const x=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let T=0;for(let z=0,$=this.data.datasets.length;z<$;z++){const{controller:q}=this.getDatasetMeta(z),Q=!p&&x.indexOf(q)===-1;q.buildOrUpdateElements(Q),T=Math.max(+q.getMaxOverflow(),T)}T=this._minPadding=h.layout.autoPadding?T:0,this._updateLayout(T),p||sn(x,z=>{z.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(nS("z","_idx"));const{_active:P,_lastEvent:o}=this;o?this._eventHandler(o,!0):P.length&&this._updateHoverStyles(P,P,!0),this.render()}_updateScales(){sn(this.scales,e=>{Mu.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,a=new Set(Object.keys(this._listeners)),h=new Set(e.events);(!yT(a,h)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,a=this._getUniformDataChanges()||[];for(const{method:h,start:p,count:x}of a){const T=h==="_removeElements"?-x:x;U3(e,p,T)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const a=this.data.datasets.length,h=x=>new Set(e.filter(T=>T[0]===x).map((T,P)=>P+","+T.splice(1).join(","))),p=h(0);for(let x=1;x<a;x++)if(!yT(p,h(x)))return;return Array.from(p).map(x=>x.split(",")).map(x=>({method:x[1],start:+x[2],count:+x[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Mu.update(this,this.width,this.height,e);const a=this.chartArea,h=a.width<=0||a.height<=0;this._layers=[],sn(this.boxes,p=>{h&&p.position==="chartArea"||(p.configure&&p.configure(),this._layers.push(...p._layers()))},this),this._layers.forEach((p,x)=>{p._idx=x}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let a=0,h=this.data.datasets.length;a<h;++a)this.getDatasetMeta(a).controller.configure();for(let a=0,h=this.data.datasets.length;a<h;++a)this._updateDataset(a,Ru(e)?e({datasetIndex:a}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,a){const h=this.getDatasetMeta(e),p={meta:h,index:e,mode:a,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",p)!==!1&&(h.controller._update(a),p.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",p))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(ih.has(this)?this.attached&&!ih.running(this)&&ih.start(this):(this.draw(),rS({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:h,height:p}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(h,p)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const a=this._layers;for(e=0;e<a.length&&a[e].z<=0;++e)a[e].draw(this.chartArea);for(this._drawDatasets();e<a.length;++e)a[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const a=this._sortedMetasets,h=[];let p,x;for(p=0,x=a.length;p<x;++p){const T=a[p];(!e||T.visible)&&h.push(T)}return h}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let a=e.length-1;a>=0;--a)this._drawDataset(e[a]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const a=this.ctx,h={meta:e,index:e.index,cancelable:!0},p=cR(this,e);this.notifyPlugins("beforeDatasetDraw",h)!==!1&&(p&&qb(a,p),e.controller.draw(),p&&Zb(a),h.cancelable=!1,this.notifyPlugins("afterDatasetDraw",h))}isPointInArea(e){return fA(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,a,h,p){const x=NR.modes[a];return typeof x=="function"?x(this,e,h,p):[]}getDatasetMeta(e){const a=this.data.datasets[e],h=this._metasets;let p=h.filter(x=>x&&x._dataset===a).pop();return p||(p={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:a&&a.order||0,index:e,_dataset:a,_parsed:[],_sorted:!1},h.push(p)),p}getContext(){return this.$context||(this.$context=am(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const a=this.data.datasets[e];if(!a)return!1;const h=this.getDatasetMeta(e);return typeof h.hidden=="boolean"?!h.hidden:!a.hidden}setDatasetVisibility(e,a){const h=this.getDatasetMeta(e);h.hidden=!a}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,a,h){const p=h?"show":"hide",x=this.getDatasetMeta(e),T=x.controller._resolveAnimations(void 0,p);Qg(a)?(x.data[a].hidden=!h,this.update()):(this.setDatasetVisibility(e,h),T.update(x,{visible:h}),this.update(P=>P.datasetIndex===e?p:void 0))}hide(e,a){this._updateVisibility(e,a,!1)}show(e,a){this._updateVisibility(e,a,!0)}_destroyDatasetMeta(e){const a=this._metasets[e];a&&a.controller&&a.controller._destroy(),delete this._metasets[e]}_stop(){let e,a;for(this.stop(),ih.remove(this),e=0,a=this.data.datasets.length;e<a;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:a}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),CT(e,a),this.platform.releaseContext(a),this.canvas=null,this.ctx=null),delete Hy[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,a=this.platform,h=(x,T)=>{a.addEventListener(this,x,T),e[x]=T},p=(x,T,P)=>{x.offsetX=T,x.offsetY=P,this._eventHandler(x)};sn(this.options.events,x=>h(x,p))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,a=this.platform,h=(o,z)=>{a.addEventListener(this,o,z),e[o]=z},p=(o,z)=>{e[o]&&(a.removeEventListener(this,o,z),delete e[o])},x=(o,z)=>{this.canvas&&this.resize(o,z)};let T;const P=()=>{p("attach",P),this.attached=!0,this.resize(),h("resize",x),h("detach",T)};T=()=>{this.attached=!1,p("resize",x),this._stop(),this._resize(0,0),h("attach",P)},a.isAttached(this.canvas)?P():T()}unbindEvents(){sn(this._listeners,(e,a)=>{this.platform.removeEventListener(this,a,e)}),this._listeners={},sn(this._responsiveListeners,(e,a)=>{this.platform.removeEventListener(this,a,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,a,h){const p=h?"set":"remove";let x,T,P,o;for(a==="dataset"&&(x=this.getDatasetMeta(e[0].datasetIndex),x.controller["_"+p+"DatasetHoverStyle"]()),P=0,o=e.length;P<o;++P){T=e[P];const z=T&&this.getDatasetMeta(T.datasetIndex).controller;z&&z[p+"HoverStyle"](T.element,T.datasetIndex,T.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const a=this._active||[],h=e.map(({datasetIndex:x,index:T})=>{const P=this.getDatasetMeta(x);if(!P)throw new Error("No dataset found at index "+x);return{datasetIndex:x,element:P.data[T],index:T}});!ux(h,a)&&(this._active=h,this._lastEvent=null,this._updateHoverStyles(h,a))}notifyPlugins(e,a,h){return this._plugins.notify(this,e,a,h)}isPluginEnabled(e){return this._plugins._cache.filter(a=>a.plugin.id===e).length===1}_updateHoverStyles(e,a,h){const p=this.options.hover,x=(o,z)=>o.filter($=>!z.some(q=>$.datasetIndex===q.datasetIndex&&$.index===q.index)),T=x(a,e),P=h?e:x(e,a);T.length&&this.updateHoverStyle(T,p.mode,!1),P.length&&p.mode&&this.updateHoverStyle(P,p.mode,!0)}_eventHandler(e,a){const h={event:e,replay:a,cancelable:!0,inChartArea:this.isPointInArea(e)},p=T=>(T.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",h,p)===!1)return;const x=this._handleEvent(e,a,h.inChartArea);return h.cancelable=!1,this.notifyPlugins("afterEvent",h,p),(x||h.changed)&&this.render(),this}_handleEvent(e,a,h){const{_active:p=[],options:x}=this,T=a,P=this._getActiveElements(e,p,h,T),o=hO(e),z=V3(e,this._lastEvent,h,o);h&&(this._lastEvent=null,kn(x.onHover,[e,P,this],this),o&&kn(x.onClick,[e,P,this],this));const $=!ux(P,p);return($||a)&&(this._active=P,this._updateHoverStyles(P,p,a)),this._lastEvent=z,$}_getActiveElements(e,a,h,p){if(e.type==="mouseout")return[];if(!h)return a;const x=this.options.hover;return this.getElementsAtEventForMode(e,x.mode,x,p)}}Ls(oh,"defaults",tr),Ls(oh,"instances",Hy),Ls(oh,"overrides",vf),Ls(oh,"registry",fc),Ls(oh,"version",F3),Ls(oh,"getChart",oS);function aS(){return sn(oh.instances,i=>i._plugins.invalidate())}function zA(i,e){const{x:a,y:h,base:p,width:x,height:T}=i.getProps(["x","y","base","width","height"],e);let P,o,z,$,q;return i.horizontal?(q=T/2,P=Math.min(a,p),o=Math.max(a,p),z=h-q,$=h+q):(q=x/2,P=a-q,o=a+q,z=Math.min(h,p),$=Math.max(h,p)),{left:P,top:z,right:o,bottom:$}}function Au(i,e,a,h){return i?0:vl(e,a,h)}function $3(i,e,a){const h=i.options.borderWidth,p=i.borderSkipped,x=mA(h);return{t:Au(p.top,x.top,0,a),r:Au(p.right,x.right,0,e),b:Au(p.bottom,x.bottom,0,a),l:Au(p.left,x.left,0,e)}}function G3(i,e,a){const{enableBorderRadius:h}=i.getProps(["enableBorderRadius"]),p=i.options.borderRadius,x=Xp(p),T=Math.min(e,a),P=i.borderSkipped,o=h||Fs(p);return{topLeft:Au(!o||P.top||P.left,x.topLeft,0,T),topRight:Au(!o||P.top||P.right,x.topRight,0,T),bottomLeft:Au(!o||P.bottom||P.left,x.bottomLeft,0,T),bottomRight:Au(!o||P.bottom||P.right,x.bottomRight,0,T)}}function W3(i){const e=zA(i),a=e.right-e.left,h=e.bottom-e.top,p=$3(i,a/2,h/2),x=G3(i,a/2,h/2);return{outer:{x:e.left,y:e.top,w:a,h,radius:x},inner:{x:e.left+p.l,y:e.top+p.t,w:a-p.l-p.r,h:h-p.t-p.b,radius:{topLeft:Math.max(0,x.topLeft-Math.max(p.t,p.l)),topRight:Math.max(0,x.topRight-Math.max(p.t,p.r)),bottomLeft:Math.max(0,x.bottomLeft-Math.max(p.b,p.l)),bottomRight:Math.max(0,x.bottomRight-Math.max(p.b,p.r))}}}}function Av(i,e,a,h){const p=e===null,x=a===null,P=i&&!(p&&x)&&zA(i,h);return P&&(p||Fp(e,P.left,P.right))&&(x||Fp(a,P.top,P.bottom))}function H3(i){return i.topLeft||i.topRight||i.bottomLeft||i.bottomRight}function X3(i,e){i.rect(e.x,e.y,e.w,e.h)}function Cv(i,e,a={}){const h=i.x!==a.x?-e:0,p=i.y!==a.y?-e:0,x=(i.x+i.w!==a.x+a.w?e:0)-h,T=(i.y+i.h!==a.y+a.h?e:0)-p;return{x:i.x+h,y:i.y+p,w:i.w+x,h:i.h+T,radius:i.radius}}class Xy extends l_{constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:a,options:{borderColor:h,backgroundColor:p}}=this,{inner:x,outer:T}=W3(this),P=H3(T.radius)?gx:X3;e.save(),(T.w!==x.w||T.h!==x.h)&&(e.beginPath(),P(e,Cv(T,a,x)),e.clip(),P(e,Cv(x,-a,T)),e.fillStyle=h,e.fill("evenodd")),e.beginPath(),P(e,Cv(x,a)),e.fillStyle=p,e.fill(),e.restore()}inRange(e,a,h){return Av(this,e,a,h)}inXRange(e,a){return Av(this,e,null,a)}inYRange(e,a){return Av(this,null,e,a)}getCenterPoint(e){const{x:a,y:h,base:p,horizontal:x}=this.getProps(["x","y","base","horizontal"],e);return{x:x?(a+p)/2:a,y:x?h:(h+p)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}}Ls(Xy,"id","bar"),Ls(Xy,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),Ls(Xy,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});const lS=(i,e)=>{let{boxHeight:a=e,boxWidth:h=e}=i;return i.usePointStyle&&(a=Math.min(a,e),h=i.pointStyleWidth||Math.min(h,e)),{boxWidth:h,boxHeight:a,itemHeight:Math.max(e,a)}},q3=(i,e)=>i!==null&&e!==null&&i.datasetIndex===e.datasetIndex&&i.index===e.index;class cS extends l_{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,a,h){this.maxWidth=e,this.maxHeight=a,this._margins=h,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let a=kn(e.generateLabels,[this.chart],this)||[];e.filter&&(a=a.filter(h=>e.filter(h,this.chart.data))),e.sort&&(a=a.sort((h,p)=>e.sort(h,p,this.chart.data))),this.options.reverse&&a.reverse(),this.legendItems=a}fit(){const{options:e,ctx:a}=this;if(!e.display){this.width=this.height=0;return}const h=e.labels,p=Ho(h.font),x=p.size,T=this._computeTitleHeight(),{boxWidth:P,itemHeight:o}=lS(h,x);let z,$;a.font=p.string,this.isHorizontal()?(z=this.maxWidth,$=this._fitRows(T,x,P,o)+10):($=this.maxHeight,z=this._fitCols(T,p,P,o)+10),this.width=Math.min(z,e.maxWidth||this.maxWidth),this.height=Math.min($,e.maxHeight||this.maxHeight)}_fitRows(e,a,h,p){const{ctx:x,maxWidth:T,options:{labels:{padding:P}}}=this,o=this.legendHitBoxes=[],z=this.lineWidths=[0],$=p+P;let q=e;x.textAlign="left",x.textBaseline="middle";let Q=-1,nt=-$;return this.legendItems.forEach((Tt,yt)=>{const Lt=h+a/2+x.measureText(Tt.text).width;(yt===0||z[z.length-1]+Lt+2*P>T)&&(q+=$,z[z.length-(yt>0?0:1)]=0,nt+=$,Q++),o[yt]={left:0,top:nt,row:Q,width:Lt,height:p},z[z.length-1]+=Lt+P}),q}_fitCols(e,a,h,p){const{ctx:x,maxHeight:T,options:{labels:{padding:P}}}=this,o=this.legendHitBoxes=[],z=this.columnSizes=[],$=T-e;let q=P,Q=0,nt=0,Tt=0,yt=0;return this.legendItems.forEach((Lt,Nt)=>{const{itemWidth:Dt,itemHeight:wt}=Z3(h,a,x,Lt,p);Nt>0&&nt+wt+2*P>$&&(q+=Q+P,z.push({width:Q,height:nt}),Tt+=Q+P,yt++,Q=nt=0),o[Nt]={left:Tt,top:nt,col:yt,width:Dt,height:wt},Q=Math.max(Q,Dt),nt+=wt+P}),q+=Q,z.push({width:Q,height:nt}),q}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:a,options:{align:h,labels:{padding:p},rtl:x}}=this,T=qp(x,this.left,this.width);if(this.isHorizontal()){let P=0,o=ga(h,this.left+p,this.right-this.lineWidths[P]);for(const z of a)P!==z.row&&(P=z.row,o=ga(h,this.left+p,this.right-this.lineWidths[P])),z.top+=this.top+e+p,z.left=T.leftForLtr(T.x(o),z.width),o+=z.width+p}else{let P=0,o=ga(h,this.top+e+p,this.bottom-this.columnSizes[P].height);for(const z of a)z.col!==P&&(P=z.col,o=ga(h,this.top+e+p,this.bottom-this.columnSizes[P].height)),z.top=o,z.left+=this.left+p,z.left=T.leftForLtr(T.x(z.left),z.width),o+=z.height+p}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;qb(e,this),this._draw(),Zb(e)}}_draw(){const{options:e,columnSizes:a,lineWidths:h,ctx:p}=this,{align:x,labels:T}=e,P=tr.color,o=qp(e.rtl,this.left,this.width),z=Ho(T.font),{padding:$}=T,q=z.size,Q=q/2;let nt;this.drawTitle(),p.textAlign=o.textAlign("left"),p.textBaseline="middle",p.lineWidth=.5,p.font=z.string;const{boxWidth:Tt,boxHeight:yt,itemHeight:Lt}=lS(T,q),Nt=function(Zt,re,kt){if(isNaN(Tt)||Tt<=0||isNaN(yt)||yt<0)return;p.save();const ne=qs(kt.lineWidth,1);if(p.fillStyle=qs(kt.fillStyle,P),p.lineCap=qs(kt.lineCap,"butt"),p.lineDashOffset=qs(kt.lineDashOffset,0),p.lineJoin=qs(kt.lineJoin,"miter"),p.lineWidth=ne,p.strokeStyle=qs(kt.strokeStyle,P),p.setLineDash(qs(kt.lineDash,[])),T.usePointStyle){const Ut={radius:yt*Math.SQRT2/2,pointStyle:kt.pointStyle,rotation:kt.rotation,borderWidth:ne},Le=o.xPlus(Zt,Tt/2),ye=re+Q;dA(p,Ut,Le,ye,T.pointStyleWidth&&Tt)}else{const Ut=re+Math.max((q-yt)/2,0),Le=o.leftForLtr(Zt,Tt),ye=Xp(kt.borderRadius);p.beginPath(),Object.values(ye).some(Ce=>Ce!==0)?gx(p,{x:Le,y:Ut,w:Tt,h:yt,radius:ye}):p.rect(Le,Ut,Tt,yt),p.fill(),ne!==0&&p.stroke()}p.restore()},Dt=function(Zt,re,kt){mx(p,kt.text,Zt,re+Lt/2,z,{strikethrough:kt.hidden,textAlign:o.textAlign(kt.textAlign)})},wt=this.isHorizontal(),It=this._computeTitleHeight();wt?nt={x:ga(x,this.left+$,this.right-h[0]),y:this.top+$+It,line:0}:nt={x:this.left+$,y:ga(x,this.top+It+$,this.bottom-a[0].height),line:0},vA(this.ctx,e.textDirection);const Xt=Lt+$;this.legendItems.forEach((Zt,re)=>{p.strokeStyle=Zt.fontColor,p.fillStyle=Zt.fontColor;const kt=p.measureText(Zt.text).width,ne=o.textAlign(Zt.textAlign||(Zt.textAlign=T.textAlign)),Ut=Tt+Q+kt;let Le=nt.x,ye=nt.y;o.setWidth(this.width),wt?re>0&&Le+Ut+$>this.right&&(ye=nt.y+=Xt,nt.line++,Le=nt.x=ga(x,this.left+$,this.right-h[nt.line])):re>0&&ye+Xt>this.bottom&&(Le=nt.x=Le+a[nt.line].width+$,nt.line++,ye=nt.y=ga(x,this.top+It+$,this.bottom-a[nt.line].height));const Ce=o.x(Le);if(Nt(Ce,ye,Zt),Le=EO(ne,Le+Tt+Q,wt?Le+Ut:this.right,e.rtl),Dt(o.x(Le),ye,Zt),wt)nt.x+=Ut+$;else if(typeof Zt.text!="string"){const di=z.lineHeight;nt.y+=OA(Zt,di)+$}else nt.y+=Xt}),bA(this.ctx,e.textDirection)}drawTitle(){const e=this.options,a=e.title,h=Ho(a.font),p=Sl(a.padding);if(!a.display)return;const x=qp(e.rtl,this.left,this.width),T=this.ctx,P=a.position,o=h.size/2,z=p.top+o;let $,q=this.left,Q=this.width;if(this.isHorizontal())Q=Math.max(...this.lineWidths),$=this.top+z,q=ga(e.align,q,this.right-Q);else{const Tt=this.columnSizes.reduce((yt,Lt)=>Math.max(yt,Lt.height),0);$=z+ga(e.align,this.top,this.bottom-Tt-e.labels.padding-this._computeTitleHeight())}const nt=ga(P,q,q+Q);T.textAlign=x.textAlign(lA(P)),T.textBaseline="middle",T.strokeStyle=a.color,T.fillStyle=a.color,T.font=h.string,mx(T,a.text,nt,$,h)}_computeTitleHeight(){const e=this.options.title,a=Ho(e.font),h=Sl(e.padding);return e.display?a.lineHeight+h.height:0}_getLegendItemAt(e,a){let h,p,x;if(Fp(e,this.left,this.right)&&Fp(a,this.top,this.bottom)){for(x=this.legendHitBoxes,h=0;h<x.length;++h)if(p=x[h],Fp(e,p.left,p.left+p.width)&&Fp(a,p.top,p.top+p.height))return this.legendItems[h]}return null}handleEvent(e){const a=this.options;if(!J3(e.type,a))return;const h=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const p=this._hoveredItem,x=q3(p,h);p&&!x&&kn(a.onLeave,[e,p,this],this),this._hoveredItem=h,h&&!x&&kn(a.onHover,[e,h,this],this)}else h&&kn(a.onClick,[e,h,this],this)}}function Z3(i,e,a,h,p){const x=Y3(h,i,e,a),T=K3(p,h,e.lineHeight);return{itemWidth:x,itemHeight:T}}function Y3(i,e,a,h){let p=i.text;return p&&typeof p!="string"&&(p=p.reduce((x,T)=>x.length>T.length?x:T)),e+a.size/2+h.measureText(p).width}function K3(i,e,a){let h=i;return typeof e.text!="string"&&(h=OA(e,a)),h}function OA(i,e){const a=i.text?i.text.length:0;return e*a}function J3(i,e){return!!((i==="mousemove"||i==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(i==="click"||i==="mouseup"))}var Q3={id:"legend",_element:cS,start(i,e,a){const h=i.legend=new cS({ctx:i.ctx,options:a,chart:i});Mu.configure(i,h,a),Mu.addBox(i,h)},stop(i){Mu.removeBox(i,i.legend),delete i.legend},beforeUpdate(i,e,a){const h=i.legend;Mu.configure(i,h,a),h.options=a},afterUpdate(i){const e=i.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(i,e){e.replay||i.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(i,e,a){const h=e.datasetIndex,p=a.chart;p.isDatasetVisible(h)?(p.hide(h),e.hidden=!0):(p.show(h),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:i=>i.chart.options.color,boxWidth:40,padding:10,generateLabels(i){const e=i.data.datasets,{labels:{usePointStyle:a,pointStyle:h,textAlign:p,color:x,useBorderRadius:T,borderRadius:P}}=i.legend.options;return i._getSortedDatasetMetas().map(o=>{const z=o.controller.getStyle(a?0:void 0),$=Sl(z.borderWidth);return{text:e[o.index].label,fillStyle:z.backgroundColor,fontColor:x,hidden:!o.visible,lineCap:z.borderCapStyle,lineDash:z.borderDash,lineDashOffset:z.borderDashOffset,lineJoin:z.borderJoinStyle,lineWidth:($.width+$.height)/4,strokeStyle:z.borderColor,pointStyle:h||z.pointStyle,rotation:z.rotation,textAlign:p||z.textAlign,borderRadius:T&&(P||z.borderRadius),datasetIndex:o.index}},this)}},title:{color:i=>i.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:i=>!i.startsWith("on"),labels:{_scriptable:i=>!["generateLabels","filter","sort"].includes(i)}}};const Tg={average(i){if(!i.length)return!1;let e,a,h=new Set,p=0,x=0;for(e=0,a=i.length;e<a;++e){const P=i[e].element;if(P&&P.hasValue()){const o=P.tooltipPosition();h.add(o.x),p+=o.y,++x}}return x===0||h.size===0?!1:{x:[...h].reduce((P,o)=>P+o)/h.size,y:p/x}},nearest(i,e){if(!i.length)return!1;let a=e.x,h=e.y,p=Number.POSITIVE_INFINITY,x,T,P;for(x=0,T=i.length;x<T;++x){const o=i[x].element;if(o&&o.hasValue()){const z=o.getCenterPoint(),$=yO(e,z);$<p&&(p=$,P=o)}}if(P){const o=P.tooltipPosition();a=o.x,h=o.y}return{x:a,y:h}}};function uc(i,e){return e&&(kr(e)?Array.prototype.push.apply(i,e):i.push(e)),i}function sh(i){return(typeof i=="string"||i instanceof String)&&i.indexOf(`
`)>-1?i.split(`
`):i}function tB(i,e){const{element:a,datasetIndex:h,index:p}=e,x=i.getDatasetMeta(h).controller,{label:T,value:P}=x.getLabelAndValue(p);return{chart:i,label:T,parsed:x.getParsed(p),raw:i.data.datasets[h].data[p],formattedValue:P,dataset:x.getDataset(),dataIndex:p,datasetIndex:h,element:a}}function hS(i,e){const a=i.chart.ctx,{body:h,footer:p,title:x}=i,{boxWidth:T,boxHeight:P}=e,o=Ho(e.bodyFont),z=Ho(e.titleFont),$=Ho(e.footerFont),q=x.length,Q=p.length,nt=h.length,Tt=Sl(e.padding);let yt=Tt.height,Lt=0,Nt=h.reduce((It,Xt)=>It+Xt.before.length+Xt.lines.length+Xt.after.length,0);if(Nt+=i.beforeBody.length+i.afterBody.length,q&&(yt+=q*z.lineHeight+(q-1)*e.titleSpacing+e.titleMarginBottom),Nt){const It=e.displayColors?Math.max(P,o.lineHeight):o.lineHeight;yt+=nt*It+(Nt-nt)*o.lineHeight+(Nt-1)*e.bodySpacing}Q&&(yt+=e.footerMarginTop+Q*$.lineHeight+(Q-1)*e.footerSpacing);let Dt=0;const wt=function(It){Lt=Math.max(Lt,a.measureText(It).width+Dt)};return a.save(),a.font=z.string,sn(i.title,wt),a.font=o.string,sn(i.beforeBody.concat(i.afterBody),wt),Dt=e.displayColors?T+2+e.boxPadding:0,sn(h,It=>{sn(It.before,wt),sn(It.lines,wt),sn(It.after,wt)}),Dt=0,a.font=$.string,sn(i.footer,wt),a.restore(),Lt+=Tt.width,{width:Lt,height:yt}}function eB(i,e){const{y:a,height:h}=e;return a<h/2?"top":a>i.height-h/2?"bottom":"center"}function iB(i,e,a,h){const{x:p,width:x}=h,T=a.caretSize+a.caretPadding;if(i==="left"&&p+x+T>e.width||i==="right"&&p-x-T<0)return!0}function sB(i,e,a,h){const{x:p,width:x}=a,{width:T,chartArea:{left:P,right:o}}=i;let z="center";return h==="center"?z=p<=(P+o)/2?"left":"right":p<=x/2?z="left":p>=T-x/2&&(z="right"),iB(z,i,e,a)&&(z="center"),z}function uS(i,e,a){const h=a.yAlign||e.yAlign||eB(i,a);return{xAlign:a.xAlign||e.xAlign||sB(i,e,a,h),yAlign:h}}function nB(i,e){let{x:a,width:h}=i;return e==="right"?a-=h:e==="center"&&(a-=h/2),a}function rB(i,e,a){let{y:h,height:p}=i;return e==="top"?h+=a:e==="bottom"?h-=p+a:h-=p/2,h}function dS(i,e,a,h){const{caretSize:p,caretPadding:x,cornerRadius:T}=i,{xAlign:P,yAlign:o}=a,z=p+x,{topLeft:$,topRight:q,bottomLeft:Q,bottomRight:nt}=Xp(T);let Tt=nB(e,P);const yt=rB(e,o,z);return o==="center"?P==="left"?Tt+=z:P==="right"&&(Tt-=z):P==="left"?Tt-=Math.max($,Q)+p:P==="right"&&(Tt+=Math.max(q,nt)+p),{x:vl(Tt,0,h.width-e.width),y:vl(yt,0,h.height-e.height)}}function Ry(i,e,a){const h=Sl(a.padding);return e==="center"?i.x+i.width/2:e==="right"?i.x+i.width-h.right:i.x+h.left}function fS(i){return uc([],sh(i))}function oB(i,e,a){return am(i,{tooltip:e,tooltipItems:a,type:"tooltip"})}function pS(i,e){const a=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return a?i.override(a):i}const RA={beforeTitle:eh,title(i){if(i.length>0){const e=i[0],a=e.chart.data.labels,h=a?a.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(h>0&&e.dataIndex<h)return a[e.dataIndex]}return""},afterTitle:eh,beforeBody:eh,beforeLabel:eh,label(i){if(this&&this.options&&this.options.mode==="dataset")return i.label+": "+i.formattedValue||i.formattedValue;let e=i.dataset.label||"";e&&(e+=": ");const a=i.formattedValue;return fn(a)||(e+=a),e},labelColor(i){const a=i.chart.getDatasetMeta(i.datasetIndex).controller.getStyle(i.dataIndex);return{borderColor:a.borderColor,backgroundColor:a.backgroundColor,borderWidth:a.borderWidth,borderDash:a.borderDash,borderDashOffset:a.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(i){const a=i.chart.getDatasetMeta(i.datasetIndex).controller.getStyle(i.dataIndex);return{pointStyle:a.pointStyle,rotation:a.rotation}},afterLabel:eh,afterBody:eh,beforeFooter:eh,footer:eh,afterFooter:eh};function Uo(i,e,a,h){const p=i[e].call(a,h);return typeof p>"u"?RA[e].call(a,h):p}class ob extends l_{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const a=this.chart,h=this.options.setContext(this.getContext()),p=h.enabled&&a.options.animation&&h.animations,x=new wA(this.chart,p);return p._cacheable&&(this._cachedAnimations=Object.freeze(x)),x}getContext(){return this.$context||(this.$context=oB(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,a){const{callbacks:h}=a,p=Uo(h,"beforeTitle",this,e),x=Uo(h,"title",this,e),T=Uo(h,"afterTitle",this,e);let P=[];return P=uc(P,sh(p)),P=uc(P,sh(x)),P=uc(P,sh(T)),P}getBeforeBody(e,a){return fS(Uo(a.callbacks,"beforeBody",this,e))}getBody(e,a){const{callbacks:h}=a,p=[];return sn(e,x=>{const T={before:[],lines:[],after:[]},P=pS(h,x);uc(T.before,sh(Uo(P,"beforeLabel",this,x))),uc(T.lines,Uo(P,"label",this,x)),uc(T.after,sh(Uo(P,"afterLabel",this,x))),p.push(T)}),p}getAfterBody(e,a){return fS(Uo(a.callbacks,"afterBody",this,e))}getFooter(e,a){const{callbacks:h}=a,p=Uo(h,"beforeFooter",this,e),x=Uo(h,"footer",this,e),T=Uo(h,"afterFooter",this,e);let P=[];return P=uc(P,sh(p)),P=uc(P,sh(x)),P=uc(P,sh(T)),P}_createItems(e){const a=this._active,h=this.chart.data,p=[],x=[],T=[];let P=[],o,z;for(o=0,z=a.length;o<z;++o)P.push(tB(this.chart,a[o]));return e.filter&&(P=P.filter(($,q,Q)=>e.filter($,q,Q,h))),e.itemSort&&(P=P.sort(($,q)=>e.itemSort($,q,h))),sn(P,$=>{const q=pS(e.callbacks,$);p.push(Uo(q,"labelColor",this,$)),x.push(Uo(q,"labelPointStyle",this,$)),T.push(Uo(q,"labelTextColor",this,$))}),this.labelColors=p,this.labelPointStyles=x,this.labelTextColors=T,this.dataPoints=P,P}update(e,a){const h=this.options.setContext(this.getContext()),p=this._active;let x,T=[];if(!p.length)this.opacity!==0&&(x={opacity:0});else{const P=Tg[h.position].call(this,p,this._eventPosition);T=this._createItems(h),this.title=this.getTitle(T,h),this.beforeBody=this.getBeforeBody(T,h),this.body=this.getBody(T,h),this.afterBody=this.getAfterBody(T,h),this.footer=this.getFooter(T,h);const o=this._size=hS(this,h),z=Object.assign({},P,o),$=uS(this.chart,h,z),q=dS(h,z,$,this.chart);this.xAlign=$.xAlign,this.yAlign=$.yAlign,x={opacity:1,x:q.x,y:q.y,width:o.width,height:o.height,caretX:P.x,caretY:P.y}}this._tooltipItems=T,this.$context=void 0,x&&this._resolveAnimations().update(this,x),e&&h.external&&h.external.call(this,{chart:this.chart,tooltip:this,replay:a})}drawCaret(e,a,h,p){const x=this.getCaretPosition(e,h,p);a.lineTo(x.x1,x.y1),a.lineTo(x.x2,x.y2),a.lineTo(x.x3,x.y3)}getCaretPosition(e,a,h){const{xAlign:p,yAlign:x}=this,{caretSize:T,cornerRadius:P}=h,{topLeft:o,topRight:z,bottomLeft:$,bottomRight:q}=Xp(P),{x:Q,y:nt}=e,{width:Tt,height:yt}=a;let Lt,Nt,Dt,wt,It,Xt;return x==="center"?(It=nt+yt/2,p==="left"?(Lt=Q,Nt=Lt-T,wt=It+T,Xt=It-T):(Lt=Q+Tt,Nt=Lt+T,wt=It-T,Xt=It+T),Dt=Lt):(p==="left"?Nt=Q+Math.max(o,$)+T:p==="right"?Nt=Q+Tt-Math.max(z,q)-T:Nt=this.caretX,x==="top"?(wt=nt,It=wt-T,Lt=Nt-T,Dt=Nt+T):(wt=nt+yt,It=wt+T,Lt=Nt+T,Dt=Nt-T),Xt=wt),{x1:Lt,x2:Nt,x3:Dt,y1:wt,y2:It,y3:Xt}}drawTitle(e,a,h){const p=this.title,x=p.length;let T,P,o;if(x){const z=qp(h.rtl,this.x,this.width);for(e.x=Ry(this,h.titleAlign,h),a.textAlign=z.textAlign(h.titleAlign),a.textBaseline="middle",T=Ho(h.titleFont),P=h.titleSpacing,a.fillStyle=h.titleColor,a.font=T.string,o=0;o<x;++o)a.fillText(p[o],z.x(e.x),e.y+T.lineHeight/2),e.y+=T.lineHeight+P,o+1===x&&(e.y+=h.titleMarginBottom-P)}}_drawColorBox(e,a,h,p,x){const T=this.labelColors[h],P=this.labelPointStyles[h],{boxHeight:o,boxWidth:z}=x,$=Ho(x.bodyFont),q=Ry(this,"left",x),Q=p.x(q),nt=o<$.lineHeight?($.lineHeight-o)/2:0,Tt=a.y+nt;if(x.usePointStyle){const yt={radius:Math.min(z,o)/2,pointStyle:P.pointStyle,rotation:P.rotation,borderWidth:1},Lt=p.leftForLtr(Q,z)+z/2,Nt=Tt+o/2;e.strokeStyle=x.multiKeyBackground,e.fillStyle=x.multiKeyBackground,kT(e,yt,Lt,Nt),e.strokeStyle=T.borderColor,e.fillStyle=T.backgroundColor,kT(e,yt,Lt,Nt)}else{e.lineWidth=Fs(T.borderWidth)?Math.max(...Object.values(T.borderWidth)):T.borderWidth||1,e.strokeStyle=T.borderColor,e.setLineDash(T.borderDash||[]),e.lineDashOffset=T.borderDashOffset||0;const yt=p.leftForLtr(Q,z),Lt=p.leftForLtr(p.xPlus(Q,1),z-2),Nt=Xp(T.borderRadius);Object.values(Nt).some(Dt=>Dt!==0)?(e.beginPath(),e.fillStyle=x.multiKeyBackground,gx(e,{x:yt,y:Tt,w:z,h:o,radius:Nt}),e.fill(),e.stroke(),e.fillStyle=T.backgroundColor,e.beginPath(),gx(e,{x:Lt,y:Tt+1,w:z-2,h:o-2,radius:Nt}),e.fill()):(e.fillStyle=x.multiKeyBackground,e.fillRect(yt,Tt,z,o),e.strokeRect(yt,Tt,z,o),e.fillStyle=T.backgroundColor,e.fillRect(Lt,Tt+1,z-2,o-2))}e.fillStyle=this.labelTextColors[h]}drawBody(e,a,h){const{body:p}=this,{bodySpacing:x,bodyAlign:T,displayColors:P,boxHeight:o,boxWidth:z,boxPadding:$}=h,q=Ho(h.bodyFont);let Q=q.lineHeight,nt=0;const Tt=qp(h.rtl,this.x,this.width),yt=function(kt){a.fillText(kt,Tt.x(e.x+nt),e.y+Q/2),e.y+=Q+x},Lt=Tt.textAlign(T);let Nt,Dt,wt,It,Xt,Zt,re;for(a.textAlign=T,a.textBaseline="middle",a.font=q.string,e.x=Ry(this,Lt,h),a.fillStyle=h.bodyColor,sn(this.beforeBody,yt),nt=P&&Lt!=="right"?T==="center"?z/2+$:z+2+$:0,It=0,Zt=p.length;It<Zt;++It){for(Nt=p[It],Dt=this.labelTextColors[It],a.fillStyle=Dt,sn(Nt.before,yt),wt=Nt.lines,P&&wt.length&&(this._drawColorBox(a,e,It,Tt,h),Q=Math.max(q.lineHeight,o)),Xt=0,re=wt.length;Xt<re;++Xt)yt(wt[Xt]),Q=q.lineHeight;sn(Nt.after,yt)}nt=0,Q=q.lineHeight,sn(this.afterBody,yt),e.y-=x}drawFooter(e,a,h){const p=this.footer,x=p.length;let T,P;if(x){const o=qp(h.rtl,this.x,this.width);for(e.x=Ry(this,h.footerAlign,h),e.y+=h.footerMarginTop,a.textAlign=o.textAlign(h.footerAlign),a.textBaseline="middle",T=Ho(h.footerFont),a.fillStyle=h.footerColor,a.font=T.string,P=0;P<x;++P)a.fillText(p[P],o.x(e.x),e.y+T.lineHeight/2),e.y+=T.lineHeight+h.footerSpacing}}drawBackground(e,a,h,p){const{xAlign:x,yAlign:T}=this,{x:P,y:o}=e,{width:z,height:$}=h,{topLeft:q,topRight:Q,bottomLeft:nt,bottomRight:Tt}=Xp(p.cornerRadius);a.fillStyle=p.backgroundColor,a.strokeStyle=p.borderColor,a.lineWidth=p.borderWidth,a.beginPath(),a.moveTo(P+q,o),T==="top"&&this.drawCaret(e,a,h,p),a.lineTo(P+z-Q,o),a.quadraticCurveTo(P+z,o,P+z,o+Q),T==="center"&&x==="right"&&this.drawCaret(e,a,h,p),a.lineTo(P+z,o+$-Tt),a.quadraticCurveTo(P+z,o+$,P+z-Tt,o+$),T==="bottom"&&this.drawCaret(e,a,h,p),a.lineTo(P+nt,o+$),a.quadraticCurveTo(P,o+$,P,o+$-nt),T==="center"&&x==="left"&&this.drawCaret(e,a,h,p),a.lineTo(P,o+q),a.quadraticCurveTo(P,o,P+q,o),a.closePath(),a.fill(),p.borderWidth>0&&a.stroke()}_updateAnimationTarget(e){const a=this.chart,h=this.$animations,p=h&&h.x,x=h&&h.y;if(p||x){const T=Tg[e.position].call(this,this._active,this._eventPosition);if(!T)return;const P=this._size=hS(this,e),o=Object.assign({},T,this._size),z=uS(a,e,o),$=dS(e,o,z,a);(p._to!==$.x||x._to!==$.y)&&(this.xAlign=z.xAlign,this.yAlign=z.yAlign,this.width=P.width,this.height=P.height,this.caretX=T.x,this.caretY=T.y,this._resolveAnimations().update(this,$))}}_willRender(){return!!this.opacity}draw(e){const a=this.options.setContext(this.getContext());let h=this.opacity;if(!h)return;this._updateAnimationTarget(a);const p={width:this.width,height:this.height},x={x:this.x,y:this.y};h=Math.abs(h)<.001?0:h;const T=Sl(a.padding),P=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;a.enabled&&P&&(e.save(),e.globalAlpha=h,this.drawBackground(x,e,p,a),vA(e,a.textDirection),x.y+=T.top,this.drawTitle(x,e,a),this.drawBody(x,e,a),this.drawFooter(x,e,a),bA(e,a.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,a){const h=this._active,p=e.map(({datasetIndex:P,index:o})=>{const z=this.chart.getDatasetMeta(P);if(!z)throw new Error("Cannot find a dataset at index "+P);return{datasetIndex:P,element:z.data[o],index:o}}),x=!ux(h,p),T=this._positionChanged(p,a);(x||T)&&(this._active=p,this._eventPosition=a,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,a,h=!0){if(a&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const p=this.options,x=this._active||[],T=this._getActiveElements(e,x,a,h),P=this._positionChanged(T,e),o=a||!ux(T,x)||P;return o&&(this._active=T,(p.enabled||p.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,a))),o}_getActiveElements(e,a,h,p){const x=this.options;if(e.type==="mouseout")return[];if(!p)return a.filter(P=>this.chart.data.datasets[P.datasetIndex]&&this.chart.getDatasetMeta(P.datasetIndex).controller.getParsed(P.index)!==void 0);const T=this.chart.getElementsAtEventForMode(e,x.mode,x,h);return x.reverse&&T.reverse(),T}_positionChanged(e,a){const{caretX:h,caretY:p,options:x}=this,T=Tg[x.position].call(this,e,a);return T!==!1&&(h!==T.x||p!==T.y)}}Ls(ob,"positioners",Tg);var aB={id:"tooltip",_element:ob,positioners:Tg,afterInit(i,e,a){a&&(i.tooltip=new ob({chart:i,options:a}))},beforeUpdate(i,e,a){i.tooltip&&i.tooltip.initialize(a)},reset(i,e,a){i.tooltip&&i.tooltip.initialize(a)},afterDraw(i){const e=i.tooltip;if(e&&e._willRender()){const a={tooltip:e};if(i.notifyPlugins("beforeTooltipDraw",{...a,cancelable:!0})===!1)return;e.draw(i.ctx),i.notifyPlugins("afterTooltipDraw",a)}},afterEvent(i,e){if(i.tooltip){const a=e.replay;i.tooltip.handleEvent(e.event,a,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(i,e)=>e.bodyFont.size,boxWidth:(i,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:RA},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:i=>i!=="filter"&&i!=="itemSort"&&i!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const lB=(i,e,a,h)=>(typeof e=="string"?(a=i.push(e)-1,h.unshift({index:a,label:e})):isNaN(e)&&(a=null),a);function cB(i,e,a,h){const p=i.indexOf(e);if(p===-1)return lB(i,e,a,h);const x=i.lastIndexOf(e);return p!==x?a:p}const hB=(i,e)=>i===null?null:vl(Math.round(i),0,e);function mS(i){const e=this.getLabels();return i>=0&&i<e.length?e[i]:i}class ab extends lm{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const a=this._addedLabels;if(a.length){const h=this.getLabels();for(const{index:p,label:x}of a)h[p]===x&&h.splice(p,1);this._addedLabels=[]}super.init(e)}parse(e,a){if(fn(e))return null;const h=this.getLabels();return a=isFinite(a)&&h[a]===e?a:cB(h,e,qs(a,e),this._addedLabels),hB(a,h.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:a}=this.getUserBounds();let{min:h,max:p}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(h=0),a||(p=this.getLabels().length-1)),this.min=h,this.max=p}buildTicks(){const e=this.min,a=this.max,h=this.options.offset,p=[];let x=this.getLabels();x=e===0&&a===x.length-1?x:x.slice(e,a+1),this._valueRange=Math.max(x.length-(h?0:1),1),this._startValue=this.min-(h?.5:0);for(let T=e;T<=a;T++)p.push({value:T});return p}getLabelForValue(e){return mS.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const a=this.ticks;return e<0||e>a.length-1?null:this.getPixelForValue(a[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}Ls(ab,"id","category"),Ls(ab,"defaults",{ticks:{callback:mS}});function uB(i,e){const a=[],{bounds:p,step:x,min:T,max:P,precision:o,count:z,maxTicks:$,maxDigits:q,includeBounds:Q}=i,nt=x||1,Tt=$-1,{min:yt,max:Lt}=e,Nt=!fn(T),Dt=!fn(P),wt=!fn(z),It=(Lt-yt)/(q+1);let Xt=vT((Lt-yt)/Tt/nt)*nt,Zt,re,kt,ne;if(Xt<1e-14&&!Nt&&!Dt)return[{value:yt},{value:Lt}];ne=Math.ceil(Lt/Xt)-Math.floor(yt/Xt),ne>Tt&&(Xt=vT(ne*Xt/Tt/nt)*nt),fn(o)||(Zt=Math.pow(10,o),Xt=Math.ceil(Xt*Zt)/Zt),p==="ticks"?(re=Math.floor(yt/Xt)*Xt,kt=Math.ceil(Lt/Xt)*Xt):(re=yt,kt=Lt),Nt&&Dt&&x&&pO((P-T)/x,Xt/1e3)?(ne=Math.round(Math.min((P-T)/Xt,$)),Xt=(P-T)/ne,re=T,kt=P):wt?(re=Nt?T:re,kt=Dt?P:kt,ne=z-1,Xt=(kt-re)/ne):(ne=(kt-re)/Xt,$y(ne,Math.round(ne),Xt/1e3)?ne=Math.round(ne):ne=Math.ceil(ne));const Ut=Math.max(bT(Xt),bT(re));Zt=Math.pow(10,fn(o)?Ut:o),re=Math.round(re*Zt)/Zt,kt=Math.round(kt*Zt)/Zt;let Le=0;for(Nt&&(Q&&re!==T?(a.push({value:T}),re<T&&Le++,$y(Math.round((re+Le*Xt)*Zt)/Zt,T,gS(T,It,i))&&Le++):re<T&&Le++);Le<ne;++Le){const ye=Math.round((re+Le*Xt)*Zt)/Zt;if(Dt&&ye>P)break;a.push({value:ye})}return Dt&&Q&&kt!==P?a.length&&$y(a[a.length-1].value,P,gS(P,It,i))?a[a.length-1].value=P:a.push({value:P}):(!Dt||kt===P)&&a.push({value:kt}),a}function gS(i,e,{horizontal:a,minRotation:h}){const p=df(h),x=(a?Math.sin(p):Math.cos(p))||.001,T=.75*e*(""+i).length;return Math.min(e/x,T)}class dB extends lm{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,a){return fn(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:a,maxDefined:h}=this.getUserBounds();let{min:p,max:x}=this;const T=o=>p=a?p:o,P=o=>x=h?x:o;if(e){const o=Lu(p),z=Lu(x);o<0&&z<0?P(0):o>0&&z>0&&T(0)}if(p===x){let o=x===0?1:Math.abs(x*.05);P(x+o),e||T(p-o)}this.min=p,this.max=x}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:a,stepSize:h}=e,p;return h?(p=Math.ceil(this.max/h)-Math.floor(this.min/h)+1,p>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${h} would result generating up to ${p} ticks. Limiting to 1000.`),p=1e3)):(p=this.computeTickLimit(),a=a||11),a&&(p=Math.min(a,p)),p}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,a=e.ticks;let h=this.getTickLimit();h=Math.max(2,h);const p={maxTicks:h,bounds:e.bounds,min:e.min,max:e.max,precision:a.precision,step:a.stepSize,count:a.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:a.minRotation||0,includeBounds:a.includeBounds!==!1},x=this._range||this,T=uB(p,x);return e.bounds==="ticks"&&mO(T,this,"value"),e.reverse?(T.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),T}configure(){const e=this.ticks;let a=this.min,h=this.max;if(super.configure(),this.options.offset&&e.length){const p=(h-a)/Math.max(e.length-1,1)/2;a-=p,h+=p}this._startValue=a,this._endValue=h,this._valueRange=h-a}getLabelForValue(e){return hA(e,this.chart.options.locale,this.options.ticks.format)}}class lb extends dB{determineDataLimits(){const{min:e,max:a}=this.getMinMax(!0);this.min=Ga(e)?e:0,this.max=Ga(a)?a:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),a=e?this.width:this.height,h=df(this.options.ticks.minRotation),p=(e?Math.sin(h):Math.cos(h))||.001,x=this._resolveTickFontOptions(0);return Math.ceil(a/Math.min(40,x.lineHeight/p))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}Ls(lb,"id","linear"),Ls(lb,"defaults",{ticks:{callback:uA.formatters.numeric}});const Wx={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Wo=Object.keys(Wx);function _S(i,e){return i-e}function yS(i,e){if(fn(e))return null;const a=i._adapter,{parser:h,round:p,isoWeekday:x}=i._parseOpts;let T=e;return typeof h=="function"&&(T=h(T)),Ga(T)||(T=typeof h=="string"?a.parse(T,h):a.parse(T)),T===null?null:(p&&(T=p==="week"&&(px(x)||x===!0)?a.startOf(T,"isoWeek",x):a.startOf(T,p)),+T)}function xS(i,e,a,h){const p=Wo.length;for(let x=Wo.indexOf(i);x<p-1;++x){const T=Wx[Wo[x]],P=T.steps?T.steps:Number.MAX_SAFE_INTEGER;if(T.common&&Math.ceil((a-e)/(P*T.size))<=h)return Wo[x]}return Wo[p-1]}function fB(i,e,a,h,p){for(let x=Wo.length-1;x>=Wo.indexOf(a);x--){const T=Wo[x];if(Wx[T].common&&i._adapter.diff(p,h,T)>=e-1)return T}return Wo[a?Wo.indexOf(a):0]}function pB(i){for(let e=Wo.indexOf(i)+1,a=Wo.length;e<a;++e)if(Wx[Wo[e]].common)return Wo[e]}function vS(i,e,a){if(!a)i[e]=!0;else if(a.length){const{lo:h,hi:p}=Xb(a,e),x=a[h]>=e?a[h]:a[p];i[x]=!0}}function mB(i,e,a,h){const p=i._adapter,x=+p.startOf(e[0].value,h),T=e[e.length-1].value;let P,o;for(P=x;P<=T;P=+p.add(P,1,h))o=a[P],o>=0&&(e[o].major=!0);return e}function bS(i,e,a){const h=[],p={},x=e.length;let T,P;for(T=0;T<x;++T)P=e[T],p[P]=T,h.push({value:P,major:!1});return x===0||!a?h:mB(i,h,p,a)}class xx extends lm{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,a={}){const h=e.time||(e.time={}),p=this._adapter=new zR._date(e.adapters.date);p.init(a),Rg(h.displayFormats,p.formats()),this._parseOpts={parser:h.parser,round:h.round,isoWeekday:h.isoWeekday},super.init(e),this._normalized=a.normalized}parse(e,a){return e===void 0?null:yS(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,a=this._adapter,h=e.time.unit||"day";let{min:p,max:x,minDefined:T,maxDefined:P}=this.getUserBounds();function o(z){!T&&!isNaN(z.min)&&(p=Math.min(p,z.min)),!P&&!isNaN(z.max)&&(x=Math.max(x,z.max))}(!T||!P)&&(o(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&o(this.getMinMax(!1))),p=Ga(p)&&!isNaN(p)?p:+a.startOf(Date.now(),h),x=Ga(x)&&!isNaN(x)?x:+a.endOf(Date.now(),h)+1,this.min=Math.min(p,x-1),this.max=Math.max(p+1,x)}_getLabelBounds(){const e=this.getLabelTimestamps();let a=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY;return e.length&&(a=e[0],h=e[e.length-1]),{min:a,max:h}}buildTicks(){const e=this.options,a=e.time,h=e.ticks,p=h.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&p.length&&(this.min=this._userMin||p[0],this.max=this._userMax||p[p.length-1]);const x=this.min,T=this.max,P=wO(p,x,T);return this._unit=a.unit||(h.autoSkip?xS(a.minUnit,this.min,this.max,this._getLabelCapacity(x)):fB(this,P.length,a.minUnit,this.min,this.max)),this._majorUnit=!h.major.enabled||this._unit==="year"?void 0:pB(this._unit),this.initOffsets(p),e.reverse&&P.reverse(),bS(this,P,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let a=0,h=0,p,x;this.options.offset&&e.length&&(p=this.getDecimalForValue(e[0]),e.length===1?a=1-p:a=(this.getDecimalForValue(e[1])-p)/2,x=this.getDecimalForValue(e[e.length-1]),e.length===1?h=x:h=(x-this.getDecimalForValue(e[e.length-2]))/2);const T=e.length<3?.5:.25;a=vl(a,0,T),h=vl(h,0,T),this._offsets={start:a,end:h,factor:1/(a+1+h)}}_generate(){const e=this._adapter,a=this.min,h=this.max,p=this.options,x=p.time,T=x.unit||xS(x.minUnit,a,h,this._getLabelCapacity(a)),P=qs(p.ticks.stepSize,1),o=T==="week"?x.isoWeekday:!1,z=px(o)||o===!0,$={};let q=a,Q,nt;if(z&&(q=+e.startOf(q,"isoWeek",o)),q=+e.startOf(q,z?"day":T),e.diff(h,a,T)>1e5*P)throw new Error(a+" and "+h+" are too far apart with stepSize of "+P+" "+T);const Tt=p.ticks.source==="data"&&this.getDataTimestamps();for(Q=q,nt=0;Q<h;Q=+e.add(Q,P,T),nt++)vS($,Q,Tt);return(Q===h||p.bounds==="ticks"||nt===1)&&vS($,Q,Tt),Object.keys($).sort(_S).map(yt=>+yt)}getLabelForValue(e){const a=this._adapter,h=this.options.time;return h.tooltipFormat?a.format(e,h.tooltipFormat):a.format(e,h.displayFormats.datetime)}format(e,a){const p=this.options.time.displayFormats,x=this._unit,T=a||p[x];return this._adapter.format(e,T)}_tickFormatFunction(e,a,h,p){const x=this.options,T=x.ticks.callback;if(T)return kn(T,[e,a,h],this);const P=x.time.displayFormats,o=this._unit,z=this._majorUnit,$=o&&P[o],q=z&&P[z],Q=h[a],nt=z&&q&&Q&&Q.major;return this._adapter.format(e,p||(nt?q:$))}generateTickLabels(e){let a,h,p;for(a=0,h=e.length;a<h;++a)p=e[a],p.label=this._tickFormatFunction(p.value,a,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const a=this._offsets,h=this.getDecimalForValue(e);return this.getPixelForDecimal((a.start+h)*a.factor)}getValueForPixel(e){const a=this._offsets,h=this.getDecimalForPixel(e)/a.factor-a.end;return this.min+h*(this.max-this.min)}_getLabelSize(e){const a=this.options.ticks,h=this.ctx.measureText(e).width,p=df(this.isHorizontal()?a.maxRotation:a.minRotation),x=Math.cos(p),T=Math.sin(p),P=this._resolveTickFontOptions(0).size;return{w:h*x+P*T,h:h*T+P*x}}_getLabelCapacity(e){const a=this.options.time,h=a.displayFormats,p=h[a.unit]||h.millisecond,x=this._tickFormatFunction(e,0,bS(this,[e],this._majorUnit),p),T=this._getLabelSize(x),P=Math.floor(this.isHorizontal()?this.width/T.w:this.height/T.h)-1;return P>0?P:1}getDataTimestamps(){let e=this._cache.data||[],a,h;if(e.length)return e;const p=this.getMatchingVisibleMetas();if(this._normalized&&p.length)return this._cache.data=p[0].controller.getAllParsedValues(this);for(a=0,h=p.length;a<h;++a)e=e.concat(p[a].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let a,h;if(e.length)return e;const p=this.getLabels();for(a=0,h=p.length;a<h;++a)e.push(yS(this,p[a]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return rA(e.sort(_S))}}Ls(xx,"id","time"),Ls(xx,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function By(i,e,a){let h=0,p=i.length-1,x,T,P,o;a?(e>=i[h].pos&&e<=i[p].pos&&({lo:h,hi:p}=ib(i,"pos",e)),{pos:x,time:P}=i[h],{pos:T,time:o}=i[p]):(e>=i[h].time&&e<=i[p].time&&({lo:h,hi:p}=ib(i,"time",e)),{time:x,pos:P}=i[h],{time:T,pos:o}=i[p]);const z=T-x;return z?P+(o-P)*(e-x)/z:P}class wS extends xx{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),a=this._table=this.buildLookupTable(e);this._minPos=By(a,this.min),this._tableRange=By(a,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:a,max:h}=this,p=[],x=[];let T,P,o,z,$;for(T=0,P=e.length;T<P;++T)z=e[T],z>=a&&z<=h&&p.push(z);if(p.length<2)return[{time:a,pos:0},{time:h,pos:1}];for(T=0,P=p.length;T<P;++T)$=p[T+1],o=p[T-1],z=p[T],Math.round(($+o)/2)!==z&&x.push({time:z,pos:T/(P-1)});return x}_generate(){const e=this.min,a=this.max;let h=super.getDataTimestamps();return(!h.includes(e)||!h.length)&&h.splice(0,0,e),(!h.includes(a)||h.length===1)&&h.push(a),h.sort((p,x)=>p-x)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const a=this.getDataTimestamps(),h=this.getLabelTimestamps();return a.length&&h.length?e=this.normalize(a.concat(h)):e=a.length?a:h,e=this._cache.all=e,e}getDecimalForValue(e){return(By(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const a=this._offsets,h=this.getDecimalForPixel(e)/a.factor-a.end;return By(this._table,h*this._tableRange+this._minPos,!0)}}Ls(wS,"id","timeseries"),Ls(wS,"defaults",xx.defaults);const gB={__name:"VarietyChart",props:{varieties:Array},setup(i){oh.register(Gy,Xy,ab,lb,aB,Q3);const e=i,a=Bs(null);let h=null;const p=()=>{h&&h.destroy();const x={};e.varieties.forEach(o=>{o.split(",").map($=>$.trim()).forEach($=>{$&&(x[$]=(x[$]||0)+1)})});const T=Object.keys(x),P=Object.values(x);h=new oh(a.value,{type:"bar",data:{labels:T,datasets:[{label:"Avocado Varieties",data:P,backgroundColor:"#22c55e"}]},options:{responsive:!0,indexAxis:"y",plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0}}}})};return ph(p),ya(()=>e.varieties,p),n_(()=>{h&&h.destroy()}),(x,T)=>(qi(),cs("div",null,[Ye("canvas",{ref_key:"chartCanvas",ref:a},null,512)]))}},_B=Ha(gB,[["__scopeId","data-v-d9836925"]]),yB={class:"p-8 max-w-7xl mx-auto"},xB={class:"mb-6"},vB=["value"],bB={class:"grid grid-cols-1 sm:grid-cols-3 gap-6 mb-8"},wB={class:"bg-white rounded-xl shadow p-4 border text-center"},TB={class:"text-2xl font-bold text-indigo-700"},SB={class:"bg-white rounded-xl shadow p-4 border text-center"},EB={class:"text-2xl font-bold text-green-600"},MB={class:"bg-white rounded-xl shadow p-4 border text-center"},AB={class:"text-lg font-semibold text-gray-800"},CB={key:0},kB={key:1},PB={class:"bg-white rounded-xl shadow p-6 border mb-10"},IB={class:"text-sm text-gray-600 list-disc pl-5"},LB={class:"bg-white rounded-xl shadow border mb-10"},DB={class:"bg-white rounded-xl shadow p-6 border mb-10"},zB={__name:"MonitoringView",setup(i){const e=Bs([]),a=Bs([]),h=Bs(""),p=Bs(0),x=Bs(0),T=Bs([]),P=Bs([]),o=Bs([]),z=Bs(null),$="pk.eyJ1Ijoib3N1bWFpIiwiYSI6ImNtOThheGt3bDAxMDYyanM1cDVoZG5jaGIifQ.rhfXn8CCj3FZ-OTeH-z-Ag",q="http://127.0.0.1:8000/api/v1";let Q;ph(async()=>{try{const Lt=await(await fetch(`${q}/kobo/avocado-submissions`)).json();e.value=Lt.features,P.value=[...new Set(Lt.features.map(Nt=>Nt.properties.ward).filter(Boolean))],Tt()}catch(yt){console.error("Error loading KoBo data:",yt)}}),ya(h,Tt),ya(a,async yt=>{if(await Sf(),!z.value||!(z.value instanceof HTMLElement)){console.error(" Map container is not valid:",z.value);return}Hp.accessToken=$,Q?nt(yt):(Q=new Hp.Map({container:z.value,style:"mapbox://styles/mapbox/light-v10",center:[36,.05],zoom:9}),Q.on("load",()=>nt(yt)))});function nt(yt){const Lt=Q.getSource("avocado-kobo");Lt?Lt.setData({type:"FeatureCollection",features:yt}):(Q.addSource("avocado-kobo",{type:"geojson",data:{type:"FeatureCollection",features:yt}}),Q.addLayer({id:"avocado-kobo-layer",type:"circle",source:"avocado-kobo",paint:{"circle-radius":6,"circle-color":"#00A86B","circle-stroke-width":1,"circle-stroke-color":"#004225"}}),Q.on("click","avocado-kobo-layer",Nt=>{const Dt=Nt.features[0].properties;new Hp.Popup().setLngLat(Nt.lngLat).setHTML(`
          <strong>Enumerator:</strong> ${Dt.enumerator}<br/>
          <strong>Trees:</strong> ${Dt.trees}<br/>
          <strong>Ward:</strong> ${Dt.ward}<br/>
          <strong>Date:</strong> ${Dt.submitted}
        `).addTo(Q)}))}function Tt(){const yt=h.value?e.value.filter(Nt=>Nt.properties.ward===h.value):e.value;a.value=yt,p.value=yt.length,x.value=yt.reduce((Nt,Dt)=>{const wt=parseInt(Dt.properties.trees);return Nt+(isNaN(wt)?0:wt)},0);const Lt={};yt.forEach(Nt=>{const Dt=Nt.properties.enumerator||"Unknown";Lt[Dt]=(Lt[Dt]||0)+1}),T.value=Object.entries(Lt).sort((Nt,Dt)=>Dt[1]-Nt[1]),o.value=yt.map(Nt=>Nt.properties.varieties||"")}return(yt,Lt)=>(qi(),cs("div",yB,[Lt[8]||(Lt[8]=Ye("h1",{class:"text-4xl font-bold text-indigo-800 mb-6"},"M&E Dashboard",-1)),Lt[9]||(Lt[9]=Ye("p",{class:"text-lg text-gray-700 mb-6"}," Visual insights into community surveys, landscape indicators, and ISFM adoption progress. ",-1)),Ye("div",xB,[Lt[2]||(Lt[2]=Ye("label",{for:"ward",class:"text-sm font-medium text-gray-600 mr-2"},"Filter by Ward:",-1)),Ag(Ye("select",{"onUpdate:modelValue":Lt[0]||(Lt[0]=Nt=>h.value=Nt),id:"ward",class:"border border-gray-300 rounded px-3 py-1"},[Lt[1]||(Lt[1]=Ye("option",{value:""},"All Wards",-1)),(qi(!0),cs(dn,null,gc(P.value,Nt=>(qi(),cs("option",{key:Nt,value:Nt},Dn(Nt),9,vB))),128))],512),[[Wp,h.value]])]),Ye("div",bB,[Ye("div",wB,[Lt[3]||(Lt[3]=Ye("h2",{class:"text-sm text-gray-500"},"Submissions",-1)),Ye("p",TB,Dn(p.value),1)]),Ye("div",SB,[Lt[4]||(Lt[4]=Ye("h2",{class:"text-sm text-gray-500"},"Avocado Trees Counted",-1)),Ye("p",EB,Dn(x.value),1)]),Ye("div",MB,[Lt[5]||(Lt[5]=Ye("h2",{class:"text-sm text-gray-500"},"Top Enumerator",-1)),Ye("p",AB,[T.value.length?(qi(),cs("span",CB,Dn(T.value[0][0])+" ("+Dn(T.value[0][1])+")",1)):(qi(),cs("span",kB,"N/A"))])])]),Ye("div",PB,[Lt[6]||(Lt[6]=Ye("h3",{class:"text-lg font-bold mb-4 text-gray-700"},"Top 3 Enumerators",-1)),Ye("ul",IB,[(qi(!0),cs(dn,null,gc(T.value.slice(0,3),(Nt,Dt)=>(qi(),cs("li",{key:Dt},Dn(Nt[0])+"  "+Dn(Nt[1])+" submissions",1))),128))])]),Ye("div",LB,[Ye("div",{id:"mapContainer",ref_key:"mapContainer",ref:z,class:"h-[500px] w-full rounded-xl overflow-hidden"},null,512)]),Ye("div",DB,[Lt[7]||(Lt[7]=Ye("h3",{class:"text-lg font-bold text-gray-700 mb-2"}," Avocado Variety Distribution",-1)),fs(_B,{varieties:o.value},null,8,["varieties"])])]))}},OB=Ha(zB,[["__scopeId","data-v-581f1a5c"]]),RB={class:"p-8 max-w-5xl mx-auto"},BB={__name:"CatalogView",setup(i){return(e,a)=>(qi(),cs("div",RB,a[0]||(a[0]=[Ye("h1",{class:"text-4xl font-bold text-indigo-800 mb-6"},"Document Catalog",-1),Ye("p",{class:"text-lg text-gray-700 mb-4"}," Browse technical reports, datasets, and visual materials produced by Soil Values and its partners. ",-1),Ye("div",{class:"bg-white rounded-xl shadow p-6 border"},[Ye("p",{class:"text-gray-600"}," Document list and filters coming soon...")],-1)])))}},FB="/projects/soil_values/assets/hero-farmer-DNY-s-SV.jpg",NB="/projects/soil_values/assets/harvest-man-PU7mKcrC.jpg",jB="/projects/soil_values/assets/update-burkina-oEf6LrKK.jpg",UB="/projects/soil_values/assets/update-women-DMqvfeED.jpg",VB="/projects/soil_values/assets/update-dairy-D07hRLBv.jpg",$B={class:"about-container"},GB={class:"updates-section"},WB={class:"updates-grid"},HB=["href"],XB=["src","alt"],qB={class:"update-info"},ZB={class:"update-date"},YB={class:"update-title"},KB={__name:"AboutView",setup(i){const e=[{id:1,title:"ISFM Training in Burkina Faso: A Collaborative Approach",date:"News | April 2, 2025",image:jB,link:"https://ifdc.org/2025/04/02/isfm-training-in-burkina-faso-a-collaborative-approach-to-soil-fertility-and-land-restoration/"},{id:2,title:"Celebrating Women in Sustainable Agriculture",date:"Event Recap | March 26, 2025",image:UB,link:"https://ifdc.org/2025/03/26/celebrating-women-at-the-heart-of-sustainable-agriculture/"},{id:3,title:"Improving Nigerias Dairy Sector and Empowering Pastoralist Communities",date:"News | May 1, 2025",image:VB,link:"https://ifdc.org/2025/05/01/improving-nigerias-dairy-sector-and-empowering-pastoralist-communities/"}];return(a,h)=>(qi(),cs("div",$B,[h[1]||(h[1]=Fx('<section class="hero-section" data-v-d6c6084e><img src="'+FB+'" alt="Female African Farmer" class="hero-image" data-v-d6c6084e><div class="hero-text" data-v-d6c6084e><h1 data-v-d6c6084e>Soil Values</h1><p data-v-d6c6084e>Catalyzing Farm Productivity  Burkina Faso, Mali, Niger, Nigeria  Active</p></div></section><section class="about-description" data-v-d6c6084e><p data-v-d6c6084e><strong data-v-d6c6084e>Soil Values</strong>, a 10-year program (20242034) financed by the Netherlands Directorate-General for International Cooperation (DGIS), is a transformative initiative unfolding across Burkina Faso, Mali, Northern Nigeria, and Niger. Its objective is to establish sustainable soil fertility management as a cornerstone within the farming systems of the Sahelian and Guinea Savanna regions.</p><p data-v-d6c6084e>The program aims to improve the soil fertility and productive capacity of 2 million hectares of farmland in the Sahel, fostering resilience and well-being among 1.5 million farmerswith an emphasis on women.</p><p data-v-d6c6084e>The approach centers on Integrated Soil Fertility Management (ISFM) within participatory landscape planning to catalyze viable business models and encourage adoption by farmers, market actors, and policymakers.</p></section><img src="'+NB+'" alt="Harvesting Legumes" class="mid-image" data-v-d6c6084e><section class="outcomes-section" data-v-d6c6084e><h2 data-v-d6c6084e>Expected Outcomes</h2><ul data-v-d6c6084e><li data-v-d6c6084e><strong data-v-d6c6084e>1.5 million smallholder farmers</strong>, including 800,000 women, reduce the yield gap and build resilience to climate shocks.</li><li data-v-d6c6084e><strong data-v-d6c6084e>40+ river basins and landscapes</strong>2 million hectaresare managed sustainably with equitable water use.</li><li data-v-d6c6084e>Soil fertility becomes a priority in agricultural programs, national policies, and civil society efforts.</li><li data-v-d6c6084e>Neighboring countries (Ghana and Cte dIvoire) engage in dialogue on fertilizer trade and food security.</li></ul></section><section class="partners-section" data-v-d6c6084e><h2 data-v-d6c6084e>Implementing Partners</h2><p data-v-d6c6084e> Soil Values is implemented by IFDC in collaboration with SNV and Wageningen University and Research (WUR), alongside knowledge partners such as AGRA, ICRAF, IITA, ISRIC, and IWMI. The program leverages existing national projects like the World Banks Food Systems Resilience Program (FSRP). </p><p class="note" data-v-d6c6084e>Supported by DGIS under Dutch development policy.</p><div class="partner-logos" data-v-d6c6084e><div class="logo-row" data-v-d6c6084e><a href="https://www.government.nl/ministries/ministry-of-foreign-affairs" target="_blank" rel="noopener" data-v-d6c6084e><img src="'+Fb+'" alt="DGIS" class="logo-lg" data-v-d6c6084e></a></div><div class="logo-row" data-v-d6c6084e><a href="https://ifdc.org" target="_blank" rel="noopener" data-v-d6c6084e><img src="'+BM+'" alt="IFDC" class="logo-md" data-v-d6c6084e></a><a href="https://snv.org" target="_blank" rel="noopener" data-v-d6c6084e><img src="'+NM+'" alt="SNV" class="logo-md" data-v-d6c6084e></a><a href="https://wur.nl" target="_blank" rel="noopener" data-v-d6c6084e><img src="'+FM+'" alt="WUR" class="logo-md" data-v-d6c6084e></a></div><div class="logo-row" data-v-d6c6084e><a href="https://agra.org" target="_blank" rel="noopener" data-v-d6c6084e><img src="'+jM+'" alt="AGRA" data-v-d6c6084e></a><a href="https://www.iita.org" target="_blank" rel="noopener" data-v-d6c6084e><img src="'+UM+'" alt="IITA" data-v-d6c6084e></a><a href="https://www.iwmi.cgiar.org" target="_blank" rel="noopener" data-v-d6c6084e><img src="'+VM+'" alt="IWMI" data-v-d6c6084e></a><a href="https://www.isric.org" target="_blank" rel="noopener" data-v-d6c6084e><img src="'+$M+'" alt="ISRIC" data-v-d6c6084e></a><a href="https://www.cifor-icraf.org" target="_blank" rel="noopener" data-v-d6c6084e><img src="'+GM+'" alt="CIFOR-ICRAF" data-v-d6c6084e></a></div></div></section>',5)),Ye("section",GB,[h[0]||(h[0]=Ye("h2",null,"Recent Updates",-1)),Ye("div",WB,[(qi(),cs(dn,null,gc(e,p=>Ye("a",{key:p.id,href:p.link,target:"_blank",class:"update-card"},[Ye("img",{src:p.image,alt:p.title},null,8,XB),Ye("div",qB,[Ye("p",ZB,Dn(p.date),1),Ye("h3",YB,Dn(p.title),1)])],8,HB)),64))])])]))}},JB=Ha(KB,[["__scopeId","data-v-d6c6084e"]]),QB=[{path:"/",name:"Home",component:AD},{path:"/map",name:"Map",component:Oz},{path:"/me-dashboard",name:"M&E Dashboard",component:OB},{path:"/catalog",name:"Catalog",component:BB},{path:"/about",name:"About",component:JB},{path:"/dashboard",redirect:"/map"},{path:"/monitoring",redirect:"/me-dashboard"}],tF=dD({history:UL("/projects/soil_values/"),routes:QB});var BA={exports:{}},kv={exports:{}},TS;function eF(){return TS||(TS=1,function(i,e){(function(a,h){a._Highcharts=h(),i.exports=a._Highcharts})(typeof window>"u"?ZM:window,()=>(()=>{var Ym;let a,h;var p,x,T,P,o,z,$,q,Q,nt,Tt,yt,Lt,Nt,Dt,wt,It,Xt,Zt={};Zt.d=(B,l)=>{for(var f in l)Zt.o(l,f)&&!Zt.o(B,f)&&Object.defineProperty(B,f,{enumerable:!0,get:l[f]})},Zt.o=(B,l)=>Object.prototype.hasOwnProperty.call(B,l);var re={};Zt.d(re,{default:()=>J_}),function(B){var l,f,g,b,w,A,C;B.SVG_NS="http://www.w3.org/2000/svg",B.product="Highcharts",B.version="12.2.0",B.win=typeof window<"u"?window:{},B.doc=B.win.document,B.svg=!!((g=(f=(l=B.doc)==null?void 0:l.createElementNS)==null?void 0:f.call(l,B.SVG_NS,"svg"))!=null&&g.createSVGRect),B.pageLang=(A=(w=(b=B.doc)==null?void 0:b.documentElement)==null?void 0:w.closest("[lang]"))==null?void 0:A.lang,B.userAgent=((C=B.win.navigator)==null?void 0:C.userAgent)||"",B.isChrome=B.win.chrome,B.isFirefox=B.userAgent.indexOf("Firefox")!==-1,B.isMS=/(edge|msie|trident)/i.test(B.userAgent)&&!B.win.opera,B.isSafari=!B.isChrome&&B.userAgent.indexOf("Safari")!==-1,B.isTouchDevice=/(Mobile|Android|Windows Phone)/.test(B.userAgent),B.isWebKit=B.userAgent.indexOf("AppleWebKit")!==-1,B.deg2rad=2*Math.PI/360,B.marginNames=["plotTop","marginRight","marginBottom","plotLeft"],B.noop=function(){},B.supportsPassiveEvents=function(){let I=!1;if(!B.isMS){let R=Object.defineProperty({},"passive",{get:function(){I=!0}});B.win.addEventListener&&B.win.removeEventListener&&(B.win.addEventListener("testPassive",B.noop,R),B.win.removeEventListener("testPassive",B.noop,R))}return I}(),B.charts=[],B.composed=[],B.dateFormats={},B.seriesTypes={},B.symbolSizes={},B.chartCount=0}(p||(p={}));let kt=p,{charts:ne,doc:Ut,win:Le}=kt;function ye(B,l,f,g){let b=l?"Highcharts error":"Highcharts warning";B===32&&(B=`${b}: Deprecated member`);let w=pi(B),A=w?`${b} #${B}: www.highcharts.com/errors/${B}/`:B.toString();if(g!==void 0){let C="";w&&(A+="?"),ni(g,function(I,R){C+=`
 - ${R}: ${I}`,w&&(A+=encodeURI(R)+"="+encodeURI(I))}),A+=C}ss(kt,"displayError",{chart:f,code:B,message:A,params:g},function(){if(l)throw Error(A);Le.console&&ye.messages.indexOf(A)===-1&&console.warn(A)}),ye.messages.push(A)}function Ce(B,l){return parseInt(B,l||10)}function di(B){return typeof B=="string"}function Ti(B){let l=Object.prototype.toString.call(B);return l==="[object Array]"||l==="[object Array Iterator]"}function Ge(B,l){return!!B&&typeof B=="object"&&(!l||!Ti(B))}function li(B){return Ge(B)&&typeof B.nodeType=="number"}function fi(B){let l=B==null?void 0:B.constructor;return!!(Ge(B,!0)&&!li(B)&&(l!=null&&l.name)&&l.name!=="Object")}function pi(B){return typeof B=="number"&&!isNaN(B)&&B<1/0&&B>-1/0}function Ns(B){return B!=null}function hs(B,l,f){let g,b=di(l)&&!Ns(f),w=(A,C)=>{Ns(A)?B.setAttribute(C,A):b?(g=B.getAttribute(C))||C!=="class"||(g=B.getAttribute(C+"Name")):B.removeAttribute(C)};return di(l)?w(f,l):ni(l,w),g}function Yi(B){return Ti(B)?B:[B]}function Zs(B,l){let f;for(f in B||(B={}),l)B[f]=l[f];return B}function Ji(){let B=arguments,l=B.length;for(let f=0;f<l;f++){let g=B[f];if(g!=null)return g}}function Tn(B,l){Zs(B.style,l)}function Ds(B){return Math.pow(10,Math.floor(Math.log(B)/Math.LN10))}function Me(B,l){return B>1e14?B:parseFloat(B.toPrecision(l||14))}(ye||(ye={})).messages=[],Math.easeInOutSine=function(B){return-.5*(Math.cos(Math.PI*B)-1)};let ci=Array.prototype.find?function(B,l){return B.find(l)}:function(B,l){let f,g=B.length;for(f=0;f<g;f++)if(l(B[f],f))return B[f]};function ni(B,l,f){for(let g in B)Object.hasOwnProperty.call(B,g)&&l.call(f||B[g],B[g],g,B)}function _i(B,l,f){function g(A,C){let I=B.removeEventListener;I&&I.call(B,A,C,!1)}function b(A){let C,I;B.nodeName&&(l?(C={})[l]=!0:C=A,ni(C,function(R,U){if(A[U])for(I=A[U].length;I--;)g(U,A[U][I].fn)}))}let w=typeof B=="function"&&B.prototype||B;if(Object.hasOwnProperty.call(w,"hcEvents")){let A=w.hcEvents;if(l){let C=A[l]||[];f?(A[l]=C.filter(function(I){return f!==I.fn}),g(l,f)):(b(A),A[l]=[])}else b(A),delete w.hcEvents}}function ss(B,l,f,g){if(f=f||{},(Ut==null?void 0:Ut.createEvent)&&(B.dispatchEvent||B.fireEvent&&B!==kt)){let b=Ut.createEvent("Events");b.initEvent(l,!0,!0),f=Zs(b,f),B.dispatchEvent?B.dispatchEvent(f):B.fireEvent(l,f)}else if(B.hcEvents){f.target||Zs(f,{preventDefault:function(){f.defaultPrevented=!0},target:B,type:l});let b=[],w=B,A=!1;for(;w.hcEvents;)Object.hasOwnProperty.call(w,"hcEvents")&&w.hcEvents[l]&&(b.length&&(A=!0),b.unshift.apply(b,w.hcEvents[l])),w=Object.getPrototypeOf(w);A&&b.sort((C,I)=>C.order-I.order),b.forEach(C=>{C.fn.call(B,f)===!1&&f.preventDefault()})}g&&!f.defaultPrevented&&g.call(B,f)}let xi=function(){let B=Math.random().toString(36).substring(2,9)+"-",l=0;return function(){return"highcharts-"+(a?"":B)+l++}}();Le.jQuery&&(Le.jQuery.fn.highcharts=function(){let B=[].slice.call(arguments);if(this[0])return B[0]?(new kt[di(B[0])?B.shift():"Chart"](this[0],B[0],B[1]),this):ne[hs(this[0],"data-highcharts-chart")]});let _t={addEvent:function(B,l,f,g={}){let b=typeof B=="function"&&B.prototype||B;Object.hasOwnProperty.call(b,"hcEvents")||(b.hcEvents={});let w=b.hcEvents;kt.Point&&B instanceof kt.Point&&B.series&&B.series.chart&&(B.series.chart.runTrackerClick=!0);let A=B.addEventListener;A&&A.call(B,l,f,!!kt.supportsPassiveEvents&&{passive:g.passive===void 0?l.indexOf("touch")!==-1:g.passive,capture:!1}),w[l]||(w[l]=[]);let C={fn:f,order:typeof g.order=="number"?g.order:1/0};return w[l].push(C),w[l].sort((I,R)=>I.order-R.order),function(){_i(B,l,f)}},arrayMax:function(B){let l=B.length,f=B[0];for(;l--;)B[l]>f&&(f=B[l]);return f},arrayMin:function(B){let l=B.length,f=B[0];for(;l--;)B[l]<f&&(f=B[l]);return f},attr:hs,clamp:function(B,l,f){return B>l?B<f?B:f:l},clearTimeout:function(B){Ns(B)&&clearTimeout(B)},correctFloat:Me,createElement:function(B,l,f,g,b){let w=Ut.createElement(B);return l&&Zs(w,l),b&&Tn(w,{padding:"0",border:"none",margin:"0"}),f&&Tn(w,f),g&&g.appendChild(w),w},crisp:function(B,l=0,f){let g=l%2/2,b=f?-1:1;return(Math.round(B*b-g)+g)*b},css:Tn,defined:Ns,destroyObjectProperties:function(B,l,f){ni(B,function(g,b){g!==l&&(g!=null&&g.destroy)&&g.destroy(),(g!=null&&g.destroy||!f)&&delete B[b]})},diffObjects:function(B,l,f,g){let b={};return function w(A,C,I,R){let U=f?C:A;ni(A,function(F,G){if(!R&&g&&g.indexOf(G)>-1&&C[G]){F=Yi(F),I[G]=[];for(let Z=0;Z<Math.max(F.length,C[G].length);Z++)C[G][Z]&&(F[Z]===void 0?I[G][Z]=C[G][Z]:(I[G][Z]={},w(F[Z],C[G][Z],I[G][Z],R+1)))}else Ge(F,!0)&&!F.nodeType?(I[G]=Ti(F)?[]:{},w(F,C[G]||{},I[G],R+1),Object.keys(I[G]).length===0&&(G!=="colorAxis"||R!==0)&&delete I[G]):(A[G]!==C[G]||G in A&&!(G in C))&&G!=="__proto__"&&G!=="constructor"&&(I[G]=U[G])})}(B,l,b,0),b},discardElement:function(B){var l;(l=B==null?void 0:B.parentElement)==null||l.removeChild(B)},erase:function(B,l){let f=B.length;for(;f--;)if(B[f]===l){B.splice(f,1);break}},error:ye,extend:Zs,extendClass:function(B,l){let f=function(){};return f.prototype=new B,Zs(f.prototype,l),f},find:ci,fireEvent:ss,getAlignFactor:(B="")=>({center:.5,right:1,middle:.5,bottom:1})[B]||0,getClosestDistance:function(B,l){let f,g,b,w=!l;return B.forEach(A=>{if(A.length>1)for(b=A.length-1;b>0;b--)(g=A[b]-A[b-1])<0&&!w?(l==null||l(),l=void 0):g&&(f===void 0||g<f)&&(f=g)}),f},getMagnitude:Ds,getNestedProperty:function(B,l){let f=B.split(".");for(;f.length&&Ns(l);){let g=f.shift();if(g===void 0||g==="__proto__")return;if(g==="this"){let w;return Ge(l)&&(w=l["@this"]),w??l}let b=l[g.replace(/[\\'"]/g,"")];if(!Ns(b)||typeof b=="function"||typeof b.nodeType=="number"||b===Le)return;l=b}return l},getStyle:function B(l,f,g){var A;let b;if(f==="width"){let C=Math.min(l.offsetWidth,l.scrollWidth),I=(A=l.getBoundingClientRect)==null?void 0:A.call(l).width;return I<C&&I>=C-1&&(C=Math.floor(I)),Math.max(0,C-(B(l,"padding-left",!0)||0)-(B(l,"padding-right",!0)||0))}if(f==="height")return Math.max(0,Math.min(l.offsetHeight,l.scrollHeight)-(B(l,"padding-top",!0)||0)-(B(l,"padding-bottom",!0)||0));let w=Le.getComputedStyle(l,void 0);return w&&(b=w.getPropertyValue(f),Ji(g,f!=="opacity")&&(b=Ce(b))),b},insertItem:function(B,l){let f,g=B.options.index,b=l.length;for(f=B.options.isInternal?b:0;f<b+1;f++)if(!l[f]||pi(g)&&g<Ji(l[f].options.index,l[f]._i)||l[f].options.isInternal){l.splice(f,0,B);break}return f},isArray:Ti,isClass:fi,isDOMElement:li,isFunction:function(B){return typeof B=="function"},isNumber:pi,isObject:Ge,isString:di,merge:function(B,...l){let f,g=[B,...l],b={},w=function(C,I){return typeof C!="object"&&(C={}),ni(I,function(R,U){U!=="__proto__"&&U!=="constructor"&&(!Ge(R,!0)||fi(R)||li(R)?C[U]=I[U]:C[U]=w(C[U]||{},R))}),C};B===!0&&(b=g[1],g=Array.prototype.slice.call(g,2));let A=g.length;for(f=0;f<A;f++)b=w(b,g[f]);return b},normalizeTickInterval:function(B,l,f,g,b){let w,A=B;f=Ji(f,Ds(B));let C=B/f;for(!l&&(l=b?[1,1.2,1.5,2,2.5,3,4,5,6,8,10]:[1,2,2.5,5,10],g===!1&&(f===1?l=l.filter(function(I){return I%1==0}):f<=.1&&(l=[1/f]))),w=0;w<l.length&&(A=l[w],(!b||!(A*f>=B))&&(b||!(C<=(l[w]+(l[w+1]||l[w]))/2)));w++);return Me(A*f,-Math.round(Math.log(.001)/Math.LN10))},objectEach:ni,offset:function(B){let l=Ut.documentElement,f=B.parentElement||B.parentNode?B.getBoundingClientRect():{top:0,left:0,width:0,height:0};return{top:f.top+(Le.pageYOffset||l.scrollTop)-(l.clientTop||0),left:f.left+(Le.pageXOffset||l.scrollLeft)-(l.clientLeft||0),width:f.width,height:f.height}},pad:function(B,l,f){return Array((l||2)+1-String(B).replace("-","").length).join(f||"0")+B},pick:Ji,pInt:Ce,pushUnique:function(B,l){return 0>B.indexOf(l)&&!!B.push(l)},relativeLength:function(B,l,f){return/%$/.test(B)?l*parseFloat(B)/100+(f||0):parseFloat(B)},removeEvent:_i,replaceNested:function(B,...l){let f,g;do for(g of(f=B,l))B=B.replace(g[0],g[1]);while(B!==f);return B},splat:Yi,stableSort:function(B,l){let f,g,b=B.length;for(g=0;g<b;g++)B[g].safeI=g;for(B.sort(function(w,A){return(f=l(w,A))===0?w.safeI-A.safeI:f}),g=0;g<b;g++)delete B[g].safeI},syncTimeout:function(B,l,f){return l>0?setTimeout(B,l,f):(B.call(0,f),-1)},timeUnits:{millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:24192e5,year:314496e5},ucfirst:function(B){return di(B)?B.substring(0,1).toUpperCase()+B.substring(1):String(B)},uniqueKey:xi,useSerialIds:function(B){return a=Ji(B,a)},wrap:function(B,l,f){let g=B[l];B[l]=function(){let b=arguments,w=this;return f.apply(this,[function(){return g.apply(w,arguments.length?arguments:b)}].concat([].slice.call(arguments)))}}},{pageLang:zt,win:fe}=kt,{defined:Se,error:be,extend:Ue,isNumber:ei,isObject:We,isString:Xe,merge:Ve,objectEach:Ci,pad:ti,splat:wi,timeUnits:Pi,ucfirst:ts}=_t,es=kt.isSafari&&fe.Intl&&!fe.Intl.DateTimeFormat.prototype.formatRange,ns=B=>B.main===void 0,zn=class{constructor(B,l){this.options={timezone:"UTC"},this.variableTimezone=!1,this.Date=fe.Date,this.update(B),this.lang=l}update(B={}){this.dTLCache={},this.options=B=Ve(!0,this.options,B);let{timezoneOffset:l,useUTC:f}=B;this.Date=B.Date||fe.Date||Date;let g=B.timezone;Se(f)&&(g=f?"UTC":void 0),l&&l%60==0&&(g="Etc/GMT"+(l>0?"+":"")+l/60),this.variableTimezone=g!=="UTC"&&(g==null?void 0:g.indexOf("Etc/GMT"))!==0,this.timezone=g,["months","shortMonths","weekdays","shortWeekdays"].forEach(b=>{let w=/months/i.test(b),A=/short/.test(b),C={timeZone:"UTC"};C[w?"month":"weekday"]=A?"short":"long",this[b]=(w?[0,1,2,3,4,5,6,7,8,9,10,11]:[3,4,5,6,7,8,9]).map(I=>this.dateFormat(C,(w?31:1)*24*36e5*I))})}toParts(B){let[l,f,g,b,w,A,C]=this.dateTimeFormat({weekday:"narrow",day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},B,"es").split(/(?:, | |\/|:)/g);return[b,+g-1,f,w,A,C,Math.floor(Number(B)||0)%1e3,"DLMXJVS".indexOf(l)].map(Number)}dateTimeFormat(B,l,f=this.options.locale||zt){let g=JSON.stringify(B)+f;Xe(B)&&(B=this.str2dtf(B));let b=this.dTLCache[g];if(!b){B.timeZone??(B.timeZone=this.timezone);try{b=new Intl.DateTimeFormat(f,B)}catch(w){/Invalid time zone/i.test(w.message)?(be(34),B.timeZone="UTC",b=new Intl.DateTimeFormat(f,B)):be(w.message,!1)}}return this.dTLCache[g]=b,(b==null?void 0:b.format(l))||""}str2dtf(B,l={}){let f={L:{fractionalSecondDigits:3},S:{second:"2-digit"},M:{minute:"numeric"},H:{hour:"2-digit"},k:{hour:"numeric"},E:{weekday:"narrow"},a:{weekday:"short"},A:{weekday:"long"},d:{day:"2-digit"},e:{day:"numeric"},b:{month:"short"},B:{month:"long"},m:{month:"2-digit"},o:{month:"numeric"},y:{year:"2-digit"},Y:{year:"numeric"}};return Object.keys(f).forEach(g=>{B.indexOf(g)!==-1&&Ue(l,f[g])}),l}makeTime(B,l,f=1,g=0,b,w,A){let C=this.Date.UTC(B,l,f,g,b||0,w||0,A||0);if(this.timezone!=="UTC"){let I=this.getTimezoneOffset(C);if(C+=I,[2,3,8,9,10,11].indexOf(l)!==-1&&(g<5||g>20)){let R=this.getTimezoneOffset(C);I!==R?C+=R-I:I-36e5!==this.getTimezoneOffset(C-36e5)||es||(C-=36e5)}}return C}parse(B){if(!Xe(B))return B??void 0;let l=(B=B.replace(/\//g,"-").replace(/(GMT|UTC)/,"")).indexOf("Z")>-1||/([+-][0-9]{2}):?[0-9]{2}$/.test(B),f=/^[0-9]{4}-[0-9]{2}(-[0-9]{2}|)$/.test(B);l||f||(B+="Z");let g=Date.parse(B);if(ei(g))return g+(!l||f?this.getTimezoneOffset(g):0)}getTimezoneOffset(B){if(this.timezone!=="UTC"){let[l,f,g,b,w=0]=this.dateTimeFormat({timeZoneName:"shortOffset"},B,"en").split(/(GMT|:)/).map(Number),A=-(36e5*(g+w/60));if(ei(A))return A}return 0}dateFormat(B,l,f){let g=this.lang;if(!Se(l)||isNaN(l))return(g==null?void 0:g.invalidDate)||"";if(Xe(B=B??"%Y-%m-%d %H:%M:%S")){let b,w=/%\[([a-zA-Z]+)\]/g;for(;b=w.exec(B);)B=B.replace(b[0],this.dateTimeFormat(b[1],l,g==null?void 0:g.locale))}if(Xe(B)&&B.indexOf("%")!==-1){let b=this,[w,A,C,I,R,U,F,G]=this.toParts(l),Z=(g==null?void 0:g.weekdays)||this.weekdays,J=(g==null?void 0:g.shortWeekdays)||this.shortWeekdays,ot=(g==null?void 0:g.months)||this.months,rt=(g==null?void 0:g.shortMonths)||this.shortMonths;Ci(Ue({a:J?J[G]:Z[G].substr(0,3),A:Z[G],d:ti(C),e:ti(C,2," "),w:G,v:(g==null?void 0:g.weekFrom)??"",b:rt[A],B:ot[A],m:ti(A+1),o:A+1,y:w.toString().substr(2,2),Y:w,H:ti(I),k:I,I:ti(I%12||12),l:I%12||12,M:ti(R),p:I<12?"AM":"PM",P:I<12?"am":"pm",S:ti(U),L:ti(F,3)},kt.dateFormats),function(it,ct){if(Xe(B))for(;B.indexOf("%"+ct)!==-1;)B=B.replace("%"+ct,typeof it=="function"?it.call(b,l):it)})}else if(We(B)){let b=(this.getTimezoneOffset(l)||0)/36e5,w=this.timezone||"Etc/GMT"+(b>=0?"+":"")+b,{prefix:A="",suffix:C=""}=B;B=A+this.dateTimeFormat(Ue({timeZone:w},B),l)+C}return f?ts(B):B}resolveDTLFormat(B){return We(B,!0)?We(B,!0)&&ns(B)?{main:B}:B:{main:(B=wi(B))[0],from:B[1],to:B[2]}}getDateFormat(B,l,f,g){let b=this.dateFormat("%m-%d %H:%M:%S.%L",l),w="01-01 00:00:00.000",A={millisecond:15,second:12,minute:9,hour:6,day:3},C="millisecond",I=C;for(C in Pi){if(B&&B===Pi.week&&+this.dateFormat("%w",l)===f&&b.substr(6)===w.substr(6)){C="week";break}if(B&&Pi[C]>B){C=I;break}if(A[C]&&b.substr(A[C])!==w.substr(A[C]))break;C!=="week"&&(I=C)}return this.resolveDTLFormat(g[C]).main}},{defined:tn,extend:Vn,timeUnits:is}=_t,fr=class extends zn{getTimeTicks(B,l,f,g){let b=this,w=[],A={},{count:C=1,unitRange:I}=B,[R,U,F,G,Z,J]=b.toParts(l),ot=(l||0)%1e3,rt;if(g??(g=1),tn(l)){if(ot=I>=is.second?0:C*Math.floor(ot/C),I>=is.second&&(J=I>=is.minute?0:C*Math.floor(J/C)),I>=is.minute&&(Z=I>=is.hour?0:C*Math.floor(Z/C)),I>=is.hour&&(G=I>=is.day?0:C*Math.floor(G/C)),I>=is.day&&(F=I>=is.month?1:Math.max(1,C*Math.floor(F/C))),I>=is.month&&(U=I>=is.year?0:C*Math.floor(U/C)),I>=is.year&&(R-=R%C),I===is.week){C&&(l=b.makeTime(R,U,F,G,Z,J,ot));let dt=this.dateTimeFormat({timeZone:this.timezone,weekday:"narrow"},l,"es"),Ht="DLMXJVS".indexOf(dt);F+=-Ht+g+(Ht<g?-7:0)}l=b.makeTime(R,U,F,G,Z,J,ot),b.variableTimezone&&tn(f)&&(rt=f-l>4*is.month||b.getTimezoneOffset(l)!==b.getTimezoneOffset(f));let it=l,ct=1;for(;it<f;)w.push(it),I===is.year?it=b.makeTime(R+ct*C,0):I===is.month?it=b.makeTime(R,U+ct*C):rt&&(I===is.day||I===is.week)?it=b.makeTime(R,U,F+ct*C*(I===is.day?1:7)):rt&&I===is.hour&&C>1?it=b.makeTime(R,U,F,G+ct*C):it+=I*C,ct++;w.push(it),I<=is.hour&&w.length<1e4&&w.forEach(dt=>{dt%18e5==0&&b.dateFormat("%H%M%S%L",dt)==="000000000"&&(A[dt]="day")})}return w.info=Vn(B,{higherRanks:A,totalRange:I*C}),w}},{isTouchDevice:to}=kt,{fireEvent:Sn,merge:$n}=_t,Yn={colors:["#2caffe","#544fc5","#00e272","#fe6a35","#6b8abc","#d568fb","#2ee0ca","#fa4b42","#feb56a","#91e8e1"],symbols:["circle","diamond","square","triangle","triangle-down"],lang:{weekFrom:"week from",chartTitle:"Chart title",locale:void 0,loading:"Loading...",months:void 0,seriesName:"Series {add index 1}",shortMonths:void 0,weekdays:void 0,numericSymbols:["k","M","G","T","P","E"],pieSliceName:"Slice",resetZoom:"Reset zoom",yAxisTitle:"Values",resetZoomTitle:"Reset zoom level 1:1"},global:{buttonTheme:{fill:"#f7f7f7",padding:8,r:2,stroke:"#cccccc","stroke-width":1,style:{color:"#333333",cursor:"pointer",fontSize:"0.8em",fontWeight:"normal"},states:{hover:{fill:"#e6e6e6"},select:{fill:"#e6e9ff",style:{color:"#000000",fontWeight:"bold"}},disabled:{style:{color:"#cccccc"}}}}},time:{Date:void 0,timezone:"UTC",timezoneOffset:0,useUTC:void 0},chart:{alignThresholds:!1,panning:{enabled:!1,type:"x"},styledMode:!1,borderRadius:0,colorCount:10,allowMutatingData:!0,ignoreHiddenSeries:!0,spacing:[10,10,15,10],resetZoomButton:{theme:{},position:{}},reflow:!0,type:"line",zooming:{singleTouch:!1,resetButton:{theme:{zIndex:6},position:{align:"right",x:-10,y:10}}},width:null,height:null,borderColor:"#334eff",backgroundColor:"#ffffff",plotBorderColor:"#cccccc"},title:{style:{color:"#333333",fontWeight:"bold"},text:"Chart title",margin:15,minScale:.67},subtitle:{style:{color:"#666666",fontSize:"0.8em"},text:""},caption:{margin:15,style:{color:"#666666",fontSize:"0.8em"},text:"",align:"left",verticalAlign:"bottom"},plotOptions:{},legend:{enabled:!0,align:"center",alignColumns:!0,className:"highcharts-no-tooltip",events:{},layout:"horizontal",itemMarginBottom:2,itemMarginTop:2,labelFormatter:function(){return this.name},borderColor:"#999999",borderRadius:0,navigation:{style:{fontSize:"0.8em"},activeColor:"#0022ff",inactiveColor:"#cccccc"},itemStyle:{color:"#333333",cursor:"pointer",fontSize:"0.8em",textDecoration:"none",textOverflow:"ellipsis"},itemHoverStyle:{color:"#000000"},itemHiddenStyle:{color:"#666666",textDecoration:"line-through"},shadow:!1,itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},squareSymbol:!0,symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{fontSize:"0.8em",fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"45%"},style:{position:"absolute",backgroundColor:"#ffffff",opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:{duration:300,easing:B=>Math.sqrt(1-Math.pow(B-1,2))},borderRadius:3,dateTimeLabelFormats:{millisecond:"%[AebHMSL]",second:"%[AebHMS]",minute:"%[AebHM]",hour:"%[AebHM]",day:"%[AebY]",week:"%v %[AebY]",month:"%[BY]",year:"%Y"},footerFormat:"",headerShape:"callout",hideDelay:500,padding:8,position:{x:0,y:3},shared:!1,snap:to?25:10,headerFormat:'<span style="font-size: 0.8em">{ucfirst point.key}</span><br/>',pointFormat:'<span style="color:{point.color}"></span> {series.name}: <b>{point.y}</b><br/>',backgroundColor:"#ffffff",borderWidth:void 0,stickOnContact:!1,style:{color:"#333333",cursor:"default",fontSize:"0.8em"},useHTML:!1},credits:{enabled:!0,href:"https://www.highcharts.com?credits",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#999999",fontSize:"0.6em"},text:"Highcharts.com"}},El=new fr(Yn.time,Yn.lang),At={defaultOptions:Yn,defaultTime:El,getOptions:function(){return Yn},setOptions:function(B){var l;return Sn(kt,"setOptions",{options:B}),$n(!0,Yn,B),B.time&&El.update(Yn.time),B.lang&&"locale"in B.lang&&El.update({locale:B.lang.locale}),(l=B.lang)!=null&&l.chartTitle&&(Yn.title={...Yn.title,text:B.lang.chartTitle}),Yn}},{win:at}=kt,{isNumber:lt,isString:Mt,merge:jt,pInt:Wt,defined:ie}=_t,te=(B,l,f)=>`color-mix(in srgb,${B},${l} ${100*f}%)`,qt=B=>Mt(B)&&!!B&&B!=="none";class Qt{static parse(l){return l?new Qt(l):Qt.None}constructor(l){let f,g,b,w;this.rgba=[NaN,NaN,NaN,NaN],this.input=l;let A=kt.Color;if(A&&A!==Qt)return new A(l);if(typeof l=="object"&&l.stops!==void 0)this.stops=l.stops.map(C=>new Qt(C[1]));else if(typeof l=="string")for(this.input=l=Qt.names[l.toLowerCase()]||l,b=Qt.parsers.length;b--&&!g;)(f=(w=Qt.parsers[b]).regex.exec(l))&&(g=w.parse(f));g&&(this.rgba=g)}get(l){let f=this.input,g=this.rgba;if(this.output)return this.output;if(typeof f=="object"&&this.stops!==void 0){let b=jt(f);return b.stops=[].slice.call(b.stops),this.stops.forEach((w,A)=>{b.stops[A]=[b.stops[A][0],w.get(l)]}),b}return g&&lt(g[0])?l!=="rgb"&&(l||g[3]!==1)?l==="a"?`${g[3]}`:"rgba("+g.join(",")+")":"rgb("+g[0]+","+g[1]+","+g[2]+")":f}brighten(l){let f=this.rgba;if(this.stops)this.stops.forEach(function(g){g.brighten(l)});else if(lt(l)&&l!==0)if(lt(f[0]))for(let g=0;g<3;g++)f[g]+=Wt(255*l),f[g]<0&&(f[g]=0),f[g]>255&&(f[g]=255);else Qt.useColorMix&&qt(this.input)&&(this.output=te(this.input,l>0?"white":"black",Math.abs(l)));return this}setOpacity(l){return this.rgba[3]=l,this}tweenTo(l,f){let g=this.rgba,b=l.rgba;if(!lt(g[0])||!lt(b[0]))return Qt.useColorMix&&qt(this.input)&&qt(l.input)&&f<.99?te(this.input,l.input,f):l.input||"none";let w=b[3]!==1||g[3]!==1,A=(I,R)=>I+(g[R]-I)*(1-f),C=b.slice(0,3).map(A).map(Math.round);return w&&C.push(A(b[3],3)),(w?"rgba(":"rgb(")+C.join(",")+")"}}Qt.names={white:"#ffffff",black:"#000000"},Qt.parsers=[{regex:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d?(?:\.\d+)?)\s*\)/,parse:function(B){return[Wt(B[1]),Wt(B[2]),Wt(B[3]),parseFloat(B[4],10)]}},{regex:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/,parse:function(B){return[Wt(B[1]),Wt(B[2]),Wt(B[3]),1]}},{regex:/^#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])?$/i,parse:function(B){return[Wt(B[1]+B[1],16),Wt(B[2]+B[2],16),Wt(B[3]+B[3],16),ie(B[4])?Wt(B[4]+B[4],16)/255:1]}},{regex:/^#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})?$/i,parse:function(B){return[Wt(B[1],16),Wt(B[2],16),Wt(B[3],16),ie(B[4])?Wt(B[4],16)/255:1]}}],Qt.useColorMix=(Ym=at.CSS)==null?void 0:Ym.supports("color","color-mix(in srgb,red,blue 9%)"),Qt.None=new Qt("");let{parse:Fe}=Qt,{win:He}=kt,{isNumber:ze,objectEach:Di}=_t;class Ei{constructor(l,f,g){this.pos=NaN,this.options=f,this.elem=l,this.prop=g}dSetter(){let l=this.paths,f=l==null?void 0:l[0],g=l==null?void 0:l[1],b=this.now||0,w=[];if(b!==1&&f&&g)if(f.length===g.length&&b<1)for(let A=0;A<g.length;A++){let C=f[A],I=g[A],R=[];for(let U=0;U<I.length;U++){let F=C[U],G=I[U];ze(F)&&ze(G)&&(I[0]!=="A"||U!==4&&U!==5)?R[U]=F+b*(G-F):R[U]=G}w.push(R)}else w=g;else w=this.toD||[];this.elem.attr("d",w,void 0,!0)}update(){let l=this.elem,f=this.prop,g=this.now,b=this.options.step;this[f+"Setter"]?this[f+"Setter"]():l.attr?l.element&&l.attr(f,g,null,!0):l.style[f]=g+this.unit,b&&b.call(l,g,this)}run(l,f,g){let b=this,w=b.options,A=function(R){return!A.stopped&&b.step(R)},C=He.requestAnimationFrame||function(R){setTimeout(R,13)},I=function(){for(let R=0;R<Ei.timers.length;R++)Ei.timers[R]()||Ei.timers.splice(R--,1);Ei.timers.length&&C(I)};l!==f||this.elem["forceAnimate:"+this.prop]?(this.startTime=+new Date,this.start=l,this.end=f,this.unit=g,this.now=this.start,this.pos=0,A.elem=this.elem,A.prop=this.prop,A()&&Ei.timers.push(A)===1&&C(I)):(delete w.curAnim[this.prop],w.complete&&Object.keys(w.curAnim).length===0&&w.complete.call(this.elem))}step(l){let f,g,b=+new Date,w=this.options,A=this.elem,C=w.complete,I=w.duration,R=w.curAnim;return A.attr&&!A.element?f=!1:l||b>=I+this.startTime?(this.now=this.end,this.pos=1,this.update(),R[this.prop]=!0,g=!0,Di(R,function(U){U!==!0&&(g=!1)}),g&&C&&C.call(A),f=!1):(this.pos=w.easing((b-this.startTime)/I),this.now=this.start+(this.end-this.start)*this.pos,this.update(),f=!0),f}initPath(l,f,g){let b=l.startX,w=l.endX,A=g.slice(),C=l.isArea,I=C?2:1,R=f&&g.length>f.length&&g.hasStackedCliffs,U,F,G,Z,J=f==null?void 0:f.slice();if(!J||R)return[A,A];function ot(it,ct){for(;it.length<F;){let dt=it[0],Ht=ct[F-it.length];if(Ht&&dt[0]==="M"&&(Ht[0]==="C"?it[0]=["C",dt[1],dt[2],dt[1],dt[2],dt[1],dt[2]]:it[0]=["L",dt[1],dt[2]]),it.unshift(dt),C){let Bt=it.pop();it.push(it[it.length-1],Bt)}}}function rt(it){for(;it.length<F;){let ct=it[Math.floor(it.length/I)-1].slice();if(ct[0]==="C"&&(ct[1]=ct[5],ct[2]=ct[6]),C){let dt=it[Math.floor(it.length/I)].slice();it.splice(it.length/2,0,ct,dt)}else it.push(ct)}}if(b&&w&&w.length){for(G=0;G<b.length;G++){if(b[G]===w[0]){U=G;break}if(b[0]===w[w.length-b.length+G]){U=G,Z=!0;break}if(b[b.length-1]===w[w.length-b.length+G]){U=b.length-G;break}}U===void 0&&(J=[])}return J.length&&ze(U)&&(F=A.length+U*I,Z?(ot(J,A),rt(A)):(ot(A,J),rt(J))),[J,A]}fillSetter(){Ei.prototype.strokeSetter.apply(this,arguments)}strokeSetter(){this.elem.attr(this.prop,Fe(this.start).tweenTo(Fe(this.end),this.pos),void 0,!0)}}Ei.timers=[];let{defined:zi,getStyle:Xi,isArray:Qi,isNumber:en,isObject:an,merge:Kn,objectEach:Pn,pick:wo}=_t;function In(B){return an(B)?Kn({duration:500,defer:0},B):{duration:500*!!B,defer:0}}function er(B,l){let f=Ei.timers.length;for(;f--;)Ei.timers[f].elem!==B||l&&l!==Ei.timers[f].prop||(Ei.timers[f].stopped=!0)}let mn={animate:function(B,l,f){let g,b="",w,A,C;an(f)||(C=arguments,f={duration:C[2],easing:C[3],complete:C[4]}),en(f.duration)||(f.duration=400),f.easing=typeof f.easing=="function"?f.easing:Math[f.easing]||Math.easeInOutSine,f.curAnim=Kn(l),Pn(l,function(I,R){er(B,R),A=new Ei(B,f,R),w=void 0,R==="d"&&Qi(l.d)?(A.paths=A.initPath(B,B.pathArray,l.d),A.toD=l.d,g=0,w=1):B.attr?g=B.attr(R):(g=parseFloat(Xi(B,R))||0,R!=="opacity"&&(b="px")),w||(w=I),typeof w=="string"&&w.match("px")&&(w=w.replace(/px/g,"")),A.run(g,w,b)})},animObject:In,getDeferredAnimation:function(B,l,f){let g=In(l),b=f?[f]:B.series,w=0,A=0;return b.forEach(C=>{let I=In(C.options.animation);w=an(l)&&zi(l.defer)?g.defer:Math.max(w,I.duration+I.defer),A=Math.min(g.duration,I.duration)}),B.renderer.forExport&&(w=0),{defer:Math.max(0,w-A),duration:Math.min(w,A)}},setAnimation:function(B,l){l.renderer.globalAnimation=wo(B,l.options.chart.animation,!0)},stop:er},{SVG_NS:Ef,win:Mf}=kt,{attr:ms,createElement:Nu,css:yc,error:mh,isFunction:gh,isString:eo,objectEach:To,splat:ju}=_t,{trustedTypes:xc}=Mf,So=xc&&gh(xc.createPolicy)&&xc.createPolicy("highcharts",{createHTML:B=>B}),qo=So?So.createHTML(""):"";class Is{static filterUserAttributes(l){return To(l,(f,g)=>{let b=!0;Is.allowedAttributes.indexOf(g)===-1&&(b=!1),["background","dynsrc","href","lowsrc","src"].indexOf(g)!==-1&&(b=eo(f)&&Is.allowedReferences.some(w=>f.indexOf(w)===0)),b||(mh(33,!1,void 0,{"Invalid attribute in config":`${g}`}),delete l[g]),eo(f)&&l[g]&&(l[g]=f.replace(/</g,"&lt;"))}),l}static parseStyle(l){return l.split(";").reduce((f,g)=>{let b=g.split(":").map(A=>A.trim()),w=b.shift();return w&&b.length&&(f[w.replace(/-([a-z])/g,A=>A[1].toUpperCase())]=b.join(":")),f},{})}static setElementHTML(l,f){l.innerHTML=Is.emptyHTML,f&&new Is(f).addToDOM(l)}constructor(l){this.nodes=typeof l=="string"?this.parseMarkup(l):l}addToDOM(l){return function f(g,b){let w;return ju(g).forEach(function(A){let C,I=A.tagName,R=A.textContent?kt.doc.createTextNode(A.textContent):void 0,U=Is.bypassHTMLFiltering;if(I)if(I==="#text")C=R;else if(Is.allowedTags.indexOf(I)!==-1||U){let F=I==="svg"?Ef:b.namespaceURI||Ef,G=kt.doc.createElementNS(F,I),Z=A.attributes||{};To(A,function(J,ot){ot!=="tagName"&&ot!=="attributes"&&ot!=="children"&&ot!=="style"&&ot!=="textContent"&&(Z[ot]=J)}),ms(G,U?Z:Is.filterUserAttributes(Z)),A.style&&yc(G,A.style),R&&G.appendChild(R),f(A.children||[],G),C=G}else mh(33,!1,void 0,{"Invalid tagName in config":I});C&&b.appendChild(C),w=C}),w}(this.nodes,l)}parseMarkup(l){let f,g=[];l=l.trim().replace(/ style=(["'])/g," data-style=$1");try{f=new DOMParser().parseFromString(So?So.createHTML(l):l,"text/html")}catch{}if(!f){let w=Nu("div");w.innerHTML=l,f={body:w}}let b=(w,A)=>{let C=w.nodeName.toLowerCase(),I={tagName:C};C==="#text"&&(I.textContent=w.textContent||"");let R=w.attributes;if(R){let U={};[].forEach.call(R,F=>{F.name==="data-style"?I.style=Is.parseStyle(F.value):U[F.name]=F.value}),I.attributes=U}if(w.childNodes.length){let U=[];[].forEach.call(w.childNodes,F=>{b(F,U)}),U.length&&(I.children=U)}A.push(I)};return[].forEach.call(f.body.childNodes,w=>b(w,g)),g}}Is.allowedAttributes=["alt","aria-controls","aria-describedby","aria-expanded","aria-haspopup","aria-hidden","aria-label","aria-labelledby","aria-live","aria-pressed","aria-readonly","aria-roledescription","aria-selected","class","clip-path","color","colspan","cx","cy","d","dx","dy","disabled","fill","filterUnits","flood-color","flood-opacity","height","href","id","in","in2","markerHeight","markerWidth","offset","opacity","operator","orient","padding","paddingLeft","paddingRight","patternUnits","r","radius","refX","refY","role","scope","slope","src","startOffset","stdDeviation","stroke","stroke-linecap","stroke-width","style","tableValues","result","rowspan","summary","target","tabindex","text-align","text-anchor","textAnchor","textLength","title","type","valign","width","x","x1","x2","xlink:href","y","y1","y2","zIndex"],Is.allowedReferences=["https://","http://","mailto:","/","../","./","#"],Is.allowedTags=["a","abbr","b","br","button","caption","circle","clipPath","code","dd","defs","div","dl","dt","em","feComponentTransfer","feComposite","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMorphology","feOffset","feMerge","feMergeNode","filter","h1","h2","h3","h4","h5","h6","hr","i","img","li","linearGradient","marker","ol","p","path","pattern","pre","rect","small","span","stop","strong","style","sub","sup","svg","table","text","textPath","thead","title","tbody","tspan","td","th","tr","u","ul","#text"],Is.emptyHTML=qo,Is.bypassHTMLFiltering=!1;let{defaultOptions:pe,defaultTime:Eo}=At,{pageLang:En}=kt,{extend:Gn,getNestedProperty:Af,isArray:Mo,isNumber:_h,isObject:Cf,isString:Ml,pick:Ke,ucfirst:Ki}=_t,Ui={add:(B,l)=>B+l,divide:(B,l)=>l!==0?B/l:"",eq:(B,l)=>B==l,each:function(B){let l=arguments[arguments.length-1];return!!Mo(B)&&B.map((f,g)=>Vi(l.body,Gn(Cf(f)?f:{"@this":f},{"@index":g,"@first":g===0,"@last":g===B.length-1}))).join("")},ge:(B,l)=>B>=l,gt:(B,l)=>B>l,if:B=>!!B,le:(B,l)=>B<=l,lt:(B,l)=>B<l,multiply:(B,l)=>B*l,ne:(B,l)=>B!=l,subtract:(B,l)=>B-l,ucfirst:Ki,unless:B=>!B},br={},Or=B=>/^["'].+["']$/.test(B);function Vi(B="",l,f){var rt;let g=/\{([a-zA-Z\u00C0-\u017F\d:\.,;\-\/<>\[\]%_@+"'= #\(\)]+)\}/g,b=/\(([a-zA-Z\u00C0-\u017F\d:\.,;\-\/<>\[\]%_@+"'= ]+)\)/g,w=[],A=/f$/,C=/\.(\d)/,I=((rt=f==null?void 0:f.options)==null?void 0:rt.lang)||pe.lang,R=(f==null?void 0:f.time)||Eo,U=(f==null?void 0:f.numberFormatter)||wr,F=(it="")=>{let ct;return it==="true"||it!=="false"&&((ct=Number(it)).toString()===it?ct:Or(it)?it.slice(1,-1):Af(it,l))},G,Z,J=0,ot;for(;(G=g.exec(B))!==null;){let it=G,ct=b.exec(G[1]);ct&&(G=ct,ot=!0),Z!=null&&Z.isBlock||(Z={ctx:l,expression:G[1],find:G[0],isBlock:G[1].charAt(0)==="#",start:G.index,startInner:G.index+G[0].length,length:G[0].length});let dt=(Z.isBlock?it:G)[1].split(" ")[0].replace("#","");Ui[dt]&&(Z.isBlock&&dt===Z.fn&&J++,Z.fn||(Z.fn=dt));let Ht=G[1]==="else";if(Z.isBlock&&Z.fn&&(G[1]===`/${Z.fn}`||Ht))if(J)!Ht&&J--;else{let Bt=Z.startInner,Vt=B.substr(Bt,G.index-Bt);Z.body===void 0?(Z.body=Vt,Z.startInner=G.index+G[0].length):Z.elseBody=Vt,Z.find+=Vt+G[0],Ht||(w.push(Z),Z=void 0)}else Z.isBlock||w.push(Z);if(ct&&!(Z!=null&&Z.isBlock))break}return w.forEach(it=>{let ct,dt,{body:Ht,elseBody:Bt,expression:Vt,fn:le}=it;if(le){let Kt=[it],ce=[],Ee=Vt.length,Be=0,$e;for(dt=0;dt<=Ee;dt++){let Ae=Vt.charAt(dt);$e||Ae!=='"'&&Ae!=="'"?$e===Ae&&($e=""):$e=Ae,$e||Ae!==" "&&dt!==Ee||(ce.push(Vt.substr(Be,dt-Be)),Be=dt+1)}for(dt=Ui[le].length;dt--;)Kt.unshift(F(ce[dt+1]));ct=Ui[le].apply(l,Kt),it.isBlock&&typeof ct=="boolean"&&(ct=Vi(ct?Ht:Bt,l,f))}else{let Kt=Or(Vt)?[Vt]:Vt.split(":");if(ct=F(Kt.shift()||""),Kt.length&&typeof ct=="number"){let ce=Kt.join(":");if(A.test(ce)){let Ee=parseInt((ce.match(C)||["","-1"])[1],10);ct!==null&&(ct=U(ct,Ee,I.decimalPoint,ce.indexOf(",")>-1?I.thousandsSep:""))}else ct=R.dateFormat(ce,ct)}b.lastIndex=0,b.test(it.find)&&Ml(ct)&&(ct=`"${ct}"`)}B=B.replace(it.find,Ke(ct,""))}),ot?Vi(B,l,f):B}function wr(B,l,f,g){var ot;l*=1;let b,w,[A,C]=(B=+B||0).toString().split("e").map(Number),I=((ot=this==null?void 0:this.options)==null?void 0:ot.lang)||pe.lang,R=(B.toString().split(".")[1]||"").split("e")[0].length,U=l,F={};f??(f=I.decimalPoint),g??(g=I.thousandsSep),l===-1?l=Math.min(R,20):_h(l)?l&&C<0&&((w=l+C)>=0?(A=+A.toExponential(w).split("e")[0],l=w):(A=Math.floor(A),B=l<20?+(A*Math.pow(10,C)).toFixed(l):0,C=0)):l=2,C&&(l??(l=2),B=A),_h(l)&&l>=0&&(F.minimumFractionDigits=l,F.maximumFractionDigits=l),g===""&&(F.useGrouping=!1);let G=g||f,Z=G?"en":(this==null?void 0:this.locale)||I.locale||En,J=JSON.stringify(F)+Z;return b=(br[J]??(br[J]=new Intl.NumberFormat(Z,F))).format(B),G&&(b=b.replace(/([,\.])/g,"_$1").replace(/_\,/g,g??",").replace("_.",f??".")),(l||+b!=0)&&(!(C<0)||U)||(b="0"),C&&+b!=0&&(b+="e"+(C<0?"":"+")+C),b}let ir={dateFormat:function(B,l,f){return Eo.dateFormat(B,l,f)},format:Vi,helpers:Ui,numberFormat:wr};(function(B){let l;B.rendererTypes={},B.getRendererType=function(f=l){return B.rendererTypes[f]||B.rendererTypes[l]},B.registerRendererType=function(f,g,b){B.rendererTypes[f]=g,(!l||b)&&(l=f,kt.Renderer=g)}})(x||(x={}));let io=x,{clamp:Rr,pick:Ys,pushUnique:kf,stableSort:so}=_t;(T||(T={})).distribute=function B(l,f,g){let b=l,w=b.reducedLen||f,A=(dt,Ht)=>dt.target-Ht.target,C=[],I=l.length,R=[],U=C.push,F,G,Z,J=!0,ot,rt,it=0,ct;for(F=I;F--;)it+=l[F].size;if(it>w){for(so(l,(dt,Ht)=>(Ht.rank||0)-(dt.rank||0)),Z=(ct=l[0].rank===l[l.length-1].rank)?I/2:-1,G=ct?Z:I-1;Z&&it>w;)ot=l[F=Math.floor(G)],kf(R,F)&&(it-=ot.size),G+=Z,ct&&G>=l.length&&(Z/=2,G=Z);R.sort((dt,Ht)=>Ht-dt).forEach(dt=>U.apply(C,l.splice(dt,1)))}for(so(l,A),l=l.map(dt=>({size:dt.size,targets:[dt.target],align:Ys(dt.align,.5)}));J;){for(F=l.length;F--;)ot=l[F],rt=(Math.min.apply(0,ot.targets)+Math.max.apply(0,ot.targets))/2,ot.pos=Rr(rt-ot.size*ot.align,0,f-ot.size);for(F=l.length,J=!1;F--;)F>0&&l[F-1].pos+l[F-1].size>l[F].pos&&(l[F-1].size+=l[F].size,l[F-1].targets=l[F-1].targets.concat(l[F].targets),l[F-1].align=.5,l[F-1].pos+l[F-1].size>f&&(l[F-1].pos=f-l[F-1].size),l.splice(F,1),J=!0)}return U.apply(b,C),F=0,l.some(dt=>{let Ht=0;return(dt.targets||[]).some(()=>(b[F].pos=dt.pos+Ht,g!==void 0&&Math.abs(b[F].pos-b[F].target)>g?(b.slice(0,F+1).forEach(Bt=>delete Bt.pos),b.reducedLen=(b.reducedLen||f)-.1*f,b.reducedLen>.1*f&&B(b,f,g),!0):(Ht+=b[F].size,F++,!1)))}),so(b,A),b};let xa=T,{animate:vc,animObject:Uu,stop:Vu}=mn,{deg2rad:Al,doc:Ao,svg:yh,SVG_NS:Zo,win:Tr,isFirefox:gn}=kt,{addEvent:$u,attr:bc,createElement:Sr,crisp:pr,css:Gu,defined:Er,erase:ln,extend:Yo,fireEvent:wc,getAlignFactor:Ko,isArray:Wn,isFunction:xh,isNumber:Wu,isObject:Jo,isString:Qo,merge:Cl,objectEach:kl,pick:no,pInt:ta,pushUnique:Co,replaceNested:Hu,syncTimeout:Xa,uniqueKey:ko}=_t;class cn{_defaultGetter(l){let f=no(this[l+"Value"],this[l],this.element?this.element.getAttribute(l):null,0);return/^-?[\d\.]+$/.test(f)&&(f=parseFloat(f)),f}_defaultSetter(l,f,g){g.setAttribute(f,l)}add(l){let f,g=this.renderer,b=this.element;return l&&(this.parentGroup=l),this.textStr!==void 0&&this.element.nodeName==="text"&&g.buildText(this),this.added=!0,(!l||l.handleZ||this.zIndex)&&(f=this.zIndexSetter()),f||(l?l.element:g.box).appendChild(b),this.onAdd&&this.onAdd(),this}addClass(l,f){let g=f?"":this.attr("class")||"";return(l=(l||"").split(/ /g).reduce(function(b,w){return g.indexOf(w)===-1&&b.push(w),b},g?[g]:[]).join(" "))!==g&&this.attr("class",l),this}afterSetters(){this.doTransform&&(this.updateTransform(),this.doTransform=!1)}align(l,f,g,b=!0){let w=this.renderer,A=w.alignedObjects,C=!!l;l?(this.alignOptions=l,this.alignByTranslate=f,this.alignTo=g):(l=this.alignOptions||{},f=this.alignByTranslate,g=this.alignTo);let I=!g||Qo(g)?g||"renderer":void 0;I&&(C&&Co(A,this),g=void 0);let R=no(g,w[I],w),U=(R.x||0)+(l.x||0)+((R.width||0)-(l.width||0))*Ko(l.align),F=(R.y||0)+(l.y||0)+((R.height||0)-(l.height||0))*Ko(l.verticalAlign),G={"text-align":l==null?void 0:l.align};return G[f?"translateX":"x"]=Math.round(U),G[f?"translateY":"y"]=Math.round(F),b&&(this[this.placed?"animate":"attr"](G),this.placed=!0),this.alignAttr=G,this}alignSetter(l){let f={left:"start",center:"middle",right:"end"};f[l]&&(this.alignValue=l,this.element.setAttribute("text-anchor",f[l]))}animate(l,f,g){let b=Uu(no(f,this.renderer.globalAnimation,!0)),w=b.defer;return Ao.hidden&&(b.duration=0),b.duration!==0?(g&&(b.complete=g),Xa(()=>{this.element&&vc(this,l,b)},w)):(this.attr(l,void 0,g||b.complete),kl(l,function(A,C){b.step&&b.step.call(this,A,{prop:C,pos:1,elem:this})},this)),this}applyTextOutline(l){let f=this.element;l.indexOf("contrast")!==-1&&(l=l.replace(/contrast/g,this.renderer.getContrast(f.style.fill)));let g=l.indexOf(" "),b=l.substring(g+1),w=l.substring(0,g);if(w&&w!=="none"&&kt.svg){this.fakeTS=!0,w=w.replace(/(^[\d\.]+)(.*?)$/g,function(U,F,G){return 2*Number(F)+G}),this.removeTextOutline();let A=Ao.createElementNS(Zo,"tspan");bc(A,{class:"highcharts-text-outline",fill:b,stroke:b,"stroke-width":w,"stroke-linejoin":"round"});let C=f.querySelector("textPath")||f;[].forEach.call(C.childNodes,U=>{let F=U.cloneNode(!0);F.removeAttribute&&["fill","stroke","stroke-width","stroke"].forEach(G=>F.removeAttribute(G)),A.appendChild(F)});let I=0;[].forEach.call(C.querySelectorAll("text tspan"),U=>{I+=Number(U.getAttribute("dy"))});let R=Ao.createElementNS(Zo,"tspan");R.textContent="",bc(R,{x:Number(f.getAttribute("x")),dy:-I}),A.appendChild(R),C.insertBefore(A,C.firstChild)}}attr(l,f,g,b){let{element:w}=this,A=cn.symbolCustomAttribs,C,I,R=this,U;return typeof l=="string"&&f!==void 0&&(C=l,(l={})[C]=f),typeof l=="string"?R=(this[l+"Getter"]||this._defaultGetter).call(this,l,w):(kl(l,function(F,G){U=!1,b||Vu(this,G),this.symbolName&&A.indexOf(G)!==-1&&(I||(this.symbolAttr(l),I=!0),U=!0),this.rotation&&(G==="x"||G==="y")&&(this.doTransform=!0),U||(this[G+"Setter"]||this._defaultSetter).call(this,F,G,w)},this),this.afterSetters()),g&&g.call(this),R}clip(l){if(l&&!l.clipPath){let f=ko()+"-",g=this.renderer.createElement("clipPath").attr({id:f}).add(this.renderer.defs);Yo(l,{clipPath:g,id:f,count:0}),l.add(g)}return this.attr("clip-path",l?`url(${this.renderer.url}#${l.id})`:"none")}crisp(l,f){f=Math.round(f||l.strokeWidth||0);let g=l.x||this.x||0,b=l.y||this.y||0,w=(l.width||this.width||0)+g,A=(l.height||this.height||0)+b,C=pr(g,f),I=pr(b,f);return Yo(l,{x:C,y:I,width:pr(w,f)-C,height:pr(A,f)-I}),Er(l.strokeWidth)&&(l.strokeWidth=f),l}complexColor(l,f,g){let b=this.renderer,w,A,C,I,R,U,F,G,Z,J,ot=[],rt;wc(this.renderer,"complexColor",{args:arguments},function(){if(l.radialGradient?A="radialGradient":l.linearGradient&&(A="linearGradient"),A){if(C=l[A],R=b.gradients,U=l.stops,Z=g.radialReference,Wn(C)&&(l[A]=C={x1:C[0],y1:C[1],x2:C[2],y2:C[3],gradientUnits:"userSpaceOnUse"}),A==="radialGradient"&&Z&&!Er(C.gradientUnits)&&(I=C,C=Cl(C,b.getRadialAttr(Z,I),{gradientUnits:"userSpaceOnUse"})),kl(C,function(it,ct){ct!=="id"&&ot.push(ct,it)}),kl(U,function(it){ot.push(it)}),R[ot=ot.join(",")])J=R[ot].attr("id");else{C.id=J=ko();let it=R[ot]=b.createElement(A).attr(C).add(b.defs);it.radAttr=I,it.stops=[],U.forEach(function(ct){ct[1].indexOf("rgba")===0?(F=(w=Qt.parse(ct[1])).get("rgb"),G=w.get("a")):(F=ct[1],G=1);let dt=b.createElement("stop").attr({offset:ct[0],"stop-color":F,"stop-opacity":G}).add(it);it.stops.push(dt)})}rt="url("+b.url+"#"+J+")",g.setAttribute(f,rt),g.gradient=ot,l.toString=function(){return rt}}})}css(l){let f=this.styles,g={},b=this.element,w,A=!f;if(f&&kl(l,function(C,I){f&&f[I]!==C&&(g[I]=C,A=!0)}),A){f&&(l=Yo(f,g)),l.width===null||l.width==="auto"?delete this.textWidth:b.nodeName.toLowerCase()==="text"&&l.width&&(w=this.textWidth=ta(l.width)),Yo(this.styles,l),w&&!yh&&this.renderer.forExport&&delete l.width;let C=gn&&l.fontSize||null;C&&(Wu(C)||/^\d+$/.test(C))&&(l.fontSize+="px");let I=Cl(l);b.namespaceURI===this.SVG_NS&&(["textOutline","textOverflow","whiteSpace","width"].forEach(R=>I&&delete I[R]),I.color&&(I.fill=I.color,delete I.color)),Gu(b,I)}return this.added&&(this.element.nodeName==="text"&&this.renderer.buildText(this),l.textOutline&&this.applyTextOutline(l.textOutline)),this}dashstyleSetter(l){let f,g=this["stroke-width"];if(g==="inherit"&&(g=1),l){let b=(l=l.toLowerCase()).replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(",");for(f=b.length;f--;)b[f]=""+ta(b[f])*no(g,NaN);l=b.join(",").replace(/NaN/g,"none"),this.element.setAttribute("stroke-dasharray",l)}}destroy(){let l=this,f=l.element||{},g=l.renderer,b=f.ownerSVGElement,w=f.nodeName==="SPAN"&&l.parentGroup||void 0,A,C;if(f.onclick=f.onmouseout=f.onmouseover=f.onmousemove=f.point=null,Vu(l),l.clipPath&&b){let I=l.clipPath;[].forEach.call(b.querySelectorAll("[clip-path],[CLIP-PATH]"),function(R){R.getAttribute("clip-path").indexOf(I.element.id)>-1&&R.removeAttribute("clip-path")}),l.clipPath=I.destroy()}if(l.stops){for(C=0;C<l.stops.length;C++)l.stops[C].destroy();l.stops.length=0,l.stops=void 0}for(l.safeRemoveChild(f);w!=null&&w.div&&w.div.childNodes.length===0;)A=w.parentGroup,l.safeRemoveChild(w.div),delete w.div,w=A;l.alignOptions&&ln(g.alignedObjects,l),kl(l,(I,R)=>{var U,F,G;(((U=l[R])==null?void 0:U.parentGroup)===l||["connector","foreignObject"].indexOf(R)!==-1)&&((G=(F=l[R])==null?void 0:F.destroy)==null||G.call(F)),delete l[R]})}dSetter(l,f,g){Wn(l)&&(typeof l[0]=="string"&&(l=this.renderer.pathToSegments(l)),this.pathArray=l,l=l.reduce((b,w,A)=>w!=null&&w.join?(A?b+" ":"")+w.join(" "):(w||"").toString(),"")),/(NaN| {2}|^$)/.test(l)&&(l="M 0 0"),this[f]!==l&&(g.setAttribute(f,l),this[f]=l)}fillSetter(l,f,g){typeof l=="string"?g.setAttribute(f,l):l&&this.complexColor(l,f,g)}hrefSetter(l,f,g){g.setAttributeNS("http://www.w3.org/1999/xlink",f,l)}getBBox(l,f){let g,b,w,A,{alignValue:C,element:I,renderer:R,styles:U,textStr:F}=this,{cache:G,cacheKeys:Z}=R,J=I.namespaceURI===this.SVG_NS,ot=no(f,this.rotation,0),rt=R.styledMode?I&&cn.prototype.getStyle.call(I,"font-size"):U.fontSize;if(Er(F)&&((A=F.toString()).indexOf("<")===-1&&(A=A.replace(/\d/g,"0")),A+=["",R.rootFontSize,rt,ot,this.textWidth,C,U.lineClamp,U.textOverflow,U.fontWeight].join(",")),A&&!l&&(g=G[A]),!g||g.polygon){if(J||R.forExport){try{w=this.fakeTS&&function(ct){let dt=I.querySelector(".highcharts-text-outline");dt&&Gu(dt,{display:ct})},xh(w)&&w("none"),g=I.getBBox?Yo({},I.getBBox()):{width:I.offsetWidth,height:I.offsetHeight,x:0,y:0},xh(w)&&w("")}catch{}(!g||g.width<0)&&(g={x:0,y:0,width:0,height:0})}else g=this.htmlGetBBox();b=g.height,J&&(g.height=b={"11px,17":14,"13px,20":16}[`${rt||""},${Math.round(b)}`]||b),ot&&(g=this.getRotatedBox(g,ot));let it={bBox:g};wc(this,"afterGetBBox",it),g=it.bBox}if(A&&(F===""||g.height>0)){for(;Z.length>250;)delete G[Z.shift()];G[A]||Z.push(A),G[A]=g}return g}getRotatedBox(l,f){let{x:g,y:b,width:w,height:A}=l,{alignValue:C,translateY:I,rotationOriginX:R=0,rotationOriginY:U=0}=this,F=Ko(C),G=Number(this.element.getAttribute("y")||0)-(I?0:b),Z=f*Al,J=(f-90)*Al,ot=Math.cos(Z),rt=Math.sin(Z),it=w*ot,ct=w*rt,dt=Math.cos(J),Ht=Math.sin(J),[[Bt,Vt],[le,Kt]]=[R,U].map(ds=>[ds-ds*ot,ds*rt]),ce=g+F*(w-it)+Bt+Kt+G*dt,Ee=ce+it,Be=Ee-A*dt,$e=Be-it,Ae=b+G-F*ct-Vt+le+G*Ht,Je=Ae+ct,ri=Je-A*Ht,Ii=ri-ct,hi=Math.min(ce,Ee,Be,$e),Li=Math.min(Ae,Je,ri,Ii),as=Math.max(ce,Ee,Be,$e)-hi,Zi=Math.max(Ae,Je,ri,Ii)-Li;return{x:hi,y:Li,width:as,height:Zi,polygon:[[ce,Ae],[Ee,Je],[Be,ri],[$e,Ii]]}}getStyle(l){return Tr.getComputedStyle(this.element||this,"").getPropertyValue(l)}hasClass(l){return(""+this.attr("class")).split(" ").indexOf(l)!==-1}hide(){return this.attr({visibility:"hidden"})}htmlGetBBox(){return{height:0,width:0,x:0,y:0}}constructor(l,f){this.onEvents={},this.opacity=1,this.SVG_NS=Zo,this.element=f==="span"||f==="body"?Sr(f):Ao.createElementNS(this.SVG_NS,f),this.renderer=l,this.styles={},wc(this,"afterInit")}on(l,f){let{onEvents:g}=this;return g[l]&&g[l](),g[l]=$u(this.element,l,f),this}opacitySetter(l,f,g){let b=Number(Number(l).toFixed(3));this.opacity=b,g.setAttribute(f,b)}reAlign(){var l;(l=this.alignOptions)!=null&&l.width&&this.alignOptions.align!=="left"&&(this.alignOptions.width=this.getBBox().width,this.placed=!1,this.align())}removeClass(l){return this.attr("class",(""+this.attr("class")).replace(Qo(l)?RegExp(`(^| )${l}( |$)`):l," ").replace(/ +/g," ").trim())}removeTextOutline(){let l=this.element.querySelector("tspan.highcharts-text-outline");l&&this.safeRemoveChild(l)}safeRemoveChild(l){let f=l.parentNode;f&&f.removeChild(l)}setRadialReference(l){let f=this.element.gradient&&this.renderer.gradients[this.element.gradient]||void 0;return this.element.radialReference=l,f!=null&&f.radAttr&&f.animate(this.renderer.getRadialAttr(l,f.radAttr)),this}shadow(l){var w;let{renderer:f}=this,g=Cl(((w=this.parentGroup)==null?void 0:w.rotation)===90?{offsetX:-1,offsetY:-1}:{},Jo(l)?l:{}),b=f.shadowDefinition(g);return this.attr({filter:l?`url(${f.url}#${b})`:"none"})}show(l=!0){return this.attr({visibility:l?"inherit":"visible"})}"stroke-widthSetter"(l,f,g){this[f]=l,g.setAttribute(f,l)}strokeWidth(){if(!this.renderer.styledMode)return this["stroke-width"]||0;let l=this.getStyle("stroke-width"),f=0,g;return/px$/.test(l)?f=ta(l):l!==""&&(bc(g=Ao.createElementNS(Zo,"rect"),{width:l,"stroke-width":0}),this.element.parentNode.appendChild(g),f=g.getBBox().width,g.parentNode.removeChild(g)),f}symbolAttr(l){let f=this;cn.symbolCustomAttribs.forEach(function(g){f[g]=no(l[g],f[g])}),f.attr({d:f.renderer.symbols[f.symbolName](f.x,f.y,f.width,f.height,f)})}textSetter(l){l!==this.textStr&&(delete this.textPxLength,this.textStr=l,this.added&&this.renderer.buildText(this),this.reAlign())}titleSetter(l){let f=this.element,g=f.getElementsByTagName("title")[0]||Ao.createElementNS(this.SVG_NS,"title");f.insertBefore?f.insertBefore(g,f.firstChild):f.appendChild(g),g.textContent=Hu(no(l,""),[/<[^>]*>/g,""]).replace(/&lt;/g,"<").replace(/&gt;/g,">")}toFront(){let l=this.element;return l.parentNode.appendChild(l),this}translate(l,f){return this.attr({translateX:l,translateY:f})}updateTransform(l="transform"){let{element:f,foreignObject:g,matrix:b,padding:w,rotation:A=0,rotationOriginX:C,rotationOriginY:I,scaleX:R,scaleY:U,text:F,translateX:G=0,translateY:Z=0}=this,J=["translate("+G+","+Z+")"];Er(b)&&J.push("matrix("+b.join(",")+")"),A&&(J.push("rotate("+A+" "+(C??f.getAttribute("x")??this.x??0)+" "+(I??f.getAttribute("y")??this.y??0)+")"),(F==null?void 0:F.element.tagName)!=="SPAN"||F!=null&&F.foreignObject||F.attr({rotation:A,rotationOriginX:(C||0)-w,rotationOriginY:(I||0)-w})),(Er(R)||Er(U))&&J.push("scale("+no(R,1)+" "+no(U,1)+")"),J.length&&!(F||this).textPath&&((g==null?void 0:g.element)||f).setAttribute(l,J.join(" "))}visibilitySetter(l,f,g){l==="inherit"?g.removeAttribute(f):this[f]!==l&&g.setAttribute(f,l),this[f]=l}xGetter(l){return this.element.nodeName==="circle"&&(l==="x"?l="cx":l==="y"&&(l="cy")),this._defaultGetter(l)}zIndexSetter(l,f){let g=this.renderer,b=this.parentGroup,w=(b||g).element||g.box,A=this.element,C=w===g.box,I,R,U,F=!1,G,Z=this.added,J;if(Er(l)?(A.setAttribute("data-z-index",l),l*=1,this[f]===l&&(Z=!1)):Er(this[f])&&A.removeAttribute("data-z-index"),this[f]=l,Z){for((l=this.zIndex)&&b&&(b.handleZ=!0),J=(I=w.childNodes).length-1;J>=0&&!F;J--)G=!Er(U=(R=I[J]).getAttribute("data-z-index")),R!==A&&(l<0&&G&&!C&&!J?(w.insertBefore(A,I[J]),F=!0):(ta(U)<=l||G&&(!Er(l)||l>=0))&&(w.insertBefore(A,I[J+1]),F=!0));F||(w.insertBefore(A,I[3*!!C]),F=!0)}return F}}cn.symbolCustomAttribs=["anchorX","anchorY","clockwise","end","height","innerR","r","start","width","x","y"],cn.prototype.strokeSetter=cn.prototype.fillSetter,cn.prototype.yGetter=cn.prototype.xGetter,cn.prototype.matrixSetter=cn.prototype.rotationOriginXSetter=cn.prototype.rotationOriginYSetter=cn.prototype.rotationSetter=cn.prototype.scaleXSetter=cn.prototype.scaleYSetter=cn.prototype.translateXSetter=cn.prototype.translateYSetter=cn.prototype.verticalAlignSetter=function(B,l){this[l]=B,this.doTransform=!0};let Hn=cn,{defined:Tc,extend:Pl,getAlignFactor:Il,isNumber:Ll,merge:vh,pick:Dl,removeEvent:bh}=_t;class Br extends Hn{constructor(l,f,g,b,w,A,C,I,R,U){let F;super(l,"g"),this.paddingLeftSetter=this.paddingSetter,this.paddingRightSetter=this.paddingSetter,this.doUpdate=!1,this.textStr=f,this.x=g,this.y=b,this.anchorX=A,this.anchorY=C,this.baseline=R,this.className=U,this.addClass(U==="button"?"highcharts-no-tooltip":"highcharts-label"),U&&this.addClass("highcharts-"+U),this.text=l.text(void 0,0,0,I).attr({zIndex:1}),typeof w=="string"&&((F=/^url\((.*?)\)$/.test(w))||this.renderer.symbols[w])&&(this.symbolKey=w),this.bBox=Br.emptyBBox,this.padding=3,this.baselineOffset=0,this.needsBox=l.styledMode||F,this.deferredAttr={},this.alignFactor=0}alignSetter(l){let f=Il(l);this.textAlign=l,f!==this.alignFactor&&(this.alignFactor=f,this.bBox&&Ll(this.xSetting)&&this.attr({x:this.xSetting}))}anchorXSetter(l,f){this.anchorX=l,this.boxAttr(f,Math.round(l)-this.getCrispAdjust()-this.xSetting)}anchorYSetter(l,f){this.anchorY=l,this.boxAttr(f,l-this.ySetting)}boxAttr(l,f){this.box?this.box.attr(l,f):this.deferredAttr[l]=f}css(l){if(l){let f={};l=vh(l),Br.textProps.forEach(g=>{l[g]!==void 0&&(f[g]=l[g],delete l[g])}),this.text.css(f),"fontSize"in f||"fontWeight"in f?this.updateTextPadding():("width"in f||"textOverflow"in f)&&this.updateBoxSize()}return Hn.prototype.css.call(this,l)}destroy(){bh(this.element,"mouseenter"),bh(this.element,"mouseleave"),this.text&&this.text.destroy(),this.box&&(this.box=this.box.destroy()),Hn.prototype.destroy.call(this)}fillSetter(l,f){l&&(this.needsBox=!0),this.fill=l,this.boxAttr(f,l)}getBBox(l,f){this.textStr&&this.bBox.width===0&&this.bBox.height===0&&this.updateBoxSize();let{padding:g,height:b=0,translateX:w=0,translateY:A=0,width:C=0}=this,I=Dl(this.paddingLeft,g),R=f??(this.rotation||0),U={width:C,height:b,x:w+this.bBox.x-I,y:A+this.bBox.y-g+this.baselineOffset};return R&&(U=this.getRotatedBox(U,R)),U}getCrispAdjust(){return(this.renderer.styledMode&&this.box?this.box.strokeWidth():this["stroke-width"]?parseInt(this["stroke-width"],10):0)%2/2}heightSetter(l){this.heightSetting=l,this.doUpdate=!0}afterSetters(){super.afterSetters(),this.doUpdate&&(this.updateBoxSize(),this.doUpdate=!1)}onAdd(){this.text.add(this),this.attr({text:Dl(this.textStr,""),x:this.x||0,y:this.y||0}),this.box&&Tc(this.anchorX)&&this.attr({anchorX:this.anchorX,anchorY:this.anchorY})}paddingSetter(l,f){Ll(l)?l!==this[f]&&(this[f]=l,this.updateTextPadding()):this[f]=void 0}rSetter(l,f){this.boxAttr(f,l)}strokeSetter(l,f){this.stroke=l,this.boxAttr(f,l)}"stroke-widthSetter"(l,f){l&&(this.needsBox=!0),this["stroke-width"]=l,this.boxAttr(f,l)}"text-alignSetter"(l){this.textAlign=this["text-align"]=l,this.updateTextPadding()}textSetter(l){l!==void 0&&this.text.attr({text:l}),this.updateTextPadding(),this.reAlign()}updateBoxSize(){let l,f=this.text,g={},b=this.padding,w=this.bBox=(!Ll(this.widthSetting)||!Ll(this.heightSetting)||this.textAlign)&&Tc(f.textStr)?f.getBBox(void 0,0):Br.emptyBBox;this.width=this.getPaddedWidth(),this.height=(this.heightSetting||w.height||0)+2*b;let A=this.renderer.fontMetrics(f);if(this.baselineOffset=b+Math.min((this.text.firstLineMetrics||A).b,w.height||1/0),this.heightSetting&&(this.baselineOffset+=(this.heightSetting-A.h)/2),this.needsBox&&!f.textPath){if(!this.box){let C=this.box=this.symbolKey?this.renderer.symbol(this.symbolKey):this.renderer.rect();C.addClass((this.className==="button"?"":"highcharts-label-box")+(this.className?" highcharts-"+this.className+"-box":"")),C.add(this)}g.x=l=this.getCrispAdjust(),g.y=(this.baseline?-this.baselineOffset:0)+l,g.width=Math.round(this.width),g.height=Math.round(this.height),this.box.attr(Pl(g,this.deferredAttr)),this.deferredAttr={}}}updateTextPadding(){let l=this.text,f=l.styles.textAlign||this.textAlign;if(!l.textPath){this.updateBoxSize();let g=this.baseline?0:this.baselineOffset,b=(this.paddingLeft??this.padding)+Il(f)*(this.widthSetting??this.bBox.width);(b!==l.x||g!==l.y)&&(l.attr({align:f,x:b}),g!==void 0&&l.attr("y",g)),l.x=b,l.y=g}}widthSetter(l){this.widthSetting=Ll(l)?l:void 0,this.doUpdate=!0}getPaddedWidth(){let l=this.padding,f=Dl(this.paddingLeft,l),g=Dl(this.paddingRight,l);return(this.widthSetting||this.bBox.width||0)+f+g}xSetter(l){this.x=l,this.alignFactor&&(l-=this.alignFactor*this.getPaddedWidth(),this["forceAnimate:x"]=!0),this.xSetting=Math.round(l),this.attr("translateX",this.xSetting)}ySetter(l){this.ySetting=this.y=Math.round(l),this.attr("translateY",this.ySetting)}}Br.emptyBBox={width:0,height:0,x:0,y:0},Br.textProps=["color","direction","fontFamily","fontSize","fontStyle","fontWeight","lineClamp","lineHeight","textAlign","textDecoration","textOutline","textOverflow","whiteSpace","width"];let{defined:ps,isNumber:cm,pick:qa}=_t;function Xu(B,l,f,g,b){let w=[];if(b){let A=b.start||0,C=b.end||0,I=qa(b.r,f),R=qa(b.r,g||f),U=2e-4/(b.borderRadius?1:Math.max(I,1)),F=Math.abs(C-A-2*Math.PI)<U;F&&(A=Math.PI/2,C=2.5*Math.PI-U);let G=b.innerR,Z=qa(b.open,F),J=Math.cos(A),ot=Math.sin(A),rt=Math.cos(C),it=Math.sin(C),ct=qa(b.longArc,C-A-Math.PI<U?0:1),dt=["A",I,R,0,ct,qa(b.clockwise,1),B+I*rt,l+R*it];dt.params={start:A,end:C,cx:B,cy:l},w.push(["M",B+I*J,l+R*ot],dt),ps(G)&&((dt=["A",G,G,0,ct,ps(b.clockwise)?1-b.clockwise:0,B+G*J,l+G*ot]).params={start:C,end:A,cx:B,cy:l},w.push(Z?["M",B+G*rt,l+G*it]:["L",B+G*rt,l+G*it],dt)),Z||w.push(["Z"])}return w}function wh(B,l,f,g,b){return b!=null&&b.r?Th(B,l,f,g,b):[["M",B,l],["L",B+f,l],["L",B+f,l+g],["L",B,l+g],["Z"]]}function Th(B,l,f,g,b){let w=(b==null?void 0:b.r)||0;return[["M",B+w,l],["L",B+f-w,l],["A",w,w,0,0,1,B+f,l+w],["L",B+f,l+g-w],["A",w,w,0,0,1,B+f-w,l+g],["L",B+w,l+g],["A",w,w,0,0,1,B,l+g-w],["L",B,l+w],["A",w,w,0,0,1,B+w,l],["Z"]]}let Sh={arc:Xu,callout:function(B,l,f,g,b){let w=Math.min((b==null?void 0:b.r)||0,f,g),A=w+6,C=b==null?void 0:b.anchorX,I=(b==null?void 0:b.anchorY)||0,R=Th(B,l,f,g,{r:w});if(!cm(C)||C<f&&C>0&&I<g&&I>0)return R;if(B+C>f-A)if(I>l+A&&I<l+g-A)R.splice(3,1,["L",B+f,I-6],["L",B+f+6,I],["L",B+f,I+6],["L",B+f,l+g-w]);else if(C<f){let U=I<l+A,F=U?l:l+g;R.splice(U?2:5,0,["L",C,I],["L",B+f-w,F])}else R.splice(3,1,["L",B+f,g/2],["L",C,I],["L",B+f,g/2],["L",B+f,l+g-w]);else if(B+C<A)if(I>l+A&&I<l+g-A)R.splice(7,1,["L",B,I+6],["L",B-6,I],["L",B,I-6],["L",B,l+w]);else if(C>0){let U=I<l+A,F=U?l:l+g;R.splice(U?1:6,0,["L",C,I],["L",B+w,F])}else R.splice(7,1,["L",B,g/2],["L",C,I],["L",B,g/2],["L",B,l+w]);else I>g&&C<f-A?R.splice(5,1,["L",C+6,l+g],["L",C,l+g+6],["L",C-6,l+g],["L",B+w,l+g]):I<0&&C>A&&R.splice(1,1,["L",C-6,l],["L",C,l-6],["L",C+6,l],["L",f-w,l]);return R},circle:function(B,l,f,g){return Xu(B+f/2,l+g/2,f/2,g/2,{start:.5*Math.PI,end:2.5*Math.PI,open:!1})},diamond:function(B,l,f,g){return[["M",B+f/2,l],["L",B+f,l+g/2],["L",B+f/2,l+g],["L",B,l+g/2],["Z"]]},rect:wh,roundedRect:Th,square:wh,triangle:function(B,l,f,g){return[["M",B+f/2,l],["L",B+f,l+g],["L",B,l+g],["Z"]]},"triangle-down":function(B,l,f,g){return[["M",B,l],["L",B+f,l],["L",B+f/2,l+g],["Z"]]}},{doc:va,SVG_NS:Eh,win:Za}=kt,{attr:ro,extend:Ya,fireEvent:Mh,isString:Pf,objectEach:Sc,pick:qu}=_t,Ec=(B,l)=>B.substring(0,l)+"",Ah=class{constructor(B){let l=B.styles;this.renderer=B.renderer,this.svgElement=B,this.width=B.textWidth,this.textLineHeight=l==null?void 0:l.lineHeight,this.textOutline=l==null?void 0:l.textOutline,this.ellipsis=(l==null?void 0:l.textOverflow)==="ellipsis",this.lineClamp=l==null?void 0:l.lineClamp,this.noWrap=(l==null?void 0:l.whiteSpace)==="nowrap"}buildSVG(){let B=this.svgElement,l=B.element,f=B.renderer,g=qu(B.textStr,"").toString(),b=g.indexOf("<")!==-1,w=l.childNodes,A=!B.added&&f.box,C=[g,this.ellipsis,this.noWrap,this.textLineHeight,this.textOutline,B.getStyle("font-size"),B.styles.lineClamp,this.width].join(",");if(C!==B.textCache){B.textCache=C,delete B.actualWidth;for(let I=w.length;I--;)l.removeChild(w[I]);if(b||this.ellipsis||this.width||B.textPath||g.indexOf(" ")!==-1&&(!this.noWrap||/<br.*?>/g.test(g))){if(g!==""){A&&A.appendChild(l);let I=new Is(g);this.modifyTree(I.nodes),I.addToDOM(l),this.modifyDOM(),this.ellipsis&&(l.textContent||"").indexOf("")!==-1&&B.attr("title",this.unescapeEntities(B.textStr||"",["&lt;","&gt;"])),A&&A.removeChild(l)}}else l.appendChild(va.createTextNode(this.unescapeEntities(g)));Pf(this.textOutline)&&B.applyTextOutline&&B.applyTextOutline(this.textOutline)}}modifyDOM(){let B,l=this.svgElement,f=ro(l.element,"x");for(l.firstLineMetrics=void 0;(B=l.element.firstChild)&&/^[\s\u200B]*$/.test(B.textContent||" ");)l.element.removeChild(B);[].forEach.call(l.element.querySelectorAll("tspan.highcharts-br"),(A,C)=>{A.nextSibling&&A.previousSibling&&(C===0&&A.previousSibling.nodeType===1&&(l.firstLineMetrics=l.renderer.fontMetrics(A.previousSibling)),ro(A,{dy:this.getLineHeight(A.nextSibling),x:f}))});let g=this.width||0;if(!g)return;let b=(A,C)=>{var ot;let I=A.textContent||"",R=I.replace(/([^\^])-/g,"$1- ").split(" "),U=!this.noWrap&&(R.length>1||l.element.childNodes.length>1),F=this.getLineHeight(C),G=Math.max(0,g-.8*F),Z=0,J=l.actualWidth;if(U){let rt=[],it=[];for(;C.firstChild&&C.firstChild!==A;)it.push(C.firstChild),C.removeChild(C.firstChild);for(;R.length;)if(R.length&&!this.noWrap&&Z>0&&(rt.push(A.textContent||""),A.textContent=R.join(" ").replace(/- /g,"-")),this.truncate(A,void 0,R,Z===0&&J||0,g,G,(ct,dt)=>R.slice(0,dt).join(" ").replace(/- /g,"-")),J=l.actualWidth,Z++,this.lineClamp&&Z>=this.lineClamp){R.length&&(this.truncate(A,A.textContent||"",void 0,0,g,G,Ec),A.textContent=((ot=A.textContent)==null?void 0:ot.replace("",""))+"");break}it.forEach(ct=>{C.insertBefore(ct,A)}),rt.forEach(ct=>{C.insertBefore(va.createTextNode(ct),A);let dt=va.createElementNS(Eh,"tspan");dt.textContent="",ro(dt,{dy:F,x:f}),C.insertBefore(dt,A)})}else this.ellipsis&&I&&this.truncate(A,I,void 0,0,g,G,Ec)},w=A=>{[].slice.call(A.childNodes).forEach(C=>{C.nodeType===Za.Node.TEXT_NODE?b(C,A):(C.className.baseVal.indexOf("highcharts-br")!==-1&&(l.actualWidth=0),w(C))})};w(l.element)}getLineHeight(B){let l=B.nodeType===Za.Node.TEXT_NODE?B.parentElement:B;return this.textLineHeight?parseInt(this.textLineHeight.toString(),10):this.renderer.fontMetrics(l||this.svgElement.element).h}modifyTree(B){let l=(f,g)=>{let{attributes:b={},children:w,style:A={},tagName:C}=f,I=this.renderer.styledMode;if(C==="b"||C==="strong"?I?b.class="highcharts-strong":A.fontWeight="bold":(C==="i"||C==="em")&&(I?b.class="highcharts-emphasized":A.fontStyle="italic"),A!=null&&A.color&&(A.fill=A.color),C==="br"){b.class="highcharts-br",f.textContent="";let R=B[g+1];R!=null&&R.textContent&&(R.textContent=R.textContent.replace(/^ +/gm,""))}else C==="a"&&w&&w.some(R=>R.tagName==="#text")&&(f.children=[{children:w,tagName:"tspan"}]);C!=="#text"&&C!=="a"&&(f.tagName="tspan"),Ya(f,{attributes:b,style:A}),w&&w.filter(R=>R.tagName!=="#text").forEach(l)};B.forEach(l),Mh(this.svgElement,"afterModifyTree",{nodes:B})}truncate(B,l,f,g,b,w,A){let C,I,R=this.svgElement,{rotation:U}=R,F=[],G=f&&!g?1:0,Z=(l||f||"").length,J=Z;f||(b=w);let ot=function(rt,it){let ct=it||rt,dt=B.parentNode;if(dt&&F[ct]===void 0&&dt.getSubStringLength)try{F[ct]=g+dt.getSubStringLength(0,f?ct+1:ct)}catch{}return F[ct]};if(R.rotation=0,g+(I=ot(B.textContent.length))>b){for(;G<=Z;)J=Math.ceil((G+Z)/2),f&&(C=A(f,J)),I=ot(J,C&&C.length-1),G===Z?G=Z+1:I>b?Z=J-1:G=J;Z===0?B.textContent="":l&&Z===l.length-1||(B.textContent=C||A(l||f,J)),this.ellipsis&&I>b&&this.truncate(B,B.textContent||"",void 0,0,b,w,Ec)}f&&f.splice(0,J),R.actualWidth=I,R.rotation=U}unescapeEntities(B,l){return Sc(this.renderer.escapes,function(f,g){l&&l.indexOf(f)!==-1||(B=B.toString().replace(RegExp(f,"g"),g))}),B}},{defaultOptions:Ch}=At,{charts:Zu,deg2rad:rs,doc:Po,isFirefox:Yu,isMS:kh,isWebKit:If,noop:Ka,SVG_NS:Ku,symbolSizes:Ju,win:Qu}=kt,{addEvent:Ph,attr:zl,createElement:td,crisp:Ih,css:Ja,defined:ba,destroyObjectProperties:Lf,extend:Qa,isArray:Mc,isNumber:oo,isObject:tl,isString:Ac,merge:Cc,pick:Fr,pInt:Lh,replaceNested:ed,uniqueKey:Dh}=_t;class kc{constructor(l,f,g,b,w,A,C){let I,R;this.x=0,this.y=0;let U=this.createElement("svg").attr({version:"1.1",class:"highcharts-root"}),F=U.element;C||U.css(this.getStyle(b||{})),l.appendChild(F),zl(l,"dir","ltr"),l.innerHTML.indexOf("xmlns")===-1&&zl(F,"xmlns",this.SVG_NS),this.box=F,this.boxWrapper=U,this.alignedObjects=[],this.url=this.getReferenceURL(),this.createElement("desc").add().element.appendChild(Po.createTextNode("Created with Highcharts 12.2.0")),this.defs=this.createElement("defs").add(),this.allowHTML=A,this.forExport=w,this.styledMode=C,this.gradients={},this.cache={},this.cacheKeys=[],this.imgCount=0,this.rootFontSize=U.getStyle("font-size"),this.setSize(f,g,!1),Yu&&l.getBoundingClientRect&&((I=function(){Ja(l,{left:0,top:0}),R=l.getBoundingClientRect(),Ja(l,{left:Math.ceil(R.left)-R.left+"px",top:Math.ceil(R.top)-R.top+"px"})})(),this.unSubPixelFix=Ph(Qu,"resize",I))}definition(l){return new Is([l]).addToDOM(this.defs.element)}getReferenceURL(){if((Yu||If)&&Po.getElementsByTagName("base").length){if(!ba(h)){let l=Dh(),f=new Is([{tagName:"svg",attributes:{width:8,height:8},children:[{tagName:"defs",children:[{tagName:"clipPath",attributes:{id:l},children:[{tagName:"rect",attributes:{width:4,height:4}}]}]},{tagName:"rect",attributes:{id:"hitme",width:8,height:8,"clip-path":`url(#${l})`,fill:"rgba(0,0,0,0.001)"}}]}]).addToDOM(Po.body);Ja(f,{position:"fixed",top:0,left:0,zIndex:9e5});let g=Po.elementFromPoint(6,6);h=(g==null?void 0:g.id)==="hitme",Po.body.removeChild(f)}if(h)return ed(Qu.location.href.split("#")[0],[/<[^>]*>/g,""],[/([\('\)])/g,"\\$1"],[/ /g,"%20"])}return""}getStyle(l){return this.style=Qa({fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif',fontSize:"1rem"},l),this.style}setStyle(l){this.boxWrapper.css(this.getStyle(l))}isHidden(){return!this.boxWrapper.getBBox().width}destroy(){let l=this.defs;return this.box=null,this.boxWrapper=this.boxWrapper.destroy(),Lf(this.gradients||{}),this.gradients=null,this.defs=l.destroy(),this.unSubPixelFix&&this.unSubPixelFix(),this.alignedObjects=null,null}createElement(l){return new this.Element(this,l)}getRadialAttr(l,f){return{cx:l[0]-l[2]/2+(f.cx||0)*l[2],cy:l[1]-l[2]/2+(f.cy||0)*l[2],r:(f.r||0)*l[2]}}shadowDefinition(l){let f=[`highcharts-drop-shadow-${this.chartIndex}`,...Object.keys(l).map(b=>`${b}-${l[b]}`)].join("-").toLowerCase().replace(/[^a-z\d\-]/g,""),g=Cc({color:"#000000",offsetX:1,offsetY:1,opacity:.15,width:5},l);return this.defs.element.querySelector(`#${f}`)||this.definition({tagName:"filter",attributes:{id:f,filterUnits:g.filterUnits},children:this.getShadowFilterContent(g)}),f}getShadowFilterContent(l){return[{tagName:"feDropShadow",attributes:{dx:l.offsetX,dy:l.offsetY,"flood-color":l.color,"flood-opacity":Math.min(5*l.opacity,1),stdDeviation:l.width/2}}]}buildText(l){new Ah(l).buildSVG()}getContrast(l){let f=Qt.parse(l).rgba,g=" clamp(0,calc(9e9*(0.5 - (0.2126*r + 0.7152*g + 0.0722*b))),1)";if(oo(f[0])||!Qt.useColorMix){let b=f.map(A=>{let C=A/255;return C<=.04?C/12.92:Math.pow((C+.055)/1.055,2.4)}),w=.2126*b[0]+.7152*b[1]+.0722*b[2];return 1.05/(w+.05)>(w+.05)/.05?"#FFFFFF":"#000000"}return"color(from "+l+" srgb"+g+g+g+")"}button(l,f,g,b,w={},A,C,I,R,U){let F=this.label(l,f,g,R,void 0,void 0,U,void 0,"button"),G=this.styledMode,Z=arguments,J=0;w=Cc(Ch.global.buttonTheme,w),G&&(delete w.fill,delete w.stroke,delete w["stroke-width"]);let ot=w.states||{},rt=w.style||{};delete w.states,delete w.style;let it=[Is.filterUserAttributes(w)],ct=[rt];return G||["hover","select","disabled"].forEach((dt,Ht)=>{it.push(Cc(it[0],Is.filterUserAttributes(Z[Ht+5]||ot[dt]||{}))),ct.push(it[Ht+1].style),delete it[Ht+1].style}),Ph(F.element,kh?"mouseover":"mouseenter",function(){J!==3&&F.setState(1)}),Ph(F.element,kh?"mouseout":"mouseleave",function(){J!==3&&F.setState(J)}),F.setState=(dt=0)=>{if(dt!==1&&(F.state=J=dt),F.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][dt]),!G){F.attr(it[dt]);let Ht=ct[dt];tl(Ht)&&F.css(Ht)}},F.attr(it[0]),!G&&(F.css(Qa({cursor:"default"},rt)),U&&F.text.css({pointerEvents:"none"})),F.on("touchstart",dt=>dt.stopPropagation()).on("click",function(dt){J!==3&&(b==null||b.call(F,dt))})}crispLine(l,f){let[g,b]=l;return ba(g[1])&&g[1]===b[1]&&(g[1]=b[1]=Ih(g[1],f)),ba(g[2])&&g[2]===b[2]&&(g[2]=b[2]=Ih(g[2],f)),l}path(l){let f=this.styledMode?{}:{fill:"none"};return Mc(l)?f.d=l:tl(l)&&Qa(f,l),this.createElement("path").attr(f)}circle(l,f,g){let b=tl(l)?l:l===void 0?{}:{x:l,y:f,r:g},w=this.createElement("circle");return w.xSetter=w.ySetter=function(A,C,I){I.setAttribute("c"+C,A)},w.attr(b)}arc(l,f,g,b,w,A){let C;tl(l)?(f=(C=l).y,g=C.r,b=C.innerR,w=C.start,A=C.end,l=C.x):C={innerR:b,start:w,end:A};let I=this.symbol("arc",l,f,g,g,C);return I.r=g,I}rect(l,f,g,b,w,A){let C=tl(l)?l:l===void 0?{}:{x:l,y:f,r:w,width:Math.max(g||0,0),height:Math.max(b||0,0)},I=this.createElement("rect");return this.styledMode||(A!==void 0&&(C["stroke-width"]=A,Qa(C,I.crisp(C))),C.fill="none"),I.rSetter=function(R,U,F){I.r=R,zl(F,{rx:R,ry:R})},I.rGetter=function(){return I.r||0},I.attr(C)}roundedRect(l){return this.symbol("roundedRect").attr(l)}setSize(l,f,g){this.width=l,this.height=f,this.boxWrapper.animate({width:l,height:f},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:Fr(g,!0)?void 0:0}),this.alignElements()}g(l){let f=this.createElement("g");return l?f.attr({class:"highcharts-"+l}):f}image(l,f,g,b,w,A){let C={preserveAspectRatio:"none"};oo(f)&&(C.x=f),oo(g)&&(C.y=g),oo(b)&&(C.width=b),oo(w)&&(C.height=w);let I=this.createElement("image").attr(C),R=function(U){I.attr({href:l}),A.call(I,U)};if(A){I.attr({href:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="});let U=new Qu.Image;Ph(U,"load",R),U.src=l,U.complete&&R({})}else I.attr({href:l});return I}symbol(l,f,g,b,w,A){var rt,it;let C,I,R,U,F=this,G=/^url\((.*?)\)$/,Z=G.test(l),J=!Z&&(this.symbols[l]?l:"circle"),ot=J&&this.symbols[J];if(ot)typeof f=="number"&&(I=ot.call(this.symbols,f||0,g||0,b||0,w||0,A)),C=this.path(I),F.styledMode||C.attr("fill","none"),Qa(C,{symbolName:J||void 0,x:f,y:g,width:b,height:w}),A&&Qa(C,A);else if(Z){R=l.match(G)[1];let ct=C=this.image(R);ct.imgwidth=Fr(A==null?void 0:A.width,(rt=Ju[R])==null?void 0:rt.width),ct.imgheight=Fr(A==null?void 0:A.height,(it=Ju[R])==null?void 0:it.height),U=dt=>dt.attr({width:dt.width,height:dt.height}),["width","height"].forEach(dt=>{ct[`${dt}Setter`]=function(Ht,Bt){this[Bt]=Ht;let{alignByTranslate:Vt,element:le,width:Kt,height:ce,imgwidth:Ee,imgheight:Be}=this,$e=Bt==="width"?Ee:Be,Ae=1;A&&A.backgroundSize==="within"&&Kt&&ce&&Ee&&Be?(Ae=Math.min(Kt/Ee,ce/Be),zl(le,{width:Math.round(Ee*Ae),height:Math.round(Be*Ae)})):le&&$e&&le.setAttribute(Bt,$e),!Vt&&Ee&&Be&&this.translate(((Kt||0)-Ee*Ae)/2,((ce||0)-Be*Ae)/2)}}),ba(f)&&ct.attr({x:f,y:g}),ct.isImg=!0,ct.symbolUrl=l,ba(ct.imgwidth)&&ba(ct.imgheight)?U(ct):(ct.attr({width:0,height:0}),td("img",{onload:function(){let dt=Zu[F.chartIndex];this.width===0&&(Ja(this,{position:"absolute",top:"-999em"}),Po.body.appendChild(this)),Ju[R]={width:this.width,height:this.height},ct.imgwidth=this.width,ct.imgheight=this.height,ct.element&&U(ct),this.parentNode&&this.parentNode.removeChild(this),F.imgCount--,F.imgCount||!dt||dt.hasLoaded||dt.onload()},src:R}),this.imgCount++)}return C}clipRect(l,f,g,b){return this.rect(l,f,g,b,0)}text(l,f,g,b){let w={};if(b&&(this.allowHTML||!this.forExport))return this.html(l,f,g);w.x=Math.round(f||0),g&&(w.y=Math.round(g)),ba(l)&&(w.text=l);let A=this.createElement("text").attr(w);return b&&(!this.forExport||this.allowHTML)||(A.xSetter=function(C,I,R){let U=R.getElementsByTagName("tspan"),F=R.getAttribute(I);for(let G=0,Z;G<U.length;G++)(Z=U[G]).getAttribute(I)===F&&Z.setAttribute(I,C);R.setAttribute(I,C)}),A}fontMetrics(l){let f=Lh(Hn.prototype.getStyle.call(l,"font-size")||0),g=f<24?f+3:Math.round(1.2*f),b=Math.round(.8*g);return{h:g,b,f}}rotCorr(l,f,g){let b=l;return f&&g&&(b=Math.max(b*Math.cos(f*rs),4)),{x:-l/3*Math.sin(f*rs),y:b}}pathToSegments(l){let f=[],g=[],b={A:8,C:7,H:2,L:3,M:3,Q:5,S:5,T:3,V:2};for(let w=0;w<l.length;w++)Ac(g[0])&&oo(l[w])&&g.length===b[g[0].toUpperCase()]&&l.splice(w,0,g[0].replace("M","L").replace("m","l")),typeof l[w]=="string"&&(g.length&&f.push(g.slice(0)),g.length=0),g.push(l[w]);return f.push(g.slice(0)),f}label(l,f,g,b,w,A,C,I,R){return new Br(this,l,f,g,b,w,A,C,I,R)}alignElements(){this.alignedObjects.forEach(l=>l.align())}}Qa(kc.prototype,{Element:Hn,SVG_NS:Ku,escapes:{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},symbols:Sh,draw:Ka}),io.registerRendererType("svg",kc,!0);let{composed:id,isFirefox:hm}=kt,{attr:sd,css:ao,createElement:Pc,defined:nd,extend:rd,getAlignFactor:um,isNumber:Ol,pInt:Df,pushUnique:Ic}=_t;function od(B,l,f){var b;let g=((b=this.div)==null?void 0:b.style)||f.style;Hn.prototype[`${l}Setter`].call(this,B,l,f),g&&(g[l]=B)}let zh=(B,l)=>{var f;if(!B.div){let g=sd(B.element,"class"),b=B.css,w=Pc("div",g?{className:g}:void 0,{position:"absolute",left:`${B.translateX||0}px`,top:`${B.translateY||0}px`,...B.styles,display:B.display,opacity:B.opacity,visibility:B.visibility},((f=B.parentGroup)==null?void 0:f.div)||l);B.classSetter=(A,C,I)=>{I.setAttribute("class",A),w.className=A},B.translateXSetter=B.translateYSetter=(A,C)=>{B[C]=A,w.style[C==="translateX"?"left":"top"]=`${A}px`,B.doTransform=!0},B.opacitySetter=B.visibilitySetter=od,B.css=A=>(b.call(B,A),A.cursor&&(w.style.cursor=A.cursor),A.pointerEvents&&(w.style.pointerEvents=A.pointerEvents),B),B.on=function(){return Hn.prototype.on.apply({element:w,onEvents:B.onEvents},arguments),B},B.div=w}return B.div};class el extends Hn{static compose(l){Ic(id,this.compose)&&(l.prototype.html=function(f,g,b){return new el(this,"span").attr({text:f,x:Math.round(g),y:Math.round(b)})})}constructor(l,f){super(l,f),el.useForeignObject?this.foreignObject=l.createElement("foreignObject").attr({zIndex:2}):this.css({position:"absolute",...l.styledMode?{}:{fontFamily:l.style.fontFamily,fontSize:l.style.fontSize}}),this.element.style.whiteSpace="nowrap"}getSpanCorrection(l,f,g){this.xCorr=-l*g,this.yCorr=-f}css(l){let f,{element:g}=this,b=g.tagName==="SPAN"&&l&&"width"in l,w=b&&l.width;return b&&(delete l.width,this.textWidth=Df(w)||void 0,f=!0),(l==null?void 0:l.textOverflow)==="ellipsis"&&(l.overflow="hidden",l.whiteSpace="nowrap"),l!=null&&l.lineClamp&&(l.display="-webkit-box",l.WebkitLineClamp=l.lineClamp,l.WebkitBoxOrient="vertical",l.overflow="hidden"),Ol(Number(l==null?void 0:l.fontSize))&&(l.fontSize+="px"),rd(this.styles,l),ao(g,l),f&&this.updateTransform(),this}htmlGetBBox(){let{element:l}=this;return{x:l.offsetLeft,y:l.offsetTop,width:l.offsetWidth,height:l.offsetHeight}}updateTransform(){var ct;if(!this.added){this.alignOnAdd=!0;return}let{element:l,foreignObject:f,oldTextWidth:g,renderer:b,rotation:w,rotationOriginX:A,rotationOriginY:C,scaleX:I,scaleY:R,styles:{display:U="inline-block",whiteSpace:F},textAlign:G="left",textWidth:Z,translateX:J=0,translateY:ot=0,x:rt=0,y:it=0}=this;if(f||ao(l,{marginLeft:`${J}px`,marginTop:`${ot}px`}),l.tagName==="SPAN"){let dt,Ht=[w,G,l.innerHTML,Z,this.textAlign].join(","),Bt=-(((ct=this.parentGroup)==null?void 0:ct.padding)*1)||0;if(Z!==g){let ce=this.textPxLength?this.textPxLength:(ao(l,{width:"",whiteSpace:F||"nowrap"}),l.offsetWidth),Ee=Z||0,Be=l.style.textOverflow===""&&l.style.webkitLineClamp;(Ee>g||ce>Ee||Be)&&(/[\-\s\u00AD]/.test(l.textContent||l.innerText)||l.style.textOverflow==="ellipsis")&&(ao(l,{width:(w||I||ce>Ee||Be)&&Ol(Z)?Z+"px":"auto",display:U,whiteSpace:F||"normal"}),this.oldTextWidth=Z)}f&&(ao(l,{display:"inline-block",verticalAlign:"top"}),f.attr({width:b.width,height:b.height})),Ht!==this.cTT&&(dt=b.fontMetrics(l).b,nd(w)&&!f&&(w!==(this.oldRotation||0)||G!==this.oldAlign)&&ao(l,{transform:`rotate(${w}deg)`,transformOrigin:`${Bt}% ${Bt}px`}),this.getSpanCorrection(!nd(w)&&!this.textWidth&&this.textPxLength||l.offsetWidth,dt,um(G)));let{xCorr:Vt=0,yCorr:le=0}=this,Kt={left:`${rt+Vt}px`,top:`${it+le}px`,textAlign:G,transformOrigin:`${(A??rt)-Vt-rt-Bt}px ${(C??it)-le-it-Bt}px`};(I||R)&&(Kt.transform=`scale(${I??1},${R??1})`),f?(super.updateTransform(),Ol(rt)&&Ol(it)?(f.attr({x:rt+Vt,y:it+le,width:l.offsetWidth+3,height:l.offsetHeight,"transform-origin":l.getAttribute("transform-origin")||"0 0"}),ao(l,{display:U,textAlign:G})):hm&&f.attr({width:0,height:0})):ao(l,Kt),this.cTT=Ht,this.oldRotation=w,this.oldAlign=G}}add(l){let{foreignObject:f,renderer:g}=this,b=g.box.parentNode,w=[];if(f)f.add(l),super.add(g.createElement("body").attr({xmlns:"http://www.w3.org/1999/xhtml"}).css({background:"transparent",margin:"0 3px 0 0"}).add(f));else{let A;if(this.parentGroup=l,l&&!(A=l.div)){let C=l;for(;C;)w.push(C),C=C.parentGroup;for(let I of w.reverse())A=zh(I,b)}(A||b).appendChild(this.element)}return this.added=!0,this.alignOnAdd&&this.updateTransform(),this}textSetter(l){l!==this.textStr&&(delete this.bBox,delete this.oldTextWidth,Is.setElementHTML(this.element,l??""),this.textStr=l,this.doTransform=!0)}alignSetter(l){this.alignValue=this.textAlign=l,this.doTransform=!0}xSetter(l,f){this[f]=l,this.doTransform=!0}}let Nr=el.prototype;Nr.visibilitySetter=Nr.opacitySetter=od,Nr.ySetter=Nr.rotationSetter=Nr.rotationOriginXSetter=Nr.rotationOriginYSetter=Nr.xSetter,function(B){B.xAxis={alignTicks:!0,allowDecimals:void 0,panningEnabled:!0,zIndex:2,zoomEnabled:!0,dateTimeLabelFormats:{millisecond:{main:"%[HMSL]",range:!1},second:{main:"%[HMS]",range:!1},minute:{main:"%[HM]",range:!1},hour:{main:"%[HM]",range:!1},day:{main:"%[eb]"},week:{main:"%[eb]"},month:{main:"%[bY]"},year:{main:"%Y"}},endOnTick:!1,gridLineDashStyle:"Solid",gridZIndex:1,labels:{autoRotationLimit:80,distance:15,enabled:!0,indentation:10,overflow:"justify",reserveSpace:void 0,rotation:void 0,staggerLines:0,step:0,useHTML:!1,zIndex:7,style:{color:"#333333",cursor:"default",fontSize:"0.8em",textOverflow:"ellipsis"}},maxPadding:.01,minorGridLineDashStyle:"Solid",minorTickLength:2,minorTickPosition:"outside",minorTicksPerMajor:5,minPadding:.01,offset:void 0,reversed:void 0,reversedStacks:!1,showEmpty:!0,showFirstLabel:!0,showLastLabel:!0,startOfWeek:1,startOnTick:!1,tickLength:10,tickPixelInterval:100,tickmarkPlacement:"between",tickPosition:"outside",title:{align:"middle",useHTML:!1,x:0,y:0,style:{color:"#666666",fontSize:"0.8em"}},visible:!0,minorGridLineColor:"#f2f2f2",minorGridLineWidth:1,minorTickColor:"#999999",lineColor:"#333333",lineWidth:1,gridLineColor:"#e6e6e6",gridLineWidth:void 0,tickColor:"#333333"},B.yAxis={reversedStacks:!0,endOnTick:!0,maxPadding:.05,minPadding:.05,tickPixelInterval:72,showLastLabel:!0,labels:{x:void 0},startOnTick:!0,title:{},stackLabels:{animation:{},allowOverlap:!1,enabled:!1,crop:!0,overflow:"justify",formatter:function(){let{numberFormatter:l}=this.axis.chart;return l(this.total||0,-1)},style:{color:"#000000",fontSize:"0.7em",fontWeight:"bold",textOutline:"1px contrast"}},gridLineWidth:1,lineWidth:0}}(P||(P={}));let dm=P,{addEvent:fm,isFunction:pm,objectEach:mm,removeEvent:gm}=_t;(o||(o={})).registerEventOptions=function(B,l){B.eventOptions=B.eventOptions||{},mm(l.events,function(f,g){B.eventOptions[g]!==f&&(B.eventOptions[g]&&(gm(B,g,B.eventOptions[g]),delete B.eventOptions[g]),pm(f)&&(B.eventOptions[g]=f,fm(B,g,f,{order:0})))})};let Lc=o,{deg2rad:Rl}=kt,{clamp:Bl,correctFloat:Dc,defined:Oh,destroyObjectProperties:ea,extend:zc,fireEvent:sr,getAlignFactor:Oc,isNumber:Rc,merge:il,objectEach:Fl,pick:Pr}=_t,ia=class{constructor(B,l,f,g,b){this.isNew=!0,this.isNewLabel=!0,this.axis=B,this.pos=l,this.type=f||"",this.parameters=b||{},this.tickmarkOffset=this.parameters.tickmarkOffset,this.options=this.parameters.options,sr(this,"init"),f||g||this.addLabel()}addLabel(){var le;let B=this,l=B.axis,f=l.options,g=l.chart,b=l.categories,w=l.logarithmic,A=l.names,C=B.pos,I=Pr((le=B.options)==null?void 0:le.labels,f.labels),R=l.tickPositions,U=C===R[0],F=C===R[R.length-1],G=(!I.step||I.step===1)&&l.tickInterval===1,Z=R.info,J=B.label,ot,rt,it,ct=this.parameters.category||(b?Pr(b[C],A[C],C):C);w&&Rc(ct)&&(ct=Dc(w.lin2log(ct))),l.dateTime&&(Z?ot=(rt=g.time.resolveDTLFormat(f.dateTimeLabelFormats[!f.grid&&Z.higherRanks[C]||Z.unitName])).main:Rc(ct)&&(ot=l.dateTime.getXDateFormat(ct,f.dateTimeLabelFormats||{}))),B.isFirst=U,B.isLast=F;let dt={axis:l,chart:g,dateTimeLabelFormat:ot,isFirst:U,isLast:F,pos:C,tick:B,tickPositionInfo:Z,value:ct};sr(this,"labelFormat",dt);let Ht=Kt=>I.formatter?I.formatter.call(Kt,Kt):I.format?(Kt.text=l.defaultLabelFormatter.call(Kt),ir.format(I.format,Kt,g)):l.defaultLabelFormatter.call(Kt),Bt=Ht.call(dt,dt),Vt=rt==null?void 0:rt.list;Vt?B.shortenLabel=function(){for(it=0;it<Vt.length;it++)if(zc(dt,{dateTimeLabelFormat:Vt[it]}),J.attr({text:Ht.call(dt,dt)}),J.getBBox().width<l.getSlotWidth(B)-2*(I.padding||0))return;J.attr({text:""})}:B.shortenLabel=void 0,G&&l._addedPlotLB&&B.moveLabel(Bt,I),Oh(J)||B.movedLabel?J&&J.textStr!==Bt&&!G&&(!J.textWidth||I.style.width||J.styles.width||J.css({width:null}),J.attr({text:Bt}),J.textPxLength=J.getBBox().width):(B.label=J=B.createLabel(Bt,I),B.rotation=0)}createLabel(B,l,f){let g=this.axis,{renderer:b,styledMode:w}=g.chart,A=l.style.whiteSpace,C=Oh(B)&&l.enabled?b.text(B,f==null?void 0:f.x,f==null?void 0:f.y,l.useHTML).add(g.labelGroup):void 0;return C&&(w||C.css(il(l.style)),C.textPxLength=C.getBBox().width,!w&&A&&C.css({whiteSpace:A})),C}destroy(){ea(this,this.axis)}getPosition(B,l,f,g){let b=this.axis,w=b.chart,A=g&&w.oldChartHeight||w.chartHeight,C={x:B?Dc(b.translate(l+f,void 0,void 0,g)+b.transB):b.left+b.offset+(b.opposite?(g&&w.oldChartWidth||w.chartWidth)-b.right-b.left:0),y:B?A-b.bottom+b.offset-(b.opposite?b.height:0):Dc(A-b.translate(l+f,void 0,void 0,g)-b.transB)};return C.y=Bl(C.y,-1e9,1e9),sr(this,"afterGetPosition",{pos:C}),C}getLabelPosition(B,l,f,g,b,w,A,C){let I,R,U=this.axis,F=U.transA,G=U.isLinked&&U.linkedParent?U.linkedParent.reversed:U.reversed,Z=U.staggerLines,J=U.tickRotCorr||{x:0,y:0},ot=g||U.reserveSpaceDefault?0:-U.labelOffset*(U.labelAlign==="center"?.5:1),rt=b.distance,it={};return I=U.side===0?f.rotation?-rt:-f.getBBox().height:U.side===2?J.y+rt:Math.cos(f.rotation*Rl)*(J.y-f.getBBox(!1,0).height/2),Oh(b.y)&&(I=U.side===0&&U.horiz?b.y+I:b.y),B=B+Pr(b.x,[0,1,0,-1][U.side]*rt)+ot+J.x-(w&&g?w*F*(G?-1:1):0),l=l+I-(w&&!g?w*F*(G?1:-1):0),Z&&(R=A/(C||1)%Z,U.opposite&&(R=Z-R-1),l+=R*(U.labelOffset/Z)),it.x=B,it.y=Math.round(l),sr(this,"afterGetLabelPosition",{pos:it,tickmarkOffset:w,index:A}),it}getLabelSize(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0}getMarkPath(B,l,f,g,b=!1,w){return w.crispLine([["M",B,l],["L",B+(b?0:-f),l+(b?f:0)]],g)}handleOverflow(B){var rt;let l=this.axis,f=l.options.labels,g=B.x,b=l.chart.chartWidth,w=l.chart.spacing,A=Pr(l.labelLeft,Math.min(l.pos,w[3])),C=Pr(l.labelRight,Math.max(l.isRadial?0:l.pos+l.len,b-w[1])),I=this.label,R=this.rotation,U=Oc(l.labelAlign||I.attr("align")),F=I.getBBox().width,G=l.getSlotWidth(this),Z=G,J=1,ot;R||f.overflow!=="justify"?R<0&&g-U*F<A?ot=Math.round(g/Math.cos(R*Rl)-A):R>0&&g+U*F>C&&(ot=Math.round((b-g)/Math.cos(R*Rl))):(g-U*F<A?Z=B.x+Z*(1-U)-A:g+(1-U)*F>C&&(Z=C-B.x+Z*U,J=-1),(Z=Math.min(G,Z))<G&&l.labelAlign==="center"&&(B.x+=J*(G-Z-U*(G-Math.min(F,Z)))),(F>Z||l.autoRotation&&((rt=I==null?void 0:I.styles)!=null&&rt.width))&&(ot=Z)),ot&&I&&(this.shortenLabel?this.shortenLabel():I.css(zc({},{width:Math.floor(ot)+"px",lineClamp:+!l.isRadial})))}moveLabel(B,l){let f=this,g=f.label,b=f.axis,w=!1,A;g&&g.textStr===B?(f.movedLabel=g,w=!0,delete f.label):Fl(b.ticks,function(C){w||C.isNew||C===f||!C.label||C.label.textStr!==B||(f.movedLabel=C.label,w=!0,C.labelPos=f.movedLabel.xy,delete C.label)}),!w&&(f.labelPos||g)&&(A=f.labelPos||g.xy,f.movedLabel=f.createLabel(B,l,A),f.movedLabel&&f.movedLabel.attr({opacity:0}))}render(B,l,f){var J;let g=this.axis,b=g.horiz,w=this.pos,A=Pr(this.tickmarkOffset,g.tickmarkOffset),C=this.getPosition(b,w,A,l),I=C.x,R=C.y,U=g.pos,F=U+g.len,G=b?I:R,Z=Pr(f,(J=this.label)==null?void 0:J.newOpacity,1);!g.chart.polar&&(Dc(G)<U||G>F)&&(f=0),f??(f=1),this.isActive=!0,this.renderGridLine(l,f),this.renderMark(C,f),this.renderLabel(C,l,Z,B),this.isNew=!1,sr(this,"afterRender")}renderGridLine(B,l){let f=this.axis,g=f.options,b={},w=this.pos,A=this.type,C=Pr(this.tickmarkOffset,f.tickmarkOffset),I=f.chart.renderer,R=this.gridLine,U,F=g.gridLineWidth,G=g.gridLineColor,Z=g.gridLineDashStyle;this.type==="minor"&&(F=g.minorGridLineWidth,G=g.minorGridLineColor,Z=g.minorGridLineDashStyle),R||(f.chart.styledMode||(b.stroke=G,b["stroke-width"]=F||0,b.dashstyle=Z),A||(b.zIndex=1),B&&(l=0),this.gridLine=R=I.path().attr(b).addClass("highcharts-"+(A?A+"-":"")+"grid-line").add(f.gridGroup)),R&&(U=f.getPlotLinePath({value:w+C,lineWidth:R.strokeWidth(),force:"pass",old:B,acrossPanes:!1}))&&R[B||this.isNew?"attr":"animate"]({d:U,opacity:l})}renderMark(B,l){let f=this.axis,g=f.options,b=f.chart.renderer,w=this.type,A=f.tickSize(w?w+"Tick":"tick"),C=B.x,I=B.y,R=Pr(g[w!=="minor"?"tickWidth":"minorTickWidth"],!w&&f.isXAxis?1:0),U=g[w!=="minor"?"tickColor":"minorTickColor"],F=this.mark,G=!F;A&&(f.opposite&&(A[0]=-A[0]),F||(this.mark=F=b.path().addClass("highcharts-"+(w?w+"-":"")+"tick").add(f.axisGroup),f.chart.styledMode||F.attr({stroke:U,"stroke-width":R})),F[G?"attr":"animate"]({d:this.getMarkPath(C,I,A[0],F.strokeWidth(),f.horiz,b),opacity:l}))}renderLabel(B,l,f,g){let b=this.axis,w=b.horiz,A=b.options,C=this.label,I=A.labels,R=I.step,U=Pr(this.tickmarkOffset,b.tickmarkOffset),F=B.x,G=B.y,Z=!0;C&&Rc(F)&&(C.xy=B=this.getLabelPosition(F,G,C,w,I,U,g,R),(!this.isFirst||this.isLast||A.showFirstLabel)&&(!this.isLast||this.isFirst||A.showLastLabel)?!w||I.step||I.rotation||l||f===0||this.handleOverflow(B):Z=!1,R&&g%R&&(Z=!1),Z&&Rc(B.y)?(B.opacity=f,C[this.isNewLabel?"attr":"animate"](B).show(!0),this.isNewLabel=!1):(C.hide(),this.isNewLabel=!0))}replaceMovedLabel(){let B=this.label,l=this.axis;B&&!this.isNew&&(B.animate({opacity:0},void 0,B.destroy),delete this.label),l.isDirty=!0,this.label=this.movedLabel,delete this.movedLabel}},{animObject:us}=mn,{xAxis:Nl,yAxis:zf}=dm,{defaultOptions:jl}=At,{registerEventOptions:Ul}=Lc,{deg2rad:Of}=kt,{arrayMax:Bc,arrayMin:sa,clamp:Rh,correctFloat:nr,defined:ys,destroyObjectProperties:Vl,erase:Bh,error:sl,extend:wa,fireEvent:js,getClosestDistance:Fc,insertItem:ii,isArray:jr,isNumber:Ai,isString:$l,merge:Ta,normalizeTickInterval:Xn,objectEach:Sa,pick:Hi,relativeLength:Gl,removeEvent:Fh,splat:Rf,syncTimeout:Nh}=_t,nl=(B,l)=>Xn(l,void 0,void 0,Hi(B.options.allowDecimals,l<.5||B.tickAmount!==void 0),!!B.tickAmount);wa(jl,{xAxis:Nl,yAxis:Ta(Nl,zf)});class Ea{constructor(l,f,g){this.init(l,f,g)}init(l,f,g=this.coll){let b=g==="xAxis",w=this.isZAxis||(l.inverted?!b:b);this.chart=l,this.horiz=w,this.isXAxis=b,this.coll=g,js(this,"init",{userOptions:f}),this.opposite=Hi(f.opposite,this.opposite),this.side=Hi(f.side,this.side,w?2*!this.opposite:this.opposite?1:3),this.setOptions(f);let A=this.options,C=A.labels;this.type??(this.type=A.type||"linear"),this.uniqueNames??(this.uniqueNames=A.uniqueNames??!0),js(this,"afterSetType"),this.userOptions=f,this.minPixelPadding=0,this.reversed=Hi(A.reversed,this.reversed),this.visible=A.visible,this.zoomEnabled=A.zoomEnabled,this.hasNames=this.type==="category"||A.categories===!0,this.categories=jr(A.categories)&&A.categories||(this.hasNames?[]:void 0),this.names||(this.names=[],this.names.keys={}),this.plotLinesAndBandsGroups={},this.positiveValuesOnly=!!this.logarithmic,this.isLinked=ys(A.linkedTo),this.ticks={},this.labelEdge=[],this.minorTicks={},this.plotLinesAndBands=[],this.alternateBands={},this.len??(this.len=0),this.minRange=this.userMinRange=A.minRange||A.maxZoom,this.range=A.range,this.offset=A.offset||0,this.max=void 0,this.min=void 0;let I=Hi(A.crosshair,Rf(l.options.tooltip.crosshairs)[+!b]);this.crosshair=I===!0?{}:I,l.axes.indexOf(this)===-1&&(b?l.axes.splice(l.xAxis.length,0,this):l.axes.push(this),ii(this,l[this.coll])),l.orderItems(this.coll),this.series=this.series||[],l.inverted&&!this.isZAxis&&b&&!ys(this.reversed)&&(this.reversed=!0),this.labelRotation=Ai(C.rotation)?C.rotation:void 0,Ul(this,A),js(this,"afterInit")}setOptions(l){let f=this.horiz?{labels:{autoRotation:[-45],padding:3},margin:15}:{labels:{padding:1},title:{rotation:90*this.side}};this.options=Ta(f,this.coll==="yAxis"?{title:{text:this.chart.options.lang.yAxisTitle}}:{},jl[this.coll],l),js(this,"afterSetOptions",{userOptions:l})}defaultLabelFormatter(){let l=this.axis,{numberFormatter:f}=this.chart,g=Ai(this.value)?this.value:NaN,b=l.chart.time,w=l.categories,A=this.dateTimeLabelFormat,C=jl.lang,I=C.numericSymbols,R=C.numericSymbolMagnitude||1e3,U=l.logarithmic?Math.abs(g):l.tickInterval,F=I==null?void 0:I.length,G,Z;if(w)Z=`${this.value}`;else if(A)Z=b.dateFormat(A,g,!0);else if(F&&I&&U>=1e3)for(;F--&&Z===void 0;)U>=(G=Math.pow(R,F+1))&&10*g%G==0&&I[F]!==null&&g!==0&&(Z=f(g/G,-1)+I[F]);return Z===void 0&&(Z=Math.abs(g)>=1e4?f(g,-1):f(g,-1,void 0,"")),Z}getSeriesExtremes(){let l,f=this;js(this,"getSeriesExtremes",null,function(){f.hasVisibleSeries=!1,f.dataMin=f.dataMax=f.threshold=void 0,f.softThreshold=!f.isXAxis,f.series.forEach(g=>{if(g.reserveSpace()){let b=g.options,w,A=b.threshold,C,I;if(f.hasVisibleSeries=!0,f.positiveValuesOnly&&0>=(A||0)&&(A=void 0),f.isXAxis)(w=g.getColumn("x")).length&&(w=f.logarithmic?w.filter(R=>R>0):w,C=(l=g.getXExtremes(w)).min,I=l.max,Ai(C)||C instanceof Date||(w=w.filter(Ai),C=(l=g.getXExtremes(w)).min,I=l.max),w.length&&(f.dataMin=Math.min(Hi(f.dataMin,C),C),f.dataMax=Math.max(Hi(f.dataMax,I),I)));else{let R=g.applyExtremes();Ai(R.dataMin)&&(C=R.dataMin,f.dataMin=Math.min(Hi(f.dataMin,C),C)),Ai(R.dataMax)&&(I=R.dataMax,f.dataMax=Math.max(Hi(f.dataMax,I),I)),ys(A)&&(f.threshold=A),(!b.softThreshold||f.positiveValuesOnly)&&(f.softThreshold=!1)}}})}),js(this,"afterGetSeriesExtremes")}translate(l,f,g,b,w,A){var ot;let C=this.linkedParent||this,I=b&&C.old?C.old.min:C.min;if(!Ai(I))return NaN;let R=C.minPixelPadding,U=(C.isOrdinal||((ot=C.brokenAxis)==null?void 0:ot.hasBreaks)||C.logarithmic&&w)&&C.lin2val,F=1,G=0,Z=b&&C.old?C.old.transA:C.transA,J=0;return Z||(Z=C.transA),g&&(F*=-1,G=C.len),C.reversed&&(F*=-1,G-=F*(C.sector||C.len)),f?(J=(l=l*F+G-R)/Z+I,U&&(J=C.lin2val(J))):(U&&(l=C.val2lin(l)),J=F*(l-I)*Z+G+F*R+(Ai(A)?Z*A:0),C.isRadial||(J=nr(J))),J}toPixels(l,f){var g;return this.translate(((g=this.chart)==null?void 0:g.time.parse(l))??NaN,!1,!this.horiz,void 0,!0)+(f?0:this.pos)}toValue(l,f){return this.translate(l-(f?0:this.pos),!0,!this.horiz,void 0,!0)}getPlotLinePath(l){let f=this,g=f.chart,b=f.left,w=f.top,A=l.old,C=l.value,I=l.lineWidth,R=A&&g.oldChartHeight||g.chartHeight,U=A&&g.oldChartWidth||g.chartWidth,F=f.transB,G=l.translatedValue,Z=l.force,J,ot,rt,it,ct;function dt(Bt,Vt,le){return Z!=="pass"&&(Bt<Vt||Bt>le)&&(Z?Bt=Rh(Bt,Vt,le):ct=!0),Bt}let Ht={value:C,lineWidth:I,old:A,force:Z,acrossPanes:l.acrossPanes,translatedValue:G};return js(this,"getPlotLinePath",Ht,function(Bt){J=rt=(G=Rh(G=Hi(G,f.translate(C,void 0,void 0,A)),-1e9,1e9))+F,ot=it=R-G-F,Ai(G)?f.horiz?(ot=w,it=R-f.bottom+(f.options.isInternal?0:g.scrollablePixelsY||0),J=rt=dt(J,b,b+f.width)):(J=b,rt=U-f.right+(g.scrollablePixelsX||0),ot=it=dt(ot,w,w+f.height)):(ct=!0,Z=!1),Bt.path=ct&&!Z?void 0:g.renderer.crispLine([["M",J,ot],["L",rt,it]],I||1)}),Ht.path}getLinearTickPositions(l,f,g){let b,w,A,C=nr(Math.floor(f/l)*l),I=nr(Math.ceil(g/l)*l),R=[];if(nr(C+l)===C&&(A=20),this.single)return[f];for(b=C;b<=I&&(R.push(b),(b=nr(b+l,A))!==w);)w=b;return R}getMinorTickInterval(){let{minorTicks:l,minorTickInterval:f}=this.options;return l===!0?Hi(f,"auto"):l!==!1?f:void 0}getMinorTickPositions(){var U;let l=this.options,f=this.tickPositions,g=this.minorTickInterval,b=this.pointRangePadding||0,w=(this.min||0)-b,A=(this.max||0)+b,C=(U=this.brokenAxis)!=null&&U.hasBreaks?this.brokenAxis.unitLength:A-w,I=[],R;if(C&&C/g<this.len/3){let F=this.logarithmic;if(F)this.paddedTicks.forEach(function(G,Z,J){Z&&I.push.apply(I,F.getLogTickPositions(g,J[Z-1],J[Z],!0))});else if(this.dateTime&&this.getMinorTickInterval()==="auto")I=I.concat(this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(g),w,A,l.startOfWeek));else for(R=w+(f[0]-w)%g;R<=A&&R!==I[0];R+=g)I.push(R)}return I.length!==0&&this.trimTicks(I),I}adjustForMinRange(){let l=this.options,f=this.logarithmic,g=this.chart.time,{max:b,min:w,minRange:A}=this,C,I,R,U;this.isXAxis&&A===void 0&&!f&&(A=ys(l.min)||ys(l.max)||ys(l.floor)||ys(l.ceiling)?null:Math.min(5*(Fc(this.series.map(F=>{let G=F.getColumn("x");return F.xIncrement?G.slice(0,2):G}))||0),this.dataMax-this.dataMin)),Ai(b)&&Ai(w)&&Ai(A)&&b-w<A&&(I=this.dataMax-this.dataMin>=A,C=(A-b+w)/2,R=[w-C,g.parse(l.min)??w-C],I&&(R[2]=f?f.log2lin(this.dataMin):this.dataMin),U=[(w=Bc(R))+A,g.parse(l.max)??w+A],I&&(U[2]=f?f.log2lin(this.dataMax):this.dataMax),(b=sa(U))-w<A&&(R[0]=b-A,R[1]=g.parse(l.min)??b-A,w=Bc(R))),this.minRange=A,this.min=w,this.max=b}getClosest(){let l,f;if(this.categories)f=1;else{let g=[];this.series.forEach(function(b){let w=b.closestPointRange,A=b.getColumn("x");A.length===1?g.push(A[0]):b.sorted&&ys(w)&&b.reserveSpace()&&(f=ys(f)?Math.min(f,w):w)}),g.length&&(g.sort((b,w)=>b-w),l=Fc([g]))}return l&&f?Math.min(l,f):l||f}nameToX(l){let f=jr(this.options.categories),g=f?this.categories:this.names,b=l.options.x,w;return l.series.requireSorting=!1,ys(b)||(b=this.uniqueNames&&g?f?g.indexOf(l.name):Hi(g.keys[l.name],-1):l.series.autoIncrement()),b===-1?!f&&g&&(w=g.length):Ai(b)&&(w=b),w!==void 0?(this.names[w]=l.name,this.names.keys[l.name]=w):l.x&&(w=l.x),w}updateNames(){let l=this,f=this.names;f.length>0&&(Object.keys(f.keys).forEach(function(g){delete f.keys[g]}),f.length=0,this.minRange=this.userMinRange,(this.series||[]).forEach(g=>{g.xIncrement=null,(!g.points||g.isDirtyData)&&(l.max=Math.max(l.max||0,g.dataTable.rowCount-1),g.processData(),g.generatePoints());let b=g.getColumn("x").slice();g.data.forEach((w,A)=>{let C=b[A];w!=null&&w.options&&w.name!==void 0&&(C=l.nameToX(w))!==void 0&&C!==w.x&&(b[A]=w.x=C)}),g.dataTable.setColumn("x",b)}))}setAxisTranslation(){var G;let l=this,f=l.max-l.min,g=l.linkedParent,b=!!l.categories,w=l.isXAxis,A=l.axisPointRange||0,C,I=0,R=0,U,F=l.transA;(w||b||A)&&(C=l.getClosest(),g?(I=g.minPointOffset,R=g.pointRangePadding):l.series.forEach(function(Z){let J=b?1:w?Hi(Z.options.pointRange,C,0):l.axisPointRange||0,ot=Z.options.pointPlacement;if(A=Math.max(A,J),!l.single||b){let rt=Z.is("xrange")?!w:w;I=Math.max(I,rt&&$l(ot)?0:J/2),R=Math.max(R,rt&&ot==="on"?0:J)}}),U=(G=l.ordinal)!=null&&G.slope&&C?l.ordinal.slope/C:1,l.minPointOffset=I*=U,l.pointRangePadding=R*=U,l.pointRange=Math.min(A,l.single&&b?1:f),w&&(l.closestPointRange=C)),l.translationSlope=l.transA=F=l.staticScale||l.len/(f+R||1),l.transB=l.horiz?l.left:l.bottom,l.minPixelPadding=F*I,js(this,"afterSetAxisTranslation")}minFromRange(){let{max:l,min:f}=this;return Ai(l)&&Ai(f)&&l-f||void 0}setTickInterval(l){var ri,Ii,hi,Li;let{categories:f,chart:g,dataMax:b,dataMin:w,dateTime:A,isXAxis:C,logarithmic:I,options:R,softThreshold:U}=this,F=g.time,G=Ai(this.threshold)?this.threshold:void 0,Z=this.minRange||0,{ceiling:J,floor:ot,linkedTo:rt,softMax:it,softMin:ct}=R,dt=Ai(rt)&&((ri=g[this.coll])==null?void 0:ri[rt]),Ht=R.tickPixelInterval,Bt=R.maxPadding,Vt=R.minPadding,le=0,Kt,ce=Ai(R.tickInterval)&&R.tickInterval>=0?R.tickInterval:void 0,Ee,Be,$e,Ae;if(A||f||dt||this.getTickAmount(),$e=Hi(this.userMin,F.parse(R.min)),Ae=Hi(this.userMax,F.parse(R.max)),dt?(this.linkedParent=dt,Kt=dt.getExtremes(),this.min=Hi(Kt.min,Kt.dataMin),this.max=Hi(Kt.max,Kt.dataMax),this.type!==dt.type&&sl(11,!0,g)):(U&&ys(G)&&Ai(b)&&Ai(w)&&(w>=G?(Ee=G,Vt=0):b<=G&&(Be=G,Bt=0)),this.min=Hi($e,Ee,w),this.max=Hi(Ae,Be,b)),Ai(this.max)&&Ai(this.min)&&(I&&(this.positiveValuesOnly&&!l&&0>=Math.min(this.min,Hi(w,this.min))&&sl(10,!0,g),this.min=nr(I.log2lin(this.min),16),this.max=nr(I.log2lin(this.max),16)),this.range&&Ai(w)&&(this.userMin=this.min=$e=Math.max(w,this.minFromRange()||0),this.userMax=Ae=this.max,this.range=void 0)),js(this,"foundExtremes"),this.adjustForMinRange(),Ai(this.min)&&Ai(this.max)){if(!Ai(this.userMin)&&Ai(ct)&&ct<this.min&&(this.min=$e=ct),!Ai(this.userMax)&&Ai(it)&&it>this.max&&(this.max=Ae=it),f||this.axisPointRange||(Ii=this.stacking)!=null&&Ii.usePercentage||dt||!(le=this.max-this.min)||(!ys($e)&&Vt&&(this.min-=le*Vt),ys(Ae)||!Bt||(this.max+=le*Bt)),!Ai(this.userMin)&&Ai(ot)&&(this.min=Math.max(this.min,ot)),!Ai(this.userMax)&&Ai(J)&&(this.max=Math.min(this.max,J)),U&&Ai(w)&&Ai(b)){let as=G||0;!ys($e)&&this.min<as&&w>=as?this.min=R.minRange?Math.min(as,this.max-Z):as:!ys(Ae)&&this.max>as&&b<=as&&(this.max=R.minRange?Math.max(as,this.min+Z):as)}!g.polar&&this.min>this.max&&(ys(R.min)?this.max=this.min:ys(R.max)&&(this.min=this.max)),le=this.max-this.min}if(this.min!==this.max&&Ai(this.min)&&Ai(this.max)?dt&&!ce&&Ht===dt.options.tickPixelInterval?this.tickInterval=ce=dt.tickInterval:this.tickInterval=Hi(ce,this.tickAmount?le/Math.max(this.tickAmount-1,1):void 0,f?1:le*Ht/Math.max(this.len,Ht)):this.tickInterval=1,C&&!l){let as=this.min!==((hi=this.old)==null?void 0:hi.min)||this.max!==((Li=this.old)==null?void 0:Li.max);this.series.forEach(function(Zi){var ds;Zi.forceCrop=(ds=Zi.forceCropping)==null?void 0:ds.call(Zi),Zi.processData(as)}),js(this,"postProcessData",{hasExtremesChanged:as})}this.setAxisTranslation(),js(this,"initialAxisTranslation"),this.pointRange&&!ce&&(this.tickInterval=Math.max(this.pointRange,this.tickInterval));let Je=Hi(R.minTickInterval,A&&!this.series.some(as=>!as.sorted)?this.closestPointRange:0);!ce&&Je&&this.tickInterval<Je&&(this.tickInterval=Je),A||I||ce||(this.tickInterval=nl(this,this.tickInterval)),this.tickAmount||(this.tickInterval=this.unsquish()),this.setTickPositions()}setTickPositions(){var U,F;let l=this.options,f=l.tickPositions,g=l.tickPositioner,b=this.getMinorTickInterval(),w=!this.isPanning,A=w&&l.startOnTick,C=w&&l.endOnTick,I=[],R;if(this.tickmarkOffset=this.categories&&l.tickmarkPlacement==="between"&&this.tickInterval===1?.5:0,this.single=this.min===this.max&&ys(this.min)&&!this.tickAmount&&(this.min%1==0||l.allowDecimals!==!1),f)I=f.slice();else if(Ai(this.min)&&Ai(this.max)){if(!((U=this.ordinal)!=null&&U.positions)&&(this.max-this.min)/this.tickInterval>Math.max(2*this.len,200))I=[this.min,this.max],sl(19,!1,this.chart);else if(this.dateTime)I=this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(this.tickInterval,l.units),this.min,this.max,l.startOfWeek,(F=this.ordinal)==null?void 0:F.positions,this.closestPointRange,!0);else if(this.logarithmic)I=this.logarithmic.getLogTickPositions(this.tickInterval,this.min,this.max);else{let G=this.tickInterval,Z=G;for(;Z<=2*G&&(I=this.getLinearTickPositions(this.tickInterval,this.min,this.max),this.tickAmount&&I.length>this.tickAmount);)this.tickInterval=nl(this,Z*=1.1)}I.length>this.len&&(I=[I[0],I[I.length-1]])[0]===I[1]&&(I.length=1),g&&(this.tickPositions=I,(R=g.apply(this,[this.min,this.max]))&&(I=R))}this.tickPositions=I,this.minorTickInterval=b==="auto"&&this.tickInterval?this.tickInterval/l.minorTicksPerMajor:b,this.paddedTicks=I.slice(0),this.trimTicks(I,A,C),!this.isLinked&&Ai(this.min)&&Ai(this.max)&&(this.single&&I.length<2&&!this.categories&&!this.series.some(G=>G.is("heatmap")&&G.options.pointPlacement==="between")&&(this.min-=.5,this.max+=.5),f||R||this.adjustTickAmount()),js(this,"afterSetTickPositions")}trimTicks(l,f,g){let b=l[0],w=l[l.length-1],A=!this.isOrdinal&&this.minPointOffset||0;if(js(this,"trimTicks"),!this.isLinked||!this.grid){if(f&&b!==-1/0)this.min=b;else for(;this.min-A>l[0];)l.shift();if(g)this.max=w;else for(;this.max+A<l[l.length-1];)l.pop();l.length===0&&ys(b)&&!this.options.tickPositions&&l.push((w+b)/2)}}alignToOthers(){let l,f=this,g=f.chart,b=[this],w=f.options,A=g.options.chart,C=this.coll==="yAxis"&&A.alignThresholds,I=[];if(f.thresholdAlignment=void 0,(A.alignTicks!==!1&&w.alignTicks||C)&&w.startOnTick!==!1&&w.endOnTick!==!1&&!f.logarithmic){let R=F=>{let{horiz:G,options:Z}=F;return[G?Z.left:Z.top,Z.width,Z.height,Z.pane].join(",")},U=R(this);g[this.coll].forEach(function(F){let{series:G}=F;G.length&&G.some(Z=>Z.visible)&&F!==f&&R(F)===U&&(l=!0,b.push(F))})}if(l&&C){b.forEach(U=>{let F=U.getThresholdAlignment(f);Ai(F)&&I.push(F)});let R=I.length>1?I.reduce((U,F)=>U+=F,0)/I.length:void 0;b.forEach(U=>{U.thresholdAlignment=R})}return l}getThresholdAlignment(l){if((!Ai(this.dataMin)||this!==l&&this.series.some(f=>f.isDirty||f.isDirtyData))&&this.getSeriesExtremes(),Ai(this.threshold)){let f=Rh((this.threshold-(this.dataMin||0))/((this.dataMax||0)-(this.dataMin||0)),0,1);return this.options.reversed&&(f=1-f),f}}getTickAmount(){let l=this.options,f=l.tickPixelInterval,g=l.tickAmount;ys(l.tickInterval)||g||!(this.len<f)||this.isRadial||this.logarithmic||!l.startOnTick||!l.endOnTick||(g=2),!g&&this.alignToOthers()&&(g=Math.ceil(this.len/f)+1),g<4&&(this.finalTickAmt=g,g=5),this.tickAmount=g}adjustTickAmount(){let l=this,{finalTickAmt:f,max:g,min:b,options:w,tickPositions:A,tickAmount:C,thresholdAlignment:I}=l,R=A==null?void 0:A.length,U=Hi(l.threshold,l.softThreshold?0:null),F,G,Z=l.tickInterval,J,ot=()=>A.push(nr(A[A.length-1]+Z)),rt=()=>A.unshift(nr(A[0]-Z));if(Ai(I)&&(J=I<.5?Math.ceil(I*(C-1)):Math.floor(I*(C-1)),w.reversed&&(J=C-1-J)),l.hasData()&&Ai(b)&&Ai(g)){let it=()=>{l.transA*=(R-1)/(C-1),l.min=w.startOnTick?A[0]:Math.min(b,A[0]),l.max=w.endOnTick?A[A.length-1]:Math.max(g,A[A.length-1])};if(Ai(J)&&Ai(l.threshold)){for(;A[J]!==U||A.length!==C||A[0]>b||A[A.length-1]<g;){for(A.length=0,A.push(l.threshold);A.length<C;)A[J]===void 0||A[J]>l.threshold?rt():ot();if(Z>8*l.tickInterval)break;Z*=2}it()}else if(R<C){for(;A.length<C;)A.length%2||b===U?ot():rt();it()}if(ys(f)){for(G=F=A.length;G--;)(f===3&&G%2==1||f<=2&&G>0&&G<F-1)&&A.splice(G,1);l.finalTickAmt=void 0}}}setScale(){var A,C,I,R,U;let{coll:l,stacking:f}=this,g=!1,b=!1;this.series.forEach(F=>{var G;g=g||F.isDirtyData||F.isDirty,b=b||((G=F.xAxis)==null?void 0:G.isDirty)||!1}),this.setAxisSize();let w=this.len!==((A=this.old)==null?void 0:A.len);w||g||b||this.isLinked||this.forceRedraw||this.userMin!==((C=this.old)==null?void 0:C.userMin)||this.userMax!==((I=this.old)==null?void 0:I.userMax)||this.alignToOthers()?(f&&l==="yAxis"&&f.buildStacks(),this.forceRedraw=!1,this.userMinRange||(this.minRange=void 0),this.getSeriesExtremes(),this.setTickInterval(),f&&l==="xAxis"&&f.buildStacks(),this.isDirty||(this.isDirty=w||this.min!==((R=this.old)==null?void 0:R.min)||this.max!==((U=this.old)==null?void 0:U.max))):f&&f.cleanStacks(),g&&delete this.allExtremes,js(this,"afterSetScale")}setExtremes(l,f,g=!0,b,w){let A=this.chart;this.series.forEach(C=>{delete C.kdTree}),l=A.time.parse(l),f=A.time.parse(f),js(this,"setExtremes",w=wa(w,{min:l,max:f}),C=>{this.userMin=C.min,this.userMax=C.max,this.eventArgs=C,g&&A.redraw(b)})}setAxisSize(){let l=this.chart,f=this.options,g=f.offsets||[0,0,0,0],b=this.horiz,w=this.width=Math.round(Gl(Hi(f.width,l.plotWidth-g[3]+g[1]),l.plotWidth)),A=this.height=Math.round(Gl(Hi(f.height,l.plotHeight-g[0]+g[2]),l.plotHeight)),C=this.top=Math.round(Gl(Hi(f.top,l.plotTop+g[0]),l.plotHeight,l.plotTop)),I=this.left=Math.round(Gl(Hi(f.left,l.plotLeft+g[3]),l.plotWidth,l.plotLeft));this.bottom=l.chartHeight-A-C,this.right=l.chartWidth-w-I,this.len=Math.max(b?w:A,0),this.pos=b?I:C}getExtremes(){let l=this.logarithmic;return{min:l?nr(l.lin2log(this.min)):this.min,max:l?nr(l.lin2log(this.max)):this.max,dataMin:this.dataMin,dataMax:this.dataMax,userMin:this.userMin,userMax:this.userMax}}getThreshold(l){let f=this.logarithmic,g=f?f.lin2log(this.min):this.min,b=f?f.lin2log(this.max):this.max;return l===null||l===-1/0?l=g:l===1/0?l=b:g>l?l=g:b<l&&(l=b),this.translate(l,0,1,0,1)}autoLabelAlign(l){let f=(Hi(l,0)-90*this.side+720)%360,g={align:"center"};return js(this,"autoLabelAlign",g,function(b){f>15&&f<165?b.align="right":f>195&&f<345&&(b.align="left")}),g.align}tickSize(l){let f=this.options,g=Hi(f[l==="tick"?"tickWidth":"minorTickWidth"],l==="tick"&&this.isXAxis&&!this.categories?1:0),b=f[l==="tick"?"tickLength":"minorTickLength"],w;g&&b&&(f[l+"Position"]==="inside"&&(b=-b),w=[b,g]);let A={tickSize:w};return js(this,"afterTickSize",A),A.tickSize}labelMetrics(){let l=this.chart.renderer,f=this.ticks,g=f[Object.keys(f)[0]]||{};return this.chart.renderer.fontMetrics(g.label||g.movedLabel||l.box)}unsquish(){let l=this.options.labels,f=l.padding||0,g=this.horiz,b=this.tickInterval,w=this.len/((+!!this.categories+this.max-this.min)/b),A=l.rotation,C=nr(.8*this.labelMetrics().h),I=Math.max(this.max-this.min,0),R=function(J){let ot=(J+2*f)/(w||1);return(ot=ot>1?Math.ceil(ot):1)*b>I&&J!==1/0&&w!==1/0&&I&&(ot=Math.ceil(I/b)),nr(ot*b)},U=b,F,G=Number.MAX_VALUE,Z;if(g){if(!l.staggerLines&&(Ai(A)?Z=[A]:w<l.autoRotationLimit&&(Z=l.autoRotation)),Z){let J,ot;for(let rt of Z)(rt===A||rt&&rt>=-90&&rt<=90)&&(ot=(J=R(Math.abs(C/Math.sin(Of*rt))))+Math.abs(rt/360))<G&&(G=ot,F=rt,U=J)}}else U=R(.75*C);return this.autoRotation=Z,this.labelRotation=Hi(F,Ai(A)?A:0),l.step?b:U}getSlotWidth(l){let f=this.chart,g=this.horiz,b=this.options.labels,w=Math.max(this.tickPositions.length-+!this.categories,1),A=f.margin[3];if(l&&Ai(l.slotWidth))return l.slotWidth;if(g&&b.step<2&&!this.isRadial)return b.rotation?0:(this.staggerLines||1)*this.len/w;if(!g){let C=b.style.width;if(C!==void 0)return parseInt(String(C),10);if(A)return A-f.spacing[3]}return .33*f.chartWidth}renderUnsquish(){let l=this.chart,f=l.renderer,g=this.tickPositions,b=this.ticks,w=this.options.labels,A=w.style,C=this.horiz,I=this.getSlotWidth(),R=Math.max(1,Math.round(I-(C?2*(w.padding||0):w.distance||0))),U={},F=this.labelMetrics(),G=A.lineClamp,Z,J=G??(Math.floor(this.len/(g.length*F.h))||1),ot=0;$l(w.rotation)||(U.rotation=w.rotation||0),g.forEach(function(rt){var dt;let it=b[rt];it.movedLabel&&it.replaceMovedLabel();let ct=((dt=it.label)==null?void 0:dt.textPxLength)||0;ct>ot&&(ot=ct)}),this.maxLabelLength=ot,this.autoRotation?ot>R&&ot>F.h?U.rotation=this.labelRotation:this.labelRotation=0:I&&(Z=R),U.rotation&&(Z=ot>.5*l.chartHeight?.33*l.chartHeight:ot,G||(J=1)),this.labelAlign=w.align||this.autoLabelAlign(this.labelRotation),this.labelAlign&&(U.align=this.labelAlign),g.forEach(function(rt){let it=b[rt],ct=it==null?void 0:it.label,dt=A.width,Ht={};ct&&(ct.attr(U),it.shortenLabel?it.shortenLabel():Z&&!dt&&A.whiteSpace!=="nowrap"&&(Z<(ct.textPxLength||0)||ct.element.tagName==="SPAN")?ct.css(wa(Ht,{width:`${Z}px`,lineClamp:J})):!ct.styles.width||Ht.width||dt||ct.css({width:"auto"}),it.rotation=U.rotation)},this),this.tickRotCorr=f.rotCorr(F.b,this.labelRotation||0,this.side!==0)}hasData(){return this.series.some(function(l){return l.hasData()})||this.options.showEmpty&&ys(this.min)&&ys(this.max)}addTitle(l){let f,g=this.chart.renderer,b=this.horiz,w=this.opposite,A=this.options.title,C=this.chart.styledMode;this.axisTitle||((f=A.textAlign)||(f=(b?{low:"left",middle:"center",high:"right"}:{low:w?"right":"left",middle:"center",high:w?"left":"right"})[A.align]),this.axisTitle=g.text(A.text||"",0,0,A.useHTML).attr({zIndex:7,rotation:A.rotation||0,align:f}).addClass("highcharts-axis-title"),C||this.axisTitle.css(Ta(A.style)),this.axisTitle.add(this.axisGroup),this.axisTitle.isNew=!0),C||A.style.width||this.isRadial||this.axisTitle.css({width:this.len+"px"}),this.axisTitle[l?"show":"hide"](l)}generateTick(l){let f=this.ticks;f[l]?f[l].addLabel():f[l]=new ia(this,l)}createGroups(){let{axisParent:l,chart:f,coll:g,options:b}=this,w=f.renderer,A=(C,I,R)=>w.g(C).attr({zIndex:R}).addClass(`highcharts-${g.toLowerCase()}${I} `+(this.isRadial?`highcharts-radial-axis${I} `:"")+(b.className||"")).add(l);this.axisGroup||(this.gridGroup=A("grid","-grid",b.gridZIndex),this.axisGroup=A("axis","",b.zIndex),this.labelGroup=A("axis-labels","-labels",b.labels.zIndex))}getOffset(){let l=this,{chart:f,horiz:g,options:b,side:w,ticks:A,tickPositions:C,coll:I}=l,R=f.inverted&&!l.isZAxis?[1,0,3,2][w]:w,U=l.hasData(),F=b.title,G=b.labels,Z=Ai(b.crossing),J=f.axisOffset,ot=f.clipOffset,rt=[-1,1,1,-1][w],it,ct=0,dt,Ht=0,Bt=0,Vt,le;if(l.showAxis=it=U||b.showEmpty,l.staggerLines=l.horiz&&G.staggerLines||void 0,l.createGroups(),U||l.isLinked?(C.forEach(function(Kt){l.generateTick(Kt)}),l.renderUnsquish(),l.reserveSpaceDefault=w===0||w===2||{1:"left",3:"right"}[w]===l.labelAlign,Hi(G.reserveSpace,!Z&&null,l.labelAlign==="center"||null,l.reserveSpaceDefault)&&C.forEach(function(Kt){Bt=Math.max(A[Kt].getLabelSize(),Bt)}),l.staggerLines&&(Bt*=l.staggerLines),l.labelOffset=Bt*(l.opposite?-1:1)):Sa(A,function(Kt,ce){Kt.destroy(),delete A[ce]}),F!=null&&F.text&&F.enabled!==!1&&(l.addTitle(it),it&&!Z&&F.reserveSpace!==!1&&(l.titleOffset=ct=l.axisTitle.getBBox()[g?"height":"width"],Ht=ys(dt=F.offset)?0:Hi(F.margin,g?5:10))),l.renderLine(),l.offset=rt*Hi(b.offset,J[w]?J[w]+(b.margin||0):0),l.tickRotCorr=l.tickRotCorr||{x:0,y:0},le=w===0?-l.labelMetrics().h:w===2?l.tickRotCorr.y:0,Vt=Math.abs(Bt)+Ht,Bt&&(Vt-=le,Vt+=rt*(g?Hi(G.y,l.tickRotCorr.y+rt*G.distance):Hi(G.x,rt*G.distance))),l.axisTitleMargin=Hi(dt,Vt),l.getMaxLabelDimensions&&(l.maxLabelDimensions=l.getMaxLabelDimensions(A,C)),I!=="colorAxis"&&ot){let Kt=this.tickSize("tick");J[w]=Math.max(J[w],(l.axisTitleMargin||0)+ct+rt*l.offset,Vt,C!=null&&C.length&&Kt?Kt[0]+rt*l.offset:0);let ce=!l.axisLine||b.offset?0:l.axisLine.strokeWidth()/2;ot[R]=Math.max(ot[R],ce)}js(this,"afterGetOffset")}getLinePath(l){let f=this.chart,g=this.opposite,b=this.offset,w=this.horiz,A=this.left+(g?this.width:0)+b,C=f.chartHeight-this.bottom-(g?this.height:0)+b;return g&&(l*=-1),f.renderer.crispLine([["M",w?this.left:A,w?C:this.top],["L",w?f.chartWidth-this.right:A,w?C:f.chartHeight-this.bottom]],l)}renderLine(){this.axisLine||(this.axisLine=this.chart.renderer.path().addClass("highcharts-axis-line").add(this.axisGroup),this.chart.styledMode||this.axisLine.attr({stroke:this.options.lineColor,"stroke-width":this.options.lineWidth,zIndex:7}))}getTitlePosition(l){let f=this.horiz,g=this.left,b=this.top,w=this.len,A=this.options.title,C=f?g:b,I=this.opposite,R=this.offset,U=A.x,F=A.y,G=this.chart.renderer.fontMetrics(l),Z=l?Math.max(l.getBBox(!1,0).height-G.h-1,0):0,J={low:C+(f?0:w),middle:C+w/2,high:C+(f?w:0)}[A.align],ot=(f?b+this.height:g)+(f?1:-1)*(I?-1:1)*(this.axisTitleMargin||0)+[-Z,Z,G.f,-Z][this.side],rt={x:f?J+U:ot+(I?this.width:0)+R+U,y:f?ot+F-(I?this.height:0)+R:J+F};return js(this,"afterGetTitlePosition",{titlePosition:rt}),rt}renderMinorTick(l,f){let g=this.minorTicks;g[l]||(g[l]=new ia(this,l,"minor")),f&&g[l].isNew&&g[l].render(null,!0),g[l].render(null,!1,1)}renderTick(l,f,g){var A;let b=this.isLinked,w=this.ticks;(!b||l>=this.min&&l<=this.max||(A=this.grid)!=null&&A.isColumn)&&(w[l]||(w[l]=new ia(this,l)),g&&w[l].isNew&&w[l].render(f,!0,-1),w[l].render(f))}render(){let l,f,g=this,b=g.chart,w=g.logarithmic,A=b.renderer,C=g.options,I=g.isLinked,R=g.tickPositions,U=g.axisTitle,F=g.ticks,G=g.minorTicks,Z=g.alternateBands,J=C.stackLabels,ot=C.alternateGridColor,rt=C.crossing,it=g.tickmarkOffset,ct=g.axisLine,dt=g.showAxis,Ht=us(A.globalAnimation);if(g.labelEdge.length=0,g.overlap=!1,[F,G,Z].forEach(function(Bt){Sa(Bt,function(Vt){Vt.isActive=!1})}),Ai(rt)){let Bt=this.isXAxis?b.yAxis[0]:b.xAxis[0],Vt=[1,-1,-1,1][this.side];if(Bt){let le=Bt.toPixels(rt,!0);g.horiz&&(le=Bt.len-le),g.offset=Vt*le}}if(g.hasData()||I){let Bt=g.chart.hasRendered&&g.old&&Ai(g.old.min);g.minorTickInterval&&!g.categories&&g.getMinorTickPositions().forEach(function(Vt){g.renderMinorTick(Vt,Bt)}),R.length&&(R.forEach(function(Vt,le){g.renderTick(Vt,le,Bt)}),it&&(g.min===0||g.single)&&(F[-1]||(F[-1]=new ia(g,-1,null,!0)),F[-1].render(-1))),ot&&R.forEach(function(Vt,le){f=R[le+1]!==void 0?R[le+1]+it:g.max-it,le%2==0&&Vt<g.max&&f<=g.max+(b.polar?-it:it)&&(Z[Vt]||(Z[Vt]=new kt.PlotLineOrBand(g,{})),l=Vt+it,Z[Vt].options={from:w?w.lin2log(l):l,to:w?w.lin2log(f):f,color:ot,className:"highcharts-alternate-grid"},Z[Vt].render(),Z[Vt].isActive=!0)}),g._addedPlotLB||(g._addedPlotLB=!0,(C.plotLines||[]).concat(C.plotBands||[]).forEach(function(Vt){g.addPlotBandOrLine(Vt)}))}[F,G,Z].forEach(function(Bt){let Vt=[],le=Ht.duration;Sa(Bt,function(Kt,ce){Kt.isActive||(Kt.render(ce,!1,0),Kt.isActive=!1,Vt.push(ce))}),Nh(function(){let Kt=Vt.length;for(;Kt--;)Bt[Vt[Kt]]&&!Bt[Vt[Kt]].isActive&&(Bt[Vt[Kt]].destroy(),delete Bt[Vt[Kt]])},Bt!==Z&&b.hasRendered&&le?le:0)}),ct&&(ct[ct.isPlaced?"animate":"attr"]({d:this.getLinePath(ct.strokeWidth())}),ct.isPlaced=!0,ct[dt?"show":"hide"](dt)),U&&dt&&(U[U.isNew?"attr":"animate"](g.getTitlePosition(U)),U.isNew=!1),J!=null&&J.enabled&&g.stacking&&g.stacking.renderStackTotals(),g.old={len:g.len,max:g.max,min:g.min,transA:g.transA,userMax:g.userMax,userMin:g.userMin},g.isDirty=!1,js(this,"afterRender")}redraw(){this.visible&&(this.render(),this.plotLinesAndBands.forEach(function(l){l.render()})),this.series.forEach(function(l){l.isDirty=!0})}getKeepProps(){return this.keepProps||Ea.keepProps}destroy(l){let f=this,g=f.plotLinesAndBands,b=this.eventOptions;if(js(this,"destroy",{keepEvents:l}),l||Fh(f),[f.ticks,f.minorTicks,f.alternateBands].forEach(function(w){Vl(w)}),g){let w=g.length;for(;w--;)g[w].destroy()}for(let w in["axisLine","axisTitle","axisGroup","gridGroup","labelGroup","cross","scrollbar"].forEach(function(A){f[A]&&(f[A]=f[A].destroy())}),f.plotLinesAndBandsGroups)f.plotLinesAndBandsGroups[w]=f.plotLinesAndBandsGroups[w].destroy();Sa(f,function(w,A){f.getKeepProps().indexOf(A)===-1&&delete f[A]}),this.eventOptions=b}drawCrosshair(l,f){var F;let g=this.crosshair,b=(g==null?void 0:g.snap)??!0,w=this.chart,A,C,I,R=this.cross,U;if(js(this,"drawCrosshair",{e:l,point:f}),l||(l=(F=this.cross)==null?void 0:F.e),g&&(ys(f)||!b)!==!1){if(b?ys(f)&&(C=Hi(this.coll!=="colorAxis"?f.crosshairPos:null,this.isXAxis?f.plotX:this.len-f.plotY)):C=l&&(this.horiz?l.chartX-this.pos:this.len-l.chartY+this.pos),ys(C)&&(U={value:f&&(this.isXAxis?f.x:Hi(f.stackY,f.y)),translatedValue:C},w.polar&&wa(U,{isCrosshair:!0,chartX:l==null?void 0:l.chartX,chartY:l==null?void 0:l.chartY,point:f}),A=this.getPlotLinePath(U)||null),!ys(A)){this.hideCrosshair();return}I=this.categories&&!this.isRadial,R||(this.cross=R=w.renderer.path().addClass("highcharts-crosshair highcharts-crosshair-"+(I?"category ":"thin ")+(g.className||"")).attr({zIndex:Hi(g.zIndex,2)}).add(),!w.styledMode&&(R.attr({stroke:g.color||(I?Qt.parse("#ccd3ff").setOpacity(.25).get():"#cccccc"),"stroke-width":Hi(g.width,1)}).css({"pointer-events":"none"}),g.dashStyle&&R.attr({dashstyle:g.dashStyle}))),R.show().attr({d:A}),I&&!g.width&&R.attr({"stroke-width":this.transA}),this.cross.e=l}else this.hideCrosshair();js(this,"afterDrawCrosshair",{e:l,point:f})}hideCrosshair(){this.cross&&this.cross.hide(),js(this,"afterHideCrosshair")}update(l,f){let g=this.chart;l=Ta(this.userOptions,l),this.destroy(!0),this.init(g,l),g.isDirtyBox=!0,Hi(f,!0)&&g.redraw()}remove(l){let f=this.chart,g=this.coll,b=this.series,w=b.length;for(;w--;)b[w]&&b[w].remove(!1);Bh(f.axes,this),Bh(f[g]||[],this),f.orderItems(g),this.destroy(),f.isDirtyBox=!0,Hi(l,!0)&&f.redraw()}setTitle(l,f){this.update({title:l},f)}setCategories(l,f){this.update({categories:l},f)}}Ea.keepProps=["coll","extKey","hcEvents","len","names","series","userMax","userMin"];let{addEvent:_m,getMagnitude:Bf,normalizeTickInterval:Wl,timeUnits:Hl}=_t;(function(B){function l(){return this.chart.time.getTimeTicks.apply(this.chart.time,arguments)}function f(){if(this.type!=="datetime"){this.dateTime=void 0;return}this.dateTime||(this.dateTime=new g(this))}B.compose=function(b){return b.keepProps.includes("dateTime")||(b.keepProps.push("dateTime"),b.prototype.getTimeTicks=l,_m(b,"afterSetType",f)),b};class g{constructor(w){this.axis=w}normalizeTimeTickInterval(w,A){let C=A||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]],I=C[C.length-1],R=Hl[I[0]],U=I[1],F;for(F=0;F<C.length&&(R=Hl[(I=C[F])[0]],U=I[1],!C[F+1]||!(w<=(R*U[U.length-1]+Hl[C[F+1][0]])/2));F++);R===Hl.year&&w<5*R&&(U=[1,2,5]);let G=Wl(w/R,U,I[0]==="year"?Math.max(Bf(w/R),1):1);return{unitRange:R,count:G,unitName:I[0]}}getXDateFormat(w,A){let{axis:C}=this,I=C.chart.time;return C.closestPointRange?I.getDateFormat(C.closestPointRange,w,C.options.startOfWeek,A)||I.resolveDTLFormat(A.year).main:I.resolveDTLFormat(A.day).main}}B.Additions=g})(z||(z={}));let ad=z,{addEvent:jh,normalizeTickInterval:Uh,pick:Nc}=_t;(function(B){function l(){this.type!=="logarithmic"?this.logarithmic=void 0:this.logarithmic??(this.logarithmic=new g(this))}function f(){let b=this.logarithmic;b&&(this.lin2val=function(w){return b.lin2log(w)},this.val2lin=function(w){return b.log2lin(w)})}B.compose=function(b){return b.keepProps.includes("logarithmic")||(b.keepProps.push("logarithmic"),jh(b,"afterSetType",l),jh(b,"afterInit",f)),b};class g{constructor(w){this.axis=w}getLogTickPositions(w,A,C,I){let R=this.axis,U=R.len,F=R.options,G=[];if(I||(this.minorAutoInterval=void 0),w>=.5)w=Math.round(w),G=R.getLinearTickPositions(w,A,C);else if(w>=.08){let Z,J,ot,rt,it,ct,dt,Ht=Math.floor(A);for(Z=w>.3?[1,2,4]:w>.15?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9],J=Ht;J<C+1&&!dt;J++)for(ot=0,rt=Z.length;ot<rt&&!dt;ot++)(it=this.log2lin(this.lin2log(J)*Z[ot]))>A&&(!I||ct<=C)&&ct!==void 0&&G.push(ct),ct>C&&(dt=!0),ct=it}else{let Z=this.lin2log(A),J=this.lin2log(C),ot=I?R.getMinorTickInterval():F.tickInterval,rt=F.tickPixelInterval/(I?5:1),it=I?U/R.tickPositions.length:U;w=Uh(w=Nc(ot==="auto"?null:ot,this.minorAutoInterval,(J-Z)*rt/(it||1))),G=R.getLinearTickPositions(w,Z,J).map(this.log2lin),I||(this.minorAutoInterval=w/5)}return I||(R.tickInterval=w),G}lin2log(w){return Math.pow(10,w)}log2lin(w){return Math.log(w)/Math.LN10}}B.Additions=g})($||($={}));let jc=$,{erase:ld,extend:Ff,isNumber:Vh}=_t;(function(B){let l;function f(R){return this.addPlotBandOrLine(R,"plotBands")}function g(R,U){let F=this.userOptions,G=new l(this,R);if(this.visible&&(G=G.render()),G){if(this._addedPlotLB||(this._addedPlotLB=!0,(F.plotLines||[]).concat(F.plotBands||[]).forEach(Z=>{this.addPlotBandOrLine(Z)})),U){let Z=F[U]||[];Z.push(R),F[U]=Z}this.plotLinesAndBands.push(G)}return G}function b(R){return this.addPlotBandOrLine(R,"plotLines")}function w(R,U,F){F=F||this.options;let G=this.getPlotLinePath({value:U,force:!0,acrossPanes:F.acrossPanes}),Z=[],J=this.horiz,ot=!Vh(this.min)||!Vh(this.max)||R<this.min&&U<this.min||R>this.max&&U>this.max,rt=this.getPlotLinePath({value:R,force:!0,acrossPanes:F.acrossPanes}),it,ct=1,dt;if(rt&&G)for(ot&&(dt=rt.toString()===G.toString(),ct=0),it=0;it<rt.length;it+=2){let Ht=rt[it],Bt=rt[it+1],Vt=G[it],le=G[it+1];(Ht[0]==="M"||Ht[0]==="L")&&(Bt[0]==="M"||Bt[0]==="L")&&(Vt[0]==="M"||Vt[0]==="L")&&(le[0]==="M"||le[0]==="L")&&(J&&Vt[1]===Ht[1]?(Vt[1]+=ct,le[1]+=ct):J||Vt[2]!==Ht[2]||(Vt[2]+=ct,le[2]+=ct),Z.push(["M",Ht[1],Ht[2]],["L",Bt[1],Bt[2]],["L",le[1],le[2]],["L",Vt[1],Vt[2]],["Z"])),Z.isFlat=dt}return Z}function A(R){this.removePlotBandOrLine(R)}function C(R){let U=this.plotLinesAndBands,F=this.options,G=this.userOptions;if(U){let Z=U.length;for(;Z--;)U[Z].id===R&&U[Z].destroy();[F.plotLines||[],G.plotLines||[],F.plotBands||[],G.plotBands||[]].forEach(function(J){var ot;for(Z=J.length;Z--;)((ot=J[Z])==null?void 0:ot.id)===R&&ld(J,J[Z])})}}function I(R){this.removePlotBandOrLine(R)}B.compose=function(R,U){let F=U.prototype;return F.addPlotBand||(l=R,Ff(F,{addPlotBand:f,addPlotLine:b,addPlotBandOrLine:g,getPlotBandPath:w,removePlotBand:A,removePlotLine:I,removePlotBandOrLine:C})),U}})(q||(q={}));let Nf=q,{addEvent:Ma,arrayMax:cd,arrayMin:hd,defined:Io,destroyObjectProperties:jf,erase:ud,fireEvent:Uf,merge:dd,objectEach:rr,pick:ym}=_t;class Uc{static compose(l,f){return Ma(l,"afterInit",function(){this.labelCollectors.push(()=>{var b;let g=[];for(let w of this.axes)for(let{label:A,options:C}of w.plotLinesAndBands)A&&!((b=C==null?void 0:C.label)!=null&&b.allowOverlap)&&g.push(A);return g})}),Nf.compose(Uc,f)}constructor(l,f){this.axis=l,this.options=f,this.id=f.id}render(){Uf(this,"render");let{axis:l,options:f}=this,{horiz:g,logarithmic:b}=l,{color:w,events:A,zIndex:C=0}=f,{renderer:I,time:R}=l.chart,U={},F=R.parse(f.to),G=R.parse(f.from),Z=R.parse(f.value),J=f.borderWidth,ot=f.label,{label:rt,svgElem:it}=this,ct=[],dt,Ht=Io(G)&&Io(F),Bt=Io(Z),Vt=!it,le={class:"highcharts-plot-"+(Ht?"band ":"line ")+(f.className||"")},Kt=Ht?"bands":"lines";if(!l.chart.styledMode&&(Bt?(le.stroke=w||"#999999",le["stroke-width"]=ym(f.width,1),f.dashStyle&&(le.dashstyle=f.dashStyle)):Ht&&(le.fill=w||"#e6e9ff",J&&(le.stroke=f.borderColor,le["stroke-width"]=J))),U.zIndex=C,Kt+="-"+C,(dt=l.plotLinesAndBandsGroups[Kt])||(l.plotLinesAndBandsGroups[Kt]=dt=I.g("plot-"+Kt).attr(U).add()),it||(this.svgElem=it=I.path().attr(le).add(dt)),Io(Z))ct=l.getPlotLinePath({value:(b==null?void 0:b.log2lin(Z))??Z,lineWidth:it.strokeWidth(),acrossPanes:f.acrossPanes});else{if(!(Io(G)&&Io(F)))return;ct=l.getPlotBandPath((b==null?void 0:b.log2lin(G))??G,(b==null?void 0:b.log2lin(F))??F,f)}return!this.eventsAdded&&A&&(rr(A,(ce,Ee)=>{it==null||it.on(Ee,Be=>{A[Ee].apply(this,[Be])})}),this.eventsAdded=!0),(Vt||!it.d)&&(ct!=null&&ct.length)?it.attr({d:ct}):it&&(ct?(it.show(),it.animate({d:ct})):it.d&&(it.hide(),rt&&(this.label=rt=rt.destroy()))),ot&&(Io(ot.text)||Io(ot.formatter))&&(ct!=null&&ct.length)&&l.width>0&&l.height>0&&!ct.isFlat?(ot=dd({align:g&&Ht?"center":void 0,x:g?!Ht&&4:10,verticalAlign:!g&&Ht?"middle":void 0,y:g?Ht?16:10:Ht?6:-4,rotation:g&&!Ht?90:0,...Ht?{inside:!0}:{}},ot),this.renderLabel(ot,ct,Ht,C)):rt&&rt.hide(),this}renderLabel(l,f,g,b){var J;let w=this.axis,A=w.chart.renderer,C=l.inside,I=this.label;I||(this.label=I=A.text(this.getLabelText(l),0,0,l.useHTML).attr({align:l.textAlign||l.align,rotation:l.rotation,class:"highcharts-plot-"+(g?"band":"line")+"-label "+(l.className||""),zIndex:b}),w.chart.styledMode||I.css(dd({fontSize:"0.8em",textOverflow:g&&!C?"":"ellipsis"},l.style)),I.add());let R=f.xBounds||[f[0][1],f[1][1],g?f[2][1]:f[0][1]],U=f.yBounds||[f[0][2],f[1][2],g?f[2][2]:f[0][2]],F=hd(R),G=hd(U),Z=cd(R)-F;I.align(l,!1,{x:F,y:G,width:Z,height:cd(U)-G}),I.alignAttr.y-=A.fontMetrics(I).b,(!I.alignValue||I.alignValue==="left"||Io(C))&&I.css({width:(((J=l.style)==null?void 0:J.width)||(g&&C?Z:I.rotation===90?w.height-(I.alignAttr.y-w.top):(l.clip?w.width:w.chart.chartWidth)-(I.alignAttr.x-w.left)))+"px"}),I.show(!0)}getLabelText(l){return Io(l.formatter)?l.formatter.call(this):l.text}destroy(){ud(this.axis.plotLinesAndBands,this),delete this.axis,jf(this)}}let{animObject:xm}=mn,{format:Vf}=ir,{composed:Ur,dateFormats:$f,doc:Gf,isSafari:lo}=kt,{distribute:Lo}=xa,{addEvent:rl,clamp:na,css:oi,discardElement:fd,extend:pd,fireEvent:ol,getAlignFactor:Aa,isArray:Ze,isNumber:md,isObject:vm,isString:$h,merge:gd,pick:al,pushUnique:Wf,splat:_d,syncTimeout:bm}=_t;class Vc{constructor(l,f,g){this.allowShared=!0,this.crosshairs=[],this.distance=0,this.isHidden=!0,this.isSticky=!1,this.options={},this.outside=!1,this.chart=l,this.init(l,f),this.pointer=g}bodyFormatter(l){return l.map(f=>{let g=f.series.tooltipOptions,b=f.formatPrefix||"point";return(g[b+"Formatter"]||f.tooltipFormatter).call(f,g[b+"Format"]||"")})}cleanSplit(l){this.chart.series.forEach(function(f){let g=f==null?void 0:f.tt;g&&(!g.isActive||l?f.tt=g.destroy():g.isActive=!1)})}defaultFormatter(l){let f,g=this.points||_d(this);return(f=(f=[l.headerFooterFormatter(g[0])]).concat(l.bodyFormatter(g))).push(l.headerFooterFormatter(g[0],!0)),f}destroy(){this.label&&(this.label=this.label.destroy()),this.split&&(this.cleanSplit(!0),this.tt&&(this.tt=this.tt.destroy())),this.renderer&&(this.renderer=this.renderer.destroy(),fd(this.container)),_t.clearTimeout(this.hideTimer)}getAnchor(l,f){var R;let g,{chart:b,pointer:w}=this,A=b.inverted,C=b.plotTop,I=b.plotLeft;if(l=_d(l),(R=l[0].series)!=null&&R.yAxis&&!l[0].series.yAxis.options.reversedStacks&&(l=l.slice().reverse()),this.followPointer&&f)f.chartX===void 0&&(f=w.normalize(f)),g=[f.chartX-I,f.chartY-C];else if(l[0].tooltipPos)g=l[0].tooltipPos;else{let U=0,F=0;l.forEach(function(G){let Z=G.pos(!0);Z&&(U+=Z[0],F+=Z[1])}),U/=l.length,F/=l.length,this.shared&&l.length>1&&f&&(A?U=f.chartX:F=f.chartY),g=[U-I,F-C]}return g.map(Math.round)}getClassName(l,f,g){let b=this.options,w=l.series,A=w.options;return[b.className,"highcharts-label",g&&"highcharts-tooltip-header",f?"highcharts-tooltip-box":"highcharts-tooltip",!g&&"highcharts-color-"+al(l.colorIndex,w.colorIndex),A==null?void 0:A.className].filter($h).join(" ")}getLabel({anchorX:l,anchorY:f}={anchorX:0,anchorY:0}){let g=this,b=this.chart.styledMode,w=this.options,A=this.split&&this.allowShared,C=this.container,I=this.chart.renderer;if(this.label){let R=!this.label.hasClass("highcharts-label");(!A&&R||A&&!R)&&this.destroy()}if(!this.label){if(this.outside){let R=this.chart,U=R.options.chart.style,F=io.getRendererType();this.container=C=kt.doc.createElement("div"),C.className="highcharts-tooltip-container "+(R.renderTo.className.match(/(highcharts[a-zA-Z0-9-]+)\s?/gm)||""),oi(C,{position:"absolute",top:"1px",pointerEvents:"none",zIndex:Math.max(this.options.style.zIndex||0,((U==null?void 0:U.zIndex)||0)+3)}),this.renderer=I=new F(C,0,0,U,void 0,void 0,I.styledMode)}if(A?this.label=I.g("tooltip"):(this.label=I.label("",l,f,w.shape||"callout",void 0,void 0,w.useHTML,void 0,"tooltip").attr({padding:w.padding,r:w.borderRadius}),b||this.label.attr({fill:w.backgroundColor,"stroke-width":w.borderWidth||0}).css(w.style).css({pointerEvents:w.style.pointerEvents||(this.shouldStickOnContact()?"auto":"none")})),g.outside){let R=this.label;[R.xSetter,R.ySetter].forEach((U,F)=>{R[F?"ySetter":"xSetter"]=G=>{U.call(R,g.distance),R[F?"y":"x"]=G,C&&(C.style[F?"top":"left"]=`${G}px`)}})}this.label.attr({zIndex:8}).shadow(w.shadow??!w.fixed).add()}return C&&!C.parentElement&&kt.doc.body.appendChild(C),this.label}getPlayingField(){let{body:l,documentElement:f}=Gf,{chart:g,distance:b,outside:w}=this;return{width:w?Math.max(l.scrollWidth,f.scrollWidth,l.offsetWidth,f.offsetWidth,f.clientWidth)-2*b-2:g.chartWidth,height:w?Math.max(l.scrollHeight,f.scrollHeight,l.offsetHeight,f.offsetHeight,f.clientHeight):g.chartHeight}}getPosition(l,f,g){var ri,Ii;let{distance:b,chart:w,outside:A,pointer:C}=this,{inverted:I,plotLeft:R,plotTop:U,polar:F}=w,{plotX:G=0,plotY:Z=0}=g,J={},ot=I&&g.h||0,{height:rt,width:it}=this.getPlayingField(),ct=C.getChartPosition(),dt=hi=>hi*ct.scaleX,Ht=hi=>hi*ct.scaleY,Bt=hi=>{let Li=hi==="x";return[hi,Li?it:rt,Li?l:f].concat(A?[Li?dt(l):Ht(f),Li?ct.left-b+dt(G+R):ct.top-b+Ht(Z+U),0,Li?it:rt]:[Li?l:f,Li?G+R:Z+U,Li?R:U,Li?R+w.plotWidth:U+w.plotHeight])},Vt=Bt("y"),le=Bt("x"),Kt,ce=!!g.negative;!F&&((Ii=(ri=w.hoverSeries)==null?void 0:ri.yAxis)!=null&&Ii.reversed)&&(ce=!ce);let Ee=!this.followPointer&&al(g.ttBelow,!F&&!I===ce),Be=function(hi,Li,as,Zi,ds,gr,ls){let Ms=A?hi==="y"?Ht(b):dt(b):b,Bi=(as-Zi)/2,si=Zi<ds-b,xn=ds+b+Zi<Li,As=ds-Ms-as+Bi,$s=ds+Ms-Bi;if(Ee&&xn)J[hi]=$s;else if(!Ee&&si)J[hi]=As;else if(si)J[hi]=Math.min(ls-Zi,As-ot<0?As:As-ot);else{if(!xn)return J[hi]=0,!1;J[hi]=Math.max(gr,$s+ot+as>Li?$s:$s+ot)}},$e=function(hi,Li,as,Zi,ds){if(ds<b||ds>Li-b)return!1;ds<as/2?J[hi]=1:ds>Li-Zi/2?J[hi]=Li-Zi-2:J[hi]=ds-as/2},Ae=function(hi){[Vt,le]=[le,Vt],Kt=hi},Je=()=>{Be.apply(0,Vt)!==!1?$e.apply(0,le)!==!1||Kt||(Ae(!0),Je()):Kt?J.x=J.y=0:(Ae(!0),Je())};return(I&&!F||this.len>1)&&Ae(),Je(),J}getFixedPosition(l,f,g){var G;let b=g.series,{chart:w,options:A,split:C}=this,I=A.position,R=I.relativeTo,U=A.shared||(G=b==null?void 0:b.yAxis)!=null&&G.isRadial&&(R==="pane"||!R)?"plotBox":R,F=U==="chart"?w.renderer:w[U]||w.getClipBox(b,!0);return{x:F.x+(F.width-l)*Aa(I.align)+I.x,y:F.y+(F.height-f)*Aa(I.verticalAlign)+(!C&&I.y||0)}}hide(l){let f=this;_t.clearTimeout(this.hideTimer),l=al(l,this.options.hideDelay),this.isHidden||(this.hideTimer=bm(function(){let g=f.getLabel();f.getLabel().animate({opacity:0},{duration:l&&150,complete:()=>{g.hide(),f.container&&f.container.remove()}}),f.isHidden=!0},l))}init(l,f){this.chart=l,this.options=f,this.crosshairs=[],this.isHidden=!0,this.split=f.split&&!l.inverted&&!l.polar,this.shared=f.shared||this.split,this.outside=al(f.outside,!!(l.scrollablePixelsX||l.scrollablePixelsY))}shouldStickOnContact(l){return!!(!this.followPointer&&this.options.stickOnContact&&(!l||this.pointer.inClass(l.target,"highcharts-tooltip")))}move(l,f,g,b){let{followPointer:w,options:A}=this,C=xm(!w&&!this.isHidden&&!A.fixed&&A.animation),I=w||(this.len||0)>1,R={x:l,y:f};I?R.anchorX=R.anchorY=NaN:(R.anchorX=g,R.anchorY=b),C.step=()=>this.drawTracker(),this.getLabel().animate(R,C)}refresh(l,f){let{chart:g,options:b,pointer:w,shared:A}=this,C=_d(l),I=C[0],R=b.format,U=b.formatter||this.defaultFormatter,F=g.styledMode,G=this.allowShared;if(!b.enabled||!I.series)return;_t.clearTimeout(this.hideTimer),this.allowShared=!(!Ze(l)&&l.series&&l.series.noSharedTooltip),G=G&&!this.allowShared,this.followPointer=!this.split&&I.series.tooltipOptions.followPointer;let Z=this.getAnchor(l,f),J=Z[0],ot=Z[1];A&&this.allowShared&&(w.applyInactiveState(C),C.forEach(ct=>ct.setState("hover")),I.points=C),this.len=C.length;let rt=$h(R)?Vf(R,I,g):U.call(I,this);I.points=void 0;let it=I.series;if(this.distance=al(it.tooltipOptions.distance,16),rt===!1)this.hide();else{if(this.split&&this.allowShared)this.renderSplit(rt,C);else{let ct=J,dt=ot;if(f&&w.isDirectTouch&&(ct=f.chartX-g.plotLeft,dt=f.chartY-g.plotTop),g.polar||it.options.clip===!1||C.some(Ht=>w.isDirectTouch||Ht.series.shouldShowTooltip(ct,dt))){let Ht=this.getLabel(G&&this.tt||{});(!b.style.width||F)&&Ht.css({width:(this.outside?this.getPlayingField():g.spacingBox).width+"px"}),Ht.attr({class:this.getClassName(I),text:rt&&rt.join?rt.join(""):rt}),this.outside&&Ht.attr({x:na(Ht.x||0,0,this.getPlayingField().width-(Ht.width||0)-1)}),F||Ht.attr({stroke:b.borderColor||I.color||it.color||"#666666"}),this.updatePosition({plotX:J,plotY:ot,negative:I.negative,ttBelow:I.ttBelow,series:it,h:Z[2]||0})}else{this.hide();return}}this.isHidden&&this.label&&this.label.attr({opacity:1}).show(),this.isHidden=!1}ol(this,"refresh")}renderSplit(l,f){var ds,gr;let g=this,{chart:b,chart:{chartWidth:w,chartHeight:A,plotHeight:C,plotLeft:I,plotTop:R,scrollablePixelsY:U=0,scrollablePixelsX:F,styledMode:G},distance:Z,options:J,options:{fixed:ot,position:rt,positioner:it},pointer:ct}=g,{scrollLeft:dt=0,scrollTop:Ht=0}=((ds=b.scrollablePlotArea)==null?void 0:ds.scrollingContainer)||{},Bt=g.outside&&typeof F!="number"?Gf.documentElement.getBoundingClientRect():{left:dt,right:dt+w},Vt=g.getLabel(),le=this.renderer||b.renderer,Kt=!!((gr=b.xAxis[0])!=null&&gr.opposite),{left:ce,top:Ee}=ct.getChartPosition(),Be=it||ot,$e=R+Ht,Ae=0,Je=C-U,ri=function(ls,Ms,Bi,si=[0,0],xn=!0){let As,$s;if(Bi.isHeader)$s=Kt?0:Je,As=na(si[0]-ls/2,Bt.left,Bt.right-ls-(g.outside?ce:0));else if(ot&&Bi){let Ks=g.getFixedPosition(ls,Ms,Bi);As=Ks.x,$s=Ks.y-$e}else $s=si[1]-$e,As=na(As=xn?si[0]-ls-Z:si[0]+Z,xn?As:Bt.left,Bt.right);return{x:As,y:$s}};$h(l)&&(l=[!1,l]);let Ii=l.slice(0,f.length+1).reduce(function(ls,Ms,Bi){if(Ms!==!1&&Ms!==""){let si=f[Bi-1]||{isHeader:!0,plotX:f[0].plotX,plotY:C,series:{}},xn=si.isHeader,As=xn?g:si.series,$s=As.tt=function(Dr,Rn,Kd){let nc=Dr,{isHeader:Kc,series:Jd}=Rn,pa=Jd.tooltipOptions||J;if(!nc){let lu={padding:pa.padding,r:pa.borderRadius};G||(lu.fill=pa.backgroundColor,lu["stroke-width"]=pa.borderWidth??(ot&&!Kc?0:1)),nc=le.label("",0,0,pa[Kc?"headerShape":"shape"]||(ot&&!Kc?"rect":"callout"),void 0,void 0,pa.useHTML).addClass(g.getClassName(Rn,!0,Kc)).attr(lu).add(Vt)}return nc.isActive=!0,nc.attr({text:Kd}),G||nc.css(pa.style).attr({stroke:pa.borderColor||Rn.color||Jd.color||"#333333"}),nc}(As.tt,si,Ms.toString()),Ks=$s.getBBox(),Xr=Ks.width+$s.strokeWidth();xn&&(Ae=Ks.height,Je+=Ae,Kt&&($e-=Ae));let{anchorX:mo,anchorY:Fo}=function(Dr){let Rn,Kd,{isHeader:nc,plotX:Kc=0,plotY:Jd=0,series:pa}=Dr;if(nc)Rn=Math.max(I+Kc,I),Kd=R+C/2;else{let{xAxis:lu,yAxis:Qd}=pa;Rn=lu.pos+na(Kc,-Z,lu.len+Z),pa.shouldShowTooltip(0,Qd.pos-R+Jd,{ignoreX:!0})&&(Kd=Qd.pos+Jd)}return{anchorX:Rn=na(Rn,Bt.left-Z,Bt.right+Z),anchorY:Kd}}(si);if(typeof Fo=="number"){let Dr=Ks.height+1,Rn=(it||ri).call(g,Xr,Dr,si,[mo,Fo]);ls.push({align:Be?0:void 0,anchorX:mo,anchorY:Fo,boxWidth:Xr,point:si,rank:al(Rn.rank,+!!xn),size:Dr,target:Rn.y,tt:$s,x:Rn.x})}else $s.isActive=!1}return ls},[]);!Be&&Ii.some(ls=>{let{outside:Ms}=g,Bi=(Ms?ce:0)+ls.anchorX;return Bi<Bt.left&&Bi+ls.boxWidth<Bt.right||Bi<ce-Bt.left+ls.boxWidth&&Bt.right-Bi>Bi})&&(Ii=Ii.map(ls=>{let{x:Ms,y:Bi}=ri.call(this,ls.boxWidth,ls.size,ls.point,[ls.anchorX,ls.anchorY],!1);return pd(ls,{target:Bi,x:Ms})})),g.cleanSplit(),Lo(Ii,Je);let hi={left:ce,right:ce};Ii.forEach(function(ls){let{x:Ms,boxWidth:Bi,isHeader:si}=ls;!si&&(g.outside&&ce+Ms<hi.left&&(hi.left=ce+Ms),!si&&g.outside&&hi.left+Bi>hi.right&&(hi.right=ce+Ms))}),Ii.forEach(function(ls){let{x:Ms,anchorX:Bi,anchorY:si,pos:xn,point:{isHeader:As}}=ls,$s={visibility:xn===void 0?"hidden":"inherit",x:Ms,y:(xn||0)+$e+(ot&&rt.y||0),anchorX:Bi,anchorY:si};if(g.outside&&Ms<Bi){let Ks=ce-hi.left;Ks>0&&(As||($s.x=Ms+Ks,$s.anchorX=Bi+Ks),As&&($s.x=(hi.right-hi.left)/2,$s.anchorX=Bi+Ks))}ls.tt.attr($s)});let{container:Li,outside:as,renderer:Zi}=g;if(as&&Li&&Zi){let{width:ls,height:Ms,x:Bi,y:si}=Vt.getBBox();Zi.setSize(ls+Bi,Ms+si,!1),Li.style.left=hi.left+"px",Li.style.top=Ee+"px"}lo&&Vt.attr({opacity:Vt.opacity===1?.999:1})}drawTracker(){if(!this.shouldStickOnContact()){this.tracker&&(this.tracker=this.tracker.destroy());return}let l=this.chart,f=this.label,g=this.shared?l.hoverPoints:l.hoverPoint;if(!f||!g)return;let b={x:0,y:0,width:0,height:0},w=this.getAnchor(g),A=f.getBBox();w[0]+=l.plotLeft-(f.translateX||0),w[1]+=l.plotTop-(f.translateY||0),b.x=Math.min(0,w[0]),b.y=Math.min(0,w[1]),b.width=w[0]<0?Math.max(Math.abs(w[0]),A.width-w[0]):Math.max(Math.abs(w[0]),A.width),b.height=w[1]<0?Math.max(Math.abs(w[1]),A.height-Math.abs(w[1])):Math.max(Math.abs(w[1]),A.height),this.tracker?this.tracker.attr(b):(this.tracker=f.renderer.rect(b).addClass("highcharts-tracker").add(f),l.styledMode||this.tracker.attr({fill:"rgba(0,0,0,0)"}))}styledModeFormat(l){return l.replace('style="font-size: 0.8em"','class="highcharts-header"').replace(/style="color:{(point|series)\.color}"/g,'class="highcharts-color-{$1.colorIndex} {series.options.className} {point.options.className}"')}headerFooterFormatter(l,f){let g=l.series,b=g.tooltipOptions,w=g.xAxis,A=w==null?void 0:w.dateTime,C={isFooter:f,point:l},I=b.xDateFormat||"",R=b[f?"footerFormat":"headerFormat"];return ol(this,"headerFormatter",C,function(U){if(A&&!I&&md(l.key)&&(I=A.getXDateFormat(l.key,b.dateTimeLabelFormats)),A&&I){if(vm(I)){let F=I;$f[0]=G=>g.chart.time.dateFormat(F,G),I="%0"}(l.tooltipDateKeys||["key"]).forEach(F=>{R=R.replace(RegExp("point\\."+F+"([ \\)}])"),`(point.${F}:${I})$1`)})}g.chart.styledMode&&(R=this.styledModeFormat(R)),U.text=Vf(R,l,this.chart)}),C.text||""}update(l){this.destroy(),this.init(this.chart,gd(!0,this.options,l))}updatePosition(l){var Bt;let{chart:f,container:g,distance:b,options:w,pointer:A,renderer:C}=this,{height:I=0,width:R=0}=this.getLabel(),{fixed:U,positioner:F}=w,{left:G,top:Z,scaleX:J,scaleY:ot}=A.getChartPosition(),rt=(F||U&&this.getFixedPosition||this.getPosition).call(this,R,I,l),it=kt.doc,ct=(l.plotX||0)+f.plotLeft,dt=(l.plotY||0)+f.plotTop,Ht;if(C&&g){if(F||U){let{scrollLeft:Vt=0,scrollTop:le=0}=((Bt=f.scrollablePlotArea)==null?void 0:Bt.scrollingContainer)||{};rt.x+=Vt+G-b,rt.y+=le+Z-b}Ht=(w.borderWidth||0)+2*b+2,C.setSize(na(R+Ht,0,it.documentElement.clientWidth)-1,I+Ht,!1),(J!==1||ot!==1)&&(oi(g,{transform:`scale(${J}, ${ot})`}),ct*=J,dt*=ot),ct+=G-rt.x,dt+=Z-rt.y}this.move(Math.round(rt.x),Math.round(rt.y||0),ct,dt)}}(function(B){B.compose=function(l){Wf(Ur,"Core.Tooltip")&&rl(l,"afterInit",function(){let f=this.chart;f.options.tooltip&&(f.tooltip=new B(f,f.options.tooltip,this))})}})(Vc||(Vc={}));let Gh=Vc,{animObject:yd}=mn,{defaultOptions:Xl}=At,{format:m}=ir,{addEvent:r,crisp:u,erase:y,extend:S,fireEvent:M,getNestedProperty:D,isArray:O,isFunction:j,isNumber:H,isObject:X,merge:tt,pick:ht,syncTimeout:pt,removeEvent:gt,uniqueKey:mt}=_t;class xt{animateBeforeDestroy(){let l=this,f={x:l.startXPos,opacity:0},g=l.getGraphicalProps();g.singular.forEach(function(b){l[b]=l[b].animate(b==="dataLabel"?{x:l[b].startXPos,y:l[b].startYPos,opacity:0}:f)}),g.plural.forEach(function(b){l[b].forEach(function(w){w.element&&w.animate(S({x:l.startXPos},w.startYPos?{x:w.startXPos,y:w.startYPos}:{}))})})}applyOptions(l,f){let g=this.series,b=g.options.pointValKey||g.pointValKey;return S(this,l=xt.prototype.optionsToObject.call(this,l)),this.options=this.options?S(this.options,l):l,l.group&&delete this.group,l.dataLabels&&delete this.dataLabels,b&&(this.y=xt.prototype.getNestedProperty.call(this,b)),this.selected&&(this.state="select"),"name"in this&&f===void 0&&g.xAxis&&g.xAxis.hasNames&&(this.x=g.xAxis.nameToX(this)),this.x===void 0&&g?this.x=f??g.autoIncrement():H(l.x)&&g.options.relativeXValue?this.x=g.autoIncrement(l.x):typeof this.x=="string"&&(f??(f=g.chart.time.parse(this.x)),H(f)&&(this.x=f)),this.isNull=this.isValid&&!this.isValid(),this.formatPrefix=this.isNull?"null":"point",this}destroy(){if(!this.destroyed){let l=this,f=l.series,g=f.chart,b=f.options.dataSorting,w=g.hoverPoints,A=yd(l.series.chart.renderer.globalAnimation),C=()=>{for(let I in(l.graphic||l.graphics||l.dataLabel||l.dataLabels)&&(gt(l),l.destroyElements()),l)delete l[I]};l.legendItem&&g.legend.destroyItem(l),w&&(l.setState(),y(w,l),w.length||(g.hoverPoints=null)),l===g.hoverPoint&&l.onMouseOut(),b!=null&&b.enabled?(this.animateBeforeDestroy(),pt(C,A.duration)):C(),g.pointCount--}this.destroyed=!0}destroyElements(l){let f=this,g=f.getGraphicalProps(l);g.singular.forEach(function(b){f[b]=f[b].destroy()}),g.plural.forEach(function(b){f[b].forEach(function(w){w!=null&&w.element&&w.destroy()}),delete f[b]})}firePointEvent(l,f,g){let b=this,w=this.series.options;b.manageEvent(l),l==="click"&&w.allowPointSelect&&(g=function(A){!b.destroyed&&b.select&&b.select(null,A.ctrlKey||A.metaKey||A.shiftKey)}),M(b,l,f,g)}getClassName(){var l;return"highcharts-point"+(this.selected?" highcharts-point-select":"")+(this.negative?" highcharts-negative":"")+(this.isNull?" highcharts-null-point":"")+(this.colorIndex!==void 0?" highcharts-color-"+this.colorIndex:"")+(this.options.className?" "+this.options.className:"")+((l=this.zone)!=null&&l.className?" "+this.zone.className.replace("highcharts-negative",""):"")}getGraphicalProps(l){let f,g,b=this,w=[],A={singular:[],plural:[]};for((l=l||{graphic:1,dataLabel:1}).graphic&&w.push("graphic","connector"),l.dataLabel&&w.push("dataLabel","dataLabelPath","dataLabelUpper"),g=w.length;g--;)b[f=w[g]]&&A.singular.push(f);return["graphic","dataLabel"].forEach(function(C){let I=C+"s";l[C]&&b[I]&&A.plural.push(I)}),A}getNestedProperty(l){return l?l.indexOf("custom.")===0?D(l,this.options):this[l]:void 0}getZone(){let l=this.series,f=l.zones,g=l.zoneAxis||"y",b,w=0;for(b=f[0];this[g]>=b.value;)b=f[++w];return this.nonZonedColor||(this.nonZonedColor=this.color),b!=null&&b.color&&!this.options.color?this.color=b.color:this.color=this.nonZonedColor,b}hasNewShapeType(){return(this.graphic&&(this.graphic.symbolName||this.graphic.element.nodeName))!==this.shapeType}constructor(l,f,g){this.formatPrefix="point",this.visible=!0,this.point=this,this.series=l,this.applyOptions(f,g),this.id??(this.id=mt()),this.resolveColor(),this.dataLabelOnNull??(this.dataLabelOnNull=l.options.nullInteraction),l.chart.pointCount++,M(this,"afterInit")}isValid(){return(H(this.x)||this.x instanceof Date)&&H(this.y)}optionsToObject(l){var U;let f=this.series,g=f.options.keys,b=g||f.pointArrayMap||["y"],w=b.length,A={},C,I=0,R=0;if(H(l)||l===null)A[b[0]]=l;else if(O(l))for(!g&&l.length>w&&((C=typeof l[0])=="string"?(U=f.xAxis)!=null&&U.dateTime?A.x=f.chart.time.parse(l[0]):A.name=l[0]:C==="number"&&(A.x=l[0]),I++);R<w;)g&&l[I]===void 0||(b[R].indexOf(".")>0?xt.prototype.setNestedProperty(A,l[I],b[R]):A[b[R]]=l[I]),I++,R++;else typeof l=="object"&&(A=l,l.dataLabels&&(f.hasDataLabels=()=>!0),l.marker&&(f._hasPointMarkers=!0));return A}pos(l,f=this.plotY){if(!this.destroyed){let{plotX:g,series:b}=this,{chart:w,xAxis:A,yAxis:C}=b,I=0,R=0;if(H(g)&&H(f))return l&&(I=A?A.pos:w.plotLeft,R=C?C.pos:w.plotTop),w.inverted&&A&&C?[C.len-f+R,A.len-g+I]:[g+I,f+R]}}resolveColor(){let l=this.series,f=l.chart.options.chart,g=l.chart.styledMode,b,w,A=f.colorCount,C;delete this.nonZonedColor,l.options.colorByPoint?(g||(b=(w=l.options.colors||l.chart.options.colors)[l.colorCounter],A=w.length),C=l.colorCounter,l.colorCounter++,l.colorCounter===A&&(l.colorCounter=0)):(g||(b=l.color),C=l.colorIndex),this.colorIndex=ht(this.options.colorIndex,C),this.color=ht(this.options.color,b)}setNestedProperty(l,f,g){return g.split(".").reduce(function(b,w,A,C){let I=C.length-1===A;return b[w]=I?f:X(b[w],!0)?b[w]:{},b[w]},l),l}shouldDraw(){return!this.isNull}tooltipFormatter(l){var I;let{chart:f,pointArrayMap:g=["y"],tooltipOptions:b}=this.series,{valueDecimals:w="",valuePrefix:A="",valueSuffix:C=""}=b;return f.styledMode&&(l=((I=f.tooltip)==null?void 0:I.styledModeFormat(l))||l),g.forEach(R=>{R="{point."+R,(A||C)&&(l=l.replace(RegExp(R+"}","g"),A+R+"}"+C)),l=l.replace(RegExp(R+"}","g"),R+":,."+w+"f}")}),m(l,this,f)}update(l,f,g,b){let w,A=this,C=A.series,I=A.graphic,R=C.chart,U=C.options;function F(){A.applyOptions(l);let G=I&&A.hasMockGraphic,Z=A.y===null?!G:G;I&&Z&&(A.graphic=I.destroy(),delete A.hasMockGraphic),X(l,!0)&&(I!=null&&I.element&&l&&l.marker&&l.marker.symbol!==void 0&&(A.graphic=I.destroy()),l!=null&&l.dataLabels&&A.dataLabel&&(A.dataLabel=A.dataLabel.destroy())),w=A.index;let J={};for(let ot of C.dataColumnKeys())J[ot]=A[ot];C.dataTable.setRow(J,w),U.data[w]=X(U.data[w],!0)||X(l,!0)?A.options:ht(l,U.data[w]),C.isDirty=C.isDirtyData=!0,!C.fixedBox&&C.hasCartesianSeries&&(R.isDirtyBox=!0),U.legendType==="point"&&(R.isDirtyLegend=!0),f&&R.redraw(g)}f=ht(f,!0),b===!1?F():A.firePointEvent("update",{options:l},F)}remove(l,f){this.series.removePoint(this.series.data.indexOf(this),l,f)}select(l,f){let g=this,b=g.series,w=b.chart;l=ht(l,!g.selected),this.selectedStaging=l,g.firePointEvent(l?"select":"unselect",{accumulate:f},function(){g.selected=g.options.selected=l,b.options.data[b.data.indexOf(g)]=g.options,g.setState(l&&"select"),f||w.getSelectedPoints().forEach(function(A){let C=A.series;A.selected&&A!==g&&(A.selected=A.options.selected=!1,C.options.data[C.data.indexOf(A)]=A.options,A.setState(w.hoverPoints&&C.options.inactiveOtherPoints?"inactive":""),A.firePointEvent("unselect"))})}),delete this.selectedStaging}onMouseOver(l){let{inverted:f,pointer:g}=this.series.chart;g&&(l=l?g.normalize(l):g.getChartCoordinatesFromPoint(this,f),g.runPointActions(l,this))}onMouseOut(){let l=this.series.chart;this.firePointEvent("mouseOut"),this.series.options.inactiveOtherPoints||(l.hoverPoints||[]).forEach(function(f){f.setState()}),l.hoverPoints=l.hoverPoint=null}manageEvent(l){var b,w,A,C,I,R,U;let f=tt(this.series.options.point,this.options),g=(b=f.events)==null?void 0:b[l];j(g)&&(!((w=this.hcEvents)!=null&&w[l])||((C=(A=this.hcEvents)==null?void 0:A[l])==null?void 0:C.map(F=>F.fn).indexOf(g))===-1)?((I=this.importedUserEvent)==null||I.call(this),this.importedUserEvent=r(this,l,g),this.hcEvents&&(this.hcEvents[l].userEvent=!0)):this.importedUserEvent&&!g&&((R=this.hcEvents)!=null&&R[l])&&((U=this.hcEvents)!=null&&U[l].userEvent)&&(gt(this,l),delete this.hcEvents[l],Object.keys(this.hcEvents)||delete this.importedUserEvent)}setState(l,f){var Vt,le;let g=this.series,b=this.state,w=g.options.states[l||"normal"]||{},A=Xl.plotOptions[g.type].marker&&g.options.marker,C=A&&A.enabled===!1,I=((Vt=A==null?void 0:A.states)==null?void 0:Vt[l||"normal"])||{},R=I.enabled===!1,U=this.marker||{},F=g.chart,G=A&&g.markerAttribs,Z=g.halo,J,ot,rt,it=g.stateMarkerGraphic,ct;if((l=l||"")===this.state&&!f||this.selected&&l!=="select"||w.enabled===!1||l&&(R||C&&I.enabled===!1)||l&&U.states&&U.states[l]&&U.states[l].enabled===!1)return;if(this.state=l,G&&(J=g.markerAttribs(this,l)),this.graphic&&!this.hasMockGraphic){if(b&&this.graphic.removeClass("highcharts-point-"+b),l&&this.graphic.addClass("highcharts-point-"+l),!F.styledMode){ot=g.pointAttribs(this,l),rt=ht(F.options.chart.animation,w.animation);let Kt=ot.opacity;g.options.inactiveOtherPoints&&H(Kt)&&(this.dataLabels||[]).forEach(function(ce){ce&&!ce.hasClass("highcharts-data-label-hidden")&&(ce.animate({opacity:Kt},rt),ce.connector&&ce.connector.animate({opacity:Kt},rt))}),this.graphic.animate(ot,rt)}J&&this.graphic.animate(J,ht(F.options.chart.animation,I.animation,A.animation)),it&&it.hide()}else l&&I&&(ct=U.symbol||g.symbol,it&&it.currentSymbol!==ct&&(it=it.destroy()),J&&(it?it[f?"animate":"attr"]({x:J.x,y:J.y}):ct&&(g.stateMarkerGraphic=it=F.renderer.symbol(ct,J.x,J.y,J.width,J.height,tt(A,I)).add(g.markerGroup),it.currentSymbol=ct)),!F.styledMode&&it&&this.state!=="inactive"&&it.attr(g.pointAttribs(this,l))),it&&(it[l&&this.isInside?"show":"hide"](),it.element.point=this,it.addClass(this.getClassName(),!0));let dt=w.halo,Ht=this.graphic||it,Bt=(Ht==null?void 0:Ht.visibility)||"inherit";dt!=null&&dt.size&&Ht&&Bt!=="hidden"&&!this.isCluster?(Z||(g.halo=Z=F.renderer.path().add(Ht.parentGroup)),Z.show()[f?"animate":"attr"]({d:this.haloPath(dt.size)}),Z.attr({class:"highcharts-halo highcharts-color-"+ht(this.colorIndex,g.colorIndex)+(this.className?" "+this.className:""),visibility:Bt,zIndex:-1}),Z.point=this,F.styledMode||Z.attr(S({fill:this.color||g.color,"fill-opacity":dt.opacity},Is.filterUserAttributes(dt.attributes||{})))):(le=Z==null?void 0:Z.point)!=null&&le.haloPath&&!Z.point.destroyed&&Z.animate({d:Z.point.haloPath(0)},null,Z.hide),M(this,"afterSetState",{state:l})}haloPath(l){let f=this.pos();return f?this.series.chart.renderer.symbols.circle(u(f[0],1)-l,f[1]-l,2*l,2*l):[]}}let et=xt,{parse:ft}=Qt,{charts:St,composed:Et,isTouchDevice:$t}=kt,{addEvent:Rt,attr:Gt,css:Jt,extend:Yt,find:ae,fireEvent:ke,isNumber:se,isObject:xe,objectEach:ue,offset:Ie,pick:ee,pushUnique:ve,splat:De}=_t;class ge{applyInactiveState(l=[]){let f=[];l.forEach(g=>{let b=g.series;f.push(b),b.linkedParent&&f.push(b.linkedParent),b.linkedSeries&&f.push.apply(f,b.linkedSeries),b.navigatorSeries&&f.push(b.navigatorSeries),b.boosted&&b.markerGroup&&f.push.apply(f,this.chart.series.filter(w=>w.markerGroup===b.markerGroup))}),this.chart.series.forEach(g=>{f.indexOf(g)===-1?g.setState("inactive",!0):g.options.inactiveOtherPoints&&g.setAllPointsToState("inactive")})}destroy(){let l=this;this.eventsToUnbind.forEach(f=>f()),this.eventsToUnbind=[],!kt.chartCount&&(ge.unbindDocumentMouseUp.forEach(f=>f.unbind()),ge.unbindDocumentMouseUp.length=0,ge.unbindDocumentTouchEnd&&(ge.unbindDocumentTouchEnd=ge.unbindDocumentTouchEnd())),clearInterval(l.tooltipTimeout),ue(l,function(f,g){l[g]=void 0})}getSelectionMarkerAttrs(l,f){let g={args:{chartX:l,chartY:f},attrs:{},shapeType:"rect"};return ke(this,"getSelectionMarkerAttrs",g,b=>{let w,{chart:A,zoomHor:C,zoomVert:I}=this,{mouseDownX:R=0,mouseDownY:U=0}=A,F=b.attrs;F.x=A.plotLeft,F.y=A.plotTop,F.width=C?1:A.plotWidth,F.height=I?1:A.plotHeight,C&&(F.width=Math.max(1,Math.abs(w=l-R)),F.x=(w>0?0:w)+R),I&&(F.height=Math.max(1,Math.abs(w=f-U)),F.y=(w>0?0:w)+U)}),g}drag(l){let{chart:f}=this,{mouseDownX:g=0,mouseDownY:b=0}=f,{panning:w,panKey:A,selectionMarkerFill:C}=f.options.chart,I=f.plotLeft,R=f.plotTop,U=f.plotWidth,F=f.plotHeight,G=xe(w)?w.enabled:w,Z=A&&l[`${A}Key`],J=l.chartX,ot=l.chartY,rt,it=this.selectionMarker;if((!it||!it.touch)&&(J<I?J=I:J>I+U&&(J=I+U),ot<R?ot=R:ot>R+F&&(ot=R+F),this.hasDragged=Math.sqrt(Math.pow(g-J,2)+Math.pow(b-ot,2)),this.hasDragged>10)){rt=f.isInsidePlot(g-I,b-R,{visiblePlotOnly:!0});let{shapeType:ct,attrs:dt}=this.getSelectionMarkerAttrs(J,ot);(f.hasCartesianSeries||f.mapView)&&this.hasZoom&&rt&&!Z&&!it&&(this.selectionMarker=it=f.renderer[ct](),it.attr({class:"highcharts-selection-marker",zIndex:7}).add(),f.styledMode||it.attr({fill:C||ft("#334eff").setOpacity(.25).get()})),it&&it.attr(dt),rt&&!it&&G&&f.pan(l,w)}}dragStart(l){let f=this.chart;f.mouseIsDown=l.type,f.cancelClick=!1,f.mouseDownX=l.chartX,f.mouseDownY=l.chartY}getSelectionBox(l){let f={args:{marker:l},result:l.getBBox()};return ke(this,"getSelectionBox",f),f.result}drop(l){let f,{chart:g,selectionMarker:b}=this;for(let w of g.axes)w.isPanning&&(w.isPanning=!1,(w.options.startOnTick||w.options.endOnTick||w.series.some(A=>A.boosted))&&(w.forceRedraw=!0,w.setExtremes(w.userMin,w.userMax,!1),f=!0));if(f&&g.redraw(),b&&l){if(this.hasDragged){let w=this.getSelectionBox(b);g.transform({axes:g.axes.filter(A=>A.zoomEnabled&&(A.coll==="xAxis"&&this.zoomX||A.coll==="yAxis"&&this.zoomY)),selection:{originalEvent:l,xAxis:[],yAxis:[],...w},from:w})}se(g.index)&&(this.selectionMarker=b.destroy())}g&&se(g.index)&&(Jt(g.container,{cursor:g._cursor}),g.cancelClick=this.hasDragged>10,g.mouseIsDown=!1,this.hasDragged=0,this.pinchDown=[])}findNearestKDPoint(l,f,g){let b;return l.forEach(function(w){let A=!(w.noSharedTooltip&&f)&&0>w.options.findNearestPointBy.indexOf("y"),C=w.searchPoint(g,A);xe(C,!0)&&C.series&&(!xe(b,!0)||function(I,R){var Z,J;let U=I.distX-R.distX,F=I.dist-R.dist,G=((Z=R.series.group)==null?void 0:Z.zIndex)-((J=I.series.group)==null?void 0:J.zIndex);return U!==0&&f?U:F!==0?F:G!==0?G:I.series.index>R.series.index?-1:1}(b,C)>0)&&(b=C)}),b}getChartCoordinatesFromPoint(l,f){let{xAxis:g,yAxis:b}=l.series,w=l.shapeArgs;if(g&&b){let A=l.clientX??l.plotX??0,C=l.plotY||0;return l.isNode&&w&&se(w.x)&&se(w.y)&&(A=w.x,C=w.y),f?{chartX:b.len+b.pos-C,chartY:g.len+g.pos-A}:{chartX:A+g.pos,chartY:C+b.pos}}if(w!=null&&w.x&&w.y)return{chartX:w.x,chartY:w.y}}getChartPosition(){if(this.chartPosition)return this.chartPosition;let{container:l}=this.chart,f=Ie(l);this.chartPosition={left:f.left,top:f.top,scaleX:1,scaleY:1};let{offsetHeight:g,offsetWidth:b}=l;return b>2&&g>2&&(this.chartPosition.scaleX=f.width/b,this.chartPosition.scaleY=f.height/g),this.chartPosition}getCoordinates(l){let f={xAxis:[],yAxis:[]};for(let g of this.chart.axes)f[g.isXAxis?"xAxis":"yAxis"].push({axis:g,value:g.toValue(l[g.horiz?"chartX":"chartY"])});return f}getHoverData(l,f,g,b,w,A){let C=[],I=function(Z){return Z.visible&&!(!w&&Z.directTouch)&&ee(Z.options.enableMouseTracking,!0)},R=f,U,F={chartX:A?A.chartX:void 0,chartY:A?A.chartY:void 0,shared:w};ke(this,"beforeGetHoverData",F),U=R&&!R.stickyTracking?[R]:g.filter(Z=>Z.stickyTracking&&(F.filter||I)(Z));let G=b&&l||!A?l:this.findNearestKDPoint(U,w,A);return R=G==null?void 0:G.series,G&&(w&&!R.noSharedTooltip?(U=g.filter(function(Z){return F.filter?F.filter(Z):I(Z)&&!Z.noSharedTooltip})).forEach(function(Z){var rt;let J=(rt=Z.options)==null?void 0:rt.nullInteraction,ot=ae(Z.points,function(it){return it.x===G.x&&(!it.isNull||!!J)});xe(ot)&&(Z.boosted&&Z.boost&&(ot=Z.boost.getPoint(ot)),C.push(ot))}):C.push(G)),ke(this,"afterGetHoverData",F={hoverPoint:G}),{hoverPoint:F.hoverPoint,hoverSeries:R,hoverPoints:C}}getPointFromEvent(l){let f=l.target,g;for(;f&&!g;)g=f.point,f=f.parentNode;return g}onTrackerMouseOut(l){let f=this.chart,g=l.relatedTarget,b=f.hoverSeries;this.isDirectTouch=!1,!b||!g||b.stickyTracking||this.inClass(g,"highcharts-tooltip")||this.inClass(g,"highcharts-series-"+b.index)&&this.inClass(g,"highcharts-tracker")||b.onMouseOut()}inClass(l,f){let g=l,b;for(;g;){if(b=Gt(g,"class")){if(b.indexOf(f)!==-1)return!0;if(b.indexOf("highcharts-container")!==-1)return!1}g=g.parentElement}}constructor(l,f){var g;this.hasDragged=0,this.pointerCaptureEventsToUnbind=[],this.eventsToUnbind=[],this.options=f,this.chart=l,this.runChartClick=!!((g=f.chart.events)!=null&&g.click),this.pinchDown=[],this.setDOMEvents(),ke(this,"afterInit")}normalize(l,f){let g=l.touches,b=g?g.length?g.item(0):ee(g.changedTouches,l.changedTouches)[0]:l;f||(f=this.getChartPosition());let w=b.pageX-f.left,A=b.pageY-f.top;return Yt(l,{chartX:Math.round(w/=f.scaleX),chartY:Math.round(A/=f.scaleY)})}onContainerClick(l){let f=this.chart,g=f.hoverPoint,b=this.normalize(l),w=f.plotLeft,A=f.plotTop;!f.cancelClick&&(g&&this.inClass(b.target,"highcharts-tracker")?(ke(g.series,"click",Yt(b,{point:g})),f.hoverPoint&&g.firePointEvent("click",b)):(Yt(b,this.getCoordinates(b)),f.isInsidePlot(b.chartX-w,b.chartY-A,{visiblePlotOnly:!0})&&ke(f,"click",b)))}onContainerMouseDown(l){var g;let f=(1&(l.buttons||l.button))==1;l=this.normalize(l),kt.isFirefox&&l.button!==0&&this.onContainerMouseMove(l),(l.button===void 0||f)&&(this.zoomOption(l),f&&((g=l.preventDefault)==null||g.call(l)),this.dragStart(l))}onContainerMouseLeave(l){let{pointer:f}=St[ee(ge.hoverChartIndex,-1)]||{};l=this.normalize(l),this.onContainerMouseMove(l),f&&!this.inClass(l.relatedTarget,"highcharts-tooltip")&&(f.reset(),f.chartPosition=void 0)}onContainerMouseEnter(){delete this.chartPosition}onContainerMouseMove(l){let f=this.chart,g=f.tooltip,b=this.normalize(l);this.setHoverChartIndex(l),(f.mouseIsDown==="mousedown"||this.touchSelect(b))&&this.drag(b),!f.openMenu&&(this.inClass(b.target,"highcharts-tracker")||f.isInsidePlot(b.chartX-f.plotLeft,b.chartY-f.plotTop,{visiblePlotOnly:!0}))&&!(g!=null&&g.shouldStickOnContact(b))&&(this.inClass(b.target,"highcharts-no-tooltip")?this.reset(!1,0):this.runPointActions(b))}onDocumentTouchEnd(l){this.onDocumentMouseUp(l)}onContainerTouchMove(l){this.touchSelect(l)?this.onContainerMouseMove(l):this.touch(l)}onContainerTouchStart(l){this.touchSelect(l)?this.onContainerMouseDown(l):(this.zoomOption(l),this.touch(l,!0))}onDocumentMouseMove(l){let f=this.chart,g=f.tooltip,b=this.chartPosition,w=this.normalize(l,b);!b||f.isInsidePlot(w.chartX-f.plotLeft,w.chartY-f.plotTop,{visiblePlotOnly:!0})||g!=null&&g.shouldStickOnContact(w)||w.target!==f.container.ownerDocument&&this.inClass(w.target,"highcharts-tracker")||this.reset()}onDocumentMouseUp(l){var f,g;(g=(f=St[ee(ge.hoverChartIndex,-1)])==null?void 0:f.pointer)==null||g.drop(l)}pinch(l){let f=this,{chart:g,hasZoom:b,lastTouches:w}=f,A=[].map.call(l.touches||[],F=>f.normalize(F)),C=A.length,I=C===1&&(f.inClass(l.target,"highcharts-tracker")&&g.runTrackerClick||f.runChartClick),R=g.tooltip,U=C===1&&ee(R==null?void 0:R.options.followTouchMove,!0);C>1?f.initiated=!0:U&&(f.initiated=!1),b&&f.initiated&&!I&&l.cancelable!==!1&&l.preventDefault(),l.type==="touchstart"?(f.pinchDown=A,f.res=!0,g.mouseDownX=l.chartX):U?this.runPointActions(f.normalize(l)):w&&(ke(g,"touchpan",{originalEvent:l,touches:A},()=>{let F=G=>{let Z=G[0],J=G[1]||Z;return{x:Z.chartX,y:Z.chartY,width:J.chartX-Z.chartX,height:J.chartY-Z.chartY}};g.transform({axes:g.axes.filter(G=>G.zoomEnabled&&(this.zoomHor&&G.horiz||this.zoomVert&&!G.horiz)),to:F(A),from:F(w),trigger:l.type})}),f.res&&(f.res=!1,this.reset(!1,0))),f.lastTouches=A}reset(l,f){let g=this.chart,b=g.hoverSeries,w=g.hoverPoint,A=g.hoverPoints,C=g.tooltip,I=C!=null&&C.shared?A:w;l&&I&&De(I).forEach(function(R){R.series.isCartesian&&R.plotX===void 0&&(l=!1)}),l?C&&I&&De(I).length&&(C.refresh(I),C.shared&&A?A.forEach(function(R){R.setState(R.state,!0),R.series.isCartesian&&(R.series.xAxis.crosshair&&R.series.xAxis.drawCrosshair(null,R),R.series.yAxis.crosshair&&R.series.yAxis.drawCrosshair(null,R))}):w&&(w.setState(w.state,!0),g.axes.forEach(function(R){R.crosshair&&w.series[R.coll]===R&&R.drawCrosshair(null,w)}))):(w&&w.onMouseOut(),A&&A.forEach(function(R){R.setState()}),b&&b.onMouseOut(),C&&C.hide(f),this.unDocMouseMove&&(this.unDocMouseMove=this.unDocMouseMove()),g.axes.forEach(function(R){R.hideCrosshair()}),g.hoverPoints=g.hoverPoint=void 0)}runPointActions(l,f,g){var ot;let b=this.chart,w=b.series,A=(ot=b.tooltip)!=null&&ot.options.enabled?b.tooltip:void 0,C=!!A&&A.shared,I=f||b.hoverPoint,R=(I==null?void 0:I.series)||b.hoverSeries,U=(!l||l.type!=="touchmove")&&(!!f||(R==null?void 0:R.directTouch)&&this.isDirectTouch),F=this.getHoverData(I,R,w,U,C,l);I=F.hoverPoint,R=F.hoverSeries;let G=F.hoverPoints,Z=(R==null?void 0:R.tooltipOptions.followPointer)&&!R.tooltipOptions.split,J=C&&R&&!R.noSharedTooltip;if(I&&(g||I!==b.hoverPoint||A!=null&&A.isHidden)){if((b.hoverPoints||[]).forEach(function(rt){G.indexOf(rt)===-1&&rt.setState()}),b.hoverSeries!==R&&R.onMouseOver(),this.applyInactiveState(G),(G||[]).forEach(function(rt){rt.setState("hover")}),b.hoverPoint&&b.hoverPoint.firePointEvent("mouseOut"),!I.series)return;b.hoverPoints=G,b.hoverPoint=I,I.firePointEvent("mouseOver",void 0,()=>{A&&I&&A.refresh(J?G:I,l)})}else if(Z&&A&&!A.isHidden){let rt=A.getAnchor([{}],l);b.isInsidePlot(rt[0],rt[1],{visiblePlotOnly:!0})&&A.updatePosition({plotX:rt[0],plotY:rt[1]})}this.unDocMouseMove||(this.unDocMouseMove=Rt(b.container.ownerDocument,"mousemove",rt=>{var it,ct;return(ct=(it=St[ge.hoverChartIndex??-1])==null?void 0:it.pointer)==null?void 0:ct.onDocumentMouseMove(rt)}),this.eventsToUnbind.push(this.unDocMouseMove)),b.axes.forEach(function(rt){var dt;let it,ct=((dt=rt.crosshair)==null?void 0:dt.snap)??!0;!ct||(it=b.hoverPoint)&&it.series[rt.coll]===rt||(it=ae(G,Ht=>{var Bt;return((Bt=Ht.series)==null?void 0:Bt[rt.coll])===rt})),it||!ct?rt.drawCrosshair(l,it):rt.hideCrosshair()})}setDOMEvents(){let l=this.chart.container,f=l.ownerDocument;l.onmousedown=this.onContainerMouseDown.bind(this),l.onmousemove=this.onContainerMouseMove.bind(this),l.onclick=this.onContainerClick.bind(this),this.eventsToUnbind.push(Rt(l,"mouseenter",this.onContainerMouseEnter.bind(this)),Rt(l,"mouseleave",this.onContainerMouseLeave.bind(this))),ge.unbindDocumentMouseUp.some(b=>b.doc===f)||ge.unbindDocumentMouseUp.push({doc:f,unbind:Rt(f,"mouseup",this.onDocumentMouseUp.bind(this))});let g=this.chart.renderTo.parentElement;for(;g&&g.tagName!=="BODY";)this.eventsToUnbind.push(Rt(g,"scroll",()=>{delete this.chartPosition})),g=g.parentElement;this.eventsToUnbind.push(Rt(l,"touchstart",this.onContainerTouchStart.bind(this),{passive:!1}),Rt(l,"touchmove",this.onContainerTouchMove.bind(this),{passive:!1})),ge.unbindDocumentTouchEnd||(ge.unbindDocumentTouchEnd=Rt(f,"touchend",this.onDocumentTouchEnd.bind(this),{passive:!1})),this.setPointerCapture(),Rt(this.chart,"redraw",this.setPointerCapture.bind(this))}setPointerCapture(){var w,A;if(!$t)return;let l=this.pointerCaptureEventsToUnbind,f=this.chart,g=f.container,b=ee((w=f.options.tooltip)==null?void 0:w.followTouchMove,!0)&&f.series.some(C=>C.options.findNearestPointBy.indexOf("y")>-1);!this.hasPointerCapture&&b?(l.push(Rt(g,"pointerdown",C=>{var I,R;(I=C.target)!=null&&I.hasPointerCapture(C.pointerId)&&((R=C.target)==null||R.releasePointerCapture(C.pointerId))}),Rt(g,"pointermove",C=>{var I,R;(R=(I=f.pointer)==null?void 0:I.getPointFromEvent(C))==null||R.onMouseOver(C)})),f.styledMode||Jt(g,{"touch-action":"none"}),g.className+=" highcharts-no-touch-action",this.hasPointerCapture=!0):this.hasPointerCapture&&!b&&(l.forEach(C=>C()),l.length=0,f.styledMode||Jt(g,{"touch-action":ee((A=f.options.chart.style)==null?void 0:A["touch-action"],"manipulation")}),g.className=g.className.replace(" highcharts-no-touch-action",""),this.hasPointerCapture=!1)}setHoverChartIndex(l){var b;let f=this.chart,g=kt.charts[ee(ge.hoverChartIndex,-1)];if(g&&g!==f){let w={relatedTarget:f.container};l&&!(l!=null&&l.relatedTarget)&&Object.assign({},l,w),(b=g.pointer)==null||b.onContainerMouseLeave(l||w)}g!=null&&g.mouseIsDown||(ge.hoverChartIndex=f.index)}touch(l,f){let g,{chart:b,pinchDown:w=[]}=this;this.setHoverChartIndex(),(l=this.normalize(l)).touches.length===1?b.isInsidePlot(l.chartX-b.plotLeft,l.chartY-b.plotTop,{visiblePlotOnly:!0})&&!b.openMenu?(f&&this.runPointActions(l),l.type==="touchmove"&&(g=!!w[0]&&Math.pow(w[0].chartX-l.chartX,2)+Math.pow(w[0].chartY-l.chartY,2)>=16),ee(g,!0)&&this.pinch(l)):f&&this.reset():l.touches.length===2&&this.pinch(l)}touchSelect(l){return!!(this.chart.zooming.singleTouch&&l.touches&&l.touches.length===1)}zoomOption(l){let f=this.chart,g=f.inverted,b=f.zooming.type||"",w,A;/touch/.test(l.type)&&(b=ee(f.zooming.pinchType,b)),this.zoomX=w=/x/.test(b),this.zoomY=A=/y/.test(b),this.zoomHor=w&&!g||A&&g,this.zoomVert=A&&!g||w&&g,this.hasZoom=w||A}}ge.unbindDocumentMouseUp=[],function(B){B.compose=function(l){ve(Et,"Core.Pointer")&&Rt(l,"beforeRender",function(){this.pointer=new B(this,this.options)})}}(ge||(ge={}));let Oe=ge;(function(B){B.setLength=function(l,f,g){return Array.isArray(l)?(l.length=f,l):l[g?"subarray":"slice"](0,f)},B.splice=function(l,f,g,b,w=[]){if(Array.isArray(l))return Array.isArray(w)||(w=Array.from(w)),{removed:l.splice(f,g,...w),array:l};let A=Object.getPrototypeOf(l).constructor,C=l[b?"subarray":"slice"](f,f+g),I=new A(l.length-g+w.length);return I.set(l.subarray(0,f),0),I.set(w,f),I.set(l.subarray(f+g),f+w.length),{removed:C,array:I}}})(Q||(Q={}));let{setLength:yi,splice:ki}=Q,{fireEvent:ai,objectEach:vi,uniqueKey:Oi}=_t,Ri=class{constructor(B={}){this.autoId=!B.id,this.columns={},this.id=B.id||Oi(),this.modified=this,this.rowCount=0,this.versionTag=Oi();let l=0;vi(B.columns||{},(f,g)=>{this.columns[g]=f.slice(),l=Math.max(l,f.length)}),this.applyRowCount(l)}applyRowCount(B){this.rowCount=B,vi(this.columns,(l,f)=>{l.length!==B&&(this.columns[f]=yi(l,B))})}deleteRows(B,l=1){if(l>0&&B<this.rowCount){let f=0;vi(this.columns,(g,b)=>{this.columns[b]=ki(g,B,l).array,f=g.length}),this.rowCount=f}ai(this,"afterDeleteRows",{rowIndex:B,rowCount:l}),this.versionTag=Oi()}getColumn(B,l){return this.columns[B]}getColumns(B,l){return(B||Object.keys(this.columns)).reduce((f,g)=>(f[g]=this.columns[g],f),{})}getRow(B,l){return(l||Object.keys(this.columns)).map(f=>{var g;return(g=this.columns[f])==null?void 0:g[B]})}setColumn(B,l=[],f=0,g){this.setColumns({[B]:l},f,g)}setColumns(B,l,f){let g=this.rowCount;vi(B,(b,w)=>{this.columns[w]=b.slice(),g=b.length}),this.applyRowCount(g),f!=null&&f.silent||(ai(this,"afterSetColumns"),this.versionTag=Oi())}setRow(B,l=this.rowCount,f,g){let{columns:b}=this,w=f?this.rowCount+1:l+1;vi(B,(A,C)=>{let I=b[C]||(g==null?void 0:g.addColumns)!==!1&&Array(w);I&&(f?I=ki(I,l,0,!0,[A]).array:I[l]=A,b[C]=I)}),w>this.rowCount&&this.applyRowCount(w),g!=null&&g.silent||(ai(this,"afterSetRows"),this.versionTag=Oi())}},{extend:mi,merge:xs,pick:ws}=_t;(function(B){function l(f,g,b){var Ht,Bt;let w=this.legendItem=this.legendItem||{},{chart:A,options:C}=this,{baseline:I=0,symbolWidth:R,symbolHeight:U}=f,F=this.symbol||"circle",G=U/2,Z=A.renderer,J=w.group,ot=I-Math.round((((Ht=f.fontMetrics)==null?void 0:Ht.b)||U)*(b?.4:.3)),rt={},it,ct=C.marker,dt=0;if(A.styledMode||(rt["stroke-width"]=Math.min(C.lineWidth||0,24),C.dashStyle?rt.dashstyle=C.dashStyle:C.linecap==="square"||(rt["stroke-linecap"]="round")),w.line=Z.path().addClass("highcharts-graph").attr(rt).add(J),b&&(w.area=Z.path().addClass("highcharts-area").add(J)),rt["stroke-linecap"]&&(dt=Math.min(w.line.strokeWidth(),R)/2),R){let Vt=[["M",dt,ot],["L",R-dt,ot]];w.line.attr({d:Vt}),(Bt=w.area)==null||Bt.attr({d:[...Vt,["L",R-dt,I],["L",dt,I]]})}if(ct&&ct.enabled!==!1&&R){let Vt=Math.min(ws(ct.radius,G),G);F.indexOf("url")===0&&(ct=xs(ct,{width:U,height:U}),Vt=0),w.symbol=it=Z.symbol(F,R/2-Vt,ot-Vt,2*Vt,2*Vt,mi({context:"legend"},ct)).addClass("highcharts-point").add(J),it.isMarker=!0}}B.areaMarker=function(f,g){l.call(this,f,g,!0)},B.lineMarker=l,B.rectangle=function(f,g){let b=g.legendItem||{},w=f.options,A=f.symbolHeight,C=w.squareSymbol,I=C?A:f.symbolWidth;b.symbol=this.chart.renderer.rect(C?(f.symbolWidth-A)/2:0,f.baseline-A+1,I,A,ws(f.options.symbolRadius,A/2)).addClass("highcharts-point").attr({zIndex:3}).add(b.group)}})(nt||(nt={}));let Ts=nt,{defaultOptions:Ss}=At,{extend:or,extendClass:qn,merge:Vr}=_t;(function(B){function l(f,g){let b=Ss.plotOptions||{},w=g.defaultOptions,A=g.prototype;return A.type=f,A.pointClass||(A.pointClass=et),!B.seriesTypes[f]&&(w&&(b[f]=w),B.seriesTypes[f]=g,!0)}B.seriesTypes=kt.seriesTypes,B.registerSeriesType=l,B.seriesType=function(f,g,b,w,A){let C=Ss.plotOptions||{};if(g=g||"",C[f]=Vr(C[g],b),delete B.seriesTypes[f],l(f,qn(B.seriesTypes[g]||function(){},w)),B.seriesTypes[f].prototype.type=f,A){class I extends et{}or(I.prototype,A),B.seriesTypes[f].prototype.pointClass=I}return B.seriesTypes[f]}})(Tt||(Tt={}));let bs=Tt,{animObject:Us,setAnimation:Ps}=mn,{defaultOptions:os}=At,{registerEventOptions:Mn}=Lc,{svg:mr,win:Vs}=kt,{seriesTypes:On}=bs,{format:Wh}=ir,{arrayMax:ra,arrayMin:ql,clamp:Do,correctFloat:oa,crisp:ll,defined:hn,destroyObjectProperties:$c,diffObjects:xd,erase:wm,error:vd,extend:Hh,find:Tm,fireEvent:nn,getClosestDistance:c_,getNestedProperty:Hf,insertItem:bd,isArray:Ca,isNumber:Ln,isString:h_,merge:Xh,objectEach:Sm,pick:_n,removeEvent:Xx,syncTimeout:Xf}=_t;class Ir{constructor(){this.zoneAxis="y"}init(l,f){var I,R,U;let g;nn(this,"init",{options:f}),this.dataTable??(this.dataTable=new Ri);let b=l.series;this.eventsToUnbind=[],this.chart=l,this.options=this.setOptions(f);let w=this.options,A=w.visible!==!1;this.linkedSeries=[],this.bindAxes(),Hh(this,{name:w.name,state:"",visible:A,selected:w.selected===!0}),Mn(this,w);let C=w.events;(C!=null&&C.click||(R=(I=w.point)==null?void 0:I.events)!=null&&R.click||w.allowPointSelect)&&(l.runTrackerClick=!0),this.getColor(),this.getSymbol(),this.isCartesian&&(l.hasCartesianSeries=!0),b.length&&(g=b[b.length-1]),this._i=_n(g==null?void 0:g._i,-1)+1,this.opacity=this.options.opacity,l.orderItems("series",bd(this,b)),(U=w.dataSorting)!=null&&U.enabled?this.setDataSortingOptions():this.points||this.data||this.setData(w.data,!1),nn(this,"afterInit")}is(l){return On[l]&&this instanceof On[l]}bindAxes(){let l,f=this,g=f.options,b=f.chart;nn(this,"bindAxes",null,function(){(f.axisTypes||[]).forEach(function(w){(b[w]||[]).forEach(function(A){l=A.options,(_n(g[w],0)===A.index||g[w]!==void 0&&g[w]===l.id)&&(bd(f,A.series),f[w]=A,A.isDirty=!0)}),f[w]||f.optionalAxis===w||vd(18,!0,b)})}),nn(this,"afterBindAxes")}hasData(){return this.visible&&this.dataMax!==void 0&&this.dataMin!==void 0||this.visible&&this.dataTable.rowCount>0}hasMarkerChanged(l,f){let g=l.marker,b=f.marker||{};return g&&(b.enabled&&!g.enabled||b.symbol!==g.symbol||b.height!==g.height||b.width!==g.width)}autoIncrement(l){let f,g=this.options,{pointIntervalUnit:b,relativeXValue:w}=this.options,A=this.chart.time,C=this.xIncrement??A.parse(g.pointStart)??0;if(this.pointInterval=f=_n(this.pointInterval,g.pointInterval,1),w&&Ln(l)&&(f*=l),b){let I=A.toParts(C);b==="day"?I[2]+=f:b==="month"?I[1]+=f:b==="year"&&(I[0]+=f),f=A.makeTime.apply(A,I)-C}return w&&Ln(l)?C+f:(this.xIncrement=C+f,C)}setDataSortingOptions(){let l=this.options;Hh(this,{requireSorting:!1,sorted:!1,enabledDataSorting:!0,allowDG:!1}),hn(l.pointRange)||(l.pointRange=1)}setOptions(l){var rt,it;let f,g=this.chart,b=g.options.plotOptions,w=g.userOptions||{},A=Xh(l),C=g.styledMode,I={plotOptions:b,userOptions:A};nn(this,"setOptions",I);let R=I.plotOptions[this.type],U=w.plotOptions||{},F=U.series||{},G=os.plotOptions[this.type]||{},Z=U[this.type]||{};R.dataLabels=this.mergeArrays(G.dataLabels,R.dataLabels),this.userOptions=I.userOptions;let J=Xh(R,b.series,Z,A);this.tooltipOptions=Xh(os.tooltip,(rt=os.plotOptions.series)==null?void 0:rt.tooltip,G==null?void 0:G.tooltip,g.userOptions.tooltip,(it=U.series)==null?void 0:it.tooltip,Z.tooltip,A.tooltip),this.stickyTracking=_n(A.stickyTracking,Z.stickyTracking,F.stickyTracking,!!this.tooltipOptions.shared&&!this.noSharedTooltip||J.stickyTracking),R.marker===null&&delete J.marker,this.zoneAxis=J.zoneAxis||"y";let ot=this.zones=(J.zones||[]).map(ct=>({...ct}));return(J.negativeColor||J.negativeFillColor)&&!J.zones&&(f={value:J[this.zoneAxis+"Threshold"]||J.threshold||0,className:"highcharts-negative"},C||(f.color=J.negativeColor,f.fillColor=J.negativeFillColor),ot.push(f)),ot.length&&hn(ot[ot.length-1].value)&&ot.push(C?{}:{color:this.color,fillColor:this.fillColor}),nn(this,"afterSetOptions",{options:J}),J}getName(){return this.options.name??Wh(this.chart.options.lang.seriesName,this,this.chart)}getCyclic(l,f,g){let b,w,A=this.chart,C=`${l}Index`,I=`${l}Counter`,R=(g==null?void 0:g.length)||A.options.chart.colorCount;!f&&(hn(w=_n(l==="color"?this.options.colorIndex:void 0,this[C]))?b=w:(A.series.length||(A[I]=0),b=A[I]%R,A[I]+=1),g&&(f=g[b])),b!==void 0&&(this[C]=b),this[l]=f}getColor(){this.chart.styledMode?this.getCyclic("color"):this.options.colorByPoint?this.color="#cccccc":this.getCyclic("color",this.options.color||os.plotOptions[this.type].color,this.chart.options.colors)}getPointsCollection(){return(this.hasGroupedData?this.points:this.data)||[]}getSymbol(){let l=this.options.marker;this.getCyclic("symbol",l.symbol,this.chart.options.symbols)}getColumn(l,f){return(f?this.dataTable.modified:this.dataTable).getColumn(l,!0)||[]}findPointIndex(l,f){var F;let g,b,w,{id:A,x:C}=l,I=this.points,R=this.options.dataSorting,U=this.cropStart||0;if(A){let G=this.chart.get(A);G instanceof et&&(g=G)}else if(this.linkedParent||this.enabledDataSorting||this.options.relativeXValue){let G=Z=>!Z.touched&&Z.index===l.index;if(R!=null&&R.matchByName?G=Z=>!Z.touched&&Z.name===l.name:this.options.relativeXValue&&(G=Z=>!Z.touched&&Z.options.x===l.x),!(g=Tm(I,G)))return}return g&&(w=g==null?void 0:g.index)!==void 0&&(b=!0),w===void 0&&Ln(C)&&(w=this.getColumn("x").indexOf(C,f)),w!==-1&&w!==void 0&&this.cropped&&(w=w>=U?w-U:w),!b&&Ln(w)&&((F=I[w])!=null&&F.touched)&&(w=void 0),w}updateData(l,f){var ot;let{options:g,requireSorting:b}=this,w=g.dataSorting,A=this.points,C=[],I=l.length===A.length,R,U,F,G,Z=!0;if(this.xIncrement=null,l.forEach((rt,it)=>{var Vt;let ct,dt=hn(rt)&&this.pointClass.prototype.optionsToObject.call({series:this},rt)||{},{id:Ht,x:Bt}=dt;Ht||Ln(Bt)?((ct=this.findPointIndex(dt,G))===-1||ct===void 0?C.push(rt):A[ct]&&rt!==((Vt=g.data)==null?void 0:Vt[ct])?(A[ct].update(rt,!1,void 0,!1),A[ct].touched=!0,b&&(G=ct+1)):A[ct]&&(A[ct].touched=!0),(!I||it!==ct||w!=null&&w.enabled||this.hasDerivedData)&&(R=!0)):C.push(rt)},this),R)for(U=A.length;U--;)(F=A[U])&&!F.touched&&((ot=F.remove)==null||ot.call(F,!1,f));else I&&!(w!=null&&w.enabled)?(l.forEach((rt,it)=>{rt===A[it].y||A[it].destroyed||A[it].update(rt,!1,void 0,!1)}),C.length=0):Z=!1;if(A.forEach(rt=>{rt&&(rt.touched=!1)}),!Z)return!1;C.forEach(rt=>{this.addPoint(rt,!1,void 0,void 0,!1)},this);let J=this.getColumn("x");return this.xIncrement===null&&J.length&&(this.xIncrement=ra(J),this.autoIncrement()),!0}dataColumnKeys(){return["x",...this.pointArrayMap||["y"]]}setData(l,f=!0,g,b){var le,Kt;let w=this.points,A=(w==null?void 0:w.length)||0,C=this.options,I=this.chart,R=C.dataSorting,U=this.xAxis,F=C.turboThreshold,G=this.dataTable,Z=this.dataColumnKeys(),J=this.pointValKey||"y",ot=(this.pointArrayMap||[]).length,rt=C.keys,it,ct,dt=0,Ht=1,Bt;I.options.chart.allowMutatingData||(C.data&&delete this.options.data,this.userOptions.data&&delete this.userOptions.data,Bt=Xh(!0,l));let Vt=(l=Bt||l||[]).length;if(R!=null&&R.enabled&&(l=this.sortData(l)),I.options.chart.allowMutatingData&&b!==!1&&Vt&&A&&!this.cropped&&!this.hasGroupedData&&this.visible&&!this.boosted&&(ct=this.updateData(l,g)),!ct){this.xIncrement=null,this.colorCounter=0;let ce=F&&Vt>F;if(ce){let Ee=this.getFirstValidPoint(l),Be=this.getFirstValidPoint(l,Vt-1,-1),$e=Ae=>!!(Ca(Ae)&&(rt||Ln(Ae[0])));if(Ln(Ee)&&Ln(Be)){let Ae=[],Je=[];for(let ri of l)Ae.push(this.autoIncrement()),Je.push(ri);G.setColumns({x:Ae,[J]:Je})}else if($e(Ee)&&$e(Be))if(ot){let Ae=+(Ee.length===ot),Je=Array(Z.length).fill(0).map(()=>[]);for(let ri of l){Ae&&Je[0].push(this.autoIncrement());for(let Ii=Ae;Ii<=ot;Ii++)(le=Je[Ii])==null||le.push(ri[Ii-Ae])}G.setColumns(Z.reduce((ri,Ii,hi)=>(ri[Ii]=Je[hi],ri),{}))}else{rt&&(dt=rt.indexOf("x"),Ht=rt.indexOf("y"),dt=dt>=0?dt:0,Ht=Ht>=0?Ht:1),Ee.length===1&&(Ht=0);let Ae=[],Je=[];if(dt===Ht)for(let ri of l)Ae.push(this.autoIncrement()),Je.push(ri[Ht]);else for(let ri of l)Ae.push(ri[dt]),Je.push(ri[Ht]);G.setColumns({x:Ae,[J]:Je})}else ce=!1}if(!ce){let Ee=Z.reduce((Be,$e)=>(Be[$e]=[],Be),{});for(it=0;it<Vt;it++){let Be=this.pointClass.prototype.applyOptions.apply({series:this},[l[it]]);for(let $e of Z)Ee[$e][it]=Be[$e]}G.setColumns(Ee)}for(h_(this.getColumn("y")[0])&&vd(14,!0,I),this.data=[],this.options.data=this.userOptions.data=l,it=A;it--;)(Kt=w[it])==null||Kt.destroy();U&&(U.minRange=U.userMinRange),this.isDirty=I.isDirtyBox=!0,this.isDirtyData=!!w,g=!1}C.legendType==="point"&&(this.processData(),this.generatePoints()),f&&I.redraw(g)}sortData(l){let f=this,g=f.options.dataSorting.sortKey||"y",b=function(w,A){return hn(A)&&w.pointClass.prototype.optionsToObject.call({series:w},A)||{}};return l.forEach(function(w,A){l[A]=b(f,w),l[A].index=A},this),l.concat().sort((w,A)=>{let C=Hf(g,w),I=Hf(g,A);return I<C?-1:+(I>C)}).forEach(function(w,A){w.x=A},this),f.linkedSeries&&f.linkedSeries.forEach(function(w){var I;let A=w.options,C=A.data;!((I=A.dataSorting)!=null&&I.enabled)&&C&&(C.forEach(function(R,U){C[U]=b(w,R),l[U]&&(C[U].x=l[U].x,C[U].index=U)}),w.setData(C,!1))}),l}getProcessedData(l){let f=this,{dataTable:g,isCartesian:b,options:w,xAxis:A}=f,C=w.cropThreshold,I=l||f.getExtremesFromAll,R=A==null?void 0:A.logarithmic,U=g.rowCount,F,G,Z=0,J,ot,rt,it=f.getColumn("x"),ct=g,dt=!1;return A&&(ot=(J=A.getExtremes()).min,rt=J.max,dt=!!(A.categories&&!A.names.length),b&&f.sorted&&!I&&(!C||U>C||f.forceCrop)&&(it[U-1]<ot||it[0]>rt?ct=new Ri:f.getColumn(f.pointValKey||"y").length&&(it[0]<ot||it[U-1]>rt)&&(ct=(F=this.cropData(g,ot,rt)).modified,Z=F.start,G=!0))),it=ct.getColumn("x")||[],{modified:ct,cropped:G,cropStart:Z,closestPointRange:c_([R?it.map(R.log2lin):it],()=>f.requireSorting&&!dt&&vd(15,!1,f.chart))}}processData(l){let f=this.xAxis,g=this.dataTable;if(this.isCartesian&&!this.isDirty&&!f.isDirty&&!this.yAxis.isDirty&&!l)return!1;let b=this.getProcessedData();g.modified=b.modified,this.cropped=b.cropped,this.cropStart=b.cropStart,this.closestPointRange=this.basePointRange=b.closestPointRange,nn(this,"afterProcessData")}cropData(l,f,g){let b=l.getColumn("x",!0)||[],w=b.length,A={},C,I,R=0,U=w;for(C=0;C<w;C++)if(b[C]>=f){R=Math.max(0,C-1);break}for(I=C;I<w;I++)if(b[I]>g){U=I+1;break}for(let F of this.dataColumnKeys()){let G=l.getColumn(F,!0);G&&(A[F]=G.slice(R,U))}return{modified:new Ri({columns:A}),start:R,end:U}}generatePoints(){var Bt,Vt,le;let l=this.options,f=this.processedData||l.data,g=this.dataTable.modified,b=this.getColumn("x",!0),w=this.pointClass,A=g.rowCount,C=this.cropStart||0,I=this.hasGroupedData,R=l.keys,U=[],F=(Bt=l.dataGrouping)!=null&&Bt.groupAll?C:0,G=(Vt=this.xAxis)==null?void 0:Vt.categories,Z=this.pointArrayMap||["y"],J=this.dataColumnKeys(),ot,rt,it,ct,dt=this.data,Ht;if(!dt&&!I){let Kt=[];Kt.length=(f==null?void 0:f.length)||0,dt=this.data=Kt}for(R&&I&&(this.options.keys=!1),ct=0;ct<A;ct++)rt=C+ct,I?((it=new w(this,g.getRow(ct,J)||[])).dataGroup=this.groupMap[F+ct],(le=it.dataGroup)!=null&&le.options&&(it.options=it.dataGroup.options,Hh(it,it.dataGroup.options),delete it.dataLabels)):(it=dt[rt],Ht=f?f[rt]:g.getRow(ct,Z),it||Ht===void 0||(dt[rt]=it=new w(this,Ht,b[ct]))),it&&(it.index=I?F+ct:rt,U[ct]=it,it.category=(G==null?void 0:G[it.x])??it.x,it.key=it.name??it.category);if(this.options.keys=R,dt&&(A!==(ot=dt.length)||I))for(ct=0;ct<ot;ct++)ct!==C||I||(ct+=A),dt[ct]&&(dt[ct].destroyElements(),dt[ct].plotX=void 0);this.data=dt,this.points=U,nn(this,"afterGeneratePoints")}getXExtremes(l){return{min:ql(l),max:ra(l)}}getExtremes(l,f){var Bt;let{xAxis:g,yAxis:b}=this,w=f||this.getExtremesFromAll||this.options.getExtremesFromAll,A=w&&this.cropped?this.dataTable:this.dataTable.modified,C=A.rowCount,I=l||this.stackedYData,R=I?[I]:((Bt=this.keysAffectYAxis||this.pointArrayMap||["y"])==null?void 0:Bt.map(Vt=>A.getColumn(Vt,!0)||[]))||[],U=this.getColumn("x",!0),F=[],G=this.requireSorting&&!this.is("column")?1:0,Z=!!b&&b.positiveValuesOnly,J=w||this.cropped||!g,ot,rt,it,ct=0,dt=0;for(g&&(ct=(ot=g.getExtremes()).min,dt=ot.max),it=0;it<C;it++)if(rt=U[it],J||(U[it+G]||rt)>=ct&&(U[it-G]||rt)<=dt)for(let Vt of R){let le=Vt[it];Ln(le)&&(le>0||!Z)&&F.push(le)}let Ht={activeYData:F,dataMin:ql(F),dataMax:ra(F)};return nn(this,"afterGetExtremes",{dataExtremes:Ht}),Ht}applyExtremes(){let l=this.getExtremes();return this.dataMin=l.dataMin,this.dataMax=l.dataMax,l}getFirstValidPoint(l,f=0,g=1){let b=l.length,w=f;for(;w>=0&&w<b;){if(hn(l[w]))return l[w];w+=g}}translate(){var dt;this.generatePoints();let l=this.options,f=l.stacking,g=this.xAxis,b=this.enabledDataSorting,w=this.yAxis,A=this.points,C=A.length,I=this.pointPlacementToXValue(),R=!!I,U=l.threshold,F=l.startFromThreshold?U:0,G=(l==null?void 0:l.nullInteraction)&&w.len,Z,J,ot,rt,it=Number.MAX_VALUE;function ct(Ht){return Do(Ht,-1e9,1e9)}for(Z=0;Z<C;Z++){let Ht,Bt=A[Z],Vt=Bt.x,le,Kt,ce=Bt.y,Ee=Bt.low,Be=f&&((dt=w.stacking)==null?void 0:dt.stacks[(this.negStacks&&ce<(F?0:U)?"-":"")+this.stackKey]);Bt.plotX=Ln(J=g.translate(Vt,!1,!1,!1,!0,I))?oa(ct(J)):void 0,f&&this.visible&&Be&&Be[Vt]&&(rt=this.getStackIndicator(rt,Vt,this.index),!Bt.isNull&&rt.key&&(Kt=(le=Be[Vt]).points[rt.key]),le&&Ca(Kt)&&(Ee=Kt[0],ce=Kt[1],Ee===F&&rt.key===Be[Vt].base&&(Ee=_n(Ln(U)?U:w.min)),w.positiveValuesOnly&&hn(Ee)&&Ee<=0&&(Ee=void 0),Bt.total=Bt.stackTotal=_n(le.total),Bt.percentage=hn(Bt.y)&&le.total?Bt.y/le.total*100:void 0,Bt.stackY=ce,this.irregularWidths||le.setOffset(this.pointXOffset||0,this.barW||0,void 0,void 0,void 0,this.xAxis))),Bt.yBottom=hn(Ee)?ct(w.translate(Ee,!1,!0,!1,!0)):void 0,this.dataModify&&(ce=this.dataModify.modifyValue(ce,Z)),Ln(ce)&&Bt.plotX!==void 0?Ht=Ln(Ht=w.translate(ce,!1,!0,!1,!0))?ct(Ht):void 0:!Ln(ce)&&G&&(Ht=G),Bt.plotY=Ht,Bt.isInside=this.isPointInside(Bt),Bt.clientX=R?oa(g.translate(Vt,!1,!1,!1,!0,I)):J,Bt.negative=(Bt.y||0)<(U||0),Bt.isNull||Bt.visible===!1||(ot!==void 0&&(it=Math.min(it,Math.abs(J-ot))),ot=J),Bt.zone=this.zones.length?Bt.getZone():void 0,!Bt.graphic&&this.group&&b&&(Bt.isNew=!0)}this.closestPointRangePx=it,nn(this,"afterTranslate")}getValidPoints(l,f,g){let b=this.chart;return(l||this.points||[]).filter(function(w){let{plotX:A,plotY:C}=w;return!!((g||!w.isNull&&Ln(C))&&(!f||b.isInsidePlot(A,C,{inverted:b.inverted})))&&w.visible!==!1})}getSharedClipKey(){return this.sharedClipKey=(this.options.xAxis||0)+","+(this.options.yAxis||0),this.sharedClipKey}setClip(){let{chart:l,group:f,markerGroup:g}=this,b=l.sharedClips,w=l.renderer,A=l.getClipBox(this),C=this.getSharedClipKey(),I=b[C];I?I.animate(A):b[C]=I=w.clipRect(A),f&&f.clip(this.options.clip===!1?void 0:I),g&&g.clip()}animate(l){let{chart:f,group:g,markerGroup:b}=this,w=f.inverted,A=Us(this.options.animation),C=[this.getSharedClipKey(),A.duration,A.easing,A.defer].join(","),I=f.sharedClips[C],R=f.sharedClips[C+"m"];if(l&&g){let U=f.getClipBox(this);if(I)I.attr("height",U.height);else{U.width=0,w&&(U.x=f.plotHeight),I=f.renderer.clipRect(U),f.sharedClips[C]=I;let F={x:-99,y:-99,width:w?f.plotWidth+199:99,height:w?99:f.plotHeight+199};R=f.renderer.clipRect(F),f.sharedClips[C+"m"]=R}g.clip(I),b==null||b.clip(R)}else if(I&&!I.hasClass("highcharts-animating")){let U=f.getClipBox(this),F=A.step;(b!=null&&b.element.childNodes.length||f.series.length>1)&&(A.step=function(G,Z){F&&F.apply(Z,arguments),Z.prop==="width"&&(R!=null&&R.element)&&R.attr(w?"height":"width",G+99)}),I.addClass("highcharts-animating").animate(U,A)}}afterAnimate(){this.setClip(),Sm(this.chart.sharedClips,(l,f,g)=>{l&&!this.chart.container.querySelector(`[clip-path="url(#${l.id})"]`)&&(l.destroy(),delete g[f])}),this.finishedAnimating=!0,nn(this,"afterAnimate")}drawPoints(l=this.points){let f,g,b,w,A,C,I,R=this.chart,U=R.styledMode,{colorAxis:F,options:G}=this,Z=G.marker,J=G.nullInteraction,ot=this[this.specialGroup||"markerGroup"],rt=this.xAxis,it=_n(Z.enabled,!rt||!!rt.isRadial||null,this.closestPointRangePx>=Z.enabledThreshold*Z.radius);if(Z.enabled!==!1||this._hasPointMarkers)for(f=0;f<l.length;f++){w=(b=(g=l[f]).graphic)?"animate":"attr",A=g.marker||{},C=!!g.marker;let ct=g.isNull;if((it&&!hn(A.enabled)||A.enabled)&&(!ct||J)&&g.visible!==!1){let dt=_n(A.symbol,this.symbol,"rect");I=this.markerAttribs(g,g.selected&&"select"),this.enabledDataSorting&&(g.startXPos=rt.reversed?-(I.width||0):rt.width);let Ht=g.isInside!==!1;if(!b&&Ht&&((I.width||0)>0||g.hasImage)&&(g.graphic=b=R.renderer.symbol(dt,I.x,I.y,I.width,I.height,C?A:Z).add(ot),this.enabledDataSorting&&R.hasRendered&&(b.attr({x:g.startXPos}),w="animate")),b&&w==="animate"&&b[Ht?"show":"hide"](Ht).animate(I),b){let Bt=this.pointAttribs(g,U||!g.selected?void 0:"select");U?F&&b.css({fill:Bt.fill}):b[w](Bt)}b&&b.addClass(g.getClassName(),!0)}else b&&(g.graphic=b.destroy())}}markerAttribs(l,f){let g=this.options,b=g.marker,w=l.marker||{},A=w.symbol||b.symbol,C={},I,R,U=_n(w.radius,b==null?void 0:b.radius);f&&(I=b.states[f],R=w.states&&w.states[f],U=_n(R==null?void 0:R.radius,I==null?void 0:I.radius,U&&U+((I==null?void 0:I.radiusPlus)||0))),l.hasImage=A&&A.indexOf("url")===0,l.hasImage&&(U=0);let F=l.pos();return Ln(U)&&F&&(g.crisp&&(F[0]=ll(F[0],l.hasImage?0:A==="rect"?(b==null?void 0:b.lineWidth)||0:1)),C.x=F[0]-U,C.y=F[1]-U),U&&(C.width=C.height=2*U),C}pointAttribs(l,f){var it;let g=this.options,b=g.marker,w=l==null?void 0:l.options,A=(w==null?void 0:w.marker)||{},C=w==null?void 0:w.color,I=l==null?void 0:l.color,R=(it=l==null?void 0:l.zone)==null?void 0:it.color,U,F,G=this.color,Z,J,ot=_n(A.lineWidth,b.lineWidth),rt=l!=null&&l.isNull&&g.nullInteraction?0:1;return G=C||R||I||G,Z=A.fillColor||b.fillColor||G,J=A.lineColor||b.lineColor||G,f=f||"normal",U=b.states[f]||{},ot=_n((F=A.states&&A.states[f]||{}).lineWidth,U.lineWidth,ot+_n(F.lineWidthPlus,U.lineWidthPlus,0)),Z=F.fillColor||U.fillColor||Z,J=F.lineColor||U.lineColor||J,{stroke:J,"stroke-width":ot,fill:Z,opacity:rt=_n(F.opacity,U.opacity,rt)}}destroy(l){var I,R;let f,g,b=this,w=b.chart,A=/AppleWebKit\/533/.test(Vs.navigator.userAgent),C=b.data||[];for(nn(b,"destroy",{keepEventsForUpdate:l}),this.removeEvents(l),(b.axisTypes||[]).forEach(function(U){g=b[U],g!=null&&g.series&&(wm(g.series,b),g.isDirty=g.forceRedraw=!0)}),b.legendItem&&b.chart.legend.destroyItem(b),f=C.length;f--;)(R=(I=C[f])==null?void 0:I.destroy)==null||R.call(I);for(let U of b.zones)$c(U,void 0,!0);_t.clearTimeout(b.animationTimeout),Sm(b,function(U,F){U instanceof Hn&&!U.survive&&U[A&&F==="group"?"hide":"destroy"]()}),w.hoverSeries===b&&(w.hoverSeries=void 0),wm(w.series,b),w.orderItems("series"),Sm(b,function(U,F){l&&F==="hcEvents"||delete b[F]})}applyZones(){let{area:l,chart:f,graph:g,zones:b,points:w,xAxis:A,yAxis:C,zoneAxis:I}=this,{inverted:R,renderer:U}=f,F=this[`${I}Axis`],{isXAxis:G,len:Z=0,minPointOffset:J=0}=F||{},ot=((g==null?void 0:g.strokeWidth())||0)/2+1,rt=(it,ct=0,dt=0)=>{R&&(dt=Z-dt);let{translated:Ht=0,lineClip:Bt}=it,Vt=dt-Ht;Bt==null||Bt.push(["L",ct,Math.abs(Vt)<ot?dt-ot*(Vt<=0?-1:1):Ht])};if(b.length&&(g||l)&&F&&Ln(F.min)){let it=F.getExtremes().max+J,ct=Bt=>{Bt.forEach((Vt,le)=>{(Vt[0]==="M"||Vt[0]==="L")&&(Bt[le]=[Vt[0],G?Z-Vt[1]:Vt[1],G?Vt[2]:Z-Vt[2]])})};if(b.forEach(Bt=>{Bt.lineClip=[],Bt.translated=Do(F.toPixels(_n(Bt.value,it),!0)||0,0,Z)}),g&&!this.showLine&&g.hide(),l&&l.hide(),I==="y"&&w.length<A.len)for(let Bt of w){let{plotX:Vt,plotY:le,zone:Kt}=Bt,ce=Kt&&b[b.indexOf(Kt)-1];Kt&&rt(Kt,Vt,le),ce&&rt(ce,Vt,le)}let dt=[],Ht=F.toPixels(F.getExtremes().min-J,!0);b.forEach(Bt=>{var Ii,hi;let Vt=Bt.lineClip||[],le=Math.round(Bt.translated||0);A.reversed&&Vt.reverse();let{clip:Kt,simpleClip:ce}=Bt,Ee=0,Be=0,$e=A.len,Ae=C.len;G?(Ee=le,$e=Ht):(Be=le,Ae=Ht);let Je=[["M",Ee,Be],["L",$e,Be],["L",$e,Ae],["L",Ee,Ae],["Z"]],ri=[Je[0],...Vt,Je[1],Je[2],...dt,Je[3],Je[4]];dt=Vt.reverse(),Ht=le,R&&(ct(ri),l&&ct(Je)),Kt?(Kt.animate({d:ri}),ce==null||ce.animate({d:Je})):(Kt=Bt.clip=U.path(ri),l&&(ce=Bt.simpleClip=U.path(Je))),g&&((Ii=Bt.graph)==null||Ii.clip(Kt)),l&&((hi=Bt.area)==null||hi.clip(ce))})}else this.visible&&(g&&g.show(),l&&l.show())}plotGroup(l,f,g,b,w){let A=this[l],C=!A,I={visibility:g,zIndex:b||.1};return hn(this.opacity)&&!this.chart.styledMode&&this.state!=="inactive"&&(I.opacity=this.opacity),A||(this[l]=A=this.chart.renderer.g().add(w)),A.addClass("highcharts-"+f+" highcharts-series-"+this.index+" highcharts-"+this.type+"-series "+(hn(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(A.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0),A.attr(I)[C?"attr":"animate"](this.getPlotBox(f)),A}getPlotBox(l){let f=this.xAxis,g=this.yAxis,b=this.chart,w=b.inverted&&!b.polar&&f&&this.invertible&&l==="series";return b.inverted&&(f=g,g=this.xAxis),{translateX:f?f.left:b.plotLeft,translateY:g?g.top:b.plotTop,rotation:90*!!w,rotationOriginX:w?(f.len-g.len)/2:0,rotationOriginY:w?(f.len+g.len)/2:0,scaleX:w?-1:1,scaleY:1}}removeEvents(l){let{eventsToUnbind:f}=this;l||Xx(this),f.length&&(f.forEach(g=>{g()}),f.length=0)}render(){var U,F,G,Z,J;let l=this,{chart:f,options:g,hasRendered:b}=l,w=Us(g.animation),A=l.visible?"inherit":"hidden",C=g.zIndex,I=f.seriesGroup,R=l.finishedAnimating?0:w.duration;nn(this,"render"),l.plotGroup("group","series",A,C,I),l.markerGroup=l.plotGroup("markerGroup","markers",A,C,I),g.clip!==!1&&l.setClip(),R&&((U=l.animate)==null||U.call(l,!0)),l.drawGraph&&(l.drawGraph(),l.applyZones()),l.visible&&l.drawPoints(),(F=l.drawDataLabels)==null||F.call(l),(G=l.redrawPoints)==null||G.call(l),g.enableMouseTracking&&((Z=l.drawTracker)==null||Z.call(l)),R&&((J=l.animate)==null||J.call(l)),b||(R&&w.defer&&(R+=w.defer),l.animationTimeout=Xf(()=>{l.afterAnimate()},R||0)),l.isDirty=!1,l.hasRendered=!0,nn(l,"afterRender")}redraw(){let l=this.isDirty||this.isDirtyData;this.translate(),this.render(),l&&delete this.kdTree}reserveSpace(){return this.visible||!this.chart.options.chart.ignoreHiddenSeries}searchPoint(l,f){let{xAxis:g,yAxis:b}=this,w=this.chart.inverted;return this.searchKDTree({clientX:w?g.len-l.chartY+g.pos:l.chartX-g.pos,plotY:w?b.len-l.chartX+b.pos:l.chartY-b.pos},f,l)}buildKDTree(l){this.buildingKdTree=!0;let f=this,g=f.options,b=g.findNearestPointBy.indexOf("y")>-1?2:1;delete f.kdTree,Xf(function(){f.kdTree=function w(A,C,I){let R,U,F=A==null?void 0:A.length;if(F)return R=f.kdAxisArray[C%I],A.sort((G,Z)=>(G[R]||0)-(Z[R]||0)),{point:A[U=Math.floor(F/2)],left:w(A.slice(0,U),C+1,I),right:w(A.slice(U+1),C+1,I)}}(f.getValidPoints(void 0,!f.directTouch,g==null?void 0:g.nullInteraction),b,b),f.buildingKdTree=!1},g.kdNow||(l==null?void 0:l.type)==="touchstart"?0:1)}searchKDTree(l,f,g,b,w){let A=this,[C,I]=this.kdAxisArray,R=f?"distX":"dist",U=(A.options.findNearestPointBy||"").indexOf("y")>-1?2:1,F=!!A.isBubble,G=b||((J,ot,rt)=>{let it=J[rt]||0,ct=ot[rt]||0;return[it===ct&&J.index>ot.index||it<ct?J:ot,!1]}),Z=w||((J,ot)=>J<ot);if(this.kdTree||this.buildingKdTree||this.buildKDTree(g),this.kdTree)return function J(ot,rt,it,ct){var Ee;let dt=rt.point,Ht=A.kdAxisArray[it%ct],Bt=dt,Vt=!1;(function(Be,$e){var Zi;let Ae=Be[C],Je=$e[C],ri=hn(Ae)&&hn(Je)?Ae-Je:null,Ii=Be[I],hi=$e[I],Li=hn(Ii)&&hn(hi)?Ii-hi:0,as=F&&((Zi=$e.marker)==null?void 0:Zi.radius)||0;$e.dist=Math.sqrt((ri&&ri*ri||0)+Li*Li)-as,$e.distX=hn(ri)?Math.abs(ri)-as:Number.MAX_VALUE})(ot,dt);let le=(ot[Ht]||0)-(dt[Ht]||0)+(F&&((Ee=dt.marker)==null?void 0:Ee.radius)||0),Kt=le<0?"left":"right",ce=le<0?"right":"left";return rt[Kt]&&([Bt,Vt]=G(dt,J(ot,rt[Kt],it+1,ct),R)),rt[ce]&&Z(Math.sqrt(le*le),Bt[R],Vt)&&(Bt=G(Bt,J(ot,rt[ce],it+1,ct),R)[0]),Bt}(l,this.kdTree,U,U)}pointPlacementToXValue(){let{options:l,xAxis:f}=this,g=l.pointPlacement;return g==="between"&&(g=f.reversed?-.5:.5),Ln(g)?g*(l.pointRange||f.pointRange):0}isPointInside(l){let{chart:f,xAxis:g,yAxis:b}=this,{plotX:w=-1,plotY:A=-1}=l;return A>=0&&A<=(b?b.len:f.plotHeight)&&w>=0&&w<=(g?g.len:f.plotWidth)}drawTracker(){var G;let l=this,f=l.options,g=f.trackByArea,b=[].concat((g?l.areaPath:l.graphPath)||[]),w=l.chart,A=w.pointer,C=w.renderer,I=((G=w.options.tooltip)==null?void 0:G.snap)||0,R=()=>{f.enableMouseTracking&&w.hoverSeries!==l&&l.onMouseOver()},U="rgba(192,192,192,"+(mr?1e-4:.002)+")",F=l.tracker;F?F.attr({d:b}):l.graph&&(l.tracker=F=C.path(b).attr({visibility:l.visible?"inherit":"hidden",zIndex:2}).addClass(g?"highcharts-tracker-area":"highcharts-tracker-line").add(l.group),w.styledMode||F.attr({"stroke-linecap":"round","stroke-linejoin":"round",stroke:U,fill:g?U:"none","stroke-width":l.graph.strokeWidth()+(g?0:2*I)}),[l.tracker,l.markerGroup,l.dataLabelsGroup].forEach(Z=>{Z&&(Z.addClass("highcharts-tracker").on("mouseover",R).on("mouseout",J=>{A==null||A.onTrackerMouseOut(J)}),f.cursor&&!w.styledMode&&Z.css({cursor:f.cursor}),Z.on("touchstart",R))})),nn(this,"afterDrawTracker")}addPoint(l,f,g,b,w){let A,C,I=this.options,{chart:R,data:U,dataTable:F,xAxis:G}=this,Z=(G==null?void 0:G.hasNames)&&G.names,J=I.data,ot=this.getColumn("x");f=_n(f,!0);let rt={series:this};this.pointClass.prototype.applyOptions.apply(rt,[l]);let it=rt.x;if(C=ot.length,this.requireSorting&&it<ot[C-1])for(A=!0;C&&ot[C-1]>it;)C--;F.setRow(rt,C,!0,{addColumns:!1}),Z&&rt.name&&(Z[it]=rt.name),J==null||J.splice(C,0,l),(A||this.processedData)&&(this.data.splice(C,0,null),this.processData()),I.legendType==="point"&&this.generatePoints(),g&&(U[0]&&U[0].remove?U[0].remove(!1):([U,J].filter(hn).forEach(ct=>{ct.shift()}),F.deleteRows(0))),w!==!1&&nn(this,"addPoint",{point:rt}),this.isDirty=!0,this.isDirtyData=!0,f&&R.redraw(b)}removePoint(l,f,g){let b=this,{chart:w,data:A,points:C,dataTable:I}=b,R=A[l],U=function(){[(C==null?void 0:C.length)===A.length?C:void 0,A,b.options.data].filter(hn).forEach(F=>{F.splice(l,1)}),I.deleteRows(l),R==null||R.destroy(),b.isDirty=!0,b.isDirtyData=!0,f&&w.redraw()};Ps(g,w),f=_n(f,!0),R?R.firePointEvent("remove",null,U):U()}remove(l,f,g,b){let w=this,A=w.chart;function C(){w.destroy(b),A.isDirtyLegend=A.isDirtyBox=!0,A.linkSeries(b),_n(l,!0)&&A.redraw(f)}g!==!1?nn(w,"remove",null,C):C()}update(l,f){var it,ct;nn(this,"update",{options:l=xd(l,this.userOptions)});let g=this,b=g.chart,w=g.userOptions,A=g.initialType||g.type,C=b.options.plotOptions,I=On[A].prototype,R=g.finishedAnimating&&{animation:!1},U={},F,G,Z=Ir.keepProps.slice(),J=l.type||w.type||b.options.chart.type,ot=!(this.hasDerivedData||J&&J!==this.type||l.keys!==void 0||l.pointStart!==void 0||l.pointInterval!==void 0||l.relativeXValue!==void 0||l.joinBy||l.mapData||["dataGrouping","pointStart","pointInterval","pointIntervalUnit","keys"].some(dt=>g.hasOptionChanged(dt)));J=J||A,ot?(Z.push.apply(Z,Ir.keepPropsForPoints),l.visible!==!1&&Z.push("area","graph"),g.parallelArrays.forEach(function(dt){Z.push(dt+"Data")}),l.data&&(l.dataSorting&&Hh(g.options.dataSorting,l.dataSorting),this.setData(l.data,!1))):this.dataTable.modified=this.dataTable,l=Xh(w,{index:w.index===void 0?g.index:w.index,pointStart:((it=C==null?void 0:C.series)==null?void 0:it.pointStart)??w.pointStart??g.getColumn("x")[0]},!ot&&{data:g.options.data},l,R),ot&&l.data&&(l.data=g.options.data),(Z=["group","markerGroup","dataLabelsGroup","transformGroup"].concat(Z)).forEach(function(dt){Z[dt]=g[dt],delete g[dt]});let rt=!1;if(On[J]){if(rt=J!==g.type,g.remove(!1,!1,!1,!0),rt)if(b.propFromSeries(),Object.setPrototypeOf)Object.setPrototypeOf(g,On[J].prototype);else{let dt=Object.hasOwnProperty.call(g,"hcEvents")&&g.hcEvents;for(G in I)g[G]=void 0;Hh(g,On[J].prototype),dt?g.hcEvents=dt:delete g.hcEvents}}else vd(17,!0,b,{missingModuleFor:J});if(Z.forEach(function(dt){g[dt]=Z[dt]}),g.init(b,l),ot&&this.points)for(let dt of((F=g.options).visible===!1?(U.graphic=1,U.dataLabel=1):(this.hasMarkerChanged(F,w)&&(U.graphic=1),(ct=g.hasDataLabels)!=null&&ct.call(g)||(U.dataLabel=1)),this.points))dt!=null&&dt.series&&(dt.resolveColor(),Object.keys(U).length&&dt.destroyElements(U),F.showInLegend===!1&&dt.legendItem&&b.legend.destroyItem(dt));g.initialType=A,b.linkSeries(),b.setSortedData(),rt&&g.linkedSeries.length&&(g.isDirtyData=!0),nn(this,"afterUpdate"),_n(f,!0)&&b.redraw(!!ot&&void 0)}setName(l){this.name=this.options.name=this.userOptions.name=l,this.chart.isDirtyLegend=!0}hasOptionChanged(l){var C,I;let f=this.chart,g=this.options[l],b=f.options.plotOptions,w=this.userOptions[l],A=_n((C=b==null?void 0:b[this.type])==null?void 0:C[l],(I=b==null?void 0:b.series)==null?void 0:I[l]);return w&&!hn(A)?g!==w:g!==_n(A,g)}onMouseOver(){let l=this.chart,f=l.hoverSeries,g=l.pointer;g==null||g.setHoverChartIndex(),f&&f!==this&&f.onMouseOut(),this.options.events.mouseOver&&nn(this,"mouseOver"),this.setState("hover"),l.hoverSeries=this}onMouseOut(){let l=this.options,f=this.chart,g=f.tooltip,b=f.hoverPoint;f.hoverSeries=null,b&&b.onMouseOut(),this&&l.events.mouseOut&&nn(this,"mouseOut"),g&&!this.stickyTracking&&(!g.shared||this.noSharedTooltip)&&g.hide(),f.series.forEach(function(w){w.setState("",!0)})}setState(l,f){let g=this,b=g.options,w=g.graph,A=b.inactiveOtherPoints,C=b.states,I=_n(C[l||"normal"]&&C[l||"normal"].animation,g.chart.options.chart.animation),R=b.lineWidth,U=b.opacity;if(l=l||"",g.state!==l&&([g.group,g.markerGroup,g.dataLabelsGroup].forEach(function(F){F&&(g.state&&F.removeClass("highcharts-series-"+g.state),l&&F.addClass("highcharts-series-"+l))}),g.state=l,!g.chart.styledMode)){if(C[l]&&C[l].enabled===!1)return;if(l&&(R=C[l].lineWidth||R+(C[l].lineWidthPlus||0),U=_n(C[l].opacity,U)),w&&!w.dashstyle&&Ln(R))for(let F of[w,...this.zones.map(G=>G.graph)])F==null||F.animate({"stroke-width":R},I);A||[g.group,g.markerGroup,g.dataLabelsGroup,g.labelBySeries].forEach(function(F){F&&F.animate({opacity:U},I)})}f&&A&&g.points&&g.setAllPointsToState(l||void 0)}setAllPointsToState(l){this.points.forEach(function(f){f.setState&&f.setState(l)})}setVisible(l,f){var I;let g=this,b=g.chart,w=b.options.chart.ignoreHiddenSeries,A=g.visible;g.visible=l=g.options.visible=g.userOptions.visible=l===void 0?!A:l;let C=l?"show":"hide";["group","dataLabelsGroup","markerGroup","tracker","tt"].forEach(R=>{var U;(U=g[R])==null||U[C]()}),(b.hoverSeries===g||((I=b.hoverPoint)==null?void 0:I.series)===g)&&g.onMouseOut(),g.legendItem&&b.legend.colorizeItem(g,l),g.isDirty=!0,g.options.stacking&&b.series.forEach(R=>{R.options.stacking&&R.visible&&(R.isDirty=!0)}),g.linkedSeries.forEach(R=>{R.setVisible(l,!1)}),w&&(b.isDirtyBox=!0),nn(g,C),f!==!1&&b.redraw()}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}select(l){this.selected=l=this.options.selected=l===void 0?!this.selected:l,this.checkbox&&(this.checkbox.checked=l),nn(this,l?"select":"unselect")}shouldShowTooltip(l,f,g={}){return g.series=this,g.visiblePlotOnly=!0,this.chart.isInsidePlot(l,f,g)}drawLegendSymbol(l,f){var g;(g=Ts[this.options.legendSymbol||"rectangle"])==null||g.call(this,l,f)}}Ir.defaultOptions={lineWidth:2,allowPointSelect:!1,crisp:!0,showCheckbox:!1,animation:{duration:1e3},enableMouseTracking:!0,events:{},marker:{enabledThreshold:2,lineColor:"#ffffff",lineWidth:0,radius:4,states:{normal:{animation:!0},hover:{animation:{duration:150},enabled:!0,radiusPlus:2,lineWidthPlus:1},select:{fillColor:"#cccccc",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{animation:{},align:"center",borderWidth:0,defer:!0,formatter:function(){let{numberFormatter:B}=this.series.chart;return typeof this.y!="number"?"":B(this.y,-1)},padding:5,style:{fontSize:"0.7em",fontWeight:"bold",color:"contrast",textOutline:"1px contrast"},verticalAlign:"bottom",x:0,y:0},cropThreshold:300,opacity:1,pointRange:0,softThreshold:!0,states:{normal:{animation:!0},hover:{animation:{duration:150},lineWidthPlus:1,marker:{},halo:{size:10,opacity:.25}},select:{animation:{duration:0}},inactive:{animation:{duration:150},opacity:.2}},stickyTracking:!0,turboThreshold:1e3,findNearestPointBy:"x"},Ir.types=bs.seriesTypes,Ir.registerType=bs.registerSeriesType,Ir.keepProps=["colorIndex","eventOptions","navigatorSeries","symbolIndex","baseSeries"],Ir.keepPropsForPoints=["data","isDirtyData","isDirtyCanvas","points","dataTable","processedData","xIncrement","cropped","_hasPointMarkers","hasDataLabels","nodes","layout","level","mapMap","mapData","minY","maxY","minX","maxX","transformGroups"],Hh(Ir.prototype,{axisTypes:["xAxis","yAxis"],coll:"series",colorCounter:0,directTouch:!1,invertible:!0,isCartesian:!0,kdAxisArray:["clientX","plotY"],parallelArrays:["x","y"],pointClass:et,requireSorting:!0,sorted:!0}),bs.series=Ir;let ar=Ir,{animObject:cl,setAnimation:aa}=mn,{registerEventOptions:hl}=Lc,{composed:Zl,marginNames:Yl}=kt,{distribute:qx}=xa,{format:Zx}=ir,{addEvent:qf,createElement:Yx,css:u_,defined:Zf,discardElement:la,find:Kx,fireEvent:ul,isNumber:yn,merge:gi,pick:Jn,pushUnique:Yf,relativeLength:$r,stableSort:d_,syncTimeout:f_}=_t;class co{constructor(l,f){this.allItems=[],this.initialItemY=0,this.itemHeight=0,this.itemMarginBottom=0,this.itemMarginTop=0,this.itemX=0,this.itemY=0,this.lastItemY=0,this.lastLineHeight=0,this.legendHeight=0,this.legendWidth=0,this.maxItemWidth=0,this.maxLegendWidth=0,this.offsetWidth=0,this.padding=0,this.pages=[],this.symbolHeight=0,this.symbolWidth=0,this.titleHeight=0,this.totalItemWidth=0,this.widthOption=0,this.chart=l,this.setOptions(f),f.enabled&&(this.render(),hl(this,f),qf(this.chart,"endResize",function(){this.legend.positionCheckboxes()})),qf(this.chart,"render",()=>{this.options.enabled&&this.proximate&&(this.proximatePositions(),this.positionItems())})}setOptions(l){let f=Jn(l.padding,8);this.options=l,this.chart.styledMode||(this.itemStyle=l.itemStyle,this.itemHiddenStyle=gi(this.itemStyle,l.itemHiddenStyle)),this.itemMarginTop=l.itemMarginTop,this.itemMarginBottom=l.itemMarginBottom,this.padding=f,this.initialItemY=f-5,this.symbolWidth=Jn(l.symbolWidth,16),this.pages=[],this.proximate=l.layout==="proximate"&&!this.chart.inverted,this.baseline=void 0}update(l,f){let g=this.chart;this.setOptions(gi(!0,this.options,l)),"events"in this.options&&hl(this,this.options),this.destroy(),g.isDirtyLegend=g.isDirtyBox=!0,Jn(f,!0)&&g.redraw(),ul(this,"afterUpdate",{redraw:f})}colorizeItem(l,f){var R;let g=l.color,{area:b,group:w,label:A,line:C,symbol:I}=l.legendItem||{};if((l instanceof ar||l instanceof et)&&(l.color=((R=l.options)==null?void 0:R.legendSymbolColor)||g),w==null||w[f?"removeClass":"addClass"]("highcharts-legend-item-hidden"),!this.chart.styledMode){let{itemHiddenStyle:U={}}=this,F=U.color,{fillColor:G,fillOpacity:Z,lineColor:J,marker:ot}=l.options,rt=it=>(!f&&(it.fill&&(it.fill=F),it.stroke&&(it.stroke=F)),it);A==null||A.css(gi(f?this.itemStyle:U)),C==null||C.attr(rt({stroke:J||l.color})),I&&I.attr(rt(ot&&I.isMarker?l.pointAttribs():{fill:l.color})),b==null||b.attr(rt({fill:G||l.color,"fill-opacity":G?1:Z??.75}))}l.color=g,ul(this,"afterColorizeItem",{item:l,visible:f})}positionItems(){this.allItems.forEach(this.positionItem,this),this.chart.isResizing||this.positionCheckboxes()}positionItem(l){let{group:f,x:g=0,y:b=0}=l.legendItem||{},w=this.options,A=w.symbolPadding,C=!w.rtl,I=l.checkbox;if(f!=null&&f.element){let R={translateX:C?g:this.legendWidth-g-2*A-4,translateY:b};f[Zf(f.translateY)?"animate":"attr"](R,void 0,()=>{ul(this,"afterPositionItem",{item:l})})}I&&(I.x=g,I.y=b)}destroyItem(l){let f=l.checkbox,g=l.legendItem||{};for(let b of["group","label","line","symbol"])g[b]&&(g[b]=g[b].destroy());f&&la(f),l.legendItem=void 0}destroy(){for(let l of this.getAllItems())this.destroyItem(l);for(let l of["clipRect","up","down","pager","nav","box","title","group"])this[l]&&(this[l]=this[l].destroy());this.display=null}positionCheckboxes(){var w;let l,f=(w=this.group)==null?void 0:w.alignAttr,g=this.clipHeight||this.legendHeight,b=this.titleHeight;f&&(l=f.translateY,this.allItems.forEach(function(A){let C,I=A.checkbox;I&&(C=l+b+I.y+(this.scrollOffset||0)+3,u_(I,{left:f.translateX+A.checkboxOffset+I.x-20+"px",top:C+"px",display:this.proximate||C>l-6&&C<l+g-6?"":"none"}))},this))}renderTitle(){let l=this.options,f=this.padding,g=l.title,b,w=0;g.text&&(this.title||(this.title=this.chart.renderer.label(g.text,f-3,f-4,void 0,void 0,void 0,l.useHTML,void 0,"legend-title").attr({zIndex:1}),this.chart.styledMode||this.title.css(g.style),this.title.add(this.group)),g.width||this.title.css({width:this.maxLegendWidth+"px"}),w=(b=this.title.getBBox()).height,this.offsetWidth=b.width,this.contentGroup.attr({translateY:w})),this.titleHeight=w}setText(l){let f=this.options;l.legendItem.label.attr({text:f.labelFormat?Zx(f.labelFormat,l,this.chart):f.labelFormatter.call(l)})}renderItem(l){var le;let f=l.legendItem=l.legendItem||{},g=this.chart,b=g.renderer,w=this.options,A=w.layout==="horizontal",C=this.symbolWidth,I=w.symbolPadding||0,R=this.itemStyle,U=this.itemHiddenStyle,F=A?Jn(w.itemDistance,20):0,G=!w.rtl,Z=!l.series,J=!Z&&l.series.drawLegendSymbol?l.series:l,ot=J.options,rt=!!this.createCheckboxForItem&&ot&&ot.showCheckbox,it=w.useHTML,ct=l.options.className,dt=f.label,Ht=C+I+F+20*!!rt;!dt&&(f.group=b.g("legend-item").addClass("highcharts-"+J.type+"-series highcharts-color-"+l.colorIndex+(ct?" "+ct:"")+(Z?" highcharts-series-"+l.index:"")).attr({zIndex:1}).add(this.scrollGroup),f.label=dt=b.text("",G?C+I:-I,this.baseline||0,it),g.styledMode||dt.css(gi(l.visible?R:U)),dt.attr({align:G?"left":"right",zIndex:2}).add(f.group),!this.baseline&&(this.fontMetrics=b.fontMetrics(dt),this.baseline=this.fontMetrics.f+3+this.itemMarginTop,dt.attr("y",this.baseline),this.symbolHeight=Jn(w.symbolHeight,this.fontMetrics.f),w.squareSymbol&&(this.symbolWidth=Jn(w.symbolWidth,Math.max(this.symbolHeight,16)),Ht=this.symbolWidth+I+F+20*!!rt,G&&dt.attr("x",this.symbolWidth+I))),J.drawLegendSymbol(this,l),this.setItemEvents&&this.setItemEvents(l,dt,it)),rt&&!l.checkbox&&this.createCheckboxForItem&&this.createCheckboxForItem(l),this.colorizeItem(l,l.visible),(g.styledMode||!R.width)&&dt.css({width:(w.itemWidth||this.widthOption||g.spacingBox.width)-Ht+"px"}),this.setText(l);let Bt=dt.getBBox(),Vt=((le=this.fontMetrics)==null?void 0:le.h)||0;l.itemWidth=l.checkboxOffset=w.itemWidth||f.labelWidth||Bt.width+Ht,this.maxItemWidth=Math.max(this.maxItemWidth,l.itemWidth),this.totalItemWidth+=l.itemWidth,this.itemHeight=l.itemHeight=Math.round(f.labelHeight||(Bt.height>1.5*Vt?Bt.height:Vt))}layoutItem(l){let f=this.options,g=this.padding,b=f.layout==="horizontal",w=l.itemHeight,A=this.itemMarginBottom,C=this.itemMarginTop,I=b?Jn(f.itemDistance,20):0,R=this.maxLegendWidth,U=f.alignColumns&&this.totalItemWidth>R?this.maxItemWidth:l.itemWidth,F=l.legendItem||{};b&&this.itemX-g+U>R&&(this.itemX=g,this.lastLineHeight&&(this.itemY+=C+this.lastLineHeight+A),this.lastLineHeight=0),this.lastItemY=C+this.itemY+A,this.lastLineHeight=Math.max(w,this.lastLineHeight),F.x=this.itemX,F.y=this.itemY,b?this.itemX+=U:(this.itemY+=C+w+A,this.lastLineHeight=w),this.offsetWidth=this.widthOption||Math.max((b?this.itemX-g-(l.checkbox?0:I):U)+g,this.offsetWidth)}getAllItems(){let l=[];return this.chart.series.forEach(function(f){var b;let g=f==null?void 0:f.options;f&&Jn(g.showInLegend,!Zf(g.linkedTo)&&void 0,!0)&&(l=l.concat(((b=f.legendItem)==null?void 0:b.labels)||(g.legendType==="point"?f.data:f)))}),ul(this,"afterGetAllItems",{allItems:l}),l}getAlignment(){let l=this.options;return this.proximate?l.align.charAt(0)+"tv":l.floating?"":l.align.charAt(0)+l.verticalAlign.charAt(0)+l.layout.charAt(0)}adjustMargins(l,f){let g=this.chart,b=this.options,w=this.getAlignment();w&&[/(lth|ct|rth)/,/(rtv|rm|rbv)/,/(rbh|cb|lbh)/,/(lbv|lm|ltv)/].forEach(function(A,C){A.test(w)&&!Zf(l[C])&&(g[Yl[C]]=Math.max(g[Yl[C]],g.legend[(C+1)%2?"legendHeight":"legendWidth"]+[1,-1,-1,1][C]*b[C%2?"x":"y"]+Jn(b.margin,12)+f[C]+(g.titleOffset[C]||0)))})}proximatePositions(){let l,f=this.chart,g=[],b=this.options.align==="left";for(let w of(this.allItems.forEach(function(A){let C,I,R=b,U,F;A.yAxis&&(A.xAxis.options.reversed&&(R=!R),A.points&&(C=Kx(R?A.points:A.points.slice(0).reverse(),function(G){return yn(G.plotY)})),I=this.itemMarginTop+A.legendItem.label.getBBox().height+this.itemMarginBottom,F=A.yAxis.top-f.plotTop,U=A.visible?(C?C.plotY:A.yAxis.height)+(F-.3*I):F+A.yAxis.height,g.push({target:U,size:I,item:A}))},this),qx(g,f.plotHeight)))l=w.item.legendItem||{},yn(w.pos)&&(l.y=f.plotTop-f.spacing[0]+w.pos)}render(){let l=this.chart,f=l.renderer,g=this.options,b=this.padding,w=this.getAllItems(),A,C,I,R=this.group,U,F=this.box;this.itemX=b,this.itemY=this.initialItemY,this.offsetWidth=0,this.lastItemY=0,this.widthOption=$r(g.width,l.spacingBox.width-b),U=l.spacingBox.width-2*b-g.x,["rm","lm"].indexOf(this.getAlignment().substring(0,2))>-1&&(U/=2),this.maxLegendWidth=this.widthOption||U,R||(this.group=R=f.g("legend").addClass(g.className||"").attr({zIndex:7}).add(),this.contentGroup=f.g().attr({zIndex:1}).add(R),this.scrollGroup=f.g().add(this.contentGroup)),this.renderTitle(),d_(w,(G,Z)=>{var J,ot;return(((J=G.options)==null?void 0:J.legendIndex)||0)-(((ot=Z.options)==null?void 0:ot.legendIndex)||0)}),g.reversed&&w.reverse(),this.allItems=w,this.display=A=!!w.length,this.lastLineHeight=0,this.maxItemWidth=0,this.totalItemWidth=0,this.itemHeight=0,w.forEach(this.renderItem,this),w.forEach(this.layoutItem,this),C=(this.widthOption||this.offsetWidth)+b,I=this.lastItemY+this.lastLineHeight+this.titleHeight,I=this.handleOverflow(I)+b,F||(this.box=F=f.rect().addClass("highcharts-legend-box").attr({r:g.borderRadius}).add(R)),l.styledMode||F.attr({stroke:g.borderColor,"stroke-width":g.borderWidth||0,fill:g.backgroundColor||"none"}).shadow(g.shadow),C>0&&I>0&&F[F.placed?"animate":"attr"](F.crisp.call({},{x:0,y:0,width:C,height:I},F.strokeWidth())),R[A?"show":"hide"](),l.styledMode&&R.getStyle("display")==="none"&&(C=I=0),this.legendWidth=C,this.legendHeight=I,A&&this.align(),this.proximate||this.positionItems(),ul(this,"afterRender")}align(l=this.chart.spacingBox){let f=this.chart,g=this.options,b=l.y;/(lth|ct|rth)/.test(this.getAlignment())&&f.titleOffset[0]>0?b+=f.titleOffset[0]:/(lbh|cb|rbh)/.test(this.getAlignment())&&f.titleOffset[2]>0&&(b-=f.titleOffset[2]),b!==l.y&&(l=gi(l,{y:b})),f.hasRendered||(this.group.placed=!1),this.group.align(gi(g,{width:this.legendWidth,height:this.legendHeight,verticalAlign:this.proximate?"top":g.verticalAlign}),!0,l)}handleOverflow(l){let f=this,g=this.chart,b=g.renderer,w=this.options,A=w.y,C=w.verticalAlign==="top",I=this.padding,R=w.maxHeight,U=w.navigation,F=Jn(U.animation,!0),G=U.arrowSize||12,Z=this.pages,J=this.allItems,ot=function(Kt){typeof Kt=="number"?le.attr({height:Kt}):le&&(f.clipRect=le.destroy(),f.contentGroup.clip()),f.contentGroup.div&&(f.contentGroup.div.style.clip=Kt?"rect("+I+"px,9999px,"+(I+Kt)+"px,0)":"auto")},rt=function(Kt){return f[Kt]=b.circle(0,0,1.3*G).translate(G/2,G/2).add(Vt),g.styledMode||f[Kt].attr("fill","rgba(0,0,0,0.0001)"),f[Kt]},it,ct,dt,Ht,Bt=g.spacingBox.height+(C?-A:A)-I,Vt=this.nav,le=this.clipRect;return w.layout!=="horizontal"||w.verticalAlign==="middle"||w.floating||(Bt/=2),R&&(Bt=Math.min(Bt,R)),Z.length=0,l&&Bt>0&&l>Bt&&U.enabled!==!1?(this.clipHeight=it=Math.max(Bt-20-this.titleHeight-I,0),this.currentPage=Jn(this.currentPage,1),this.fullHeight=l,J.forEach((Kt,ce)=>{let Ee=(dt=Kt.legendItem||{}).y||0,Be=Math.round(dt.label.getBBox().height),$e=Z.length;(!$e||Ee-Z[$e-1]>it&&(ct||Ee)!==Z[$e-1])&&(Z.push(ct||Ee),$e++),dt.pageIx=$e-1,ct&&Ht&&(Ht.pageIx=$e-1),ce===J.length-1&&Ee+Be-Z[$e-1]>it&&Ee>Z[$e-1]&&(Z.push(Ee),dt.pageIx=$e),Ee!==ct&&(ct=Ee),Ht=dt}),le||(le=f.clipRect=b.clipRect(0,I-2,9999,0),f.contentGroup.clip(le)),ot(it),Vt||(this.nav=Vt=b.g().attr({zIndex:1}).add(this.group),this.up=b.symbol("triangle",0,0,G,G).add(Vt),rt("upTracker").on("click",function(){f.scroll(-1,F)}),this.pager=b.text("",15,10).addClass("highcharts-legend-navigation"),!g.styledMode&&U.style&&this.pager.css(U.style),this.pager.add(Vt),this.down=b.symbol("triangle-down",0,0,G,G).add(Vt),rt("downTracker").on("click",function(){f.scroll(1,F)})),f.scroll(0),l=Bt):Vt&&(ot(),this.nav=Vt.destroy(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0),l}scroll(l,f){let g=this.chart,b=this.pages,w=b.length,A=this.clipHeight,C=this.options.navigation,I=this.pager,R=this.padding,U=this.currentPage+l;U>w&&(U=w),U>0&&(f!==void 0&&aa(f,g),this.nav.attr({translateX:R,translateY:A+this.padding+7+this.titleHeight,visibility:"inherit"}),[this.up,this.upTracker].forEach(function(F){F.attr({class:U===1?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})}),I.attr({text:U+"/"+w}),[this.down,this.downTracker].forEach(function(F){F.attr({x:18+this.pager.getBBox().width,class:U===w?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})},this),g.styledMode||(this.up.attr({fill:U===1?C.inactiveColor:C.activeColor}),this.upTracker.css({cursor:U===1?"default":"pointer"}),this.down.attr({fill:U===w?C.inactiveColor:C.activeColor}),this.downTracker.css({cursor:U===w?"default":"pointer"})),this.scrollOffset=-b[U-1]+this.initialItemY,this.scrollGroup.animate({translateY:this.scrollOffset}),this.currentPage=U,this.positionCheckboxes(),f_(()=>{ul(this,"afterScroll",{currentPage:U})},cl(Jn(f,g.renderer.globalAnimation,!0)).duration))}setItemEvents(l,f,g){let b=this,w=l.legendItem||{},A=b.chart.renderer.boxWrapper,C=l instanceof et,I=l instanceof ar,R="highcharts-legend-"+(C?"point":"series")+"-active",U=b.chart.styledMode,F=g?[f,w.symbol]:[w.group],G=Z=>{b.allItems.forEach(J=>{l!==J&&[J].concat(J.linkedSeries||[]).forEach(ot=>{ot.setState(Z,!C)})})};for(let Z of F)Z&&Z.on("mouseover",function(){l.visible&&G("inactive"),l.setState("hover"),l.visible&&A.addClass(R),U||f.css(b.options.itemHoverStyle)}).on("mouseout",function(){b.chart.styledMode||f.css(gi(l.visible?b.itemStyle:b.itemHiddenStyle)),G(""),A.removeClass(R),l.setState()}).on("click",function(J){let ot=function(){l.setVisible&&l.setVisible(),G(l.visible?"inactive":"")};A.removeClass(R),ul(b,"itemClick",{browserEvent:J,legendItem:l},ot),C?l.firePointEvent("legendItemClick",{browserEvent:J}):I&&ul(l,"legendItemClick",{browserEvent:J})})}createCheckboxForItem(l){l.checkbox=Yx("input",{type:"checkbox",className:"highcharts-legend-checkbox",checked:l.selected,defaultChecked:l.selected},this.options.itemCheckboxStyle,this.chart.container),qf(l.checkbox,"click",function(f){let g=f.target;ul(l.series||l,"checkboxClick",{checked:g.checked,item:l},function(){l.select()})})}}(function(B){B.compose=function(l){Yf(Zl,"Core.Legend")&&qf(l,"beforeMargins",function(){this.legend=new B(this,this.options.legend)})}})(co||(co={}));let Kf=co,{animate:dl,animObject:wd,setAnimation:fl}=mn,{defaultOptions:Td}=At,{numberFormat:Jf}=ir,{registerEventOptions:Em}=Lc,{charts:Kl,doc:Sd,marginNames:Qf,svg:p_,win:qh}=kt,{seriesTypes:Jl}=bs,{addEvent:ca,attr:tp,createElement:ep,css:Lr,defined:zo,diffObjects:Gr,discardElement:Ed,erase:Mr,error:Wr,extend:ka,find:rn,fireEvent:gs,getAlignFactor:Md,getStyle:ho,isArray:Jx,isNumber:Zh,isObject:m_,isString:Ad,merge:Ar,objectEach:ip,pick:lr,pInt:g_,relativeLength:Mm,removeEvent:__,splat:sp,syncTimeout:y_,uniqueKey:x_}=_t;class Oo{static chart(l,f,g){return new Oo(l,f,g)}constructor(l,f,g){this.sharedClips={};let b=[...arguments];(Ad(l)||l.nodeName)&&(this.renderTo=b.shift()),this.init(b[0],b[1])}setZoomOptions(){let l=this.options.chart,f=l.zooming;this.zooming={...f,type:lr(l.zoomType,f.type),key:lr(l.zoomKey,f.key),pinchType:lr(l.pinchType,f.pinchType),singleTouch:lr(l.zoomBySingleTouch,f.singleTouch,!1),resetButton:Ar(f.resetButton,l.resetZoomButton)}}init(l,f){gs(this,"init",{args:arguments},function(){var A;let g=Ar(Td,l),b=g.chart,w=this.renderTo||b.renderTo;this.userOptions=ka({},l),(this.renderTo=Ad(w)?Sd.getElementById(w):w)||Wr(13,!0,this),this.margin=[],this.spacing=[],this.labelCollectors=[],this.callback=f,this.isResizing=0,this.options=g,this.axes=[],this.series=[],this.locale=g.lang.locale??((A=this.renderTo.closest("[lang]"))==null?void 0:A.lang),this.time=new fr(ka(g.time||{},{locale:this.locale}),g.lang),g.time=this.time.options,this.numberFormatter=(b.numberFormatter||Jf).bind(this),this.styledMode=b.styledMode,this.hasCartesianSeries=b.showAxes,this.index=Kl.length,Kl.push(this),kt.chartCount++,Em(this,b),this.xAxis=[],this.yAxis=[],this.pointCount=this.colorCounter=this.symbolCounter=0,this.setZoomOptions(),gs(this,"afterInit"),this.firstRender()})}initSeries(l){let f=this.options.chart,g=l.type||f.type,b=Jl[g];b||Wr(17,!0,this,{missingModuleFor:g});let w=new b;return typeof w.init=="function"&&w.init(this,l),w}setSortedData(){this.getSeriesOrderByLinks().forEach(function(l){l.points||l.data||!l.enabledDataSorting||l.setData(l.options.data,!1)})}getSeriesOrderByLinks(){return this.series.concat().sort(function(l,f){return l.linkedSeries.length||f.linkedSeries.length?f.linkedSeries.length-l.linkedSeries.length:0})}orderItems(l,f=0){let g=this[l],b=this.options[l]=sp(this.options[l]).slice(),w=this.userOptions[l]=this.userOptions[l]?sp(this.userOptions[l]).slice():[];if(this.hasRendered&&(b.splice(f),w.splice(f)),g)for(let A=f,C=g.length;A<C;++A){let I=g[A];I&&(I.index=A,I instanceof ar&&(I.name=I.getName()),I.options.isInternal||(b[A]=I.options,w[A]=I.userOptions))}}getClipBox(l,f){var U,F;let g=this.inverted,{xAxis:b,yAxis:w}=l||{},{x:A,y:C,width:I,height:R}=Ar(this.clipBox);return l&&(b&&b.len!==this.plotSizeX&&(I=b.len),w&&w.len!==this.plotSizeY&&(R=w.len),g&&!l.invertible&&([I,R]=[R,I])),f&&(A+=((U=g?w:b)==null?void 0:U.pos)??this.plotLeft,C+=((F=g?b:w)==null?void 0:F.pos)??this.plotTop),{x:A,y:C,width:I,height:R}}isInsidePlot(l,f,g={}){var rt;let{inverted:b,plotBox:w,plotLeft:A,plotTop:C,scrollablePlotBox:I}=this,{scrollLeft:R=0,scrollTop:U=0}=g.visiblePlotOnly&&((rt=this.scrollablePlotArea)==null?void 0:rt.scrollingContainer)||{},F=g.series,G=g.visiblePlotOnly&&I||w,Z=g.inverted?f:l,J=g.inverted?l:f,ot={x:Z,y:J,isInsidePlot:!0,options:g};if(!g.ignoreX){let it=F&&(b&&!this.polar?F.yAxis:F.xAxis)||{pos:A,len:1/0},ct=g.paneCoordinates?it.pos+Z:A+Z;ct>=Math.max(R+A,it.pos)&&ct<=Math.min(R+A+G.width,it.pos+it.len)||(ot.isInsidePlot=!1)}if(!g.ignoreY&&ot.isInsidePlot){let it=!b&&g.axis&&!g.axis.isXAxis&&g.axis||F&&(b?F.xAxis:F.yAxis)||{pos:C,len:1/0},ct=g.paneCoordinates?it.pos+J:C+J;ct>=Math.max(U+C,it.pos)&&ct<=Math.min(U+C+G.height,it.pos+it.len)||(ot.isInsidePlot=!1)}return gs(this,"afterIsInsidePlot",ot),ot.isInsidePlot}redraw(l){gs(this,"beforeRedraw");let f=this.hasCartesianSeries?this.axes:this.colorAxis||[],g=this.series,b=this.pointer,w=this.legend,A=this.userOptions.legend,C=this.renderer,I=C.isHidden(),R=[],U,F,G,Z=this.isDirtyBox,J=this.isDirtyLegend,ot;for(C.rootFontSize=C.boxWrapper.getStyle("font-size"),this.setResponsive&&this.setResponsive(!1),fl(!!this.hasRendered&&l,this),I&&this.temporaryDisplay(),this.layOutTitles(!1),G=g.length;G--;)if(((ot=g[G]).options.stacking||ot.options.centerInCategory)&&(F=!0,ot.isDirty)){U=!0;break}if(U)for(G=g.length;G--;)(ot=g[G]).options.stacking&&(ot.isDirty=!0);g.forEach(function(rt){rt.isDirty&&(rt.options.legendType==="point"?(typeof rt.updateTotals=="function"&&rt.updateTotals(),J=!0):A&&(A.labelFormatter||A.labelFormat)&&(J=!0)),rt.isDirtyData&&gs(rt,"updatedData")}),J&&w&&w.options.enabled&&(w.render(),this.isDirtyLegend=!1),F&&this.getStacks(),f.forEach(function(rt){rt.updateNames(),rt.setScale()}),this.getMargins(),f.forEach(function(rt){rt.isDirty&&(Z=!0)}),f.forEach(function(rt){let it=rt.min+","+rt.max;rt.extKey!==it&&(rt.extKey=it,R.push(function(){gs(rt,"afterSetExtremes",ka(rt.eventArgs,rt.getExtremes())),delete rt.eventArgs})),(Z||F)&&rt.redraw()}),Z&&this.drawChartBox(),gs(this,"predraw"),g.forEach(function(rt){(Z||rt.isDirty)&&rt.visible&&rt.redraw(),rt.isDirtyData=!1}),b&&b.reset(!0),C.draw(),gs(this,"redraw"),gs(this,"render"),I&&this.temporaryDisplay(!0),R.forEach(function(rt){rt.call()})}get(l){let f=this.series;function g(w){return w.id===l||w.options&&w.options.id===l}let b=rn(this.axes,g)||rn(this.series,g);for(let w=0;!b&&w<f.length;w++)b=rn(f[w].points||[],g);return b}createAxes(){let l=this.userOptions;for(let f of(gs(this,"createAxes"),["xAxis","yAxis"]))for(let g of l[f]=sp(l[f]||{}))new Ea(this,g,f);gs(this,"afterCreateAxes")}getSelectedPoints(){return this.series.reduce((l,f)=>(f.getPointsCollection().forEach(g=>{lr(g.selectedStaging,g.selected)&&l.push(g)}),l),[])}getSelectedSeries(){return this.series.filter(l=>l.selected)}setTitle(l,f,g){this.applyDescription("title",l),this.applyDescription("subtitle",f),this.applyDescription("caption",void 0),this.layOutTitles(g)}applyDescription(l,f){var A;let g=this,b=this.options[l]=Ar(this.options[l],f),w=this[l];w&&f&&(this[l]=w=w.destroy()),b&&!w&&((w=this.renderer.text(b.text,0,0,b.useHTML).attr({align:b.align,class:"highcharts-"+l,zIndex:b.zIndex||4}).css({textOverflow:"ellipsis",whiteSpace:"nowrap"}).add()).update=function(C,I){g.applyDescription(l,C),g.layOutTitles(I)},this.styledMode||w.css(ka(l==="title"?{fontSize:this.options.isStock?"1em":"1.2em"}:{},b.style)),w.textPxLength=w.getBBox().width,w.css({whiteSpace:(A=b.style)==null?void 0:A.whiteSpace}),this[l]=w)}layOutTitles(l=!0){var C,I,R,U;let f=[0,0,0],{options:g,renderer:b,spacingBox:w}=this;["title","subtitle","caption"].forEach(F=>{var rt;let G=this[F],Z=this.options[F],J=Ar(w),ot=(G==null?void 0:G.textPxLength)||0;if(G&&Z){gs(this,"layOutTitle",{alignTo:J,key:F,textPxLength:ot});let it=b.fontMetrics(G),ct=it.b,dt=it.h,Ht=Z.verticalAlign||"top",Bt=Ht==="top",Vt=Bt&&Z.minScale||1,le=F==="title"?Bt?-3:0:Bt?f[0]+2:0,Kt=Math.min(J.width/ot,1),ce=Math.max(Vt,Kt),Ee=Ar({y:Ht==="bottom"?ct:le+ct},{align:F==="title"?Kt<Vt?"left":"center":(rt=this.title)==null?void 0:rt.alignValue},Z),Be=(Z.width||(Kt>Vt?this.chartWidth:J.width)/ce)+"px";G.alignValue!==Ee.align&&(G.placed=!1);let $e=Math.round(G.css({width:Be}).getBBox(Z.useHTML).height);if(Ee.height=$e,G.align(Ee,!1,J).attr({align:Ee.align,scaleX:ce,scaleY:ce,"transform-origin":`${J.x+ot*ce*Md(Ee.align)} ${dt}`}),!Z.floating){let Ae=$e*($e<1.2*dt?1:ce);Ht==="top"?f[0]=Math.ceil(f[0]+Ae):Ht==="bottom"&&(f[2]=Math.ceil(f[2]+Ae))}}},this),f[0]&&(((C=g.title)==null?void 0:C.verticalAlign)||"top")==="top"&&(f[0]+=((I=g.title)==null?void 0:I.margin)||0),f[2]&&((R=g.caption)==null?void 0:R.verticalAlign)==="bottom"&&(f[2]+=((U=g.caption)==null?void 0:U.margin)||0);let A=!this.titleOffset||this.titleOffset.join(",")!==f.join(",");this.titleOffset=f,gs(this,"afterLayOutTitles"),!this.isDirtyBox&&A&&(this.isDirtyBox=this.isDirtyLegend=A,this.hasRendered&&l&&this.isDirtyBox&&this.redraw())}getContainerBox(){let l=[].map.call(this.renderTo.children,g=>{if(g!==this.container){let b=g.style.display;return g.style.display="none",[g,b]}}),f={width:ho(this.renderTo,"width",!0)||0,height:ho(this.renderTo,"height",!0)||0};return l.filter(Boolean).forEach(([g,b])=>{g.style.display=b}),f}getChartSize(){var A;let l=this.options.chart,f=l.width,g=l.height,b=this.getContainerBox(),w=b.height<=1||!((A=this.renderTo.parentElement)!=null&&A.style.height)&&this.renderTo.style.height==="100%";this.chartWidth=Math.max(0,f||b.width||600),this.chartHeight=Math.max(0,Mm(g,this.chartWidth)||(w?400:b.height)),this.containerBox=b}temporaryDisplay(l){let f=this.renderTo,g;if(l)for(;f!=null&&f.style;)f.hcOrigStyle&&(Lr(f,f.hcOrigStyle),delete f.hcOrigStyle),f.hcOrigDetached&&(Sd.body.removeChild(f),f.hcOrigDetached=!1),f=f.parentNode;else for(;f!=null&&f.style&&(Sd.body.contains(f)||f.parentNode||(f.hcOrigDetached=!0,Sd.body.appendChild(f)),(ho(f,"display",!1)==="none"||f.hcOricDetached)&&(f.hcOrigStyle={display:f.style.display,height:f.style.height,overflow:f.style.overflow},g={display:"block",overflow:"hidden"},f!==this.renderTo&&(g.height=0),Lr(f,g),f.offsetWidth||f.style.setProperty("display","block","important")),(f=f.parentNode)!==Sd.body););}setClassName(l){this.container.className="highcharts-container "+(l||"")}getContainer(){var G,Z;let l,f=this.options,g=f.chart,b="data-highcharts-chart",w=x_(),A=this.renderTo,C=g_(tp(A,b));Zh(C)&&Kl[C]&&Kl[C].hasRendered&&Kl[C].destroy(),tp(A,b,this.index),A.innerHTML=Is.emptyHTML,g.skipClone||A.offsetWidth||this.temporaryDisplay(),this.getChartSize();let I=this.chartHeight,R=this.chartWidth;Lr(A,{overflow:"hidden"}),this.styledMode||(l=ka({position:"relative",overflow:"hidden",width:R+"px",height:I+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)",userSelect:"none","touch-action":"manipulation",outline:"none",padding:"0px"},g.style||{}));let U=ep("div",{id:w},l,A);this.container=U,this.getChartSize(),R===this.chartWidth||(R=this.chartWidth,this.styledMode||Lr(U,{width:lr((G=g.style)==null?void 0:G.width,R+"px")})),this.containerBox=this.getContainerBox(),this._cursor=U.style.cursor;let F=g.renderer||!p_?io.getRendererType(g.renderer):kc;if(this.renderer=new F(U,R,I,void 0,g.forExport,(Z=f.exporting)==null?void 0:Z.allowHTML,this.styledMode),fl(void 0,this),this.setClassName(g.className),this.styledMode)for(let J in f.defs)this.renderer.definition(f.defs[J]);else this.renderer.setStyle(g.style);this.renderer.chartIndex=this.index,gs(this,"afterGetContainer")}getMargins(l){var w;let{spacing:f,margin:g,titleOffset:b}=this;this.resetMargins(),b[0]&&!zo(g[0])&&(this.plotTop=Math.max(this.plotTop,b[0]+f[0])),b[2]&&!zo(g[2])&&(this.marginBottom=Math.max(this.marginBottom,b[2]+f[2])),(w=this.legend)!=null&&w.display&&this.legend.adjustMargins(g,f),gs(this,"getMargins"),l||this.getAxisMargins()}getAxisMargins(){let l=this,f=l.axisOffset=[0,0,0,0],g=l.colorAxis,b=l.margin,w=function(A){A.forEach(function(C){C.visible&&C.getOffset()})};l.hasCartesianSeries?w(l.axes):g!=null&&g.length&&w(g),Qf.forEach(function(A,C){zo(b[C])||(l[A]+=f[C])}),l.setChartSize()}getOptions(){return Gr(this.userOptions,Td)}reflow(l){var w;let f=this,g=f.containerBox,b=f.getContainerBox();(w=f.pointer)==null||delete w.chartPosition,!f.isPrinting&&!f.isResizing&&g&&b.width&&((b.width!==g.width||b.height!==g.height)&&(_t.clearTimeout(f.reflowTimeout),f.reflowTimeout=y_(function(){f.container&&f.setSize(void 0,void 0,!1)},100*!!l)),f.containerBox=b)}setReflow(){let l=this,f=g=>{var b;(b=l.options)!=null&&b.chart.reflow&&l.hasLoaded&&l.reflow(g)};if(typeof ResizeObserver=="function")new ResizeObserver(f).observe(l.renderTo);else{let g=ca(qh,"resize",f);ca(this,"destroy",g)}}setSize(l,f,g){let b=this,w=b.renderer;b.isResizing+=1,fl(g,b);let A=w.globalAnimation;b.oldChartHeight=b.chartHeight,b.oldChartWidth=b.chartWidth,l!==void 0&&(b.options.chart.width=l),f!==void 0&&(b.options.chart.height=f),b.getChartSize();let{chartWidth:C,chartHeight:I,scrollablePixelsX:R=0,scrollablePixelsY:U=0}=b;(b.isDirtyBox||C!==b.oldChartWidth||I!==b.oldChartHeight)&&(b.styledMode||(A?dl:Lr)(b.container,{width:`${C+R}px`,height:`${I+U}px`},A),b.setChartSize(!0),w.setSize(C,I,A),b.axes.forEach(function(F){F.isDirty=!0,F.setScale()}),b.isDirtyLegend=!0,b.isDirtyBox=!0,b.layOutTitles(),b.getMargins(),b.redraw(A),b.oldChartHeight=void 0,gs(b,"resize"),setTimeout(()=>{b&&gs(b,"endResize")},wd(A).duration)),b.isResizing-=1}setChartSize(l){let f,g,b,w,{chartHeight:A,chartWidth:C,inverted:I,spacing:R,renderer:U}=this,F=this.clipOffset,G=Math[I?"floor":"round"];this.plotLeft=f=Math.round(this.plotLeft),this.plotTop=g=Math.round(this.plotTop),this.plotWidth=b=Math.max(0,Math.round(C-f-(this.marginRight??0))),this.plotHeight=w=Math.max(0,Math.round(A-g-(this.marginBottom??0))),this.plotSizeX=I?w:b,this.plotSizeY=I?b:w,this.spacingBox=U.spacingBox={x:R[3],y:R[0],width:C-R[3]-R[1],height:A-R[0]-R[2]},this.plotBox=U.plotBox={x:f,y:g,width:b,height:w},F&&(this.clipBox={x:G(F[3]),y:G(F[0]),width:G(this.plotSizeX-F[1]-F[3]),height:G(this.plotSizeY-F[0]-F[2])}),l||(this.axes.forEach(function(Z){Z.setAxisSize(),Z.setAxisTranslation()}),U.alignElements()),gs(this,"afterSetChartSize",{skipAxes:l})}resetMargins(){gs(this,"resetMargins");let l=this,f=l.options.chart,g=f.plotBorderWidth||0,b=Math.round(g)/2;["margin","spacing"].forEach(function(w){let A=f[w],C=m_(A)?A:[A,A,A,A];["Top","Right","Bottom","Left"].forEach(function(I,R){l[w][R]=lr(f[w+I],C[R])})}),Qf.forEach(function(w,A){l[w]=lr(l.margin[A],l.spacing[A])}),l.axisOffset=[0,0,0,0],l.clipOffset=[b,b,b,b],l.plotBorderWidth=g}drawChartBox(){let l=this.options.chart,f=this.renderer,g=this.chartWidth,b=this.chartHeight,w=this.styledMode,A=this.plotBGImage,C=l.backgroundColor,I=l.plotBackgroundColor,R=l.plotBackgroundImage,U=this.plotLeft,F=this.plotTop,G=this.plotWidth,Z=this.plotHeight,J=this.plotBox,ot=this.clipRect,rt=this.clipBox,it=this.chartBackground,ct=this.plotBackground,dt=this.plotBorder,Ht,Bt,Vt,le="animate";it||(this.chartBackground=it=f.rect().addClass("highcharts-background").add(),le="attr"),w?Ht=Bt=it.strokeWidth():(Bt=(Ht=l.borderWidth||0)+8*!!l.shadow,Vt={fill:C||"none"},(Ht||it["stroke-width"])&&(Vt.stroke=l.borderColor,Vt["stroke-width"]=Ht),it.attr(Vt).shadow(l.shadow)),it[le]({x:Bt/2,y:Bt/2,width:g-Bt-Ht%2,height:b-Bt-Ht%2,r:l.borderRadius}),le="animate",ct||(le="attr",this.plotBackground=ct=f.rect().addClass("highcharts-plot-background").add()),ct[le](J),!w&&(ct.attr({fill:I||"none"}).shadow(l.plotShadow),R&&(A?(R!==A.attr("href")&&A.attr("href",R),A.animate(J)):this.plotBGImage=f.image(R,U,F,G,Z).add())),ot?ot.animate({width:rt.width,height:rt.height}):this.clipRect=f.clipRect(rt),le="animate",dt||(le="attr",this.plotBorder=dt=f.rect().addClass("highcharts-plot-border").attr({zIndex:1}).add()),w||dt.attr({stroke:l.plotBorderColor,"stroke-width":l.plotBorderWidth||0,fill:"none"}),dt[le](dt.crisp(J,-dt.strokeWidth())),this.isDirtyBox=!1,gs(this,"afterDrawChartBox")}propFromSeries(){let l,f,g,b=this,w=b.options.chart,A=b.options.series;["inverted","angular","polar"].forEach(function(C){for(f=Jl[w.type],g=w[C]||f&&f.prototype[C],l=A==null?void 0:A.length;!g&&l--;)(f=Jl[A[l].type])&&f.prototype[C]&&(g=!0);b[C]=g})}linkSeries(l){let f=this,g=f.series;g.forEach(function(b){b.linkedSeries.length=0}),g.forEach(function(b){let{linkedTo:w}=b.options;if(Ad(w)){let A;(A=w===":previous"?f.series[b.index-1]:f.get(w))&&A.linkedParent!==b&&(A.linkedSeries.push(b),b.linkedParent=A,A.enabledDataSorting&&b.setDataSortingOptions(),b.visible=lr(b.options.visible,A.options.visible,b.visible))}}),gs(this,"afterLinkSeries",{isUpdating:l})}renderSeries(){this.series.forEach(function(l){l.translate(),l.render()})}render(){var U;let l=this.axes,f=this.colorAxis,g=this.renderer,b=this.options.chart.axisLayoutRuns||2,w=F=>{F.forEach(G=>{G.visible&&G.render()})},A=0,C=!0,I,R=0;for(let F of(this.setTitle(),gs(this,"beforeMargins"),(U=this.getStacks)==null||U.call(this),this.getMargins(!0),this.setChartSize(),l)){let{options:G}=F,{labels:Z}=G;if(this.hasCartesianSeries&&F.horiz&&F.visible&&Z.enabled&&F.series.length&&F.coll!=="colorAxis"&&!this.polar){A=G.tickLength,F.createGroups();let J=new ia(F,0,"",!0),ot=J.createLabel("x",Z);if(J.destroy(),ot&&lr(Z.reserveSpace,!Zh(G.crossing))&&(A=ot.getBBox().height+Z.distance+Math.max(G.offset||0,0)),A){ot==null||ot.destroy();break}}}for(this.plotHeight=Math.max(this.plotHeight-A,0);(C||I||b>1)&&R<b;){let F=this.plotWidth,G=this.plotHeight;for(let Z of l)R===0?Z.setScale():(Z.horiz&&C||!Z.horiz&&I)&&Z.setTickInterval(!0);R===0?this.getAxisMargins():this.getMargins(),C=F/this.plotWidth>(R?1:1.1),I=G/this.plotHeight>(R?1:1.05),R++}this.drawChartBox(),this.hasCartesianSeries?w(l):f!=null&&f.length&&w(f),this.seriesGroup||(this.seriesGroup=g.g("series-group").attr({zIndex:3}).shadow(this.options.chart.seriesGroupShadow).add()),this.renderSeries(),this.addCredits(),this.setResponsive&&this.setResponsive(),this.hasRendered=!0}addCredits(l){let f=this,g=Ar(!0,this.options.credits,l);g.enabled&&!this.credits&&(this.credits=this.renderer.text(g.text+(this.mapCredits||""),0,0).addClass("highcharts-credits").on("click",function(){g.href&&(qh.location.href=g.href)}).attr({align:g.position.align,zIndex:8}),f.styledMode||this.credits.css(g.style),this.credits.add().align(g.position),this.credits.update=function(b){f.credits=f.credits.destroy(),f.addCredits(b)})}destroy(){var C,I;let l,f=this,g=f.axes,b=f.series,w=f.container,A=w==null?void 0:w.parentNode;for(gs(f,"destroy"),f.renderer.forExport?Mr(Kl,f):Kl[f.index]=void 0,kt.chartCount--,f.renderTo.removeAttribute("data-highcharts-chart"),__(f),l=g.length;l--;)g[l]=g[l].destroy();for((I=(C=this.scroller)==null?void 0:C.destroy)==null||I.call(C),l=b.length;l--;)b[l]=b[l].destroy();["title","subtitle","chartBackground","plotBackground","plotBGImage","plotBorder","seriesGroup","clipRect","credits","pointer","rangeSelector","legend","resetZoomButton","tooltip","renderer"].forEach(R=>{var U,F;f[R]=(F=(U=f[R])==null?void 0:U.destroy)==null?void 0:F.call(U)}),w&&(w.innerHTML=Is.emptyHTML,__(w),A&&Ed(w)),ip(f,function(R,U){delete f[U]})}firstRender(){var b;let l=this,f=l.options;l.getContainer(),l.resetMargins(),l.setChartSize(),l.propFromSeries(),l.createAxes();let g=Jx(f.series)?f.series:[];f.series=[],g.forEach(function(w){l.initSeries(w)}),l.linkSeries(),l.setSortedData(),gs(l,"beforeRender"),l.render(),(b=l.pointer)==null||b.getChartPosition(),l.renderer.imgCount||l.hasLoaded||l.onload(),l.temporaryDisplay(!0)}onload(){this.callbacks.concat([this.callback]).forEach(function(l){l&&this.index!==void 0&&l.apply(this,[this])},this),gs(this,"load"),gs(this,"render"),zo(this.index)&&this.setReflow(),this.warnIfA11yModuleNotLoaded(),this.hasLoaded=!0}warnIfA11yModuleNotLoaded(){let{options:l,title:f}=this;!l||this.accessibility||(this.renderer.boxWrapper.attr({role:"img","aria-label":((f==null?void 0:f.element.textContent)||"").replace(/</g,"&lt;")}),l.accessibility&&l.accessibility.enabled===!1||Wr('Highcharts warning: Consider including the "accessibility.js" module to make your chart more usable for people with disabilities. Set the "accessibility.enabled" option to false to remove this warning. See https://www.highcharts.com/docs/accessibility/accessibility-module.',!1,this))}addSeries(l,f,g){let b,w=this;return l&&(f=lr(f,!0),gs(w,"addSeries",{options:l},function(){b=w.initSeries(l),w.isDirtyLegend=!0,w.linkSeries(),b.enabledDataSorting&&b.setData(l.data,!1),gs(w,"afterAddSeries",{series:b}),f&&w.redraw(g)})),b}addAxis(l,f,g,b){return this.createAxis(f?"xAxis":"yAxis",{axis:l,redraw:g,animation:b})}addColorAxis(l,f,g){return this.createAxis("colorAxis",{axis:l,redraw:f,animation:g})}createAxis(l,f){let g=new Ea(this,f.axis,l);return lr(f.redraw,!0)&&this.redraw(f.animation),g}showLoading(l){let f=this,g=f.options,b=g.loading,w=function(){A&&Lr(A,{left:f.plotLeft+"px",top:f.plotTop+"px",width:f.plotWidth+"px",height:f.plotHeight+"px"})},A=f.loadingDiv,C=f.loadingSpan;A||(f.loadingDiv=A=ep("div",{className:"highcharts-loading highcharts-loading-hidden"},null,f.container)),C||(f.loadingSpan=C=ep("span",{className:"highcharts-loading-inner"},null,A),ca(f,"redraw",w)),A.className="highcharts-loading",Is.setElementHTML(C,lr(l,g.lang.loading,"")),f.styledMode||(Lr(A,ka(b.style,{zIndex:10})),Lr(C,b.labelStyle),f.loadingShown||(Lr(A,{opacity:0,display:""}),dl(A,{opacity:b.style.opacity||.5},{duration:b.showDuration||0}))),f.loadingShown=!0,w()}hideLoading(){let l=this.options,f=this.loadingDiv;f&&(f.className="highcharts-loading highcharts-loading-hidden",this.styledMode||dl(f,{opacity:0},{duration:l.loading.hideDuration||100,complete:function(){Lr(f,{display:"none"})}})),this.loadingShown=!1}update(l,f,g,b){let w,A,C,I=this,R={credits:"addCredits",title:"setTitle",subtitle:"setSubtitle",caption:"setCaption"},U=l.isResponsiveOptions,F=[];gs(I,"update",{options:l}),U||I.setResponsive(!1,!0),l=Gr(l,I.options),I.userOptions=Ar(I.userOptions,l);let G=l.chart;G&&(Ar(!0,I.options.chart,G),this.setZoomOptions(),"className"in G&&I.setClassName(G.className),("inverted"in G||"polar"in G||"type"in G)&&(I.propFromSeries(),w=!0),"alignTicks"in G&&(w=!0),"events"in G&&Em(this,G),ip(G,function(ot,rt){I.propsRequireUpdateSeries.indexOf("chart."+rt)!==-1&&(A=!0),I.propsRequireDirtyBox.indexOf(rt)!==-1&&(I.isDirtyBox=!0),I.propsRequireReflow.indexOf(rt)===-1||(I.isDirtyBox=!0,U||(C=!0))}),!I.styledMode&&G.style&&I.renderer.setStyle(I.options.chart.style||{})),!I.styledMode&&l.colors&&(this.options.colors=l.colors),ip(l,function(ot,rt){I[rt]&&typeof I[rt].update=="function"?I[rt].update(ot,!1):typeof I[R[rt]]=="function"?I[R[rt]](ot):rt!=="colors"&&I.collectionsWithUpdate.indexOf(rt)===-1&&Ar(!0,I.options[rt],l[rt]),rt!=="chart"&&I.propsRequireUpdateSeries.indexOf(rt)!==-1&&(A=!0)}),this.collectionsWithUpdate.forEach(function(ot){l[ot]&&(sp(l[ot]).forEach(function(rt,it){let ct,dt=zo(rt.id);dt&&(ct=I.get(rt.id)),!ct&&I[ot]&&(ct=I[ot][lr(rt.index,it)])&&(dt&&zo(ct.options.id)||ct.options.isInternal)&&(ct=void 0),ct&&ct.coll===ot&&(ct.update(rt,!1),g&&(ct.touched=!0)),!ct&&g&&I.collectionsWithInit[ot]&&(I.collectionsWithInit[ot][0].apply(I,[rt].concat(I.collectionsWithInit[ot][1]||[]).concat([!1])).touched=!0)}),g&&I[ot].forEach(function(rt){rt.touched||rt.options.isInternal?delete rt.touched:F.push(rt)}))}),F.forEach(function(ot){ot.chart&&ot.remove&&ot.remove(!1)}),w&&I.axes.forEach(function(ot){ot.update({},!1)}),A&&I.getSeriesOrderByLinks().forEach(function(ot){ot.chart&&ot.update({},!1)},this);let Z=G==null?void 0:G.width,J=G&&(Ad(G.height)?Mm(G.height,Z||I.chartWidth):G.height);C||Zh(Z)&&Z!==I.chartWidth||Zh(J)&&J!==I.chartHeight?I.setSize(Z,J,b):lr(f,!0)&&I.redraw(b),gs(I,"afterUpdate",{options:l,redraw:f,animation:b})}setSubtitle(l,f){this.applyDescription("subtitle",l),this.layOutTitles(f)}setCaption(l,f){this.applyDescription("caption",l),this.layOutTitles(f)}showResetZoom(){let l=this,f=Td.lang,g=l.zooming.resetButton,b=g.theme,w=g.relativeTo==="chart"||g.relativeTo==="spacingBox"?null:"plotBox";function A(){l.zoomOut()}gs(this,"beforeShowResetZoom",null,function(){l.resetZoomButton=l.renderer.button(f.resetZoom,null,null,A,b).attr({align:g.position.align,title:f.resetZoomTitle}).addClass("highcharts-reset-zoom").add().align(g.position,!1,w)}),gs(this,"afterShowResetZoom")}zoomOut(){gs(this,"selection",{resetSelection:!0},()=>this.transform({reset:!0,trigger:"zoom"}))}pan(l,f){let g=this,b=typeof f=="object"?f:{enabled:f,type:"x"},w=b.type,A=w&&g[{x:"xAxis",xy:"axes",y:"yAxis"}[w]].filter(I=>I.options.panningEnabled&&!I.options.isInternal),C=g.options.chart;C!=null&&C.panning&&(C.panning=b),gs(this,"pan",{originalEvent:l},()=>{g.transform({axes:A,event:l,to:{x:l.chartX-(g.mouseDownX||0),y:l.chartY-(g.mouseDownY||0)},trigger:"pan"}),Lr(g.container,{cursor:"move"})})}transform(l){var J;let{axes:f=this.axes,event:g,from:b={},reset:w,selection:A,to:C={},trigger:I}=l,{inverted:R,time:U}=this,F=!1,G,Z;for(let ot of((J=this.hoverPoints)==null||J.forEach(rt=>rt.setState()),f)){let{horiz:rt,len:it,minPointOffset:ct=0,options:dt,reversed:Ht}=ot,Bt=rt?"width":"height",Vt=rt?"x":"y",le=lr(C[Bt],ot.len),Kt=lr(b[Bt],ot.len),ce=10>Math.abs(le)?1:le/Kt,Ee=(b[Vt]||0)+Kt/2-ot.pos,Be=Ee-((C[Vt]??ot.pos)+le/2-ot.pos)/ce,$e=Ht&&!R||!Ht&&R?-1:1;if(!w&&(Ee<0||Ee>ot.len))continue;let Ae=ot.toValue(Be,!0)+(A||ot.isOrdinal?0:ct*$e),Je=ot.toValue(Be+it/ce,!0)-(A||ot.isOrdinal?0:ct*$e||0),ri=ot.allExtremes;if(Ae>Je&&([Ae,Je]=[Je,Ae]),ce===1&&!w&&ot.coll==="yAxis"&&!ri){for(let Xr of ot.series){let mo=Xr.getExtremes(Xr.getProcessedData(!0).modified.getColumn("y")||[],!0);ri??(ri={dataMin:Number.MAX_VALUE,dataMax:-Number.MAX_VALUE}),Zh(mo.dataMin)&&Zh(mo.dataMax)&&(ri.dataMin=Math.min(mo.dataMin,ri.dataMin),ri.dataMax=Math.max(mo.dataMax,ri.dataMax))}ot.allExtremes=ri}let{dataMin:Ii,dataMax:hi,min:Li,max:as}=ka(ot.getExtremes(),ri||{}),Zi=U.parse(dt.min),ds=U.parse(dt.max),gr=Ii??Zi,ls=hi??ds,Ms=Je-Ae,Bi=ot.categories?0:Math.min(Ms,ls-gr),si=gr-Bi*(zo(Zi)?0:dt.minPadding),xn=ls+Bi*(zo(ds)?0:dt.maxPadding),As=ot.allowZoomOutside||ce===1||I!=="zoom"&&ce>1,$s=Math.min(Zi??si,si,As?Li:si),Ks=Math.max(ds??xn,xn,As?as:xn);(!ot.isOrdinal||ot.options.overscroll||ce!==1||w)&&(Ae<$s&&(Ae=$s,ce>=1&&(Je=Ae+Ms)),Je>Ks&&(Je=Ks,ce>=1&&(Ae=Je-Ms)),(w||ot.series.length&&(Ae!==Li||Je!==as)&&Ae>=$s&&Je<=Ks)&&(A?A[ot.coll].push({axis:ot,min:Ae,max:Je}):(ot.isPanning=I!=="zoom",ot.isPanning&&(Z=!0),ot.setExtremes(w?void 0:Ae,w?void 0:Je,!1,!1,{move:Be,trigger:I,scale:ce}),!w&&(Ae>$s||Je<Ks)&&I!=="mousewheel"&&(G=!0)),F=!0),g&&(this[rt?"mouseDownX":"mouseDownY"]=g[rt?"chartX":"chartY"]))}return F&&(A?gs(this,"selection",A,()=>{delete l.selection,l.trigger="zoom",this.transform(l)}):(!G||Z||this.resetZoomButton?!G&&this.resetZoomButton&&(this.resetZoomButton=this.resetZoomButton.destroy()):this.showResetZoom(),this.redraw(I==="zoom"&&(this.options.chart.animation??this.pointCount<100)))),F}}ka(Oo.prototype,{callbacks:[],collectionsWithInit:{xAxis:[Oo.prototype.addAxis,[!0]],yAxis:[Oo.prototype.addAxis,[!1]],series:[Oo.prototype.addSeries]},collectionsWithUpdate:["xAxis","yAxis","series"],propsRequireDirtyBox:["backgroundColor","borderColor","borderWidth","borderRadius","plotBackgroundColor","plotBackgroundImage","plotBorderColor","plotBorderWidth","plotShadow","shadow"],propsRequireReflow:["margin","marginTop","marginRight","marginBottom","marginLeft","spacing","spacingTop","spacingRight","spacingBottom","spacingLeft"],propsRequireUpdateSeries:["chart.inverted","chart.polar","chart.ignoreHiddenSeries","chart.type","colors","plotOptions","time","tooltip"]});let{stop:Am}=mn,{composed:Cm}=kt,{addEvent:Pa,createElement:Qn,css:Cd,defined:np,erase:Ia,merge:v_,pushUnique:Ql}=_t;function kd(){let B=this.scrollablePlotArea;(this.scrollablePixelsX||this.scrollablePixelsY)&&!B&&(this.scrollablePlotArea=B=new Cr(this)),B==null||B.applyFixed()}function uo(){this.chart.scrollablePlotArea&&(this.chart.scrollablePlotArea.isDirty=!0)}class Cr{static compose(l,f,g){Ql(Cm,this.compose)&&(Pa(l,"afterInit",uo),Pa(f,"afterSetChartSize",b=>this.afterSetSize(b.target,b)),Pa(f,"render",kd),Pa(g,"show",uo))}static afterSetSize(l,f){let g,b,w,{minWidth:A,minHeight:C}=l.options.chart.scrollablePlotArea||{},{clipBox:I,plotBox:R,inverted:U,renderer:F}=l;if(!F.forExport&&(A?(l.scrollablePixelsX=g=Math.max(0,A-l.chartWidth),g&&(l.scrollablePlotBox=v_(l.plotBox),R.width=l.plotWidth+=g,I[U?"height":"width"]+=g,w=!0)):C&&(l.scrollablePixelsY=b=Math.max(0,C-l.chartHeight),np(b)&&(l.scrollablePlotBox=v_(l.plotBox),R.height=l.plotHeight+=b,I[U?"width":"height"]+=b,w=!1)),np(w)&&!f.skipAxes))for(let G of l.axes)(G.horiz===w||l.hasParallelCoordinates&&G.coll==="yAxis")&&(G.setAxisSize(),G.setAxisTranslation())}constructor(l){var Z;let f,g=l.options.chart,b=io.getRendererType(),w=g.scrollablePlotArea||{},A=this.moveFixedElements.bind(this),C={WebkitOverflowScrolling:"touch",overflowX:"hidden",overflowY:"hidden"};l.scrollablePixelsX&&(C.overflowX="auto"),l.scrollablePixelsY&&(C.overflowY="auto"),this.chart=l;let I=this.parentDiv=Qn("div",{className:"highcharts-scrolling-parent"},{position:"relative"},l.renderTo),R=this.scrollingContainer=Qn("div",{className:"highcharts-scrolling"},C,I),U=this.innerContainer=Qn("div",{className:"highcharts-inner-container"},void 0,R),F=this.fixedDiv=Qn("div",{className:"highcharts-fixed"},{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:(((Z=g.style)==null?void 0:Z.zIndex)||0)+2,top:0},void 0,!0),G=this.fixedRenderer=new b(F,l.chartWidth,l.chartHeight,g.style);this.mask=G.path().attr({fill:g.backgroundColor||"#fff","fill-opacity":w.opacity??.85,zIndex:-1}).addClass("highcharts-scrollable-mask").add(),R.parentNode.insertBefore(F,R),Cd(l.renderTo,{overflow:"visible"}),Pa(l,"afterShowResetZoom",A),Pa(l,"afterApplyDrilldown",A),Pa(l,"afterLayOutTitles",A),Pa(R,"scroll",()=>{let{pointer:J,hoverPoint:ot}=l;J&&(delete J.chartPosition,ot&&(f=ot),J.runPointActions(void 0,f,!0))}),U.appendChild(l.container)}applyFixed(){var Ee;let{chart:l,fixedRenderer:f,isDirty:g,scrollingContainer:b}=this,{axisOffset:w,chartWidth:A,chartHeight:C,container:I,plotHeight:R,plotLeft:U,plotTop:F,plotWidth:G,scrollablePixelsX:Z=0,scrollablePixelsY:J=0}=l,{scrollPositionX:ot=0,scrollPositionY:rt=0}=l.options.chart.scrollablePlotArea||{},it=A+Z,ct=C+J;f.setSize(A,C),(g??!0)&&(this.isDirty=!1,this.moveFixedElements()),Am(l.container),Cd(I,{width:`${it}px`,height:`${ct}px`}),l.renderer.boxWrapper.attr({width:it,height:ct,viewBox:[0,0,it,ct].join(" ")}),(Ee=l.chartBackground)==null||Ee.attr({width:it,height:ct}),Cd(b,{width:`${A}px`,height:`${C}px`}),np(g)||(b.scrollLeft=Z*ot,b.scrollTop=J*rt);let dt=F-w[0]-1,Ht=U-w[3]-1,Bt=F+R+w[2]+1,Vt=U+G+w[1]+1,le=U+G-Z,Kt=F+R-J,ce=[["M",0,0]];Z?ce=[["M",0,dt],["L",U-1,dt],["L",U-1,Bt],["L",0,Bt],["Z"],["M",le,dt],["L",A,dt],["L",A,Bt],["L",le,Bt],["Z"]]:J&&(ce=[["M",Ht,0],["L",Ht,F-1],["L",Vt,F-1],["L",Vt,0],["Z"],["M",Ht,Kt],["L",Ht,C],["L",Vt,C],["L",Vt,Kt],["Z"]]),l.redrawTrigger!=="adjustHeight"&&this.mask.attr({d:ce})}moveFixedElements(){let l,{container:f,inverted:g,scrollablePixelsX:b,scrollablePixelsY:w}=this.chart,A=this.fixedRenderer,C=Cr.fixedSelectors;if(b&&!g?l=".highcharts-yaxis":b&&g||w&&!g?l=".highcharts-xaxis":w&&g&&(l=".highcharts-yaxis"),l&&!(this.chart.hasParallelCoordinates&&l===".highcharts-yaxis"))for(let I of[`${l}:not(.highcharts-radial-axis)`,`${l}-labels:not(.highcharts-radial-axis-labels)`])Ql(C,I);else for(let I of[".highcharts-xaxis",".highcharts-yaxis"])for(let R of[`${I}:not(.highcharts-radial-axis)`,`${I}-labels:not(.highcharts-radial-axis-labels)`])Ia(C,R);for(let I of C)[].forEach.call(f.querySelectorAll(I),R=>{(R.namespaceURI===A.SVG_NS?A.box:A.box.parentNode).appendChild(R),R.style.pointerEvents="auto"})}}Cr.fixedSelectors=[".highcharts-breadcrumbs-group",".highcharts-contextbutton",".highcharts-caption",".highcharts-credits",".highcharts-drillup-button",".highcharts-legend",".highcharts-legend-checkbox",".highcharts-navigator-series",".highcharts-navigator-xaxis",".highcharts-navigator-yaxis",".highcharts-navigator",".highcharts-range-selector-group",".highcharts-reset-zoom",".highcharts-scrollbar",".highcharts-subtitle",".highcharts-title"];let{format:Qx}=ir,{series:rp}=bs,{destroyObjectProperties:b_,fireEvent:w_,getAlignFactor:Pd,isNumber:Ro,pick:ha}=_t,km=class{constructor(B,l,f,g,b){let w=B.chart.inverted,A=B.reversed;this.axis=B;let C=this.isNegative=!!f!=!!A;this.options=l=l||{},this.x=g,this.total=null,this.cumulative=null,this.points={},this.hasValidPoints=!1,this.stack=b,this.leftCliff=0,this.rightCliff=0,this.alignOptions={align:l.align||(w?C?"left":"right":"center"),verticalAlign:l.verticalAlign||(w?"middle":C?"bottom":"top"),y:l.y,x:l.x},this.textAlign=l.textAlign||(w?C?"right":"left":"center")}destroy(){b_(this,this.axis)}render(B){let l=this.axis.chart,f=this.options,g=f.format,b=g?Qx(g,this,l):f.formatter.call(this);if(this.label)this.label.attr({text:b,visibility:"hidden"});else{this.label=l.renderer.label(b,null,void 0,f.shape,void 0,void 0,f.useHTML,!1,"stack-labels");let w={r:f.borderRadius||0,text:b,padding:ha(f.padding,5),visibility:"hidden"};l.styledMode||(w.fill=f.backgroundColor,w.stroke=f.borderColor,w["stroke-width"]=f.borderWidth,this.label.css(f.style||{})),this.label.attr(w),this.label.added||this.label.add(B)}this.label.labelrank=l.plotSizeY,w_(this,"afterRender")}setOffset(B,l,f,g,b,w){let{alignOptions:A,axis:C,label:I,options:R,textAlign:U}=this,F=C.chart,G=this.getStackBox({xOffset:B,width:l,boxBottom:f,boxTop:g,defaultX:b,xAxis:w}),{verticalAlign:Z}=A;if(I&&G){let J=I.getBBox(void 0,0),ot=I.padding,rt=ha(R.overflow,"justify")==="justify",it;A.x=R.x||0,A.y=R.y||0;let{x:ct,y:dt}=this.adjustStackPosition({labelBox:J,verticalAlign:Z,textAlign:U});G.x-=ct,G.y-=dt,I.align(A,!1,G),(it=F.isInsidePlot(I.alignAttr.x+A.x+ct,I.alignAttr.y+A.y+dt))||(rt=!1),rt&&rp.prototype.justifyDataLabel.call(C,I,A,I.alignAttr,J,G),I.attr({x:I.alignAttr.x,y:I.alignAttr.y,rotation:R.rotation,rotationOriginX:J.width*Pd(R.textAlign||"center"),rotationOriginY:J.height/2}),ha(!rt&&R.crop,!0)&&(it=Ro(I.x)&&Ro(I.y)&&F.isInsidePlot(I.x-ot+(I.width||0),I.y)&&F.isInsidePlot(I.x+ot,I.y)),I[it?"show":"hide"]()}w_(this,"afterSetOffset",{xOffset:B,width:l})}adjustStackPosition({labelBox:B,verticalAlign:l,textAlign:f}){return{x:B.width/2+B.width/2*(2*Pd(f)-1),y:B.height/2*2*(1-Pd(l))}}getStackBox(B){let l=this.axis,f=l.chart,{boxTop:g,defaultX:b,xOffset:w,width:A,boxBottom:C}=B,I=l.stacking.usePercentage?100:ha(g,this.total,0),R=l.toPixels(I),U=B.xAxis||f.xAxis[0],F=ha(b,U.translate(this.x))+w,G=Math.abs(R-l.toPixels(C||Ro(l.min)&&l.logarithmic&&l.logarithmic.lin2log(l.min)||0)),Z=f.inverted,J=this.isNegative;return Z?{x:(J?R:R-G)-f.plotLeft,y:U.height-F-A+U.top-f.plotTop,width:G,height:A}:{x:F+U.transB-f.plotLeft,y:(J?R-G:R)-f.plotTop,width:A,height:G}}},{getDeferredAnimation:T_}=mn,{series:{prototype:t0}}=bs,{addEvent:Id,correctFloat:Gc,defined:Wc,destroyObjectProperties:Yh,fireEvent:Ld,isNumber:Kh,objectEach:tc,pick:Hc}=_t;function Pm(){let B=this.inverted;this.axes.forEach(l=>{var f;(f=l.stacking)!=null&&f.stacks&&l.hasVisibleSeries&&(l.stacking.oldStacks=l.stacking.stacks)}),this.series.forEach(l=>{var g;let f=((g=l.xAxis)==null?void 0:g.options)||{};l.options.stacking&&l.reserveSpace()&&(l.stackKey=[l.type,Hc(l.options.stack,""),B?f.top:f.left,B?f.height:f.width].join(","))})}function S_(){var l;let B=this.stacking;if(B){let f=B.stacks;tc(f,(g,b)=>{Yh(g),delete f[b]}),(l=B.stackTotalGroup)==null||l.destroy()}}function Jh(){this.stacking||(this.stacking=new Dd(this))}function E_(B,l,f,g){return!Wc(B)||B.x!==l||g&&B.stackKey!==g?B={x:l,index:0,key:g,stackKey:g}:B.index++,B.key=[f,l,B.index].join(","),B}function Im(){let B,l=this,f=l.yAxis,g=l.stackKey||"",b=f.stacking.stacks,w=l.getColumn("x",!0),A=l.options.stacking,C=l[A+"Stacker"];C&&[g,"-"+g].forEach(I=>{var Z;let R=w.length,U,F,G;for(;R--;)U=w[R],B=l.getStackIndicator(B,U,l.index,I),F=(Z=b[I])==null?void 0:Z[U],(G=F==null?void 0:F.points[B.key||""])&&C.call(l,G,F,R)})}function M_(B,l,f){let g=l.total?100/l.total:0;B[0]=Gc(B[0]*g),B[1]=Gc(B[1]*g),this.stackedYData[f]=B[1]}function e0(B){(this.is("column")||this.is("columnrange"))&&(this.options.centerInCategory&&this.chart.series.length>1?t0.setStackedPoints.call(this,B,"group"):B.stacking.resetStacks())}function i0(B,l){var Kt,ce;let f,g,b,w,A,C,I,R=l||this.options.stacking;if(!R||!this.reserveSpace()||({group:"xAxis"}[R]||"yAxis")!==B.coll)return;let U=this.getColumn("x",!0),F=this.getColumn(this.pointValKey||"y",!0),G=[],Z=F.length,J=this.options,ot=J.threshold||0,rt=J.startFromThreshold?ot:0,it=J.stack,ct=l?`${this.type},${R}`:this.stackKey||"",dt="-"+ct,Ht=this.negStacks,Bt=B.stacking,Vt=Bt.stacks,le=Bt.oldStacks;for(Bt.stacksTouched+=1,I=0;I<Z;I++){let Ee=U[I]||0,Be=F[I],$e=Kh(Be)&&Be||0;C=(f=this.getStackIndicator(f,Ee,this.index)).key||"",Vt[A=(g=Ht&&$e<(rt?0:ot))?dt:ct]||(Vt[A]={}),Vt[A][Ee]||((Kt=le[A])!=null&&Kt[Ee]?(Vt[A][Ee]=le[A][Ee],Vt[A][Ee].total=null):Vt[A][Ee]=new km(B,B.options.stackLabels,!!g,Ee,it)),b=Vt[A][Ee],Be!==null?(b.points[C]=b.points[this.index]=[Hc(b.cumulative,rt)],Wc(b.cumulative)||(b.base=C),b.touched=Bt.stacksTouched,f.index>0&&this.singleStacks===!1&&(b.points[C][0]=b.points[this.index+","+Ee+",0"][0])):(delete b.points[C],delete b.points[this.index]);let Ae=b.total||0;R==="percent"?(w=g?ct:dt,Ae=Ht&&((ce=Vt[w])!=null&&ce[Ee])?(w=Vt[w][Ee]).total=Math.max(w.total||0,Ae)+Math.abs($e):Gc(Ae+Math.abs($e))):R==="group"?Kh(Be)&&Ae++:Ae=Gc(Ae+$e),R==="group"?b.cumulative=(Ae||1)-1:b.cumulative=Gc(Hc(b.cumulative,rt)+$e),b.total=Ae,Be!==null&&(b.points[C].push(b.cumulative),G[I]=b.cumulative,b.hasValidPoints=!0)}R==="percent"&&(Bt.usePercentage=!0),R!=="group"&&(this.stackedYData=G),Bt.oldStacks={}}class Dd{constructor(l){this.oldStacks={},this.stacks={},this.stacksTouched=0,this.axis=l}buildStacks(){let l,f,g=this.axis,b=g.series,w=g.coll==="xAxis",A=g.options.reversedStacks,C=b.length;for(this.resetStacks(),this.usePercentage=!1,f=C;f--;)l=b[A?f:C-f-1],w&&l.setGroupedPoints(g),l.setStackedPoints(g);if(!w)for(f=0;f<C;f++)b[f].modifyStacks();Ld(g,"afterBuildStacks")}cleanStacks(){this.oldStacks&&(this.stacks=this.oldStacks,tc(this.stacks,l=>{tc(l,f=>{f.cumulative=f.total})}))}resetStacks(){tc(this.stacks,l=>{tc(l,(f,g)=>{Kh(f.touched)&&f.touched<this.stacksTouched?(f.destroy(),delete l[g]):(f.total=null,f.cumulative=null)})})}renderStackTotals(){var C;let l=this.axis,f=l.chart,g=f.renderer,b=this.stacks,w=T_(f,((C=l.options.stackLabels)==null?void 0:C.animation)||!1),A=this.stackTotalGroup=this.stackTotalGroup||g.g("stack-labels").attr({zIndex:6,opacity:0}).add();A.translate(f.plotLeft,f.plotTop),tc(b,I=>{tc(I,R=>{R.render(A)})}),A.animate({opacity:1},w)}}(yt||(yt={})).compose=function(B,l,f){let g=l.prototype,b=f.prototype;g.getStacks||(Id(B,"init",Jh),Id(B,"destroy",S_),g.getStacks=Pm,b.getStackIndicator=E_,b.modifyStacks=Im,b.percentStacker=M_,b.setGroupedPoints=e0,b.setStackedPoints=i0)};let A_=yt,{defined:ec,merge:Es,isObject:Lm}=_t;class ua extends ar{drawGraph(){let l=this.options,f=(this.gappedPath||this.getGraphPath).call(this),g=this.chart.styledMode;[this,...this.zones].forEach((b,w)=>{let A,C=b.graph,I=C?"animate":"attr",R=b.dashStyle||l.dashStyle;C?(C.endX=this.preventGraphAnimation?null:f.xMap,C.animate({d:f})):f.length&&(b.graph=C=this.chart.renderer.path(f).addClass("highcharts-graph"+(w?` highcharts-zone-graph-${w-1} `:" ")+(w&&b.className||"")).attr({zIndex:1}).add(this.group)),C&&!g&&(A={stroke:!w&&l.lineColor||b.color||this.color||"#cccccc","stroke-width":l.lineWidth||0,fill:this.fillGraph&&this.color||"none"},R?A.dashstyle=R:l.linecap!=="square"&&(A["stroke-linecap"]=A["stroke-linejoin"]="round"),C[I](A).shadow(l.shadow&&Es({filterUnits:"userSpaceOnUse"},Lm(l.shadow)?l.shadow:{}))),C&&(C.startX=f.xMap,C.isArea=f.isArea)})}getGraphPath(l,f,g){let b=this,w=b.options,A=[],C=[],I,R=w.step,U=(l=l||b.points).reversed;return U&&l.reverse(),(R={right:1,center:2}[R]||R&&3)&&U&&(R=4-R),(l=this.getValidPoints(l,!1,w.nullInteraction||!(w.connectNulls&&!f&&!g))).forEach(function(F,G){let Z,J=F.plotX,ot=F.plotY,rt=l[G-1],it=F.isNull||typeof ot!="number";(F.leftCliff||rt!=null&&rt.rightCliff)&&!g&&(I=!0),it&&!ec(f)&&G>0?I=!w.connectNulls:it&&!f?I=!0:(G===0||I?Z=[["M",F.plotX,F.plotY]]:b.getPointSpline?Z=[b.getPointSpline(l,F,G)]:R?(Z=R===1?[["L",rt.plotX,ot]]:R===2?[["L",(rt.plotX+J)/2,rt.plotY],["L",(rt.plotX+J)/2,ot]]:[["L",J,rt.plotY]]).push(["L",J,ot]):Z=[["L",J,ot]],C.push(F.x),R&&(C.push(F.x),R===2&&C.push(F.x)),A.push.apply(A,Z),I=!1)}),A.xMap=C,b.graphPath=A,A}}ua.defaultOptions=Es(ar.defaultOptions,{legendSymbol:"lineMarker"}),bs.registerSeriesType("line",ua);let{seriesTypes:{line:Bo}}=bs,{extend:da,merge:fo,objectEach:cr,pick:zd}=_t;class po extends Bo{drawGraph(){this.areaPath=[],super.drawGraph.apply(this);let{areaPath:l,options:f}=this;[this,...this.zones].forEach((g,b)=>{let w={},A=g.fillColor||f.fillColor,C=g.area,I=C?"animate":"attr";C?(C.endX=this.preventGraphAnimation?null:l.xMap,C.animate({d:l})):(w.zIndex=0,(C=g.area=this.chart.renderer.path(l).addClass("highcharts-area"+(b?` highcharts-zone-area-${b-1} `:" ")+(b&&g.className||"")).add(this.group)).isArea=!0),this.chart.styledMode||(w.fill=A||g.color||this.color,w["fill-opacity"]=A?1:f.fillOpacity??.75,C.css({pointerEvents:this.stickyTracking?"none":"auto"})),C[I](w),C.startX=l.xMap,C.shiftUnit=f.step?2:1})}getGraphPath(l){let f,g,b,w=Bo.prototype.getGraphPath,A=this.options,C=A.stacking,I=this.yAxis,R=[],U=[],F=this.index,G=I.stacking.stacks[this.stackKey],Z=A.threshold,J=Math.round(I.getThreshold(A.threshold)),ot=zd(A.connectNulls,C==="percent"),rt=function(Vt,le,Kt){let ce=l[Vt],Ee=C&&G[ce.x].points[F],Be=ce[Kt+"Null"]||0,$e=ce[Kt+"Cliff"]||0,Ae,Je,ri=!0;$e||Be?(Ae=(Be?Ee[0]:Ee[1])+$e,Je=Ee[0]+$e,ri=!!Be):!C&&l[le]&&l[le].isNull&&(Ae=Je=Z),Ae!==void 0&&(U.push({plotX:f,plotY:Ae===null?J:I.getThreshold(Ae),isNull:ri,isCliff:!0}),R.push({plotX:f,plotY:Je===null?J:I.getThreshold(Je),doCurve:!1}))};l=l||this.points,C&&(l=this.getStackPoints(l));for(let Vt=0,le=l.length;Vt<le;++Vt)C||(l[Vt].leftCliff=l[Vt].rightCliff=l[Vt].leftNull=l[Vt].rightNull=void 0),g=l[Vt].isNull,f=zd(l[Vt].rectPlotX,l[Vt].plotX),b=C?zd(l[Vt].yBottom,J):J,g&&!ot||(ot||rt(Vt,Vt-1,"left"),g&&!C&&ot||(U.push(l[Vt]),R.push({x:Vt,plotX:f,plotY:b})),ot||rt(Vt,Vt+1,"right"));let it=w.call(this,U,!0,!0);R.reversed=!0;let ct=w.call(this,R,!0,!0),dt=ct[0];dt&&dt[0]==="M"&&(ct[0]=["L",dt[1],dt[2]]);let Ht=it.concat(ct);Ht.length&&Ht.push(["Z"]);let Bt=w.call(this,U,!1,ot);return this.chart.series.length>1&&C&&U.some(Vt=>Vt.isCliff)&&(Ht.hasStackedCliffs=Bt.hasStackedCliffs=!0),Ht.xMap=it.xMap,this.areaPath=Ht,Bt}getStackPoints(l){let f=this,g=[],b=[],w=this.xAxis,A=this.yAxis,C=A.stacking.stacks[this.stackKey],I={},R=A.series,U=R.length,F=A.options.reversedStacks?1:-1,G=R.indexOf(f);if(l=l||this.points,this.options.stacking){for(let J=0;J<l.length;J++)l[J].leftNull=l[J].rightNull=void 0,I[l[J].x]=l[J];cr(C,function(J,ot){J.total!==null&&b.push(ot)}),b.sort(function(J,ot){return J-ot});let Z=R.map(J=>J.visible);b.forEach(function(J,ot){let rt=0,it,ct;if(I[J]&&!I[J].isNull)g.push(I[J]),[-1,1].forEach(function(dt){let Ht=dt===1?"rightNull":"leftNull",Bt=C[b[ot+dt]],Vt=0;if(Bt){let le=G;for(;le>=0&&le<U;){let Kt=R[le].index;!(it=Bt.points[Kt])&&(Kt===f.index?I[J][Ht]=!0:Z[le]&&(ct=C[J].points[Kt])&&(Vt-=ct[1]-ct[0])),le+=F}}I[J][dt===1?"rightCliff":"leftCliff"]=Vt});else{let dt=G;for(;dt>=0&&dt<U;){let Ht=R[dt].index;if(it=C[J].points[Ht]){rt=it[1];break}dt+=F}rt=zd(rt,0),rt=A.translate(rt,0,1,0,1),g.push({isNull:!0,plotX:w.translate(J,0,0,0,1),x:J,plotY:rt,yBottom:rt})}})}return g}}po.defaultOptions=fo(Bo.defaultOptions,{threshold:0,legendSymbol:"areaMarker"}),da(po.prototype,{singleStacks:!1}),bs.registerSeriesType("area",po);let{line:Dm}=bs.seriesTypes,{merge:Qh,pick:tu}=_t;class op extends Dm{getPointSpline(l,f,g){let b,w,A,C,I=f.plotX||0,R=f.plotY||0,U=l[g-1],F=l[g+1];function G(J){return J&&!J.isNull&&J.doCurve!==!1&&!f.isCliff}if(G(U)&&G(F)){let J=U.plotX||0,ot=U.plotY||0,rt=F.plotX||0,it=F.plotY||0,ct=0;b=(1.5*I+J)/2.5,w=(1.5*R+ot)/2.5,A=(1.5*I+rt)/2.5,C=(1.5*R+it)/2.5,A!==b&&(ct=(C-w)*(A-I)/(A-b)+R-C),w+=ct,C+=ct,w>ot&&w>R?(w=Math.max(ot,R),C=2*R-w):w<ot&&w<R&&(w=Math.min(ot,R),C=2*R-w),C>it&&C>R?(C=Math.max(it,R),w=2*R-C):C<it&&C<R&&(C=Math.min(it,R),w=2*R-C),f.rightContX=A,f.rightContY=C,f.controlPoints={low:[b,w],high:[A,C]}}let Z=["C",tu(U.rightContX,U.plotX,0),tu(U.rightContY,U.plotY,0),tu(b,I,0),tu(w,R,0),I,R];return U.rightContX=U.rightContY=void 0,Z}}op.defaultOptions=Qh(Dm.defaultOptions),bs.registerSeriesType("spline",op);let ap=op,{area:s0,area:{prototype:Od}}=bs.seriesTypes,{extend:C_,merge:n0}=_t;class fa extends ap{}fa.defaultOptions=n0(ap.defaultOptions,s0.defaultOptions),C_(fa.prototype,{getGraphPath:Od.getGraphPath,getStackPoints:Od.getStackPoints,drawGraph:Od.drawGraph}),bs.registerSeriesType("areaspline",fa);let{animObject:Xc}=mn,{parse:lp}=Qt,{noop:cp}=kt,{clamp:eu,crisp:Rd,defined:k_,extend:zm,fireEvent:P_,isArray:hp,isNumber:up,merge:Bd,pick:iu,objectEach:I_}=_t;class La extends ar{animate(l){let f,g,b=this,w=this.yAxis,A=w.pos,C=w.reversed,I=b.options,{clipOffset:R,inverted:U}=this.chart,F={},G=U?"translateX":"translateY";l&&R?(F.scaleY=.001,g=eu(w.toPixels(I.threshold||0),A,A+w.len),U?F.translateX=(g+=C?-Math.floor(R[0]):Math.ceil(R[2]))-w.len:F.translateY=g+=C?Math.ceil(R[0]):-Math.floor(R[2]),b.clipBox&&b.setClip(),b.group.attr(F)):(f=Number(b.group.attr(G)),b.group.animate({scaleY:1},zm(Xc(b.options.animation),{step:function(Z,J){b.group&&(F[G]=f+J.pos*(A-f),b.group.attr(F))}})))}init(l,f){super.init.apply(this,arguments);let g=this;(l=g.chart).hasRendered&&l.series.forEach(function(b){b.type===g.type&&(b.isDirty=!0)})}getColumnMetrics(){var ot,rt;let l=this,f=l.options,g=l.xAxis,b=l.yAxis,w=g.options.reversedStacks,A=g.reversed&&!w||!g.reversed&&w,C={},I,R=0;f.grouping===!1?R=1:l.chart.series.forEach(function(it){let ct,dt=it.yAxis,Ht=it.options;it.type===l.type&&it.reserveSpace()&&b.len===dt.len&&b.pos===dt.pos&&(Ht.stacking&&Ht.stacking!=="group"?(C[I=it.stackKey]===void 0&&(C[I]=R++),ct=C[I]):Ht.grouping!==!1&&(ct=R++),it.columnIndex=ct)});let U=Math.min(Math.abs(g.transA)*(!((ot=g.brokenAxis)!=null&&ot.hasBreaks)&&((rt=g.ordinal)==null?void 0:rt.slope)||f.pointRange||g.closestPointRange||g.tickInterval||1),g.len),F=U*f.groupPadding,G=(U-2*F)/(R||1),Z=Math.min(f.maxPointWidth||g.len,iu(f.pointWidth,G*(1-2*f.pointPadding))),J=(l.columnIndex||0)+ +!!A;return l.columnMetrics={width:Z,offset:(G-Z)/2+(F+J*G-U/2)*(A?-1:1),paddedWidth:G,columnCount:R},l.columnMetrics}crispCol(l,f,g,b){let w=this.borderWidth,A=this.chart.inverted;return b=Rd(f+b,w,A)-(f=Rd(f,w,A)),this.options.crisp&&(g=Rd(l+g,w)-(l=Rd(l,w))),{x:l,y:f,width:g,height:b}}adjustForMissingColumns(l,f,g,b){var w;if(!g.isNull&&b.columnCount>1){let A=this.xAxis.series.filter(U=>U.visible).map(U=>U.index),C=0,I=0;I_((w=this.xAxis.stacking)==null?void 0:w.stacks,U=>{var J;let F=typeof g.x=="number"?(J=U[g.x.toString()])==null?void 0:J.points:void 0,G=F==null?void 0:F[this.index],Z={};if(F&&hp(G)){let ot=this.index,rt=Object.keys(F).filter(it=>!it.match(",")&&F[it]&&F[it].length>1).map(parseFloat).filter(it=>A.indexOf(it)!==-1).filter(it=>{let ct=this.chart.series[it].options,dt=ct.stacking&&ct.stack;if(k_(dt)){if(up(Z[dt]))return ot===it&&(ot=Z[dt]),!1;Z[dt]=it}return!0}).sort((it,ct)=>ct-it);C=rt.indexOf(ot),I=rt.length}}),C=this.xAxis.reversed?I-1-C:C;let R=(I-1)*b.paddedWidth+f;l=(g.plotX||0)+R/2-f-C*b.paddedWidth}return l}translate(){let l=this,f=l.chart,g=l.options,b=l.dense=l.closestPointRange*l.xAxis.transA<2,w=l.borderWidth=iu(g.borderWidth,+!b),A=l.xAxis,C=l.yAxis,I=g.threshold,R=iu(g.minPointLength,5),U=l.getColumnMetrics(),F=U.width,G=l.pointXOffset=U.offset,Z=l.dataMin,J=l.dataMax,ot=l.translatedThreshold=C.getThreshold(I),rt=l.barW=Math.max(F,1+2*w);g.pointPadding&&g.crisp&&(rt=Math.ceil(rt)),ar.prototype.translate.apply(l),l.points.forEach(function(it){let ct=iu(it.yBottom,ot),dt=999+Math.abs(ct),Ht=it.plotX||0,Bt=eu(it.plotY,-dt,C.len+dt),Vt,le=Math.min(Bt,ct),Kt=Math.max(Bt,ct)-le,ce=F,Ee=Ht+G,Be=rt;R&&Math.abs(Kt)<R&&(Kt=R,Vt=!C.reversed&&!it.negative||C.reversed&&it.negative,up(I)&&up(J)&&it.y===I&&J<=I&&(C.min||0)<I&&(Z!==J||(C.max||0)<=I)&&(Vt=!Vt,it.negative=!it.negative),le=Math.abs(le-ot)>R?ct-R:ot-(Vt?R:0)),k_(it.options.pointWidth)&&(Ee-=Math.round(((ce=Be=Math.ceil(it.options.pointWidth))-F)/2)),g.centerInCategory&&(Ee=l.adjustForMissingColumns(Ee,ce,it,U)),it.barX=Ee,it.pointWidth=ce,it.tooltipPos=f.inverted?[eu(C.len+C.pos-f.plotLeft-Bt,C.pos-f.plotLeft,C.len+C.pos-f.plotLeft),A.len+A.pos-f.plotTop-Ee-Be/2,Kt]:[A.left-f.plotLeft+Ee+Be/2,eu(Bt+C.pos-f.plotTop,C.pos-f.plotTop,C.len+C.pos-f.plotTop),Kt],it.shapeType=l.pointClass.prototype.shapeType||"roundedRect",it.shapeArgs=l.crispCol(Ee,le,Be,it.isNull?0:Kt)}),P_(this,"afterColumnTranslate")}drawGraph(){this.group[this.dense?"addClass":"removeClass"]("highcharts-dense-data")}pointAttribs(l,f){let g=this.options,b=this.pointAttrToOptions||{},w=b.stroke||"borderColor",A=b["stroke-width"]||"borderWidth",C,I,R,U=l&&l.color||this.color,F=l&&l[w]||g[w]||U,G=l&&l.options.dashStyle||g.dashStyle,Z=l&&l[A]||g[A]||this[A]||0,J=l!=null&&l.isNull&&g.nullInteraction?0:(l==null?void 0:l.opacity)??g.opacity??1;l&&this.zones.length&&(I=l.getZone(),U=l.options.color||I&&(I.color||l.nonZonedColor)||this.color,I&&(F=I.borderColor||F,G=I.dashStyle||G,Z=I.borderWidth||Z)),f&&l&&(R=(C=Bd(g.states[f],l.options.states&&l.options.states[f]||{})).brightness,U=C.color||R!==void 0&&lp(U).brighten(C.brightness).get()||U,F=C[w]||F,Z=C[A]||Z,G=C.dashStyle||G,J=iu(C.opacity,J));let ot={fill:U,stroke:F,"stroke-width":Z,opacity:J};return G&&(ot.dashstyle=G),ot}drawPoints(l=this.points){let f,g=this,b=this.chart,w=g.options,A=w.nullInteraction,C=b.renderer,I=w.animationLimit||250;l.forEach(function(R){let U=R.plotY,F=R.graphic,G=!!F,Z=F&&b.pointCount<I?"animate":"attr";up(U)&&(R.y!==null||A)?(f=R.shapeArgs,F&&R.hasNewShapeType()&&(F=F.destroy()),g.enabledDataSorting&&(R.startXPos=g.xAxis.reversed?-(f&&f.width||0):g.xAxis.width),!F&&(R.graphic=F=C[R.shapeType](f).add(R.group||g.group),F&&g.enabledDataSorting&&b.hasRendered&&b.pointCount<I&&(F.attr({x:R.startXPos}),G=!0,Z="animate")),F&&G&&F[Z](Bd(f)),b.styledMode||F[Z](g.pointAttribs(R,R.selected&&"select")).shadow(R.allowShadow!==!1&&w.shadow),F&&(F.addClass(R.getClassName(),!0),F.attr({visibility:R.visible?"inherit":"hidden"}))):F&&(R.graphic=F.destroy())})}drawTracker(l=this.points){let f,g=this,b=g.chart,w=b.pointer,A=function(C){w==null||w.normalize(C);let I=w==null?void 0:w.getPointFromEvent(C);w&&I&&g.options.enableMouseTracking&&(b.isInsidePlot(C.chartX-b.plotLeft,C.chartY-b.plotTop,{visiblePlotOnly:!0})||w!=null&&w.inClass(C.target,"highcharts-data-label"))&&(w.isDirectTouch=!0,I.onMouseOver(C))};l.forEach(function(C){f=hp(C.dataLabels)?C.dataLabels:C.dataLabel?[C.dataLabel]:[],C.graphic&&(C.graphic.element.point=C),f.forEach(function(I){(I.div||I.element).point=C})}),g._hasTracking||(g.trackerGroups.forEach(function(C){g[C]&&(g[C].addClass("highcharts-tracker").on("mouseover",A).on("mouseout",function(I){w==null||w.onTrackerMouseOut(I)}).on("touchstart",A),!b.styledMode&&g.options.cursor&&g[C].css({cursor:g.options.cursor}))}),g._hasTracking=!0),P_(this,"afterDrawTracker")}remove(){let l=this,f=l.chart;f.hasRendered&&f.series.forEach(function(g){g.type===l.type&&(g.isDirty=!0)}),ar.prototype.remove.apply(l,arguments)}}La.defaultOptions=Bd(ar.defaultOptions,{borderRadius:3,centerInCategory:!1,groupPadding:.2,marker:null,pointPadding:.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{halo:!1,brightness:.1},select:{color:"#cccccc",borderColor:"#000000"}},dataLabels:{align:void 0,verticalAlign:void 0,y:void 0},startFromThreshold:!0,stickyTracking:!1,tooltip:{distance:6},threshold:0,borderColor:"#ffffff"}),zm(La.prototype,{directTouch:!0,getSymbol:cp,negStacks:!0,trackerGroups:["group","dataLabelsGroup"]}),bs.registerSeriesType("column",La);let Fd=La,{getDeferredAnimation:r0}=mn,{format:su}=ir,{defined:Da,extend:Om,fireEvent:dp,getAlignFactor:L_,isArray:ic,isString:nu,merge:Nd,objectEach:D_,pick:jd,pInt:o0,splat:Rm}=_t;(function(B){function l(){return I(this).some(U=>U==null?void 0:U.enabled)}function f(U,F,G,Z,J){var Ee;let{chart:ot,enabledDataSorting:rt}=this,it=this.isCartesian&&ot.inverted,ct=U.plotX,dt=U.plotY,Ht=G.rotation||0,Bt=Da(ct)&&Da(dt)&&ot.isInsidePlot(ct,Math.round(dt),{inverted:it,paneCoordinates:!0,series:this}),Vt=Ht===0&&jd(G.overflow,rt?"none":"justify")==="justify",le=this.visible&&U.visible!==!1&&Da(ct)&&(U.series.forceDL||rt&&!Vt||Bt||jd(G.inside,!!this.options.stacking)&&Z&&ot.isInsidePlot(ct,it?Z.x+1:Z.y+Z.height-1,{inverted:it,paneCoordinates:!0,series:this})),Kt=U.pos();if(le&&Kt){var ce;let Be=F.getBBox(),$e=F.getBBox(void 0,0);if(Z=Om({x:Kt[0],y:Math.round(Kt[1]),width:0,height:0},Z||{}),G.alignTo==="plotEdges"&&this.isCartesian&&(Z[it?"x":"y"]=0,Z[it?"width":"height"]=((Ee=this.yAxis)==null?void 0:Ee.len)||0),Om(G,{width:Be.width,height:Be.height}),ce=Z,rt&&this.xAxis&&!Vt&&this.setDataLabelStartPos(U,F,J,Bt,ce),F.align(Nd(G,{width:$e.width,height:$e.height}),!1,Z,!1),F.alignAttr.x+=L_(G.align)*($e.width-Be.width),F.alignAttr.y+=L_(G.verticalAlign)*($e.height-Be.height),F[F.placed?"animate":"attr"]({"text-align":F.alignAttr["text-align"]||"center",x:F.alignAttr.x+(Be.width-$e.width)/2,y:F.alignAttr.y+(Be.height-$e.height)/2,rotationOriginX:(F.width||0)/2,rotationOriginY:(F.height||0)/2}),Vt&&Z.height>=0)this.justifyDataLabel(F,G,F.alignAttr,Be,Z,J);else if(jd(G.crop,!0)){let{x:Ae,y:Je}=F.alignAttr;le=ot.isInsidePlot(Ae,Je,{paneCoordinates:!0,series:this})&&ot.isInsidePlot(Ae+Be.width-1,Je+Be.height-1,{paneCoordinates:!0,series:this})}G.shape&&!Ht&&F[J?"attr":"animate"]({anchorX:Kt[0],anchorY:Kt[1]})}J&&rt&&(F.placed=!1),le||rt&&!Vt?(F.show(),F.placed=!0):(F.hide(),F.placed=!1)}function g(){return this.plotGroup("dataLabelsGroup","data-labels",this.hasRendered?"inherit":"hidden",this.options.dataLabels.zIndex||6)}function b(U){let F=this.hasRendered||0,G=this.initDataLabelsGroup().attr({opacity:+F});return!F&&G&&(this.visible&&G.show(),this.options.animation?G.animate({opacity:1},U):G.attr({opacity:1})),G}function w(U){var le;let F;U=U||this.points;let G=this,Z=G.chart,J=G.options,ot=Z.renderer,{backgroundColor:rt,plotBackgroundColor:it}=Z.options.chart,ct=ot.getContrast(nu(it)&&it||nu(rt)&&rt||"#000000"),dt=I(G),{animation:Ht,defer:Bt}=dt[0],Vt=Bt?r0(Z,Ht,G):{defer:0,duration:0};dp(this,"drawDataLabels"),(le=G.hasDataLabels)!=null&&le.call(G)&&(F=this.initDataLabels(Vt),U.forEach(Kt=>{var $e,Ae,Je;let ce=Kt.dataLabels||[],Ee=Kt.color||G.color;Rm(C(dt,Kt.dlOptions||(($e=Kt.options)==null?void 0:$e.dataLabels))).forEach((ri,Ii)=>{var $s;let hi=ri.enabled&&(Kt.visible||Kt.dataLabelOnHidden)&&(!Kt.isNull||Kt.dataLabelOnNull)&&function(Ks,Xr){let mo=Xr.filter;if(mo){let Fo=mo.operator,Dr=Ks[mo.property],Rn=mo.value;return Fo===">"&&Dr>Rn||Fo==="<"&&Dr<Rn||Fo===">="&&Dr>=Rn||Fo==="<="&&Dr<=Rn||Fo==="=="&&Dr==Rn||Fo==="==="&&Dr===Rn||Fo==="!="&&Dr!=Rn||Fo==="!=="&&Dr!==Rn||!1}return!0}(Kt,ri),{backgroundColor:Li,borderColor:as,distance:Zi,style:ds={}}=ri,gr,ls,Ms,Bi={},si=ce[Ii],xn=!si,As;hi&&(ls=Da(gr=jd(ri[Kt.formatPrefix+"Format"],ri.format))?su(gr,Kt,Z):(ri[Kt.formatPrefix+"Formatter"]||ri.formatter).call(Kt,ri),Ms=ri.rotation,!Z.styledMode&&(ds.color=jd(ri.color,ds.color,nu(G.color)?G.color:void 0,"#000000"),ds.color==="contrast"?(Li!=="none"&&(As=Li),Kt.contrastColor=ot.getContrast(As!=="auto"&&nu(As)&&As||(nu(Ee)?Ee:"")),ds.color=As||!Da(Zi)&&ri.inside||0>o0(Zi||0)||J.stacking?Kt.contrastColor:ct):delete Kt.contrastColor,J.cursor&&(ds.cursor=J.cursor)),Bi={r:ri.borderRadius||0,rotation:Ms,padding:ri.padding,zIndex:1},Z.styledMode||(Bi.fill=Li==="auto"?Kt.color:Li,Bi.stroke=as==="auto"?Kt.color:as,Bi["stroke-width"]=ri.borderWidth),D_(Bi,(Ks,Xr)=>{Ks===void 0&&delete Bi[Xr]})),!si||hi&&Da(ls)&&!!(si.div||($s=si.text)!=null&&$s.foreignObject)==!!ri.useHTML&&(si.rotation&&ri.rotation||si.rotation===ri.rotation)||(si=void 0,xn=!0),hi&&Da(ls)&&(si?Bi.text=ls:(si=ot.label(ls,0,0,ri.shape,void 0,void 0,ri.useHTML,void 0,"data-label")).addClass(" highcharts-data-label-color-"+Kt.colorIndex+" "+(ri.className||"")+(ri.useHTML?" highcharts-tracker":"")),si&&(si.options=ri,si.attr(Bi),Z.styledMode?ds.width&&si.css({width:ds.width,textOverflow:ds.textOverflow,whiteSpace:ds.whiteSpace}):si.css(ds).shadow(ri.shadow),dp(si,"beforeAddingDataLabel",{labelOptions:ri,point:Kt}),si.added||si.add(F),G.alignDataLabel(Kt,si,ri,void 0,xn),si.isActive=!0,ce[Ii]&&ce[Ii]!==si&&ce[Ii].destroy(),ce[Ii]=si))});let Be=ce.length;for(;Be--;)(Ae=ce[Be])!=null&&Ae.isActive?ce[Be].isActive=!1:((Je=ce[Be])==null||Je.destroy(),ce.splice(Be,1));Kt.dataLabel=ce[0],Kt.dataLabels=ce})),dp(this,"afterDrawDataLabels")}function A(U,F,G,Z,J,ot){let rt=this.chart,it=F.align,ct=F.verticalAlign,dt=U.box?0:U.padding||0,Ht=rt.inverted?this.yAxis:this.xAxis,Bt=Ht?Ht.left-rt.plotLeft:0,Vt=rt.inverted?this.xAxis:this.yAxis,le=Vt?Vt.top-rt.plotTop:0,{x:Kt=0,y:ce=0}=F,Ee,Be;return(Ee=(G.x||0)+dt+Bt)<0&&(it==="right"&&Kt>=0?(F.align="left",F.inside=!0):Kt-=Ee,Be=!0),(Ee=(G.x||0)+Z.width-dt+Bt)>rt.plotWidth&&(it==="left"&&Kt<=0?(F.align="right",F.inside=!0):Kt+=rt.plotWidth-Ee,Be=!0),(Ee=G.y+dt+le)<0&&(ct==="bottom"&&ce>=0?(F.verticalAlign="top",F.inside=!0):ce-=Ee,Be=!0),(Ee=(G.y||0)+Z.height-dt+le)>rt.plotHeight&&(ct==="top"&&ce<=0?(F.verticalAlign="bottom",F.inside=!0):ce+=rt.plotHeight-Ee,Be=!0),Be&&(F.x=Kt,F.y=ce,U.placed=!ot,U.align(F,void 0,J)),Be}function C(U,F){let G=[],Z;if(ic(U)&&!ic(F))G=U.map(function(J){return Nd(J,F)});else if(ic(F)&&!ic(U))G=F.map(function(J){return Nd(U,J)});else if(ic(U)||ic(F)){if(ic(U)&&ic(F))for(Z=Math.max(U.length,F.length);Z--;)G[Z]=Nd(U[Z],F[Z])}else G=Nd(U,F);return G}function I(U){var G,Z;let F=U.chart.options.plotOptions;return Rm(C(C((G=F==null?void 0:F.series)==null?void 0:G.dataLabels,(Z=F==null?void 0:F[U.type])==null?void 0:Z.dataLabels),U.options.dataLabels))}function R(U,F,G,Z,J){let ot=this.chart,rt=ot.inverted,it=this.xAxis,ct=it.reversed,dt=((rt?F.height:F.width)||0)/2,Ht=U.pointWidth,Bt=Ht?Ht/2:0;F.startXPos=rt?J.x:ct?-dt-Bt:it.width-dt+Bt,F.startYPos=rt?ct?this.yAxis.height-dt+Bt:-dt-Bt:J.y,Z?F.visibility==="hidden"&&(F.show(),F.attr({opacity:0}).animate({opacity:1})):F.attr({opacity:1}).animate({opacity:0},void 0,F.hide),ot.hasRendered&&(G&&F.attr({x:F.startXPos,y:F.startYPos}),F.placed=!0)}B.compose=function(U){let F=U.prototype;F.initDataLabels||(F.initDataLabels=b,F.initDataLabelsGroup=g,F.alignDataLabel=f,F.drawDataLabels=w,F.justifyDataLabel=A,F.mergeArrays=C,F.setDataLabelStartPos=R,F.hasDataLabels=l)}})(Lt||(Lt={}));let Ud=Lt,{composed:z_}=kt,{series:fp}=bs,{merge:pl,pushUnique:Hr}=_t;(function(B){function l(f,g,b,w,A){var ot,rt;let{chart:C,options:I}=this,R=C.inverted,U=((ot=this.xAxis)==null?void 0:ot.len)||C.plotSizeX||0,F=((rt=this.yAxis)==null?void 0:rt.len)||C.plotSizeY||0,G=f.dlBox||f.shapeArgs,Z=f.below??(f.plotY||0)>(this.translatedThreshold??F),J=b.inside??!!I.stacking;if(G){if(w=pl(G),b.overflow!=="allow"||b.crop!==!1||I.clip!==!1){w.y<0&&(w.height+=w.y,w.y=0);let it=w.y+w.height-F;it>0&&it<w.height-1&&(w.height-=it)}R&&(w={x:F-w.y-w.height,y:U-w.x-w.width,width:w.height,height:w.width}),J||(R?(w.x+=Z?0:w.width,w.width=0):(w.y+=Z?w.height:0,w.height=0))}b.align??(b.align=!R||J?"center":Z?"right":"left"),b.verticalAlign??(b.verticalAlign=R||J?"middle":Z?"top":"bottom"),fp.prototype.alignDataLabel.call(this,f,g,b,w,A),b.inside&&f.contrastColor&&g.css({color:f.contrastColor})}B.compose=function(f){Ud.compose(fp),Hr(z_,"ColumnDataLabel")&&(f.prototype.alignDataLabel=l)}})(Nt||(Nt={}));let a0=Nt,{extend:Bm,merge:l0}=_t;class Fm extends Fd{}Fm.defaultOptions=l0(Fd.defaultOptions,{}),Bm(Fm.prototype,{inverted:!0}),bs.registerSeriesType("bar",Fm);let{column:c0,line:pp}=bs.seriesTypes,{addEvent:mp,extend:O_,merge:qc}=_t;class sc extends pp{applyJitter(){let l=this,f=this.options.jitter,g=this.points.length;f&&this.points.forEach(function(b,w){["x","y"].forEach(function(A,C){if(f[A]&&!b.isNull){let I=`plot${A.toUpperCase()}`,R=l[`${A}Axis`],U=f[A]*R.transA;if(R&&!R.logarithmic){let F=Math.max(0,(b[I]||0)-U),G=Math.min(R.len,(b[I]||0)+U);b[I]=F+(G-F)*function(Z){let J=1e4*Math.sin(Z);return J-Math.floor(J)}(w+C*g),A==="x"&&(b.clientX=b.plotX)}}})})}drawGraph(){this.options.lineWidth?super.drawGraph():this.graph&&(this.graph=this.graph.destroy())}}sc.defaultOptions=qc(pp.defaultOptions,{lineWidth:0,findNearestPointBy:"xy",jitter:{x:0,y:0},marker:{enabled:!0},tooltip:{headerFormat:'<span style="color:{point.color}"></span> <span style="font-size: 0.8em"> {series.name}</span><br/>',pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>"}}),O_(sc.prototype,{drawTracker:c0.prototype.drawTracker,sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","markerGroup","dataLabelsGroup"]}),mp(sc,"afterTranslate",function(){this.applyJitter()}),bs.registerSeriesType("scatter",sc);let{deg2rad:R_}=kt,{fireEvent:h0,isNumber:Nm,pick:gp,relativeLength:u0}=_t;(function(B){B.getCenter=function(){let l=this.options,f=this.chart,g=2*(l.slicedOffset||0),b=f.plotWidth-2*g,w=f.plotHeight-2*g,A=l.center,C=Math.min(b,w),I=l.thickness,R,U=l.size,F=l.innerSize||0,G,Z;typeof U=="string"&&(U=parseFloat(U)),typeof F=="string"&&(F=parseFloat(F));let J=[gp(A==null?void 0:A[0],"50%"),gp(A==null?void 0:A[1],"50%"),gp(U&&U<0?void 0:l.size,"100%"),gp(F&&F<0?void 0:l.innerSize||0,"0%")];for(!f.angular||this instanceof ar||(J[3]=0),G=0;G<4;++G)Z=J[G],R=G<2||G===2&&/%$/.test(Z),J[G]=u0(Z,[b,w,C,J[2]][G])+(R?g:0);return J[3]>J[2]&&(J[3]=J[2]),Nm(I)&&2*I<J[2]&&I>0&&(J[3]=J[2]-2*I),h0(this,"afterGetCenter",{positions:J}),J},B.getStartAndEndRadians=function(l,f){let g=Nm(l)?l:0,b=Nm(f)&&f>g&&f-g<360?f:g+360;return{start:R_*(g+-90),end:R_*(b+-90)}}})(Dt||(Dt={}));let B_=Dt,{setAnimation:d0}=mn,{addEvent:_p,defined:f0,extend:ru,isNumber:p0,pick:An,relativeLength:yp}=_t;class jm extends et{getConnectorPath(l){let f=l.dataLabelPosition,g=l.options||{},b=g.connectorShape,w=this.connectorShapes[b]||b;return f&&w.call(this,{...f.computed,alignment:f.alignment},f.connectorPosition,g)||[]}getTranslate(){return this.sliced&&this.slicedTranslation||{translateX:0,translateY:0}}haloPath(l){let f=this.shapeArgs;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(f.x,f.y,f.r+l,f.r+l,{innerR:f.r-1,start:f.start,end:f.end,borderRadius:f.borderRadius})}constructor(l,f,g){super(l,f,g),this.half=0,this.name??(this.name=l.chart.options.lang.pieSliceName);let b=w=>{this.slice(w.type==="select")};_p(this,"select",b),_p(this,"unselect",b)}isValid(){return p0(this.y)&&this.y>=0}setVisible(l,f=!0){l!==this.visible&&this.update({visible:l??!this.visible},f,void 0,!1)}slice(l,f,g){let b=this.series;d0(g,b.chart),f=An(f,!0),this.sliced=this.options.sliced=l=f0(l)?l:!this.sliced,b.options.data[b.data.indexOf(this)]=this.options,this.graphic&&this.graphic.animate(this.getTranslate())}}ru(jm.prototype,{connectorShapes:{fixedOffset:function(B,l,f){let g=l.breakAt,b=l.touchingSliceAt,w=f.softConnector?["C",B.x+(B.alignment==="left"?-5:5),B.y,2*g.x-b.x,2*g.y-b.y,g.x,g.y]:["L",g.x,g.y];return[["M",B.x,B.y],w,["L",b.x,b.y]]},straight:function(B,l){let f=l.touchingSliceAt;return[["M",B.x,B.y],["L",f.x,f.y]]},crookedLine:function(B,l,f){let{angle:g=this.angle||0,breakAt:b,touchingSliceAt:w}=l,{series:A}=this,[C,I,R]=A.center,U=R/2,{plotLeft:F,plotWidth:G}=A.chart,Z=B.alignment==="left",{x:J,y:ot}=B,rt=b.x;if(f.crookDistance){let ct=yp(f.crookDistance,1);rt=Z?C+U+(G+F-C-U)*(1-ct):F+(C-U)*ct}else rt=C+(I-ot)*Math.tan(g-Math.PI/2);let it=[["M",J,ot]];return(Z?rt<=J&&rt>=b.x:rt>=J&&rt<=b.x)&&it.push(["L",rt,ot]),it.push(["L",b.x,b.y],["L",w.x,w.y]),it}}});let{getStartAndEndRadians:xp}=B_,{noop:Vd}=kt,{clamp:$d,extend:F_,fireEvent:Um,merge:Zc,pick:Vm}=_t;class Gd extends ar{animate(l){let f=this,g=f.points,b=f.startAngleRad;l||g.forEach(function(w){let A=w.graphic,C=w.shapeArgs;A&&C&&(A.attr({r:Vm(w.startR,f.center&&f.center[3]/2),start:b,end:b}),A.animate({r:C.r,start:C.start,end:C.end},f.options.animation))})}drawEmpty(){let l,f,g=this.startAngleRad,b=this.endAngleRad,w=this.options;this.total===0&&this.center?(l=this.center[0],f=this.center[1],this.graph||(this.graph=this.chart.renderer.arc(l,f,this.center[1]/2,0,g,b).addClass("highcharts-empty-series").add(this.group)),this.graph.attr({d:Sh.arc(l,f,this.center[2]/2,0,{start:g,end:b,innerR:this.center[3]/2})}),this.chart.styledMode||this.graph.attr({"stroke-width":w.borderWidth,fill:w.fillColor||"none",stroke:w.color||"#cccccc"})):this.graph&&(this.graph=this.graph.destroy())}drawPoints(){let l=this.chart.renderer;this.points.forEach(function(f){f.graphic&&f.hasNewShapeType()&&(f.graphic=f.graphic.destroy()),f.graphic||(f.graphic=l[f.shapeType](f.shapeArgs).add(f.series.group),f.delayedRendering=!0)})}generatePoints(){super.generatePoints(),this.updateTotals()}getX(l,f,g,b){let w=this.center,A=this.radii?this.radii[g.index]||0:w[2]/2,C=b.dataLabelPosition,I=(C==null?void 0:C.distance)||0,R=Math.asin($d((l-w[1])/(A+I),-1,1));return w[0]+Math.cos(R)*(A+I)*(f?-1:1)+(I>0?(f?-1:1)*(b.padding||0):0)}hasData(){return!!this.dataTable.rowCount}redrawPoints(){let l,f,g,b,w=this,A=w.chart;this.drawEmpty(),w.group&&!A.styledMode&&w.group.shadow(w.options.shadow),w.points.forEach(function(C){let I={};f=C.graphic,!C.isNull&&f?(b=C.shapeArgs,l=C.getTranslate(),A.styledMode||(g=w.pointAttribs(C,C.selected&&"select")),C.delayedRendering?(f.setRadialReference(w.center).attr(b).attr(l),A.styledMode||f.attr(g).attr({"stroke-linejoin":"round"}),C.delayedRendering=!1):(f.setRadialReference(w.center),A.styledMode||Zc(!0,I,g),Zc(!0,I,b,l),f.animate(I)),f.attr({visibility:C.visible?"inherit":"hidden"}),f.addClass(C.getClassName(),!0)):f&&(C.graphic=f.destroy())})}sortByAngle(l,f){l.sort(function(g,b){return g.angle!==void 0&&(b.angle-g.angle)*f})}translate(l){Um(this,"translate"),this.generatePoints();let f=this.options,g=f.slicedOffset,b=xp(f.startAngle,f.endAngle),w=this.startAngleRad=b.start,A=(this.endAngleRad=b.end)-w,C=this.points,I=f.ignoreHiddenPoint,R=C.length,U,F,G,Z,J,ot,rt,it=0;for(l||(this.center=l=this.getCenter()),ot=0;ot<R;ot++){rt=C[ot],U=w+it*A,rt.isValid()&&(!I||rt.visible)&&(it+=rt.percentage/100),F=w+it*A;let ct={x:l[0],y:l[1],r:l[2]/2,innerR:l[3]/2,start:Math.round(1e3*U)/1e3,end:Math.round(1e3*F)/1e3};rt.shapeType="arc",rt.shapeArgs=ct,(G=(F+U)/2)>1.5*Math.PI?G-=2*Math.PI:G<-Math.PI/2&&(G+=2*Math.PI),rt.slicedTranslation={translateX:Math.round(Math.cos(G)*g),translateY:Math.round(Math.sin(G)*g)},Z=Math.cos(G)*l[2]/2,J=Math.sin(G)*l[2]/2,rt.tooltipPos=[l[0]+.7*Z,l[1]+.7*J],rt.half=+(G<-Math.PI/2||G>Math.PI/2),rt.angle=G}Um(this,"afterTranslate")}updateTotals(){let l=this.points,f=l.length,g=this.options.ignoreHiddenPoint,b,w,A=0;for(b=0;b<f;b++)(w=l[b]).isValid()&&(!g||w.visible)&&(A+=w.y);for(b=0,this.total=A;b<f;b++)(w=l[b]).percentage=A>0&&(w.visible||!g)?w.y/A*100:0,w.total=A}}Gd.defaultOptions=Zc(ar.defaultOptions,{borderRadius:3,center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{connectorPadding:5,connectorShape:"crookedLine",crookDistance:void 0,distance:30,enabled:!0,formatter:function(){return this.isNull?void 0:this.name},softConnector:!0,x:0},fillColor:void 0,ignoreHiddenPoint:!0,inactiveOtherPoints:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,stickyTracking:!1,tooltip:{followPointer:!0},borderColor:"#ffffff",borderWidth:1,lineWidth:void 0,states:{hover:{brightness:.1}}}),F_(Gd.prototype,{axisTypes:[],directTouch:!0,drawGraph:void 0,drawTracker:Fd.prototype.drawTracker,getCenter:B_.getCenter,getSymbol:Vd,invertible:!1,isCartesian:!1,noSharedTooltip:!0,pointAttribs:Fd.prototype.pointAttribs,pointClass:jm,requireSorting:!1,searchPoint:Vd,trackerGroups:["group","dataLabelsGroup"]}),bs.registerSeriesType("pie",Gd);let{composed:$m,noop:m0}=kt,{distribute:N_}=xa,{series:ou}=bs,{arrayMax:g0,clamp:vp,defined:j_,pick:Gm,pushUnique:Wm,relativeLength:Wd}=_t;(function(B){let l={radialDistributionY:function(A,C){var I;return(((I=C.dataLabelPosition)==null?void 0:I.top)||0)+A.distributeBox.pos},radialDistributionX:function(A,C,I,R,U){let F=U.dataLabelPosition;return A.getX(I<((F==null?void 0:F.top)||0)+2||I>((F==null?void 0:F.bottom)||0)-2?R:I,C.half,C,U)},justify:function(A,C,I,R){var U;return R[0]+(A.half?-1:1)*(I+(((U=C.dataLabelPosition)==null?void 0:U.distance)||0))},alignToPlotEdges:function(A,C,I,R){let U=A.getBBox().width;return C?U+R:I-U-R},alignToConnectors:function(A,C,I,R){let U=0,F;return A.forEach(function(G){(F=G.dataLabel.getBBox().width)>U&&(U=F)}),C?U+R:I-U-R}};function f(A,C){let I=Math.PI/2,{start:R=0,end:U=0}=A.shapeArgs||{},F=A.angle||0;C>0&&R<I&&U>I&&F>I/2&&F<1.5*I&&(F=F<=I?Math.max(I/2,(R+I)/2):Math.min(1.5*I,(I+U)/2));let{center:G,options:Z}=this,J=G[2]/2,ot=Math.cos(F),rt=Math.sin(F),it=G[0]+ot*J,ct=G[1]+rt*J,dt=Math.min((Z.slicedOffset||0)+(Z.borderWidth||0),C/5);return{natural:{x:it+ot*C,y:ct+rt*C},computed:{},alignment:C<0?"center":A.half?"right":"left",connectorPosition:{angle:F,breakAt:{x:it+ot*dt,y:ct+rt*dt},touchingSliceAt:{x:it,y:ct}},distance:C}}function g(){var le;let A=this,C=A.points,I=A.chart,R=I.plotWidth,U=I.plotHeight,F=I.plotLeft,G=Math.round(I.chartWidth/3),Z=A.center,J=Z[2]/2,ot=Z[1],rt=[[],[]],it=[0,0,0,0],ct=A.dataLabelPositioners,dt,Ht,Bt,Vt=0;A.visible&&((le=A.hasDataLabels)!=null&&le.call(A))&&(C.forEach(Kt=>{(Kt.dataLabels||[]).forEach(ce=>{ce.shortened&&(ce.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),ce.shortened=!1)})}),ou.prototype.drawDataLabels.apply(A),C.forEach(Kt=>{(Kt.dataLabels||[]).forEach((ce,Ee)=>{var Je;let Be=Z[2]/2,$e=ce.options,Ae=Wd(($e==null?void 0:$e.distance)||0,Be);Ee===0&&rt[Kt.half].push(Kt),!j_((Je=$e==null?void 0:$e.style)==null?void 0:Je.width)&&ce.getBBox().width>G&&(ce.css({width:Math.round(.7*G)+"px"}),ce.shortened=!0),ce.dataLabelPosition=this.getDataLabelPosition(Kt,Ae),Vt=Math.max(Vt,Ae)})}),rt.forEach((Kt,ce)=>{let Ee=Kt.length,Be=[],$e,Ae,Je=0,ri;Ee&&(A.sortByAngle(Kt,ce-.5),Vt>0&&($e=Math.max(0,ot-J-Vt),Ae=Math.min(ot+J+Vt,I.plotHeight),Kt.forEach(Ii=>{(Ii.dataLabels||[]).forEach(hi=>{var as;let Li=hi.dataLabelPosition;Li&&Li.distance>0&&(Li.top=Math.max(0,ot-J-Li.distance),Li.bottom=Math.min(ot+J+Li.distance,I.plotHeight),Je=hi.getBBox().height||21,hi.lineHeight=I.renderer.fontMetrics(hi.text||hi).h+2*hi.padding,Ii.distributeBox={target:(((as=hi.dataLabelPosition)==null?void 0:as.natural.y)||0)-Li.top+hi.lineHeight/2,size:Je,rank:Ii.y},Be.push(Ii.distributeBox))})}),N_(Be,ri=Ae+Je-$e,ri/5)),Kt.forEach(Ii=>{(Ii.dataLabels||[]).forEach(hi=>{let Li=hi.options||{},as=Ii.distributeBox,Zi=hi.dataLabelPosition,ds=(Zi==null?void 0:Zi.natural.y)||0,gr=Li.connectorPadding||0,ls=hi.lineHeight||21,Ms=(ls-hi.getBBox().height)/2,Bi=0,si=ds,xn="inherit";if(Zi){if(Be&&j_(as)&&Zi.distance>0&&(as.pos===void 0?xn="hidden":(Bt=as.size,si=ct.radialDistributionY(Ii,hi))),Li.justify)Bi=ct.justify(Ii,hi,J,Z);else switch(Li.alignTo){case"connectors":Bi=ct.alignToConnectors(Kt,ce,R,F);break;case"plotEdges":Bi=ct.alignToPlotEdges(hi,ce,R,F);break;default:Bi=ct.radialDistributionX(A,Ii,si-Ms,ds,hi)}if(Zi.attribs={visibility:xn,align:Zi.alignment},Zi.posAttribs={x:Bi+(Li.x||0)+({left:gr,right:-gr}[Zi.alignment]||0),y:si+(Li.y||0)-ls/2},Zi.computed.x=Bi,Zi.computed.y=si-Ms,Gm(Li.crop,!0)){let As;Bi-(Ht=hi.getBBox().width)<gr&&ce===1?(As=Math.round(Ht-Bi+gr),it[3]=Math.max(As,it[3])):Bi+Ht>R-gr&&ce===0&&(As=Math.round(Bi+Ht-R+gr),it[1]=Math.max(As,it[1])),si-Bt/2<0?it[0]=Math.max(Math.round(-si+Bt/2),it[0]):si+Bt/2>U&&(it[2]=Math.max(Math.round(si+Bt/2-U),it[2])),Zi.sideOverflow=As}}})}))}),(g0(it)===0||this.verifyDataLabelOverflow(it))&&(this.placeDataLabels(),this.points.forEach(Kt=>{(Kt.dataLabels||[]).forEach(ce=>{var Ae;let{connectorColor:Ee,connectorWidth:Be=1}=ce.options||{},$e=ce.dataLabelPosition;if(Be){let Je;dt=ce.connector,$e&&$e.distance>0?(Je=!dt,dt||(ce.connector=dt=I.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+Kt.colorIndex+(Kt.className?" "+Kt.className:"")).add(A.dataLabelsGroup)),I.styledMode||dt.attr({"stroke-width":Be,stroke:Ee||Kt.color||"#666666"}),dt[Je?"attr":"animate"]({d:Kt.getConnectorPath(ce)}),dt.attr({visibility:(Ae=$e.attribs)==null?void 0:Ae.visibility})):dt&&(ce.connector=dt.destroy())}})})))}function b(){this.points.forEach(A=>{(A.dataLabels||[]).forEach(C=>{var R,U;let I=C.dataLabelPosition;I?(I.sideOverflow&&(C.css({width:Math.max(C.getBBox().width-I.sideOverflow,0)+"px",textOverflow:((U=(R=C.options)==null?void 0:R.style)==null?void 0:U.textOverflow)||"ellipsis"}),C.shortened=!0),C.attr(I.attribs),C[C.moved?"animate":"attr"](I.posAttribs),C.moved=!0):C&&C.attr({y:-9999})}),delete A.distributeBox},this)}function w(A){let C=this.center,I=this.options,R=I.center,U=I.minSize||80,F=U,G=I.size!==null;return!G&&(R[0]!==null?F=Math.max(C[2]-Math.max(A[1],A[3]),U):(F=Math.max(C[2]-A[1]-A[3],U),C[0]+=(A[3]-A[1])/2),R[1]!==null?F=vp(F,U,C[2]-Math.max(A[0],A[2])):(F=vp(F,U,C[2]-A[0]-A[2]),C[1]+=(A[0]-A[2])/2),F<C[2]?(C[2]=F,C[3]=Math.min(I.thickness?Math.max(0,F-2*I.thickness):Math.max(0,Wd(I.innerSize||0,F)),F),this.translate(C),this.drawDataLabels&&this.drawDataLabels()):G=!0),G}B.compose=function(A){if(Ud.compose(ou),Wm($m,"PieDataLabel")){let C=A.prototype;C.dataLabelPositioners=l,C.alignDataLabel=m0,C.drawDataLabels=g,C.getDataLabelPosition=f,C.placeDataLabels=b,C.verifyDataLabelOverflow=w}}})(wt||(wt={}));let _0=wt;(function(B){B.getCenterOfPoints=function(l){let f=l.reduce((g,b)=>(g.x+=b.x,g.y+=b.y,g),{x:0,y:0});return{x:f.x/l.length,y:f.y/l.length}},B.getDistanceBetweenPoints=function(l,f){return Math.sqrt(Math.pow(f.x-l.x,2)+Math.pow(f.y-l.y,2))},B.getAngleBetweenPoints=function(l,f){return Math.atan2(f.x-l.x,f.y-l.y)},B.pointInPolygon=function({x:l,y:f},g){let b=g.length,w,A,C=!1;for(w=0,A=b-1;w<b;A=w++){let[I,R]=g[w],[U,F]=g[A];R>f!=F>f&&l<(U-I)*(f-R)/(F-R)+I&&(C=!C)}return C}})(It||(It={}));let{pointInPolygon:y0}=It,{addEvent:x0,getAlignFactor:v0,fireEvent:U_,objectEach:V_,pick:bp}=_t;function b0(B){let l=B.length,f=(U,F)=>!(F.x>=U.x+U.width||F.x+F.width<=U.x||F.y>=U.y+U.height||F.y+F.height<=U.y),g=(U,F)=>{for(let G of U)if(y0({x:G[0],y:G[1]},F))return!0;return!1},b,w,A,C,I,R=!1;for(let U=0;U<l;U++)(b=B[U])&&(b.oldOpacity=b.opacity,b.newOpacity=1,b.absoluteBox=function(F){var G,Z;if(F&&(!F.alignAttr||F.placed)){let J=F.box?0:F.padding||0,ot=F.alignAttr||{x:F.attr("x"),y:F.attr("y")},{height:rt,polygon:it,width:ct}=F.getBBox(),dt=v0(F.alignValue)*ct;return F.width=ct,F.height=rt,{x:ot.x+(((G=F.parentGroup)==null?void 0:G.translateX)||0)+J-dt,y:ot.y+(((Z=F.parentGroup)==null?void 0:Z.translateY)||0)+J,width:ct-2*J,height:rt-2*J,polygon:it}}}(b));B.sort((U,F)=>(F.labelrank||0)-(U.labelrank||0));for(let U=0;U<l;++U){C=(w=B[U])&&w.absoluteBox;let F=C==null?void 0:C.polygon;for(let G=U+1;G<l;++G){I=(A=B[G])&&A.absoluteBox;let Z=!1;if(C&&I&&w!==A&&w.newOpacity!==0&&A.newOpacity!==0&&w.visibility!=="hidden"&&A.visibility!=="hidden"){let J=I.polygon;if(F&&J&&F!==J?g(F,J)&&(Z=!0):f(C,I)&&(Z=!0),Z){let ot=w.labelrank<A.labelrank?w:A,rt=ot.text;ot.newOpacity=0,rt!=null&&rt.element.querySelector("textPath")&&rt.hide()}}}}for(let U of B)Hm(U,this)&&(R=!0);R&&U_(this,"afterHideAllOverlappingLabels")}function Hm(B,l){let f,g=!1;return B&&(f=B.newOpacity,B.oldOpacity!==f&&(B.hasClass("highcharts-data-label")?(B[f?"removeClass":"addClass"]("highcharts-data-label-hidden"),g=!0,B[B.isOld?"animate":"attr"]({opacity:f},void 0,function(){l.styledMode||B.css({pointerEvents:f?"auto":"none"})}),U_(l,"afterHideOverlappingLabel")):B.attr({opacity:f})),B.isOld=!0),g}function au(){var f;let B=this,l=[];for(let g of B.labelCollectors||[])l=l.concat(g());for(let g of B.yAxis||[])g.stacking&&g.options.stackLabels&&!g.options.stackLabels.allowOverlap&&V_(g.stacking.stacks,b=>{V_(b,w=>{w.label&&l.push(w.label)})});for(let g of B.series||[])if(g.visible&&((f=g.hasDataLabels)!=null&&f.call(g))){let b=w=>{for(let A of w)A.visible&&(A.dataLabels||[]).forEach(C=>{var R;let I=C.options||{};C.labelrank=bp(I.labelrank,A.labelrank,(R=A.shapeArgs)==null?void 0:R.height),I.allowOverlap??Number(I.distance)>0?(C.oldOpacity=C.opacity,C.newOpacity=1,Hm(C,B)):l.push(C)})};b(g.nodes||[]),b(g.points)}this.hideOverlappingLabels(l)}let $_={compose:function(B){let l=B.prototype;l.hideOverlappingLabels||(l.hideOverlappingLabels=b0,x0(B,"render",au))}},{defaultOptions:w0}=At,{noop:G_}=kt,{addEvent:Xm,extend:W_,isObject:H_,merge:T0,relativeLength:qm}=_t,Zm={radius:0,scope:"stack",where:void 0},Hd=G_,Xd=G_;function S0(B,l,f,g,b={}){let w=Hd(B,l,f,g,b),{innerR:A=0,r:C=f,start:I=0,end:R=0}=b;if(b.open||!b.borderRadius)return w;let U=R-I,F=Math.sin(U/2),G=Math.max(Math.min(qm(b.borderRadius||0,C-A),(C-A)/2,C*F/(1+F)),0),Z=Math.min(G,U/Math.PI*2*A),J=w.length-1;for(;J--;)(function(ot,rt,it){let ct,dt,Ht,Bt=ot[rt],Vt=ot[rt+1];if(Vt[0]==="Z"&&(Vt=ot[0]),(Bt[0]==="M"||Bt[0]==="L")&&Vt[0]==="A"?(ct=Bt,dt=Vt,Ht=!0):Bt[0]==="A"&&(Vt[0]==="M"||Vt[0]==="L")&&(ct=Vt,dt=Bt),ct&&dt&&dt.params){let le=dt[1],Kt=dt[5],ce=dt.params,{start:Ee,end:Be,cx:$e,cy:Ae}=ce,Je=Kt?le-it:le+it,ri=Je?Math.asin(it/Je):0,Ii=Kt?ri:-ri,hi=Math.cos(ri)*Je;Ht?(ce.start=Ee+Ii,ct[1]=$e+hi*Math.cos(Ee),ct[2]=Ae+hi*Math.sin(Ee),ot.splice(rt+1,0,["A",it,it,0,0,1,$e+le*Math.cos(ce.start),Ae+le*Math.sin(ce.start)])):(ce.end=Be-Ii,dt[6]=$e+le*Math.cos(ce.end),dt[7]=Ae+le*Math.sin(ce.end),ot.splice(rt+1,0,["A",it,it,0,0,1,$e+hi*Math.cos(Be),Ae+hi*Math.sin(Be)])),dt[4]=Math.abs(ce.end-ce.start)<Math.PI?0:1}})(w,J,J>1?Z:G);return w}function E0(){var B,l;if(this.options.borderRadius&&!(this.chart.is3d&&this.chart.is3d())){let{options:f,yAxis:g}=this,b=f.stacking==="percent",w=(l=(B=w0.plotOptions)==null?void 0:B[this.type])==null?void 0:l.borderRadius,A=Yc(f.borderRadius,H_(w)?w:{}),C=g.options.reversed;for(let I of this.points){let{shapeArgs:R}=I;if(I.shapeType==="roundedRect"&&R){let{width:U=0,height:F=0,y:G=0}=R,Z=G,J=F;if(A.scope==="stack"&&I.stackTotal){let ct=g.translate(b?100:I.stackTotal,!1,!0,!1,!0),dt=g.translate(f.threshold||0,!1,!0,!1,!0),Ht=this.crispCol(0,Math.min(ct,dt),0,Math.abs(ct-dt));Z=Ht.y,J=Ht.height}let ot=(I.negative?-1:1)*(C?-1:1)==-1,rt=A.where;!rt&&this.is("waterfall")&&Math.abs((I.yBottom||0)-(this.translatedThreshold||0))>this.borderWidth&&(rt="all"),rt||(rt="end");let it=Math.min(qm(A.radius,U),U/2,rt==="all"?F/2:1/0)||0;rt==="end"&&(ot&&(Z-=it),J+=it),W_(R,{brBoxHeight:J,brBoxY:Z,r:it})}}}}function Yc(B,l){return H_(B)||(B={radius:B||0}),T0(Zm,l,B)}function qd(){let B=Yc(this.options.borderRadius);for(let l of this.points){let f=l.shapeArgs;f&&(f.borderRadius=qm(B.radius,(f.r||0)-(f.innerR||0)))}}function X_(B,l,f,g,b={}){let w=Xd(B,l,f,g,b),{r:A=0,brBoxHeight:C=g,brBoxY:I=l}=b,R=l-I,U=I+C-(l+g),F=R-A>-.1?0:A,G=U-A>-.1?0:A,Z=Math.max(F&&R,0),J=Math.max(G&&U,0),ot=[B+F,l],rt=[B+f-F,l],it=[B+f,l+F],ct=[B+f,l+g-G],dt=[B+f-G,l+g],Ht=[B+G,l+g],Bt=[B,l+g-G],Vt=[B,l+F],le=(Kt,ce)=>Math.sqrt(Math.pow(Kt,2)-Math.pow(ce,2));if(Z){let Kt=le(F,F-Z);ot[0]-=Kt,rt[0]+=Kt,it[1]=Vt[1]=l+F-Z}if(g<F-Z){let Kt=le(F,F-Z-g);it[0]=ct[0]=B+f-F+Kt,dt[0]=Math.min(it[0],dt[0]),Ht[0]=Math.max(ct[0],Ht[0]),Bt[0]=Vt[0]=B+F-Kt,it[1]=Vt[1]=l+g}if(J){let Kt=le(G,G-J);dt[0]+=Kt,Ht[0]-=Kt,ct[1]=Bt[1]=l+g-G+J}if(g<G-J){let Kt=le(G,G-J-g);it[0]=ct[0]=B+f-G+Kt,rt[0]=Math.min(it[0],rt[0]),ot[0]=Math.max(ct[0],ot[0]),Bt[0]=Vt[0]=B+G-Kt,ct[1]=Bt[1]=l}return w.length=0,w.push(["M",...ot],["L",...rt],["A",F,F,0,0,1,...it],["L",...ct],["A",G,G,0,0,1,...dt],["L",...Ht],["A",G,G,0,0,1,...Bt],["L",...Vt],["A",F,F,0,0,1,...ot],["Z"]),w}let{diffObjects:Zd,extend:q_,find:M0,merge:Z_,pick:Yd,uniqueKey:Y_}=_t;(function(B){function l(g,b){let w=g.condition;(w.callback||function(){return this.chartWidth<=Yd(w.maxWidth,Number.MAX_VALUE)&&this.chartHeight<=Yd(w.maxHeight,Number.MAX_VALUE)&&this.chartWidth>=Yd(w.minWidth,0)&&this.chartHeight>=Yd(w.minHeight,0)}).call(this)&&b.push(g._id)}function f(g,b){let w=this.options.responsive,A=this.currentResponsive,C=[],I;!b&&w&&w.rules&&w.rules.forEach(F=>{F._id===void 0&&(F._id=Y_()),this.matchResponsiveRule(F,C)},this);let R=Z_(...C.map(F=>M0((w==null?void 0:w.rules)||[],G=>G._id===F)).map(F=>F==null?void 0:F.chartOptions));R.isResponsiveOptions=!0,C=C.toString()||void 0;let U=A==null?void 0:A.ruleIds;C===U||(A&&(this.currentResponsive=void 0,this.updatingResponsive=!0,this.update(A.undoOptions,g,!0),this.updatingResponsive=!1),C?((I=Zd(R,this.options,!0,this.collectionsWithUpdate)).isResponsiveOptions=!0,this.currentResponsive={ruleIds:C,mergedOptions:R,undoOptions:I},this.updatingResponsive||this.update(R,g,!0)):this.currentResponsive=void 0)}B.compose=function(g){let b=g.prototype;return b.matchResponsiveRule||q_(b,{matchResponsiveRule:l,setResponsive:f}),g}})(Xt||(Xt={}));let K_=Xt;kt.AST=Is,kt.Axis=Ea,kt.Chart=Oo,kt.Color=Qt,kt.DataLabel=Ud,kt.DataTableCore=Ri,kt.Fx=Ei,kt.HTMLElement=el,kt.Legend=Kf,kt.LegendSymbol=Ts,kt.OverlappingDataLabels=kt.OverlappingDataLabels||$_,kt.PlotLineOrBand=Uc,kt.Point=et,kt.Pointer=Oe,kt.RendererRegistry=io,kt.Series=ar,kt.SeriesRegistry=bs,kt.StackItem=km,kt.SVGElement=Hn,kt.SVGRenderer=kc,kt.Templating=ir,kt.Tick=ia,kt.Time=fr,kt.Tooltip=Gh,kt.animate=mn.animate,kt.animObject=mn.animObject,kt.chart=Oo.chart,kt.color=Qt.parse,kt.dateFormat=ir.dateFormat,kt.defaultOptions=At.defaultOptions,kt.distribute=xa.distribute,kt.format=ir.format,kt.getDeferredAnimation=mn.getDeferredAnimation,kt.getOptions=At.getOptions,kt.numberFormat=ir.numberFormat,kt.seriesType=bs.seriesType,kt.setAnimation=mn.setAnimation,kt.setOptions=At.setOptions,kt.stop=mn.stop,kt.time=At.defaultTime,kt.timers=Ei.timers,{compose:function(B,l,f){let g=B.types.pie;if(!l.symbolCustomAttribs.includes("borderRadius")){let b=f.prototype.symbols;Xm(B,"afterColumnTranslate",E0,{order:9}),Xm(g,"afterTranslate",qd),l.symbolCustomAttribs.push("borderRadius","brBoxHeight","brBoxY"),Hd=b.arc,Xd=b.roundedRect,b.arc=S0,b.roundedRect=X_}},optionsToObject:Yc}.compose(kt.Series,kt.SVGElement,kt.SVGRenderer),a0.compose(kt.Series.types.column),Ud.compose(kt.Series),ad.compose(kt.Axis),el.compose(kt.SVGRenderer),Kf.compose(kt.Chart),jc.compose(kt.Axis),$_.compose(kt.Chart),_0.compose(kt.Series.types.pie),Uc.compose(kt.Chart,kt.Axis),Oe.compose(kt.Chart),K_.compose(kt.Chart),Cr.compose(kt.Axis,kt.Chart,kt.Series),A_.compose(kt.Axis,kt.Chart,kt.Series),Gh.compose(kt.Pointer),_t.extend(kt,_t);let J_=kt;return re.default})())}(kv)),kv.exports}const iF=OD(hL);(function(i,e){(function(a,h){i.exports=h(eF(),iF)})(self,(a,h)=>(()=>{var p={879:o=>{o.exports=a},744:o=>{o.exports=h}},x={};function T(o){var z=x[o];if(z!==void 0)return z.exports;var $=x[o]={exports:{}};return p[o]($,$.exports,T),$.exports}T.n=o=>{var z=o&&o.__esModule?()=>o.default:()=>o;return T.d(z,{a:z}),z},T.d=(o,z)=>{for(var $ in z)T.o(z,$)&&!T.o(o,$)&&Object.defineProperty(o,$,{enumerable:!0,get:z[$]})},T.o=(o,z)=>Object.prototype.hasOwnProperty.call(o,z),T.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var P={};return(()=>{T.r(P),T.d(P,{Chart:()=>yt,default:()=>Lt});var o=T(879),z=T.n(o),$=function Nt(Dt,wt){var It=z().isArray(Dt)?[]:{};function Xt(Zt,re){!z().isObject(Zt,!wt)||z().isClass(Zt)||z().isDOMElement(Zt)?It[re]=Zt:It[re]=Nt(Zt,wt)}return z().isArray(Dt)?Dt.forEach(function(Zt,re){return Xt(Zt,re)}):z().objectEach(Dt,Xt),It},q=T(744);function Q(Nt){return function(Dt){if(Array.isArray(Dt))return nt(Dt)}(Nt)||function(Dt){if(typeof Symbol<"u"&&Dt[Symbol.iterator]!=null||Dt["@@iterator"]!=null)return Array.from(Dt)}(Nt)||function(Dt,wt){if(Dt){if(typeof Dt=="string")return nt(Dt,wt);var It=Object.prototype.toString.call(Dt).slice(8,-1);if(It==="Object"&&Dt.constructor&&(It=Dt.constructor.name),It==="Map"||It==="Set")return Array.from(Dt);if(It==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(It))return nt(Dt,wt)}}(Nt)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function nt(Nt,Dt){(Dt==null||Dt>Nt.length)&&(Dt=Nt.length);for(var wt=0,It=new Array(Dt);wt<Dt;wt++)It[wt]=Nt[wt];return It}const Tt=function(Nt){var Dt=this;return{render:function(){return(0,q.h)("div",{ref:"chart"})},beforeUnmount:function(){var wt;return Dt==null||(wt=Dt.chart)===null||wt===void 0?void 0:wt.destroy()},props:{constructorType:{type:String,default:"chart"},options:{type:Object,required:!0},callback:Function,updateArgs:{type:Array,default:function(){return[!0,!0]}},highcharts:{type:Object},deepCopyOnUpdate:{type:Boolean,default:!0}},watch:{options:{handler:function(wt){var It;(It=this.chart).update.apply(It,[$(wt,this.deepCopyOnUpdate)].concat(Q(this.updateArgs)))},deep:!0}},mounted:function(){var wt=this.highcharts||Nt;wt[this.constructorType]?this.options?this.chart=wt[this.constructorType](this.$refs.chart,$(this.options,!0),this.callback?this.callback:null):console.error('The "options" parameter was not passed.'):console.error("'".concat(this.constructorType,"' constructor-type is incorrect. Sometimes this error is caused by the fact, that the corresponding module wasn't imported."))}}};var yt=Tt(z());function Lt(Nt){var Dt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Nt.component(Dt.tagName||"highcharts",Tt(Dt.highcharts||z()))}})(),P})())})(BA);var sF=BA.exports;const nF=YM(sF),Hx=hx(TD);Hx.use(CD());Hx.use(tF);Hx.use(nF);Hx.mount("#app");
