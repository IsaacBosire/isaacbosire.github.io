(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const M of document.querySelectorAll('link[rel="modulepreload"]'))w(M);new MutationObserver(M=>{for(const D of M)if(D.type==="childList")for(const B of D.addedNodes)B.tagName==="LINK"&&B.rel==="modulepreload"&&w(B)}).observe(document,{childList:!0,subtree:!0});function _(M){const D={};return M.integrity&&(D.integrity=M.integrity),M.referrerPolicy&&(D.referrerPolicy=M.referrerPolicy),M.crossOrigin==="use-credentials"?D.credentials="include":M.crossOrigin==="anonymous"?D.credentials="omit":D.credentials="same-origin",D}function w(M){if(M.ep)return;M.ep=!0;const D=_(M);fetch(M.href,D)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Q_(a){const h=Object.create(null);for(const _ of a.split(","))h[_]=1;return _=>_ in h}const Ir={},af=[],Pa=()=>{},CS=()=>!1,ng=a=>a.charCodeAt(0)===111&&a.charCodeAt(1)===110&&(a.charCodeAt(2)>122||a.charCodeAt(2)<97),z0=a=>a.startsWith("onUpdate:"),as=Object.assign,O0=(a,h)=>{const _=a.indexOf(h);_>-1&&a.splice(_,1)},kS=Object.prototype.hasOwnProperty,$r=(a,h)=>kS.call(a,h),Ei=Array.isArray,lf=a=>vf(a)==="[object Map]",Wd=a=>vf(a)==="[object Set]",bb=a=>vf(a)==="[object Date]",PS=a=>vf(a)==="[object RegExp]",Hi=a=>typeof a=="function",ms=a=>typeof a=="string",dl=a=>typeof a=="symbol",ts=a=>a!==null&&typeof a=="object",B0=a=>(ts(a)||Hi(a))&&Hi(a.then)&&Hi(a.catch),U1=Object.prototype.toString,vf=a=>U1.call(a),IS=a=>vf(a).slice(8,-1),ey=a=>vf(a)==="[object Object]",F0=a=>ms(a)&&a!=="NaN"&&a[0]!=="-"&&""+parseInt(a,10)===a,cf=Q_(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),ty=a=>{const h=Object.create(null);return _=>h[_]||(h[_]=a(_))},LS=/-(\w)/g,In=ty(a=>a.replace(LS,(h,_)=>_?_.toUpperCase():"")),DS=/\B([A-Z])/g,Uo=ty(a=>a.replace(DS,"-$1").toLowerCase()),og=ty(a=>a.charAt(0).toUpperCase()+a.slice(1)),zm=ty(a=>a?`on${og(a)}`:""),go=(a,h)=>!Object.is(a,h),hf=(a,...h)=>{for(let _=0;_<a.length;_++)a[_](...h)},j1=(a,h,_,w=!1)=>{Object.defineProperty(a,h,{configurable:!0,enumerable:!1,writable:w,value:_})},z_=a=>{const h=parseFloat(a);return isNaN(h)?a:h},O_=a=>{const h=ms(a)?Number(a):NaN;return isNaN(h)?a:h};let wb;const iy=()=>wb||(wb=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),RS="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt,console,Error,Symbol",zS=Q_(RS);function Hd(a){if(Ei(a)){const h={};for(let _=0;_<a.length;_++){const w=a[_],M=ms(w)?NS(w):Hd(w);if(M)for(const D in M)h[D]=M[D]}return h}else if(ms(a)||ts(a))return a}const OS=/;(?![^(]*\))/g,BS=/:([^]+)/,FS=/\/\*[^]*?\*\//g;function NS(a){const h={};return a.replace(FS,"").split(OS).forEach(_=>{if(_){const w=_.split(BS);w.length>1&&(h[w[0].trim()]=w[1].trim())}}),h}function bf(a){let h="";if(ms(a))h=a;else if(Ei(a))for(let _=0;_<a.length;_++){const w=bf(a[_]);w&&(h+=w+" ")}else if(ts(a))for(const _ in a)a[_]&&(h+=_+" ");return h.trim()}function US(a){if(!a)return null;let{class:h,style:_}=a;return h&&!ms(h)&&(a.class=bf(h)),_&&(a.style=Hd(_)),a}const jS="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",VS=Q_(jS);function V1(a){return!!a||a===""}function GS(a,h){if(a.length!==h.length)return!1;let _=!0;for(let w=0;_&&w<a.length;w++)_=uu(a[w],h[w]);return _}function uu(a,h){if(a===h)return!0;let _=bb(a),w=bb(h);if(_||w)return _&&w?a.getTime()===h.getTime():!1;if(_=dl(a),w=dl(h),_||w)return a===h;if(_=Ei(a),w=Ei(h),_||w)return _&&w?GS(a,h):!1;if(_=ts(a),w=ts(h),_||w){if(!_||!w)return!1;const M=Object.keys(a).length,D=Object.keys(h).length;if(M!==D)return!1;for(const B in a){const q=a.hasOwnProperty(B),o=h.hasOwnProperty(B);if(q&&!o||!q&&o||!uu(a[B],h[B]))return!1}}return String(a)===String(h)}function ry(a,h){return a.findIndex(_=>uu(_,h))}const G1=a=>!!(a&&a.__v_isRef===!0),zs=a=>ms(a)?a:a==null?"":Ei(a)||ts(a)&&(a.toString===U1||!Hi(a.toString))?G1(a)?zs(a.value):JSON.stringify(a,$1,2):String(a),$1=(a,h)=>G1(h)?$1(a,h.value):lf(h)?{[`Map(${h.size})`]:[...h.entries()].reduce((_,[w,M],D)=>(_[Fx(w,D)+" =>"]=M,_),{})}:Wd(h)?{[`Set(${h.size})`]:[...h.values()].map(_=>Fx(_))}:dl(h)?Fx(h):ts(h)&&!Ei(h)&&!ey(h)?String(h):h,Fx=(a,h="")=>{var _;return dl(a)?`Symbol(${(_=a.description)!=null?_:h})`:a};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let mo;class N0{constructor(h=!1){this.detached=h,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=mo,!h&&mo&&(this.index=(mo.scopes||(mo.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let h,_;if(this.scopes)for(h=0,_=this.scopes.length;h<_;h++)this.scopes[h].pause();for(h=0,_=this.effects.length;h<_;h++)this.effects[h].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let h,_;if(this.scopes)for(h=0,_=this.scopes.length;h<_;h++)this.scopes[h].resume();for(h=0,_=this.effects.length;h<_;h++)this.effects[h].resume()}}run(h){if(this._active){const _=mo;try{return mo=this,h()}finally{mo=_}}}on(){mo=this}off(){mo=this.parent}stop(h){if(this._active){this._active=!1;let _,w;for(_=0,w=this.effects.length;_<w;_++)this.effects[_].stop();for(this.effects.length=0,_=0,w=this.cleanups.length;_<w;_++)this.cleanups[_]();if(this.cleanups.length=0,this.scopes){for(_=0,w=this.scopes.length;_<w;_++)this.scopes[_].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!h){const M=this.parent.scopes.pop();M&&M!==this&&(this.parent.scopes[this.index]=M,M.index=this.index)}this.parent=void 0}}}function U0(a){return new N0(a)}function j0(){return mo}function W1(a,h=!1){mo&&mo.cleanups.push(a)}let fs;const Nx=new WeakSet;class qm{constructor(h){this.fn=h,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,mo&&mo.active&&mo.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Nx.has(this)&&(Nx.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||q1(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Tb(this),X1(this);const h=fs,_=cl;fs=this,cl=!0;try{return this.fn()}finally{Z1(this),fs=h,cl=_,this.flags&=-3}}stop(){if(this.flags&1){for(let h=this.deps;h;h=h.nextDep)$0(h);this.deps=this.depsTail=void 0,Tb(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Nx.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){s0(this)&&this.run()}get dirty(){return s0(this)}}let H1=0,Om,Bm;function q1(a,h=!1){if(a.flags|=8,h){a.next=Bm,Bm=a;return}a.next=Om,Om=a}function V0(){H1++}function G0(){if(--H1>0)return;if(Bm){let h=Bm;for(Bm=void 0;h;){const _=h.next;h.next=void 0,h.flags&=-9,h=_}}let a;for(;Om;){let h=Om;for(Om=void 0;h;){const _=h.next;if(h.next=void 0,h.flags&=-9,h.flags&1)try{h.trigger()}catch(w){a||(a=w)}h=_}}if(a)throw a}function X1(a){for(let h=a.deps;h;h=h.nextDep)h.version=-1,h.prevActiveLink=h.dep.activeLink,h.dep.activeLink=h}function Z1(a){let h,_=a.depsTail,w=_;for(;w;){const M=w.prevDep;w.version===-1?(w===_&&(_=M),$0(w),$S(w)):h=w,w.dep.activeLink=w.prevActiveLink,w.prevActiveLink=void 0,w=M}a.deps=h,a.depsTail=_}function s0(a){for(let h=a.deps;h;h=h.nextDep)if(h.dep.version!==h.version||h.dep.computed&&(Y1(h.dep.computed)||h.dep.version!==h.version))return!0;return!!a._dirty}function Y1(a){if(a.flags&4&&!(a.flags&16)||(a.flags&=-17,a.globalVersion===Xm))return;a.globalVersion=Xm;const h=a.dep;if(a.flags|=2,h.version>0&&!a.isSSR&&a.deps&&!s0(a)){a.flags&=-3;return}const _=fs,w=cl;fs=a,cl=!0;try{X1(a);const M=a.fn(a._value);(h.version===0||go(M,a._value))&&(a._value=M,h.version++)}catch(M){throw h.version++,M}finally{fs=_,cl=w,Z1(a),a.flags&=-3}}function $0(a,h=!1){const{dep:_,prevSub:w,nextSub:M}=a;if(w&&(w.nextSub=M,a.prevSub=void 0),M&&(M.prevSub=w,a.nextSub=void 0),_.subs===a&&(_.subs=w,!w&&_.computed)){_.computed.flags&=-5;for(let D=_.computed.deps;D;D=D.nextDep)$0(D,!0)}!h&&!--_.sc&&_.map&&_.map.delete(_.key)}function $S(a){const{prevDep:h,nextDep:_}=a;h&&(h.nextDep=_,a.prevDep=void 0),_&&(_.prevDep=h,a.nextDep=void 0)}function WS(a,h){a.effect instanceof qm&&(a=a.effect.fn);const _=new qm(a);h&&as(_,h);try{_.run()}catch(M){throw _.stop(),M}const w=_.run.bind(_);return w.effect=_,w}function HS(a){a.effect.stop()}let cl=!0;const K1=[];function fu(){K1.push(cl),cl=!1}function mu(){const a=K1.pop();cl=a===void 0?!0:a}function Tb(a){const{cleanup:h}=a;if(a.cleanup=void 0,h){const _=fs;fs=void 0;try{h()}finally{fs=_}}}let Xm=0;class qS{constructor(h,_){this.sub=h,this.dep=_,this.version=_.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class sy{constructor(h){this.computed=h,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(h){if(!fs||!cl||fs===this.computed)return;let _=this.activeLink;if(_===void 0||_.sub!==fs)_=this.activeLink=new qS(fs,this),fs.deps?(_.prevDep=fs.depsTail,fs.depsTail.nextDep=_,fs.depsTail=_):fs.deps=fs.depsTail=_,J1(_);else if(_.version===-1&&(_.version=this.version,_.nextDep)){const w=_.nextDep;w.prevDep=_.prevDep,_.prevDep&&(_.prevDep.nextDep=w),_.prevDep=fs.depsTail,_.nextDep=void 0,fs.depsTail.nextDep=_,fs.depsTail=_,fs.deps===_&&(fs.deps=w)}return _}trigger(h){this.version++,Xm++,this.notify(h)}notify(h){V0();try{for(let _=this.subs;_;_=_.prevSub)_.sub.notify()&&_.sub.dep.notify()}finally{G0()}}}function J1(a){if(a.dep.sc++,a.sub.flags&4){const h=a.dep.computed;if(h&&!a.dep.subs){h.flags|=20;for(let w=h.deps;w;w=w.nextDep)J1(w)}const _=a.dep.subs;_!==a&&(a.prevSub=_,_&&(_.nextSub=a)),a.dep.subs=a}}const B_=new WeakMap,Fd=Symbol(""),n0=Symbol(""),Zm=Symbol("");function qn(a,h,_){if(cl&&fs){let w=B_.get(a);w||B_.set(a,w=new Map);let M=w.get(_);M||(w.set(_,M=new sy),M.map=w,M.key=_),M.track()}}function qc(a,h,_,w,M,D){const B=B_.get(a);if(!B){Xm++;return}const q=o=>{o&&o.trigger()};if(V0(),h==="clear")B.forEach(q);else{const o=Ei(a),X=o&&F0(_);if(o&&_==="length"){const ie=Number(w);B.forEach((oe,xe)=>{(xe==="length"||xe===Zm||!dl(xe)&&xe>=ie)&&q(oe)})}else switch((_!==void 0||B.has(void 0))&&q(B.get(_)),X&&q(B.get(Zm)),h){case"add":o?X&&q(B.get("length")):(q(B.get(Fd)),lf(a)&&q(B.get(n0)));break;case"delete":o||(q(B.get(Fd)),lf(a)&&q(B.get(n0)));break;case"set":lf(a)&&q(B.get(Fd));break}}G0()}function XS(a,h){const _=B_.get(a);return _&&_.get(h)}function Qp(a){const h=Pr(a);return h===a?h:(qn(h,"iterate",Zm),ua(a)?h:h.map(Xn))}function ny(a){return qn(a=Pr(a),"iterate",Zm),a}const ZS={__proto__:null,[Symbol.iterator](){return Ux(this,Symbol.iterator,Xn)},concat(...a){return Qp(this).concat(...a.map(h=>Ei(h)?Qp(h):h))},entries(){return Ux(this,"entries",a=>(a[1]=Xn(a[1]),a))},every(a,h){return $c(this,"every",a,h,void 0,arguments)},filter(a,h){return $c(this,"filter",a,h,_=>_.map(Xn),arguments)},find(a,h){return $c(this,"find",a,h,Xn,arguments)},findIndex(a,h){return $c(this,"findIndex",a,h,void 0,arguments)},findLast(a,h){return $c(this,"findLast",a,h,Xn,arguments)},findLastIndex(a,h){return $c(this,"findLastIndex",a,h,void 0,arguments)},forEach(a,h){return $c(this,"forEach",a,h,void 0,arguments)},includes(...a){return jx(this,"includes",a)},indexOf(...a){return jx(this,"indexOf",a)},join(a){return Qp(this).join(a)},lastIndexOf(...a){return jx(this,"lastIndexOf",a)},map(a,h){return $c(this,"map",a,h,void 0,arguments)},pop(){return Cm(this,"pop")},push(...a){return Cm(this,"push",a)},reduce(a,...h){return Eb(this,"reduce",a,h)},reduceRight(a,...h){return Eb(this,"reduceRight",a,h)},shift(){return Cm(this,"shift")},some(a,h){return $c(this,"some",a,h,void 0,arguments)},splice(...a){return Cm(this,"splice",a)},toReversed(){return Qp(this).toReversed()},toSorted(a){return Qp(this).toSorted(a)},toSpliced(...a){return Qp(this).toSpliced(...a)},unshift(...a){return Cm(this,"unshift",a)},values(){return Ux(this,"values",Xn)}};function Ux(a,h,_){const w=ny(a),M=w[h]();return w!==a&&!ua(a)&&(M._next=M.next,M.next=()=>{const D=M._next();return D.value&&(D.value=_(D.value)),D}),M}const YS=Array.prototype;function $c(a,h,_,w,M,D){const B=ny(a),q=B!==a&&!ua(a),o=B[h];if(o!==YS[h]){const oe=o.apply(a,D);return q?Xn(oe):oe}let X=_;B!==a&&(q?X=function(oe,xe){return _.call(this,Xn(oe),xe,a)}:_.length>2&&(X=function(oe,xe){return _.call(this,oe,xe,a)}));const ie=o.call(B,X,w);return q&&M?M(ie):ie}function Eb(a,h,_,w){const M=ny(a);let D=_;return M!==a&&(ua(a)?_.length>3&&(D=function(B,q,o){return _.call(this,B,q,o,a)}):D=function(B,q,o){return _.call(this,B,Xn(q),o,a)}),M[h](D,...w)}function jx(a,h,_){const w=Pr(a);qn(w,"iterate",Zm);const M=w[h](..._);return(M===-1||M===!1)&&ly(_[0])?(_[0]=Pr(_[0]),w[h](..._)):M}function Cm(a,h,_=[]){fu(),V0();const w=Pr(a)[h].apply(a,_);return G0(),mu(),w}const KS=Q_("__proto__,__v_isRef,__isVue"),Q1=new Set(Object.getOwnPropertyNames(Symbol).filter(a=>a!=="arguments"&&a!=="caller").map(a=>Symbol[a]).filter(dl));function JS(a){dl(a)||(a=String(a));const h=Pr(this);return qn(h,"has",a),h.hasOwnProperty(a)}class ew{constructor(h=!1,_=!1){this._isReadonly=h,this._isShallow=_}get(h,_,w){if(_==="__v_skip")return h.__v_skip;const M=this._isReadonly,D=this._isShallow;if(_==="__v_isReactive")return!M;if(_==="__v_isReadonly")return M;if(_==="__v_isShallow")return D;if(_==="__v_raw")return w===(M?D?ow:nw:D?sw:rw).get(h)||Object.getPrototypeOf(h)===Object.getPrototypeOf(w)?h:void 0;const B=Ei(h);if(!M){let o;if(B&&(o=ZS[_]))return o;if(_==="hasOwnProperty")return JS}const q=Reflect.get(h,_,Os(h)?h:w);return(dl(_)?Q1.has(_):KS(_))||(M||qn(h,"get",_),D)?q:Os(q)?B&&F0(_)?q:q.value:ts(q)?M?H0(q):wf(q):q}}class tw extends ew{constructor(h=!1){super(!1,h)}set(h,_,w,M){let D=h[_];if(!this._isShallow){const o=du(D);if(!ua(w)&&!du(w)&&(D=Pr(D),w=Pr(w)),!Ei(h)&&Os(D)&&!Os(w))return o?!1:(D.value=w,!0)}const B=Ei(h)&&F0(_)?Number(_)<h.length:$r(h,_),q=Reflect.set(h,_,w,Os(h)?h:M);return h===Pr(M)&&(B?go(w,D)&&qc(h,"set",_,w):qc(h,"add",_,w)),q}deleteProperty(h,_){const w=$r(h,_);h[_];const M=Reflect.deleteProperty(h,_);return M&&w&&qc(h,"delete",_,void 0),M}has(h,_){const w=Reflect.has(h,_);return(!dl(_)||!Q1.has(_))&&qn(h,"has",_),w}ownKeys(h){return qn(h,"iterate",Ei(h)?"length":Fd),Reflect.ownKeys(h)}}class iw extends ew{constructor(h=!1){super(!0,h)}set(h,_){return!0}deleteProperty(h,_){return!0}}const QS=new tw,eA=new iw,tA=new tw(!0),iA=new iw(!0),o0=a=>a,y_=a=>Reflect.getPrototypeOf(a);function rA(a,h,_){return function(...w){const M=this.__v_raw,D=Pr(M),B=lf(D),q=a==="entries"||a===Symbol.iterator&&B,o=a==="keys"&&B,X=M[a](...w),ie=_?o0:h?a0:Xn;return!h&&qn(D,"iterate",o?n0:Fd),{next(){const{value:oe,done:xe}=X.next();return xe?{value:oe,done:xe}:{value:q?[ie(oe[0]),ie(oe[1])]:ie(oe),done:xe}},[Symbol.iterator](){return this}}}}function x_(a){return function(...h){return a==="delete"?!1:a==="clear"?void 0:this}}function sA(a,h){const _={get(M){const D=this.__v_raw,B=Pr(D),q=Pr(M);a||(go(M,q)&&qn(B,"get",M),qn(B,"get",q));const{has:o}=y_(B),X=h?o0:a?a0:Xn;if(o.call(B,M))return X(D.get(M));if(o.call(B,q))return X(D.get(q));D!==B&&D.get(M)},get size(){const M=this.__v_raw;return!a&&qn(Pr(M),"iterate",Fd),Reflect.get(M,"size",M)},has(M){const D=this.__v_raw,B=Pr(D),q=Pr(M);return a||(go(M,q)&&qn(B,"has",M),qn(B,"has",q)),M===q?D.has(M):D.has(M)||D.has(q)},forEach(M,D){const B=this,q=B.__v_raw,o=Pr(q),X=h?o0:a?a0:Xn;return!a&&qn(o,"iterate",Fd),q.forEach((ie,oe)=>M.call(D,X(ie),X(oe),B))}};return as(_,a?{add:x_("add"),set:x_("set"),delete:x_("delete"),clear:x_("clear")}:{add(M){!h&&!ua(M)&&!du(M)&&(M=Pr(M));const D=Pr(this);return y_(D).has.call(D,M)||(D.add(M),qc(D,"add",M,M)),this},set(M,D){!h&&!ua(D)&&!du(D)&&(D=Pr(D));const B=Pr(this),{has:q,get:o}=y_(B);let X=q.call(B,M);X||(M=Pr(M),X=q.call(B,M));const ie=o.call(B,M);return B.set(M,D),X?go(D,ie)&&qc(B,"set",M,D):qc(B,"add",M,D),this},delete(M){const D=Pr(this),{has:B,get:q}=y_(D);let o=B.call(D,M);o||(M=Pr(M),o=B.call(D,M)),q&&q.call(D,M);const X=D.delete(M);return o&&qc(D,"delete",M,void 0),X},clear(){const M=Pr(this),D=M.size!==0,B=M.clear();return D&&qc(M,"clear",void 0,void 0),B}}),["keys","values","entries",Symbol.iterator].forEach(M=>{_[M]=rA(M,a,h)}),_}function oy(a,h){const _=sA(a,h);return(w,M,D)=>M==="__v_isReactive"?!a:M==="__v_isReadonly"?a:M==="__v_raw"?w:Reflect.get($r(_,M)&&M in w?_:w,M,D)}const nA={get:oy(!1,!1)},oA={get:oy(!1,!0)},aA={get:oy(!0,!1)},lA={get:oy(!0,!0)},rw=new WeakMap,sw=new WeakMap,nw=new WeakMap,ow=new WeakMap;function cA(a){switch(a){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function hA(a){return a.__v_skip||!Object.isExtensible(a)?0:cA(IS(a))}function wf(a){return du(a)?a:ay(a,!1,QS,nA,rw)}function W0(a){return ay(a,!1,tA,oA,sw)}function H0(a){return ay(a,!0,eA,aA,nw)}function uA(a){return ay(a,!0,iA,lA,ow)}function ay(a,h,_,w,M){if(!ts(a)||a.__v_raw&&!(h&&a.__v_isReactive))return a;const D=M.get(a);if(D)return D;const B=hA(a);if(B===0)return a;const q=new Proxy(a,B===2?w:_);return M.set(a,q),q}function nc(a){return du(a)?nc(a.__v_raw):!!(a&&a.__v_isReactive)}function du(a){return!!(a&&a.__v_isReadonly)}function ua(a){return!!(a&&a.__v_isShallow)}function ly(a){return a?!!a.__v_raw:!1}function Pr(a){const h=a&&a.__v_raw;return h?Pr(h):a}function cy(a){return!$r(a,"__v_skip")&&Object.isExtensible(a)&&j1(a,"__v_skip",!0),a}const Xn=a=>ts(a)?wf(a):a,a0=a=>ts(a)?H0(a):a;function Os(a){return a?a.__v_isRef===!0:!1}function Kr(a){return aw(a,!1)}function q0(a){return aw(a,!0)}function aw(a,h){return Os(a)?a:new dA(a,h)}class dA{constructor(h,_){this.dep=new sy,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=_?h:Pr(h),this._value=_?h:Xn(h),this.__v_isShallow=_}get value(){return this.dep.track(),this._value}set value(h){const _=this._rawValue,w=this.__v_isShallow||ua(h)||du(h);h=w?h:Pr(h),go(h,_)&&(this._rawValue=h,this._value=w?h:Xn(h),this.dep.trigger())}}function pA(a){a.dep&&a.dep.trigger()}function oc(a){return Os(a)?a.value:a}function fA(a){return Hi(a)?a():oc(a)}const mA={get:(a,h,_)=>h==="__v_raw"?a:oc(Reflect.get(a,h,_)),set:(a,h,_,w)=>{const M=a[h];return Os(M)&&!Os(_)?(M.value=_,!0):Reflect.set(a,h,_,w)}};function X0(a){return nc(a)?a:new Proxy(a,mA)}class gA{constructor(h){this.__v_isRef=!0,this._value=void 0;const _=this.dep=new sy,{get:w,set:M}=h(_.track.bind(_),_.trigger.bind(_));this._get=w,this._set=M}get value(){return this._value=this._get()}set value(h){this._set(h)}}function lw(a){return new gA(a)}function cw(a){const h=Ei(a)?new Array(a.length):{};for(const _ in a)h[_]=hw(a,_);return h}class _A{constructor(h,_,w){this._object=h,this._key=_,this._defaultValue=w,this.__v_isRef=!0,this._value=void 0}get value(){const h=this._object[this._key];return this._value=h===void 0?this._defaultValue:h}set value(h){this._object[this._key]=h}get dep(){return XS(Pr(this._object),this._key)}}class yA{constructor(h){this._getter=h,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=void 0}get value(){return this._value=this._getter()}}function xA(a,h,_){return Os(a)?a:Hi(a)?new yA(a):ts(a)&&arguments.length>1?hw(a,h,_):Kr(a)}function hw(a,h,_){const w=a[h];return Os(w)?w:new _A(a,h,_)}class vA{constructor(h,_,w){this.fn=h,this.setter=_,this._value=void 0,this.dep=new sy(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Xm-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!_,this.isSSR=w}notify(){if(this.flags|=16,!(this.flags&8)&&fs!==this)return q1(this,!0),!0}get value(){const h=this.dep.track();return Y1(this),h&&(h.version=this.dep.version),this._value}set value(h){this.setter&&this.setter(h)}}function bA(a,h,_=!1){let w,M;return Hi(a)?w=a:(w=a.get,M=a.set),new vA(w,M,_)}const wA={GET:"get",HAS:"has",ITERATE:"iterate"},TA={SET:"set",ADD:"add",DELETE:"delete",CLEAR:"clear"},v_={},F_=new WeakMap;let su;function EA(){return su}function uw(a,h=!1,_=su){if(_){let w=F_.get(_);w||F_.set(_,w=[]),w.push(a)}}function SA(a,h,_=Ir){const{immediate:w,deep:M,once:D,scheduler:B,augmentJob:q,call:o}=_,X=Be=>M?Be:ua(Be)||M===!1||M===0?Xc(Be,1):Xc(Be);let ie,oe,xe,Te,je=!1,We=!1;if(Os(a)?(oe=()=>a.value,je=ua(a)):nc(a)?(oe=()=>X(a),je=!0):Ei(a)?(We=!0,je=a.some(Be=>nc(Be)||ua(Be)),oe=()=>a.map(Be=>{if(Os(Be))return Be.value;if(nc(Be))return X(Be);if(Hi(Be))return o?o(Be,2):Be()})):Hi(a)?h?oe=o?()=>o(a,2):a:oe=()=>{if(xe){fu();try{xe()}finally{mu()}}const Be=su;su=ie;try{return o?o(a,3,[Te]):a(Te)}finally{su=Be}}:oe=Pa,h&&M){const Be=oe,He=M===!0?1/0:M;oe=()=>Xc(Be(),He)}const pt=j0(),yt=()=>{ie.stop(),pt&&pt.active&&O0(pt.effects,ie)};if(D&&h){const Be=h;h=(...He)=>{Be(...He),yt()}}let Ze=We?new Array(a.length).fill(v_):v_;const Ae=Be=>{if(!(!(ie.flags&1)||!ie.dirty&&!Be))if(h){const He=ie.run();if(M||je||(We?He.some((lt,kt)=>go(lt,Ze[kt])):go(He,Ze))){xe&&xe();const lt=su;su=ie;try{const kt=[He,Ze===v_?void 0:We&&Ze[0]===v_?[]:Ze,Te];o?o(h,3,kt):h(...kt),Ze=He}finally{su=lt}}}else ie.run()};return q&&q(Ae),ie=new qm(oe),ie.scheduler=B?()=>B(Ae,!1):Ae,Te=Be=>uw(Be,!1,ie),xe=ie.onStop=()=>{const Be=F_.get(ie);if(Be){if(o)o(Be,4);else for(const He of Be)He();F_.delete(ie)}},h?w?Ae(!0):Ze=ie.run():B?B(Ae.bind(null,!0),!0):ie.run(),yt.pause=ie.pause.bind(ie),yt.resume=ie.resume.bind(ie),yt.stop=yt,yt}function Xc(a,h=1/0,_){if(h<=0||!ts(a)||a.__v_skip||(_=_||new Set,_.has(a)))return a;if(_.add(a),h--,Os(a))Xc(a.value,h,_);else if(Ei(a))for(let w=0;w<a.length;w++)Xc(a[w],h,_);else if(Wd(a)||lf(a))a.forEach(w=>{Xc(w,h,_)});else if(ey(a)){for(const w in a)Xc(a[w],h,_);for(const w of Object.getOwnPropertySymbols(a))Object.prototype.propertyIsEnumerable.call(a,w)&&Xc(a[w],h,_)}return a}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const dw=[];function AA(a){dw.push(a)}function MA(){dw.pop()}function CA(a,h){}const kA={SETUP_FUNCTION:0,0:"SETUP_FUNCTION",RENDER_FUNCTION:1,1:"RENDER_FUNCTION",NATIVE_EVENT_HANDLER:5,5:"NATIVE_EVENT_HANDLER",COMPONENT_EVENT_HANDLER:6,6:"COMPONENT_EVENT_HANDLER",VNODE_HOOK:7,7:"VNODE_HOOK",DIRECTIVE_HOOK:8,8:"DIRECTIVE_HOOK",TRANSITION_HOOK:9,9:"TRANSITION_HOOK",APP_ERROR_HANDLER:10,10:"APP_ERROR_HANDLER",APP_WARN_HANDLER:11,11:"APP_WARN_HANDLER",FUNCTION_REF:12,12:"FUNCTION_REF",ASYNC_COMPONENT_LOADER:13,13:"ASYNC_COMPONENT_LOADER",SCHEDULER:14,14:"SCHEDULER",COMPONENT_UPDATE:15,15:"COMPONENT_UPDATE",APP_UNMOUNT_CLEANUP:16,16:"APP_UNMOUNT_CLEANUP"},PA={sp:"serverPrefetch hook",bc:"beforeCreate hook",c:"created hook",bm:"beforeMount hook",m:"mounted hook",bu:"beforeUpdate hook",u:"updated",bum:"beforeUnmount hook",um:"unmounted hook",a:"activated hook",da:"deactivated hook",ec:"errorCaptured hook",rtc:"renderTracked hook",rtg:"renderTriggered hook",0:"setup function",1:"render function",2:"watcher getter",3:"watcher callback",4:"watcher cleanup function",5:"native event handler",6:"component event handler",7:"vnode hook",8:"directive hook",9:"transition hook",10:"app errorHandler",11:"app warnHandler",12:"ref function",13:"async component loader",14:"scheduler flush",15:"component update",16:"app unmount cleanup function"};function Tf(a,h,_,w){try{return w?a(...w):a()}catch(M){qd(M,h,_)}}function Da(a,h,_,w){if(Hi(a)){const M=Tf(a,h,_,w);return M&&B0(M)&&M.catch(D=>{qd(D,h,_)}),M}if(Ei(a)){const M=[];for(let D=0;D<a.length;D++)M.push(Da(a[D],h,_,w));return M}}function qd(a,h,_,w=!0){const M=h?h.vnode:null,{errorHandler:D,throwUnhandledErrorInProduction:B}=h&&h.appContext.config||Ir;if(h){let q=h.parent;const o=h.proxy,X=`https://vuejs.org/error-reference/#runtime-${_}`;for(;q;){const ie=q.ec;if(ie){for(let oe=0;oe<ie.length;oe++)if(ie[oe](a,o,X)===!1)return}q=q.parent}if(D){fu(),Tf(D,null,10,[a,o,X]),mu();return}}IA(a,_,M,w,B)}function IA(a,h,_,w=!0,M=!1){if(M)throw a;console.error(a)}const _o=[];let tc=-1;const uf=[];let nu=null,rf=0;const pw=Promise.resolve();let N_=null;function Ef(a){const h=N_||pw;return a?h.then(this?a.bind(this):a):h}function LA(a){let h=tc+1,_=_o.length;for(;h<_;){const w=h+_>>>1,M=_o[w],D=Km(M);D<a||D===a&&M.flags&2?h=w+1:_=w}return h}function Z0(a){if(!(a.flags&1)){const h=Km(a),_=_o[_o.length-1];!_||!(a.flags&2)&&h>=Km(_)?_o.push(a):_o.splice(LA(h),0,a),a.flags|=1,fw()}}function fw(){N_||(N_=pw.then(mw))}function Ym(a){Ei(a)?uf.push(...a):nu&&a.id===-1?nu.splice(rf+1,0,a):a.flags&1||(uf.push(a),a.flags|=1),fw()}function Sb(a,h,_=tc+1){for(;_<_o.length;_++){const w=_o[_];if(w&&w.flags&2){if(a&&w.id!==a.uid)continue;_o.splice(_,1),_--,w.flags&4&&(w.flags&=-2),w(),w.flags&4||(w.flags&=-2)}}}function U_(a){if(uf.length){const h=[...new Set(uf)].sort((_,w)=>Km(_)-Km(w));if(uf.length=0,nu){nu.push(...h);return}for(nu=h,rf=0;rf<nu.length;rf++){const _=nu[rf];_.flags&4&&(_.flags&=-2),_.flags&8||_(),_.flags&=-2}nu=null,rf=0}}const Km=a=>a.id==null?a.flags&2?-1:1/0:a.id;function mw(a){try{for(tc=0;tc<_o.length;tc++){const h=_o[tc];h&&!(h.flags&8)&&(h.flags&4&&(h.flags&=-2),Tf(h,h.i,h.i?15:14),h.flags&4||(h.flags&=-2))}}finally{for(;tc<_o.length;tc++){const h=_o[tc];h&&(h.flags&=-2)}tc=-1,_o.length=0,U_(),N_=null,(_o.length||uf.length)&&mw()}}let sf,b_=[];function gw(a,h){var _,w;sf=a,sf?(sf.enabled=!0,b_.forEach(({event:M,args:D})=>sf.emit(M,...D)),b_=[]):typeof window<"u"&&window.HTMLElement&&!((w=(_=window.navigator)==null?void 0:_.userAgent)!=null&&w.includes("jsdom"))?((h.__VUE_DEVTOOLS_HOOK_REPLAY__=h.__VUE_DEVTOOLS_HOOK_REPLAY__||[]).push(D=>{gw(D,h)}),setTimeout(()=>{sf||(h.__VUE_DEVTOOLS_HOOK_REPLAY__=null,b_=[])},3e3)):b_=[]}let _n=null,hy=null;function Jm(a){const h=_n;return _n=a,hy=a&&a.type.__scopeId||null,h}function DA(a){hy=a}function RA(){hy=null}const zA=a=>ol;function ol(a,h=_n,_){if(!h||a._n)return a;const w=(...M)=>{w._d&&m0(-1);const D=Jm(h);let B;try{B=a(...M)}finally{Jm(D),w._d&&m0(1)}return B};return w._n=!0,w._c=!0,w._d=!0,w}function rc(a,h){if(_n===null)return a;const _=cg(_n),w=a.dirs||(a.dirs=[]);for(let M=0;M<h.length;M++){let[D,B,q,o=Ir]=h[M];D&&(Hi(D)&&(D={mounted:D,updated:D}),D.deep&&Xc(B),w.push({dir:D,instance:_,value:B,oldValue:void 0,arg:q,modifiers:o}))}return a}function ic(a,h,_,w){const M=a.dirs,D=h&&h.dirs;for(let B=0;B<M.length;B++){const q=M[B];D&&(q.oldValue=D[B].value);let o=q.dir[w];o&&(fu(),Da(o,_,8,[a.el,q,a,h]),mu())}}const _w=Symbol("_vte"),yw=a=>a.__isTeleport,Fm=a=>a&&(a.disabled||a.disabled===""),Ab=a=>a&&(a.defer||a.defer===""),Mb=a=>typeof SVGElement<"u"&&a instanceof SVGElement,Cb=a=>typeof MathMLElement=="function"&&a instanceof MathMLElement,l0=(a,h)=>{const _=a&&a.to;return ms(_)?h?h(_):null:_},xw={name:"Teleport",__isTeleport:!0,process(a,h,_,w,M,D,B,q,o,X){const{mc:ie,pc:oe,pbc:xe,o:{insert:Te,querySelector:je,createText:We,createComment:pt}}=X,yt=Fm(h.props);let{shapeFlag:Ze,children:Ae,dynamicChildren:Be}=h;if(a==null){const He=h.el=We(""),lt=h.anchor=We("");Te(He,_,w),Te(lt,_,w);const kt=(ht,Ge)=>{Ze&16&&(M&&M.isCE&&(M.ce._teleportTarget=ht),ie(Ae,ht,Ge,M,D,B,q,o))},Ne=()=>{const ht=h.target=l0(h.props,je),Ge=vw(ht,h,We,Te);ht&&(B!=="svg"&&Mb(ht)?B="svg":B!=="mathml"&&Cb(ht)&&(B="mathml"),yt||(kt(ht,Ge),C_(h,!1)))};yt&&(kt(_,lt),C_(h,!0)),Ab(h.props)?mn(()=>{Ne(),h.el.__isMounted=!0},D):Ne()}else{if(Ab(h.props)&&!a.el.__isMounted){mn(()=>{xw.process(a,h,_,w,M,D,B,q,o,X),delete a.el.__isMounted},D);return}h.el=a.el,h.targetStart=a.targetStart;const He=h.anchor=a.anchor,lt=h.target=a.target,kt=h.targetAnchor=a.targetAnchor,Ne=Fm(a.props),ht=Ne?_:lt,Ge=Ne?He:kt;if(B==="svg"||Mb(lt)?B="svg":(B==="mathml"||Cb(lt))&&(B="mathml"),Be?(xe(a.dynamicChildren,Be,ht,M,D,B,q),nv(a,h,!0)):o||oe(a,h,ht,Ge,M,D,B,q,!1),yt)Ne?h.props&&a.props&&h.props.to!==a.props.to&&(h.props.to=a.props.to):w_(h,_,He,X,1);else if((h.props&&h.props.to)!==(a.props&&a.props.to)){const ai=h.target=l0(h.props,je);ai&&w_(h,ai,null,X,0)}else Ne&&w_(h,lt,kt,X,1);C_(h,yt)}},remove(a,h,_,{um:w,o:{remove:M}},D){const{shapeFlag:B,children:q,anchor:o,targetStart:X,targetAnchor:ie,target:oe,props:xe}=a;if(oe&&(M(X),M(ie)),D&&M(o),B&16){const Te=D||!Fm(xe);for(let je=0;je<q.length;je++){const We=q[je];w(We,h,_,Te,!!We.dynamicChildren)}}},move:w_,hydrate:OA};function w_(a,h,_,{o:{insert:w},m:M},D=2){D===0&&w(a.targetAnchor,h,_);const{el:B,anchor:q,shapeFlag:o,children:X,props:ie}=a,oe=D===2;if(oe&&w(B,h,_),(!oe||Fm(ie))&&o&16)for(let xe=0;xe<X.length;xe++)M(X[xe],h,_,2);oe&&w(q,h,_)}function OA(a,h,_,w,M,D,{o:{nextSibling:B,parentNode:q,querySelector:o,insert:X,createText:ie}},oe){const xe=h.target=l0(h.props,o);if(xe){const Te=Fm(h.props),je=xe._lpa||xe.firstChild;if(h.shapeFlag&16)if(Te)h.anchor=oe(B(a),h,q(a),_,w,M,D),h.targetStart=je,h.targetAnchor=je&&B(je);else{h.anchor=B(a);let We=je;for(;We;){if(We&&We.nodeType===8){if(We.data==="teleport start anchor")h.targetStart=We;else if(We.data==="teleport anchor"){h.targetAnchor=We,xe._lpa=h.targetAnchor&&B(h.targetAnchor);break}}We=B(We)}h.targetAnchor||vw(xe,h,ie,X),oe(je&&B(je),h,xe,_,w,M,D)}C_(h,Te)}return h.anchor&&B(h.anchor)}const BA=xw;function C_(a,h){const _=a.ctx;if(_&&_.ut){let w,M;for(h?(w=a.el,M=a.anchor):(w=a.targetStart,M=a.targetAnchor);w&&w!==M;)w.nodeType===1&&w.setAttribute("data-v-owner",_.uid),w=w.nextSibling;_.ut()}}function vw(a,h,_,w){const M=h.targetStart=_(""),D=h.targetAnchor=_("");return M[_w]=D,a&&(w(M,a),w(D,a)),D}const ou=Symbol("_leaveCb"),T_=Symbol("_enterCb");function Y0(){const a={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return lc(()=>{a.isMounted=!0}),fy(()=>{a.isUnmounting=!0}),a}const ka=[Function,Array],K0={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:ka,onEnter:ka,onAfterEnter:ka,onEnterCancelled:ka,onBeforeLeave:ka,onLeave:ka,onAfterLeave:ka,onLeaveCancelled:ka,onBeforeAppear:ka,onAppear:ka,onAfterAppear:ka,onAppearCancelled:ka},bw=a=>{const h=a.subTree;return h.component?bw(h.component):h},FA={name:"BaseTransition",props:K0,setup(a,{slots:h}){const _=Ra(),w=Y0();return()=>{const M=h.default&&uy(h.default(),!0);if(!M||!M.length)return;const D=ww(M),B=Pr(a),{mode:q}=B;if(w.isLeaving)return Vx(D);const o=kb(D);if(!o)return Vx(D);let X=pf(o,B,w,_,oe=>X=oe);o.type!==an&&Yc(o,X);let ie=_.subTree&&kb(_.subTree);if(ie&&ie.type!==an&&!al(o,ie)&&bw(_).type!==an){let oe=pf(ie,B,w,_);if(Yc(ie,oe),q==="out-in"&&o.type!==an)return w.isLeaving=!0,oe.afterLeave=()=>{w.isLeaving=!1,_.job.flags&8||_.update(),delete oe.afterLeave,ie=void 0},Vx(D);q==="in-out"&&o.type!==an?oe.delayLeave=(xe,Te,je)=>{const We=Ew(w,ie);We[String(ie.key)]=ie,xe[ou]=()=>{Te(),xe[ou]=void 0,delete X.delayedLeave,ie=void 0},X.delayedLeave=()=>{je(),delete X.delayedLeave,ie=void 0}}:ie=void 0}else ie&&(ie=void 0);return D}}};function ww(a){let h=a[0];if(a.length>1){for(const _ of a)if(_.type!==an){h=_;break}}return h}const Tw=FA;function Ew(a,h){const{leavingVNodes:_}=a;let w=_.get(h.type);return w||(w=Object.create(null),_.set(h.type,w)),w}function pf(a,h,_,w,M){const{appear:D,mode:B,persisted:q=!1,onBeforeEnter:o,onEnter:X,onAfterEnter:ie,onEnterCancelled:oe,onBeforeLeave:xe,onLeave:Te,onAfterLeave:je,onLeaveCancelled:We,onBeforeAppear:pt,onAppear:yt,onAfterAppear:Ze,onAppearCancelled:Ae}=h,Be=String(a.key),He=Ew(_,a),lt=(ht,Ge)=>{ht&&Da(ht,w,9,Ge)},kt=(ht,Ge)=>{const ai=Ge[1];lt(ht,Ge),Ei(ht)?ht.every(Ot=>Ot.length<=1)&&ai():ht.length<=1&&ai()},Ne={mode:B,persisted:q,beforeEnter(ht){let Ge=o;if(!_.isMounted)if(D)Ge=pt||o;else return;ht[ou]&&ht[ou](!0);const ai=He[Be];ai&&al(a,ai)&&ai.el[ou]&&ai.el[ou](),lt(Ge,[ht])},enter(ht){let Ge=X,ai=ie,Ot=oe;if(!_.isMounted)if(D)Ge=yt||X,ai=Ze||ie,Ot=Ae||oe;else return;let jt=!1;const Ti=ht[T_]=Qi=>{jt||(jt=!0,Qi?lt(Ot,[ht]):lt(ai,[ht]),Ne.delayedLeave&&Ne.delayedLeave(),ht[T_]=void 0)};Ge?kt(Ge,[ht,Ti]):Ti()},leave(ht,Ge){const ai=String(a.key);if(ht[T_]&&ht[T_](!0),_.isUnmounting)return Ge();lt(xe,[ht]);let Ot=!1;const jt=ht[ou]=Ti=>{Ot||(Ot=!0,Ge(),Ti?lt(We,[ht]):lt(je,[ht]),ht[ou]=void 0,He[ai]===a&&delete He[ai])};He[ai]=a,Te?kt(Te,[ht,jt]):jt()},clone(ht){const Ge=pf(ht,h,_,w,M);return M&&M(Ge),Ge}};return Ne}function Vx(a){if(ag(a))return a=ac(a),a.children=null,a}function kb(a){if(!ag(a))return yw(a.type)&&a.children?ww(a.children):a;const{shapeFlag:h,children:_}=a;if(_){if(h&16)return _[0];if(h&32&&Hi(_.default))return _.default()}}function Yc(a,h){a.shapeFlag&6&&a.component?(a.transition=h,Yc(a.component.subTree,h)):a.shapeFlag&128?(a.ssContent.transition=h.clone(a.ssContent),a.ssFallback.transition=h.clone(a.ssFallback)):a.transition=h}function uy(a,h=!1,_){let w=[],M=0;for(let D=0;D<a.length;D++){let B=a[D];const q=_==null?B.key:String(_)+String(B.key!=null?B.key:D);B.type===es?(B.patchFlag&128&&M++,w=w.concat(uy(B.children,h,q))):(h||B.type!==an)&&w.push(q!=null?ac(B,{key:q}):B)}if(M>1)for(let D=0;D<w.length;D++)w[D].patchFlag=-2;return w}/*! #__NO_SIDE_EFFECTS__ */function ln(a,h){return Hi(a)?as({name:a.name},h,{setup:a}):a}function NA(){const a=Ra();return a?(a.appContext.config.idPrefix||"v")+"-"+a.ids[0]+a.ids[1]++:""}function J0(a){a.ids=[a.ids[0]+a.ids[2]+++"-",0,0]}function UA(a){const h=Ra(),_=q0(null);if(h){const M=h.refs===Ir?h.refs={}:h.refs;Object.defineProperty(M,a,{enumerable:!0,get:()=>_.value,set:D=>_.value=D})}return _}function Qm(a,h,_,w,M=!1){if(Ei(a)){a.forEach((je,We)=>Qm(je,h&&(Ei(h)?h[We]:h),_,w,M));return}if(cu(w)&&!M){w.shapeFlag&512&&w.type.__asyncResolved&&w.component.subTree.component&&Qm(a,h,_,w.component.subTree);return}const D=w.shapeFlag&4?cg(w.component):w.el,B=M?null:D,{i:q,r:o}=a,X=h&&h.r,ie=q.refs===Ir?q.refs={}:q.refs,oe=q.setupState,xe=Pr(oe),Te=oe===Ir?()=>!1:je=>$r(xe,je);if(X!=null&&X!==o&&(ms(X)?(ie[X]=null,Te(X)&&(oe[X]=null)):Os(X)&&(X.value=null)),Hi(o))Tf(o,q,12,[B,ie]);else{const je=ms(o),We=Os(o);if(je||We){const pt=()=>{if(a.f){const yt=je?Te(o)?oe[o]:ie[o]:o.value;M?Ei(yt)&&O0(yt,D):Ei(yt)?yt.includes(D)||yt.push(D):je?(ie[o]=[D],Te(o)&&(oe[o]=ie[o])):(o.value=[D],a.k&&(ie[a.k]=o.value))}else je?(ie[o]=B,Te(o)&&(oe[o]=B)):We&&(o.value=B,a.k&&(ie[a.k]=B))};B?(pt.id=-1,mn(pt,_)):pt()}}}let Pb=!1;const ef=()=>{Pb||(console.error("Hydration completed but contains mismatches."),Pb=!0)},jA=a=>a.namespaceURI.includes("svg")&&a.tagName!=="foreignObject",VA=a=>a.namespaceURI.includes("MathML"),E_=a=>{if(a.nodeType===1){if(jA(a))return"svg";if(VA(a))return"mathml"}},of=a=>a.nodeType===8;function GA(a){const{mt:h,p:_,o:{patchProp:w,createText:M,nextSibling:D,parentNode:B,remove:q,insert:o,createComment:X}}=a,ie=(Ae,Be)=>{if(!Be.hasChildNodes()){_(null,Ae,Be),U_(),Be._vnode=Ae;return}oe(Be.firstChild,Ae,null,null,null),U_(),Be._vnode=Ae},oe=(Ae,Be,He,lt,kt,Ne=!1)=>{Ne=Ne||!!Be.dynamicChildren;const ht=of(Ae)&&Ae.data==="[",Ge=()=>We(Ae,Be,He,lt,kt,ht),{type:ai,ref:Ot,shapeFlag:jt,patchFlag:Ti}=Be;let Qi=Ae.nodeType;Be.el=Ae,Ti===-2&&(Ne=!1,Be.dynamicChildren=null);let li=null;switch(ai){case hu:Qi!==3?Be.children===""?(o(Be.el=M(""),B(Ae),Ae),li=Ae):li=Ge():(Ae.data!==Be.children&&(ef(),Ae.data=Be.children),li=D(Ae));break;case an:Ze(Ae)?(li=D(Ae),yt(Be.el=Ae.content.firstChild,Ae,He)):Qi!==8||ht?li=Ge():li=D(Ae);break;case Ud:if(ht&&(Ae=D(Ae),Qi=Ae.nodeType),Qi===1||Qi===3){li=Ae;const yi=!Be.children.length;for(let xi=0;xi<Be.staticCount;xi++)yi&&(Be.children+=li.nodeType===1?li.outerHTML:li.data),xi===Be.staticCount-1&&(Be.anchor=li),li=D(li);return ht?D(li):li}else Ge();break;case es:ht?li=je(Ae,Be,He,lt,kt,Ne):li=Ge();break;default:if(jt&1)(Qi!==1||Be.type.toLowerCase()!==Ae.tagName.toLowerCase())&&!Ze(Ae)?li=Ge():li=xe(Ae,Be,He,lt,kt,Ne);else if(jt&6){Be.slotScopeIds=kt;const yi=B(Ae);if(ht?li=pt(Ae):of(Ae)&&Ae.data==="teleport start"?li=pt(Ae,Ae.data,"teleport end"):li=D(Ae),h(Be,yi,null,He,lt,E_(yi),Ne),cu(Be)&&!Be.type.__asyncResolved){let xi;ht?(xi=hr(es),xi.anchor=li?li.previousSibling:yi.lastChild):xi=Ae.nodeType===3?jo(""):hr("div"),xi.el=Ae,Be.component.subTree=xi}}else jt&64?Qi!==8?li=Ge():li=Be.type.hydrate(Ae,Be,He,lt,kt,Ne,a,Te):jt&128&&(li=Be.type.hydrate(Ae,Be,He,lt,E_(B(Ae)),kt,Ne,a,oe))}return Ot!=null&&Qm(Ot,null,lt,Be),li},xe=(Ae,Be,He,lt,kt,Ne)=>{Ne=Ne||!!Be.dynamicChildren;const{type:ht,props:Ge,patchFlag:ai,shapeFlag:Ot,dirs:jt,transition:Ti}=Be,Qi=ht==="input"||ht==="option";if(Qi||ai!==-1){jt&&ic(Be,null,He,"created");let li=!1;if(Ze(Ae)){li=Yw(null,Ti)&&He&&He.vnode.props&&He.vnode.props.appear;const xi=Ae.content.firstChild;li&&Ti.beforeEnter(xi),yt(xi,Ae,He),Be.el=Ae=xi}if(Ot&16&&!(Ge&&(Ge.innerHTML||Ge.textContent))){let xi=Te(Ae.firstChild,Be,Ae,He,lt,kt,Ne);for(;xi;){S_(Ae,1)||ef();const vi=xi;xi=xi.nextSibling,q(vi)}}else if(Ot&8){let xi=Be.children;xi[0]===`
`&&(Ae.tagName==="PRE"||Ae.tagName==="TEXTAREA")&&(xi=xi.slice(1)),Ae.textContent!==xi&&(S_(Ae,0)||ef(),Ae.textContent=Be.children)}if(Ge){if(Qi||!Ne||ai&48){const xi=Ae.tagName.includes("-");for(const vi in Ge)(Qi&&(vi.endsWith("value")||vi==="indeterminate")||ng(vi)&&!cf(vi)||vi[0]==="."||xi)&&w(Ae,vi,null,Ge[vi],void 0,He)}else if(Ge.onClick)w(Ae,"onClick",null,Ge.onClick,void 0,He);else if(ai&4&&nc(Ge.style))for(const xi in Ge.style)Ge.style[xi]}let yi;(yi=Ge&&Ge.onVnodeBeforeMount)&&Fo(yi,He,Be),jt&&ic(Be,null,He,"beforeMount"),((yi=Ge&&Ge.onVnodeMounted)||jt||li)&&nT(()=>{yi&&Fo(yi,He,Be),li&&Ti.enter(Ae),jt&&ic(Be,null,He,"mounted")},lt)}return Ae.nextSibling},Te=(Ae,Be,He,lt,kt,Ne,ht)=>{ht=ht||!!Be.dynamicChildren;const Ge=Be.children,ai=Ge.length;for(let Ot=0;Ot<ai;Ot++){const jt=ht?Ge[Ot]:Ge[Ot]=No(Ge[Ot]),Ti=jt.type===hu;Ae?(Ti&&!ht&&Ot+1<ai&&No(Ge[Ot+1]).type===hu&&(o(M(Ae.data.slice(jt.children.length)),He,D(Ae)),Ae.data=jt.children),Ae=oe(Ae,jt,lt,kt,Ne,ht)):Ti&&!jt.children?o(jt.el=M(""),He):(S_(He,1)||ef(),_(null,jt,He,null,lt,kt,E_(He),Ne))}return Ae},je=(Ae,Be,He,lt,kt,Ne)=>{const{slotScopeIds:ht}=Be;ht&&(kt=kt?kt.concat(ht):ht);const Ge=B(Ae),ai=Te(D(Ae),Be,Ge,He,lt,kt,Ne);return ai&&of(ai)&&ai.data==="]"?D(Be.anchor=ai):(ef(),o(Be.anchor=X("]"),Ge,ai),ai)},We=(Ae,Be,He,lt,kt,Ne)=>{if(S_(Ae.parentElement,1)||ef(),Be.el=null,Ne){const ai=pt(Ae);for(;;){const Ot=D(Ae);if(Ot&&Ot!==ai)q(Ot);else break}}const ht=D(Ae),Ge=B(Ae);return q(Ae),_(null,Be,Ge,ht,He,lt,E_(Ge),kt),He&&(He.vnode.el=Be.el,_y(He,Be.el)),ht},pt=(Ae,Be="[",He="]")=>{let lt=0;for(;Ae;)if(Ae=D(Ae),Ae&&of(Ae)&&(Ae.data===Be&&lt++,Ae.data===He)){if(lt===0)return D(Ae);lt--}return Ae},yt=(Ae,Be,He)=>{const lt=Be.parentNode;lt&&lt.replaceChild(Ae,Be);let kt=He;for(;kt;)kt.vnode.el===Be&&(kt.vnode.el=kt.subTree.el=Ae),kt=kt.parent},Ze=Ae=>Ae.nodeType===1&&Ae.tagName==="TEMPLATE";return[ie,oe]}const Ib="data-allow-mismatch",$A={0:"text",1:"children",2:"class",3:"style",4:"attribute"};function S_(a,h){if(h===0||h===1)for(;a&&!a.hasAttribute(Ib);)a=a.parentElement;const _=a&&a.getAttribute(Ib);if(_==null)return!1;if(_==="")return!0;{const w=_.split(",");return h===0&&w.includes("children")?!0:_.split(",").includes($A[h])}}const WA=iy().requestIdleCallback||(a=>setTimeout(a,1)),HA=iy().cancelIdleCallback||(a=>clearTimeout(a)),qA=(a=1e4)=>h=>{const _=WA(h,{timeout:a});return()=>HA(_)};function XA(a){const{top:h,left:_,bottom:w,right:M}=a.getBoundingClientRect(),{innerHeight:D,innerWidth:B}=window;return(h>0&&h<D||w>0&&w<D)&&(_>0&&_<B||M>0&&M<B)}const ZA=a=>(h,_)=>{const w=new IntersectionObserver(M=>{for(const D of M)if(D.isIntersecting){w.disconnect(),h();break}},a);return _(M=>{if(M instanceof Element){if(XA(M))return h(),w.disconnect(),!1;w.observe(M)}}),()=>w.disconnect()},YA=a=>h=>{if(a){const _=matchMedia(a);if(_.matches)h();else return _.addEventListener("change",h,{once:!0}),()=>_.removeEventListener("change",h)}},KA=(a=[])=>(h,_)=>{ms(a)&&(a=[a]);let w=!1;const M=B=>{w||(w=!0,D(),h(),B.target.dispatchEvent(new B.constructor(B.type,B)))},D=()=>{_(B=>{for(const q of a)B.removeEventListener(q,M)})};return _(B=>{for(const q of a)B.addEventListener(q,M,{once:!0})}),D};function JA(a,h){if(of(a)&&a.data==="["){let _=1,w=a.nextSibling;for(;w;){if(w.nodeType===1){if(h(w)===!1)break}else if(of(w))if(w.data==="]"){if(--_===0)break}else w.data==="["&&_++;w=w.nextSibling}}else h(a)}const cu=a=>!!a.type.__asyncLoader;/*! #__NO_SIDE_EFFECTS__ */function QA(a){Hi(a)&&(a={loader:a});const{loader:h,loadingComponent:_,errorComponent:w,delay:M=200,hydrate:D,timeout:B,suspensible:q=!0,onError:o}=a;let X=null,ie,oe=0;const xe=()=>(oe++,X=null,Te()),Te=()=>{let je;return X||(je=X=h().catch(We=>{if(We=We instanceof Error?We:new Error(String(We)),o)return new Promise((pt,yt)=>{o(We,()=>pt(xe()),()=>yt(We),oe+1)});throw We}).then(We=>je!==X&&X?X:(We&&(We.__esModule||We[Symbol.toStringTag]==="Module")&&(We=We.default),ie=We,We)))};return ln({name:"AsyncComponentWrapper",__asyncLoader:Te,__asyncHydrate(je,We,pt){const yt=D?()=>{const Ze=D(pt,Ae=>JA(je,Ae));Ze&&(We.bum||(We.bum=[])).push(Ze)}:pt;ie?yt():Te().then(()=>!We.isUnmounted&&yt())},get __asyncResolved(){return ie},setup(){const je=gn;if(J0(je),ie)return()=>Gx(ie,je);const We=Ae=>{X=null,qd(Ae,je,13,!w)};if(q&&je.suspense||mf)return Te().then(Ae=>()=>Gx(Ae,je)).catch(Ae=>(We(Ae),()=>w?hr(w,{error:Ae}):null));const pt=Kr(!1),yt=Kr(),Ze=Kr(!!M);return M&&setTimeout(()=>{Ze.value=!1},M),B!=null&&setTimeout(()=>{if(!pt.value&&!yt.value){const Ae=new Error(`Async component timed out after ${B}ms.`);We(Ae),yt.value=Ae}},B),Te().then(()=>{pt.value=!0,je.parent&&ag(je.parent.vnode)&&je.parent.update()}).catch(Ae=>{We(Ae),yt.value=Ae}),()=>{if(pt.value&&ie)return Gx(ie,je);if(yt.value&&w)return hr(w,{error:yt.value});if(_&&!Ze.value)return hr(_)}}})}function Gx(a,h){const{ref:_,props:w,children:M,ce:D}=h.vnode,B=hr(a,w,M);return B.ref=_,B.ce=D,delete h.vnode.ce,B}const ag=a=>a.type.__isKeepAlive,eM={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(a,{slots:h}){const _=Ra(),w=_.ctx;if(!w.renderer)return()=>{const Ze=h.default&&h.default();return Ze&&Ze.length===1?Ze[0]:Ze};const M=new Map,D=new Set;let B=null;const q=_.suspense,{renderer:{p:o,m:X,um:ie,o:{createElement:oe}}}=w,xe=oe("div");w.activate=(Ze,Ae,Be,He,lt)=>{const kt=Ze.component;X(Ze,Ae,Be,0,q),o(kt.vnode,Ze,Ae,Be,kt,q,He,Ze.slotScopeIds,lt),mn(()=>{kt.isDeactivated=!1,kt.a&&hf(kt.a);const Ne=Ze.props&&Ze.props.onVnodeMounted;Ne&&Fo(Ne,kt.parent,Ze)},q)},w.deactivate=Ze=>{const Ae=Ze.component;G_(Ae.m),G_(Ae.a),X(Ze,xe,null,1,q),mn(()=>{Ae.da&&hf(Ae.da);const Be=Ze.props&&Ze.props.onVnodeUnmounted;Be&&Fo(Be,Ae.parent,Ze),Ae.isDeactivated=!0},q)};function Te(Ze){$x(Ze),ie(Ze,_,q,!0)}function je(Ze){M.forEach((Ae,Be)=>{const He=v0(Ae.type);He&&!Ze(He)&&We(Be)})}function We(Ze){const Ae=M.get(Ze);Ae&&(!B||!al(Ae,B))?Te(Ae):B&&$x(B),M.delete(Ze),D.delete(Ze)}ul(()=>[a.include,a.exclude],([Ze,Ae])=>{Ze&&je(Be=>Dm(Ze,Be)),Ae&&je(Be=>!Dm(Ae,Be))},{flush:"post",deep:!0});let pt=null;const yt=()=>{pt!=null&&($_(_.subTree.type)?mn(()=>{M.set(pt,A_(_.subTree))},_.subTree.suspense):M.set(pt,A_(_.subTree)))};return lc(yt),py(yt),fy(()=>{M.forEach(Ze=>{const{subTree:Ae,suspense:Be}=_,He=A_(Ae);if(Ze.type===He.type&&Ze.key===He.key){$x(He);const lt=He.component.da;lt&&mn(lt,Be);return}Te(Ze)})}),()=>{if(pt=null,!h.default)return B=null;const Ze=h.default(),Ae=Ze[0];if(Ze.length>1)return B=null,Ze;if(!Kc(Ae)||!(Ae.shapeFlag&4)&&!(Ae.shapeFlag&128))return B=null,Ae;let Be=A_(Ae);if(Be.type===an)return B=null,Be;const He=Be.type,lt=v0(cu(Be)?Be.type.__asyncResolved||{}:He),{include:kt,exclude:Ne,max:ht}=a;if(kt&&(!lt||!Dm(kt,lt))||Ne&&lt&&Dm(Ne,lt))return Be.shapeFlag&=-257,B=Be,Ae;const Ge=Be.key==null?He:Be.key,ai=M.get(Ge);return Be.el&&(Be=ac(Be),Ae.shapeFlag&128&&(Ae.ssContent=Be)),pt=Ge,ai?(Be.el=ai.el,Be.component=ai.component,Be.transition&&Yc(Be,Be.transition),Be.shapeFlag|=512,D.delete(Ge),D.add(Ge)):(D.add(Ge),ht&&D.size>parseInt(ht,10)&&We(D.values().next().value)),Be.shapeFlag|=256,B=Be,$_(Ae.type)?Ae:Be}}},tM=eM;function Dm(a,h){return Ei(a)?a.some(_=>Dm(_,h)):ms(a)?a.split(",").includes(h):PS(a)?(a.lastIndex=0,a.test(h)):!1}function Sw(a,h){Mw(a,"a",h)}function Aw(a,h){Mw(a,"da",h)}function Mw(a,h,_=gn){const w=a.__wdc||(a.__wdc=()=>{let M=_;for(;M;){if(M.isDeactivated)return;M=M.parent}return a()});if(dy(h,w,_),_){let M=_.parent;for(;M&&M.parent;)ag(M.parent.vnode)&&iM(w,h,_,M),M=M.parent}}function iM(a,h,_,w){const M=dy(h,a,w,!0);my(()=>{O0(w[h],M)},_)}function $x(a){a.shapeFlag&=-257,a.shapeFlag&=-513}function A_(a){return a.shapeFlag&128?a.ssContent:a}function dy(a,h,_=gn,w=!1){if(_){const M=_[a]||(_[a]=[]),D=h.__weh||(h.__weh=(...B)=>{fu();const q=Gd(_),o=Da(h,_,a,B);return q(),mu(),o});return w?M.unshift(D):M.push(D),D}}const Jc=a=>(h,_=gn)=>{(!mf||a==="sp")&&dy(a,(...w)=>h(...w),_)},Cw=Jc("bm"),lc=Jc("m"),Q0=Jc("bu"),py=Jc("u"),fy=Jc("bum"),my=Jc("um"),kw=Jc("sp"),Pw=Jc("rtg"),Iw=Jc("rtc");function Lw(a,h=gn){dy("ec",a,h)}const ev="components",rM="directives";function j_(a,h){return tv(ev,a,!0,h)||a}const Dw=Symbol.for("v-ndc");function sM(a){return ms(a)?tv(ev,a,!1)||a:a||Dw}function nM(a){return tv(rM,a)}function tv(a,h,_=!0,w=!1){const M=_n||gn;if(M){const D=M.type;if(a===ev){const q=v0(D,!1);if(q&&(q===h||q===In(h)||q===og(In(h))))return D}const B=Lb(M[a]||D[a],h)||Lb(M.appContext[a],h);return!B&&w?D:B}}function Lb(a,h){return a&&(a[h]||a[In(h)]||a[og(In(h))])}function hl(a,h,_,w){let M;const D=_&&_[w],B=Ei(a);if(B||ms(a)){const q=B&&nc(a);let o=!1;q&&(o=!ua(a),a=ny(a)),M=new Array(a.length);for(let X=0,ie=a.length;X<ie;X++)M[X]=h(o?Xn(a[X]):a[X],X,void 0,D&&D[X])}else if(typeof a=="number"){M=new Array(a);for(let q=0;q<a;q++)M[q]=h(q+1,q,void 0,D&&D[q])}else if(ts(a))if(a[Symbol.iterator])M=Array.from(a,(q,o)=>h(q,o,void 0,D&&D[o]));else{const q=Object.keys(a);M=new Array(q.length);for(let o=0,X=q.length;o<X;o++){const ie=q[o];M[o]=h(a[ie],ie,o,D&&D[o])}}else M=[];return _&&(_[w]=M),M}function oM(a,h){for(let _=0;_<h.length;_++){const w=h[_];if(Ei(w))for(let M=0;M<w.length;M++)a[w[M].name]=w[M].fn;else w&&(a[w.name]=w.key?(...M)=>{const D=w.fn(...M);return D&&(D.key=w.key),D}:w.fn)}return a}function aM(a,h,_={},w,M){if(_n.ce||_n.parent&&cu(_n.parent)&&_n.parent.ce)return h!=="default"&&(_.name=h),Di(),ff(es,null,[hr("slot",_,w&&w())],64);let D=a[h];D&&D._c&&(D._d=!1),Di();const B=D&&iv(D(_)),q=_.key||B&&B.key,o=ff(es,{key:(q&&!dl(q)?q:`_${h}`)+(!B&&w?"_fb":"")},B||(w?w():[]),B&&a._===1?64:-2);return!M&&o.scopeId&&(o.slotScopeIds=[o.scopeId+"-s"]),D&&D._c&&(D._d=!0),o}function iv(a){return a.some(h=>Kc(h)?!(h.type===an||h.type===es&&!iv(h.children)):!0)?a:null}function lM(a,h){const _={};for(const w in a)_[h&&/[A-Z]/.test(w)?`on:${w}`:zm(w)]=a[w];return _}const c0=a=>a?dT(a)?cg(a):c0(a.parent):null,Nm=as(Object.create(null),{$:a=>a,$el:a=>a.vnode.el,$data:a=>a.data,$props:a=>a.props,$attrs:a=>a.attrs,$slots:a=>a.slots,$refs:a=>a.refs,$parent:a=>c0(a.parent),$root:a=>c0(a.root),$host:a=>a.ce,$emit:a=>a.emit,$options:a=>rv(a),$forceUpdate:a=>a.f||(a.f=()=>{Z0(a.update)}),$nextTick:a=>a.n||(a.n=Ef.bind(a.proxy)),$watch:a=>NM.bind(a)}),Wx=(a,h)=>a!==Ir&&!a.__isScriptSetup&&$r(a,h),h0={get({_:a},h){if(h==="__v_skip")return!0;const{ctx:_,setupState:w,data:M,props:D,accessCache:B,type:q,appContext:o}=a;let X;if(h[0]!=="$"){const Te=B[h];if(Te!==void 0)switch(Te){case 1:return w[h];case 2:return M[h];case 4:return _[h];case 3:return D[h]}else{if(Wx(w,h))return B[h]=1,w[h];if(M!==Ir&&$r(M,h))return B[h]=2,M[h];if((X=a.propsOptions[0])&&$r(X,h))return B[h]=3,D[h];if(_!==Ir&&$r(_,h))return B[h]=4,_[h];u0&&(B[h]=0)}}const ie=Nm[h];let oe,xe;if(ie)return h==="$attrs"&&qn(a.attrs,"get",""),ie(a);if((oe=q.__cssModules)&&(oe=oe[h]))return oe;if(_!==Ir&&$r(_,h))return B[h]=4,_[h];if(xe=o.config.globalProperties,$r(xe,h))return xe[h]},set({_:a},h,_){const{data:w,setupState:M,ctx:D}=a;return Wx(M,h)?(M[h]=_,!0):w!==Ir&&$r(w,h)?(w[h]=_,!0):$r(a.props,h)||h[0]==="$"&&h.slice(1)in a?!1:(D[h]=_,!0)},has({_:{data:a,setupState:h,accessCache:_,ctx:w,appContext:M,propsOptions:D}},B){let q;return!!_[B]||a!==Ir&&$r(a,B)||Wx(h,B)||(q=D[0])&&$r(q,B)||$r(w,B)||$r(Nm,B)||$r(M.config.globalProperties,B)},defineProperty(a,h,_){return _.get!=null?a._.accessCache[h]=0:$r(_,"value")&&this.set(a,h,_.value,null),Reflect.defineProperty(a,h,_)}},cM=as({},h0,{get(a,h){if(h!==Symbol.unscopables)return h0.get(a,h,a)},has(a,h){return h[0]!=="_"&&!zS(h)}});function hM(){return null}function uM(){return null}function dM(a){}function pM(a){}function fM(){return null}function mM(){}function gM(a,h){return null}function _M(){return Rw().slots}function yM(){return Rw().attrs}function Rw(){const a=Ra();return a.setupContext||(a.setupContext=mT(a))}function eg(a){return Ei(a)?a.reduce((h,_)=>(h[_]=null,h),{}):a}function xM(a,h){const _=eg(a);for(const w in h){if(w.startsWith("__skip"))continue;let M=_[w];M?Ei(M)||Hi(M)?M=_[w]={type:M,default:h[w]}:M.default=h[w]:M===null&&(M=_[w]={default:h[w]}),M&&h[`__skip_${w}`]&&(M.skipFactory=!0)}return _}function vM(a,h){return!a||!h?a||h:Ei(a)&&Ei(h)?a.concat(h):as({},eg(a),eg(h))}function bM(a,h){const _={};for(const w in a)h.includes(w)||Object.defineProperty(_,w,{enumerable:!0,get:()=>a[w]});return _}function wM(a){const h=Ra();let _=a();return _0(),B0(_)&&(_=_.catch(w=>{throw Gd(h),w})),[_,()=>Gd(h)]}let u0=!0;function TM(a){const h=rv(a),_=a.proxy,w=a.ctx;u0=!1,h.beforeCreate&&Db(h.beforeCreate,a,"bc");const{data:M,computed:D,methods:B,watch:q,provide:o,inject:X,created:ie,beforeMount:oe,mounted:xe,beforeUpdate:Te,updated:je,activated:We,deactivated:pt,beforeDestroy:yt,beforeUnmount:Ze,destroyed:Ae,unmounted:Be,render:He,renderTracked:lt,renderTriggered:kt,errorCaptured:Ne,serverPrefetch:ht,expose:Ge,inheritAttrs:ai,components:Ot,directives:jt,filters:Ti}=h;if(X&&EM(X,w,null),B)for(const yi in B){const xi=B[yi];Hi(xi)&&(w[yi]=xi.bind(_))}if(M){const yi=M.call(_,_);ts(yi)&&(a.data=wf(yi))}if(u0=!0,D)for(const yi in D){const xi=D[yi],vi=Hi(xi)?xi.bind(_,_):Hi(xi.get)?xi.get.bind(_,_):Pa,ws=!Hi(xi)&&Hi(xi.set)?xi.set.bind(_):Pa,Tr=An({get:vi,set:ws});Object.defineProperty(w,yi,{enumerable:!0,configurable:!0,get:()=>Tr.value,set:fr=>Tr.value=fr})}if(q)for(const yi in q)zw(q[yi],w,_,yi);if(o){const yi=Hi(o)?o.call(_):o;Reflect.ownKeys(yi).forEach(xi=>{Um(xi,yi[xi])})}ie&&Db(ie,a,"c");function li(yi,xi){Ei(xi)?xi.forEach(vi=>yi(vi.bind(_))):xi&&yi(xi.bind(_))}if(li(Cw,oe),li(lc,xe),li(Q0,Te),li(py,je),li(Sw,We),li(Aw,pt),li(Lw,Ne),li(Iw,lt),li(Pw,kt),li(fy,Ze),li(my,Be),li(kw,ht),Ei(Ge))if(Ge.length){const yi=a.exposed||(a.exposed={});Ge.forEach(xi=>{Object.defineProperty(yi,xi,{get:()=>_[xi],set:vi=>_[xi]=vi})})}else a.exposed||(a.exposed={});He&&a.render===Pa&&(a.render=He),ai!=null&&(a.inheritAttrs=ai),Ot&&(a.components=Ot),jt&&(a.directives=jt),ht&&J0(a)}function EM(a,h,_=Pa){Ei(a)&&(a=d0(a));for(const w in a){const M=a[w];let D;ts(M)?"default"in M?D=Ia(M.from||w,M.default,!0):D=Ia(M.from||w):D=Ia(M),Os(D)?Object.defineProperty(h,w,{enumerable:!0,configurable:!0,get:()=>D.value,set:B=>D.value=B}):h[w]=D}}function Db(a,h,_){Da(Ei(a)?a.map(w=>w.bind(h.proxy)):a.bind(h.proxy),h,_)}function zw(a,h,_,w){let M=w.includes(".")?tT(_,w):()=>_[w];if(ms(a)){const D=h[a];Hi(D)&&ul(M,D)}else if(Hi(a))ul(M,a.bind(_));else if(ts(a))if(Ei(a))a.forEach(D=>zw(D,h,_,w));else{const D=Hi(a.handler)?a.handler.bind(_):h[a.handler];Hi(D)&&ul(M,D,a)}}function rv(a){const h=a.type,{mixins:_,extends:w}=h,{mixins:M,optionsCache:D,config:{optionMergeStrategies:B}}=a.appContext,q=D.get(h);let o;return q?o=q:!M.length&&!_&&!w?o=h:(o={},M.length&&M.forEach(X=>V_(o,X,B,!0)),V_(o,h,B)),ts(h)&&D.set(h,o),o}function V_(a,h,_,w=!1){const{mixins:M,extends:D}=h;D&&V_(a,D,_,!0),M&&M.forEach(B=>V_(a,B,_,!0));for(const B in h)if(!(w&&B==="expose")){const q=SM[B]||_&&_[B];a[B]=q?q(a[B],h[B]):h[B]}return a}const SM={data:Rb,props:zb,emits:zb,methods:Rm,computed:Rm,beforeCreate:fo,created:fo,beforeMount:fo,mounted:fo,beforeUpdate:fo,updated:fo,beforeDestroy:fo,beforeUnmount:fo,destroyed:fo,unmounted:fo,activated:fo,deactivated:fo,errorCaptured:fo,serverPrefetch:fo,components:Rm,directives:Rm,watch:MM,provide:Rb,inject:AM};function Rb(a,h){return h?a?function(){return as(Hi(a)?a.call(this,this):a,Hi(h)?h.call(this,this):h)}:h:a}function AM(a,h){return Rm(d0(a),d0(h))}function d0(a){if(Ei(a)){const h={};for(let _=0;_<a.length;_++)h[a[_]]=a[_];return h}return a}function fo(a,h){return a?[...new Set([].concat(a,h))]:h}function Rm(a,h){return a?as(Object.create(null),a,h):h}function zb(a,h){return a?Ei(a)&&Ei(h)?[...new Set([...a,...h])]:as(Object.create(null),eg(a),eg(h??{})):h}function MM(a,h){if(!a)return h;if(!h)return a;const _=as(Object.create(null),a);for(const w in h)_[w]=fo(a[w],h[w]);return _}function Ow(){return{app:null,config:{isNativeTag:CS,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let CM=0;function kM(a,h){return function(w,M=null){Hi(w)||(w=as({},w)),M!=null&&!ts(M)&&(M=null);const D=Ow(),B=new WeakSet,q=[];let o=!1;const X=D.app={_uid:CM++,_component:w,_props:M,_container:null,_context:D,_instance:null,version:_T,get config(){return D.config},set config(ie){},use(ie,...oe){return B.has(ie)||(ie&&Hi(ie.install)?(B.add(ie),ie.install(X,...oe)):Hi(ie)&&(B.add(ie),ie(X,...oe))),X},mixin(ie){return D.mixins.includes(ie)||D.mixins.push(ie),X},component(ie,oe){return oe?(D.components[ie]=oe,X):D.components[ie]},directive(ie,oe){return oe?(D.directives[ie]=oe,X):D.directives[ie]},mount(ie,oe,xe){if(!o){const Te=X._ceVNode||hr(w,M);return Te.appContext=D,xe===!0?xe="svg":xe===!1&&(xe=void 0),oe&&h?h(Te,ie):a(Te,ie,xe),o=!0,X._container=ie,ie.__vue_app__=X,cg(Te.component)}},onUnmount(ie){q.push(ie)},unmount(){o&&(Da(q,X._instance,16),a(null,X._container),delete X._container.__vue_app__)},provide(ie,oe){return D.provides[ie]=oe,X},runWithContext(ie){const oe=Nd;Nd=X;try{return ie()}finally{Nd=oe}}};return X}}let Nd=null;function Um(a,h){if(gn){let _=gn.provides;const w=gn.parent&&gn.parent.provides;w===_&&(_=gn.provides=Object.create(w)),_[a]=h}}function Ia(a,h,_=!1){const w=gn||_n;if(w||Nd){const M=Nd?Nd._context.provides:w?w.parent==null?w.vnode.appContext&&w.vnode.appContext.provides:w.parent.provides:void 0;if(M&&a in M)return M[a];if(arguments.length>1)return _&&Hi(h)?h.call(w&&w.proxy):h}}function Bw(){return!!(gn||_n||Nd)}const Fw={},Nw=()=>Object.create(Fw),Uw=a=>Object.getPrototypeOf(a)===Fw;function PM(a,h,_,w=!1){const M={},D=Nw();a.propsDefaults=Object.create(null),jw(a,h,M,D);for(const B in a.propsOptions[0])B in M||(M[B]=void 0);_?a.props=w?M:W0(M):a.type.props?a.props=M:a.props=D,a.attrs=D}function IM(a,h,_,w){const{props:M,attrs:D,vnode:{patchFlag:B}}=a,q=Pr(M),[o]=a.propsOptions;let X=!1;if((w||B>0)&&!(B&16)){if(B&8){const ie=a.vnode.dynamicProps;for(let oe=0;oe<ie.length;oe++){let xe=ie[oe];if(gy(a.emitsOptions,xe))continue;const Te=h[xe];if(o)if($r(D,xe))Te!==D[xe]&&(D[xe]=Te,X=!0);else{const je=In(xe);M[je]=p0(o,q,je,Te,a,!1)}else Te!==D[xe]&&(D[xe]=Te,X=!0)}}}else{jw(a,h,M,D)&&(X=!0);let ie;for(const oe in q)(!h||!$r(h,oe)&&((ie=Uo(oe))===oe||!$r(h,ie)))&&(o?_&&(_[oe]!==void 0||_[ie]!==void 0)&&(M[oe]=p0(o,q,oe,void 0,a,!0)):delete M[oe]);if(D!==q)for(const oe in D)(!h||!$r(h,oe))&&(delete D[oe],X=!0)}X&&qc(a.attrs,"set","")}function jw(a,h,_,w){const[M,D]=a.propsOptions;let B=!1,q;if(h)for(let o in h){if(cf(o))continue;const X=h[o];let ie;M&&$r(M,ie=In(o))?!D||!D.includes(ie)?_[ie]=X:(q||(q={}))[ie]=X:gy(a.emitsOptions,o)||(!(o in w)||X!==w[o])&&(w[o]=X,B=!0)}if(D){const o=Pr(_),X=q||Ir;for(let ie=0;ie<D.length;ie++){const oe=D[ie];_[oe]=p0(M,o,oe,X[oe],a,!$r(X,oe))}}return B}function p0(a,h,_,w,M,D){const B=a[_];if(B!=null){const q=$r(B,"default");if(q&&w===void 0){const o=B.default;if(B.type!==Function&&!B.skipFactory&&Hi(o)){const{propsDefaults:X}=M;if(_ in X)w=X[_];else{const ie=Gd(M);w=X[_]=o.call(null,h),ie()}}else w=o;M.ce&&M.ce._setProp(_,w)}B[0]&&(D&&!q?w=!1:B[1]&&(w===""||w===Uo(_))&&(w=!0))}return w}const LM=new WeakMap;function Vw(a,h,_=!1){const w=_?LM:h.propsCache,M=w.get(a);if(M)return M;const D=a.props,B={},q=[];let o=!1;if(!Hi(a)){const ie=oe=>{o=!0;const[xe,Te]=Vw(oe,h,!0);as(B,xe),Te&&q.push(...Te)};!_&&h.mixins.length&&h.mixins.forEach(ie),a.extends&&ie(a.extends),a.mixins&&a.mixins.forEach(ie)}if(!D&&!o)return ts(a)&&w.set(a,af),af;if(Ei(D))for(let ie=0;ie<D.length;ie++){const oe=In(D[ie]);Ob(oe)&&(B[oe]=Ir)}else if(D)for(const ie in D){const oe=In(ie);if(Ob(oe)){const xe=D[ie],Te=B[oe]=Ei(xe)||Hi(xe)?{type:xe}:as({},xe),je=Te.type;let We=!1,pt=!0;if(Ei(je))for(let yt=0;yt<je.length;++yt){const Ze=je[yt],Ae=Hi(Ze)&&Ze.name;if(Ae==="Boolean"){We=!0;break}else Ae==="String"&&(pt=!1)}else We=Hi(je)&&je.name==="Boolean";Te[0]=We,Te[1]=pt,(We||$r(Te,"default"))&&q.push(oe)}}const X=[B,q];return ts(a)&&w.set(a,X),X}function Ob(a){return a[0]!=="$"&&!cf(a)}const Gw=a=>a[0]==="_"||a==="$stable",sv=a=>Ei(a)?a.map(No):[No(a)],DM=(a,h,_)=>{if(h._n)return h;const w=ol((...M)=>sv(h(...M)),_);return w._c=!1,w},$w=(a,h,_)=>{const w=a._ctx;for(const M in a){if(Gw(M))continue;const D=a[M];if(Hi(D))h[M]=DM(M,D,w);else if(D!=null){const B=sv(D);h[M]=()=>B}}},Ww=(a,h)=>{const _=sv(h);a.slots.default=()=>_},Hw=(a,h,_)=>{for(const w in h)(_||w!=="_")&&(a[w]=h[w])},RM=(a,h,_)=>{const w=a.slots=Nw();if(a.vnode.shapeFlag&32){const M=h._;M?(Hw(w,h,_),_&&j1(w,"_",M,!0)):$w(h,w)}else h&&Ww(a,h)},zM=(a,h,_)=>{const{vnode:w,slots:M}=a;let D=!0,B=Ir;if(w.shapeFlag&32){const q=h._;q?_&&q===1?D=!1:Hw(M,h,_):(D=!h.$stable,$w(h,M)),B=h}else h&&(Ww(a,h),B={default:1});if(D)for(const q in M)!Gw(q)&&B[q]==null&&delete M[q]},mn=nT;function qw(a){return Zw(a)}function Xw(a){return Zw(a,GA)}function Zw(a,h){const _=iy();_.__VUE__=!0;const{insert:w,remove:M,patchProp:D,createElement:B,createText:q,createComment:o,setText:X,setElementText:ie,parentNode:oe,nextSibling:xe,setScopeId:Te=Pa,insertStaticContent:je}=a,We=(me,Ce,ct,Tt=null,xt=null,Vt=null,ei=void 0,Wt=null,qt=!!Ce.dynamicChildren)=>{if(me===Ce)return;me&&!al(me,Ce)&&(Tt=St(me),fr(me,xt,Vt,!0),me=null),Ce.patchFlag===-2&&(qt=!1,Ce.dynamicChildren=null);const{type:Gt,ref:Ci,shapeFlag:Qt}=Ce;switch(Gt){case hu:pt(me,Ce,ct,Tt);break;case an:yt(me,Ce,ct,Tt);break;case Ud:me==null&&Ze(Ce,ct,Tt,ei);break;case es:Ot(me,Ce,ct,Tt,xt,Vt,ei,Wt,qt);break;default:Qt&1?He(me,Ce,ct,Tt,xt,Vt,ei,Wt,qt):Qt&6?jt(me,Ce,ct,Tt,xt,Vt,ei,Wt,qt):(Qt&64||Qt&128)&&Gt.process(me,Ce,ct,Tt,xt,Vt,ei,Wt,qt,fi)}Ci!=null&&xt&&Qm(Ci,me&&me.ref,Vt,Ce||me,!Ce)},pt=(me,Ce,ct,Tt)=>{if(me==null)w(Ce.el=q(Ce.children),ct,Tt);else{const xt=Ce.el=me.el;Ce.children!==me.children&&X(xt,Ce.children)}},yt=(me,Ce,ct,Tt)=>{me==null?w(Ce.el=o(Ce.children||""),ct,Tt):Ce.el=me.el},Ze=(me,Ce,ct,Tt)=>{[me.el,me.anchor]=je(me.children,Ce,ct,Tt,me.el,me.anchor)},Ae=({el:me,anchor:Ce},ct,Tt)=>{let xt;for(;me&&me!==Ce;)xt=xe(me),w(me,ct,Tt),me=xt;w(Ce,ct,Tt)},Be=({el:me,anchor:Ce})=>{let ct;for(;me&&me!==Ce;)ct=xe(me),M(me),me=ct;M(Ce)},He=(me,Ce,ct,Tt,xt,Vt,ei,Wt,qt)=>{Ce.type==="svg"?ei="svg":Ce.type==="math"&&(ei="mathml"),me==null?lt(Ce,ct,Tt,xt,Vt,ei,Wt,qt):ht(me,Ce,xt,Vt,ei,Wt,qt)},lt=(me,Ce,ct,Tt,xt,Vt,ei,Wt)=>{let qt,Gt;const{props:Ci,shapeFlag:Qt,transition:wi,dirs:Pi}=me;if(qt=me.el=B(me.type,Vt,Ci&&Ci.is,Ci),Qt&8?ie(qt,me.children):Qt&16&&Ne(me.children,qt,null,Tt,xt,Hx(me,Vt),ei,Wt),Pi&&ic(me,null,Tt,"created"),kt(qt,me,me.scopeId,ei,Tt),Ci){for(const tr in Ci)tr!=="value"&&!cf(tr)&&D(qt,tr,null,Ci[tr],Vt,Tt);"value"in Ci&&D(qt,"value",null,Ci.value,Vt),(Gt=Ci.onVnodeBeforeMount)&&Fo(Gt,Tt,me)}Pi&&ic(me,null,Tt,"beforeMount");const er=Yw(xt,wi);er&&wi.beforeEnter(qt),w(qt,Ce,ct),((Gt=Ci&&Ci.onVnodeMounted)||er||Pi)&&mn(()=>{Gt&&Fo(Gt,Tt,me),er&&wi.enter(qt),Pi&&ic(me,null,Tt,"mounted")},xt)},kt=(me,Ce,ct,Tt,xt)=>{if(ct&&Te(me,ct),Tt)for(let Vt=0;Vt<Tt.length;Vt++)Te(me,Tt[Vt]);if(xt){let Vt=xt.subTree;if(Ce===Vt||$_(Vt.type)&&(Vt.ssContent===Ce||Vt.ssFallback===Ce)){const ei=xt.vnode;kt(me,ei,ei.scopeId,ei.slotScopeIds,xt.parent)}}},Ne=(me,Ce,ct,Tt,xt,Vt,ei,Wt,qt=0)=>{for(let Gt=qt;Gt<me.length;Gt++){const Ci=me[Gt]=Wt?au(me[Gt]):No(me[Gt]);We(null,Ci,Ce,ct,Tt,xt,Vt,ei,Wt)}},ht=(me,Ce,ct,Tt,xt,Vt,ei)=>{const Wt=Ce.el=me.el;let{patchFlag:qt,dynamicChildren:Gt,dirs:Ci}=Ce;qt|=me.patchFlag&16;const Qt=me.props||Ir,wi=Ce.props||Ir;let Pi;if(ct&&zd(ct,!1),(Pi=wi.onVnodeBeforeUpdate)&&Fo(Pi,ct,Ce,me),Ci&&ic(Ce,me,ct,"beforeUpdate"),ct&&zd(ct,!0),(Qt.innerHTML&&wi.innerHTML==null||Qt.textContent&&wi.textContent==null)&&ie(Wt,""),Gt?Ge(me.dynamicChildren,Gt,Wt,ct,Tt,Hx(Ce,xt),Vt):ei||xi(me,Ce,Wt,null,ct,Tt,Hx(Ce,xt),Vt,!1),qt>0){if(qt&16)ai(Wt,Qt,wi,ct,xt);else if(qt&2&&Qt.class!==wi.class&&D(Wt,"class",null,wi.class,xt),qt&4&&D(Wt,"style",Qt.style,wi.style,xt),qt&8){const er=Ce.dynamicProps;for(let tr=0;tr<er.length;tr++){const sr=er[tr],Cs=Qt[sr],Zr=wi[sr];(Zr!==Cs||sr==="value")&&D(Wt,sr,Cs,Zr,xt,ct)}}qt&1&&me.children!==Ce.children&&ie(Wt,Ce.children)}else!ei&&Gt==null&&ai(Wt,Qt,wi,ct,xt);((Pi=wi.onVnodeUpdated)||Ci)&&mn(()=>{Pi&&Fo(Pi,ct,Ce,me),Ci&&ic(Ce,me,ct,"updated")},Tt)},Ge=(me,Ce,ct,Tt,xt,Vt,ei)=>{for(let Wt=0;Wt<Ce.length;Wt++){const qt=me[Wt],Gt=Ce[Wt],Ci=qt.el&&(qt.type===es||!al(qt,Gt)||qt.shapeFlag&70)?oe(qt.el):ct;We(qt,Gt,Ci,null,Tt,xt,Vt,ei,!0)}},ai=(me,Ce,ct,Tt,xt)=>{if(Ce!==ct){if(Ce!==Ir)for(const Vt in Ce)!cf(Vt)&&!(Vt in ct)&&D(me,Vt,Ce[Vt],null,xt,Tt);for(const Vt in ct){if(cf(Vt))continue;const ei=ct[Vt],Wt=Ce[Vt];ei!==Wt&&Vt!=="value"&&D(me,Vt,Wt,ei,xt,Tt)}"value"in ct&&D(me,"value",Ce.value,ct.value,xt)}},Ot=(me,Ce,ct,Tt,xt,Vt,ei,Wt,qt)=>{const Gt=Ce.el=me?me.el:q(""),Ci=Ce.anchor=me?me.anchor:q("");let{patchFlag:Qt,dynamicChildren:wi,slotScopeIds:Pi}=Ce;Pi&&(Wt=Wt?Wt.concat(Pi):Pi),me==null?(w(Gt,ct,Tt),w(Ci,ct,Tt),Ne(Ce.children||[],ct,Ci,xt,Vt,ei,Wt,qt)):Qt>0&&Qt&64&&wi&&me.dynamicChildren?(Ge(me.dynamicChildren,wi,ct,xt,Vt,ei,Wt),(Ce.key!=null||xt&&Ce===xt.subTree)&&nv(me,Ce,!0)):xi(me,Ce,ct,Ci,xt,Vt,ei,Wt,qt)},jt=(me,Ce,ct,Tt,xt,Vt,ei,Wt,qt)=>{Ce.slotScopeIds=Wt,me==null?Ce.shapeFlag&512?xt.ctx.activate(Ce,ct,Tt,ei,qt):Ti(Ce,ct,Tt,xt,Vt,ei,qt):Qi(me,Ce,qt)},Ti=(me,Ce,ct,Tt,xt,Vt,ei)=>{const Wt=me.component=uT(me,Tt,xt);if(ag(me)&&(Wt.ctx.renderer=fi),pT(Wt,!1,ei),Wt.asyncDep){if(xt&&xt.registerDep(Wt,li,ei),!me.el){const qt=Wt.subTree=hr(an);yt(null,qt,Ce,ct)}}else li(Wt,me,Ce,ct,xt,Vt,ei)},Qi=(me,Ce,ct)=>{const Tt=Ce.component=me.component;if(WM(me,Ce,ct))if(Tt.asyncDep&&!Tt.asyncResolved){yi(Tt,Ce,ct);return}else Tt.next=Ce,Tt.update();else Ce.el=me.el,Tt.vnode=Ce},li=(me,Ce,ct,Tt,xt,Vt,ei)=>{const Wt=()=>{if(me.isMounted){let{next:Qt,bu:wi,u:Pi,parent:er,vnode:tr}=me;{const ir=Kw(me);if(ir){Qt&&(Qt.el=tr.el,yi(me,Qt,ei)),ir.asyncDep.then(()=>{me.isUnmounted||Wt()});return}}let sr=Qt,Cs;zd(me,!1),Qt?(Qt.el=tr.el,yi(me,Qt,ei)):Qt=tr,wi&&hf(wi),(Cs=Qt.props&&Qt.props.onVnodeBeforeUpdate)&&Fo(Cs,er,Qt,tr),zd(me,!0);const Zr=k_(me),Bs=me.subTree;me.subTree=Zr,We(Bs,Zr,oe(Bs.el),St(Bs),me,xt,Vt),Qt.el=Zr.el,sr===null&&_y(me,Zr.el),Pi&&mn(Pi,xt),(Cs=Qt.props&&Qt.props.onVnodeUpdated)&&mn(()=>Fo(Cs,er,Qt,tr),xt)}else{let Qt;const{el:wi,props:Pi}=Ce,{bm:er,m:tr,parent:sr,root:Cs,type:Zr}=me,Bs=cu(Ce);if(zd(me,!1),er&&hf(er),!Bs&&(Qt=Pi&&Pi.onVnodeBeforeMount)&&Fo(Qt,sr,Ce),zd(me,!0),wi&&gi){const ir=()=>{me.subTree=k_(me),gi(wi,me.subTree,me,xt,null)};Bs&&Zr.__asyncHydrate?Zr.__asyncHydrate(wi,me,ir):ir()}else{Cs.ce&&Cs.ce._injectChildStyle(Zr);const ir=me.subTree=k_(me);We(null,ir,ct,Tt,me,xt,Vt),Ce.el=ir.el}if(tr&&mn(tr,xt),!Bs&&(Qt=Pi&&Pi.onVnodeMounted)){const ir=Ce;mn(()=>Fo(Qt,sr,ir),xt)}(Ce.shapeFlag&256||sr&&cu(sr.vnode)&&sr.vnode.shapeFlag&256)&&me.a&&mn(me.a,xt),me.isMounted=!0,Ce=ct=Tt=null}};me.scope.on();const qt=me.effect=new qm(Wt);me.scope.off();const Gt=me.update=qt.run.bind(qt),Ci=me.job=qt.runIfDirty.bind(qt);Ci.i=me,Ci.id=me.uid,qt.scheduler=()=>Z0(Ci),zd(me,!0),Gt()},yi=(me,Ce,ct)=>{Ce.component=me;const Tt=me.vnode.props;me.vnode=Ce,me.next=null,IM(me,Ce.props,Tt,ct),zM(me,Ce.children,ct),fu(),Sb(me),mu()},xi=(me,Ce,ct,Tt,xt,Vt,ei,Wt,qt=!1)=>{const Gt=me&&me.children,Ci=me?me.shapeFlag:0,Qt=Ce.children,{patchFlag:wi,shapeFlag:Pi}=Ce;if(wi>0){if(wi&128){ws(Gt,Qt,ct,Tt,xt,Vt,ei,Wt,qt);return}else if(wi&256){vi(Gt,Qt,ct,Tt,xt,Vt,ei,Wt,qt);return}}Pi&8?(Ci&16&&Es(Gt,xt,Vt),Qt!==Gt&&ie(ct,Qt)):Ci&16?Pi&16?ws(Gt,Qt,ct,Tt,xt,Vt,ei,Wt,qt):Es(Gt,xt,Vt,!0):(Ci&8&&ie(ct,""),Pi&16&&Ne(Qt,ct,Tt,xt,Vt,ei,Wt,qt))},vi=(me,Ce,ct,Tt,xt,Vt,ei,Wt,qt)=>{me=me||af,Ce=Ce||af;const Gt=me.length,Ci=Ce.length,Qt=Math.min(Gt,Ci);let wi;for(wi=0;wi<Qt;wi++){const Pi=Ce[wi]=qt?au(Ce[wi]):No(Ce[wi]);We(me[wi],Pi,ct,null,xt,Vt,ei,Wt,qt)}Gt>Ci?Es(me,xt,Vt,!0,!1,Qt):Ne(Ce,ct,Tt,xt,Vt,ei,Wt,qt,Qt)},ws=(me,Ce,ct,Tt,xt,Vt,ei,Wt,qt)=>{let Gt=0;const Ci=Ce.length;let Qt=me.length-1,wi=Ci-1;for(;Gt<=Qt&&Gt<=wi;){const Pi=me[Gt],er=Ce[Gt]=qt?au(Ce[Gt]):No(Ce[Gt]);if(al(Pi,er))We(Pi,er,ct,null,xt,Vt,ei,Wt,qt);else break;Gt++}for(;Gt<=Qt&&Gt<=wi;){const Pi=me[Qt],er=Ce[wi]=qt?au(Ce[wi]):No(Ce[wi]);if(al(Pi,er))We(Pi,er,ct,null,xt,Vt,ei,Wt,qt);else break;Qt--,wi--}if(Gt>Qt){if(Gt<=wi){const Pi=wi+1,er=Pi<Ci?Ce[Pi].el:Tt;for(;Gt<=wi;)We(null,Ce[Gt]=qt?au(Ce[Gt]):No(Ce[Gt]),ct,er,xt,Vt,ei,Wt,qt),Gt++}}else if(Gt>wi)for(;Gt<=Qt;)fr(me[Gt],xt,Vt,!0),Gt++;else{const Pi=Gt,er=Gt,tr=new Map;for(Gt=er;Gt<=wi;Gt++){const gs=Ce[Gt]=qt?au(Ce[Gt]):No(Ce[Gt]);gs.key!=null&&tr.set(gs.key,Gt)}let sr,Cs=0;const Zr=wi-er+1;let Bs=!1,ir=0;const hn=new Array(Zr);for(Gt=0;Gt<Zr;Gt++)hn[Gt]=0;for(Gt=Pi;Gt<=Qt;Gt++){const gs=me[Gt];if(Cs>=Zr){fr(gs,xt,Vt,!0);continue}let Fs;if(gs.key!=null)Fs=tr.get(gs.key);else for(sr=er;sr<=wi;sr++)if(hn[sr-er]===0&&al(gs,Ce[sr])){Fs=sr;break}Fs===void 0?fr(gs,xt,Vt,!0):(hn[Fs-er]=Gt+1,Fs>=ir?ir=Fs:Bs=!0,We(gs,Ce[Fs],ct,null,xt,Vt,ei,Wt,qt),Cs++)}const Kn=Bs?OM(hn):af;for(sr=Kn.length-1,Gt=Zr-1;Gt>=0;Gt--){const gs=er+Gt,Fs=Ce[gs],Ws=gs+1<Ci?Ce[gs+1].el:Tt;hn[Gt]===0?We(null,Fs,ct,Ws,xt,Vt,ei,Wt,qt):Bs&&(sr<0||Gt!==Kn[sr]?Tr(Fs,ct,Ws,2):sr--)}}},Tr=(me,Ce,ct,Tt,xt=null)=>{const{el:Vt,type:ei,transition:Wt,children:qt,shapeFlag:Gt}=me;if(Gt&6){Tr(me.component.subTree,Ce,ct,Tt);return}if(Gt&128){me.suspense.move(Ce,ct,Tt);return}if(Gt&64){ei.move(me,Ce,ct,fi);return}if(ei===es){w(Vt,Ce,ct);for(let Qt=0;Qt<qt.length;Qt++)Tr(qt[Qt],Ce,ct,Tt);w(me.anchor,Ce,ct);return}if(ei===Ud){Ae(me,Ce,ct);return}if(Tt!==2&&Gt&1&&Wt)if(Tt===0)Wt.beforeEnter(Vt),w(Vt,Ce,ct),mn(()=>Wt.enter(Vt),xt);else{const{leave:Qt,delayLeave:wi,afterLeave:Pi}=Wt,er=()=>w(Vt,Ce,ct),tr=()=>{Qt(Vt,()=>{er(),Pi&&Pi()})};wi?wi(Vt,er,tr):tr()}else w(Vt,Ce,ct)},fr=(me,Ce,ct,Tt=!1,xt=!1)=>{const{type:Vt,props:ei,ref:Wt,children:qt,dynamicChildren:Gt,shapeFlag:Ci,patchFlag:Qt,dirs:wi,cacheIndex:Pi}=me;if(Qt===-2&&(xt=!1),Wt!=null&&Qm(Wt,null,ct,me,!0),Pi!=null&&(Ce.renderCache[Pi]=void 0),Ci&256){Ce.ctx.deactivate(me);return}const er=Ci&1&&wi,tr=!cu(me);let sr;if(tr&&(sr=ei&&ei.onVnodeBeforeUnmount)&&Fo(sr,Ce,me),Ci&6)cn(me.component,ct,Tt);else{if(Ci&128){me.suspense.unmount(ct,Tt);return}er&&ic(me,null,Ce,"beforeUnmount"),Ci&64?me.type.remove(me,Ce,ct,fi,Tt):Gt&&!Gt.hasOnce&&(Vt!==es||Qt>0&&Qt&64)?Es(Gt,Ce,ct,!1,!0):(Vt===es&&Qt&384||!xt&&Ci&16)&&Es(qt,Ce,ct),Tt&&Ts(me)}(tr&&(sr=ei&&ei.onVnodeUnmounted)||er)&&mn(()=>{sr&&Fo(sr,Ce,me),er&&ic(me,null,Ce,"unmounted")},ct)},Ts=me=>{const{type:Ce,el:ct,anchor:Tt,transition:xt}=me;if(Ce===es){br(ct,Tt);return}if(Ce===Ud){Be(me);return}const Vt=()=>{M(ct),xt&&!xt.persisted&&xt.afterLeave&&xt.afterLeave()};if(me.shapeFlag&1&&xt&&!xt.persisted){const{leave:ei,delayLeave:Wt}=xt,qt=()=>ei(ct,Vt);Wt?Wt(me.el,Vt,qt):qt()}else Vt()},br=(me,Ce)=>{let ct;for(;me!==Ce;)ct=xe(me),M(me),me=ct;M(Ce)},cn=(me,Ce,ct)=>{const{bum:Tt,scope:xt,job:Vt,subTree:ei,um:Wt,m:qt,a:Gt}=me;G_(qt),G_(Gt),Tt&&hf(Tt),xt.stop(),Vt&&(Vt.flags|=8,fr(ei,me,Ce,ct)),Wt&&mn(Wt,Ce),mn(()=>{me.isUnmounted=!0},Ce),Ce&&Ce.pendingBranch&&!Ce.isUnmounted&&me.asyncDep&&!me.asyncResolved&&me.suspenseId===Ce.pendingId&&(Ce.deps--,Ce.deps===0&&Ce.resolve())},Es=(me,Ce,ct,Tt=!1,xt=!1,Vt=0)=>{for(let ei=Vt;ei<me.length;ei++)fr(me[ei],Ce,ct,Tt,xt)},St=me=>{if(me.shapeFlag&6)return St(me.component.subTree);if(me.shapeFlag&128)return me.suspense.next();const Ce=xe(me.anchor||me.el),ct=Ce&&Ce[_w];return ct?xe(ct):Ce};let ci=!1;const ri=(me,Ce,ct)=>{me==null?Ce._vnode&&fr(Ce._vnode,null,null,!0):We(Ce._vnode||null,me,Ce,null,null,null,ct),Ce._vnode=me,ci||(ci=!0,Sb(),U_(),ci=!1)},fi={p:We,um:fr,m:Tr,r:Ts,mt:Ti,mc:Ne,pc:xi,pbc:Ge,n:St,o:a};let rr,gi;return h&&([rr,gi]=h(fi)),{render:ri,hydrate:rr,createApp:kM(ri,rr)}}function Hx({type:a,props:h},_){return _==="svg"&&a==="foreignObject"||_==="mathml"&&a==="annotation-xml"&&h&&h.encoding&&h.encoding.includes("html")?void 0:_}function zd({effect:a,job:h},_){_?(a.flags|=32,h.flags|=4):(a.flags&=-33,h.flags&=-5)}function Yw(a,h){return(!a||a&&!a.pendingBranch)&&h&&!h.persisted}function nv(a,h,_=!1){const w=a.children,M=h.children;if(Ei(w)&&Ei(M))for(let D=0;D<w.length;D++){const B=w[D];let q=M[D];q.shapeFlag&1&&!q.dynamicChildren&&((q.patchFlag<=0||q.patchFlag===32)&&(q=M[D]=au(M[D]),q.el=B.el),!_&&q.patchFlag!==-2&&nv(B,q)),q.type===hu&&(q.el=B.el)}}function OM(a){const h=a.slice(),_=[0];let w,M,D,B,q;const o=a.length;for(w=0;w<o;w++){const X=a[w];if(X!==0){if(M=_[_.length-1],a[M]<X){h[w]=M,_.push(w);continue}for(D=0,B=_.length-1;D<B;)q=D+B>>1,a[_[q]]<X?D=q+1:B=q;X<a[_[D]]&&(D>0&&(h[w]=_[D-1]),_[D]=w)}}for(D=_.length,B=_[D-1];D-- >0;)_[D]=B,B=h[B];return _}function Kw(a){const h=a.subTree.component;if(h)return h.asyncDep&&!h.asyncResolved?h:Kw(h)}function G_(a){if(a)for(let h=0;h<a.length;h++)a[h].flags|=8}const Jw=Symbol.for("v-scx"),Qw=()=>Ia(Jw);function BM(a,h){return lg(a,null,h)}function FM(a,h){return lg(a,null,{flush:"post"})}function eT(a,h){return lg(a,null,{flush:"sync"})}function ul(a,h,_){return lg(a,h,_)}function lg(a,h,_=Ir){const{immediate:w,deep:M,flush:D,once:B}=_,q=as({},_),o=h&&w||!h&&D!=="post";let X;if(mf){if(D==="sync"){const Te=Qw();X=Te.__watcherHandles||(Te.__watcherHandles=[])}else if(!o){const Te=()=>{};return Te.stop=Pa,Te.resume=Pa,Te.pause=Pa,Te}}const ie=gn;q.call=(Te,je,We)=>Da(Te,ie,je,We);let oe=!1;D==="post"?q.scheduler=Te=>{mn(Te,ie&&ie.suspense)}:D!=="sync"&&(oe=!0,q.scheduler=(Te,je)=>{je?Te():Z0(Te)}),q.augmentJob=Te=>{h&&(Te.flags|=4),oe&&(Te.flags|=2,ie&&(Te.id=ie.uid,Te.i=ie))};const xe=SA(a,h,q);return mf&&(X?X.push(xe):o&&xe()),xe}function NM(a,h,_){const w=this.proxy,M=ms(a)?a.includes(".")?tT(w,a):()=>w[a]:a.bind(w,w);let D;Hi(h)?D=h:(D=h.handler,_=h);const B=Gd(this),q=lg(M,D.bind(w),_);return B(),q}function tT(a,h){const _=h.split(".");return()=>{let w=a;for(let M=0;M<_.length&&w;M++)w=w[_[M]];return w}}function UM(a,h,_=Ir){const w=Ra(),M=In(h),D=Uo(h),B=iT(a,M),q=lw((o,X)=>{let ie,oe=Ir,xe;return eT(()=>{const Te=a[M];go(ie,Te)&&(ie=Te,X())}),{get(){return o(),_.get?_.get(ie):ie},set(Te){const je=_.set?_.set(Te):Te;if(!go(je,ie)&&!(oe!==Ir&&go(Te,oe)))return;const We=w.vnode.props;We&&(h in We||M in We||D in We)&&(`onUpdate:${h}`in We||`onUpdate:${M}`in We||`onUpdate:${D}`in We)||(ie=Te,X()),w.emit(`update:${h}`,je),go(Te,je)&&go(Te,oe)&&!go(je,xe)&&X(),oe=Te,xe=je}}});return q[Symbol.iterator]=()=>{let o=0;return{next(){return o<2?{value:o++?B||Ir:q,done:!1}:{done:!0}}}},q}const iT=(a,h)=>h==="modelValue"||h==="model-value"?a.modelModifiers:a[`${h}Modifiers`]||a[`${In(h)}Modifiers`]||a[`${Uo(h)}Modifiers`];function jM(a,h,..._){if(a.isUnmounted)return;const w=a.vnode.props||Ir;let M=_;const D=h.startsWith("update:"),B=D&&iT(w,h.slice(7));B&&(B.trim&&(M=_.map(ie=>ms(ie)?ie.trim():ie)),B.number&&(M=_.map(z_)));let q,o=w[q=zm(h)]||w[q=zm(In(h))];!o&&D&&(o=w[q=zm(Uo(h))]),o&&Da(o,a,6,M);const X=w[q+"Once"];if(X){if(!a.emitted)a.emitted={};else if(a.emitted[q])return;a.emitted[q]=!0,Da(X,a,6,M)}}function rT(a,h,_=!1){const w=h.emitsCache,M=w.get(a);if(M!==void 0)return M;const D=a.emits;let B={},q=!1;if(!Hi(a)){const o=X=>{const ie=rT(X,h,!0);ie&&(q=!0,as(B,ie))};!_&&h.mixins.length&&h.mixins.forEach(o),a.extends&&o(a.extends),a.mixins&&a.mixins.forEach(o)}return!D&&!q?(ts(a)&&w.set(a,null),null):(Ei(D)?D.forEach(o=>B[o]=null):as(B,D),ts(a)&&w.set(a,B),B)}function gy(a,h){return!a||!ng(h)?!1:(h=h.slice(2).replace(/Once$/,""),$r(a,h[0].toLowerCase()+h.slice(1))||$r(a,Uo(h))||$r(a,h))}function k_(a){const{type:h,vnode:_,proxy:w,withProxy:M,propsOptions:[D],slots:B,attrs:q,emit:o,render:X,renderCache:ie,props:oe,data:xe,setupState:Te,ctx:je,inheritAttrs:We}=a,pt=Jm(a);let yt,Ze;try{if(_.shapeFlag&4){const Be=M||w,He=Be;yt=No(X.call(He,Be,ie,oe,Te,xe,je)),Ze=q}else{const Be=h;yt=No(Be.length>1?Be(oe,{attrs:q,slots:B,emit:o}):Be(oe,null)),Ze=h.props?q:GM(q)}}catch(Be){jm.length=0,qd(Be,a,1),yt=hr(an)}let Ae=yt;if(Ze&&We!==!1){const Be=Object.keys(Ze),{shapeFlag:He}=Ae;Be.length&&He&7&&(D&&Be.some(z0)&&(Ze=$M(Ze,D)),Ae=ac(Ae,Ze,!1,!0))}return _.dirs&&(Ae=ac(Ae,null,!1,!0),Ae.dirs=Ae.dirs?Ae.dirs.concat(_.dirs):_.dirs),_.transition&&Yc(Ae,_.transition),yt=Ae,Jm(pt),yt}function VM(a,h=!0){let _;for(let w=0;w<a.length;w++){const M=a[w];if(Kc(M)){if(M.type!==an||M.children==="v-if"){if(_)return;_=M}}else return}return _}const GM=a=>{let h;for(const _ in a)(_==="class"||_==="style"||ng(_))&&((h||(h={}))[_]=a[_]);return h},$M=(a,h)=>{const _={};for(const w in a)(!z0(w)||!(w.slice(9)in h))&&(_[w]=a[w]);return _};function WM(a,h,_){const{props:w,children:M,component:D}=a,{props:B,children:q,patchFlag:o}=h,X=D.emitsOptions;if(h.dirs||h.transition)return!0;if(_&&o>=0){if(o&1024)return!0;if(o&16)return w?Bb(w,B,X):!!B;if(o&8){const ie=h.dynamicProps;for(let oe=0;oe<ie.length;oe++){const xe=ie[oe];if(B[xe]!==w[xe]&&!gy(X,xe))return!0}}}else return(M||q)&&(!q||!q.$stable)?!0:w===B?!1:w?B?Bb(w,B,X):!0:!!B;return!1}function Bb(a,h,_){const w=Object.keys(h);if(w.length!==Object.keys(a).length)return!0;for(let M=0;M<w.length;M++){const D=w[M];if(h[D]!==a[D]&&!gy(_,D))return!0}return!1}function _y({vnode:a,parent:h},_){for(;h;){const w=h.subTree;if(w.suspense&&w.suspense.activeBranch===a&&(w.el=a.el),w===a)(a=h.vnode).el=_,h=h.parent;else break}}const $_=a=>a.__isSuspense;let f0=0;const HM={name:"Suspense",__isSuspense:!0,process(a,h,_,w,M,D,B,q,o,X){if(a==null)XM(h,_,w,M,D,B,q,o,X);else{if(D&&D.deps>0&&!a.suspense.isInFallback){h.suspense=a.suspense,h.suspense.vnode=h,h.el=a.el;return}ZM(a,h,_,w,M,B,q,o,X)}},hydrate:YM,normalize:KM},qM=HM;function tg(a,h){const _=a.props&&a.props[h];Hi(_)&&_()}function XM(a,h,_,w,M,D,B,q,o){const{p:X,o:{createElement:ie}}=o,oe=ie("div"),xe=a.suspense=sT(a,M,w,h,oe,_,D,B,q,o);X(null,xe.pendingBranch=a.ssContent,oe,null,w,xe,D,B),xe.deps>0?(tg(a,"onPending"),tg(a,"onFallback"),X(null,a.ssFallback,h,_,w,null,D,B),df(xe,a.ssFallback)):xe.resolve(!1,!0)}function ZM(a,h,_,w,M,D,B,q,{p:o,um:X,o:{createElement:ie}}){const oe=h.suspense=a.suspense;oe.vnode=h,h.el=a.el;const xe=h.ssContent,Te=h.ssFallback,{activeBranch:je,pendingBranch:We,isInFallback:pt,isHydrating:yt}=oe;if(We)oe.pendingBranch=xe,al(xe,We)?(o(We,xe,oe.hiddenContainer,null,M,oe,D,B,q),oe.deps<=0?oe.resolve():pt&&(yt||(o(je,Te,_,w,M,null,D,B,q),df(oe,Te)))):(oe.pendingId=f0++,yt?(oe.isHydrating=!1,oe.activeBranch=We):X(We,M,oe),oe.deps=0,oe.effects.length=0,oe.hiddenContainer=ie("div"),pt?(o(null,xe,oe.hiddenContainer,null,M,oe,D,B,q),oe.deps<=0?oe.resolve():(o(je,Te,_,w,M,null,D,B,q),df(oe,Te))):je&&al(xe,je)?(o(je,xe,_,w,M,oe,D,B,q),oe.resolve(!0)):(o(null,xe,oe.hiddenContainer,null,M,oe,D,B,q),oe.deps<=0&&oe.resolve()));else if(je&&al(xe,je))o(je,xe,_,w,M,oe,D,B,q),df(oe,xe);else if(tg(h,"onPending"),oe.pendingBranch=xe,xe.shapeFlag&512?oe.pendingId=xe.component.suspenseId:oe.pendingId=f0++,o(null,xe,oe.hiddenContainer,null,M,oe,D,B,q),oe.deps<=0)oe.resolve();else{const{timeout:Ze,pendingId:Ae}=oe;Ze>0?setTimeout(()=>{oe.pendingId===Ae&&oe.fallback(Te)},Ze):Ze===0&&oe.fallback(Te)}}function sT(a,h,_,w,M,D,B,q,o,X,ie=!1){const{p:oe,m:xe,um:Te,n:je,o:{parentNode:We,remove:pt}}=X;let yt;const Ze=JM(a);Ze&&h&&h.pendingBranch&&(yt=h.pendingId,h.deps++);const Ae=a.props?O_(a.props.timeout):void 0,Be=D,He={vnode:a,parent:h,parentComponent:_,namespace:B,container:w,hiddenContainer:M,deps:0,pendingId:f0++,timeout:typeof Ae=="number"?Ae:-1,activeBranch:null,pendingBranch:null,isInFallback:!ie,isHydrating:ie,isUnmounted:!1,effects:[],resolve(lt=!1,kt=!1){const{vnode:Ne,activeBranch:ht,pendingBranch:Ge,pendingId:ai,effects:Ot,parentComponent:jt,container:Ti}=He;let Qi=!1;He.isHydrating?He.isHydrating=!1:lt||(Qi=ht&&Ge.transition&&Ge.transition.mode==="out-in",Qi&&(ht.transition.afterLeave=()=>{ai===He.pendingId&&(xe(Ge,Ti,D===Be?je(ht):D,0),Ym(Ot))}),ht&&(We(ht.el)===Ti&&(D=je(ht)),Te(ht,jt,He,!0)),Qi||xe(Ge,Ti,D,0)),df(He,Ge),He.pendingBranch=null,He.isInFallback=!1;let li=He.parent,yi=!1;for(;li;){if(li.pendingBranch){li.effects.push(...Ot),yi=!0;break}li=li.parent}!yi&&!Qi&&Ym(Ot),He.effects=[],Ze&&h&&h.pendingBranch&&yt===h.pendingId&&(h.deps--,h.deps===0&&!kt&&h.resolve()),tg(Ne,"onResolve")},fallback(lt){if(!He.pendingBranch)return;const{vnode:kt,activeBranch:Ne,parentComponent:ht,container:Ge,namespace:ai}=He;tg(kt,"onFallback");const Ot=je(Ne),jt=()=>{He.isInFallback&&(oe(null,lt,Ge,Ot,ht,null,ai,q,o),df(He,lt))},Ti=lt.transition&&lt.transition.mode==="out-in";Ti&&(Ne.transition.afterLeave=jt),He.isInFallback=!0,Te(Ne,ht,null,!0),Ti||jt()},move(lt,kt,Ne){He.activeBranch&&xe(He.activeBranch,lt,kt,Ne),He.container=lt},next(){return He.activeBranch&&je(He.activeBranch)},registerDep(lt,kt,Ne){const ht=!!He.pendingBranch;ht&&He.deps++;const Ge=lt.vnode.el;lt.asyncDep.catch(ai=>{qd(ai,lt,0)}).then(ai=>{if(lt.isUnmounted||He.isUnmounted||He.pendingId!==lt.suspenseId)return;lt.asyncResolved=!0;const{vnode:Ot}=lt;y0(lt,ai,!1),Ge&&(Ot.el=Ge);const jt=!Ge&&lt.subTree.el;kt(lt,Ot,We(Ge||lt.subTree.el),Ge?null:je(lt.subTree),He,B,Ne),jt&&pt(jt),_y(lt,Ot.el),ht&&--He.deps===0&&He.resolve()})},unmount(lt,kt){He.isUnmounted=!0,He.activeBranch&&Te(He.activeBranch,_,lt,kt),He.pendingBranch&&Te(He.pendingBranch,_,lt,kt)}};return He}function YM(a,h,_,w,M,D,B,q,o){const X=h.suspense=sT(h,w,_,a.parentNode,document.createElement("div"),null,M,D,B,q,!0),ie=o(a,X.pendingBranch=h.ssContent,_,X,D,B);return X.deps===0&&X.resolve(!1,!0),ie}function KM(a){const{shapeFlag:h,children:_}=a,w=h&32;a.ssContent=Fb(w?_.default:_),a.ssFallback=w?Fb(_.fallback):hr(an)}function Fb(a){let h;if(Hi(a)){const _=Vd&&a._c;_&&(a._d=!1,Di()),a=a(),_&&(a._d=!0,h=Yn,oT())}return Ei(a)&&(a=VM(a)),a=No(a),h&&!a.dynamicChildren&&(a.dynamicChildren=h.filter(_=>_!==a)),a}function nT(a,h){h&&h.pendingBranch?Ei(a)?h.effects.push(...a):h.effects.push(a):Ym(a)}function df(a,h){a.activeBranch=h;const{vnode:_,parentComponent:w}=a;let M=h.el;for(;!M&&h.component;)h=h.component.subTree,M=h.el;_.el=M,w&&w.subTree===_&&(w.vnode.el=M,_y(w,M))}function JM(a){const h=a.props&&a.props.suspensible;return h!=null&&h!==!1}const es=Symbol.for("v-fgt"),hu=Symbol.for("v-txt"),an=Symbol.for("v-cmt"),Ud=Symbol.for("v-stc"),jm=[];let Yn=null;function Di(a=!1){jm.push(Yn=a?null:[])}function oT(){jm.pop(),Yn=jm[jm.length-1]||null}let Vd=1;function m0(a,h=!1){Vd+=a,a<0&&Yn&&h&&(Yn.hasOnce=!0)}function aT(a){return a.dynamicChildren=Vd>0?Yn||af:null,oT(),Vd>0&&Yn&&Yn.push(a),a}function Yi(a,h,_,w,M,D){return aT(It(a,h,_,w,M,D,!0))}function ff(a,h,_,w,M){return aT(hr(a,h,_,w,M,!0))}function Kc(a){return a?a.__v_isVNode===!0:!1}function al(a,h){return a.type===h.type&&a.key===h.key}function QM(a){}const lT=({key:a})=>a??null,P_=({ref:a,ref_key:h,ref_for:_})=>(typeof a=="number"&&(a=""+a),a!=null?ms(a)||Os(a)||Hi(a)?{i:_n,r:a,k:h,f:!!_}:a:null);function It(a,h=null,_=null,w=0,M=null,D=a===es?0:1,B=!1,q=!1){const o={__v_isVNode:!0,__v_skip:!0,type:a,props:h,key:h&&lT(h),ref:h&&P_(h),scopeId:hy,slotScopeIds:null,children:_,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:D,patchFlag:w,dynamicProps:M,dynamicChildren:null,appContext:null,ctx:_n};return q?(ov(o,_),D&128&&a.normalize(o)):_&&(o.shapeFlag|=ms(_)?8:16),Vd>0&&!B&&Yn&&(o.patchFlag>0||D&6)&&o.patchFlag!==32&&Yn.push(o),o}const hr=eC;function eC(a,h=null,_=null,w=0,M=null,D=!1){if((!a||a===Dw)&&(a=an),Kc(a)){const q=ac(a,h,!0);return _&&ov(q,_),Vd>0&&!D&&Yn&&(q.shapeFlag&6?Yn[Yn.indexOf(a)]=q:Yn.push(q)),q.patchFlag=-2,q}if(aC(a)&&(a=a.__vccOpts),h){h=cT(h);let{class:q,style:o}=h;q&&!ms(q)&&(h.class=bf(q)),ts(o)&&(ly(o)&&!Ei(o)&&(o=as({},o)),h.style=Hd(o))}const B=ms(a)?1:$_(a)?128:yw(a)?64:ts(a)?4:Hi(a)?2:0;return It(a,h,_,w,M,B,D,!0)}function cT(a){return a?ly(a)||Uw(a)?as({},a):a:null}function ac(a,h,_=!1,w=!1){const{props:M,ref:D,patchFlag:B,children:q,transition:o}=a,X=h?hT(M||{},h):M,ie={__v_isVNode:!0,__v_skip:!0,type:a.type,props:X,key:X&&lT(X),ref:h&&h.ref?_&&D?Ei(D)?D.concat(P_(h)):[D,P_(h)]:P_(h):D,scopeId:a.scopeId,slotScopeIds:a.slotScopeIds,children:q,target:a.target,targetStart:a.targetStart,targetAnchor:a.targetAnchor,staticCount:a.staticCount,shapeFlag:a.shapeFlag,patchFlag:h&&a.type!==es?B===-1?16:B|16:B,dynamicProps:a.dynamicProps,dynamicChildren:a.dynamicChildren,appContext:a.appContext,dirs:a.dirs,transition:o,component:a.component,suspense:a.suspense,ssContent:a.ssContent&&ac(a.ssContent),ssFallback:a.ssFallback&&ac(a.ssFallback),el:a.el,anchor:a.anchor,ctx:a.ctx,ce:a.ce};return o&&w&&Yc(ie,o.clone(ie)),ie}function jo(a=" ",h=0){return hr(hu,null,a,h)}function yy(a,h){const _=hr(Ud,null,a);return _.staticCount=h,_}function ll(a="",h=!1){return h?(Di(),ff(an,null,a)):hr(an,null,a)}function No(a){return a==null||typeof a=="boolean"?hr(an):Ei(a)?hr(es,null,a.slice()):Kc(a)?au(a):hr(hu,null,String(a))}function au(a){return a.el===null&&a.patchFlag!==-1||a.memo?a:ac(a)}function ov(a,h){let _=0;const{shapeFlag:w}=a;if(h==null)h=null;else if(Ei(h))_=16;else if(typeof h=="object")if(w&65){const M=h.default;M&&(M._c&&(M._d=!1),ov(a,M()),M._c&&(M._d=!0));return}else{_=32;const M=h._;!M&&!Uw(h)?h._ctx=_n:M===3&&_n&&(_n.slots._===1?h._=1:(h._=2,a.patchFlag|=1024))}else Hi(h)?(h={default:h,_ctx:_n},_=32):(h=String(h),w&64?(_=16,h=[jo(h)]):_=8);a.children=h,a.shapeFlag|=_}function hT(...a){const h={};for(let _=0;_<a.length;_++){const w=a[_];for(const M in w)if(M==="class")h.class!==w.class&&(h.class=bf([h.class,w.class]));else if(M==="style")h.style=Hd([h.style,w.style]);else if(ng(M)){const D=h[M],B=w[M];B&&D!==B&&!(Ei(D)&&D.includes(B))&&(h[M]=D?[].concat(D,B):B)}else M!==""&&(h[M]=w[M])}return h}function Fo(a,h,_,w=null){Da(a,h,7,[_,w])}const tC=Ow();let iC=0;function uT(a,h,_){const w=a.type,M=(h?h.appContext:a.appContext)||tC,D={uid:iC++,vnode:a,type:w,parent:h,appContext:M,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new N0(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:h?h.provides:Object.create(M.provides),ids:h?h.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Vw(w,M),emitsOptions:rT(w,M),emit:null,emitted:null,propsDefaults:Ir,inheritAttrs:w.inheritAttrs,ctx:Ir,data:Ir,props:Ir,attrs:Ir,slots:Ir,refs:Ir,setupState:Ir,setupContext:null,suspense:_,suspenseId:_?_.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return D.ctx={_:D},D.root=h?h.root:D,D.emit=jM.bind(null,D),a.ce&&a.ce(D),D}let gn=null;const Ra=()=>gn||_n;let W_,g0;{const a=iy(),h=(_,w)=>{let M;return(M=a[_])||(M=a[_]=[]),M.push(w),D=>{M.length>1?M.forEach(B=>B(D)):M[0](D)}};W_=h("__VUE_INSTANCE_SETTERS__",_=>gn=_),g0=h("__VUE_SSR_SETTERS__",_=>mf=_)}const Gd=a=>{const h=gn;return W_(a),a.scope.on(),()=>{a.scope.off(),W_(h)}},_0=()=>{gn&&gn.scope.off(),W_(null)};function dT(a){return a.vnode.shapeFlag&4}let mf=!1;function pT(a,h=!1,_=!1){h&&g0(h);const{props:w,children:M}=a.vnode,D=dT(a);PM(a,w,D,h),RM(a,M,_);const B=D?rC(a,h):void 0;return h&&g0(!1),B}function rC(a,h){const _=a.type;a.accessCache=Object.create(null),a.proxy=new Proxy(a.ctx,h0);const{setup:w}=_;if(w){fu();const M=a.setupContext=w.length>1?mT(a):null,D=Gd(a),B=Tf(w,a,0,[a.props,M]),q=B0(B);if(mu(),D(),(q||a.sp)&&!cu(a)&&J0(a),q){if(B.then(_0,_0),h)return B.then(o=>{y0(a,o,h)}).catch(o=>{qd(o,a,0)});a.asyncDep=B}else y0(a,B,h)}else fT(a,h)}function y0(a,h,_){Hi(h)?a.type.__ssrInlineRender?a.ssrRender=h:a.render=h:ts(h)&&(a.setupState=X0(h)),fT(a,_)}let H_,x0;function sC(a){H_=a,x0=h=>{h.render._rc&&(h.withProxy=new Proxy(h.ctx,cM))}}const nC=()=>!H_;function fT(a,h,_){const w=a.type;if(!a.render){if(!h&&H_&&!w.render){const M=w.template||rv(a).template;if(M){const{isCustomElement:D,compilerOptions:B}=a.appContext.config,{delimiters:q,compilerOptions:o}=w,X=as(as({isCustomElement:D,delimiters:q},B),o);w.render=H_(M,X)}}a.render=w.render||Pa,x0&&x0(a)}{const M=Gd(a);fu();try{TM(a)}finally{mu(),M()}}}const oC={get(a,h){return qn(a,"get",""),a[h]}};function mT(a){const h=_=>{a.exposed=_||{}};return{attrs:new Proxy(a.attrs,oC),slots:a.slots,emit:a.emit,expose:h}}function cg(a){return a.exposed?a.exposeProxy||(a.exposeProxy=new Proxy(X0(cy(a.exposed)),{get(h,_){if(_ in h)return h[_];if(_ in Nm)return Nm[_](a)},has(h,_){return _ in h||_ in Nm}})):a.proxy}function v0(a,h=!0){return Hi(a)?a.displayName||a.name:a.name||h&&a.__name}function aC(a){return Hi(a)&&"__vccOpts"in a}const An=(a,h)=>bA(a,h,mf);function xy(a,h,_){const w=arguments.length;return w===2?ts(h)&&!Ei(h)?Kc(h)?hr(a,null,[h]):hr(a,h):hr(a,null,h):(w>3?_=Array.prototype.slice.call(arguments,2):w===3&&Kc(_)&&(_=[_]),hr(a,h,_))}function lC(){}function cC(a,h,_,w){const M=_[w];if(M&&gT(M,a))return M;const D=h();return D.memo=a.slice(),D.cacheIndex=w,_[w]=D}function gT(a,h){const _=a.memo;if(_.length!=h.length)return!1;for(let w=0;w<_.length;w++)if(go(_[w],h[w]))return!1;return Vd>0&&Yn&&Yn.push(a),!0}const _T="3.5.13",hC=Pa,uC=PA,dC=sf,pC=gw,fC={createComponentInstance:uT,setupComponent:pT,renderComponentRoot:k_,setCurrentRenderingInstance:Jm,isVNode:Kc,normalizeVNode:No,getComponentPublicInstance:cg,ensureValidVNode:iv,pushWarningContext:AA,popWarningContext:MA},mC=fC,gC=null,_C=null,yC=null;/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let b0;const Nb=typeof window<"u"&&window.trustedTypes;if(Nb)try{b0=Nb.createPolicy("vue",{createHTML:a=>a})}catch{}const yT=b0?a=>b0.createHTML(a):a=>a,xC="http://www.w3.org/2000/svg",vC="http://www.w3.org/1998/Math/MathML",Hc=typeof document<"u"?document:null,Ub=Hc&&Hc.createElement("template"),bC={insert:(a,h,_)=>{h.insertBefore(a,_||null)},remove:a=>{const h=a.parentNode;h&&h.removeChild(a)},createElement:(a,h,_,w)=>{const M=h==="svg"?Hc.createElementNS(xC,a):h==="mathml"?Hc.createElementNS(vC,a):_?Hc.createElement(a,{is:_}):Hc.createElement(a);return a==="select"&&w&&w.multiple!=null&&M.setAttribute("multiple",w.multiple),M},createText:a=>Hc.createTextNode(a),createComment:a=>Hc.createComment(a),setText:(a,h)=>{a.nodeValue=h},setElementText:(a,h)=>{a.textContent=h},parentNode:a=>a.parentNode,nextSibling:a=>a.nextSibling,querySelector:a=>Hc.querySelector(a),setScopeId(a,h){a.setAttribute(h,"")},insertStaticContent(a,h,_,w,M,D){const B=_?_.previousSibling:h.lastChild;if(M&&(M===D||M.nextSibling))for(;h.insertBefore(M.cloneNode(!0),_),!(M===D||!(M=M.nextSibling)););else{Ub.innerHTML=yT(w==="svg"?`<svg>${a}</svg>`:w==="mathml"?`<math>${a}</math>`:a);const q=Ub.content;if(w==="svg"||w==="mathml"){const o=q.firstChild;for(;o.firstChild;)q.appendChild(o.firstChild);q.removeChild(o)}h.insertBefore(q,_)}return[B?B.nextSibling:h.firstChild,_?_.previousSibling:h.lastChild]}},eu="transition",km="animation",gf=Symbol("_vtc"),xT={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},vT=as({},K0,xT),wC=a=>(a.displayName="Transition",a.props=vT,a),bT=wC((a,{slots:h})=>xy(Tw,wT(a),h)),Od=(a,h=[])=>{Ei(a)?a.forEach(_=>_(...h)):a&&a(...h)},jb=a=>a?Ei(a)?a.some(h=>h.length>1):a.length>1:!1;function wT(a){const h={};for(const Ot in a)Ot in xT||(h[Ot]=a[Ot]);if(a.css===!1)return h;const{name:_="v",type:w,duration:M,enterFromClass:D=`${_}-enter-from`,enterActiveClass:B=`${_}-enter-active`,enterToClass:q=`${_}-enter-to`,appearFromClass:o=D,appearActiveClass:X=B,appearToClass:ie=q,leaveFromClass:oe=`${_}-leave-from`,leaveActiveClass:xe=`${_}-leave-active`,leaveToClass:Te=`${_}-leave-to`}=a,je=TC(M),We=je&&je[0],pt=je&&je[1],{onBeforeEnter:yt,onEnter:Ze,onEnterCancelled:Ae,onLeave:Be,onLeaveCancelled:He,onBeforeAppear:lt=yt,onAppear:kt=Ze,onAppearCancelled:Ne=Ae}=h,ht=(Ot,jt,Ti,Qi)=>{Ot._enterCancelled=Qi,iu(Ot,jt?ie:q),iu(Ot,jt?X:B),Ti&&Ti()},Ge=(Ot,jt)=>{Ot._isLeaving=!1,iu(Ot,oe),iu(Ot,Te),iu(Ot,xe),jt&&jt()},ai=Ot=>(jt,Ti)=>{const Qi=Ot?kt:Ze,li=()=>ht(jt,Ot,Ti);Od(Qi,[jt,li]),Vb(()=>{iu(jt,Ot?o:D),ec(jt,Ot?ie:q),jb(Qi)||Gb(jt,w,We,li)})};return as(h,{onBeforeEnter(Ot){Od(yt,[Ot]),ec(Ot,D),ec(Ot,B)},onBeforeAppear(Ot){Od(lt,[Ot]),ec(Ot,o),ec(Ot,X)},onEnter:ai(!1),onAppear:ai(!0),onLeave(Ot,jt){Ot._isLeaving=!0;const Ti=()=>Ge(Ot,jt);ec(Ot,oe),Ot._enterCancelled?(ec(Ot,xe),w0()):(w0(),ec(Ot,xe)),Vb(()=>{Ot._isLeaving&&(iu(Ot,oe),ec(Ot,Te),jb(Be)||Gb(Ot,w,pt,Ti))}),Od(Be,[Ot,Ti])},onEnterCancelled(Ot){ht(Ot,!1,void 0,!0),Od(Ae,[Ot])},onAppearCancelled(Ot){ht(Ot,!0,void 0,!0),Od(Ne,[Ot])},onLeaveCancelled(Ot){Ge(Ot),Od(He,[Ot])}})}function TC(a){if(a==null)return null;if(ts(a))return[qx(a.enter),qx(a.leave)];{const h=qx(a);return[h,h]}}function qx(a){return O_(a)}function ec(a,h){h.split(/\s+/).forEach(_=>_&&a.classList.add(_)),(a[gf]||(a[gf]=new Set)).add(h)}function iu(a,h){h.split(/\s+/).forEach(w=>w&&a.classList.remove(w));const _=a[gf];_&&(_.delete(h),_.size||(a[gf]=void 0))}function Vb(a){requestAnimationFrame(()=>{requestAnimationFrame(a)})}let EC=0;function Gb(a,h,_,w){const M=a._endId=++EC,D=()=>{M===a._endId&&w()};if(_!=null)return setTimeout(D,_);const{type:B,timeout:q,propCount:o}=TT(a,h);if(!B)return w();const X=B+"end";let ie=0;const oe=()=>{a.removeEventListener(X,xe),D()},xe=Te=>{Te.target===a&&++ie>=o&&oe()};setTimeout(()=>{ie<o&&oe()},q+1),a.addEventListener(X,xe)}function TT(a,h){const _=window.getComputedStyle(a),w=je=>(_[je]||"").split(", "),M=w(`${eu}Delay`),D=w(`${eu}Duration`),B=$b(M,D),q=w(`${km}Delay`),o=w(`${km}Duration`),X=$b(q,o);let ie=null,oe=0,xe=0;h===eu?B>0&&(ie=eu,oe=B,xe=D.length):h===km?X>0&&(ie=km,oe=X,xe=o.length):(oe=Math.max(B,X),ie=oe>0?B>X?eu:km:null,xe=ie?ie===eu?D.length:o.length:0);const Te=ie===eu&&/\b(transform|all)(,|$)/.test(w(`${eu}Property`).toString());return{type:ie,timeout:oe,propCount:xe,hasTransform:Te}}function $b(a,h){for(;a.length<h.length;)a=a.concat(a);return Math.max(...h.map((_,w)=>Wb(_)+Wb(a[w])))}function Wb(a){return a==="auto"?0:Number(a.slice(0,-1).replace(",","."))*1e3}function w0(){return document.body.offsetHeight}function SC(a,h,_){const w=a[gf];w&&(h=(h?[h,...w]:[...w]).join(" ")),h==null?a.removeAttribute("class"):_?a.setAttribute("class",h):a.className=h}const q_=Symbol("_vod"),ET=Symbol("_vsh"),ST={beforeMount(a,{value:h},{transition:_}){a[q_]=a.style.display==="none"?"":a.style.display,_&&h?_.beforeEnter(a):Pm(a,h)},mounted(a,{value:h},{transition:_}){_&&h&&_.enter(a)},updated(a,{value:h,oldValue:_},{transition:w}){!h!=!_&&(w?h?(w.beforeEnter(a),Pm(a,!0),w.enter(a)):w.leave(a,()=>{Pm(a,!1)}):Pm(a,h))},beforeUnmount(a,{value:h}){Pm(a,h)}};function Pm(a,h){a.style.display=h?a[q_]:"none",a[ET]=!h}function AC(){ST.getSSRProps=({value:a})=>{if(!a)return{style:{display:"none"}}}}const AT=Symbol("");function MC(a){const h=Ra();if(!h)return;const _=h.ut=(M=a(h.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${h.uid}"]`)).forEach(D=>X_(D,M))},w=()=>{const M=a(h.proxy);h.ce?X_(h.ce,M):T0(h.subTree,M),_(M)};Q0(()=>{Ym(w)}),lc(()=>{ul(w,Pa,{flush:"post"});const M=new MutationObserver(w);M.observe(h.subTree.el.parentNode,{childList:!0}),my(()=>M.disconnect())})}function T0(a,h){if(a.shapeFlag&128){const _=a.suspense;a=_.activeBranch,_.pendingBranch&&!_.isHydrating&&_.effects.push(()=>{T0(_.activeBranch,h)})}for(;a.component;)a=a.component.subTree;if(a.shapeFlag&1&&a.el)X_(a.el,h);else if(a.type===es)a.children.forEach(_=>T0(_,h));else if(a.type===Ud){let{el:_,anchor:w}=a;for(;_&&(X_(_,h),_!==w);)_=_.nextSibling}}function X_(a,h){if(a.nodeType===1){const _=a.style;let w="";for(const M in h)_.setProperty(`--${M}`,h[M]),w+=`--${M}: ${h[M]};`;_[AT]=w}}const CC=/(^|;)\s*display\s*:/;function kC(a,h,_){const w=a.style,M=ms(_);let D=!1;if(_&&!M){if(h)if(ms(h))for(const B of h.split(";")){const q=B.slice(0,B.indexOf(":")).trim();_[q]==null&&I_(w,q,"")}else for(const B in h)_[B]==null&&I_(w,B,"");for(const B in _)B==="display"&&(D=!0),I_(w,B,_[B])}else if(M){if(h!==_){const B=w[AT];B&&(_+=";"+B),w.cssText=_,D=CC.test(_)}}else h&&a.removeAttribute("style");q_ in a&&(a[q_]=D?w.display:"",a[ET]&&(w.display="none"))}const Hb=/\s*!important$/;function I_(a,h,_){if(Ei(_))_.forEach(w=>I_(a,h,w));else if(_==null&&(_=""),h.startsWith("--"))a.setProperty(h,_);else{const w=PC(a,h);Hb.test(_)?a.setProperty(Uo(w),_.replace(Hb,""),"important"):a[w]=_}}const qb=["Webkit","Moz","ms"],Xx={};function PC(a,h){const _=Xx[h];if(_)return _;let w=In(h);if(w!=="filter"&&w in a)return Xx[h]=w;w=og(w);for(let M=0;M<qb.length;M++){const D=qb[M]+w;if(D in a)return Xx[h]=D}return h}const Xb="http://www.w3.org/1999/xlink";function Zb(a,h,_,w,M,D=VS(h)){w&&h.startsWith("xlink:")?_==null?a.removeAttributeNS(Xb,h.slice(6,h.length)):a.setAttributeNS(Xb,h,_):_==null||D&&!V1(_)?a.removeAttribute(h):a.setAttribute(h,D?"":dl(_)?String(_):_)}function Yb(a,h,_,w,M){if(h==="innerHTML"||h==="textContent"){_!=null&&(a[h]=h==="innerHTML"?yT(_):_);return}const D=a.tagName;if(h==="value"&&D!=="PROGRESS"&&!D.includes("-")){const q=D==="OPTION"?a.getAttribute("value")||"":a.value,o=_==null?a.type==="checkbox"?"on":"":String(_);(q!==o||!("_value"in a))&&(a.value=o),_==null&&a.removeAttribute(h),a._value=_;return}let B=!1;if(_===""||_==null){const q=typeof a[h];q==="boolean"?_=V1(_):_==null&&q==="string"?(_="",B=!0):q==="number"&&(_=0,B=!0)}try{a[h]=_}catch{}B&&a.removeAttribute(M||h)}function Zc(a,h,_,w){a.addEventListener(h,_,w)}function IC(a,h,_,w){a.removeEventListener(h,_,w)}const Kb=Symbol("_vei");function LC(a,h,_,w,M=null){const D=a[Kb]||(a[Kb]={}),B=D[h];if(w&&B)B.value=w;else{const[q,o]=DC(h);if(w){const X=D[h]=OC(w,M);Zc(a,q,X,o)}else B&&(IC(a,q,B,o),D[h]=void 0)}}const Jb=/(?:Once|Passive|Capture)$/;function DC(a){let h;if(Jb.test(a)){h={};let w;for(;w=a.match(Jb);)a=a.slice(0,a.length-w[0].length),h[w[0].toLowerCase()]=!0}return[a[2]===":"?a.slice(3):Uo(a.slice(2)),h]}let Zx=0;const RC=Promise.resolve(),zC=()=>Zx||(RC.then(()=>Zx=0),Zx=Date.now());function OC(a,h){const _=w=>{if(!w._vts)w._vts=Date.now();else if(w._vts<=_.attached)return;Da(BC(w,_.value),h,5,[w])};return _.value=a,_.attached=zC(),_}function BC(a,h){if(Ei(h)){const _=a.stopImmediatePropagation;return a.stopImmediatePropagation=()=>{_.call(a),a._stopped=!0},h.map(w=>M=>!M._stopped&&w&&w(M))}else return h}const Qb=a=>a.charCodeAt(0)===111&&a.charCodeAt(1)===110&&a.charCodeAt(2)>96&&a.charCodeAt(2)<123,FC=(a,h,_,w,M,D)=>{const B=M==="svg";h==="class"?SC(a,w,B):h==="style"?kC(a,_,w):ng(h)?z0(h)||LC(a,h,_,w,D):(h[0]==="."?(h=h.slice(1),!0):h[0]==="^"?(h=h.slice(1),!1):NC(a,h,w,B))?(Yb(a,h,w),!a.tagName.includes("-")&&(h==="value"||h==="checked"||h==="selected")&&Zb(a,h,w,B,D,h!=="value")):a._isVueCE&&(/[A-Z]/.test(h)||!ms(w))?Yb(a,In(h),w,D,h):(h==="true-value"?a._trueValue=w:h==="false-value"&&(a._falseValue=w),Zb(a,h,w,B))};function NC(a,h,_,w){if(w)return!!(h==="innerHTML"||h==="textContent"||h in a&&Qb(h)&&Hi(_));if(h==="spellcheck"||h==="draggable"||h==="translate"||h==="form"||h==="list"&&a.tagName==="INPUT"||h==="type"&&a.tagName==="TEXTAREA")return!1;if(h==="width"||h==="height"){const M=a.tagName;if(M==="IMG"||M==="VIDEO"||M==="CANVAS"||M==="SOURCE")return!1}return Qb(h)&&ms(_)?!1:h in a}const e1={};/*! #__NO_SIDE_EFFECTS__ */function MT(a,h,_){const w=ln(a,h);ey(w)&&as(w,h);class M extends vy{constructor(B){super(w,B,_)}}return M.def=w,M}/*! #__NO_SIDE_EFFECTS__ */const UC=(a,h)=>MT(a,h,NT),jC=typeof HTMLElement<"u"?HTMLElement:class{};class vy extends jC{constructor(h,_={},w=Y_){super(),this._def=h,this._props=_,this._createApp=w,this._isVueCE=!0,this._instance=null,this._app=null,this._nonce=this._def.nonce,this._connected=!1,this._resolved=!1,this._numberProps=null,this._styleChildren=new WeakSet,this._ob=null,this.shadowRoot&&w!==Y_?this._root=this.shadowRoot:h.shadowRoot!==!1?(this.attachShadow({mode:"open"}),this._root=this.shadowRoot):this._root=this,this._def.__asyncLoader||this._resolveProps(this._def)}connectedCallback(){if(!this.isConnected)return;this.shadowRoot||this._parseSlots(),this._connected=!0;let h=this;for(;h=h&&(h.parentNode||h.host);)if(h instanceof vy){this._parent=h;break}this._instance||(this._resolved?(this._setParent(),this._update()):h&&h._pendingResolve?this._pendingResolve=h._pendingResolve.then(()=>{this._pendingResolve=void 0,this._resolveDef()}):this._resolveDef())}_setParent(h=this._parent){h&&(this._instance.parent=h._instance,this._instance.provides=h._instance.provides)}disconnectedCallback(){this._connected=!1,Ef(()=>{this._connected||(this._ob&&(this._ob.disconnect(),this._ob=null),this._app&&this._app.unmount(),this._instance&&(this._instance.ce=void 0),this._app=this._instance=null)})}_resolveDef(){if(this._pendingResolve)return;for(let w=0;w<this.attributes.length;w++)this._setAttr(this.attributes[w].name);this._ob=new MutationObserver(w=>{for(const M of w)this._setAttr(M.attributeName)}),this._ob.observe(this,{attributes:!0});const h=(w,M=!1)=>{this._resolved=!0,this._pendingResolve=void 0;const{props:D,styles:B}=w;let q;if(D&&!Ei(D))for(const o in D){const X=D[o];(X===Number||X&&X.type===Number)&&(o in this._props&&(this._props[o]=O_(this._props[o])),(q||(q=Object.create(null)))[In(o)]=!0)}this._numberProps=q,M&&this._resolveProps(w),this.shadowRoot&&this._applyStyles(B),this._mount(w)},_=this._def.__asyncLoader;_?this._pendingResolve=_().then(w=>h(this._def=w,!0)):h(this._def)}_mount(h){this._app=this._createApp(h),h.configureApp&&h.configureApp(this._app),this._app._ceVNode=this._createVNode(),this._app.mount(this._root);const _=this._instance&&this._instance.exposed;if(_)for(const w in _)$r(this,w)||Object.defineProperty(this,w,{get:()=>oc(_[w])})}_resolveProps(h){const{props:_}=h,w=Ei(_)?_:Object.keys(_||{});for(const M of Object.keys(this))M[0]!=="_"&&w.includes(M)&&this._setProp(M,this[M]);for(const M of w.map(In))Object.defineProperty(this,M,{get(){return this._getProp(M)},set(D){this._setProp(M,D,!0,!0)}})}_setAttr(h){if(h.startsWith("data-v-"))return;const _=this.hasAttribute(h);let w=_?this.getAttribute(h):e1;const M=In(h);_&&this._numberProps&&this._numberProps[M]&&(w=O_(w)),this._setProp(M,w,!1,!0)}_getProp(h){return this._props[h]}_setProp(h,_,w=!0,M=!1){if(_!==this._props[h]&&(_===e1?delete this._props[h]:(this._props[h]=_,h==="key"&&this._app&&(this._app._ceVNode.key=_)),M&&this._instance&&this._update(),w)){const D=this._ob;D&&D.disconnect(),_===!0?this.setAttribute(Uo(h),""):typeof _=="string"||typeof _=="number"?this.setAttribute(Uo(h),_+""):_||this.removeAttribute(Uo(h)),D&&D.observe(this,{attributes:!0})}}_update(){FT(this._createVNode(),this._root)}_createVNode(){const h={};this.shadowRoot||(h.onVnodeMounted=h.onVnodeUpdated=this._renderSlots.bind(this));const _=hr(this._def,as(h,this._props));return this._instance||(_.ce=w=>{this._instance=w,w.ce=this,w.isCE=!0;const M=(D,B)=>{this.dispatchEvent(new CustomEvent(D,ey(B[0])?as({detail:B},B[0]):{detail:B}))};w.emit=(D,...B)=>{M(D,B),Uo(D)!==D&&M(Uo(D),B)},this._setParent()}),_}_applyStyles(h,_){if(!h)return;if(_){if(_===this._def||this._styleChildren.has(_))return;this._styleChildren.add(_)}const w=this._nonce;for(let M=h.length-1;M>=0;M--){const D=document.createElement("style");w&&D.setAttribute("nonce",w),D.textContent=h[M],this.shadowRoot.prepend(D)}}_parseSlots(){const h=this._slots={};let _;for(;_=this.firstChild;){const w=_.nodeType===1&&_.getAttribute("slot")||"default";(h[w]||(h[w]=[])).push(_),this.removeChild(_)}}_renderSlots(){const h=(this._teleportTarget||this).querySelectorAll("slot"),_=this._instance.type.__scopeId;for(let w=0;w<h.length;w++){const M=h[w],D=M.getAttribute("name")||"default",B=this._slots[D],q=M.parentNode;if(B)for(const o of B){if(_&&o.nodeType===1){const X=_+"-s",ie=document.createTreeWalker(o,1);o.setAttribute(X,"");let oe;for(;oe=ie.nextNode();)oe.setAttribute(X,"")}q.insertBefore(o,M)}else for(;M.firstChild;)q.insertBefore(M.firstChild,M);q.removeChild(M)}}_injectChildStyle(h){this._applyStyles(h.styles,h)}_removeChildStyle(h){}}function CT(a){const h=Ra(),_=h&&h.ce;return _||null}function VC(){const a=CT();return a&&a.shadowRoot}function GC(a="$style"){{const h=Ra();if(!h)return Ir;const _=h.type.__cssModules;if(!_)return Ir;const w=_[a];return w||Ir}}const kT=new WeakMap,PT=new WeakMap,Z_=Symbol("_moveCb"),t1=Symbol("_enterCb"),$C=a=>(delete a.props.mode,a),WC=$C({name:"TransitionGroup",props:as({},vT,{tag:String,moveClass:String}),setup(a,{slots:h}){const _=Ra(),w=Y0();let M,D;return py(()=>{if(!M.length)return;const B=a.moveClass||`${a.name||"v"}-move`;if(!YC(M[0].el,_.vnode.el,B))return;M.forEach(qC),M.forEach(XC);const q=M.filter(ZC);w0(),q.forEach(o=>{const X=o.el,ie=X.style;ec(X,B),ie.transform=ie.webkitTransform=ie.transitionDuration="";const oe=X[Z_]=xe=>{xe&&xe.target!==X||(!xe||/transform$/.test(xe.propertyName))&&(X.removeEventListener("transitionend",oe),X[Z_]=null,iu(X,B))};X.addEventListener("transitionend",oe)})}),()=>{const B=Pr(a),q=wT(B);let o=B.tag||es;if(M=[],D)for(let X=0;X<D.length;X++){const ie=D[X];ie.el&&ie.el instanceof Element&&(M.push(ie),Yc(ie,pf(ie,q,w,_)),kT.set(ie,ie.el.getBoundingClientRect()))}D=h.default?uy(h.default()):[];for(let X=0;X<D.length;X++){const ie=D[X];ie.key!=null&&Yc(ie,pf(ie,q,w,_))}return hr(o,null,D)}}}),HC=WC;function qC(a){const h=a.el;h[Z_]&&h[Z_](),h[t1]&&h[t1]()}function XC(a){PT.set(a,a.el.getBoundingClientRect())}function ZC(a){const h=kT.get(a),_=PT.get(a),w=h.left-_.left,M=h.top-_.top;if(w||M){const D=a.el.style;return D.transform=D.webkitTransform=`translate(${w}px,${M}px)`,D.transitionDuration="0s",a}}function YC(a,h,_){const w=a.cloneNode(),M=a[gf];M&&M.forEach(q=>{q.split(/\s+/).forEach(o=>o&&w.classList.remove(o))}),_.split(/\s+/).forEach(q=>q&&w.classList.add(q)),w.style.display="none";const D=h.nodeType===1?h:h.parentNode;D.appendChild(w);const{hasTransform:B}=TT(w);return D.removeChild(w),B}const pu=a=>{const h=a.props["onUpdate:modelValue"]||!1;return Ei(h)?_=>hf(h,_):h};function KC(a){a.target.composing=!0}function i1(a){const h=a.target;h.composing&&(h.composing=!1,h.dispatchEvent(new Event("input")))}const La=Symbol("_assign"),sc={created(a,{modifiers:{lazy:h,trim:_,number:w}},M){a[La]=pu(M);const D=w||M.props&&M.props.type==="number";Zc(a,h?"change":"input",B=>{if(B.target.composing)return;let q=a.value;_&&(q=q.trim()),D&&(q=z_(q)),a[La](q)}),_&&Zc(a,"change",()=>{a.value=a.value.trim()}),h||(Zc(a,"compositionstart",KC),Zc(a,"compositionend",i1),Zc(a,"change",i1))},mounted(a,{value:h}){a.value=h??""},beforeUpdate(a,{value:h,oldValue:_,modifiers:{lazy:w,trim:M,number:D}},B){if(a[La]=pu(B),a.composing)return;const q=(D||a.type==="number")&&!/^0\d/.test(a.value)?z_(a.value):a.value,o=h??"";q!==o&&(document.activeElement===a&&a.type!=="range"&&(w&&h===_||M&&a.value.trim()===o)||(a.value=o))}},av={deep:!0,created(a,h,_){a[La]=pu(_),Zc(a,"change",()=>{const w=a._modelValue,M=_f(a),D=a.checked,B=a[La];if(Ei(w)){const q=ry(w,M),o=q!==-1;if(D&&!o)B(w.concat(M));else if(!D&&o){const X=[...w];X.splice(q,1),B(X)}}else if(Wd(w)){const q=new Set(w);D?q.add(M):q.delete(M),B(q)}else B(IT(a,D))})},mounted:r1,beforeUpdate(a,h,_){a[La]=pu(_),r1(a,h,_)}};function r1(a,{value:h,oldValue:_},w){a._modelValue=h;let M;if(Ei(h))M=ry(h,w.props.value)>-1;else if(Wd(h))M=h.has(w.props.value);else{if(h===_)return;M=uu(h,IT(a,!0))}a.checked!==M&&(a.checked=M)}const lv={created(a,{value:h},_){a.checked=uu(h,_.props.value),a[La]=pu(_),Zc(a,"change",()=>{a[La](_f(a))})},beforeUpdate(a,{value:h,oldValue:_},w){a[La]=pu(w),h!==_&&(a.checked=uu(h,w.props.value))}},Vm={deep:!0,created(a,{value:h,modifiers:{number:_}},w){const M=Wd(h);Zc(a,"change",()=>{const D=Array.prototype.filter.call(a.options,B=>B.selected).map(B=>_?z_(_f(B)):_f(B));a[La](a.multiple?M?new Set(D):D:D[0]),a._assigning=!0,Ef(()=>{a._assigning=!1})}),a[La]=pu(w)},mounted(a,{value:h}){s1(a,h)},beforeUpdate(a,h,_){a[La]=pu(_)},updated(a,{value:h}){a._assigning||s1(a,h)}};function s1(a,h){const _=a.multiple,w=Ei(h);if(!(_&&!w&&!Wd(h))){for(let M=0,D=a.options.length;M<D;M++){const B=a.options[M],q=_f(B);if(_)if(w){const o=typeof q;o==="string"||o==="number"?B.selected=h.some(X=>String(X)===String(q)):B.selected=ry(h,q)>-1}else B.selected=h.has(q);else if(uu(_f(B),h)){a.selectedIndex!==M&&(a.selectedIndex=M);return}}!_&&a.selectedIndex!==-1&&(a.selectedIndex=-1)}}function _f(a){return"_value"in a?a._value:a.value}function IT(a,h){const _=h?"_trueValue":"_falseValue";return _ in a?a[_]:h}const LT={created(a,h,_){M_(a,h,_,null,"created")},mounted(a,h,_){M_(a,h,_,null,"mounted")},beforeUpdate(a,h,_,w){M_(a,h,_,w,"beforeUpdate")},updated(a,h,_,w){M_(a,h,_,w,"updated")}};function DT(a,h){switch(a){case"SELECT":return Vm;case"TEXTAREA":return sc;default:switch(h){case"checkbox":return av;case"radio":return lv;default:return sc}}}function M_(a,h,_,w,M){const B=DT(a.tagName,_.props&&_.props.type)[M];B&&B(a,h,_,w)}function JC(){sc.getSSRProps=({value:a})=>({value:a}),lv.getSSRProps=({value:a},h)=>{if(h.props&&uu(h.props.value,a))return{checked:!0}},av.getSSRProps=({value:a},h)=>{if(Ei(a)){if(h.props&&ry(a,h.props.value)>-1)return{checked:!0}}else if(Wd(a)){if(h.props&&a.has(h.props.value))return{checked:!0}}else if(a)return{checked:!0}},LT.getSSRProps=(a,h)=>{if(typeof h.type!="string")return;const _=DT(h.type.toUpperCase(),h.props&&h.props.type);if(_.getSSRProps)return _.getSSRProps(a,h)}}const QC=["ctrl","shift","alt","meta"],ek={stop:a=>a.stopPropagation(),prevent:a=>a.preventDefault(),self:a=>a.target!==a.currentTarget,ctrl:a=>!a.ctrlKey,shift:a=>!a.shiftKey,alt:a=>!a.altKey,meta:a=>!a.metaKey,left:a=>"button"in a&&a.button!==0,middle:a=>"button"in a&&a.button!==1,right:a=>"button"in a&&a.button!==2,exact:(a,h)=>QC.some(_=>a[`${_}Key`]&&!h.includes(_))},RT=(a,h)=>{const _=a._withMods||(a._withMods={}),w=h.join(".");return _[w]||(_[w]=(M,...D)=>{for(let B=0;B<h.length;B++){const q=ek[h[B]];if(q&&q(M,h))return}return a(M,...D)})},tk={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},ik=(a,h)=>{const _=a._withKeys||(a._withKeys={}),w=h.join(".");return _[w]||(_[w]=M=>{if(!("key"in M))return;const D=Uo(M.key);if(h.some(B=>B===D||tk[B]===D))return a(M)})},zT=as({patchProp:FC},bC);let Gm,n1=!1;function OT(){return Gm||(Gm=qw(zT))}function BT(){return Gm=n1?Gm:Xw(zT),n1=!0,Gm}const FT=(...a)=>{OT().render(...a)},rk=(...a)=>{BT().hydrate(...a)},Y_=(...a)=>{const h=OT().createApp(...a),{mount:_}=h;return h.mount=w=>{const M=jT(w);if(!M)return;const D=h._component;!Hi(D)&&!D.render&&!D.template&&(D.template=M.innerHTML),M.nodeType===1&&(M.textContent="");const B=_(M,!1,UT(M));return M instanceof Element&&(M.removeAttribute("v-cloak"),M.setAttribute("data-v-app","")),B},h},NT=(...a)=>{const h=BT().createApp(...a),{mount:_}=h;return h.mount=w=>{const M=jT(w);if(M)return _(M,!0,UT(M))},h};function UT(a){if(a instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&a instanceof MathMLElement)return"mathml"}function jT(a){return ms(a)?document.querySelector(a):a}let o1=!1;const sk=()=>{o1||(o1=!0,JC(),AC())};/**
* vue v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const nk=()=>{},ok=Object.freeze(Object.defineProperty({__proto__:null,BaseTransition:Tw,BaseTransitionPropsValidators:K0,Comment:an,DeprecationTypes:yC,EffectScope:N0,ErrorCodes:kA,ErrorTypeStrings:uC,Fragment:es,KeepAlive:tM,ReactiveEffect:qm,Static:Ud,Suspense:qM,Teleport:BA,Text:hu,TrackOpTypes:wA,Transition:bT,TransitionGroup:HC,TriggerOpTypes:TA,VueElement:vy,assertNumber:CA,callWithAsyncErrorHandling:Da,callWithErrorHandling:Tf,camelize:In,capitalize:og,cloneVNode:ac,compatUtils:_C,compile:nk,computed:An,createApp:Y_,createBlock:ff,createCommentVNode:ll,createElementBlock:Yi,createElementVNode:It,createHydrationRenderer:Xw,createPropsRestProxy:bM,createRenderer:qw,createSSRApp:NT,createSlots:oM,createStaticVNode:yy,createTextVNode:jo,createVNode:hr,customRef:lw,defineAsyncComponent:QA,defineComponent:ln,defineCustomElement:MT,defineEmits:uM,defineExpose:dM,defineModel:mM,defineOptions:pM,defineProps:hM,defineSSRCustomElement:UC,defineSlots:fM,devtools:dC,effect:WS,effectScope:U0,getCurrentInstance:Ra,getCurrentScope:j0,getCurrentWatcher:EA,getTransitionRawChildren:uy,guardReactiveProps:cT,h:xy,handleError:qd,hasInjectionContext:Bw,hydrate:rk,hydrateOnIdle:qA,hydrateOnInteraction:KA,hydrateOnMediaQuery:YA,hydrateOnVisible:ZA,initCustomFormatter:lC,initDirectivesForSSR:sk,inject:Ia,isMemoSame:gT,isProxy:ly,isReactive:nc,isReadonly:du,isRef:Os,isRuntimeOnly:nC,isShallow:ua,isVNode:Kc,markRaw:cy,mergeDefaults:xM,mergeModels:vM,mergeProps:hT,nextTick:Ef,normalizeClass:bf,normalizeProps:US,normalizeStyle:Hd,onActivated:Sw,onBeforeMount:Cw,onBeforeUnmount:fy,onBeforeUpdate:Q0,onDeactivated:Aw,onErrorCaptured:Lw,onMounted:lc,onRenderTracked:Iw,onRenderTriggered:Pw,onScopeDispose:W1,onServerPrefetch:kw,onUnmounted:my,onUpdated:py,onWatcherCleanup:uw,openBlock:Di,popScopeId:RA,provide:Um,proxyRefs:X0,pushScopeId:DA,queuePostFlushCb:Ym,reactive:wf,readonly:H0,ref:Kr,registerRuntimeCompiler:sC,render:FT,renderList:hl,renderSlot:aM,resolveComponent:j_,resolveDirective:nM,resolveDynamicComponent:sM,resolveFilter:gC,resolveTransitionHooks:pf,setBlockTracking:m0,setDevtoolsHook:pC,setTransitionHooks:Yc,shallowReactive:W0,shallowReadonly:uA,shallowRef:q0,ssrContextKey:Jw,ssrUtils:mC,stop:HS,toDisplayString:zs,toHandlerKey:zm,toHandlers:lM,toRaw:Pr,toRef:xA,toRefs:cw,toValue:fA,transformVNodeArgs:QM,triggerRef:pA,unref:oc,useAttrs:yM,useCssModule:GC,useCssVars:MC,useHost:CT,useId:NA,useModel:UM,useSSRContext:Qw,useShadowRoot:VC,useSlots:_M,useTemplateRef:UA,useTransitionState:Y0,vModelCheckbox:av,vModelDynamic:LT,vModelRadio:lv,vModelSelect:Vm,vModelText:sc,vShow:ST,version:_T,warn:hC,watch:ul,watchEffect:BM,watchPostEffect:FM,watchSyncEffect:eT,withAsyncContext:wM,withCtx:ol,withDefaults:gM,withDirectives:rc,withKeys:ik,withMemo:cC,withModifiers:RT,withScopeId:zA},Symbol.toStringTag,{value:"Module"})),VT="/projects/soil_values/assets/DGIS_logo-BMUz1Rxj.webp",GT="/projects/soil_values/assets/logo-CicDM-h9.png";/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const nf=typeof document<"u";function $T(a){return typeof a=="object"||"displayName"in a||"props"in a||"__vccOpts"in a}function ak(a){return a.__esModule||a[Symbol.toStringTag]==="Module"||a.default&&$T(a.default)}const Xr=Object.assign;function Yx(a,h){const _={};for(const w in h){const M=h[w];_[w]=pl(M)?M.map(a):a(M)}return _}const $m=()=>{},pl=Array.isArray,WT=/#/g,lk=/&/g,ck=/\//g,hk=/=/g,uk=/\?/g,HT=/\+/g,dk=/%5B/g,pk=/%5D/g,qT=/%5E/g,fk=/%60/g,XT=/%7B/g,mk=/%7C/g,ZT=/%7D/g,gk=/%20/g;function cv(a){return encodeURI(""+a).replace(mk,"|").replace(dk,"[").replace(pk,"]")}function _k(a){return cv(a).replace(XT,"{").replace(ZT,"}").replace(qT,"^")}function E0(a){return cv(a).replace(HT,"%2B").replace(gk,"+").replace(WT,"%23").replace(lk,"%26").replace(fk,"`").replace(XT,"{").replace(ZT,"}").replace(qT,"^")}function yk(a){return E0(a).replace(hk,"%3D")}function xk(a){return cv(a).replace(WT,"%23").replace(uk,"%3F")}function vk(a){return a==null?"":xk(a).replace(ck,"%2F")}function ig(a){try{return decodeURIComponent(""+a)}catch{}return""+a}const bk=/\/$/,wk=a=>a.replace(bk,"");function Kx(a,h,_="/"){let w,M={},D="",B="";const q=h.indexOf("#");let o=h.indexOf("?");return q<o&&q>=0&&(o=-1),o>-1&&(w=h.slice(0,o),D=h.slice(o+1,q>-1?q:h.length),M=a(D)),q>-1&&(w=w||h.slice(0,q),B=h.slice(q,h.length)),w=Ak(w??h,_),{fullPath:w+(D&&"?")+D+B,path:w,query:M,hash:ig(B)}}function Tk(a,h){const _=h.query?a(h.query):"";return h.path+(_&&"?")+_+(h.hash||"")}function a1(a,h){return!h||!a.toLowerCase().startsWith(h.toLowerCase())?a:a.slice(h.length)||"/"}function Ek(a,h,_){const w=h.matched.length-1,M=_.matched.length-1;return w>-1&&w===M&&yf(h.matched[w],_.matched[M])&&YT(h.params,_.params)&&a(h.query)===a(_.query)&&h.hash===_.hash}function yf(a,h){return(a.aliasOf||a)===(h.aliasOf||h)}function YT(a,h){if(Object.keys(a).length!==Object.keys(h).length)return!1;for(const _ in a)if(!Sk(a[_],h[_]))return!1;return!0}function Sk(a,h){return pl(a)?l1(a,h):pl(h)?l1(h,a):a===h}function l1(a,h){return pl(h)?a.length===h.length&&a.every((_,w)=>_===h[w]):a.length===1&&a[0]===h}function Ak(a,h){if(a.startsWith("/"))return a;if(!a)return h;const _=h.split("/"),w=a.split("/"),M=w[w.length-1];(M===".."||M===".")&&w.push("");let D=_.length-1,B,q;for(B=0;B<w.length;B++)if(q=w[B],q!==".")if(q==="..")D>1&&D--;else break;return _.slice(0,D).join("/")+"/"+w.slice(B).join("/")}const tu={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var rg;(function(a){a.pop="pop",a.push="push"})(rg||(rg={}));var Wm;(function(a){a.back="back",a.forward="forward",a.unknown=""})(Wm||(Wm={}));function Mk(a){if(!a)if(nf){const h=document.querySelector("base");a=h&&h.getAttribute("href")||"/",a=a.replace(/^\w+:\/\/[^\/]+/,"")}else a="/";return a[0]!=="/"&&a[0]!=="#"&&(a="/"+a),wk(a)}const Ck=/^[^#]+#/;function kk(a,h){return a.replace(Ck,"#")+h}function Pk(a,h){const _=document.documentElement.getBoundingClientRect(),w=a.getBoundingClientRect();return{behavior:h.behavior,left:w.left-_.left-(h.left||0),top:w.top-_.top-(h.top||0)}}const by=()=>({left:window.scrollX,top:window.scrollY});function Ik(a){let h;if("el"in a){const _=a.el,w=typeof _=="string"&&_.startsWith("#"),M=typeof _=="string"?w?document.getElementById(_.slice(1)):document.querySelector(_):_;if(!M)return;h=Pk(M,a)}else h=a;"scrollBehavior"in document.documentElement.style?window.scrollTo(h):window.scrollTo(h.left!=null?h.left:window.scrollX,h.top!=null?h.top:window.scrollY)}function c1(a,h){return(history.state?history.state.position-h:-1)+a}const S0=new Map;function Lk(a,h){S0.set(a,h)}function Dk(a){const h=S0.get(a);return S0.delete(a),h}let Rk=()=>location.protocol+"//"+location.host;function KT(a,h){const{pathname:_,search:w,hash:M}=h,D=a.indexOf("#");if(D>-1){let q=M.includes(a.slice(D))?a.slice(D).length:1,o=M.slice(q);return o[0]!=="/"&&(o="/"+o),a1(o,"")}return a1(_,a)+w+M}function zk(a,h,_,w){let M=[],D=[],B=null;const q=({state:xe})=>{const Te=KT(a,location),je=_.value,We=h.value;let pt=0;if(xe){if(_.value=Te,h.value=xe,B&&B===je){B=null;return}pt=We?xe.position-We.position:0}else w(Te);M.forEach(yt=>{yt(_.value,je,{delta:pt,type:rg.pop,direction:pt?pt>0?Wm.forward:Wm.back:Wm.unknown})})};function o(){B=_.value}function X(xe){M.push(xe);const Te=()=>{const je=M.indexOf(xe);je>-1&&M.splice(je,1)};return D.push(Te),Te}function ie(){const{history:xe}=window;xe.state&&xe.replaceState(Xr({},xe.state,{scroll:by()}),"")}function oe(){for(const xe of D)xe();D=[],window.removeEventListener("popstate",q),window.removeEventListener("beforeunload",ie)}return window.addEventListener("popstate",q),window.addEventListener("beforeunload",ie,{passive:!0}),{pauseListeners:o,listen:X,destroy:oe}}function h1(a,h,_,w=!1,M=!1){return{back:a,current:h,forward:_,replaced:w,position:window.history.length,scroll:M?by():null}}function Ok(a){const{history:h,location:_}=window,w={value:KT(a,_)},M={value:h.state};M.value||D(w.value,{back:null,current:w.value,forward:null,position:h.length-1,replaced:!0,scroll:null},!0);function D(o,X,ie){const oe=a.indexOf("#"),xe=oe>-1?(_.host&&document.querySelector("base")?a:a.slice(oe))+o:Rk()+a+o;try{h[ie?"replaceState":"pushState"](X,"",xe),M.value=X}catch(Te){console.error(Te),_[ie?"replace":"assign"](xe)}}function B(o,X){const ie=Xr({},h.state,h1(M.value.back,o,M.value.forward,!0),X,{position:M.value.position});D(o,ie,!0),w.value=o}function q(o,X){const ie=Xr({},M.value,h.state,{forward:o,scroll:by()});D(ie.current,ie,!0);const oe=Xr({},h1(w.value,o,null),{position:ie.position+1},X);D(o,oe,!1),w.value=o}return{location:w,state:M,push:q,replace:B}}function Bk(a){a=Mk(a);const h=Ok(a),_=zk(a,h.state,h.location,h.replace);function w(D,B=!0){B||_.pauseListeners(),history.go(D)}const M=Xr({location:"",base:a,go:w,createHref:kk.bind(null,a)},h,_);return Object.defineProperty(M,"location",{enumerable:!0,get:()=>h.location.value}),Object.defineProperty(M,"state",{enumerable:!0,get:()=>h.state.value}),M}function Fk(a){return typeof a=="string"||a&&typeof a=="object"}function JT(a){return typeof a=="string"||typeof a=="symbol"}const QT=Symbol("");var u1;(function(a){a[a.aborted=4]="aborted",a[a.cancelled=8]="cancelled",a[a.duplicated=16]="duplicated"})(u1||(u1={}));function xf(a,h){return Xr(new Error,{type:a,[QT]:!0},h)}function Wc(a,h){return a instanceof Error&&QT in a&&(h==null||!!(a.type&h))}const d1="[^/]+?",Nk={sensitive:!1,strict:!1,start:!0,end:!0},Uk=/[.+*?^${}()[\]/\\]/g;function jk(a,h){const _=Xr({},Nk,h),w=[];let M=_.start?"^":"";const D=[];for(const X of a){const ie=X.length?[]:[90];_.strict&&!X.length&&(M+="/");for(let oe=0;oe<X.length;oe++){const xe=X[oe];let Te=40+(_.sensitive?.25:0);if(xe.type===0)oe||(M+="/"),M+=xe.value.replace(Uk,"\\$&"),Te+=40;else if(xe.type===1){const{value:je,repeatable:We,optional:pt,regexp:yt}=xe;D.push({name:je,repeatable:We,optional:pt});const Ze=yt||d1;if(Ze!==d1){Te+=10;try{new RegExp(`(${Ze})`)}catch(Be){throw new Error(`Invalid custom RegExp for param "${je}" (${Ze}): `+Be.message)}}let Ae=We?`((?:${Ze})(?:/(?:${Ze}))*)`:`(${Ze})`;oe||(Ae=pt&&X.length<2?`(?:/${Ae})`:"/"+Ae),pt&&(Ae+="?"),M+=Ae,Te+=20,pt&&(Te+=-8),We&&(Te+=-20),Ze===".*"&&(Te+=-50)}ie.push(Te)}w.push(ie)}if(_.strict&&_.end){const X=w.length-1;w[X][w[X].length-1]+=.7000000000000001}_.strict||(M+="/?"),_.end?M+="$":_.strict&&!M.endsWith("/")&&(M+="(?:/|$)");const B=new RegExp(M,_.sensitive?"":"i");function q(X){const ie=X.match(B),oe={};if(!ie)return null;for(let xe=1;xe<ie.length;xe++){const Te=ie[xe]||"",je=D[xe-1];oe[je.name]=Te&&je.repeatable?Te.split("/"):Te}return oe}function o(X){let ie="",oe=!1;for(const xe of a){(!oe||!ie.endsWith("/"))&&(ie+="/"),oe=!1;for(const Te of xe)if(Te.type===0)ie+=Te.value;else if(Te.type===1){const{value:je,repeatable:We,optional:pt}=Te,yt=je in X?X[je]:"";if(pl(yt)&&!We)throw new Error(`Provided param "${je}" is an array but it is not repeatable (* or + modifiers)`);const Ze=pl(yt)?yt.join("/"):yt;if(!Ze)if(pt)xe.length<2&&(ie.endsWith("/")?ie=ie.slice(0,-1):oe=!0);else throw new Error(`Missing required param "${je}"`);ie+=Ze}}return ie||"/"}return{re:B,score:w,keys:D,parse:q,stringify:o}}function Vk(a,h){let _=0;for(;_<a.length&&_<h.length;){const w=h[_]-a[_];if(w)return w;_++}return a.length<h.length?a.length===1&&a[0]===80?-1:1:a.length>h.length?h.length===1&&h[0]===80?1:-1:0}function eE(a,h){let _=0;const w=a.score,M=h.score;for(;_<w.length&&_<M.length;){const D=Vk(w[_],M[_]);if(D)return D;_++}if(Math.abs(M.length-w.length)===1){if(p1(w))return 1;if(p1(M))return-1}return M.length-w.length}function p1(a){const h=a[a.length-1];return a.length>0&&h[h.length-1]<0}const Gk={type:0,value:""},$k=/[a-zA-Z0-9_]/;function Wk(a){if(!a)return[[]];if(a==="/")return[[Gk]];if(!a.startsWith("/"))throw new Error(`Invalid path "${a}"`);function h(Te){throw new Error(`ERR (${_})/"${X}": ${Te}`)}let _=0,w=_;const M=[];let D;function B(){D&&M.push(D),D=[]}let q=0,o,X="",ie="";function oe(){X&&(_===0?D.push({type:0,value:X}):_===1||_===2||_===3?(D.length>1&&(o==="*"||o==="+")&&h(`A repeatable param (${X}) must be alone in its segment. eg: '/:ids+.`),D.push({type:1,value:X,regexp:ie,repeatable:o==="*"||o==="+",optional:o==="*"||o==="?"})):h("Invalid state to consume buffer"),X="")}function xe(){X+=o}for(;q<a.length;){if(o=a[q++],o==="\\"&&_!==2){w=_,_=4;continue}switch(_){case 0:o==="/"?(X&&oe(),B()):o===":"?(oe(),_=1):xe();break;case 4:xe(),_=w;break;case 1:o==="("?_=2:$k.test(o)?xe():(oe(),_=0,o!=="*"&&o!=="?"&&o!=="+"&&q--);break;case 2:o===")"?ie[ie.length-1]=="\\"?ie=ie.slice(0,-1)+o:_=3:ie+=o;break;case 3:oe(),_=0,o!=="*"&&o!=="?"&&o!=="+"&&q--,ie="";break;default:h("Unknown state");break}}return _===2&&h(`Unfinished custom RegExp for param "${X}"`),oe(),B(),M}function Hk(a,h,_){const w=jk(Wk(a.path),_),M=Xr(w,{record:a,parent:h,children:[],alias:[]});return h&&!M.record.aliasOf==!h.record.aliasOf&&h.children.push(M),M}function qk(a,h){const _=[],w=new Map;h=_1({strict:!1,end:!0,sensitive:!1},h);function M(oe){return w.get(oe)}function D(oe,xe,Te){const je=!Te,We=m1(oe);We.aliasOf=Te&&Te.record;const pt=_1(h,oe),yt=[We];if("alias"in oe){const Be=typeof oe.alias=="string"?[oe.alias]:oe.alias;for(const He of Be)yt.push(m1(Xr({},We,{components:Te?Te.record.components:We.components,path:He,aliasOf:Te?Te.record:We})))}let Ze,Ae;for(const Be of yt){const{path:He}=Be;if(xe&&He[0]!=="/"){const lt=xe.record.path,kt=lt[lt.length-1]==="/"?"":"/";Be.path=xe.record.path+(He&&kt+He)}if(Ze=Hk(Be,xe,pt),Te?Te.alias.push(Ze):(Ae=Ae||Ze,Ae!==Ze&&Ae.alias.push(Ze),je&&oe.name&&!g1(Ze)&&B(oe.name)),tE(Ze)&&o(Ze),We.children){const lt=We.children;for(let kt=0;kt<lt.length;kt++)D(lt[kt],Ze,Te&&Te.children[kt])}Te=Te||Ze}return Ae?()=>{B(Ae)}:$m}function B(oe){if(JT(oe)){const xe=w.get(oe);xe&&(w.delete(oe),_.splice(_.indexOf(xe),1),xe.children.forEach(B),xe.alias.forEach(B))}else{const xe=_.indexOf(oe);xe>-1&&(_.splice(xe,1),oe.record.name&&w.delete(oe.record.name),oe.children.forEach(B),oe.alias.forEach(B))}}function q(){return _}function o(oe){const xe=Yk(oe,_);_.splice(xe,0,oe),oe.record.name&&!g1(oe)&&w.set(oe.record.name,oe)}function X(oe,xe){let Te,je={},We,pt;if("name"in oe&&oe.name){if(Te=w.get(oe.name),!Te)throw xf(1,{location:oe});pt=Te.record.name,je=Xr(f1(xe.params,Te.keys.filter(Ae=>!Ae.optional).concat(Te.parent?Te.parent.keys.filter(Ae=>Ae.optional):[]).map(Ae=>Ae.name)),oe.params&&f1(oe.params,Te.keys.map(Ae=>Ae.name))),We=Te.stringify(je)}else if(oe.path!=null)We=oe.path,Te=_.find(Ae=>Ae.re.test(We)),Te&&(je=Te.parse(We),pt=Te.record.name);else{if(Te=xe.name?w.get(xe.name):_.find(Ae=>Ae.re.test(xe.path)),!Te)throw xf(1,{location:oe,currentLocation:xe});pt=Te.record.name,je=Xr({},xe.params,oe.params),We=Te.stringify(je)}const yt=[];let Ze=Te;for(;Ze;)yt.unshift(Ze.record),Ze=Ze.parent;return{name:pt,path:We,params:je,matched:yt,meta:Zk(yt)}}a.forEach(oe=>D(oe));function ie(){_.length=0,w.clear()}return{addRoute:D,resolve:X,removeRoute:B,clearRoutes:ie,getRoutes:q,getRecordMatcher:M}}function f1(a,h){const _={};for(const w of h)w in a&&(_[w]=a[w]);return _}function m1(a){const h={path:a.path,redirect:a.redirect,name:a.name,meta:a.meta||{},aliasOf:a.aliasOf,beforeEnter:a.beforeEnter,props:Xk(a),children:a.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in a?a.components||null:a.component&&{default:a.component}};return Object.defineProperty(h,"mods",{value:{}}),h}function Xk(a){const h={},_=a.props||!1;if("component"in a)h.default=_;else for(const w in a.components)h[w]=typeof _=="object"?_[w]:_;return h}function g1(a){for(;a;){if(a.record.aliasOf)return!0;a=a.parent}return!1}function Zk(a){return a.reduce((h,_)=>Xr(h,_.meta),{})}function _1(a,h){const _={};for(const w in a)_[w]=w in h?h[w]:a[w];return _}function Yk(a,h){let _=0,w=h.length;for(;_!==w;){const D=_+w>>1;eE(a,h[D])<0?w=D:_=D+1}const M=Kk(a);return M&&(w=h.lastIndexOf(M,w-1)),w}function Kk(a){let h=a;for(;h=h.parent;)if(tE(h)&&eE(a,h)===0)return h}function tE({record:a}){return!!(a.name||a.components&&Object.keys(a.components).length||a.redirect)}function Jk(a){const h={};if(a===""||a==="?")return h;const w=(a[0]==="?"?a.slice(1):a).split("&");for(let M=0;M<w.length;++M){const D=w[M].replace(HT," "),B=D.indexOf("="),q=ig(B<0?D:D.slice(0,B)),o=B<0?null:ig(D.slice(B+1));if(q in h){let X=h[q];pl(X)||(X=h[q]=[X]),X.push(o)}else h[q]=o}return h}function y1(a){let h="";for(let _ in a){const w=a[_];if(_=yk(_),w==null){w!==void 0&&(h+=(h.length?"&":"")+_);continue}(pl(w)?w.map(D=>D&&E0(D)):[w&&E0(w)]).forEach(D=>{D!==void 0&&(h+=(h.length?"&":"")+_,D!=null&&(h+="="+D))})}return h}function Qk(a){const h={};for(const _ in a){const w=a[_];w!==void 0&&(h[_]=pl(w)?w.map(M=>M==null?null:""+M):w==null?w:""+w)}return h}const eP=Symbol(""),x1=Symbol(""),hv=Symbol(""),uv=Symbol(""),A0=Symbol("");function Im(){let a=[];function h(w){return a.push(w),()=>{const M=a.indexOf(w);M>-1&&a.splice(M,1)}}function _(){a=[]}return{add:h,list:()=>a.slice(),reset:_}}function lu(a,h,_,w,M,D=B=>B()){const B=w&&(w.enterCallbacks[M]=w.enterCallbacks[M]||[]);return()=>new Promise((q,o)=>{const X=xe=>{xe===!1?o(xf(4,{from:_,to:h})):xe instanceof Error?o(xe):Fk(xe)?o(xf(2,{from:h,to:xe})):(B&&w.enterCallbacks[M]===B&&typeof xe=="function"&&B.push(xe),q())},ie=D(()=>a.call(w&&w.instances[M],h,_,X));let oe=Promise.resolve(ie);a.length<3&&(oe=oe.then(X)),oe.catch(xe=>o(xe))})}function Jx(a,h,_,w,M=D=>D()){const D=[];for(const B of a)for(const q in B.components){let o=B.components[q];if(!(h!=="beforeRouteEnter"&&!B.instances[q]))if($T(o)){const ie=(o.__vccOpts||o)[h];ie&&D.push(lu(ie,_,w,B,q,M))}else{let X=o();D.push(()=>X.then(ie=>{if(!ie)throw new Error(`Couldn't resolve component "${q}" at "${B.path}"`);const oe=ak(ie)?ie.default:ie;B.mods[q]=ie,B.components[q]=oe;const Te=(oe.__vccOpts||oe)[h];return Te&&lu(Te,_,w,B,q,M)()}))}}return D}function v1(a){const h=Ia(hv),_=Ia(uv),w=An(()=>{const o=oc(a.to);return h.resolve(o)}),M=An(()=>{const{matched:o}=w.value,{length:X}=o,ie=o[X-1],oe=_.matched;if(!ie||!oe.length)return-1;const xe=oe.findIndex(yf.bind(null,ie));if(xe>-1)return xe;const Te=b1(o[X-2]);return X>1&&b1(ie)===Te&&oe[oe.length-1].path!==Te?oe.findIndex(yf.bind(null,o[X-2])):xe}),D=An(()=>M.value>-1&&nP(_.params,w.value.params)),B=An(()=>M.value>-1&&M.value===_.matched.length-1&&YT(_.params,w.value.params));function q(o={}){if(sP(o)){const X=h[oc(a.replace)?"replace":"push"](oc(a.to)).catch($m);return a.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>X),X}return Promise.resolve()}return{route:w,href:An(()=>w.value.href),isActive:D,isExactActive:B,navigate:q}}function tP(a){return a.length===1?a[0]:a}const iP=ln({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:v1,setup(a,{slots:h}){const _=wf(v1(a)),{options:w}=Ia(hv),M=An(()=>({[w1(a.activeClass,w.linkActiveClass,"router-link-active")]:_.isActive,[w1(a.exactActiveClass,w.linkExactActiveClass,"router-link-exact-active")]:_.isExactActive}));return()=>{const D=h.default&&tP(h.default(_));return a.custom?D:xy("a",{"aria-current":_.isExactActive?a.ariaCurrentValue:null,href:_.href,onClick:_.navigate,class:M.value},D)}}}),rP=iP;function sP(a){if(!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)&&!a.defaultPrevented&&!(a.button!==void 0&&a.button!==0)){if(a.currentTarget&&a.currentTarget.getAttribute){const h=a.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(h))return}return a.preventDefault&&a.preventDefault(),!0}}function nP(a,h){for(const _ in h){const w=h[_],M=a[_];if(typeof w=="string"){if(w!==M)return!1}else if(!pl(M)||M.length!==w.length||w.some((D,B)=>D!==M[B]))return!1}return!0}function b1(a){return a?a.aliasOf?a.aliasOf.path:a.path:""}const w1=(a,h,_)=>a??h??_,oP=ln({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(a,{attrs:h,slots:_}){const w=Ia(A0),M=An(()=>a.route||w.value),D=Ia(x1,0),B=An(()=>{let X=oc(D);const{matched:ie}=M.value;let oe;for(;(oe=ie[X])&&!oe.components;)X++;return X}),q=An(()=>M.value.matched[B.value]);Um(x1,An(()=>B.value+1)),Um(eP,q),Um(A0,M);const o=Kr();return ul(()=>[o.value,q.value,a.name],([X,ie,oe],[xe,Te,je])=>{ie&&(ie.instances[oe]=X,Te&&Te!==ie&&X&&X===xe&&(ie.leaveGuards.size||(ie.leaveGuards=Te.leaveGuards),ie.updateGuards.size||(ie.updateGuards=Te.updateGuards))),X&&ie&&(!Te||!yf(ie,Te)||!xe)&&(ie.enterCallbacks[oe]||[]).forEach(We=>We(X))},{flush:"post"}),()=>{const X=M.value,ie=a.name,oe=q.value,xe=oe&&oe.components[ie];if(!xe)return T1(_.default,{Component:xe,route:X});const Te=oe.props[ie],je=Te?Te===!0?X.params:typeof Te=="function"?Te(X):Te:null,pt=xy(xe,Xr({},je,h,{onVnodeUnmounted:yt=>{yt.component.isUnmounted&&(oe.instances[ie]=null)},ref:o}));return T1(_.default,{Component:pt,route:X})||pt}}});function T1(a,h){if(!a)return null;const _=a(h);return _.length===1?_[0]:_}const aP=oP;function lP(a){const h=qk(a.routes,a),_=a.parseQuery||Jk,w=a.stringifyQuery||y1,M=a.history,D=Im(),B=Im(),q=Im(),o=q0(tu);let X=tu;nf&&a.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const ie=Yx.bind(null,St=>""+St),oe=Yx.bind(null,vk),xe=Yx.bind(null,ig);function Te(St,ci){let ri,fi;return JT(St)?(ri=h.getRecordMatcher(St),fi=ci):fi=St,h.addRoute(fi,ri)}function je(St){const ci=h.getRecordMatcher(St);ci&&h.removeRoute(ci)}function We(){return h.getRoutes().map(St=>St.record)}function pt(St){return!!h.getRecordMatcher(St)}function yt(St,ci){if(ci=Xr({},ci||o.value),typeof St=="string"){const Ce=Kx(_,St,ci.path),ct=h.resolve({path:Ce.path},ci),Tt=M.createHref(Ce.fullPath);return Xr(Ce,ct,{params:xe(ct.params),hash:ig(Ce.hash),redirectedFrom:void 0,href:Tt})}let ri;if(St.path!=null)ri=Xr({},St,{path:Kx(_,St.path,ci.path).path});else{const Ce=Xr({},St.params);for(const ct in Ce)Ce[ct]==null&&delete Ce[ct];ri=Xr({},St,{params:oe(Ce)}),ci.params=oe(ci.params)}const fi=h.resolve(ri,ci),rr=St.hash||"";fi.params=ie(xe(fi.params));const gi=Tk(w,Xr({},St,{hash:_k(rr),path:fi.path})),me=M.createHref(gi);return Xr({fullPath:gi,hash:rr,query:w===y1?Qk(St.query):St.query||{}},fi,{redirectedFrom:void 0,href:me})}function Ze(St){return typeof St=="string"?Kx(_,St,o.value.path):Xr({},St)}function Ae(St,ci){if(X!==St)return xf(8,{from:ci,to:St})}function Be(St){return kt(St)}function He(St){return Be(Xr(Ze(St),{replace:!0}))}function lt(St){const ci=St.matched[St.matched.length-1];if(ci&&ci.redirect){const{redirect:ri}=ci;let fi=typeof ri=="function"?ri(St):ri;return typeof fi=="string"&&(fi=fi.includes("?")||fi.includes("#")?fi=Ze(fi):{path:fi},fi.params={}),Xr({query:St.query,hash:St.hash,params:fi.path!=null?{}:St.params},fi)}}function kt(St,ci){const ri=X=yt(St),fi=o.value,rr=St.state,gi=St.force,me=St.replace===!0,Ce=lt(ri);if(Ce)return kt(Xr(Ze(Ce),{state:typeof Ce=="object"?Xr({},rr,Ce.state):rr,force:gi,replace:me}),ci||ri);const ct=ri;ct.redirectedFrom=ci;let Tt;return!gi&&Ek(w,fi,ri)&&(Tt=xf(16,{to:ct,from:fi}),Tr(fi,fi,!0,!1)),(Tt?Promise.resolve(Tt):Ge(ct,fi)).catch(xt=>Wc(xt)?Wc(xt,2)?xt:ws(xt):xi(xt,ct,fi)).then(xt=>{if(xt){if(Wc(xt,2))return kt(Xr({replace:me},Ze(xt.to),{state:typeof xt.to=="object"?Xr({},rr,xt.to.state):rr,force:gi}),ci||ct)}else xt=Ot(ct,fi,!0,me,rr);return ai(ct,fi,xt),xt})}function Ne(St,ci){const ri=Ae(St,ci);return ri?Promise.reject(ri):Promise.resolve()}function ht(St){const ci=br.values().next().value;return ci&&typeof ci.runWithContext=="function"?ci.runWithContext(St):St()}function Ge(St,ci){let ri;const[fi,rr,gi]=cP(St,ci);ri=Jx(fi.reverse(),"beforeRouteLeave",St,ci);for(const Ce of fi)Ce.leaveGuards.forEach(ct=>{ri.push(lu(ct,St,ci))});const me=Ne.bind(null,St,ci);return ri.push(me),Es(ri).then(()=>{ri=[];for(const Ce of D.list())ri.push(lu(Ce,St,ci));return ri.push(me),Es(ri)}).then(()=>{ri=Jx(rr,"beforeRouteUpdate",St,ci);for(const Ce of rr)Ce.updateGuards.forEach(ct=>{ri.push(lu(ct,St,ci))});return ri.push(me),Es(ri)}).then(()=>{ri=[];for(const Ce of gi)if(Ce.beforeEnter)if(pl(Ce.beforeEnter))for(const ct of Ce.beforeEnter)ri.push(lu(ct,St,ci));else ri.push(lu(Ce.beforeEnter,St,ci));return ri.push(me),Es(ri)}).then(()=>(St.matched.forEach(Ce=>Ce.enterCallbacks={}),ri=Jx(gi,"beforeRouteEnter",St,ci,ht),ri.push(me),Es(ri))).then(()=>{ri=[];for(const Ce of B.list())ri.push(lu(Ce,St,ci));return ri.push(me),Es(ri)}).catch(Ce=>Wc(Ce,8)?Ce:Promise.reject(Ce))}function ai(St,ci,ri){q.list().forEach(fi=>ht(()=>fi(St,ci,ri)))}function Ot(St,ci,ri,fi,rr){const gi=Ae(St,ci);if(gi)return gi;const me=ci===tu,Ce=nf?history.state:{};ri&&(fi||me?M.replace(St.fullPath,Xr({scroll:me&&Ce&&Ce.scroll},rr)):M.push(St.fullPath,rr)),o.value=St,Tr(St,ci,ri,me),ws()}let jt;function Ti(){jt||(jt=M.listen((St,ci,ri)=>{if(!cn.listening)return;const fi=yt(St),rr=lt(fi);if(rr){kt(Xr(rr,{replace:!0,force:!0}),fi).catch($m);return}X=fi;const gi=o.value;nf&&Lk(c1(gi.fullPath,ri.delta),by()),Ge(fi,gi).catch(me=>Wc(me,12)?me:Wc(me,2)?(kt(Xr(Ze(me.to),{force:!0}),fi).then(Ce=>{Wc(Ce,20)&&!ri.delta&&ri.type===rg.pop&&M.go(-1,!1)}).catch($m),Promise.reject()):(ri.delta&&M.go(-ri.delta,!1),xi(me,fi,gi))).then(me=>{me=me||Ot(fi,gi,!1),me&&(ri.delta&&!Wc(me,8)?M.go(-ri.delta,!1):ri.type===rg.pop&&Wc(me,20)&&M.go(-1,!1)),ai(fi,gi,me)}).catch($m)}))}let Qi=Im(),li=Im(),yi;function xi(St,ci,ri){ws(St);const fi=li.list();return fi.length?fi.forEach(rr=>rr(St,ci,ri)):console.error(St),Promise.reject(St)}function vi(){return yi&&o.value!==tu?Promise.resolve():new Promise((St,ci)=>{Qi.add([St,ci])})}function ws(St){return yi||(yi=!St,Ti(),Qi.list().forEach(([ci,ri])=>St?ri(St):ci()),Qi.reset()),St}function Tr(St,ci,ri,fi){const{scrollBehavior:rr}=a;if(!nf||!rr)return Promise.resolve();const gi=!ri&&Dk(c1(St.fullPath,0))||(fi||!ri)&&history.state&&history.state.scroll||null;return Ef().then(()=>rr(St,ci,gi)).then(me=>me&&Ik(me)).catch(me=>xi(me,St,ci))}const fr=St=>M.go(St);let Ts;const br=new Set,cn={currentRoute:o,listening:!0,addRoute:Te,removeRoute:je,clearRoutes:h.clearRoutes,hasRoute:pt,getRoutes:We,resolve:yt,options:a,push:Be,replace:He,go:fr,back:()=>fr(-1),forward:()=>fr(1),beforeEach:D.add,beforeResolve:B.add,afterEach:q.add,onError:li.add,isReady:vi,install(St){const ci=this;St.component("RouterLink",rP),St.component("RouterView",aP),St.config.globalProperties.$router=ci,Object.defineProperty(St.config.globalProperties,"$route",{enumerable:!0,get:()=>oc(o)}),nf&&!Ts&&o.value===tu&&(Ts=!0,Be(M.location).catch(rr=>{}));const ri={};for(const rr in tu)Object.defineProperty(ri,rr,{get:()=>o.value[rr],enumerable:!0});St.provide(hv,ci),St.provide(uv,W0(ri)),St.provide(A0,o);const fi=St.unmount;br.add(St),St.unmount=function(){br.delete(St),br.size<1&&(X=tu,jt&&jt(),jt=null,o.value=tu,Ts=!1,yi=!1),fi()}}};function Es(St){return St.reduce((ci,ri)=>ci.then(()=>ht(ri)),Promise.resolve())}return cn}function cP(a,h){const _=[],w=[],M=[],D=Math.max(h.matched.length,a.matched.length);for(let B=0;B<D;B++){const q=h.matched[B];q&&(a.matched.find(X=>yf(X,q))?w.push(q):_.push(q));const o=a.matched[B];o&&(h.matched.find(X=>yf(X,o))||M.push(o))}return[_,w,M]}function hP(a){return Ia(uv)}const uP={class:"app-container"},dP={class:"navbar"},pP={key:0,class:"geoportal-title"},fP={class:"navbar-links"},mP={class:"view-container"},gP=ln({__name:"Layout",setup(a){const h=hP(),_=An(()=>h.path!=="/");return(w,M)=>{const D=j_("router-link"),B=j_("router-view");return Di(),Yi("div",uP,[It("nav",dP,[hr(D,{to:"/",class:"logo-group","aria-label":"Home"},{default:ol(()=>[M[0]||(M[0]=It("img",{src:VT,alt:"Donor Logo",class:"logo-dgis"},null,-1)),M[1]||(M[1]=It("img",{src:GT,alt:"Soil Values Logo",class:"logo-sv"},null,-1)),_.value?(Di(),Yi("span",pP,"Soil Values Geoportal")):ll("",!0)]),_:1}),It("div",fP,[hr(D,{to:"/",class:"nav-link"},{default:ol(()=>M[2]||(M[2]=[jo("Home")])),_:1}),hr(D,{to:"/dashboard",class:"nav-link"},{default:ol(()=>M[3]||(M[3]=[jo("Map")])),_:1}),hr(D,{to:"/monitoring",class:"nav-link"},{default:ol(()=>M[4]||(M[4]=[jo("M&E Dashboard")])),_:1}),hr(D,{to:"/catalog",class:"nav-link"},{default:ol(()=>M[5]||(M[5]=[jo("Catalog")])),_:1}),hr(D,{to:"/about",class:"nav-link"},{default:ol(()=>M[6]||(M[6]=[jo("About")])),_:1})])]),It("div",mP,[hr(B)])])}}}),yo=(a,h)=>{const _=a.__vccOpts||a;for(const[w,M]of h)_[w]=M;return _},_P=yo(gP,[["__scopeId","data-v-96930371"]]),yP={id:"app"},xP=ln({__name:"App",setup(a){return(h,_)=>(Di(),Yi("div",yP,[hr(_P)]))}}),vP="/projects/soil_values/assets/ifdc_logo-C0Phf9Dr.png",bP="/projects/soil_values/assets/WUR_logo-Ds7IIsIR.png",wP="/projects/soil_values/assets/SNV_logo_2-LRpPKBkz.png",TP="/projects/soil_values/assets/AGRA_logo-BuD40XdR.webp",EP="/projects/soil_values/assets/IITA_logo-DW09z6CA.png",SP="/projects/soil_values/assets/IWMI_logo-B-LuUFd5.jpg",AP="/projects/soil_values/assets/ISRIC_logo-Cx1mKsJo.webp",MP={class:"home-container"},CP={class:"landing-content"},kP=ln({__name:"HomeView",setup(a){return(h,_)=>{const w=j_("router-link");return Di(),Yi("div",MP,[It("div",CP,[_[1]||(_[1]=yy('<div class="logo-title fade-slide" data-v-57f594bf><img src="'+VT+'" alt="Donor Logo" class="logo donor-logo" data-v-57f594bf><img src="'+GT+'" alt="Soil Values Logo" class="logo main-logo" data-v-57f594bf><h1 data-v-57f594bf>Soil Values Geoportal</h1></div><div class="landing-text fade-slide" style="animation-delay:0.3s;" data-v-57f594bf><p data-v-57f594bf> Welcome to the Soil Values Geoportal, your gateway to dynamic, data-driven insights for landscape restoration and sustainable land management. </p><p data-v-57f594bf> Explore real-time maps and analytics on land cover, soil health, crops, and climate to inform impactful decisions across our intervention areas. </p></div><div class="logos-grid" data-v-57f594bf><div class="logo-row fade-slide" style="animation-delay:0.6s;" data-v-57f594bf><img src="'+vP+'" alt="IFDC" data-v-57f594bf><img src="'+bP+'" alt="WUR" data-v-57f594bf><img src="'+wP+'" alt="SNV" data-v-57f594bf></div><div class="logo-row fade-slide" style="animation-delay:0.9s;" data-v-57f594bf><img src="'+TP+'" alt="AGRA" data-v-57f594bf><img src="'+EP+'" alt="IITA" data-v-57f594bf><img src="'+SP+'" alt="IWMI" class="logo-iwmi" data-v-57f594bf><img src="'+AP+'" alt="ISRIC" data-v-57f594bf></div></div>',3)),hr(w,{to:"/dashboard",class:"launch-btn fade-slide",style:{"animation-delay":"1.2s"}},{default:ol(()=>_[0]||(_[0]=[jo(" Launch Geoportal ")])),_:1})])])}}}),PP=yo(kP,[["__scopeId","data-v-57f594bf"]]),IP="/projects/soil_values/assets/LC_MAPLAYERS-SEb8qRKn.png",LP="/projects/soil_values/assets/LC_BIOPHYSICAL_HEALTH_2-HHlmRK23.png",DP="/projects/soil_values/assets/LC_BIOPHYSICAL_HEALTH-BGgneVEh.png",RP="/projects/soil_values/assets/LC_LANDCOVER-BTufKOfp.png",zP="/projects/soil_values/assets/LC_LANDCOVER_%202-Dfxvtyu_.png",OP={class:"landcover-panel"},BP=ln({__name:"LandcoverPanel",setup(a){return(h,_)=>(Di(),Yi("div",OP,_[0]||(_[0]=[yy('<h2 class="panel-title" data-v-99eb2a14>Biophysical Monitoring</h2><p class="panel-intro" data-v-99eb2a14> This dashboard analyzes landcover trends in the Komadogou basin using MODIS EVI and biophysical classifications from 20032023. </p><section class="image-section" data-v-99eb2a14><h3 class="chart-title" data-v-99eb2a14>Map Layers</h3><img src="'+IP+'" alt="Map Layers" class="chart-image" data-v-99eb2a14></section><section class="image-section" data-v-99eb2a14><h3 class="chart-title" data-v-99eb2a14>Cumulative EVI</h3><img src="'+LP+'" alt="EVI Trend" class="chart-image" data-v-99eb2a14></section><section class="image-section" data-v-99eb2a14><h3 class="chart-title" data-v-99eb2a14>Biophysical Health (20102023)</h3><img src="'+DP+'" alt="Biophysical Donut" class="chart-image" data-v-99eb2a14></section><section class="image-section" data-v-99eb2a14><h3 class="chart-title" data-v-99eb2a14>Land Cover  Baseline Period (20032008)</h3><img src="'+RP+'" alt="Baseline Chart" class="chart-image" data-v-99eb2a14></section><section class="image-section" data-v-99eb2a14><h3 class="chart-title" data-v-99eb2a14>Land Cover  Evaluation Period (20102023)</h3><img src="'+zP+'" alt="Evaluation Chart" class="chart-image" data-v-99eb2a14></section>',7)])))}}),FP=yo(BP,[["__scopeId","data-v-99eb2a14"]]),NP={class:"fertility-panel"},UP={class:"indicator-title"},jP={class:"baseline-current"},VP={class:"baseline"},GP={class:"current"},$P={class:"progress-bar"},WP=ln({__name:"FertilityMonitoringPanel",setup(a){const h=[{name:"Organic Matter",baseline:"2.4%",current:"2.8%",change:"+15.92%",changeClass:"change-positive",progress:65},{name:"Nutrient Levels",baseline:"Medium",current:"High",change:"+16.35%",changeClass:"change-positive",progress:75},{name:"Erosion Risk",baseline:"Moderate",current:"No Change",change:"No Change",changeClass:"change-neutral",progress:50},{name:"Water Retention",baseline:"Low",current:"Moderate",change:"+8.42%",changeClass:"change-positive",progress:40}];return(_,w)=>(Di(),Yi("div",NP,[w[2]||(w[2]=It("h2",{class:"panel-title"},"Soil Fertility Monitoring",-1)),w[3]||(w[3]=It("p",{class:"panel-description"}," This panel tracks key soil health indicators using historical and current data for informed decision-making. ",-1)),(Di(),Yi(es,null,hl(h,M=>It("div",{key:M.name,class:"indicator-card"},[It("div",UP,[It("strong",null,zs(M.name),1),It("span",{class:bf(M.changeClass)},zs(M.change),3)]),It("div",jP,[It("span",VP,[w[0]||(w[0]=jo("Baseline: ")),It("strong",null,zs(M.baseline),1)]),It("span",GP,[w[1]||(w[1]=jo("Current: ")),It("strong",null,zs(M.current),1)])]),It("div",$P,[It("div",{class:"progress",style:Hd({width:M.progress+"%"})},null,4)])])),64))]))}}),HP=yo(WP,[["__scopeId","data-v-cd9fd968"]]),qP={class:"toolbox-container"},XP={class:"toolbox-content"},ZP=["onClick","title"],YP={class:"tool-icon"},KP={class:"icon-label"},JP={key:0,class:"floating-panel"},QP={key:1,class:"floating-panel"},eI={key:2,class:"floating-panel"},tI=ln({__name:"Toolbox",setup(a){const h=Kr(null),_=[{id:"landcover",name:"Biopysical Monitoring",description:"",emoji:""},{id:"crop",name:"Crop Monitoring",description:"Analyze crop health patterns",emoji:""},{id:"degradation",name:"Degradation Monitoring",description:"Track soil degradation",emoji:""},{id:"drought",name:"Drought Monitoring",description:"Monitor drought risks",emoji:""},{id:"fertility",name:"Fertility Monitoring",description:"Assess soil nutrients",emoji:""},{id:"risk",name:"Risk Monitoring",description:"Identify environmental risks",emoji:""}];lc(()=>{const D=localStorage.getItem("sv_tool");D&&(h.value=D)}),ul(h,D=>{D?localStorage.setItem("sv_tool",D):localStorage.removeItem("sv_tool")});function w(D){h.value=h.value===D?null:D}function M(D,B){if(D.startsWith("Land Cover"))return B===0?"Land Cover":"Monitoring";{const[q]=D.split(" ");return B===0?q:"Monitoring"}}return(D,B)=>(Di(),Yi("div",qP,[B[1]||(B[1]=It("div",{class:"toolbox-header"},[It("span",{class:"header-text"},"Tools")],-1)),It("div",XP,[(Di(),Yi(es,null,hl(_,q=>It("div",{key:q.id,class:"tool-item",onClick:o=>w(q.id),title:q.name},[It("div",YP,zs(q.emoji),1),It("div",KP,[It("strong",null,zs(M(q.name,0)),1),B[0]||(B[0]=It("br",null,null,-1)),It("span",null,zs(M(q.name,1)),1)]),hr(bT,{name:"slide"},{default:ol(()=>[h.value===q.id&&q.id==="landcover"?(Di(),Yi("div",JP,[hr(FP)])):h.value===q.id&&q.id==="fertility"?(Di(),Yi("div",QP,[hr(HP)])):h.value===q.id?(Di(),Yi("div",eI,[It("h3",null,zs(q.name),1),It("p",null,zs(q.description),1)])):ll("",!0)]),_:2},1024)],8,ZP)),64))])]))}}),iI=yo(tI,[["__scopeId","data-v-51215ed5"]]);var iE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function rE(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function rI(a){if(a.__esModule)return a;var h=a.default;if(typeof h=="function"){var _=function w(){return this instanceof w?Reflect.construct(h,arguments,this.constructor):h.apply(this,arguments)};_.prototype=h.prototype}else _={};return Object.defineProperty(_,"__esModule",{value:!0}),Object.keys(a).forEach(function(w){var M=Object.getOwnPropertyDescriptor(a,w);Object.defineProperty(_,w,M.get?M:{enumerable:!0,get:function(){return a[w]}})}),_}var sE={exports:{}};(function(a,h){var _={};(function(w,M){a.exports=M()})(iE,function(){var w,M,D;function B(o,X){if(!w)w=X;else if(!M)M=X;else{var ie="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+w+")(sharedChunk); ("+M+")(sharedChunk); self.onerror = null;",oe={};w(oe),D=X(oe),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(D.workerUrl=window.URL.createObjectURL(new Blob([ie],{type:"text/javascript"})))}}B(["exports"],function(o){var X=typeof self<"u"?self:{},ie="2.15.0";let oe;const xe={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(oe==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{oe=_.API_URL_REGEX!=null?new RegExp(_.API_URL_REGEX):t}catch{oe=t}}return oe},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!xe.API_URL)return null;try{const t=new URL(xe.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Te={supported:!1,testSupport:function(t){!pt&&We&&(yt?Ze(t):je=t)}};let je,We,pt=!1,yt=!1;function Ze(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,We),t.isContextLost())return;Te.supported=!0}catch{}t.deleteTexture(e),pt=!0}X.document&&(We=X.document.createElement("img"),We.onload=function(){je&&Ze(je),je=null,yt=!0},We.onerror=function(){pt=!0,je=null},We.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ae="01";function Be(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var He=lt;function lt(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=n}lt.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,n=0;n<8;n++){var c=this.sampleCurveX(i)-t;if(Math.abs(c)<e)return i;var f=this.sampleCurveDerivativeX(i);if(Math.abs(f)<1e-6)break;i-=c/f}var g=0,b=1;for(i=t,n=0;n<20&&(c=this.sampleCurveX(i),!(Math.abs(c-t)<e));n++)t>c?g=i:b=i,i=.5*(b-g)+g;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var kt=Be(He),Ne=ht;function ht(t,e){this.x=t,this.y=e}ht.prototype={clone:function(){return new ht(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),n=Math.sin(t),c=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-n*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ht.convert=function(t){return t instanceof ht?t:Array.isArray(t)?new ht(t[0],t[1]):t};var Ge=Be(Ne);const ai=Math.PI/180,Ot=180/Math.PI;function jt(t){return t*ai}function Ti(t){return t*Ot}const Qi=[[0,0],[1,0],[1,1],[0,1]];function li(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function yi(t,e,i,n){const c=new kt(t,e,i,n);return function(f){return c.solve(f)}}const xi=yi(.25,.1,.25,1);function vi(t,e,i){return Math.min(i,Math.max(e,t))}function ws(t,e,i){return(i=vi((i-t)/(e-t),0,1))*i*(3-2*i)}function Tr(t,e,i){const n=i-e,c=((t-e)%n+n)%n+e;return c===e?i:c}function fr(t,e,i){if(!t.length)return i(null,[]);let n=t.length;const c=new Array(t.length);let f=null;t.forEach((g,b)=>{e(g,(A,k)=>{A&&(f=A),c[b]=k,--n==0&&i(f,c)})})}function Ts(t){const e=[];for(const i in t)e.push(t[i]);return e}function br(t,...e){for(const i of e)for(const n in i)t[n]=i[n];return t}let cn=1;function Es(){return cn++}function St(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function ci(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function ri(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function fi(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function rr(t,e){return t.indexOf(e,t.length-e.length)!==-1}function gi(t,e,i){const n={};for(const c in t)n[c]=e.call(this,t[c],c,t);return n}function me(t,e,i){const n={};for(const c in t)e.call(i||this,t[c],c,t)&&(n[c]=t[c]);return n}function Ce(t){return Array.isArray(t)?t.map(Ce):typeof t=="object"&&t?gi(t,Ce):t}const ct={};function Tt(t){ct[t]||(typeof console<"u"&&console.warn(t),ct[t]=!0)}function xt(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function Vt(t){let e=0;for(let i,n,c=0,f=t.length,g=f-1;c<f;g=c++)i=t[c],n=t[g],e+=(n.x-i.x)*(i.y+n.y);return e}function ei(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Wt(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,n,c,f)=>{const g=c||f;return e[n]=!g||g.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let qt=null;function Gt(t){if(qt==null){const e=t.navigator?t.navigator.userAgent:null;qt=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return qt}function Ci(t){try{const e=X[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Qt(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const wi="mapbox-tiles";let Pi=500,er=50,tr,sr;function Cs(){try{return X.caches}catch{}}function Zr(){Cs()&&!tr&&(tr=X.caches.open(wi))}function Bs(t){const e=t.indexOf("?");if(e<0)return t;const i=function(c){const f=c.indexOf("?");return f>0?c.slice(f+1).split("&"):[]}(t),n=i.filter(c=>{const f=c.split("=");return f[0]==="language"||f[0]==="worldview"});return n.length?`${t.slice(0,e)}?${n.join("&")}`:t.slice(0,e)}let ir=1/0;const hn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(hn);class Kn extends Error{constructor(e,i,n){i===401&&Qe(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const gs=ei()?()=>self.worker&&self.worker.referrer:()=>(X.location.protocol==="blob:"?X.parent:X).location.href,Fs=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(gs())&&!/^\w+:/.test(i))){if(X.fetch&&X.Request&&X.AbortController&&X.Request.prototype.hasOwnProperty("signal"))return function(n,c){const f=new X.AbortController,g=new X.Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:gs(),referrerPolicy:n.referrerPolicy,signal:f.signal});let b=!1,A=!1;const k=(O=g.url).indexOf("sku=")>0&&Qe(O);var O;n.type==="json"&&g.headers.set("Accept","application/json");const U=(H,Z,ee)=>{if(A)return;if(H&&H.message!=="SecurityError"&&Tt(H.toString()),Z&&ee)return V(Z);const ce=Date.now();X.fetch(g).then(_e=>{if(_e.ok){const Me=k?_e.clone():null;return V(_e,Me,ce)}return c(new Kn(_e.statusText,_e.status,n.url))}).catch(_e=>{_e.name!=="AbortError"&&c(new Error(`${_e.message} ${n.url}`))})},V=(H,Z,ee)=>{(n.type==="arrayBuffer"?H.arrayBuffer():n.type==="json"?H.json():H.text()).then(ce=>{A||(Z&&ee&&function(_e,Me,ye){if(Zr(),!tr)return;const Se={status:Me.status,statusText:Me.statusText,headers:new X.Headers};Me.headers.forEach((nt,tt)=>Se.headers.set(tt,nt));const Le=Wt(Me.headers.get("Cache-Control")||"");if(Le["no-store"])return;Le["max-age"]&&Se.headers.set("Expires",new Date(ye+1e3*Le["max-age"]).toUTCString());const ke=Se.headers.get("Expires");ke&&(new Date(ke).getTime()-ye<42e4||function(nt,tt){if(sr===void 0)try{new Response(new ReadableStream),sr=!0}catch{sr=!1}sr?tt(nt.body):nt.blob().then(tt)}(Me,nt=>{const tt=new X.Response(nt,Se);Zr(),tr&&tr.then(mt=>mt.put(Bs(_e.url),tt)).catch(mt=>Tt(mt.message))}))}(g,Z,ee),b=!0,c(null,ce,H.headers.get("Cache-Control"),H.headers.get("Expires")))}).catch(ce=>{A||c(new Error(ce.message))})};return k?function(H,Z){if(Zr(),!tr)return Z(null);const ee=Bs(H.url);tr.then(ce=>{ce.match(ee).then(_e=>{const Me=function(ye){if(!ye)return!1;const Se=new Date(ye.headers.get("Expires")||0),Le=Wt(ye.headers.get("Cache-Control")||"");return Se>Date.now()&&!Le["no-cache"]}(_e);ce.delete(ee),Me&&ce.put(ee,_e.clone()),Z(null,_e,Me)}).catch(Z)}).catch(Z)}(g,U):U(null,null),{cancel:()=>{A=!0,b||f.abort()}}}(t,e);if(ei()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(n,c){const f=new X.XMLHttpRequest;f.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const g in n.headers)f.setRequestHeader(g,n.headers[g]);return n.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=n.credentials==="include",f.onerror=()=>{c(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let g=f.response;if(n.type==="json")try{g=JSON.parse(f.response)}catch(b){return c(b)}c(null,g,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else c(new Kn(f.statusText,f.status,n.url))},f.send(n.body),{cancel:()=>f.abort()}}(t,e)},Ws=function(t,e){return Fs(br(t,{type:"arrayBuffer"}),e)};function ml(t){const e=X.document.createElement("a");return e.href=t,e.protocol===X.document.location.protocol&&e.host===X.document.location.host}const Ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let se,ne;se=[],ne=0;const we=function(t,e){if(Te.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),ne>=xe.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return se.push(f),f}ne++;let i=!1;const n=()=>{if(!i)for(i=!0,ne--;se.length&&ne<xe.MAX_PARALLEL_IMAGE_REQUESTS;){const f=se.shift(),{requestParameters:g,callback:b,cancelled:A}=f;A||(f.cancel=we(g,b).cancel)}},c=Ws(t,(f,g,b,A)=>{n(),f?e(f):g&&(X.createImageBitmap?function(k,O){const U=new X.Blob([new Uint8Array(k)],{type:"image/png"});X.createImageBitmap(U).then(V=>{O(null,V)}).catch(V=>{O(new Error(`Could not load image because of ${V.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(k,O)=>e(k,O,b,A)):function(k,O){const U=new X.Image,V=X.URL;U.onload=()=>{O(null,U),V.revokeObjectURL(U.src),U.onload=null,X.requestAnimationFrame(()=>{U.src=Ee})},U.onerror=()=>O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const H=new X.Blob([new Uint8Array(k)],{type:"image/png"});U.src=k.byteLength?V.createObjectURL(H):Ee}(g,(k,O)=>e(k,O,b,A)))});return{cancel:()=>{c.cancel(),n()}}},De="NO_ACCESS_TOKEN";function Fe(t){return t.indexOf("mapbox:")===0}function Qe(t){return xe.API_URL_REGEX.test(t)}function Ke(t){return xe.API_CDN_URL_REGEX.test(t)}function Ve(t){return xe.API_STYLE_REGEX.test(t)&&!Ye(t)}function Ye(t){return xe.API_SPRITE_REGEX.test(t)}const Ft=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ht(t){const e=t.match(Ft);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Dt(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Ri="mapbox.eventData";function Si(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(X.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class zi{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=Si(xe.ACCESS_TOKEN);let n="";return n=i&&i.u?X.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(c,f)=>String.fromCharCode(+("0x"+f)))):xe.ACCESS_TOKEN||"",e?`${Ri}.${e}:${n}`:`${Ri}:${n}`}fetchEventData(){const e=Ci("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const c=X.localStorage.getItem(i);c&&(this.eventData=JSON.parse(c));const f=X.localStorage.getItem(n);f&&(this.anonId=f)}catch{Tt("Unable to read from LocalStorage")}}saveEventData(){const e=Ci("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{X.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&X.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Tt("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,n,c){if(!xe.EVENTS_URL)return;const f=Ht(xe.EVENTS_URL);f.params.push(`access_token=${c||xe.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(e).toISOString()},b=i?br(g,i):g,A={url:Dt(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=function(k,O){return Fs(br(k,{method:"POST"}),O)}(A,k=>{this.pendingRequest=null,n(k),this.saveEventData(),this.processRequests(c)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const Xi=new class extends zi{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){xe.EVENTS_URL&&xe.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>Fe(i)||Qe(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Si(xe.ACCESS_TOKEN),i=e?e.u:xe.ACCESS_TOKEN;let n=i!==this.eventData.tokenU;ri(this.anonId)||(this.anonId=St(),n=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),g=new Date(c),b=(c-this.eventData.lastSuccess)/864e5;n=n||b>=1||b<-1||f.getDate()!==g.getDate()}else n=!0;n?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ie,skuId:Ae,"enabled.telemetry":!1,userId:this.anonId},f=>{f||(this.eventData.lastSuccess=c,this.eventData.tokenU=i)},t):this.processRequests()}},Ji=Xi.postTurnstileEvent.bind(Xi),Yr=new class extends zi{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,n){this.skuToken=e,this.errorCb=n,xe.EVENTS_URL&&(i||xe.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(De)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),ri(this.anonId)||(this.anonId=St()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ie,skuId:Ae,skuToken:this.skuToken,userId:this.anonId},n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},t))}},is=Yr.postMapLoadEvent.bind(Yr),Hs=new class extends zi{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){xe.EVENTS_URL&&(t||xe.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),n=function(c){const f=X.performance.getEntriesByType("resource"),g=X.performance.getEntriesByType("mark"),b=function(V){const H={};if(V){for(const Z in V)if(Z!=="other")for(const ee of V[Z]){const ce=`${Z}ResolveRangeMin`,_e=`${Z}ResolveRangeMax`,Me=`${Z}RequestCount`,ye=`${Z}RequestCachedCount`;H[ce]=Math.min(H[ce]||1/0,ee.startTime),H[_e]=Math.max(H[_e]||-1/0,ee.responseEnd);const Se=Le=>{H[Le]===void 0&&(H[Le]=0),++H[Le]};ee.transferSize!==void 0&&ee.transferSize===0&&Se(ye),Se(Me)}}return H}(function(V,H){const Z={};if(V)for(const ee of V){const ce=H(ee);Z[ce]===void 0&&(Z[ce]=[]),Z[ce].push(ee)}return Z}(f,Zd)),A=X.devicePixelRatio,k=X.navigator.connection||X.navigator.mozConnection||X.navigator.webkitConnection,O={counters:[],metadata:[],attributes:[]},U=(V,H,Z)=>{Z!=null&&V.push({name:H,value:Z.toString()})};for(const V in b)U(O.counters,V,b[V]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(U(O.counters,"interactionRangeMin",c.interactionRange[0]),U(O.counters,"interactionRangeMax",c.interactionRange[1])),g)for(const V of Object.keys(ls)){const H=ls[V],Z=g.find(ee=>ee.name===H);Z&&U(O.counters,H,Z.startTime)}return U(O.counters,"visibilityHidden",c.visibilityHidden),U(O.attributes,"style",function(V){if(V)for(const H of V){const Z=H.name.split("?")[0];if(Ve(Z)){const ee=Z.split("/").slice(-2);if(ee.length===2)return`mapbox://styles/${ee[0]}/${ee[1]}`}}}(f)),U(O.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),U(O.attributes,"fogEnabled",c.fogEnabled?"true":"false"),U(O.attributes,"projection",c.projection),U(O.attributes,"zoom",c.zoom),U(O.metadata,"devicePixelRatio",A),U(O.metadata,"connectionEffectiveType",k?k.effectiveType:void 0),U(O.metadata,"navigatorUserAgent",X.navigator.userAgent),U(O.metadata,"screenWidth",X.screen.width),U(O.metadata,"screenHeight",X.screen.height),U(O.metadata,"windowWidth",X.innerWidth),U(O.metadata,"windowHeight",X.innerHeight),U(O.metadata,"mapWidth",c.width/A),U(O.metadata,"mapHeight",c.height/A),U(O.metadata,"webglRenderer",c.renderer),U(O.metadata,"webglVendor",c.vendor),U(O.metadata,"sdkVersion",ie),U(O.metadata,"sdkIdentifier","mapbox-gl-js"),O}(i);for(const c of n.metadata);for(const c of n.counters);for(const c of n.attributes);this.postEvent(e,n,()=>{},t)}},Ss=Hs.postPerformanceEvent.bind(Hs),xo=new class extends zi{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,n){if(!xe.API_URL||!xe.SESSION_PATH)return;const c=Ht(xe.API_URL+xe.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${n||xe.ACCESS_TOKEN||""}`);const f={url:Dt(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(g,b){return Fs(br(g,{method:"GET"}),b)}(f,g=>{this.pendingRequest=null,i(g),this.saveEventData(),this.processRequests(n)})}getSessionAPI(t,e,i,n){this.skuToken=e,this.errorCb=n,xe.SESSION_PATH&&xe.API_URL&&(i||xe.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(De)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},t)}},As=xo.getSessionAPI.bind(xo),Zs=new Set,ls={create:"create",load:"load",fullLoad:"fullLoad"},Xd={mark(t){X.performance.mark(t)},measure(t,e,i){X.performance.measure(t,e,i)}};function Zd(t){const e=t.name.split("?")[0];return Ke(e)&&e.includes("mapbox-gl.js")?"javascript":Ke(e)&&e.includes("mapbox-gl.css")?"css":function(i){return xe.API_FONTS_REGEX.test(i)}(e)?"fontRange":Ye(e)?"sprite":Ve(e)?"style":function(i){return xe.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}const mr=X.performance;function gu(t){const e=t?t.url.toString():void 0;return mr.getEntriesByName(e)}let cc,Qc,eh,Jn;const vo={now:()=>eh!==void 0?eh:X.performance.now(),setNow(t){eh=t},restoreNow(){eh=void 0},frame(t){const e=X.requestAnimationFrame(t);return{cancel:()=>X.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:n}=t;Jn||(Jn=X.document.createElement("canvas"));const c=Jn.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(i>Jn.width||n>Jn.height)&&(Jn.width=i,Jn.height=n),c.clearRect(-e,-e,i+2*e,n+2*e),c.drawImage(t,0,0,i,n),c.getImageData(-e,-e,i+2*e,n+2*e)},resolveURL:t=>(cc||(cc=X.document.createElement("a")),cc.href=t,cc.href),get devicePixelRatio(){return X.devicePixelRatio},get prefersReducedMotion(){return!!X.matchMedia&&(Qc==null&&(Qc=X.matchMedia("(prefers-reduced-motion: reduce)")),Qc.matches)}};function _u(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function hc(t,e,i){if(i&&i[t]){const n=i[t].indexOf(e);n!==-1&&i[t].splice(n,1)}}class bo{constructor(e,i={}){br(this,i),this.type=e}}class Go extends bo{constructor(e,i={}){super("error",br({error:e},i))}}class Dr{on(e,i){return this._listeners=this._listeners||{},_u(e,i,this._listeners),this}off(e,i){return hc(e,i,this._listeners),hc(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},_u(e,i,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,i){typeof e=="string"&&(e=new bo(e,i||{}));const n=e.type;if(this.listens(n)){e.target=this;const c=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const b of c)b.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const b of f)hc(n,b,this._oneTimeListeners),b.call(this,e);const g=this._eventedParent;g&&(br(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof Go&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var ut=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function wo(t,...e){for(const i of e)for(const n in i)t[n]=i[n];return t}function _s(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Ns(t){if(Array.isArray(t))return t.map(Ns);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=Ns(t[i]);return e}return _s(t)}class Yd extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var To=Yd;class th{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[n,c]of i)this.bindings[n]=c}concat(e){return new th(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Kd=th;const gl={kind:"null"},Yt={kind:"number"},Ki={kind:"string"},Vi={kind:"boolean"},yn={kind:"color"},Ln={kind:"object"},Gi={kind:"value"},xn={kind:"collator"},Ys={kind:"formatted"},Qn={kind:"resolvedImage"};function Dn(t,e){return{kind:"array",itemType:t,N:e}}function Wr(t){if(t.kind==="array"){const e=Wr(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const Jd=[gl,Yt,Ki,Vi,yn,Ys,Ln,Dn(Gi),Qn];function eo(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!eo(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const i of Jd)if(!eo(i,e))return null}}return`Expected ${Wr(t)} but found ${Wr(e)} instead.`}function pa(t,e){return e.some(i=>i.kind===t.kind)}function uc(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}var yu,xu={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function _l(t){return(t=Math.round(t))<0?0:t>255?255:t}function Eo(t){return _l(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function ih(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function $o(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{yu={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in xu)return xu[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var n=i.indexOf("("),c=i.indexOf(")");if(n!==-1&&c+1===i.length){var f=i.substr(0,n),g=i.substr(n+1,c-(n+1)).split(","),b=1;switch(f){case"rgba":if(g.length!==4)return null;b=ih(g.pop());case"rgb":return g.length!==3?null:[Eo(g[0]),Eo(g[1]),Eo(g[2]),b];case"hsla":if(g.length!==4)return null;b=ih(g.pop());case"hsl":if(g.length!==3)return null;var A=(parseFloat(g[0])%360+360)%360/360,k=ih(g[1]),O=ih(g[2]),U=O<=.5?O*(k+1):O+k-O*k,V=2*O-U;return[_l(255*$o(V,U,A+1/3)),_l(255*$o(V,U,A)),_l(255*$o(V,U,A-1/3)),b];default:return null}}return null}}catch{}class vn{constructor(e,i,n,c=1){this.r=e,this.g=i,this.b=n,this.a=c}static parse(e){if(!e)return;if(e instanceof vn)return e;if(typeof e!="string")return;const i=yu(e);return i?new vn(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,n,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(n)},${c})`}toArray(){const{r:e,g:i,b:n,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*i/c,255*n/c,c]}toArray01(){const{r:e,g:i,b:n,a:c}=this;return c===0?[0,0,0,0]:[e/c,i/c,n/c,c]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:n,a:c}=this;return[e,i,n,c]}}vn.black=new vn(0,0,0,1),vn.white=new vn(1,1,1,1),vn.transparent=new vn(0,0,0,0),vn.red=new vn(1,0,0,1),vn.blue=new vn(0,0,1,1);var cs=vn;class vu{constructor(e,i,n){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class dc{constructor(e,i,n,c,f){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=n,this.fontStack=c,this.textColor=f}}class bn{constructor(e){this.sections=e}static fromString(e){return new bn([new dc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof bn?e:bn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const n={};i.fontStack&&(n["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(n["font-scale"]=i.scale),i.textColor&&(n["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(n)}return e}}class un{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new un({name:e,available:!1}):null}serialize(){return["image",this.name]}}function bu(t,e,i,n){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[t,e,i,n]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function wn(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof cs||t instanceof vu||t instanceof bn||t instanceof un)return!0;if(Array.isArray(t)){for(const e of t)if(!wn(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!wn(t[e]))return!1;return!0}return!1}function rs(t){if(t===null)return gl;if(typeof t=="string")return Ki;if(typeof t=="boolean")return Vi;if(typeof t=="number")return Yt;if(t instanceof cs)return yn;if(t instanceof vu)return xn;if(t instanceof bn)return Ys;if(t instanceof un)return Qn;if(Array.isArray(t)){const e=t.length;let i;for(const n of t){const c=rs(n);if(i){if(i===c)continue;i=Gi;break}i=c}return Dn(i||Gi,e)}return Ln}function Wo(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof cs||t instanceof bn||t instanceof un?t.toString():JSON.stringify(t)}class pc{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!wn(e[1]))return i.error("invalid value");const n=e[1];let c=rs(n);const f=i.expectedType;return c.kind!=="array"||c.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(c=f),new pc(c,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof cs?["rgba"].concat(this.value.toArray()):this.value instanceof bn?this.value.serialize():this.value}}var Ho=pc,Us=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const rh={string:Ki,number:Yt,boolean:Vi,object:Ln};class wu{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let n,c=1;const f=e[0];if(f==="array"){let b,A;if(e.length>2){const k=e[1];if(typeof k!="string"||!(k in rh)||k==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);b=rh[k],c++}else b=Gi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);A=e[2],c++}n=Dn(b,A)}else n=rh[f];const g=[];for(;c<e.length;c++){const b=i.parse(e[c],c,Gi);if(!b)return null;g.push(b)}return new wu(n,g)}evaluate(e){for(let i=0;i<this.args.length;i++){const n=this.args[i].evaluate(e);if(!eo(this.type,rs(n)))return n;if(i===this.args.length-1)throw new Us(`Expected value to be of type ${Wr(this.type)}, but found ${Wr(rs(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){i.push(n.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map(n=>n.serialize()))}}var qo=wu;class Xo{constructor(e){this.type=Ys,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return i.error("First argument must be an image or text section.");const c=[];let f=!1;for(let g=1;g<=e.length-1;++g){const b=e[g];if(f&&typeof b=="object"&&!Array.isArray(b)){f=!1;let A=null;if(b["font-scale"]&&(A=i.parse(b["font-scale"],1,Yt),!A))return null;let k=null;if(b["text-font"]&&(k=i.parse(b["text-font"],1,Dn(Ki)),!k))return null;let O=null;if(b["text-color"]&&(O=i.parse(b["text-color"],1,yn),!O))return null;const U=c[c.length-1];U.scale=A,U.font=k,U.textColor=O}else{const A=i.parse(e[g],1,Gi);if(!A)return null;const k=A.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,c.push({content:A,scale:null,font:null,textColor:null})}}return new Xo(c)}evaluate(e){return new bn(this.sections.map(i=>{const n=i.content.evaluate(e);return rs(n)===Qn?new dc("",n,null,null,null):new dc(Wo(n),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const n={};i.scale&&(n["font-scale"]=i.scale.serialize()),i.font&&(n["text-font"]=i.font.serialize()),i.textColor&&(n["text-color"]=i.textColor.serialize()),e.push(n)}return e}}class yl{constructor(e){this.type=Qn,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const n=i.parse(e[1],1,Ki);return n?new yl(n):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),n=un.fromString(i);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(i)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const xl={"to-boolean":Vi,"to-color":yn,"to-number":Yt,"to-string":Ki};class to{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const n=e[0];if((n==="to-boolean"||n==="to-string")&&e.length!==2)return i.error("Expected one argument.");const c=xl[n],f=[];for(let g=1;g<e.length;g++){const b=i.parse(e[g],g,Gi);if(!b)return null;f.push(b)}return new to(c,f)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,n;for(const c of this.args){if(i=c.evaluate(e),n=null,i instanceof cs)return i;if(typeof i=="string"){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(n=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:bu(i[0],i[1],i[2],i[3]),!n))return new cs(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Us(n||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const n of this.args){if(i=n.evaluate(e),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new Us(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?bn.fromString(Wo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?un.fromString(Wo(this.args[0].evaluate(e))):Wo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Xo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new yl(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Zo=to;const So=["Unknown","Point","LineString","Polygon"];var Tu=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?So[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(n*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=cs.parse(t)),e}};class za{constructor(e,i,n,c){this.name=e,this.type=i,this._evaluate=n,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const n=e[0],c=za.definitions[n];if(!c)return i.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,b=g.filter(([k])=>!Array.isArray(k)||k.length===e.length-1);let A=null;for(const[k,O]of b){A=new Su(i.registry,i.path,null,i.scope);const U=[];let V=!1;for(let H=1;H<e.length;H++){const Z=e[H],ee=Array.isArray(k)?k[H-1]:k.type,ce=A.parse(Z,1+U.length,ee);if(!ce){V=!0;break}U.push(ce)}if(!V)if(Array.isArray(k)&&k.length!==U.length)A.error(`Expected ${k.length} arguments, but found ${U.length} instead.`);else{for(let H=0;H<U.length;H++){const Z=Array.isArray(k)?k[H]:k.type,ee=U[H];A.concat(H+1).checkSubtype(Z,ee.type)}if(A.errors.length===0)return new za(n,f,O,U)}}if(b.length===1)i.errors.push(...A.errors);else{const k=(b.length?b:g).map(([U])=>{return V=U,Array.isArray(V)?`(${V.map(Wr).join(", ")})`:`(${Wr(V.type)}...)`;var V}).join(" | "),O=[];for(let U=1;U<e.length;U++){const V=i.parse(e[U],1+O.length);if(!V)return null;O.push(Wr(V.type))}i.error(`Expected arguments of type ${k}, but found (${O.join(", ")}) instead.`)}return null}static register(e,i){za.definitions=i;for(const n in i)e[n]=za}}var Ao=za;class ss{constructor(e,i,n){this.type=xn,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return i.error("Collator options argument must be an object.");const c=i.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,Vi);if(!c)return null;const f=i.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,Vi);if(!f)return null;let g=null;return n.locale&&(g=i.parse(n.locale,1,Ki),!g)?null:new ss(c,f,g)}evaluate(e){return new vu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const js=8192;function fc(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function vl(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function bl(t,e){const i=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(i*c*js),Math.round(n*c*js)]}function wl(t,e,i){const n=t[0]-e[0],c=t[1]-e[1],f=t[0]-i[0],g=t[1]-i[1];return n*g-f*c==0&&n*f<=0&&c*g<=0}function sh(t,e){let i=!1;for(let g=0,b=e.length;g<b;g++){const A=e[g];for(let k=0,O=A.length;k<O-1;k++){if(wl(t,A[k],A[k+1]))return!1;(c=A[k])[1]>(n=t)[1]!=(f=A[k+1])[1]>n[1]&&n[0]<(f[0]-c[0])*(n[1]-c[1])/(f[1]-c[1])+c[0]&&(i=!i)}}var n,c,f;return i}function Tl(t,e){for(let i=0;i<e.length;i++)if(sh(t,e[i]))return!0;return!1}function nh(t,e,i,n){const c=n[0]-i[0],f=n[1]-i[1],g=(t[0]-i[0])*f-c*(t[1]-i[1]),b=(e[0]-i[0])*f-c*(e[1]-i[1]);return g>0&&b<0||g<0&&b>0}function Rn(t,e,i){for(const k of i)for(let O=0;O<k.length-1;++O)if((b=[(g=k[O+1])[0]-(f=k[O])[0],g[1]-f[1]])[0]*(A=[(c=e)[0]-(n=t)[0],c[1]-n[1]])[1]-b[1]*A[0]!=0&&nh(n,c,f,g)&&nh(f,g,n,c))return!0;var n,c,f,g,b,A;return!1}function pr(t,e){for(let i=0;i<t.length;++i)if(!sh(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Rn(t[i],t[i+1],e))return!1;return!0}function Mf(t,e){for(let i=0;i<e.length;i++)if(pr(t,e[i]))return!0;return!1}function Oa(t,e,i){const n=[];for(let c=0;c<t.length;c++){const f=[];for(let g=0;g<t[c].length;g++){const b=bl(t[c][g],i);fc(e,b),f.push(b)}n.push(f)}return n}function Eu(t,e,i){const n=[];for(let c=0;c<t.length;c++){const f=Oa(t[c],e,i);n.push(f)}return n}function oh(t,e,i,n){if(t[0]<i[0]||t[0]>i[2]){const c=.5*n;let f=t[0]-i[0]>c?-n:i[0]-t[0]>c?n:0;f===0&&(f=t[0]-i[2]>c?-n:i[2]-t[0]>c?n:0),t[0]+=f}fc(e,t)}function ah(t,e,i,n){const c=Math.pow(2,n.z)*js,f=[n.x*js,n.y*js],g=[];if(!t)return g;for(const b of t)for(const A of b){const k=[A.x+f[0],A.y+f[1]];oh(k,e,i,c),g.push(k)}return g}function lh(t,e,i,n){const c=Math.pow(2,n.z)*js,f=[n.x*js,n.y*js],g=[];if(!t)return g;for(const A of t){const k=[];for(const O of A){const U=[O.x+f[0],O.y+f[1]];fc(e,U),k.push(U)}g.push(k)}if(e[2]-e[0]<=c/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const A of g)for(const k of A)oh(k,e,i,c)}var b;return g}class fa{constructor(e,i){this.type=Vi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(wn(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let c=0;c<n.features.length;++c){const f=n.features[c].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new fa(n,n.features[c].geometry)}else if(n.type==="Feature"){const c=n.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new fa(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new fa(n,n)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,n){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(n.type==="Polygon"){const b=Oa(n.coordinates,f,g),A=ah(i.geometry(),c,f,g);if(!vl(c,f))return!1;for(const k of A)if(!sh(k,b))return!1}if(n.type==="MultiPolygon"){const b=Eu(n.coordinates,f,g),A=ah(i.geometry(),c,f,g);if(!vl(c,f))return!1;for(const k of A)if(!Tl(k,b))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,n){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(n.type==="Polygon"){const b=Oa(n.coordinates,f,g),A=lh(i.geometry(),c,f,g);if(!vl(c,f))return!1;for(const k of A)if(!pr(k,b))return!1}if(n.type==="MultiPolygon"){const b=Eu(n.coordinates,f,g),A=lh(i.geometry(),c,f,g);if(!vl(c,f))return!1;for(const k of A)if(!Mf(k,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var ch=fa;function Ba(t){if(t instanceof Ao&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof ch)return!1;let e=!0;return t.eachChild(i=>{e&&!Ba(i)&&(e=!1)}),e}function io(t){if(t instanceof Ao&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!io(i)&&(e=!1)}),e}function Fa(t,e){if(t instanceof Ao&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(n=>{i&&!Fa(n,e)&&(i=!1)}),i}class hh{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const n=e[1];return i.scope.has(n)?new hh(n,i.scope.get(n)):i.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Qd=hh;class mc{constructor(e,i=[],n,c=new Kd,f=[]){this.registry=e,this.path=i,this.key=i.map(g=>`[${g}]`).join(""),this.scope=c,this.errors=f,this.expectedType=n}parse(e,i,n,c,f={}){return i?this.concat(i,n,c)._parse(e,f):this._parse(e,f)}_parse(e,i){function n(c,f,g){return g==="assert"?new qo(f,[c]):g==="coerce"?new Zo(f,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[c];if(f){let g=f.parse(e,this);if(!g)return null;if(this.expectedType){const b=this.expectedType,A=g.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||A.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||A.kind!=="value"&&A.kind!=="string"){if(this.checkSubtype(b,A))return null}else g=n(g,b,i.typeAnnotation||"coerce");else g=n(g,b,i.typeAnnotation||"assert")}if(!(g instanceof Ho)&&g.type.kind!=="resolvedImage"&&gc(g)){const b=new Tu;try{g=new Ho(g.type,g.evaluate(b))}catch(A){return this.error(A.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,n){const c=typeof e=="number"?this.path.concat(e):this.path,f=n?this.scope.concat(n):this.scope;return new mc(this.registry,c,i||null,f,this.errors)}error(e,...i){const n=`${this.key}${i.map(c=>`[${c}]`).join("")}`;this.errors.push(new To(n,e))}checkSubtype(e,i){const n=eo(e,i);return n&&this.error(n),n}}var Su=mc;function gc(t){if(t instanceof Qd)return gc(t.boundExpression);if(t instanceof Ao&&t.name==="error"||t instanceof ss||t instanceof ch)return!1;const e=t instanceof Zo||t instanceof qo;let i=!0;return t.eachChild(n=>{i=e?i&&gc(n):i&&n instanceof Ho}),!!i&&Ba(t)&&Fa(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function uh(t,e){const i=t.length-1;let n,c,f=0,g=i,b=0;for(;f<=g;)if(b=Math.floor((f+g)/2),n=t[b],c=t[b+1],n<=e){if(b===i||e<c)return b;f=b+1}else{if(!(n>e))throw new Us("Input is not a number.");g=b-1}return 0}class dh{constructor(e,i,n){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[c,f]of n)this.labels.push(c),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const n=i.parse(e[1],1,Yt);if(!n)return null;const c=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let g=1;g<e.length;g+=2){const b=g===1?-1/0:e[g],A=e[g+1],k=g,O=g+1;if(typeof b!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(c.length&&c[c.length-1][0]>=b)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const U=i.parse(A,O,f);if(!U)return null;f=f||U.type,c.push([b,U])}return new dh(f,n,c)}evaluate(e){const i=this.labels,n=this.outputs;if(i.length===1)return n[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return n[0].evaluate(e);const f=i.length;return c>=i[f-1]?n[f-1].evaluate(e):n[uh(i,c)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Au=dh;function nr(t,e,i){return t*(1-i)+e*i}var Mo=Object.freeze({__proto__:null,array:function(t,e,i){return t.map((n,c)=>nr(n,e[c],i))},color:function(t,e,i){return new cs(nr(t.r,e.r,i),nr(t.g,e.g,i),nr(t.b,e.b,i),nr(t.a,e.a,i))},number:nr});const Mu=.95047,ph=1.08883,ep=4/29,Na=6/29,Cu=3*Na*Na,ku=Na*Na*Na,Pu=Math.PI/180,fh=180/Math.PI;function El(t){return t>ku?Math.pow(t,1/3):t/Cu+ep}function Iu(t){return t>Na?t*t*t:Cu*(t-ep)}function mh(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ua(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ma(t){const e=Ua(t.r),i=Ua(t.g),n=Ua(t.b),c=El((.4124564*e+.3575761*i+.1804375*n)/Mu),f=El((.2126729*e+.7151522*i+.072175*n)/1);return{l:116*f-16,a:500*(c-f),b:200*(f-El((.0193339*e+.119192*i+.9503041*n)/ph)),alpha:t.a}}function tp(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*Iu(e),i=Mu*Iu(i),n=ph*Iu(n),new cs(mh(3.2404542*i-1.5371385*e-.4985314*n),mh(-.969266*i+1.8760108*e+.041556*n),mh(.0556434*i-.2040259*e+1.0572252*n),t.alpha)}function ja(t,e,i){const n=e-t;return t+i*(n>180||n<-180?n-360*Math.round(n/360):n)}const _c={forward:ma,reverse:tp,interpolate:function(t,e,i){return{l:nr(t.l,e.l,i),a:nr(t.a,e.a,i),b:nr(t.b,e.b,i),alpha:nr(t.alpha,e.alpha,i)}}},ro={forward:function(t){const{l:e,a:i,b:n}=ma(t),c=Math.atan2(n,i)*fh;return{h:c<0?c+360:c,c:Math.sqrt(i*i+n*n),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Pu,i=t.c;return tp({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:ja(t.h,e.h,i),c:nr(t.c,e.c,i),l:nr(t.l,e.l,i),alpha:nr(t.alpha,e.alpha,i)}}};var Va=Object.freeze({__proto__:null,hcl:ro,lab:_c});class yc{constructor(e,i,n,c,f){this.type=e,this.operator=i,this.interpolation=n,this.input=c,this.labels=[],this.outputs=[];for(const[g,b]of f)this.labels.push(g),this.outputs.push(b)}static interpolationFactor(e,i,n,c){let f=0;if(e.name==="exponential")f=xc(i,e.base,n,c);else if(e.name==="linear")f=xc(i,1,n,c);else if(e.name==="cubic-bezier"){const g=e.controlPoints;f=new kt(g[0],g[1],g[2],g[3]).solve(xc(i,1,n,c))}return f}static parse(e,i){let[n,c,f,...g]=e;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const k=c[1];if(typeof k!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:k}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const k=c.slice(1);if(k.length!==4||k.some(O=>typeof O!="number"||O<0||O>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:k}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,Yt),!f)return null;const b=[];let A=null;n==="interpolate-hcl"||n==="interpolate-lab"?A=yn:i.expectedType&&i.expectedType.kind!=="value"&&(A=i.expectedType);for(let k=0;k<g.length;k+=2){const O=g[k],U=g[k+1],V=k+3,H=k+4;if(typeof O!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(b.length&&b[b.length-1][0]>=O)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const Z=i.parse(U,H,A);if(!Z)return null;A=A||Z.type,b.push([O,Z])}return A.kind==="number"||A.kind==="color"||A.kind==="array"&&A.itemType.kind==="number"&&typeof A.N=="number"?new yc(A,n,c,f,b):i.error(`Type ${Wr(A)} is not interpolatable.`)}evaluate(e){const i=this.labels,n=this.outputs;if(i.length===1)return n[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return n[0].evaluate(e);const f=i.length;if(c>=i[f-1])return n[f-1].evaluate(e);const g=uh(i,c),b=yc.interpolationFactor(this.interpolation,c,i[g],i[g+1]),A=n[g].evaluate(e),k=n[g+1].evaluate(e);return this.operator==="interpolate"?Mo[this.type.kind.toLowerCase()](A,k,b):this.operator==="interpolate-hcl"?ro.reverse(ro.interpolate(ro.forward(A),ro.forward(k),b)):_c.reverse(_c.interpolate(_c.forward(A),_c.forward(k),b))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)i.push(this.labels[n],this.outputs[n].serialize());return i}}function xc(t,e,i,n){const c=n-i,f=t-i;return c===0?0:e===1?f/c:(Math.pow(e,f)-1)/(Math.pow(e,c)-1)}var zn=yc;class gh{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let n=null;const c=i.expectedType;c&&c.kind!=="value"&&(n=c);const f=[];for(const b of e.slice(1)){const A=i.parse(b,1+f.length,n,void 0,{typeAnnotation:"omit"});if(!A)return null;n=n||A.type,f.push(A)}const g=c&&f.some(b=>eo(c,b.type));return new gh(g?Gi:n,f)}evaluate(e){let i,n=null,c=0;for(const f of this.args){if(c++,n=f.evaluate(e),n&&n instanceof un&&!n.available&&(i||(i=n),n=null,c===this.args.length))return i;if(n!==null)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Lu=gh;class _h{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let f=1;f<e.length-1;f+=2){const g=e[f];if(typeof g!="string")return i.error(`Expected string, but found ${typeof g} instead.`,f);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const b=i.parse(e[f+1],f+1);if(!b)return null;n.push([g,b])}const c=i.parse(e[e.length-1],e.length-1,i.expectedType,n);return c?new _h(n,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,n]of this.bindings)e.push(i,n.serialize());return e.push(this.result.serialize()),e}}var vc=_h;class Du{constructor(e,i,n){this.type=e,this.index=i,this.input=n}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,Yt),c=i.parse(e[2],2,Dn(i.expectedType||Gi));return n&&c?new Du(c.type.itemType,n,c):null}evaluate(e){const i=this.index.evaluate(e),n=this.input.evaluate(e);if(i<0)throw new Us(`Array index out of bounds: ${i} < 0.`);if(i>=n.length)throw new Us(`Array index out of bounds: ${i} > ${n.length-1}.`);if(i!==Math.floor(i))throw new Us(`Array index must be an integer, but found ${i} instead.`);return n[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Cf=Du;class Ru{constructor(e,i){this.type=Vi,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,Gi),c=i.parse(e[2],2,Gi);return n&&c?pa(n.type,[Vi,Ki,Yt,gl,Gi])?new Ru(n,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wr(n.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(n==null)return!1;if(!uc(i,["boolean","string","number","null"]))throw new Us(`Expected first argument to be of type boolean, string, number or null, but found ${Wr(rs(i))} instead.`);if(!uc(n,["string","array"]))throw new Us(`Expected second argument to be of type array or string, but found ${Wr(rs(n))} instead.`);return n.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var so=Ru;class bc{constructor(e,i,n){this.type=Yt,this.needle=e,this.haystack=i,this.fromIndex=n}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,Gi),c=i.parse(e[2],2,Gi);if(!n||!c)return null;if(!pa(n.type,[Vi,Ki,Yt,gl,Gi]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wr(n.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,Yt);return f?new bc(n,c,f):null}return new bc(n,c)}evaluate(e){const i=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!uc(i,["boolean","string","number","null"]))throw new Us(`Expected first argument to be of type boolean, string, number or null, but found ${Wr(rs(i))} instead.`);if(!uc(n,["string","array"]))throw new Us(`Expected second argument to be of type array or string, but found ${Wr(rs(n))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return n.indexOf(i,c)}return n.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var zu=bc;class Ou{constructor(e,i,n,c,f,g){this.inputType=e,this.type=i,this.input=n,this.cases=c,this.outputs=f,this.otherwise=g}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let n,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const f={},g=[];for(let k=2;k<e.length-1;k+=2){let O=e[k];const U=e[k+1];Array.isArray(O)||(O=[O]);const V=i.concat(k);if(O.length===0)return V.error("Expected at least one branch label.");for(const Z of O){if(typeof Z!="number"&&typeof Z!="string")return V.error("Branch labels must be numbers or strings.");if(typeof Z=="number"&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Z=="number"&&Math.floor(Z)!==Z)return V.error("Numeric branch labels must be integer values.");if(n){if(V.checkSubtype(n,rs(Z)))return null}else n=rs(Z);if(f[String(Z)]!==void 0)return V.error("Branch labels must be unique.");f[String(Z)]=g.length}const H=i.parse(U,k,c);if(!H)return null;c=c||H.type,g.push(H)}const b=i.parse(e[1],1,Gi);if(!b)return null;const A=i.parse(e[e.length-1],e.length-1,c);return A?b.type.kind!=="value"&&i.concat(1).checkSubtype(n,b.type)?null:new Ou(n,c,b,f,g,A):null}evaluate(e){const i=this.input.evaluate(e);return(rs(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),n=[],c={};for(const g of i){const b=c[this.cases[g]];b===void 0?(c[this.cases[g]]=n.length,n.push([this.cases[g],[g]])):n[b][1].push(g)}const f=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,b]of n)e.push(b.length===1?f(b[0]):b.map(f)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}var kf=Ou;class Sl{constructor(e,i,n){this.type=e,this.branches=i,this.otherwise=n}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let n;i.expectedType&&i.expectedType.kind!=="value"&&(n=i.expectedType);const c=[];for(let g=1;g<e.length-1;g+=2){const b=i.parse(e[g],g,Vi);if(!b)return null;const A=i.parse(e[g+1],g+1,n);if(!A)return null;c.push([b,A]),n=n||A.type}const f=i.parse(e[e.length-1],e.length-1,n);return f?new Sl(n,c,f):null}evaluate(e){for(const[i,n]of this.branches)if(i.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,n]of this.branches)e(i),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var ip=Sl;class wc{constructor(e,i,n,c){this.type=e,this.input=i,this.beginIndex=n,this.endIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,Gi),c=i.parse(e[2],2,Yt);if(!n||!c)return null;if(!pa(n.type,[Dn(Gi),Ki,Gi]))return i.error(`Expected first argument to be of type array or string, but found ${Wr(n.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,Yt);return f?new wc(n.type,n,c,f):null}return new wc(n.type,n,c)}evaluate(e){const i=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!uc(i,["string","array"]))throw new Us(`Expected first argument to be of type array or string, but found ${Wr(rs(i))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return i.slice(n,c)}return i.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Bu=wc;function yh(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ga(t,e,i,n){return n.compare(e,i)===0}function On(t,e,i){const n=t!=="=="&&t!=="!=";return class nE{constructor(f,g,b){this.type=Vi,this.lhs=f,this.rhs=g,this.collator=b,this.hasUntypedArgument=f.type.kind==="value"||g.type.kind==="value"}static parse(f,g){if(f.length!==3&&f.length!==4)return g.error("Expected two or three arguments.");const b=f[0];let A=g.parse(f[1],1,Gi);if(!A)return null;if(!yh(b,A.type))return g.concat(1).error(`"${b}" comparisons are not supported for type '${Wr(A.type)}'.`);let k=g.parse(f[2],2,Gi);if(!k)return null;if(!yh(b,k.type))return g.concat(2).error(`"${b}" comparisons are not supported for type '${Wr(k.type)}'.`);if(A.type.kind!==k.type.kind&&A.type.kind!=="value"&&k.type.kind!=="value")return g.error(`Cannot compare types '${Wr(A.type)}' and '${Wr(k.type)}'.`);n&&(A.type.kind==="value"&&k.type.kind!=="value"?A=new qo(k.type,[A]):A.type.kind!=="value"&&k.type.kind==="value"&&(k=new qo(A.type,[k])));let O=null;if(f.length===4){if(A.type.kind!=="string"&&k.type.kind!=="string"&&A.type.kind!=="value"&&k.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(O=g.parse(f[3],3,xn),!O)return null}return new nE(A,k,O)}evaluate(f){const g=this.lhs.evaluate(f),b=this.rhs.evaluate(f);if(n&&this.hasUntypedArgument){const A=rs(g),k=rs(b);if(A.kind!==k.kind||A.kind!=="string"&&A.kind!=="number")throw new Us(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${A.kind}, ${k.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const A=rs(g),k=rs(b);if(A.kind!=="string"||k.kind!=="string")return e(f,g,b)}return this.collator?i(f,g,b,this.collator.evaluate(f)):e(f,g,b)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[t];return this.eachChild(g=>{f.push(g.serialize())}),f}}}const Pf=On("==",function(t,e,i){return e===i},Ga),If=On("!=",function(t,e,i){return e!==i},function(t,e,i,n){return!Ga(0,e,i,n)}),Lf=On("<",function(t,e,i){return e<i},function(t,e,i,n){return n.compare(e,i)<0}),Df=On(">",function(t,e,i){return e>i},function(t,e,i,n){return n.compare(e,i)>0}),Rf=On("<=",function(t,e,i){return e<=i},function(t,e,i,n){return n.compare(e,i)<=0}),Tc=On(">=",function(t,e,i){return e>=i},function(t,e,i,n){return n.compare(e,i)>=0});class Al{constructor(e,i,n,c,f,g){this.type=Ki,this.number=e,this.locale=i,this.currency=n,this.unit=c,this.minFractionDigits=f,this.maxFractionDigits=g}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const n=i.parse(e[1],1,Yt);if(!n)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let f=null;if(c.locale&&(f=i.parse(c.locale,1,Ki),!f))return null;let g=null;if(c.currency&&(g=i.parse(c.currency,1,Ki),!g))return null;let b=null;if(c.unit&&(b=i.parse(c.unit,1,Ki),!b))return null;let A=null;if(c["min-fraction-digits"]&&(A=i.parse(c["min-fraction-digits"],1,Yt),!A))return null;let k=null;return c["max-fraction-digits"]&&(k=i.parse(c["max-fraction-digits"],1,Yt),!k)?null:new Al(n,f,g,b,A,k)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ml{constructor(e){this.type=Yt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=i.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Wr(n.type)} instead.`):new Ml(n):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Us(`Expected value to be of type string or array, but found ${Wr(rs(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Ec={"==":Pf,"!=":If,">":Df,"<":Lf,">=":Tc,"<=":Rf,array:qo,at:Cf,boolean:qo,case:ip,coalesce:Lu,collator:ss,format:Xo,image:yl,in:so,"index-of":zu,interpolate:zn,"interpolate-hcl":zn,"interpolate-lab":zn,length:Ml,let:vc,literal:Ho,match:kf,number:qo,"number-format":Al,object:qo,slice:Bu,step:Au,string:qo,"to-boolean":Zo,"to-color":Zo,"to-number":Zo,"to-string":Zo,var:Qd,within:ch};function xh(t,[e,i,n,c]){e=e.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);const f=c?c.evaluate(t):1,g=bu(e,i,n,f);if(g)throw new Us(g);return new cs(e/255*f,i/255*f,n/255*f,f)}function Yo(t,e){return t in e}function Sc(t,e){const i=e[t];return i===void 0?null:i}function Ks(t){return{type:t}}Ao.register(Ec,{error:[{kind:"error"},[Ki],(t,[e])=>{throw new Us(e.evaluate(t))}],typeof:[Ki,[Gi],(t,[e])=>Wr(rs(e.evaluate(t)))],"to-rgba":[Dn(Yt,4),[yn],(t,[e])=>e.evaluate(t).toArray()],rgb:[yn,[Yt,Yt,Yt],xh],rgba:[yn,[Yt,Yt,Yt,Yt],xh],has:{type:Vi,overloads:[[[Ki],(t,[e])=>Yo(e.evaluate(t),t.properties())],[[Ki,Ln],(t,[e,i])=>Yo(e.evaluate(t),i.evaluate(t))]]},get:{type:Gi,overloads:[[[Ki],(t,[e])=>Sc(e.evaluate(t),t.properties())],[[Ki,Ln],(t,[e,i])=>Sc(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Gi,[Ki],(t,[e])=>Sc(e.evaluate(t),t.featureState||{})],properties:[Ln,[],t=>t.properties()],"geometry-type":[Ki,[],t=>t.geometryType()],id:[Gi,[],t=>t.id()],zoom:[Yt,[],t=>t.globals.zoom],pitch:[Yt,[],t=>t.globals.pitch||0],"distance-from-center":[Yt,[],t=>t.distanceFromCenter()],"heatmap-density":[Yt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Yt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Yt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Gi,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Yt,Ks(Yt),(t,e)=>{let i=0;for(const n of e)i+=n.evaluate(t);return i}],"*":[Yt,Ks(Yt),(t,e)=>{let i=1;for(const n of e)i*=n.evaluate(t);return i}],"-":{type:Yt,overloads:[[[Yt,Yt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Yt],(t,[e])=>-e.evaluate(t)]]},"/":[Yt,[Yt,Yt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Yt,[Yt,Yt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Yt,[],()=>Math.LN2],pi:[Yt,[],()=>Math.PI],e:[Yt,[],()=>Math.E],"^":[Yt,[Yt,Yt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Yt,[Yt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Yt,[Yt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Yt,[Yt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Yt,[Yt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Yt,[Yt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Yt,[Yt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Yt,[Yt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Yt,[Yt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Yt,[Yt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Yt,[Yt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Yt,Ks(Yt),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[Yt,Ks(Yt),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[Yt,[Yt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Yt,[Yt],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Yt,[Yt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Yt,[Yt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Vi,[Ki,Gi],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[Vi,[Gi],(t,[e])=>t.id()===e.value],"filter-type-==":[Vi,[Ki],(t,[e])=>t.geometryType()===e.value],"filter-<":[Vi,[Ki,Gi],(t,[e,i])=>{const n=t.properties()[e.value],c=i.value;return typeof n==typeof c&&n<c}],"filter-id-<":[Vi,[Gi],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<n}],"filter->":[Vi,[Ki,Gi],(t,[e,i])=>{const n=t.properties()[e.value],c=i.value;return typeof n==typeof c&&n>c}],"filter-id->":[Vi,[Gi],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>n}],"filter-<=":[Vi,[Ki,Gi],(t,[e,i])=>{const n=t.properties()[e.value],c=i.value;return typeof n==typeof c&&n<=c}],"filter-id-<=":[Vi,[Gi],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<=n}],"filter->=":[Vi,[Ki,Gi],(t,[e,i])=>{const n=t.properties()[e.value],c=i.value;return typeof n==typeof c&&n>=c}],"filter-id->=":[Vi,[Gi],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>=n}],"filter-has":[Vi,[Gi],(t,[e])=>e.value in t.properties()],"filter-has-id":[Vi,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Vi,[Dn(Ki)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Vi,[Dn(Gi)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Vi,[Ki,Dn(Gi)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Vi,[Ki,Dn(Gi)],(t,[e,i])=>function(n,c,f,g){for(;f<=g;){const b=f+g>>1;if(c[b]===n)return!0;c[b]>n?g=b-1:f=b+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Vi,overloads:[[[Vi,Vi],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Ks(Vi),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:Vi,overloads:[[[Vi,Vi],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Ks(Vi),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[Vi,[Vi],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Vi,[Ki],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Ki,[Ki],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Ki,[Ki],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Ki,Ks(Gi),(t,e)=>e.map(i=>Wo(i.evaluate(t))).join("")],"resolved-locale":[Ki,[xn],(t,[e])=>e.evaluate(t).resolvedLocale()]});var Ac=Ec;function Mc(t){return{result:"success",value:t}}function $a(t){return{result:"error",value:t}}function Cl(t){return t["property-type"]==="data-driven"}function Mn(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Ko(t){return!!t.expression&&t.expression.interpolated}function ur(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function kl(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function rp(t){return t}function Pl(t,e){const i=e.type==="color",n=t.stops&&typeof t.stops[0][0]=="object",c=n||!(n||t.property!==void 0),f=t.type||(Ko(e)?"exponential":"interval");if(i&&((t=wo({},t)).stops&&(t.stops=t.stops.map(k=>[k[0],cs.parse(k[1])])),t.default=cs.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Va[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let g,b,A;if(f==="exponential")g=Jo;else if(f==="interval")g=Cc;else if(f==="categorical"){g=sp,b=Object.create(null);for(const k of t.stops)b[k[0]]=k[1];A=typeof t.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);g=vh}if(n){const k={},O=[];for(let H=0;H<t.stops.length;H++){const Z=t.stops[H],ee=Z[0].zoom;k[ee]===void 0&&(k[ee]={zoom:ee,type:t.type,property:t.property,default:t.default,stops:[]},O.push(ee)),k[ee].stops.push([Z[0].value,Z[1]])}const U=[];for(const H of O)U.push([k[H].zoom,Pl(k[H],e)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:zn.interpolationFactor.bind(void 0,V),zoomStops:U.map(H=>H[0]),evaluate:({zoom:H},Z)=>Jo({stops:U,base:t.base},e,H).evaluate(H,Z)}}if(c){const k=f==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:zn.interpolationFactor.bind(void 0,k),zoomStops:t.stops.map(O=>O[0]),evaluate:({zoom:O})=>g(t,e,O,b,A)}}return{kind:"source",evaluate(k,O){const U=O&&O.properties?O.properties[t.property]:void 0;return U===void 0?Il(t.default,e.default):g(t,e,U,b,A)}}}function Il(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function sp(t,e,i,n,c){return Il(typeof i===c?n[i]:void 0,t.default,e.default)}function Cc(t,e,i){if(ur(i)!=="number")return Il(t.default,e.default);const n=t.stops.length;if(n===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const c=uh(t.stops.map(f=>f[0]),i);return t.stops[c][1]}function Jo(t,e,i){const n=t.base!==void 0?t.base:1;if(ur(i)!=="number")return Il(t.default,e.default);const c=t.stops.length;if(c===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[c-1][0])return t.stops[c-1][1];const f=uh(t.stops.map(O=>O[0]),i),g=function(O,U,V,H){const Z=H-V,ee=O-V;return Z===0?0:U===1?ee/Z:(Math.pow(U,ee)-1)/(Math.pow(U,Z)-1)}(i,n,t.stops[f][0],t.stops[f+1][0]),b=t.stops[f][1],A=t.stops[f+1][1];let k=Mo[e.type]||rp;if(t.colorSpace&&t.colorSpace!=="rgb"){const O=Va[t.colorSpace];k=(U,V)=>O.reverse(O.interpolate(O.forward(U),O.forward(V),g))}return typeof b.evaluate=="function"?{evaluate(...O){const U=b.evaluate.apply(void 0,O),V=A.evaluate.apply(void 0,O);if(U!==void 0&&V!==void 0)return k(U,V,g)}}:k(b,A,g)}function vh(t,e,i){return e.type==="color"?i=cs.parse(i):e.type==="formatted"?i=bn.fromString(i.toString()):e.type==="resolvedImage"?i=un.fromString(i.toString()):ur(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Il(i,t.default,e.default)}class Js{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new Tu,this._defaultValue=i?function(n){return n.type==="color"&&(kl(n.default)||Array.isArray(n.default))?new cs(0,0,0,0):n.type==="color"?cs.parse(n.default)||null:n.default===void 0?null:n.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,n,c,f,g,b,A){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=n,this._evaluator.canonical=c||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=A||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,n,c,f,g,b,A){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=n||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=A||null;try{const k=this.expression.evaluate(this._evaluator);if(k==null||typeof k=="number"&&k!=k)return this._defaultValue;if(this._enumValues&&!(k in this._enumValues))throw new Us(`Expected value to be one of ${Object.keys(this._enumValues).map(O=>JSON.stringify(O)).join(", ")}, but found ${JSON.stringify(k)} instead.`);return k}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(k.message)),this._defaultValue}}}function yr(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Ac}function Ll(t,e){const i=new Su(Ac,[],e?function(c){const f={color:yn,string:Ki,number:Yt,enum:Ki,boolean:Vi,formatted:Ys,resolvedImage:Qn};return c.type==="array"?Dn(f[c.value]||Gi,c.length):f[c.type]}(e):void 0),n=i.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?Mc(new Js(n,e)):$a(i.errors)}class bh{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!io(i.expression)}evaluateWithoutErrorHandling(e,i,n,c,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,n,c,f,g)}evaluate(e,i,n,c,f,g){return this._styleExpression.evaluate(e,i,n,c,f,g)}}class Wa{constructor(e,i,n,c){this.kind=e,this.zoomStops=n,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!io(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,i,n,c,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,n,c,f,g)}evaluate(e,i,n,c,f,g){return this._styleExpression.evaluate(e,i,n,c,f,g)}interpolationFactor(e,i,n){return this.interpolationType?zn.interpolationFactor(this.interpolationType,e,i,n):0}}function ga(t,e){if((t=Ll(t,e)).result==="error")return t;const i=t.value.expression,n=Ba(i);if(!n&&!Cl(e))return $a([new To("","data expressions not supported")]);const c=Fa(i,["zoom","pitch","distance-from-center"]);if(!c&&!Mn(e))return $a([new To("","zoom expressions not supported")]);const f=kc(i);return f||c?f instanceof To?$a([f]):f instanceof zn&&!Ko(e)?$a([new To("",'"interpolate" expressions cannot be used with this property')]):Mc(f?new Wa(n?"camera":"composite",t.value,f.labels,f instanceof zn?f.interpolation:void 0):new bh(n?"constant":"source",t.value)):$a([new To("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Br{constructor(e,i){this._parameters=e,this._specification=i,wo(this,Pl(this._parameters,this._specification))}static deserialize(e){return new Br(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function kc(t){let e=null;if(t instanceof vc)e=kc(t.result);else if(t instanceof Lu){for(const i of t.args)if(e=kc(i),e)break}else(t instanceof Au||t instanceof zn)&&t.input instanceof Ao&&t.input.name==="zoom"&&(e=t);return e instanceof To||t.eachChild(i=>{const n=kc(i);n instanceof To?e=n:!e&&n?e=new To("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new To("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class ti{constructor(e,i,n,c){this.message=(e?`${e}: `:"")+n,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function Bn(t){const e=t.key,i=t.value,n=t.valueSpec||{},c=t.objectElementValidators||{},f=t.style,g=t.styleSpec;let b=[];const A=ur(i);if(A!=="object")return[new ti(e,i,`object expected, ${A} found`)];for(const k in i){const O=k.split(".")[0];let U;c[O]?U=c[O]:n[O]?U=Qs:c["*"]?U=c["*"]:n["*"]&&(U=Qs),U?b=b.concat(U({key:(e&&`${e}.`)+k,value:i[k],valueSpec:n[O]||n["*"],style:f,styleSpec:g,object:i,objectKey:k},i)):b.push(new ti(e,i[k],`unknown property "${k}"`))}for(const k in n)c[k]||n[k].required&&n[k].default===void 0&&i[k]===void 0&&b.push(new ti(e,i,`missing required property "${k}"`));return b}function Mi(t){const e=t.value,i=t.valueSpec,n=t.style,c=t.styleSpec,f=t.key,g=t.arrayElementValidator||Qs;if(ur(e)!=="array")return[new ti(f,e,`array expected, ${ur(e)} found`)];if(i.length&&e.length!==i.length)return[new ti(f,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new ti(f,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let b={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};c.$version<7&&(b.function=i.function),ur(i.value)==="object"&&(b=i.value);let A=[];for(let k=0;k<e.length;k++)A=A.concat(g({array:e,arrayIndex:k,value:e[k],valueSpec:b,style:n,styleSpec:c,key:`${f}[${k}]`}));return A}function Dl(t){const e=t.key,i=t.value,n=t.valueSpec;let c=ur(i);if(c==="number"&&i!=i&&(c="NaN"),c!=="number")return[new ti(e,i,`number expected, ${c} found`)];if("minimum"in n){let f=n.minimum;if(ur(n.minimum)==="array"&&(f=n.minimum[t.arrayIndex]),i<f)return[new ti(e,i,`${i} is less than the minimum value ${f}`)]}if("maximum"in n){let f=n.maximum;if(ur(n.maximum)==="array"&&(f=n.maximum[t.arrayIndex]),i>f)return[new ti(e,i,`${i} is greater than the maximum value ${f}`)]}return[]}function _a(t){const e=t.valueSpec,i=_s(t.value.type);let n,c,f,g={};const b=i!=="categorical"&&t.value.property===void 0,A=!b,k=ur(t.value.stops)==="array"&&ur(t.value.stops[0])==="array"&&ur(t.value.stops[0][0])==="object",O=Bn({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(H){if(i==="identity")return[new ti(H.key,H.value,'identity function may not have a "stops" property')];let Z=[];const ee=H.value;return Z=Z.concat(Mi({key:H.key,value:ee,valueSpec:H.valueSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:U})),ur(ee)==="array"&&ee.length===0&&Z.push(new ti(H.key,ee,"array must have at least one stop")),Z},default:function(H){return Qs({key:H.key,value:H.value,valueSpec:e,style:H.style,styleSpec:H.styleSpec})}}});return i==="identity"&&b&&O.push(new ti(t.key,t.value,'missing required property "property"')),i==="identity"||t.value.stops||O.push(new ti(t.key,t.value,'missing required property "stops"')),i==="exponential"&&t.valueSpec.expression&&!Ko(t.valueSpec)&&O.push(new ti(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(A&&!Cl(t.valueSpec)?O.push(new ti(t.key,t.value,"property functions not supported")):b&&!Mn(t.valueSpec)&&O.push(new ti(t.key,t.value,"zoom functions not supported"))),i!=="categorical"&&!k||t.value.property!==void 0||O.push(new ti(t.key,t.value,'"property" property is required')),O;function U(H){let Z=[];const ee=H.value,ce=H.key;if(ur(ee)!=="array")return[new ti(ce,ee,`array expected, ${ur(ee)} found`)];if(ee.length!==2)return[new ti(ce,ee,`array length 2 expected, length ${ee.length} found`)];if(k){if(ur(ee[0])!=="object")return[new ti(ce,ee,`object expected, ${ur(ee[0])} found`)];if(ee[0].zoom===void 0)return[new ti(ce,ee,"object stop key must have zoom")];if(ee[0].value===void 0)return[new ti(ce,ee,"object stop key must have value")];const _e=_s(ee[0].zoom);if(typeof _e!="number")return[new ti(ce,ee[0].zoom,"stop zoom values must be numbers")];if(f&&f>_e)return[new ti(ce,ee[0].zoom,"stop zoom values must appear in ascending order")];_e!==f&&(f=_e,c=void 0,g={}),Z=Z.concat(Bn({key:`${ce}[0]`,value:ee[0],valueSpec:{zoom:{}},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:Dl,value:V}}))}else Z=Z.concat(V({key:`${ce}[0]`,value:ee[0],style:H.style,styleSpec:H.styleSpec},ee));return yr(Ns(ee[1]))?Z.concat([new ti(`${ce}[1]`,ee[1],"expressions are not allowed in function stops.")]):Z.concat(Qs({key:`${ce}[1]`,value:ee[1],valueSpec:e,style:H.style,styleSpec:H.styleSpec}))}function V(H,Z){const ee=ur(H.value),ce=_s(H.value),_e=H.value!==null?H.value:Z;if(n){if(ee!==n)return[new ti(H.key,_e,`${ee} stop domain type must match previous stop domain type ${n}`)]}else n=ee;if(ee!=="number"&&ee!=="string"&&ee!=="boolean"&&typeof ce!="number"&&typeof ce!="string"&&typeof ce!="boolean")return[new ti(H.key,_e,"stop domain value must be a number, string, or boolean")];if(ee!=="number"&&i!=="categorical"){let Me=`number expected, ${ee} found`;return Cl(e)&&i===void 0&&(Me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ti(H.key,_e,Me)]}return i!=="categorical"||ee!=="number"||typeof ce=="number"&&isFinite(ce)&&Math.floor(ce)===ce?i!=="categorical"&&ee==="number"&&typeof ce=="number"&&typeof c=="number"&&c!==void 0&&ce<c?[new ti(H.key,_e,"stop domain values must appear in ascending order")]:(c=ce,i==="categorical"&&ce in g?[new ti(H.key,_e,"stop domain values must be unique")]:(g[ce]=!0,[])):[new ti(H.key,_e,`integer expected, found ${String(ce)}`)]}}function Vs(t){const e=(t.expressionContext==="property"?ga:Ll)(Ns(t.value),t.valueSpec);if(e.result==="error")return e.value.map(n=>new ti(`${t.key}${n.key}`,t.value,n.message));const i=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!i.outputDefined())return[new ti(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!io(i))return[new ti(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return ya(i,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Fa(i,["zoom","feature-state"]))return[new ti(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Ba(i))return[new ti(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ya(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const c of e.valueSpec.expression.parameters)i.delete(c);if(i.size===0)return[];const n=[];return t instanceof Ao&&i.has(t.name)?[new ti(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(c=>{n.push(...ya(c,e))}),n)}function qi(t){const e=t.key,i=t.value,n=t.valueSpec,c=[];return Array.isArray(n.values)?n.values.indexOf(_s(i))===-1&&c.push(new ti(e,i,`expected one of [${n.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(n.values).indexOf(_s(i))===-1&&c.push(new ti(e,i,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(i)} found`)),c}function Rl(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Rl(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function wh(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Rl(t)||(t=zl(t));const i=t;let n=!0;try{n=function(k){if(!Ha(k))return k;let O=Ns(k);return Th(O),O=np(O),O}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const c=ut[`filter_${e}`],f=Ll(n,c);let g=null;if(f.result==="error")throw new Error(f.value.map(k=>`${k.key}: ${k.message}`).join(", "));g=(k,O,U)=>f.value.evaluate(k,O,{},U);let b=null,A=null;if(n!==i){const k=Ll(i,c);if(k.result==="error")throw new Error(k.value.map(O=>`${O.key}: ${O.message}`).join(", "));b=(O,U,V,H,Z)=>k.value.evaluate(O,U,{},V,void 0,void 0,H,Z),A=!Ba(k.value.expression)}return{filter:g,dynamicFilter:b||void 0,needGeometry:op(n),needFeature:!!A}}function np(t){if(!Array.isArray(t))return t;const e=function(i){if(xa.has(i[0])){for(let n=1;n<i.length;n++)if(Ha(i[n]))return!0}return i}(t);return e===!0?e:e.map(i=>np(i))}function Th(t){let e=!1;const i=[];if(t[0]==="case"){for(let n=1;n<t.length-1;n+=2)e=e||Ha(t[n]),i.push(t[n+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||Ha(t[1]);for(let n=2;n<t.length-1;n+=2)i.push(t[n+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||Ha(t[1]);for(let n=1;n<t.length-1;n+=2)i.push(t[n+1])}e&&(t.length=0,t.push("any",...i));for(let n=1;n<t.length;n++)Th(t[n])}function Ha(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(Ha(t[i]))return!0;return!1}const xa=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function zf(t,e){return t<e?-1:t>e?1:0}function op(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(op(t[e]))return!0;return!1}function zl(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?Ol(t[1],t[2],"=="):e==="!="?Sh(Ol(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ol(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(zl))):e==="all"?["all"].concat(t.slice(1).map(zl)):e==="none"?["all"].concat(t.slice(1).map(zl).map(Sh)):e==="in"?Fu(t[1],t.slice(2)):e==="!in"?Sh(Fu(t[1],t.slice(2))):e==="has"?Eh(t[1]):e==="!has"?Sh(Eh(t[1])):e!=="within"||t;var i}function Ol(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function Fu(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(zf)]]:["filter-in-small",t,["literal",e]]}}function Eh(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Sh(t){return["!",t]}function Pc(t){return Rl(Ns(t.value))?Vs(wo({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Ic(t)}function Ic(t){const e=t.value,i=t.key;if(ur(e)!=="array")return[new ti(i,e,`array expected, ${ur(e)} found`)];const n=t.styleSpec;let c,f=[];if(e.length<1)return[new ti(i,e,"filter array must have at least 1 element")];switch(f=f.concat(qi({key:`${i}[0]`,value:e[0],valueSpec:n.filter_operator,style:t.style,styleSpec:t.styleSpec})),_s(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&_s(e[1])==="$type"&&f.push(new ti(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new ti(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=ur(e[1]),c!=="string"&&f.push(new ti(`${i}[1]`,e[1],`string expected, ${c} found`)));for(let g=2;g<e.length;g++)c=ur(e[g]),_s(e[1])==="$type"?f=f.concat(qi({key:`${i}[${g}]`,value:e[g],valueSpec:n.geometry_type,style:t.style,styleSpec:t.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&f.push(new ti(`${i}[${g}]`,e[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)f=f.concat(Ic({key:`${i}[${g}]`,value:e[g],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":c=ur(e[1]),e.length!==2?f.push(new ti(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&f.push(new ti(`${i}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=ur(e[1]),e.length!==2?f.push(new ti(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&f.push(new ti(`${i}[1]`,e[1],`object expected, ${c} found`))}return f}function Nu(t,e){const i=t.key,n=t.style,c=t.styleSpec,f=t.value,g=t.objectKey,b=c[`${e}_${t.layerType}`];if(!b)return[];const A=g.match(/^(.*)-transition$/);if(e==="paint"&&A&&b[A[1]]&&b[A[1]].transition)return Qs({key:i,value:f,valueSpec:c.transition,style:n,styleSpec:c});const k=t.valueSpec||b[g];if(!k)return[new ti(i,f,`unknown property "${g}"`)];let O;if(ur(f)==="string"&&Cl(k)&&!k.tokens&&(O=/^{([^}]+)}$/.exec(f))){const V=`\`{ "type": "identity", "property": ${O?JSON.stringify(O[1]):'"_"'} }\``;return[new ti(i,f,`"${g}" does not support interpolation syntax
Use an identity property function instead: ${V}.`)]}const U=[];return t.layerType==="symbol"&&(g==="text-field"&&n&&!n.glyphs&&U.push(new ti(i,f,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&kl(Ns(f))&&_s(f.type)==="identity"&&U.push(new ti(i,f,'"text-font" does not support identity functions'))),U.concat(Qs({key:t.key,value:f,valueSpec:k,style:n,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:g}))}function ap(t){return Nu(t,"paint")}function Ah(t){return Nu(t,"layout")}function lp(t){let e=[];const i=t.value,n=t.key,c=t.style,f=t.styleSpec;i.type||i.ref||e.push(new ti(n,i,'either "type" or "ref" is required'));let g=_s(i.type);const b=_s(i.ref);if(i.id){const A=_s(i.id);for(let k=0;k<t.arrayIndex;k++){const O=c.layers[k];_s(O.id)===A&&e.push(new ti(n,i.id,`duplicate layer id "${i.id}", previously used at line ${O.id.__line__}`))}}if("ref"in i){let A;["type","source","source-layer","filter","layout"].forEach(k=>{k in i&&e.push(new ti(n,i[k],`"${k}" is prohibited for ref layers`))}),c.layers.forEach(k=>{_s(k.id)===b&&(A=k)}),A?A.ref?e.push(new ti(n,i.ref,"ref cannot reference another ref layer")):g=_s(A.type):typeof b=="string"&&e.push(new ti(n,i.ref,`ref layer "${b}" not found`))}else if(g!=="background"&&g!=="sky")if(i.source){const A=c.sources&&c.sources[i.source],k=A&&_s(A.type);A?k==="vector"&&g==="raster"?e.push(new ti(n,i.source,`layer "${i.id}" requires a raster source`)):k==="raster"&&g!=="raster"?e.push(new ti(n,i.source,`layer "${i.id}" requires a vector source`)):k!=="vector"||i["source-layer"]?k==="raster-dem"&&g!=="hillshade"?e.push(new ti(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||k==="geojson"&&A.lineMetrics||e.push(new ti(n,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ti(n,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new ti(n,i.source,`source "${i.source}" not found`))}else e.push(new ti(n,i,'missing required property "source"'));return e=e.concat(Bn({key:n,value:i,valueSpec:f.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Qs({key:`${n}.type`,value:i.type,valueSpec:f.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:A=>Pc(wo({layerType:g},A)),layout:A=>Bn({layer:i,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":k=>Ah(wo({layerType:g},k))}}),paint:A=>Bn({layer:i,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":k=>ap(wo({layerType:g},k))}})}})),e}function va(t){const e=t.value,i=t.key,n=ur(e);return n!=="string"?[new ti(i,e,`string expected, ${n} found`)]:[]}const Uu={promoteId:function({key:t,value:e}){if(ur(e)==="string")return va({key:t,value:e});{const i=[];for(const n in e)i.push(...va({key:`${t}.${n}`,value:e[n]}));return i}}};function ju(t){const e=t.value,i=t.key,n=t.styleSpec,c=t.style;if(!e.type)return[new ti(i,e,'"type" is required')];const f=_s(e.type);let g;switch(f){case"vector":case"raster":case"raster-dem":return g=Bn({key:i,value:e,valueSpec:n[`source_${f.replace("-","_")}`],style:t.style,styleSpec:n,objectElementValidators:Uu}),g;case"geojson":if(g=Bn({key:i,value:e,valueSpec:n.source_geojson,style:c,styleSpec:n,objectElementValidators:Uu}),e.cluster)for(const b in e.clusterProperties){const[A,k]=e.clusterProperties[b],O=typeof A=="string"?[A,["accumulated"],["get",b]]:A;g.push(...Vs({key:`${i}.${b}.map`,value:k,expressionContext:"cluster-map"})),g.push(...Vs({key:`${i}.${b}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return g;case"video":return Bn({key:i,value:e,valueSpec:n.source_video,style:c,styleSpec:n});case"image":return Bn({key:i,value:e,valueSpec:n.source_image,style:c,styleSpec:n});case"canvas":return[new ti(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qi({key:`${i}.type`,value:e.type,valueSpec:{values:Co(n)}})}}function Co(t){return t.source.reduce((e,i)=>{const n=t[i];return n.type.type==="enum"&&(e=e.concat(Object.keys(n.type.values))),e},[])}function cp(t){const e=t.value,i=t.styleSpec,n=i.light,c=t.style;let f=[];const g=ur(e);if(e===void 0)return f;if(g!=="object")return f=f.concat([new ti("light",e,`object expected, ${g} found`)]),f;for(const b in e){const A=b.match(/^(.*)-transition$/);f=f.concat(A&&n[A[1]]&&n[A[1]].transition?Qs({key:b,value:e[b],valueSpec:i.transition,style:c,styleSpec:i}):n[b]?Qs({key:b,value:e[b],valueSpec:n[b],style:c,styleSpec:i}):[new ti(b,e[b],`unknown property "${b}"`)])}return f}function Vu(t){const e=t.value,i=t.key,n=t.style,c=t.styleSpec,f=c.terrain;let g=[];const b=ur(e);if(e===void 0)return g;if(b!=="object")return g=g.concat([new ti("terrain",e,`object expected, ${b} found`)]),g;for(const A in e){const k=A.match(/^(.*)-transition$/);g=g.concat(k&&f[k[1]]&&f[k[1]].transition?Qs({key:A,value:e[A],valueSpec:c.transition,style:n,styleSpec:c}):f[A]?Qs({key:A,value:e[A],valueSpec:f[A],style:n,styleSpec:c}):[new ti(A,e[A],`unknown property "${A}"`)])}if(e.source){const A=n.sources&&n.sources[e.source],k=A&&_s(A.type);A?k!=="raster-dem"&&g.push(new ti(i,e.source,`terrain cannot be used with a source of type ${String(k)}, it only be used with a "raster-dem" source type`)):g.push(new ti(i,e.source,`source "${e.source}" not found`))}else g.push(new ti(i,e,'terrain is missing required property "source"'));return g}function hp(t){const e=t.value,i=t.style,n=t.styleSpec,c=n.fog;let f=[];const g=ur(e);if(e===void 0)return f;if(g!=="object")return f=f.concat([new ti("fog",e,`object expected, ${g} found`)]),f;for(const b in e){const A=b.match(/^(.*)-transition$/);f=f.concat(A&&c[A[1]]&&c[A[1]].transition?Qs({key:b,value:e[b],valueSpec:n.transition,style:i,styleSpec:n}):c[b]?Qs({key:b,value:e[b],valueSpec:c[b],style:i,styleSpec:n}):[new ti(b,e[b],`unknown property "${b}"`)])}return f}const Gu={"*":()=>[],array:Mi,boolean:function(t){const e=t.value,i=t.key,n=ur(e);return n!=="boolean"?[new ti(i,e,`boolean expected, ${n} found`)]:[]},number:Dl,color:function(t){const e=t.key,i=t.value,n=ur(i);return n!=="string"?[new ti(e,i,`color expected, ${n} found`)]:yu(i)===null?[new ti(e,i,`color expected, "${i}" found`)]:[]},enum:qi,filter:Pc,function:_a,layer:lp,object:Bn,source:ju,light:cp,terrain:Vu,fog:hp,string:va,formatted:function(t){return va(t).length===0?[]:Vs(t)},resolvedImage:function(t){return va(t).length===0?[]:Vs(t)},projection:function(t){const e=t.value,i=t.styleSpec,n=i.projection,c=t.style;let f=[];const g=ur(e);if(g==="object")for(const b in e)f=f.concat(Qs({key:b,value:e[b],valueSpec:n[b],style:c,styleSpec:i}));else g!=="string"&&(f=f.concat([new ti("projection",e,`object or string expected, ${g} found`)]));return f}};function Qs(t){const e=t.value,i=t.valueSpec,n=t.styleSpec;return i.expression&&kl(_s(e))?_a(t):i.expression&&yr(Ns(e))?Vs(t):i.type&&Gu[i.type]?Gu[i.type](t):Bn(wo({},t,{valueSpec:i.type?n[i.type]:i}))}function Of(t){const e=t.value,i=t.key,n=va(t);return n.length||(e.indexOf("{fontstack}")===-1&&n.push(new ti(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&n.push(new ti(i,e,'"glyphs" url must include a "{range}" token'))),n}function Lc(t,e=ut){return Fn(Qs({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Of,"*":()=>[]}}))}const Bf=t=>Fn(ap(t)),up=t=>Fn(Ah(t));function Fn(t){return t.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function dp(t,e){let i=!1;if(e&&e.length)for(const n of e)t.fire(new Go(new Error(n.message))),i=!0;return i}var pp=ko,no=3;function ko(t,e,i){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var c=new Int32Array(this.arrayBuffer);t=c[0],this.d=(e=c[1])+2*(i=c[2]);for(var f=0;f<this.d*this.d;f++){var g=c[no+f],b=c[no+f+1];n.push(g===b?null:c.subarray(g,b))}var A=c[no+n.length+1];this.keys=c.subarray(c[no+n.length],A),this.bboxes=c.subarray(A),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var k=0;k<this.d*this.d;k++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var O=i/e*t;this.min=-O,this.max=t+O}ko.prototype.insert=function(t,e,i,n,c){this._forEachCell(e,i,n,c,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(c)},ko.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ko.prototype._insertCell=function(t,e,i,n,c,f){this.cells[c].push(f)},ko.prototype.query=function(t,e,i,n,c){var f=this.min,g=this.max;if(t<=f&&e<=f&&g<=i&&g<=n&&!c)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(t,e,i,n,this._queryCell,b,{},c),b},ko.prototype._queryCell=function(t,e,i,n,c,f,g,b){var A=this.cells[c];if(A!==null)for(var k=this.keys,O=this.bboxes,U=0;U<A.length;U++){var V=A[U];if(g[V]===void 0){var H=4*V;(b?b(O[H+0],O[H+1],O[H+2],O[H+3]):t<=O[H+2]&&e<=O[H+3]&&i>=O[H+0]&&n>=O[H+1])?(g[V]=!0,f.push(k[V])):g[V]=!1}}},ko.prototype._forEachCell=function(t,e,i,n,c,f,g,b){for(var A=this._convertToCellCoord(t),k=this._convertToCellCoord(e),O=this._convertToCellCoord(i),U=this._convertToCellCoord(n),V=A;V<=O;V++)for(var H=k;H<=U;H++){var Z=this.d*H+V;if((!b||b(this._convertFromCellCoord(V),this._convertFromCellCoord(H),this._convertFromCellCoord(V+1),this._convertFromCellCoord(H+1)))&&c.call(this,t,e,i,n,Z,f,g,b))return}},ko.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ko.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ko.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=no+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var c=new Int32Array(e+i+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var f=e,g=0;g<t.length;g++){var b=t[g];c[no+g]=f,c.set(b,f),f+=b.length}return c[no+t.length]=f,c.set(this.keys,f),c[no+t.length+1]=f+=this.keys.length,c.set(this.bboxes,f),f+=this.bboxes.length,c.buffer};var qa=Be(pp);const Qo={};function ni(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Qo[e]={klass:t,omit:i.omit||[]}}ni(Object,"Object"),qa.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},qa.deserialize=function(t){return new qa(t.buffer)},Object.defineProperty(qa,"name",{value:"Grid"}),ni(qa,"Grid"),ni(cs,"Color"),ni(Error,"Error"),ni(Kn,"AJAXError"),ni(un,"ResolvedImage"),ni(Br,"StylePropertyFunction"),ni(Js,"StyleExpression",{omit:["_evaluator"]}),ni(Wa,"ZoomDependentExpression"),ni(bh,"ZoomConstantExpression"),ni(Ao,"CompoundExpression",{omit:["_evaluate"]});for(const t in Ac)Qo[Ac[t]._classRegistryKey]||ni(Ac[t],`Expression${t}`);function $u(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Wu(t){return X.ImageBitmap&&t instanceof X.ImageBitmap}function Xa(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if($u(t)||Wu(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.push(i.buffer),i}if(t instanceof X.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const n of t)i.push(Xa(n,e));return i}if(typeof t=="object"){const i=t.constructor,n=i._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const c=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const f in t)t.hasOwnProperty(f)&&(Qo[n].omit.indexOf(f)>=0||(c[f]=Xa(t[f],e)));t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(c.$name=n),c}throw new Error("can't serialize object of type "+typeof t)}function ba(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||$u(t)||Wu(t)||ArrayBuffer.isView(t)||t instanceof X.ImageData)return t;if(Array.isArray(t))return t.map(ba);if(typeof t=="object"){const e=t.$name||"Object",{klass:i}=Qo[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const n=Object.create(i.prototype);for(const c of Object.keys(t))c!=="$name"&&(n[c]=ba(t[c]));return n}throw new Error("can't deserialize object of type "+typeof t)}const Zt={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function Hu(t){for(const e of t)if(qu(e.charCodeAt(0)))return!0;return!1}function Ff(t){for(const e of t)if(!Mh(e.charCodeAt(0)))return!1;return!0}function Mh(t){return!(Zt.Arabic(t)||Zt["Arabic Supplement"](t)||Zt["Arabic Extended-A"](t)||Zt["Arabic Presentation Forms-A"](t)||Zt["Arabic Presentation Forms-B"](t))}function qu(t){return!(t!==746&&t!==747&&(t<4352||!(Zt["Bopomofo Extended"](t)||Zt.Bopomofo(t)||Zt["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Zt["CJK Compatibility Ideographs"](t)||Zt["CJK Compatibility"](t)||Zt["CJK Radicals Supplement"](t)||Zt["CJK Strokes"](t)||!(!Zt["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Zt["CJK Unified Ideographs Extension A"](t)||Zt["CJK Unified Ideographs"](t)||Zt["Enclosed CJK Letters and Months"](t)||Zt["Hangul Compatibility Jamo"](t)||Zt["Hangul Jamo Extended-A"](t)||Zt["Hangul Jamo Extended-B"](t)||Zt["Hangul Jamo"](t)||Zt["Hangul Syllables"](t)||Zt.Hiragana(t)||Zt["Ideographic Description Characters"](t)||Zt.Kanbun(t)||Zt["Kangxi Radicals"](t)||Zt["Katakana Phonetic Extensions"](t)||Zt.Katakana(t)&&t!==12540||!(!Zt["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Zt["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Zt["Unified Canadian Aboriginal Syllabics"](t)||Zt["Unified Canadian Aboriginal Syllabics Extended"](t)||Zt["Vertical Forms"](t)||Zt["Yijing Hexagram Symbols"](t)||Zt["Yi Syllables"](t)||Zt["Yi Radicals"](t))))}function Za(t){return!(qu(t)||function(e){return!!(Zt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Zt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Zt["Letterlike Symbols"](e)||Zt["Number Forms"](e)||Zt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Zt["Control Pictures"](e)&&e!==9251||Zt["Optical Character Recognition"](e)||Zt["Enclosed Alphanumerics"](e)||Zt["Geometric Shapes"](e)||Zt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Zt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Zt["CJK Symbols and Punctuation"](e)||Zt.Katakana(e)||Zt["Private Use Area"](e)||Zt["CJK Compatibility Forms"](e)||Zt["Small Form Variants"](e)||Zt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function fp(t){return t>=1424&&t<=2303||Zt["Arabic Presentation Forms-A"](t)||Zt["Arabic Presentation Forms-B"](t)}function Xu(t,e){return!(!e&&fp(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Zt.Khmer(t))}function Nf(t){for(const e of t)if(fp(e.charCodeAt(0)))return!0;return!1}const Dc="deferred",Ch="loading",Zu="loaded";let Bl=null,d="unavailable",r=null;const l=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(d="error"),Bl&&Bl(t)};function m(){v.fire(new bo("pluginStateChange",{pluginStatus:d,pluginURL:r}))}const v=new Dr,T=function(){return d},P=function(){if(d!==Dc||!r)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");d=Ch,m(),r&&Ws({url:r},t=>{t?l(t):(d=Zu,m())})},I={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>d===Zu||I.applyArabicShaping!=null,isLoading:()=>d===Ch,setState(t){d=t.pluginStatus,r=t.pluginURL},isParsed:()=>I.applyArabicShaping!=null&&I.processBidirectionalText!=null&&I.processStyledBidirectionalText!=null,getPluginURL:()=>r};class F{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,n){for(const c of i)if(!Xu(c.charCodeAt(0),n))return!1;return!0}(e,I.isLoaded())}}class G{constructor(e,i){this.property=e,this.value=i,this.expression=function(n,c){if(kl(n))return new Br(n,c);if(yr(n)){const f=ga(n,c);if(f.result==="error")throw new Error(f.value.map(g=>`${g.key}: ${g.message}`).join(", "));return f.value}{let f=n;return typeof n=="string"&&c.type==="color"&&(f=cs.parse(n)),{kind:"constant",evaluate:()=>f}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,n){return this.property.possiblyEvaluate(this,e,i,n)}}class ${constructor(e){this.property=e,this.value=new G(e,void 0)}transitioned(e,i){return new le(this.property,this.value,i,br({},e.transition,this.transition),e.now)}untransitioned(){return new le(this.property,this.value,null,{},0)}}class K{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Ce(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new $(this._values[e].property)),this._values[e].value=new G(this._values[e].property,i===null?void 0:Ce(i))}getTransition(e){return Ce(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new $(this._values[e].property)),this._values[e].transition=Ce(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const n=this.getValue(i);n!==void 0&&(e[i]=n);const c=this.getTransition(i);c!==void 0&&(e[`${i}-transition`]=c)}return e}transitioned(e,i){const n=new de(this._properties);for(const c of Object.keys(this._values))n._values[c]=this._values[c].transitioned(e,i._values[c]);return n}untransitioned(){const e=new de(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class le{constructor(e,i,n,c,f){const g=c.delay||0,b=c.duration||0;f=f||0,this.property=e,this.value=i,this.begin=f+g,this.end=this.begin+b,e.specification.transition&&(c.delay||c.duration)&&(this.prior=n)}possiblyEvaluate(e,i,n){const c=e.now||0,f=this.value.possiblyEvaluate(e,i,n),g=this.prior;if(g){if(c>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(c<this.begin)return g.possiblyEvaluate(e,i,n);{const b=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,i,n),f,li(b))}}return f}}class de{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,n){const c=new ge(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(e,i,n);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class fe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Ce(this._values[e].value)}setValue(e,i){this._values[e]=new G(this._values[e].property,i===null?void 0:Ce(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const n=this.getValue(i);n!==void 0&&(e[i]=n)}return e}possiblyEvaluate(e,i,n){const c=new ge(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(e,i,n);return c}}class pe{constructor(e,i,n){this.property=e,this.value=i,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,n,c){return this.property.evaluate(this.value,this.parameters,e,i,n,c)}}class ge{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class J{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,n){const c=Mo[this.specification.type];return c?c(e,i,n):e}}class ue{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,n,c){return new pe(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},n,c)}:e.expression,i)}interpolate(e,i,n){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new pe(this,{kind:"constant",value:void 0},e.parameters);const c=Mo[this.specification.type];return c?new pe(this,{kind:"constant",value:c(e.value.value,i.value.value,n)},e.parameters):e}evaluate(e,i,n,c,f,g){return e.kind==="constant"?e.value:e.evaluate(i,n,c,f,g)}}class ve{constructor(e){this.specification=e}possiblyEvaluate(e,i,n,c){return!!e.expression.evaluate(i,null,{},n,c)}interpolate(){return!1}}class be{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new F(0,{});for(const n in e){const c=e[n];c.specification.overridable&&this.overridableProperties.push(n);const f=this.defaultPropertyValues[n]=new G(c,void 0),g=this.defaultTransitionablePropertyValues[n]=new $(c);this.defaultTransitioningPropertyValues[n]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=f.possiblyEvaluate(i)}}}function ze(t,e){return 256*(t=vi(Math.floor(t),0,255))+vi(Math.floor(e),0,255)}ni(ue,"DataDrivenProperty"),ni(J,"DataConstantProperty"),ni(ve,"ColorRampProperty");const Pe={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Oe{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xe{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function $e(t,e=1){let i=0,n=0;return{members:t.map(c=>{const f=Pe[c.type].BYTES_PER_ELEMENT,g=i=it(i,Math.max(e,f)),b=c.components||1;return n=Math.max(n,f),i+=f*b,{name:c.name,type:c.type,components:b,offset:g}}),size:it(i,Math.max(n,e)),alignment:e}}function it(t,e){return Math.ceil(t/e)*e}class Mt extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,i)}emplace(e,i,n){const c=2*e;return this.int16[c+0]=i,this.int16[c+1]=n,e}}Mt.prototype.bytesPerElement=4,ni(Mt,"StructArrayLayout2i4");class et extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,n)}emplace(e,i,n,c){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=n,this.int16[f+2]=c,e}}et.prototype.bytesPerElement=6,ni(et,"StructArrayLayout3i6");class gt extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,n,c)}emplace(e,i,n,c,f){const g=4*e;return this.int16[g+0]=i,this.int16[g+1]=n,this.int16[g+2]=c,this.int16[g+3]=f,e}}gt.prototype.bytesPerElement=8,ni(gt,"StructArrayLayout4i8");class ot extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,c,f,g,b){const A=this.length;return this.resize(A+1),this.emplace(A,e,i,n,c,f,g,b)}emplace(e,i,n,c,f,g,b,A){const k=6*e,O=12*e,U=3*e;return this.int16[k+0]=i,this.int16[k+1]=n,this.uint8[O+4]=c,this.uint8[O+5]=f,this.uint8[O+6]=g,this.uint8[O+7]=b,this.float32[U+2]=A,e}}ot.prototype.bytesPerElement=12,ni(ot,"StructArrayLayout2i4ub1f12");class Pt extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,n,c)}emplace(e,i,n,c,f){const g=4*e;return this.float32[g+0]=i,this.float32[g+1]=n,this.float32[g+2]=c,this.float32[g+3]=f,e}}Pt.prototype.bytesPerElement=16,ni(Pt,"StructArrayLayout4f16");class Je extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,n,c,f)}emplace(e,i,n,c,f,g){const b=6*e,A=3*e;return this.uint16[b+0]=i,this.uint16[b+1]=n,this.uint16[b+2]=c,this.uint16[b+3]=f,this.float32[A+2]=g,e}}Je.prototype.bytesPerElement=12,ni(Je,"StructArrayLayout4ui1f12");class _t extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,n,c)}emplace(e,i,n,c,f){const g=4*e;return this.uint16[g+0]=i,this.uint16[g+1]=n,this.uint16[g+2]=c,this.uint16[g+3]=f,e}}_t.prototype.bytesPerElement=8,ni(_t,"StructArrayLayout4ui8");class Lt extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n,c,f,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,n,c,f,g)}emplace(e,i,n,c,f,g,b){const A=6*e;return this.int16[A+0]=i,this.int16[A+1]=n,this.int16[A+2]=c,this.int16[A+3]=f,this.int16[A+4]=g,this.int16[A+5]=b,e}}Lt.prototype.bytesPerElement=12,ni(Lt,"StructArrayLayout6i12");class ft extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n,c,f,g,b,A,k,O,U,V){const H=this.length;return this.resize(H+1),this.emplace(H,e,i,n,c,f,g,b,A,k,O,U,V)}emplace(e,i,n,c,f,g,b,A,k,O,U,V,H){const Z=12*e;return this.int16[Z+0]=i,this.int16[Z+1]=n,this.int16[Z+2]=c,this.int16[Z+3]=f,this.uint16[Z+4]=g,this.uint16[Z+5]=b,this.uint16[Z+6]=A,this.uint16[Z+7]=k,this.int16[Z+8]=O,this.int16[Z+9]=U,this.int16[Z+10]=V,this.int16[Z+11]=H,e}}ft.prototype.bytesPerElement=24,ni(ft,"StructArrayLayout4i4ui4i24");class Rt extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,c,f,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,n,c,f,g)}emplace(e,i,n,c,f,g,b){const A=10*e,k=5*e;return this.int16[A+0]=i,this.int16[A+1]=n,this.int16[A+2]=c,this.float32[k+2]=f,this.float32[k+3]=g,this.float32[k+4]=b,e}}Rt.prototype.bytesPerElement=20,ni(Rt,"StructArrayLayout3i3f20");class mi extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}mi.prototype.bytesPerElement=4,ni(mi,"StructArrayLayout1ul4");class ki extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n,c,f,g,b,A,k,O,U,V,H){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,i,n,c,f,g,b,A,k,O,U,V,H)}emplace(e,i,n,c,f,g,b,A,k,O,U,V,H,Z){const ee=20*e,ce=10*e;return this.int16[ee+0]=i,this.int16[ee+1]=n,this.int16[ee+2]=c,this.int16[ee+3]=f,this.int16[ee+4]=g,this.float32[ce+3]=b,this.float32[ce+4]=A,this.float32[ce+5]=k,this.float32[ce+6]=O,this.int16[ee+14]=U,this.uint32[ce+8]=V,this.uint16[ee+18]=H,this.uint16[ee+19]=Z,e}}ki.prototype.bytesPerElement=40,ni(ki,"StructArrayLayout5i4f1i1ul2ui40");class oi extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n,c,f,g,b){const A=this.length;return this.resize(A+1),this.emplace(A,e,i,n,c,f,g,b)}emplace(e,i,n,c,f,g,b,A){const k=8*e;return this.int16[k+0]=i,this.int16[k+1]=n,this.int16[k+2]=c,this.int16[k+4]=f,this.int16[k+5]=g,this.int16[k+6]=b,this.int16[k+7]=A,e}}oi.prototype.bytesPerElement=16,ni(oi,"StructArrayLayout3i2i2i16");class _i extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,n,c,f)}emplace(e,i,n,c,f,g){const b=4*e,A=8*e;return this.float32[b+0]=i,this.float32[b+1]=n,this.float32[b+2]=c,this.int16[A+6]=f,this.int16[A+7]=g,e}}_i.prototype.bytesPerElement=16,ni(_i,"StructArrayLayout2f1f2i16");class Oi extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,n,c)}emplace(e,i,n,c,f){const g=12*e,b=3*e;return this.uint8[g+0]=i,this.uint8[g+1]=n,this.float32[b+1]=c,this.float32[b+2]=f,e}}Oi.prototype.bytesPerElement=12,ni(Oi,"StructArrayLayout2ub2f12");class Bi extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,n)}emplace(e,i,n,c){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=n,this.float32[f+2]=c,e}}Bi.prototype.bytesPerElement=12,ni(Bi,"StructArrayLayout3f12");class di extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,n)}emplace(e,i,n,c){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=n,this.uint16[f+2]=c,e}}di.prototype.bytesPerElement=6,ni(di,"StructArrayLayout3ui6");class xr extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,n,c,f,g,b,A,k,O,U,V,H,Z,ee,ce,_e,Me,ye,Se,Le){const ke=this.length;return this.resize(ke+1),this.emplace(ke,e,i,n,c,f,g,b,A,k,O,U,V,H,Z,ee,ce,_e,Me,ye,Se,Le)}emplace(e,i,n,c,f,g,b,A,k,O,U,V,H,Z,ee,ce,_e,Me,ye,Se,Le,ke){const nt=30*e,tt=15*e,mt=60*e;return this.int16[nt+0]=i,this.int16[nt+1]=n,this.int16[nt+2]=c,this.float32[tt+2]=f,this.float32[tt+3]=g,this.uint16[nt+8]=b,this.uint16[nt+9]=A,this.uint32[tt+5]=k,this.uint32[tt+6]=O,this.uint32[tt+7]=U,this.uint16[nt+16]=V,this.uint16[nt+17]=H,this.uint16[nt+18]=Z,this.float32[tt+10]=ee,this.float32[tt+11]=ce,this.uint8[mt+48]=_e,this.uint8[mt+49]=Me,this.uint8[mt+50]=ye,this.uint32[tt+13]=Se,this.int16[nt+28]=Le,this.uint8[mt+58]=ke,e}}xr.prototype.bytesPerElement=60,ni(xr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Er extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,n,c,f,g,b,A,k,O,U,V,H,Z,ee,ce,_e,Me,ye,Se,Le,ke,nt,tt,mt,zt,at,bt,wt,Ct){const Nt=this.length;return this.resize(Nt+1),this.emplace(Nt,e,i,n,c,f,g,b,A,k,O,U,V,H,Z,ee,ce,_e,Me,ye,Se,Le,ke,nt,tt,mt,zt,at,bt,wt,Ct)}emplace(e,i,n,c,f,g,b,A,k,O,U,V,H,Z,ee,ce,_e,Me,ye,Se,Le,ke,nt,tt,mt,zt,at,bt,wt,Ct,Nt){const dt=38*e,Xt=19*e;return this.int16[dt+0]=i,this.int16[dt+1]=n,this.int16[dt+2]=c,this.float32[Xt+2]=f,this.float32[Xt+3]=g,this.int16[dt+8]=b,this.int16[dt+9]=A,this.int16[dt+10]=k,this.int16[dt+11]=O,this.int16[dt+12]=U,this.int16[dt+13]=V,this.uint16[dt+14]=H,this.uint16[dt+15]=Z,this.uint16[dt+16]=ee,this.uint16[dt+17]=ce,this.uint16[dt+18]=_e,this.uint16[dt+19]=Me,this.uint16[dt+20]=ye,this.uint16[dt+21]=Se,this.uint16[dt+22]=Le,this.uint16[dt+23]=ke,this.uint16[dt+24]=nt,this.uint16[dt+25]=tt,this.uint16[dt+26]=mt,this.uint16[dt+27]=zt,this.uint16[dt+28]=at,this.uint32[Xt+15]=bt,this.float32[Xt+16]=wt,this.float32[Xt+17]=Ct,this.float32[Xt+18]=Nt,e}}Er.prototype.bytesPerElement=76,ni(Er,"StructArrayLayout3i2f6i15ui1ul3f76");class Sr extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Sr.prototype.bytesPerElement=4,ni(Sr,"StructArrayLayout1f4");class Ar extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,n,c,f)}emplace(e,i,n,c,f,g){const b=5*e;return this.float32[b+0]=i,this.float32[b+1]=n,this.float32[b+2]=c,this.float32[b+3]=f,this.float32[b+4]=g,e}}Ar.prototype.bytesPerElement=20,ni(Ar,"StructArrayLayout5f20");class en extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,n,c)}emplace(e,i,n,c,f){const g=6*e;return this.uint32[3*e+0]=i,this.uint16[g+2]=n,this.uint16[g+3]=c,this.uint16[g+4]=f,e}}en.prototype.bytesPerElement=12,ni(en,"StructArrayLayout1ul3ui12");class Gs extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,i)}emplace(e,i,n){const c=2*e;return this.uint16[c+0]=i,this.uint16[c+1]=n,e}}Gs.prototype.bytesPerElement=4,ni(Gs,"StructArrayLayout2ui4");class Nn extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Nn.prototype.bytesPerElement=2,ni(Nn,"StructArrayLayout1ui2");class wr extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,i)}emplace(e,i,n){const c=2*e;return this.float32[c+0]=i,this.float32[c+1]=n,e}}wr.prototype.bytesPerElement=8,ni(wr,"StructArrayLayout2f8");class Fr extends Oe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Fr.prototype.size=40;class Lr extends ki{get(e){return new Fr(this,e)}}ni(Lr,"CollisionBoxArray");class or extends Oe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}or.prototype.size=60;class ys extends xr{get(e){return new or(this,e)}}ni(ys,"PlacedSymbolArray");class dn extends Oe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}dn.prototype.size=76;class Nr extends Er{get(e){return new dn(this,e)}}ni(Nr,"SymbolInstanceArray");class ks extends Sr{getoffsetX(e){return this.float32[1*e+0]}}ni(ks,"GlyphOffsetArray");class kh extends Mt{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ni(kh,"SymbolLineVertexArray");class ea extends Oe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ea.prototype.size=12;class Fl extends en{get(e){return new ea(this,e)}}ni(Fl,"FeatureIndexArray");class Po extends Gs{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ni(Po,"FillExtrusionCentroidArray");const ta=$e([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ya=$e([{name:"a_dash",components:4,type:"Uint16"}]);var ns={exports:{}},Rc={exports:{}};Rc.exports=function(t,e){var i,n,c,f,g,b,A,k;for(n=t.length-(i=3&t.length),c=e,g=3432918353,b=461845907,k=0;k<n;)A=255&t.charCodeAt(k)|(255&t.charCodeAt(++k))<<8|(255&t.charCodeAt(++k))<<16|(255&t.charCodeAt(++k))<<24,++k,c=27492+(65535&(f=5*(65535&(c=(c^=A=(65535&(A=(A=(65535&A)*g+(((A>>>16)*g&65535)<<16)&4294967295)<<15|A>>>17))*b+(((A>>>16)*b&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(A=0,i){case 3:A^=(255&t.charCodeAt(k+2))<<16;case 2:A^=(255&t.charCodeAt(k+1))<<8;case 1:c^=A=(65535&(A=(A=(65535&(A^=255&t.charCodeAt(k)))*g+(((A>>>16)*g&65535)<<16)&4294967295)<<15|A>>>17))*b+(((A>>>16)*b&65535)<<16)&4294967295}return c^=t.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var Yu=Rc.exports,Uf={exports:{}};Uf.exports=function(t,e){for(var i,n=t.length,c=e^n,f=0;n>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(f)|(255&t.charCodeAt(++f))<<8|(255&t.charCodeAt(++f))<<16|(255&t.charCodeAt(++f))<<24))+((1540483477*(i>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),n-=4,++f;switch(n){case 3:c^=(255&t.charCodeAt(f+2))<<16;case 2:c^=(255&t.charCodeAt(f+1))<<8;case 1:c=1540483477*(65535&(c^=255&t.charCodeAt(f)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var Ku=Yu,Ph=Uf.exports;ns.exports=Ku,ns.exports.murmur3=Ku,ns.exports.murmur2=Ph;var jf=Be(ns.exports);class Jr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,n,c){this.ids.push(dg(e)),this.positions.push(i,n,c)}getPositions(e){const i=dg(e);let n=0,c=this.ids.length-1;for(;n<c;){const g=n+c>>1;this.ids[g]>=i?c=g:n=g+1}const f=[];for(;this.ids[n]===i;)f.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return f}static serialize(e,i){const n=new Float64Array(e.ids),c=new Uint32Array(e.positions);return mp(n,c,0,n.length-1),i&&i.push(n.buffer,c.buffer),{ids:n,positions:c}}static deserialize(e){const i=new Jr;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function dg(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:jf(String(t))}function mp(t,e,i,n){for(;i<n;){const c=t[i+n>>1];let f=i-1,g=n+1;for(;;){do f++;while(t[f]<c);do g--;while(t[g]>c);if(f>=g)break;Ju(t,f,g),Ju(e,3*f,3*g),Ju(e,3*f+1,3*g+1),Ju(e,3*f+2,3*g+2)}g-i<n-g?(mp(t,e,i,g),i=g+1):(mp(t,e,g+1,n),n=g)}}function Ju(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}ni(Jr,"FeaturePositionMap");class wa{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class Ms extends wa{constructor(e){super(e),this.current=0}set(e,i,n){this.fetchUniformLocation(e,i)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class pg extends wa{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,n){this.fetchUniformLocation(e,i)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class Ih extends wa{constructor(e){super(e),this.current=cs.transparent}set(e,i,n){this.fetchUniformLocation(e,i)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}const Vf=new Float32Array(16),hs=new Float32Array(9),Py=new Float32Array(4);function gp(t){return[ze(255*t.r,255*t.g),ze(255*t.b,255*t.a)]}class Cn{constructor(e,i,n){this.value=e,this.uniformNames=i.map(c=>`u_${c}`),this.type=n}setUniform(e,i,n,c,f){i.set(e,f,c.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new Ih(e):new Ms(e)}}class tn{constructor(e,i){this.uniformNames=i.map(n=>`u_${n}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,n,c,f){const g=f==="u_pattern"||f==="u_dash"?this.pattern:f==="u_pixel_ratio"?this.pixelRatio:null;g&&i.set(e,f,g)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new pg(e):new Ms(e)}}class Ka{constructor(e,i,n,c){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,i,n,c,f,g){const b=this.paintVertexArray.length,A=this.expression.evaluate(new F(0),i,{},f,c,g);this.paintVertexArray.resize(e),this._setPaintValue(b,e,A)}updatePaintArray(e,i,n,c,f){const g=this.expression.evaluate({zoom:0},n,c,void 0,f);this._setPaintValue(e,i,g)}_setPaintValue(e,i,n){if(this.type==="color"){const c=gp(n);for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,c[0],c[1])}else{for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ia{constructor(e,i,n,c,f,g){this.expression=e,this.uniformNames=i.map(b=>`u_${b}_t`),this.type=n,this.useIntegerZoom=c,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map(b=>({name:`a_${b}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,i,n,c,f,g){const b=this.expression.evaluate(new F(this.zoom),i,{},f,c,g),A=this.expression.evaluate(new F(this.zoom+1),i,{},f,c,g),k=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(k,e,b,A)}updatePaintArray(e,i,n,c,f){const g=this.expression.evaluate({zoom:this.zoom},n,c,void 0,f),b=this.expression.evaluate({zoom:this.zoom+1},n,c,void 0,f);this._setPaintValue(e,i,g,b)}_setPaintValue(e,i,n,c){if(this.type==="color"){const f=gp(n),g=gp(c);for(let b=e;b<i;b++)this.paintVertexArray.emplace(b,f[0],f[1],g[0],g[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,n,c);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,n,c,f){const g=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,b=vi(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);i.set(e,f,b)}getBinding(e,i){return new Ms(e)}}class Ja{constructor(e,i,n,c,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=(n==="array"?Ya:ta).members;for(let g=0;g<i.length;++g);this.paintVertexArray=new c}populatePaintArray(e,i,n){const c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(c,e,i.patterns&&i.patterns[this.layerId],n)}updatePaintArray(e,i,n,c,f,g){this._setPaintValues(e,i,n.patterns&&n.patterns[this.layerId],g)}_setPaintValues(e,i,n,c){if(!c||!n)return;const f=c[n];if(!f)return;const{tl:g,br:b,pixelRatio:A}=f;for(let k=e;k<i;k++)this.paintVertexArray.emplace(k,g[0],g[1],b[0],b[1],A)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Nl{constructor(e,i,n=()=>!0){this.binders={},this._buffers=[];const c=[];for(const f in e.paint._values){if(!n(f))continue;const g=e.paint.get(f);if(!(g instanceof pe&&Cl(g.property.specification)))continue;const b=Ly(f,e.type),A=g.value,k=g.property.specification.type,O=!!g.property.useIntegerZoom,U=f==="line-dasharray"||f.endsWith("pattern"),V=f==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(A.kind!=="constant"||V)if(A.kind==="source"||V||U){const H=fg(f,k,"source");this.binders[f]=U?new Ja(A,b,k,H,e.id):new Ka(A,b,k,H),c.push(`/a_${f}`)}else{const H=fg(f,k,"composite");this.binders[f]=new ia(A,b,k,O,i,H),c.push(`/z_${f}`)}else this.binders[f]=U?new tn(A.value,b):new Cn(A.value,b,k),c.push(`/u_${f}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Ka||i instanceof ia?i.maxValue:0}populatePaintArrays(e,i,n,c,f,g){for(const b in this.binders){const A=this.binders[b];(A instanceof Ka||A instanceof ia||A instanceof Ja)&&A.populatePaintArray(e,i,n,c,f,g)}}setConstantPatternPositions(e){for(const i in this.binders){const n=this.binders[i];n instanceof tn&&n.setConstantPatternPositions(e)}}updatePaintArrays(e,i,n,c,f,g){let b=!1;for(const A in e){const k=i.getPositions(A);for(const O of k){const U=n.feature(O.index);for(const V in this.binders){const H=this.binders[V];if((H instanceof Ka||H instanceof ia||H instanceof Ja)&&H.expression.isStateDependent===!0){const Z=c.paint.get(V);H.expression=Z.value,H.updatePaintArray(O.start,O.end,U,e[A],f,g),b=!0}}}}return b}defines(){const e=[];for(const i in this.binders){const n=this.binders[i];(n instanceof Cn||n instanceof tn)&&e.push(...n.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const n=this.binders[i];if(n instanceof Ka||n instanceof ia||n instanceof Ja)for(let c=0;c<n.paintVertexAttributes.length;c++)e.push(n.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const n=this.binders[i];if(n instanceof Cn||n instanceof tn||n instanceof ia)for(const c of n.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const n in this.binders){const c=this.binders[n];if(c instanceof Cn||c instanceof tn||c instanceof ia)for(const f of c.uniformNames)i.push({name:f,property:n,binding:c.getBinding(e,f)})}return i}setUniforms(e,i,n,c,f){for(const{name:g,property:b,binding:A}of n)this.binders[b].setUniform(e,A,f,c.get(b),g)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Ka||i instanceof ia||i instanceof Ja)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const n=this.binders[i];(n instanceof Ka||n instanceof ia||n instanceof Ja)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Ka||i instanceof ia||i instanceof Ja)&&i.destroy()}}}class Ul{constructor(e,i,n=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Nl(c,i,n);this.needsUpload=!1,this._featureMap=new Jr,this._bufferOffset=0}populatePaintArrays(e,i,n,c,f,g,b){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(e,i,c,f,g,b);i.id!==void 0&&this._featureMap.add(i.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,n,c,f){for(const g of n)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,i,g,c,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Iy={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ly(t,e){return Iy[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const _p={"line-pattern":{source:Je,composite:Je},"fill-pattern":{source:Je,composite:Je},"fill-extrusion-pattern":{source:Je,composite:Je},"line-dasharray":{source:_t,composite:_t}},Dy={color:{source:wr,composite:Pt},number:{source:Sr,composite:wr}};function fg(t,e,i){const n=_p[t];return n&&n[i]||Dy[e][i]}ni(Cn,"ConstantBinder"),ni(tn,"PatternConstantBinder"),ni(Ka,"SourceExpressionBinder"),ni(Ja,"PatternCompositeBinder"),ni(ia,"CompositeExpressionBinder"),ni(Nl,"ProgramConfiguration",{omit:["_buffers"]}),ni(Ul,"ProgramConfigurationSet");const yp="-transition";class ra extends Dr{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new fe(i.layout)),i.paint)){this._transitionablePaint=new K(i.paint);for(const n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(const n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ge(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,n={}){i!=null&&this._validate(up,`layers.${this.id}.layout.${e}`,e,i,n)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return rr(e,yp)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,n={}){if(i!=null&&this._validate(Bf,`layers.${this.id}.paint.${e}`,e,i,n))return!1;if(rr(e,yp))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const c=this._transitionablePaint._values[e],f=c.value.isDataDriven(),g=c.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value,A=b.isDataDriven(),k=rr(e,"pattern")||e==="line-dasharray";return A||f||k||this._handleOverridablePaintPropertyUpdate(e,g,b)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),me(e,(i,n)=>!(i===void 0||n==="layout"&&!Object.keys(i).length||n==="paint"&&!Object.keys(i).length))}_validate(e,i,n,c,f={}){return(!f||f.validate!==!1)&&dp(this,e.call(Lc,{key:i,layerType:this.type,objectKey:n,value:c,styleSpec:ut,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof pe&&Cl(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=wh(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Ry=$e([{name:"a_pos",components:2,type:"Int16"}],4),Qa=$e([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class us{constructor(e=[]){this.segments=e}prepareSegment(e,i,n,c){let f=this.segments[this.segments.length-1];return e>us.MAX_VERTEX_ARRAY_LENGTH&&Tt(`Max vertices per segment is ${us.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>us.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==c)&&(f={vertexOffset:i.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},c!==void 0&&(f.sortKey=c),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,n,c){return new us([{vertexOffset:e,primitiveOffset:i,vertexLength:n,primitiveLength:c,vaos:{},sortKey:0}])}}us.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ni(us,"SegmentVector");var pi=8192;class qs{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Mr?new Mr(e.lng,e.lat):Mr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Mr?new Mr(e.lng,e.lat):Mr.convert(e),this}extend(e){const i=this._sw,n=this._ne;let c,f;if(e instanceof Mr)c=e,f=e;else{if(!(e instanceof qs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(qs.convert(e)):this.extend(Mr.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Mr.convert(e)):this;if(c=e._sw,f=e._ne,!c||!f)return this}return i||n?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),n.lng=Math.max(f.lng,n.lng),n.lat=Math.max(f.lat,n.lat)):(this._sw=new Mr(c.lng,c.lat),this._ne=new Mr(f.lng,f.lat)),this}getCenter(){return new Mr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Mr(this.getWest(),this.getNorth())}getSouthEast(){return new Mr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:n}=Mr.convert(e);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&c}static convert(e){return!e||e instanceof qs?e:new qs(e)}}var xp=1e-6,Un=typeof Float32Array<"u"?Float32Array:Array;function mg(){var t=new Un(9);return Un!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function gg(t,e,i){var n=e[0],c=e[1],f=e[2],g=e[3],b=e[4],A=e[5],k=e[6],O=e[7],U=e[8],V=i[0],H=i[1],Z=i[2],ee=i[3],ce=i[4],_e=i[5],Me=i[6],ye=i[7],Se=i[8];return t[0]=V*n+H*g+Z*k,t[1]=V*c+H*b+Z*O,t[2]=V*f+H*A+Z*U,t[3]=ee*n+ce*g+_e*k,t[4]=ee*c+ce*b+_e*O,t[5]=ee*f+ce*A+_e*U,t[6]=Me*n+ye*g+Se*k,t[7]=Me*c+ye*b+Se*O,t[8]=Me*f+ye*A+Se*U,t}function oo(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function vp(t,e){var i=e[0],n=e[1],c=e[2],f=e[3],g=e[4],b=e[5],A=e[6],k=e[7],O=e[8],U=e[9],V=e[10],H=e[11],Z=e[12],ee=e[13],ce=e[14],_e=e[15],Me=i*b-n*g,ye=i*A-c*g,Se=i*k-f*g,Le=n*A-c*b,ke=n*k-f*b,nt=c*k-f*A,tt=O*ee-U*Z,mt=O*ce-V*Z,zt=O*_e-H*Z,at=U*ce-V*ee,bt=U*_e-H*ee,wt=V*_e-H*ce,Ct=Me*wt-ye*bt+Se*at+Le*zt-ke*mt+nt*tt;return Ct?(t[0]=(b*wt-A*bt+k*at)*(Ct=1/Ct),t[1]=(c*bt-n*wt-f*at)*Ct,t[2]=(ee*nt-ce*ke+_e*Le)*Ct,t[3]=(V*ke-U*nt-H*Le)*Ct,t[4]=(A*zt-g*wt-k*mt)*Ct,t[5]=(i*wt-c*zt+f*mt)*Ct,t[6]=(ce*Se-Z*nt-_e*ye)*Ct,t[7]=(O*nt-V*Se+H*ye)*Ct,t[8]=(g*bt-b*zt+k*tt)*Ct,t[9]=(n*zt-i*bt-f*tt)*Ct,t[10]=(Z*ke-ee*Se+_e*Me)*Ct,t[11]=(U*Se-O*ke-H*Me)*Ct,t[12]=(b*mt-g*at-A*tt)*Ct,t[13]=(i*at-n*mt+c*tt)*Ct,t[14]=(ee*ye-Z*Le-ce*Me)*Ct,t[15]=(O*Le-U*ye+V*Me)*Ct,t):null}function el(t,e,i){var n=e[0],c=e[1],f=e[2],g=e[3],b=e[4],A=e[5],k=e[6],O=e[7],U=e[8],V=e[9],H=e[10],Z=e[11],ee=e[12],ce=e[13],_e=e[14],Me=e[15],ye=i[0],Se=i[1],Le=i[2],ke=i[3];return t[0]=ye*n+Se*b+Le*U+ke*ee,t[1]=ye*c+Se*A+Le*V+ke*ce,t[2]=ye*f+Se*k+Le*H+ke*_e,t[3]=ye*g+Se*O+Le*Z+ke*Me,t[4]=(ye=i[4])*n+(Se=i[5])*b+(Le=i[6])*U+(ke=i[7])*ee,t[5]=ye*c+Se*A+Le*V+ke*ce,t[6]=ye*f+Se*k+Le*H+ke*_e,t[7]=ye*g+Se*O+Le*Z+ke*Me,t[8]=(ye=i[8])*n+(Se=i[9])*b+(Le=i[10])*U+(ke=i[11])*ee,t[9]=ye*c+Se*A+Le*V+ke*ce,t[10]=ye*f+Se*k+Le*H+ke*_e,t[11]=ye*g+Se*O+Le*Z+ke*Me,t[12]=(ye=i[12])*n+(Se=i[13])*b+(Le=i[14])*U+(ke=i[15])*ee,t[13]=ye*c+Se*A+Le*V+ke*ce,t[14]=ye*f+Se*k+Le*H+ke*_e,t[15]=ye*g+Se*O+Le*Z+ke*Me,t}function Qu(t,e,i){var n,c,f,g,b,A,k,O,U,V,H,Z,ee=i[0],ce=i[1],_e=i[2];return e===t?(t[12]=e[0]*ee+e[4]*ce+e[8]*_e+e[12],t[13]=e[1]*ee+e[5]*ce+e[9]*_e+e[13],t[14]=e[2]*ee+e[6]*ce+e[10]*_e+e[14],t[15]=e[3]*ee+e[7]*ce+e[11]*_e+e[15]):(c=e[1],f=e[2],g=e[3],b=e[4],A=e[5],k=e[6],O=e[7],U=e[8],V=e[9],H=e[10],Z=e[11],t[0]=n=e[0],t[1]=c,t[2]=f,t[3]=g,t[4]=b,t[5]=A,t[6]=k,t[7]=O,t[8]=U,t[9]=V,t[10]=H,t[11]=Z,t[12]=n*ee+b*ce+U*_e+e[12],t[13]=c*ee+A*ce+V*_e+e[13],t[14]=f*ee+k*ce+H*_e+e[14],t[15]=g*ee+O*ce+Z*_e+e[15]),t}function tl(t,e,i){var n=i[0],c=i[1],f=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*c,t[5]=e[5]*c,t[6]=e[6]*c,t[7]=e[7]*c,t[8]=e[8]*f,t[9]=e[9]*f,t[10]=e[10]*f,t[11]=e[11]*f,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ed(t,e,i){var n=Math.sin(i),c=Math.cos(i),f=e[4],g=e[5],b=e[6],A=e[7],k=e[8],O=e[9],U=e[10],V=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=f*c+k*n,t[5]=g*c+O*n,t[6]=b*c+U*n,t[7]=A*c+V*n,t[8]=k*c-f*n,t[9]=O*c-g*n,t[10]=U*c-b*n,t[11]=V*c-A*n,t}function bp(t,e,i){var n=Math.sin(i),c=Math.cos(i),f=e[0],g=e[1],b=e[2],A=e[3],k=e[8],O=e[9],U=e[10],V=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*c-k*n,t[1]=g*c-O*n,t[2]=b*c-U*n,t[3]=A*c-V*n,t[8]=f*n+k*c,t[9]=g*n+O*c,t[10]=b*n+U*c,t[11]=A*n+V*c,t}function Gf(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function jl(t,e,i){var n,c,f,g=i[0],b=i[1],A=i[2],k=Math.hypot(g,b,A);return k<xp?null:(g*=k=1/k,b*=k,A*=k,n=Math.sin(e),c=Math.cos(e),t[0]=g*g*(f=1-c)+c,t[1]=b*g*f+A*n,t[2]=A*g*f-b*n,t[3]=0,t[4]=g*b*f-A*n,t[5]=b*b*f+c,t[6]=A*b*f+g*n,t[7]=0,t[8]=g*A*f+b*n,t[9]=b*A*f-g*n,t[10]=A*A*f+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var td=el;function wp(){var t=new Un(3);return Un!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function _g(t){var e=new Un(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Lh(t){return Math.hypot(t[0],t[1],t[2])}function Vl(t,e,i){var n=new Un(3);return n[0]=t,n[1]=e,n[2]=i,n}function sa(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function Tp(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Ep(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function kn(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function Io(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function jn(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function id(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t}function Tn(t,e){var i=e[0],n=e[1],c=e[2],f=i*i+n*n+c*c;return f>0&&(f=1/Math.sqrt(f)),t[0]=e[0]*f,t[1]=e[1]*f,t[2]=e[2]*f,t}function Vn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ta(t,e,i){var n=e[0],c=e[1],f=e[2],g=i[0],b=i[1],A=i[2];return t[0]=c*A-f*b,t[1]=f*g-n*A,t[2]=n*b-c*g,t}function Qr(t,e,i){var n=e[0],c=e[1],f=e[2],g=i[3]*n+i[7]*c+i[11]*f+i[15];return t[0]=(i[0]*n+i[4]*c+i[8]*f+i[12])/(g=g||1),t[1]=(i[1]*n+i[5]*c+i[9]*f+i[13])/g,t[2]=(i[2]*n+i[6]*c+i[10]*f+i[14])/g,t}function gr(t,e,i){var n=i[0],c=i[1],f=i[2],g=e[0],b=e[1],A=e[2],k=c*A-f*b,O=f*g-n*A,U=n*b-c*g,V=c*U-f*O,H=f*k-n*U,Z=n*O-c*k,ee=2*i[3];return O*=ee,U*=ee,H*=2,Z*=2,t[0]=g+(k*=ee)+(V*=2),t[1]=b+O+H,t[2]=A+U+Z,t}var rd,ao=Tp,zy=Ep,Dh=Lh;function yg(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function sd(t,e){var i=e[0],n=e[1],c=e[2],f=e[3],g=i*i+n*n+c*c+f*f;return g>0&&(g=1/Math.sqrt(g)),t[0]=i*g,t[1]=n*g,t[2]=c*g,t[3]=f*g,t}function En(t,e,i){var n=e[0],c=e[1],f=e[2],g=e[3];return t[0]=i[0]*n+i[4]*c+i[8]*f+i[12]*g,t[1]=i[1]*n+i[5]*c+i[9]*f+i[13]*g,t[2]=i[2]*n+i[6]*c+i[10]*f+i[14]*g,t[3]=i[3]*n+i[7]*c+i[11]*f+i[15]*g,t}function Sp(){var t=new Un(4);return Un!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function rn(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function xg(t,e,i){i*=.5;var n=e[0],c=e[1],f=e[2],g=e[3],b=Math.sin(i),A=Math.cos(i);return t[0]=n*A+g*b,t[1]=c*A+f*b,t[2]=f*A-c*b,t[3]=g*A-n*b,t}function $f(t,e,i){i*=.5;var n=e[0],c=e[1],f=e[2],g=e[3],b=Math.sin(i),A=Math.cos(i);return t[0]=n*A-f*b,t[1]=c*A+g*b,t[2]=f*A+n*b,t[3]=g*A-c*b,t}wp(),rd=new Un(4),Un!=Float32Array&&(rd[0]=0,rd[1]=0,rd[2]=0,rd[3]=0);var vg=sd;wp(),Vl(1,0,0),Vl(0,1,0),Sp(),Sp(),mg();const Ap=$e([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:bg}=Ap,wg=$e([{name:"a_pos_3",components:3,type:"Int16"}]);var Lo=$e([{name:"a_pos",type:"Int16",components:2}]);class Wf{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,n){const c=Vn(i,this.dir);if(Math.abs(c)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/c;return n[0]=this.pos[0]+this.dir[0]*f,n[1]=this.pos[1]+this.dir[1]*f,n[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,i,n){if(function(H,Z){var ee=H[0],ce=H[1],_e=H[2],Me=Z[0],ye=Z[1],Se=Z[2];return Math.abs(ee-Me)<=xp*Math.max(1,Math.abs(ee),Math.abs(Me))&&Math.abs(ce-ye)<=xp*Math.max(1,Math.abs(ce),Math.abs(ye))&&Math.abs(_e-Se)<=xp*Math.max(1,Math.abs(_e),Math.abs(Se))}(this.pos,e)||i===0)return n[0]=n[1]=n[2]=0,!1;const[c,f,g]=this.dir,b=this.pos[0]-e[0],A=this.pos[1]-e[1],k=this.pos[2]-e[2],O=c*c+f*f+g*g,U=2*(b*c+A*f+k*g),V=U*U-4*O*(b*b+A*A+k*k-i*i);if(V<0){const H=Math.max(-U/2,0),Z=b+c*H,ee=A+f*H,ce=k+g*H,_e=Math.hypot(Z,ee,ce);return n[0]=Z*i/_e,n[1]=ee*i/_e,n[2]=ce*i/_e,!1}{const H=(-U-Math.sqrt(V))/(2*O);if(H<0){const Z=Math.hypot(b,A,k);return n[0]=b*i/Z,n[1]=A*i/Z,n[2]=k*i/Z,!1}return n[0]=b+c*H,n[1]=A+f*H,n[2]=k+g*H,!0}}}class Hf{constructor(e,i,n,c,f){this.TL=e,this.TR=i,this.BR=n,this.BL=c,this.horizon=f}static fromInvProjectionMatrix(e,i,n){const c=[-1,1,1],f=[1,1,1],g=[1,-1,1],b=[-1,-1,1],A=Qr(c,c,e),k=Qr(f,f,e),O=Qr(g,g,e),U=Qr(b,b,e);return new Hf(A,k,O,U,i/n)}}class Ea{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,n,c){const f=Math.pow(2,n),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const k=En([],A,e),O=1/k[3]/i*f;return function(U,V,H){return U[0]=V[0]*H[0],U[1]=V[1]*H[1],U[2]=V[2]*H[2],U[3]=V[3]*H[3],U}(k,k,[O,O,c?1/k[3]:O,O])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const k=Tn([],Ta([],ao([],g[A[0]],g[A[1]]),ao([],g[A[2]],g[A[1]]))),O=-Vn(k,g[A[1]]);return k.concat(O)});return new Ea(g,b)}}class Xs{static fromPoints(e){const i=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(const c of e)kn(i,i,c),Io(n,n,c);return new Xs(i,n)}static applyTransform(e,i){const n=e.getCorners();for(let c=0;c<n.length;++c)Qr(n[c],n[c],i);return Xs.fromPoints(n)}constructor(e,i){this.min=e,this.max=i,this.center=jn([],sa([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],n=_g(this.min),c=_g(this.max);for(let f=0;f<i.length;f++)n[f]=i[f]?this.min[f]:this.center[f],c[f]=i[f]?this.center[f]:this.max[f];return c[2]=this.max[2],new Xs(n,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let n=!0;for(let c=0;c<e.planes.length;c++){const f=e.planes[c];let g=0;for(let b=0;b<i.length;b++)g+=Vn(f,i[b])+f[3]>=0;if(g===0)return 0;g!==i.length&&(n=!1)}if(n)return 2;for(let c=0;c<3;c++){let f=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let b=0;b<e.points.length;b++){const A=e.points[b][c]-this.min[c];f=Math.min(f,A),g=Math.max(g,A)}if(g<0||f>this.max[c]-this.min[c])return 0}return 1}}const nd=5,Mp=6,Sa=pi/Math.PI/2,Tg=16383,Gl=64,od=[Gl,32,16],lo=-Sa,Sn=Sa,Oy=[new Xs([lo,lo,lo],[Sn,Sn,Sn]),new Xs([lo,lo,lo],[0,0,Sn]),new Xs([0,lo,lo],[Sn,0,Sn]),new Xs([lo,0,lo],[0,Sn,Sn]),new Xs([0,0,lo],[Sn,Sn,Sn])];function Cp(t){return t*Sa/hd}function Eg(t,e,i,n=!0){const c=jn([],t._camera.position,t.worldSize),f=[e,i,1,1];En(f,f,t.pixelMatrixInverse),yg(f,f,1/f[3]);const g=Tn([],ao([],f,c)),b=t.globeMatrix,A=[b[12],b[13],b[14]],k=ao([],A,c),O=Lh(k),U=Tn([],k),V=t.worldSize/(2*Math.PI),H=Vn(U,g),Z=Math.asin(V/O);if(Z<Math.acos(H)){if(!n)return null;const zt=[],at=[];jn(zt,g,O/H),Tn(at,ao(at,zt,k)),Tn(g,sa(g,k,jn(g,at,Math.tan(Z)*O)))}const ee=[];new Wf(c,g).closestPointOnSphere(A,V,ee);const ce=Tn([],Qt(b,0)),_e=Tn([],Qt(b,1)),Me=Tn([],Qt(b,2)),ye=Vn(ce,ee),Se=Vn(_e,ee),Le=Vn(Me,ee),ke=Ti(Math.asin(-Se/V));let nt=Ti(Math.atan2(ye,Le));nt=t.center.lng+function(zt,at){const bt=(at-zt+180)%360-180;return bt<-180?bt+360:bt}(t.center.lng,nt);const tt=oa(nt),mt=vi(Ro(ke),0,1);return new Bh(tt,mt)}class Sg{constructor(e,i,n){this.a=ao([],e,n),this.b=ao([],i,n),this.center=n;const c=Tn([],this.a),f=Tn([],this.b);this.angle=Math.acos(Vn(c,f))}}function ad(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(n,c,f,g){const b=Math.sin(f);return n*(Math.sin((1-g)*f)/b)+c*(Math.sin(g*f)/b)}(t.a[e],t.b[e],t.angle,vi(i,0,1))+t.center[e]}function Do(t){if(t.z<=1)return Oy[t.z+2*t.y+t.x];const e=zc(ld(t));return Xs.fromPoints(e)}function na(t,e,i){return jn(t,t,1-i),id(t,t,e,i)}function qf(t,e){const i=Oh(e.zoom);if(i===0)return Do(t);const n=ld(t),c=zc(n),f=oa(n.getWest())*e.worldSize,g=oa(n.getEast())*e.worldSize,b=Ro(n.getNorth())*e.worldSize,A=Ro(n.getSouth())*e.worldSize,k=[f,b,0],O=[g,b,0],U=[f,A,0],V=[g,A,0],H=vp([],e.globeMatrix);return Qr(k,k,H),Qr(O,O,H),Qr(U,U,H),Qr(V,V,H),c[0]=na(c[0],U,i),c[1]=na(c[1],V,i),c[2]=na(c[2],O,i),c[3]=na(c[3],k,i),Xs.fromPoints(c)}function Ag(t,e,i){for(const n of t)Qr(n,n,e),jn(n,n,i)}function By(t,e,i){const n=e/t.worldSize,c=t.globeMatrix;if(i.z<=1){const tt=Do(i).getCorners();return Ag(tt,c,n),Xs.fromPoints(tt)}const f=ld(i),g=zc(f);Ag(g,c,n);const b=Number.MAX_VALUE,A=[-b,-b,-b],k=[b,b,b];if(f.contains(t.center)){for(const zt of g)kn(k,k,zt),Io(A,A,zt);A[2]=0;const tt=t.point,mt=[tt.x*n,tt.y*n,0];return kn(k,k,mt),Io(A,A,mt),new Xs(k,A)}const O=[c[12]*n,c[13]*n,c[14]*n],U=f.getCenter(),V=vi(t.center.lat,-85.051129,ho),H=vi(U.lat,-85.051129,ho),Z=oa(t.center.lng),ee=Ro(V);let ce=Z-oa(U.lng);const _e=ee-Ro(H);ce>.5?ce-=1:ce<-.5&&(ce+=1);let Me=0;Math.abs(ce)>Math.abs(_e)?Me=ce>=0?1:3:(Me=_e>=0?0:2,id(O,O,[c[4]*n,c[5]*n,c[6]*n],-Math.sin(jt(_e>=0?f.getSouth():f.getNorth()))*Sa));const ye=g[Me],Se=g[(Me+1)%4],Le=new Sg(ye,Se,O),ke=[ad(Le,0)||ye[0],ad(Le,1)||ye[1],ad(Le,2)||ye[2]],nt=Oh(t.zoom);if(nt>0){const tt=function({x:zt,y:at,z:bt},wt,Ct,Nt,dt){const Xt=1/(1<<bt);let ui=zt*Xt,Jt=ui+Xt,Ni=at*Xt,Ut=Ni+Xt,bi=0;const Ui=(ui+Jt)/2-Nt;return Ui>.5?bi=-1:Ui<-.5&&(bi=1),ui=((ui+bi)*wt-(Nt*=wt))*Ct+Nt,Jt=((Jt+bi)*wt-Nt)*Ct+Nt,Ni=(Ni*wt-(dt*=wt))*Ct+dt,Ut=(Ut*wt-dt)*Ct+dt,[[ui,Ut,0],[Jt,Ut,0],[Jt,Ni,0],[ui,Ni,0]]}(i,e,t._pixelsPerMercatorPixel,Z,ee);for(let zt=0;zt<g.length;zt++)na(g[zt],tt[zt],nt);const mt=sa([],tt[Me],tt[(Me+1)%4]);jn(mt,mt,.5),na(ke,mt,nt)}for(const tt of g)kn(k,k,tt),Io(A,A,tt);return k[2]=Math.min(ye[2],Se[2]),kn(k,k,ke),Io(A,A,ke),new Xs(k,A)}function ld({x:t,y:e,z:i}){const n=1/(1<<i),c=new Mr(co(t*n),sn((e+1)*n)),f=new Mr(co((t+1)*n),sn(e*n));return new qs(c,f)}function zc(t){const e=jt(t.getNorth()),i=jt(t.getSouth()),n=Math.cos(e),c=Math.cos(i),f=Math.sin(e),g=Math.sin(i),b=t.getWest(),A=t.getEast();return[Oc(c,g,b),Oc(c,g,A),Oc(n,f,A),Oc(n,f,b)]}function Oc(t,e,i,n=Sa){return i=jt(i),[t*Math.sin(i)*n,-e*n,t*Math.cos(i)*n]}function Rh(t,e,i){return Oc(Math.cos(jt(t)),Math.sin(jt(t)),e,i)}function cd(t,e,i,n){const c=1<<i.z,f=(t/pi+i.x)/c;return Rh(sn((e/pi+i.y)/c),co(f),n)}function zh({min:t,max:e}){return Tg/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const $l=new Float64Array(16);function Bc(t){const e=zh(t),i=Gf($l,[e,e,e]);return Qu(i,i,((n=[])[0]=-(c=t.min)[0],n[1]=-c[1],n[2]=-c[2],n));var n,c}function Xf(t){const e=(n=t.min,(i=$l)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i);var i,n;const c=1/zh(t);return tl(e,e,[c,c,c])}function Mg(t,e,i,n,c){const f=function(A){const k=pi/(2*Math.PI);return A/(2*Math.PI)/k}(i),g=[t,e,-i/(2*Math.PI)],b=oo(new Float64Array(16));return Qu(b,b,g),tl(b,b,[f,f,f]),ed(b,b,jt(-c)),bp(b,b,jt(-n)),b}function Oh(t){return ws(nd,Mp,t)}function Cg(t,e){const i=Rh(e.lat,e.lng),n=function(Z){const ee=Rh(Z._center.lat,Z._center.lng);let ce=Ta([],Vl(0,1,0),ee);const _e=jl([],-Z.angle,ee);ce=Qr(ce,ce,_e),jl(_e,-Z._pitch,ce);const Me=Tn([],ee);return jn(Me,Me,Cp(Z.cameraToCenterDistance/Z.pixelsPerMeter)),Qr(Me,Me,_e),sa([],ee,Me)}(t);return g=(c=Tp([],n,i))[0],b=c[1],A=c[2],k=(f=i)[0],O=f[1],U=f[2],H=(V=Math.sqrt(g*g+b*b+A*A)*Math.sqrt(k*k+O*O+U*U))&&Vn(c,f)/V,Math.acos(Math.min(Math.max(H,-1),1));var c,f,g,b,A,k,O,U,V,H}function Zf(t,e){return Cg(t,e)>Math.PI/2*1.01}const kg=jt(85),Fy=Math.cos(kg),Ny=Math.sin(kg),hd=63710088e-1,Pg=2*Math.PI*hd;class Wl{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Wl(Tr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,n=this.lat*i,c=e.lat*i,f=Math.sin(n)*Math.sin(c)+Math.cos(n)*Math.cos(c)*Math.cos((e.lng-this.lng)*i);return hd*Math.acos(Math.min(f,1))}toBounds(e=0){const i=360*e/40075017,n=i/Math.cos(Math.PI/180*this.lat);return new qs(new Wl(this.lng-n,this.lat-i),new Wl(this.lng+n,this.lat+i))}toEcef(e){const i=Cp(e);return Rh(this.lat,this.lng,Sa+i)}static convert(e){if(e instanceof Wl)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Wl(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Wl(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Mr=Wl;function Yf(t){return Pg*Math.cos(t*Math.PI/180)}function oa(t){return(180+t)/360}function Ro(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function aa(t,e){return t/Yf(e)}function co(t){return 360*t-180}function sn(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function ud(t,e){return t*Yf(sn(e))}const ho=85.051129;function Kf(t){return 1/Math.cos(t*Math.PI/180)}class Bh{constructor(e,i,n=0){this.x=+e,this.y=+i,this.z=+n}static fromLngLat(e,i=0){const n=Mr.convert(e);return new Bh(oa(n.lng),Ro(n.lat),aa(i,n.lat))}toLngLat(){return new Mr(co(this.x),sn(this.y))}toAltitude(){return ud(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Pg*Kf(sn(this.y))}}function Fh(t,e,i,n,c,f,g,b,A){const k=(e+n)/2,O=(i+c)/2,U=new Ge(k,O);b(U),function(V,H,Z,ee,ce,_e){const Me=Z-ce,ye=ee-_e;return Math.abs((ee-H)*Me-(Z-V)*ye)/Math.hypot(Me,ye)}(U.x,U.y,f.x,f.y,g.x,g.y)>=A?(Fh(t,e,i,k,O,f,U,b,A),Fh(t,k,O,n,c,U,g,b,A)):t.push(g)}function kp(t,e,i){let n=t[0],c=n.x,f=n.y;e(n);const g=[n];for(let b=1;b<t.length;b++){const A=t[b],{x:k,y:O}=A;e(A),Fh(g,c,f,k,O,n,A,e,i),c=k,f=O,n=A}return g}function Pp(t,e,i,n){if(n(e,i)){const c=e.add(i)._mult(.5);Pp(t,e,c,n),Pp(t,c,i,n)}else t.push(i)}function Uy(t,e){let i=t[0];const n=[i];for(let c=1;c<t.length;c++){const f=t[c];Pp(n,i,f,e),i=f}return n}const dd=Math.pow(2,14)-1,Ig=-dd-1;function jy(t,e){const i=Math.round(t.x*e),n=Math.round(t.y*e);return t.x=vi(i,Ig,dd),t.y=vi(n,Ig,dd),(i<t.x||i>t.x+1||n<t.y||n>t.y+1)&&Tt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function la(t,e,i){const n=t.loadGeometry(),c=t.extent,f=pi/c;if(e&&i&&i.projection.isReprojectedInTileSpace){const g=1<<e.z,{scale:b,x:A,y:k,projection:O}=i,U=V=>{const H=co((e.x+V.x/c)/g),Z=sn((e.y+V.y/c)/g),ee=O.project(H,Z);V.x=(ee.x*b-A)*c,V.y=(ee.y*b-k)*c};for(let V=0;V<n.length;V++)if(t.type!==1)n[V]=kp(n[V],U,1);else{const H=[];for(const Z of n[V])Z.x<0||Z.x>=c||Z.y<0||Z.y>=c||(U(Z),H.push(Z));n[V]=H}}for(const g of n)for(const b of g)jy(b,f);return n}function Fc(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?la(t):[]}}function Ip(t,e,i,n,c){t.emplaceBack(2*e+(n+1)/2,2*i+(c+1)/2)}function Lp(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Nh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Mt,this.indexArray=new di,this.segments=new us,this.programConfigurations=new Ul(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,n,c){const f=this.layers[0],g=[];let b=null;f.type==="circle"&&(b=f.layout.get("circle-sort-key"));for(const{feature:k,id:O,index:U,sourceLayerIndex:V}of e){const H=this.layers[0]._featureFilter.needGeometry,Z=Fc(k,H);if(!this.layers[0]._featureFilter.filter(new F(this.zoom),Z,n))continue;const ee=b?b.evaluate(Z,{},n):void 0,ce={id:O,properties:k.properties,type:k.type,sourceLayerIndex:V,index:U,geometry:H?Z.geometry:la(k,n,c),patterns:{},sortKey:ee};g.push(ce)}b&&g.sort((k,O)=>k.sortKey-O.sortKey);let A=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new Lt,A=c.projection);for(const k of g){const{geometry:O,index:U,sourceLayerIndex:V}=k,H=e[U].feature;this.addFeature(k,O,U,i.availableImages,n,A),i.featureIndex.insert(H,O,U,V,this.index)}}update(e,i,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,n,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ry.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Qa.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,n,c,f,g){for(const b of i)for(const A of b){const k=A.x,O=A.y;if(k<0||k>=pi||O<0||O>=pi)continue;if(g){const H=g.projectTilePoint(k,O,f),Z=g.upVector(f,k,O),ee=this.globeExtVertexArray;Lp(ee,H,Z),Lp(ee,H,Z),Lp(ee,H,Z),Lp(ee,H,Z)}const U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),V=U.vertexLength;Ip(this.layoutVertexArray,k,O,-1,-1),Ip(this.layoutVertexArray,k,O,1,-1),Ip(this.layoutVertexArray,k,O,1,1),Ip(this.layoutVertexArray,k,O,-1,1),this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+2,V+3),U.vertexLength+=4,U.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},c,f)}}function pd(t,e){for(let i=0;i<t.length;i++)if(Aa(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Aa(t,e[i]))return!0;return!!Dp(t,e)}function Lg(t,e,i){return!!Aa(t,e)||!!fd(e,t,i)}function Jf(t,e){if(t.length===1)return Rg(e,t[0]);for(let i=0;i<e.length;i++){const n=e[i];for(let c=0;c<n.length;c++)if(Aa(t,n[c]))return!0}for(let i=0;i<t.length;i++)if(Rg(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Dp(t,e[i]))return!0;return!1}function Dg(t,e,i){if(t.length>1){if(Dp(t,e))return!0;for(let n=0;n<e.length;n++)if(fd(e[n],t,i))return!0}for(let n=0;n<t.length;n++)if(fd(t[n],e,i))return!0;return!1}function Dp(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){const n=t[i],c=t[i+1];for(let f=0;f<e.length-1;f++)if(Rp(n,c,e[f],e[f+1]))return!0}return!1}function Rp(t,e,i,n){return xt(t,i,n)!==xt(e,i,n)&&xt(t,e,i)!==xt(t,e,n)}function fd(t,e,i){const n=i*i;if(e.length===1)return t.distSqr(e[0])<n;for(let c=1;c<e.length;c++)if(Uh(t,e[c-1],e[c])<n)return!0;return!1}function Uh(t,e,i){const n=e.distSqr(i);if(n===0)return t.distSqr(e);const c=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return t.distSqr(c<0?e:c>1?i:i.sub(e)._mult(c)._add(e))}function Rg(t,e){let i,n,c,f=!1;for(let g=0;g<t.length;g++){i=t[g];for(let b=0,A=i.length-1;b<i.length;A=b++)n=i[b],c=i[A],n.y>e.y!=c.y>e.y&&e.x<(c.x-n.x)*(e.y-n.y)/(c.y-n.y)+n.x&&(f=!f)}return f}function Aa(t,e){let i=!1;for(let n=0,c=t.length-1;n<t.length;c=n++){const f=t[n],g=t[c];f.y>e.y!=g.y>e.y&&e.x<(g.x-f.x)*(e.y-f.y)/(g.y-f.y)+f.x&&(i=!i)}return i}function md(t,e,i,n,c){for(const g of t)if(e<=g.x&&i<=g.y&&n>=g.x&&c>=g.y)return!0;const f=[new Ge(e,i),new Ge(e,c),new Ge(n,c),new Ge(n,i)];if(t.length>2){for(const g of f)if(Aa(t,g))return!0}for(let g=0;g<t.length-1;g++)if(Vy(t[g],t[g+1],f))return!0;return!1}function Vy(t,e,i){const n=i[0],c=i[2];if(t.x<n.x&&e.x<n.x||t.x>c.x&&e.x>c.x||t.y<n.y&&e.y<n.y||t.y>c.y&&e.y>c.y)return!1;const f=xt(t,e,i[0]);return f!==xt(t,e,i[1])||f!==xt(t,e,i[2])||f!==xt(t,e,i[3])}function jh(t,e,i){const n=e.paint.get(t).value;return n.kind==="constant"?n.value:i.programConfigurations.get(e.id).getMaxValue(t)}function Ma(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Qf(t,e,i,n,c){if(!e[0]&&!e[1])return t;const f=Ge.convert(e)._mult(c);i==="viewport"&&f._rotate(-n);const g=[];for(let b=0;b<t.length;b++)g.push(t[b].sub(f));return g}function zp(t,e,i,n){const c=Ge.convert(t)._mult(n);return e==="viewport"&&c._rotate(-i),c}ni(Nh,"CircleBucket",{omit:["layers"]});const zg=new be({"circle-sort-key":new ue(ut.layout_circle["circle-sort-key"])});var Hl={paint:new be({"circle-radius":new ue(ut.paint_circle["circle-radius"]),"circle-color":new ue(ut.paint_circle["circle-color"]),"circle-blur":new ue(ut.paint_circle["circle-blur"]),"circle-opacity":new ue(ut.paint_circle["circle-opacity"]),"circle-translate":new J(ut.paint_circle["circle-translate"]),"circle-translate-anchor":new J(ut.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new J(ut.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new J(ut.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ue(ut.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ue(ut.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ue(ut.paint_circle["circle-stroke-opacity"])}),layout:zg};function Vh(t,e,i,n,c,f,g,b,A){if(f&&t.queryGeometry.isAboveHorizon)return!1;f&&(A*=t.pixelToTileUnitsFactor);const k=t.tileID.canonical,O=i.projection.upVectorScale(k,i.center.lat,i.worldSize).metersToTile;for(const U of e)for(const V of U){const H=V.add(b),Z=c&&i.elevation?i.elevation.exaggeration()*c.getElevationAt(H.x,H.y,!0):0,ee=i.projection.projectTilePoint(H.x,H.y,k);if(Z>0){const ye=i.projection.upVector(k,H.x,H.y);ee.x+=ye[0]*O*Z,ee.y+=ye[1]*O*Z,ee.z+=ye[2]*O*Z}const ce=f?H:gd(ee.x,ee.y,ee.z,n),_e=f?t.tilespaceRays.map(ye=>Gy(ye,Z)):t.queryGeometry.screenGeometry,Me=En([],[ee.x,ee.y,ee.z,1],n);if(!g&&f?A*=Me[3]/i.cameraToCenterDistance:g&&!f&&(A*=i.cameraToCenterDistance/Me[3]),f){const ye=sn((V.y/pi+k.y)/(1<<k.z));A/=i.projection.pixelsPerMeter(ye,1)/aa(1,ye)}if(Lg(_e,ce,A))return!0}return!1}function gd(t,e,i,n){const c=En([],[t,e,i,1],n);return new Ge(c[0]/c[3],c[1]/c[3])}const Og=Vl(0,0,0),_d=Vl(0,0,1);function Gy(t,e){const i=wp();return Og[2]=e,t.intersectsPlane(Og,_d,i),new Ge(i[0],i[1])}class em extends Nh{}function yd(t,{width:e,height:i},n,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*i*n)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*i*n);return t.width=e,t.height=i,t.data=c,t}function Bg(t,e,i){const{width:n,height:c}=e;n===t.width&&c===t.height||(Op(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,c)},i),t.width=n,t.height=c,t.data=e.data)}function Op(t,e,i,n,c,f){if(c.width===0||c.height===0)return e;if(c.width>t.width||c.height>t.height||i.x>t.width-c.width||i.y>t.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||n.x>e.width-c.width||n.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=t.data,b=e.data;for(let A=0;A<c.height;A++){const k=((i.y+A)*t.width+i.x)*f,O=((n.y+A)*e.width+n.x)*f;for(let U=0;U<c.width*f;U++)b[O+U]=g[k+U]}return e}ni(em,"HeatmapBucket",{omit:["layers"]});class il{constructor(e,i){yd(this,e,1,i)}resize(e){Bg(this,new il(e),1)}clone(){return new il({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,n,c,f){Op(e,i,n,c,f,1)}}class Gn{constructor(e,i){yd(this,e,4,i)}resize(e){Bg(this,new Gn(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Gn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,n,c,f){Op(e,i,n,c,f,4)}}ni(il,"AlphaImage"),ni(Gn,"RGBAImage");var $y={paint:new be({"heatmap-radius":new ue(ut.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ue(ut.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new J(ut.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ve(ut.paint_heatmap["heatmap-color"]),"heatmap-opacity":new J(ut.paint_heatmap["heatmap-opacity"])})};function tm(t){const e={},i=t.resolution||256,n=t.clips?t.clips.length:1,c=t.image||new Gn({width:i,height:n}),f=(g,b,A)=>{e[t.evaluationKey]=A;const k=t.expression.evaluate(e);c.data[g+b+0]=Math.floor(255*k.r/k.a),c.data[g+b+1]=Math.floor(255*k.g/k.a),c.data[g+b+2]=Math.floor(255*k.b/k.a),c.data[g+b+3]=Math.floor(255*k.a)};if(t.clips)for(let g=0,b=0;g<n;++g,b+=4*i)for(let A=0,k=0;A<i;A++,k+=4){const O=A/(i-1),{start:U,end:V}=t.clips[g];f(b,k,U*(1-O)+V*O)}else for(let g=0,b=0;g<i;g++,b+=4)f(0,b,g/(i-1));return c}var Wy={paint:new be({"hillshade-illumination-direction":new J(ut.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new J(ut.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new J(ut.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new J(ut.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new J(ut.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new J(ut.paint_hillshade["hillshade-accent-color"])})};const im=$e([{name:"a_pos",components:2,type:"Int16"}],4),{members:Hy}=im;var Bp={exports:{}};function Fp(t,e,i){i=i||2;var n,c,f,g,b,A,k,O=e&&e.length,U=O?e[0]*i:t.length,V=Fg(t,0,U,i,!0),H=[];if(!V||V.next===V.prev)return H;if(O&&(V=function(ee,ce,_e,Me){var ye,Se,Le,ke=[];for(ye=0,Se=ce.length;ye<Se;ye++)(Le=Fg(ee,ce[ye]*Me,ye<Se-1?ce[ye+1]*Me:ee.length,Me,!1))===Le.next&&(Le.steiner=!0),ke.push(Yy(Le));for(ke.sort(Xy),ye=0;ye<ke.length;ye++)_e=Ug(ke[ye],_e);return _e}(t,e,V,i)),t.length>80*i){n=f=t[0],c=g=t[1];for(var Z=i;Z<U;Z+=i)(b=t[Z])<n&&(n=b),(A=t[Z+1])<c&&(c=A),b>f&&(f=b),A>g&&(g=A);k=(k=Math.max(f-n,g-c))!==0?32767/k:0}return ql(V,H,i,n,c,k,0),H}function Fg(t,e,i,n,c){var f,g;if(c===bd(t,e,i,n)>0)for(f=e;f<i;f+=n)g=nm(f,t[f],t[f+1],g);else for(f=i-n;f>=e;f-=n)g=nm(f,t[f],t[f+1],g);return g&&jp(g,g.next)&&(Uc(g),g=g.next),g}function Nc(t,e){if(!t)return t;e||(e=t);var i,n=t;do if(i=!1,n.steiner||!jp(n,n.next)&&xs(n.prev,n,n.next)!==0)n=n.next;else{if(Uc(n),(n=e=n.prev)===n.next)break;i=!0}while(i||n!==e);return e}function ql(t,e,i,n,c,f,g){if(t){!g&&f&&function(O,U,V,H){var Z=O;do Z.z===0&&(Z.z=Up(Z.x,Z.y,U,V,H)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next;while(Z!==O);Z.prevZ.nextZ=null,Z.prevZ=null,function(ee){var ce,_e,Me,ye,Se,Le,ke,nt,tt=1;do{for(_e=ee,ee=null,Se=null,Le=0;_e;){for(Le++,Me=_e,ke=0,ce=0;ce<tt&&(ke++,Me=Me.nextZ);ce++);for(nt=tt;ke>0||nt>0&&Me;)ke!==0&&(nt===0||!Me||_e.z<=Me.z)?(ye=_e,_e=_e.nextZ,ke--):(ye=Me,Me=Me.nextZ,nt--),Se?Se.nextZ=ye:ee=ye,ye.prevZ=Se,Se=ye;_e=Me}Se.nextZ=null,tt*=2}while(Le>1)}(Z)}(t,n,c,f);for(var b,A,k=t;t.prev!==t.next;)if(b=t.prev,A=t.next,f?qy(t,n,c,f):Ng(t))e.push(b.i/i|0),e.push(t.i/i|0),e.push(A.i/i|0),Uc(t),t=A.next,k=A.next;else if((t=A)===k){g?g===1?ql(t=rm(Nc(t),e,i),e,i,n,c,f,2):g===2&&Np(t,e,i,n,c,f):ql(Nc(t),e,i,n,c,f,1);break}}}function Ng(t){var e=t.prev,i=t,n=t.next;if(xs(e,i,n)>=0)return!1;for(var c=e.x,f=i.x,g=n.x,b=e.y,A=i.y,k=n.y,O=c<f?c<g?c:g:f<g?f:g,U=b<A?b<k?b:k:A<k?A:k,V=c>f?c>g?c:g:f>g?f:g,H=b>A?b>k?b:k:A>k?A:k,Z=n.next;Z!==e;){if(Z.x>=O&&Z.x<=V&&Z.y>=U&&Z.y<=H&&Gh(c,b,f,A,g,k,Z.x,Z.y)&&xs(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function qy(t,e,i,n){var c=t.prev,f=t,g=t.next;if(xs(c,f,g)>=0)return!1;for(var b=c.x,A=f.x,k=g.x,O=c.y,U=f.y,V=g.y,H=b<A?b<k?b:k:A<k?A:k,Z=O<U?O<V?O:V:U<V?U:V,ee=b>A?b>k?b:k:A>k?A:k,ce=O>U?O>V?O:V:U>V?U:V,_e=Up(H,Z,e,i,n),Me=Up(ee,ce,e,i,n),ye=t.prevZ,Se=t.nextZ;ye&&ye.z>=_e&&Se&&Se.z<=Me;){if(ye.x>=H&&ye.x<=ee&&ye.y>=Z&&ye.y<=ce&&ye!==c&&ye!==g&&Gh(b,O,A,U,k,V,ye.x,ye.y)&&xs(ye.prev,ye,ye.next)>=0||(ye=ye.prevZ,Se.x>=H&&Se.x<=ee&&Se.y>=Z&&Se.y<=ce&&Se!==c&&Se!==g&&Gh(b,O,A,U,k,V,Se.x,Se.y)&&xs(Se.prev,Se,Se.next)>=0))return!1;Se=Se.nextZ}for(;ye&&ye.z>=_e;){if(ye.x>=H&&ye.x<=ee&&ye.y>=Z&&ye.y<=ce&&ye!==c&&ye!==g&&Gh(b,O,A,U,k,V,ye.x,ye.y)&&xs(ye.prev,ye,ye.next)>=0)return!1;ye=ye.prevZ}for(;Se&&Se.z<=Me;){if(Se.x>=H&&Se.x<=ee&&Se.y>=Z&&Se.y<=ce&&Se!==c&&Se!==g&&Gh(b,O,A,U,k,V,Se.x,Se.y)&&xs(Se.prev,Se,Se.next)>=0)return!1;Se=Se.nextZ}return!0}function rm(t,e,i){var n=t;do{var c=n.prev,f=n.next.next;!jp(c,f)&&sm(c,n,n.next,f)&&vd(c,f)&&vd(f,c)&&(e.push(c.i/i|0),e.push(n.i/i|0),e.push(f.i/i|0),Uc(n),Uc(n.next),n=t=f),n=n.next}while(n!==t);return Nc(n)}function Np(t,e,i,n,c,f){var g=t;do{for(var b=g.next.next;b!==g.prev;){if(g.i!==b.i&&Ky(g,b)){var A=jg(g,b);return g=Nc(g,g.next),A=Nc(A,A.next),ql(g,e,i,n,c,f,0),void ql(A,e,i,n,c,f,0)}b=b.next}g=g.next}while(g!==t)}function Xy(t,e){return t.x-e.x}function Ug(t,e){var i=function(c,f){var g,b=f,A=c.x,k=c.y,O=-1/0;do{if(k<=b.y&&k>=b.next.y&&b.next.y!==b.y){var U=b.x+(k-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(U<=A&&U>O&&(O=U,g=b.x<b.next.x?b:b.next,U===A))return g}b=b.next}while(b!==f);if(!g)return null;var V,H=g,Z=g.x,ee=g.y,ce=1/0;b=g;do A>=b.x&&b.x>=Z&&A!==b.x&&Gh(k<ee?A:O,k,Z,ee,k<ee?O:A,k,b.x,b.y)&&(V=Math.abs(k-b.y)/(A-b.x),vd(b,c)&&(V<ce||V===ce&&(b.x>g.x||b.x===g.x&&Zy(g,b)))&&(g=b,ce=V)),b=b.next;while(b!==H);return g}(t,e);if(!i)return e;var n=jg(i,t);return Nc(n,n.next),Nc(i,i.next)}function Zy(t,e){return xs(t.prev,t,e.prev)<0&&xs(e.next,t,t.next)<0}function Up(t,e,i,n,c){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Yy(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Gh(t,e,i,n,c,f,g,b){return(c-g)*(e-b)>=(t-g)*(f-b)&&(t-g)*(n-b)>=(i-g)*(e-b)&&(i-g)*(f-b)>=(c-g)*(n-b)}function Ky(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,n){var c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==n.i&&c.next.i!==n.i&&sm(c,c.next,i,n))return!0;c=c.next}while(c!==i);return!1}(t,e)&&(vd(t,e)&&vd(e,t)&&function(i,n){var c=i,f=!1,g=(i.x+n.x)/2,b=(i.y+n.y)/2;do c.y>b!=c.next.y>b&&c.next.y!==c.y&&g<(c.next.x-c.x)*(b-c.y)/(c.next.y-c.y)+c.x&&(f=!f),c=c.next;while(c!==i);return f}(t,e)&&(xs(t.prev,t,e.prev)||xs(t,e.prev,e))||jp(t,e)&&xs(t.prev,t,t.next)>0&&xs(e.prev,e,e.next)>0)}function xs(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function jp(t,e){return t.x===e.x&&t.y===e.y}function sm(t,e,i,n){var c=xd(xs(t,e,i)),f=xd(xs(t,e,n)),g=xd(xs(i,n,t)),b=xd(xs(i,n,e));return c!==f&&g!==b||!(c!==0||!Vp(t,i,e))||!(f!==0||!Vp(t,n,e))||!(g!==0||!Vp(i,t,n))||!(b!==0||!Vp(i,e,n))}function Vp(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function xd(t){return t>0?1:t<0?-1:0}function vd(t,e){return xs(t.prev,t,t.next)<0?xs(t,e,t.next)>=0&&xs(t,t.prev,e)>=0:xs(t,e,t.prev)<0||xs(t,t.next,e)<0}function jg(t,e){var i=new om(t.i,t.x,t.y),n=new om(e.i,e.x,e.y),c=t.next,f=e.prev;return t.next=e,e.prev=t,i.next=c,c.prev=i,n.next=i,i.prev=n,f.next=n,n.prev=f,n}function nm(t,e,i,n){var c=new om(t,e,i);return n?(c.next=n.next,c.prev=n,n.next.prev=c,n.next=c):(c.prev=c,c.next=c),c}function Uc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function om(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function bd(t,e,i,n){for(var c=0,f=e,g=i-n;f<i;f+=n)c+=(t[g]-t[f])*(t[f+1]+t[g+1]),g=f;return c}Bp.exports=Fp,Bp.exports.default=Fp,Fp.deviation=function(t,e,i,n){var c=e&&e.length,f=Math.abs(bd(t,0,c?e[0]*i:t.length,i));if(c)for(var g=0,b=e.length;g<b;g++)f-=Math.abs(bd(t,e[g]*i,g<b-1?e[g+1]*i:t.length,i));var A=0;for(g=0;g<n.length;g+=3){var k=n[g]*i,O=n[g+1]*i,U=n[g+2]*i;A+=Math.abs((t[k]-t[U])*(t[O+1]-t[k+1])-(t[k]-t[O])*(t[U+1]-t[k+1]))}return f===0&&A===0?0:Math.abs((A-f)/f)},Fp.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,c=0;c<t.length;c++){for(var f=0;f<t[c].length;f++)for(var g=0;g<e;g++)i.vertices.push(t[c][f][g]);c>0&&i.holes.push(n+=t[c-1].length)}return i};var am=Be(Bp.exports);function Jy(t,e,i,n,c){Vg(t,e,i,n||t.length-1,c||Qy)}function Vg(t,e,i,n,c){for(;n>i;){if(n-i>600){var f=n-i+1,g=e-i+1,b=Math.log(f),A=.5*Math.exp(2*b/3),k=.5*Math.sqrt(b*A*(f-A)/f)*(g-f/2<0?-1:1);Vg(t,e,Math.max(i,Math.floor(e-g*A/f+k)),Math.min(n,Math.floor(e+(f-g)*A/f+k)),c)}var O=t[e],U=i,V=n;for($h(t,i,e),c(t[n],O)>0&&$h(t,i,n);U<V;){for($h(t,U,V),U++,V--;c(t[U],O)<0;)U++;for(;c(t[V],O)>0;)V--}c(t[i],O)===0?$h(t,i,V):$h(t,++V,n),V<=e&&(i=V+1),e<=V&&(n=V-1)}}function $h(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function Qy(t,e){return t<e?-1:t>e?1:0}function Gp(t,e){const i=t.length;if(i<=1)return[t];const n=[];let c,f;for(let g=0;g<i;g++){const b=Vt(t[g]);b!==0&&(t[g].area=Math.abs(b),f===void 0&&(f=b<0),f===b<0?(c&&n.push(c),c=[t[g]]):c.push(t[g]))}if(c&&n.push(c),e>1)for(let g=0;g<n.length;g++)n[g].length<=e||(Jy(n[g],e,1,n[g].length-1,Gg),n[g]=n[g].slice(0,e));return n}function Gg(t,e){return e.area-t.area}function lm(t,e,i){const n=i.patternDependencies;let c=!1;for(const f of e){const g=f.paint.get(`${t}-pattern`);g.isConstant()||(c=!0);const b=g.constantOr(null);b&&(c=!0,n[b]=!0)}return c}function cm(t,e,i,n,c){const f=c.patternDependencies;for(const g of e){const b=g.paint.get(`${t}-pattern`).value;if(b.kind!=="constant"){let A=b.evaluate({zoom:n},i,{},c.availableImages);A=A&&A.name?A.name:A,f[A]=!0,i.patterns[g.id]=A}}return i}class wd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Mt,this.indexArray=new di,this.indexArray2=new Gs,this.programConfigurations=new Ul(e.layers,e.zoom),this.segments=new us,this.segments2=new us,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,n,c){this.hasPattern=lm("fill",this.layers,i);const f=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:b,id:A,index:k,sourceLayerIndex:O}of e){const U=this.layers[0]._featureFilter.needGeometry,V=Fc(b,U);if(!this.layers[0]._featureFilter.filter(new F(this.zoom),V,n))continue;const H=f?f.evaluate(V,{},n,i.availableImages):void 0,Z={id:A,properties:b.properties,type:b.type,sourceLayerIndex:O,index:k,geometry:U?V.geometry:la(b,n,c),patterns:{},sortKey:H};g.push(Z)}f&&g.sort((b,A)=>b.sortKey-A.sortKey);for(const b of g){const{geometry:A,index:k,sourceLayerIndex:O}=b;if(this.hasPattern){const U=cm("fill",this.layers,b,this.zoom,i);this.patternFeatures.push(U)}else this.addFeature(b,A,k,n,{},i.availableImages);i.featureIndex.insert(e[k].feature,A,k,O,this.index)}}update(e,i,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,n,c)}addFeatures(e,i,n,c,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,n,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Hy),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,n,c,f,g=[]){for(const b of Gp(i,500)){let A=0;for(const Z of b)A+=Z.length;const k=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray),O=k.vertexLength,U=[],V=[];for(const Z of b){if(Z.length===0)continue;Z!==b[0]&&V.push(U.length/2);const ee=this.segments2.prepareSegment(Z.length,this.layoutVertexArray,this.indexArray2),ce=ee.vertexLength;this.layoutVertexArray.emplaceBack(Z[0].x,Z[0].y),this.indexArray2.emplaceBack(ce+Z.length-1,ce),U.push(Z[0].x),U.push(Z[0].y);for(let _e=1;_e<Z.length;_e++)this.layoutVertexArray.emplaceBack(Z[_e].x,Z[_e].y),this.indexArray2.emplaceBack(ce+_e-1,ce+_e),U.push(Z[_e].x),U.push(Z[_e].y);ee.vertexLength+=Z.length,ee.primitiveLength+=Z.length}const H=am(U,V);for(let Z=0;Z<H.length;Z+=3)this.indexArray.emplaceBack(O+H[Z],O+H[Z+1],O+H[Z+2]);k.vertexLength+=A,k.primitiveLength+=H.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,f,g,c)}}ni(wd,"FillBucket",{omit:["layers","patternFeatures"]});const ex=new be({"fill-sort-key":new ue(ut.layout_fill["fill-sort-key"])});var tx={paint:new be({"fill-antialias":new J(ut.paint_fill["fill-antialias"]),"fill-opacity":new ue(ut.paint_fill["fill-opacity"]),"fill-color":new ue(ut.paint_fill["fill-color"]),"fill-outline-color":new ue(ut.paint_fill["fill-outline-color"]),"fill-translate":new J(ut.paint_fill["fill-translate"]),"fill-translate-anchor":new J(ut.paint_fill["fill-translate-anchor"]),"fill-pattern":new ue(ut.paint_fill["fill-pattern"])}),layout:ex};const ix=$e([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),rx=$e([{name:"a_centroid_pos",components:2,type:"Uint16"}]),$g=$e([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Wg}=ix;var $p={},sx=Ne,hm=Wh;function Wh(t,e,i,n,c){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=c,t.readFields(Hg,this,e)}function Hg(t,e,i){t==1?e.id=i.readVarint():t==2?function(n,c){for(var f=n.readVarint()+n.pos;n.pos<f;){var g=c._keys[n.readVarint()],b=c._values[n.readVarint()];c.properties[g]=b}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function nx(t){for(var e,i,n=0,c=0,f=t.length,g=f-1;c<f;g=c++)n+=((i=t[g]).x-(e=t[c]).x)*(e.y+i.y);return n}Wh.types=["Unknown","Point","LineString","Polygon"],Wh.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,n=1,c=0,f=0,g=0,b=[];t.pos<i;){if(c<=0){var A=t.readVarint();n=7&A,c=A>>3}if(c--,n===1||n===2)f+=t.readSVarint(),g+=t.readSVarint(),n===1&&(e&&b.push(e),e=[]),e.push(new sx(f,g));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&b.push(e),b},Wh.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,c=0,f=0,g=1/0,b=-1/0,A=1/0,k=-1/0;t.pos<e;){if(n<=0){var O=t.readVarint();i=7&O,n=O>>3}if(n--,i===1||i===2)(c+=t.readSVarint())<g&&(g=c),c>b&&(b=c),(f+=t.readSVarint())<A&&(A=f),f>k&&(k=f);else if(i!==7)throw new Error("unknown command "+i)}return[g,A,b,k]},Wh.prototype.toGeoJSON=function(t,e,i){var n,c,f=this.extent*Math.pow(2,i),g=this.extent*t,b=this.extent*e,A=this.loadGeometry(),k=Wh.types[this.type];function O(H){for(var Z=0;Z<H.length;Z++){var ee=H[Z];H[Z]=[360*(ee.x+g)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(ee.y+b)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var U=[];for(n=0;n<A.length;n++)U[n]=A[n][0];O(A=U);break;case 2:for(n=0;n<A.length;n++)O(A[n]);break;case 3:for(A=function(H){var Z=H.length;if(Z<=1)return[H];for(var ee,ce,_e=[],Me=0;Me<Z;Me++){var ye=nx(H[Me]);ye!==0&&(ce===void 0&&(ce=ye<0),ce===ye<0?(ee&&_e.push(ee),ee=[H[Me]]):ee.push(H[Me]))}return ee&&_e.push(ee),_e}(A),n=0;n<A.length;n++)for(c=0;c<A[n].length;c++)O(A[n][c])}A.length===1?A=A[0]:k="Multi"+k;var V={type:"Feature",geometry:{type:k,coordinates:A},properties:this.properties};return"id"in this&&(V.id=this.id),V};var qg=hm,um=Xg;function Xg(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Zg,this,e),this.length=this._features.length}function Zg(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(n){for(var c=null,f=n.readVarint()+n.pos;n.pos<f;){var g=n.readVarint()>>3;c=g===1?n.readString():g===2?n.readFloat():g===3?n.readDouble():g===4?n.readVarint64():g===5?n.readVarint():g===6?n.readSVarint():g===7?n.readBoolean():null}return c}(i))}Xg.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new qg(this._pbf,e,this.extent,this._keys,this._values)};var ox=um;function dm(t,e,i){if(t===3){var n=new ox(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n)}}var pm=$p.VectorTile=function(t,e){this.layers=t.readFields(dm,{},e)},Td=$p.VectorTileFeature=hm;function Ed(t,e,i,n){const c=[],f=n===0?(g,b,A,k,O,U)=>{g.push(new Ge(U,A+(U-b)/(k-b)*(O-A)))}:(g,b,A,k,O,U)=>{g.push(new Ge(b+(U-A)/(O-A)*(k-b),U))};for(const g of t){const b=[];for(const A of g){if(A.length<=2)continue;const k=[];for(let V=0;V<A.length-1;V++){const H=A[V].x,Z=A[V].y,ee=A[V+1].x,ce=A[V+1].y,_e=n===0?H:Z,Me=n===0?ee:ce;_e<e?Me>e&&f(k,H,Z,ee,ce,e):_e>i?Me<i&&f(k,H,Z,ee,ce,i):k.push(A[V]),Me<e&&_e>=e&&f(k,H,Z,ee,ce,e),Me>i&&_e<=i&&f(k,H,Z,ee,ce,i)}let O=A[A.length-1];const U=n===0?O.x:O.y;U>=e&&U<=i&&k.push(O),k.length&&(O=k[k.length-1],k[0].x===O.x&&k[0].y===O.y||k.push(k[0]),b.push(k))}b.length&&c.push(b)}return c}$p.VectorTileLayer=um;const ax=Td.types,lx=Math.pow(2,13);function jc(t,e,i,n,c,f,g,b){t.emplaceBack((e<<1)+g,(i<<1)+f,(Math.floor(n*lx)<<1)+c,Math.round(b))}function Sd(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Yg{constructor(){this.acc=new Ge(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ge(e.x,e.y),this.max=new Ge(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const n=this.min,c=this.max;e.x<n.x?n.x=e.x:e.x>c.x&&(c.x=e.x),e.y<n.y?n.y=e.y:e.y>c.y&&(c.y=e.y),((e.x===0||e.x===pi)&&e.x===i.x)!=((e.y===0||e.y===pi)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,nr(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>pi!=e.x>pi&&this.addBorderIntersection(1,nr(i.y,e.y,(pi-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,nr(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>pi!=e.y>pi&&this.addBorderIntersection(3,nr(i.x,e.x,(pi-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];i<n[0]&&(n[0]=i),i>n[1]&&(n[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const n=e.x===0?0:1;this.addBorderIntersection(n,i.y),this.addBorderIntersection(n,e.y)}else{const n=e.y===0?2:3;this.addBorderIntersection(n,i.x),this.addBorderIntersection(n,e.x)}}centroid(){const e=this.polyCount.reduce((i,n)=>i+n.edges,0);return e!==0?this.acc.div(e)._round():new Ge(0,0)}span(){return new Ge(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class Ad{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new gt,this.centroidVertexArray=new Po,this.indexArray=new di,this.programConfigurations=new Ul(e.layers,e.zoom),this.segments=new us,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,n,c){this.features=[],this.hasPattern=lm("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){const g=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*g/(g*g+1)/pi/(1<<f.z)}(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:g,index:b,sourceLayerIndex:A}of e){const k=this.layers[0]._featureFilter.needGeometry,O=Fc(f,k);if(!this.layers[0]._featureFilter.filter(new F(this.zoom),O,n))continue;const U={id:g,sourceLayerIndex:A,index:b,geometry:k?O.geometry:la(f,n,c),properties:f.properties,type:f.type,patterns:{}},V=this.layoutVertexArray.length;this.hasPattern?this.features.push(cm("fill-extrusion",this.layers,U,this.zoom,i)):this.addFeature(U,U.geometry,b,n,{},i.availableImages,c),i.featureIndex.insert(f,U.geometry,b,A,this.index,V)}this.sortBorders()}addFeatures(e,i,n,c,f){for(const g of this.features){const{geometry:b}=g;this.addFeature(g,b,g.index,i,n,c,f)}this.sortBorders()}update(e,i,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,n,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wg),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,$g.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,rx.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,n,c,f,g,b){const A=[new Ge(0,0),new Ge(pi,pi)],k=b.projection,O=k.name==="globe",U=this.enableTerrain&&!O?new Yg:null,V=ax[e.type]==="Polygon";O&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Lt);const H=Gp(i,500);for(let _e=H.length-1;_e>=0;_e--){const Me=H[_e];(Me.length===0||(Z=Me[0]).every(ye=>ye.x<=0)||Z.every(ye=>ye.x>=pi)||Z.every(ye=>ye.y<=0)||Z.every(ye=>ye.y>=pi))&&H.splice(_e,1)}var Z;let ee;if(O)ee=fm(H,A,c);else{ee=[];for(const _e of H)ee.push({polygon:_e,bounds:A})}const ce=V?this.edgeRadius:0;for(const{polygon:_e,bounds:Me}of ee){let ye=0,Se=0;for(const ke of _e)V&&!ke[0].equals(ke[ke.length-1])&&ke.push(ke[0]),Se+=V?ke.length-1:ke.length;const Le=this.segments.prepareSegment((V?5:4)*Se,this.layoutVertexArray,this.indexArray);if(V){const ke=[],nt=[];ye=Le.vertexLength;for(const mt of _e){let zt,at;mt.length&&mt!==_e[0]&&nt.push(ke.length/2),zt=mt[1].sub(mt[0])._perp()._unit();for(let bt=1;bt<mt.length;bt++){const wt=mt[bt],Ct=mt[bt===mt.length-1?1:bt+1];let{x:Nt,y:dt}=wt;if(ce){at=Ct.sub(wt)._perp()._unit();const Xt=zt.add(at)._unit(),ui=ce*Math.min(4,1/(zt.x*Xt.x+zt.y*Xt.y));Nt+=ui*Xt.x,dt+=ui*Xt.y,zt=at}jc(this.layoutVertexArray,Nt,dt,0,0,1,1,0),Le.vertexLength++,ke.push(wt.x,wt.y),O&&Sd(this.layoutVertexExtArray,k.projectTilePoint(Nt,dt,c),k.upVector(c,Nt,dt))}}const tt=am(ke,nt);for(let mt=0;mt<tt.length;mt+=3)this.indexArray.emplaceBack(ye+tt[mt],ye+tt[mt+2],ye+tt[mt+1]),Le.primitiveLength++}for(const ke of _e){U&&ke.length&&U.startRing(ke[0]);let nt,tt,mt,zt=ke.length>4&&Qg(ke[ke.length-2],ke[0],ke[1]),at=ce?cx(ke[ke.length-2],ke[0],ke[1],ce):0;tt=ke[1].sub(ke[0])._perp()._unit();let bt=!0;for(let wt=1,Ct=0;wt<ke.length;wt++){let Nt=ke[wt-1],dt=ke[wt];const Xt=ke[wt===ke.length-1?1:wt+1];if(U&&V&&U.currentPolyCount.top++,Md(dt,Nt,Me)){ce&&(tt=Xt.sub(dt)._perp()._unit(),bt=!bt);continue}U&&U.append(dt,Nt);const ui=dt.sub(Nt)._perp(),Jt=ui.x/(Math.abs(ui.x)+Math.abs(ui.y)),Ni=ui.y>0?1:0,Ut=Nt.dist(dt);if(Ct+Ut>32768&&(Ct=0),ce){mt=Xt.sub(dt)._perp()._unit();let ji=Jg(Nt,dt,Xt,Kg(tt,mt),ce);isNaN(ji)&&(ji=0);const Ai=dt.sub(Nt)._unit();Nt=Nt.add(Ai.mult(at))._round(),dt=dt.add(Ai.mult(-ji))._round(),at=ji,tt=mt}const bi=Le.vertexLength,Ui=ke.length>4&&Qg(Nt,dt,Xt);let _r=e_(Ct,zt,bt);if(jc(this.layoutVertexArray,Nt.x,Nt.y,Jt,Ni,0,0,_r),jc(this.layoutVertexArray,Nt.x,Nt.y,Jt,Ni,0,1,_r),Ct+=Ut,_r=e_(Ct,Ui,!bt),zt=Ui,jc(this.layoutVertexArray,dt.x,dt.y,Jt,Ni,0,0,_r),jc(this.layoutVertexArray,dt.x,dt.y,Jt,Ni,0,1,_r),Le.vertexLength+=4,this.indexArray.emplaceBack(bi+0,bi+1,bi+2),this.indexArray.emplaceBack(bi+1,bi+3,bi+2),Le.primitiveLength+=2,ce){const ji=ye+(wt===1?ke.length-2:wt-2),Ai=wt===1?ye:ji+1;if(this.indexArray.emplaceBack(bi+1,ji,bi+3),this.indexArray.emplaceBack(ji,Ai,bi+3),Le.primitiveLength+=2,nt===void 0&&(nt=bi),!Md(Xt,ke[wt],Me)){const qr=wt===ke.length-1?nt:Le.vertexLength;this.indexArray.emplaceBack(bi+2,bi+3,qr),this.indexArray.emplaceBack(bi+3,qr+1,qr),this.indexArray.emplaceBack(bi+3,Ai,qr+1),Le.primitiveLength+=3}bt=!bt}if(O){const ji=this.layoutVertexExtArray,Ai=k.projectTilePoint(Nt.x,Nt.y,c),qr=k.projectTilePoint(dt.x,dt.y,c),$i=k.upVector(c,Nt.x,Nt.y),Wi=k.upVector(c,dt.x,dt.y);Sd(ji,Ai,$i),Sd(ji,Ai,$i),Sd(ji,qr,Wi),Sd(ji,qr,Wi)}}V&&(ye+=ke.length-1)}}if(U&&U.polyCount.length>0){if(U.borders){U.vertexArrayOffset=this.centroidVertexArray.length;const _e=U.borders,Me=this.featuresOnBorder.push(U)-1;for(let ye=0;ye<4;ye++)_e[ye][0]!==Number.MAX_VALUE&&this.borders[ye].push(Me)}this.encodeCentroid(U.borders?void 0:U.centroid(),U)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,f,g,c)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,n)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}encodeCentroid(e,i,n=!0){let c,f;if(e)if(e.y!==0){const b=i.span()._mult(this.tileToMeter);c=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(b.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(b.y/10))}else c=Math.ceil(7*(e.x+450)),f=0;else c=0,f=+n;let g=n?this.centroidVertexArray.length:i.vertexArrayOffset;for(const b of i.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*b.edges+b.top);for(let A=0;A<b.top;A++)this.centroidVertexArray.emplace(g++,c,f);for(let A=0;A<2*b.edges;A++)this.centroidVertexArray.emplace(g++,0,f),this.centroidVertexArray.emplace(g++,c,f)}}}function Kg(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function cx(t,e,i,n){const c=e.sub(t)._perp()._unit(),f=i.sub(e)._perp()._unit();return Jg(t,e,i,Kg(c,f),n)}function Jg(t,e,i,n,c){const f=Math.sqrt(1-n*n);return Math.min(t.dist(e)/3,e.dist(i)/3,c*f/n)}function Md(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function Qg(t,e,i){if(t.x<0||t.x>=pi||e.x<0||e.x>=pi||i.x<0||i.x>=pi)return!1;const n=i.sub(e),c=n.perp(),f=t.sub(e);return(n.x*f.x+n.y*f.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(f.x*f.x+f.y*f.y))>-.866&&c.x*f.x+c.y*f.y<0}function e_(t,e,i){const n=e?2|t:-3&t;return i?1|n:-2&n}function t_(){const t=Math.PI/32,e=Math.tan(t),i=hd;return i*Math.sqrt(1+2*e*e)-i}function fm(t,e,i){const n=1<<i.z,c=co(i.x/n),f=co((i.x+1)/n),g=sn(i.y/n),b=sn((i.y+1)/n);return function(A,k,O,U,V=0,H){const Z=[];if(!A.length||!O||!U)return Z;const ee=(ke,nt)=>{for(const tt of ke)Z.push({polygon:tt,bounds:nt})},ce=Math.ceil(Math.log2(O)),_e=Math.ceil(Math.log2(U)),Me=ce-_e,ye=[];for(let ke=0;ke<Math.abs(Me);ke++)ye.push(Me>0?0:1);for(let ke=0;ke<Math.min(ce,_e);ke++)ye.push(0),ye.push(1);let Se=A;if(Se=Ed(Se,k[0].y-V,k[1].y+V,1),Se=Ed(Se,k[0].x-V,k[1].x+V,0),!Se.length)return Z;const Le=[];for(ye.length?Le.push({polygons:Se,bounds:k,depth:0}):ee(Se,k);Le.length;){const ke=Le.pop(),nt=ke.depth,tt=ye[nt],mt=ke.bounds[0],zt=ke.bounds[1],at=tt===0?mt.x:mt.y,bt=tt===0?zt.x:zt.y,wt=H?H(tt,at,bt):.5*(at+bt),Ct=Ed(ke.polygons,at-V,wt+V,tt),Nt=Ed(ke.polygons,wt-V,bt+V,tt);if(Ct.length){const dt=[mt,new Ge(tt===0?wt:zt.x,tt===1?wt:zt.y)];ye.length>nt+1?Le.push({polygons:Ct,bounds:dt,depth:nt+1}):ee(Ct,dt)}if(Nt.length){const dt=[new Ge(tt===0?wt:mt.x,tt===1?wt:mt.y),zt];ye.length>nt+1?Le.push({polygons:Nt,bounds:dt,depth:nt+1}):ee(Nt,dt)}}return Z}(t,e,Math.ceil((f-c)/11.25),Math.ceil((g-b)/11.25),1,(A,k,O)=>{if(A===0)return .5*(k+O);{const U=sn((i.y+k/pi)/n);return(Ro(.5*(sn((i.y+O/pi)/n)+U))*n-i.y)*pi}})}ni(Ad,"FillExtrusionBucket",{omit:["layers","features"]}),ni(Yg,"PartMetadata");const R=new be({"fill-extrusion-edge-radius":new J(ut["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var s={paint:new be({"fill-extrusion-opacity":new J(ut["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ue(ut["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new J(ut["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new J(ut["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ue(ut["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ue(ut["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ue(ut["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new J(ut["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new J(ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new J(ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new J(ut["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:R};function u(t,e,i){var n=2*Math.PI*6378137/256/Math.pow(2,i);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class p{constructor(e,i,n){this.z=e,this.x=i,this.y=n,this.key=E(0,e,e,i,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const n=function(f,g,b){var A=u(256*f,256*(g=Math.pow(2,b)-g-1),b),k=u(256*(f+1),256*(g+1),b);return A[0]+","+A[1]+","+k[0]+","+k[1]}(this.x,this.y,this.z),c=function(f,g,b){let A,k="";for(let O=f;O>0;O--)A=1<<O-1,k+=(g&A?1:0)+(b&A?2:0);return k}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class y{constructor(e,i){this.wrap=e,this.canonical=i,this.key=E(e,i.z,i.z,i.x,i.y)}}class x{constructor(e,i,n,c,f){this.overscaledZ=e,this.wrap=i,this.canonical=new p(n,+c,+f),this.key=i===0&&e===n?this.canonical.key:E(i,e,n,c,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new x(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new x(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return E(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return E(this.wrap*+i,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new x(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,n=2*this.canonical.x,c=2*this.canonical.y;return[new x(i,this.wrap,i,n,c),new x(i,this.wrap,i,n+1,c),new x(i,this.wrap,i,n,c+1),new x(i,this.wrap,i,n+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new x(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new x(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new y(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function E(t,e,i,n,c){const f=1<<Math.min(i,22);let g=f*(c%f)+n%f;return t&&i<22&&(g+=f*f*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*g+i)+(e-i)}ni(p,"CanonicalTileID"),ni(x,"OverscaledTileID",{omit:["projMatrix"]});class S extends Ge{constructor(e,i,n){super(e,i),this.z=n}}function C(t,e){return t.x*e.x+t.y*e.y}function L(t,e){if(t.length===1){let i=0;const n=e[i++];let c;for(;!c||n.equals(c);)if(c=e[i++],!c)return 1/0;for(;i<e.length;i++){const f=e[i],g=t[0],b=c.sub(n),A=f.sub(n),k=g.sub(n),O=C(b,b),U=C(b,A),V=C(A,A),H=C(k,b),Z=C(k,A),ee=O*V-U*U,ce=(V*H-U*Z)/ee,_e=(O*Z-U*H)/ee,Me=n.z*(1-ce-_e)+c.z*ce+f.z*_e;if(isFinite(Me))return Me}return 1/0}{let i=1/0;for(const n of e)i=Math.min(i,n.z);return i}}function N(t,e,i,n,c,f,g,b){const A=g*c.getElevationAt(t,e,!0,!0),k=f[0]!==0,O=k?f[1]===0?g*(f[0]/7-450):g*function(U,V,H){const Z=Math.floor(V[0]/8),ee=Math.floor(V[1]/8),ce=10*(V[0]-8*Z),_e=10*(V[1]-8*ee),Me=U.getElevationAt(Z,ee,!0,!0),ye=U.getMeterToDEM(H),Se=Math.floor(.5*(ce*ye-1)),Le=Math.floor(.5*(_e*ye-1)),ke=U.tileCoordToPixel(Z,ee),nt=2*Se+1,tt=2*Le+1,mt=function(Nt,dt,Xt,ui,Jt){return[Nt.getElevationAtPixel(dt,Xt,!0),Nt.getElevationAtPixel(dt+Jt,Xt,!0),Nt.getElevationAtPixel(dt,Xt+Jt,!0),Nt.getElevationAtPixel(dt+ui,Xt+Jt,!0)]}(U,ke.x-Se,ke.y-Le,nt,tt),zt=Math.abs(mt[0]-mt[1]),at=Math.abs(mt[2]-mt[3]),bt=Math.abs(mt[0]-mt[2])+Math.abs(mt[1]-mt[3]),wt=Math.min(.25,.5*ye*(zt+at)/nt),Ct=Math.min(.25,.5*ye*bt/tt);return Me+Math.max(wt*ce,Ct*_e)}(c,f,b):A;return{base:A+(i===0)?-1:i,top:k?Math.max(O+n,A+i+2):A+n}}const z=$e([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:j}=z,W=$e([{name:"a_packed",components:4,type:"Float32"}]),{members:Y}=W,re=Td.types,te=Math.cos(Math.PI/180*37.5);class Q{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new ot,this.layoutVertexArray2=new Pt,this.indexArray=new di,this.programConfigurations=new Ul(e.layers,e.zoom),this.segments=new us,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,n,c){this.hasPattern=lm("line",this.layers,i);const f=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:O,id:U,index:V,sourceLayerIndex:H}of e){const Z=this.layers[0]._featureFilter.needGeometry,ee=Fc(O,Z);if(!this.layers[0]._featureFilter.filter(new F(this.zoom),ee,n))continue;const ce=f?f.evaluate(ee,{},n):void 0,_e={id:U,properties:O.properties,type:O.type,sourceLayerIndex:H,index:V,geometry:Z?ee.geometry:la(O,n,c),patterns:{},sortKey:ce};g.push(_e)}f&&g.sort((O,U)=>O.sortKey-U.sortKey);const{lineAtlas:b,featureIndex:A}=i,k=this.addConstantDashes(b);for(const O of g){const{geometry:U,index:V,sourceLayerIndex:H}=O;if(k&&this.addFeatureDashes(O,b),this.hasPattern){const Z=cm("line",this.layers,O,this.zoom,i);this.patternFeatures.push(Z)}else this.addFeature(O,U,V,n,b.positions,i.availableImages);A.insert(e[V].feature,U,V,H,this.index)}}addConstantDashes(e){let i=!1;for(const n of this.layers){const c=n.paint.get("line-dasharray").value,f=n.layout.get("line-cap").value;if(c.kind!=="constant"||f.kind!=="constant")i=!0;else{const g=f.value,b=c.value;if(!b)continue;e.addDash(b,g)}}return i}addFeatureDashes(e,i){const n=this.zoom;for(const c of this.layers){const f=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if(f.kind==="constant"&&g.kind==="constant")continue;let b,A;if(f.kind==="constant"){if(b=f.value,!b)continue}else b=f.evaluate({zoom:n},e);A=g.kind==="constant"?g.value:g.evaluate({zoom:n},e),i.addDash(b,A),e.patterns[c.id]=i.getKey(b,A)}}update(e,i,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,n,c)}addFeatures(e,i,n,c,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,n,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Y)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,j),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,n,c,f,g){const b=this.layers[0].layout,A=b.get("line-join").evaluate(e,{}),k=b.get("line-cap").evaluate(e,{}),O=b.get("line-miter-limit"),U=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const V of i)this.addLine(V,e,A,k,O,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,f,g,c)}addLine(e,i,n,c,f,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let _e=0;_e<e.length-1;_e++)this.totalDistance+=e[_e].dist(e[_e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b=re[i.type]==="Polygon";let A=e.length;for(;A>=2&&e[A-1].equals(e[A-2]);)A--;let k=0;for(;k<A-1&&e[k].equals(e[k+1]);)k++;if(A<(b?3:2))return;n==="bevel"&&(f=1.05);const O=this.overscaling<=16?15*pi/(512*this.overscaling):0,U=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let V,H,Z,ee,ce;this.e1=this.e2=-1,b&&(V=e[A-2],ce=e[k].sub(V)._unit()._perp());for(let _e=k;_e<A;_e++){if(Z=_e===A-1?b?e[k+1]:void 0:e[_e+1],Z&&e[_e].equals(Z))continue;ce&&(ee=ce),V&&(H=V),V=e[_e],ce=Z?Z.sub(V)._unit()._perp():ee,ee=ee||ce;let Me=ee.add(ce);Me.x===0&&Me.y===0||Me._unit();const ye=ee.x*ce.x+ee.y*ce.y,Se=Me.x*ce.x+Me.y*ce.y,Le=Se!==0?1/Se:1/0,ke=2*Math.sqrt(2-2*Se),nt=Se<te&&H&&Z,tt=ee.x*ce.y-ee.y*ce.x>0;if(nt&&_e>k){const at=V.dist(H);if(at>2*O){const bt=V.sub(V.sub(H)._mult(O/at)._round());this.updateDistance(H,bt),this.addCurrentVertex(bt,ee,0,0,U),H=bt}}const mt=H&&Z;let zt=mt?n:b?"butt":c;if(mt&&zt==="round"&&(Le<g?zt="miter":Le<=2&&(zt="fakeround")),zt==="miter"&&Le>f&&(zt="bevel"),zt==="bevel"&&(Le>2&&(zt="flipbevel"),Le<f&&(zt="miter")),H&&this.updateDistance(H,V),zt==="miter")Me._mult(Le),this.addCurrentVertex(V,Me,0,0,U);else if(zt==="flipbevel"){if(Le>100)Me=ce.mult(-1);else{const at=Le*ee.add(ce).mag()/ee.sub(ce).mag();Me._perp()._mult(at*(tt?-1:1))}this.addCurrentVertex(V,Me,0,0,U),this.addCurrentVertex(V,Me.mult(-1),0,0,U)}else if(zt==="bevel"||zt==="fakeround"){const at=-Math.sqrt(Le*Le-1),bt=tt?at:0,wt=tt?0:at;if(H&&this.addCurrentVertex(V,ee,bt,wt,U),zt==="fakeround"){const Ct=Math.round(180*ke/Math.PI/20);for(let Nt=1;Nt<Ct;Nt++){let dt=Nt/Ct;if(dt!==.5){const ui=dt-.5;dt+=dt*ui*(dt-1)*((1.0904+ye*(ye*(3.55645-1.43519*ye)-3.2452))*ui*ui+(.848013+ye*(.215638*ye-1.06021)))}const Xt=ce.sub(ee)._mult(dt)._add(ee)._unit()._mult(tt?-1:1);this.addHalfVertex(V,Xt.x,Xt.y,!1,tt,0,U)}}Z&&this.addCurrentVertex(V,ce,-bt,-wt,U)}else if(zt==="butt")this.addCurrentVertex(V,Me,0,0,U);else if(zt==="square"){const at=H?1:-1;H||this.addCurrentVertex(V,Me,at,at,U),this.addCurrentVertex(V,Me,0,0,U),H&&this.addCurrentVertex(V,Me,at,at,U)}else zt==="round"&&(H&&(this.addCurrentVertex(V,ee,0,0,U),this.addCurrentVertex(V,ee,1,1,U,!0)),Z&&(this.addCurrentVertex(V,ce,-1,-1,U,!0),this.addCurrentVertex(V,ce,0,0,U)));if(nt&&_e<A-1){const at=V.dist(Z);if(at>2*O){const bt=V.add(Z.sub(V)._mult(O/at)._round());this.updateDistance(V,bt),this.addCurrentVertex(bt,ce,0,0,U),V=bt}}}}addCurrentVertex(e,i,n,c,f,g=!1){const b=i.y*c-i.x,A=-i.y-i.x*c;this.addHalfVertex(e,i.x+i.y*n,i.y-i.x*n,g,!1,n,f),this.addHalfVertex(e,b,A,g,!0,-c,f)}addHalfVertex({x:e,y:i},n,c,f,g,b,A){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(g?1:0),Math.round(63*n)+128,Math.round(63*c)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const k=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),A.primitiveLength++),g?this.e2=k:this.e1=k}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}ni(Q,"LineBucket",{omit:["layers","patternFeatures"]});const ae=new be({"line-cap":new ue(ut.layout_line["line-cap"]),"line-join":new ue(ut.layout_line["line-join"]),"line-miter-limit":new J(ut.layout_line["line-miter-limit"]),"line-round-limit":new J(ut.layout_line["line-round-limit"]),"line-sort-key":new ue(ut.layout_line["line-sort-key"])});var he={paint:new be({"line-opacity":new ue(ut.paint_line["line-opacity"]),"line-color":new ue(ut.paint_line["line-color"]),"line-translate":new J(ut.paint_line["line-translate"]),"line-translate-anchor":new J(ut.paint_line["line-translate-anchor"]),"line-width":new ue(ut.paint_line["line-width"]),"line-gap-width":new ue(ut.paint_line["line-gap-width"]),"line-offset":new ue(ut.paint_line["line-offset"]),"line-blur":new ue(ut.paint_line["line-blur"]),"line-dasharray":new ue(ut.paint_line["line-dasharray"]),"line-pattern":new ue(ut.paint_line["line-pattern"]),"line-gradient":new ve(ut.paint_line["line-gradient"]),"line-trim-offset":new J(ut.paint_line["line-trim-offset"])}),layout:ae};const Ue=new class extends ue{possiblyEvaluate(t,e){return e=new F(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,n){return e=br({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,n)}}(he.paint.properties["line-width"].specification);function Ie(t,e){return e>0?e+2*t:t}Ue.useIntegerZoom=!0;const Re=$e([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),rt=$e([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),qe=$e([{name:"a_projected_pos",components:4,type:"Float32"}],4);$e([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const st=$e([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Et=$e([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);$e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Bt=$e([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$t=$e([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);$e([{name:"triangle",components:3,type:"Uint16"}]),$e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),$e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),$e([{type:"Float32",name:"offsetX"}]),$e([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var At=24;const Kt=128;function si(t,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new F(t+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:c}=i;let f=0;for(;f<n.length&&n[f]<=t;)f++;f=Math.max(0,f-1);let g=f;for(;g<n.length&&n[g]<t+1;)g++;g=Math.min(n.length-1,g);const b=n[f],A=n[g];return i.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:A,interpolationType:c}:{kind:"camera",minZoom:b,maxZoom:A,minSize:i.evaluate(new F(b)),maxSize:i.evaluate(new F(A)),interpolationType:c}}}function Ii(t,{uSize:e,uSizeT:i},{lowerSize:n,upperSize:c}){return t.kind==="source"?n/Kt:t.kind==="composite"?nr(n/Kt,c/Kt,i):e}function hi(t,e){let i=0,n=0;if(t.kind==="constant")n=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:c,minZoom:f,maxZoom:g}=t,b=c?vi(zn.interpolationFactor(c,e,f,g),0,1):0;t.kind==="camera"?n=nr(t.minSize,t.maxSize,b):i=b}return{uSizeT:i,uSize:n}}var Li=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Kt,evaluateSizeForFeature:Ii,evaluateSizeForZoom:hi,getSizeData:si});function ar(t,e,i){return t.sections.forEach(n=>{n.text=function(c,f,g){const b=f.layout.get("text-transform").evaluate(g,{});return b==="uppercase"?c=c.toLocaleUpperCase():b==="lowercase"&&(c=c.toLocaleLowerCase()),I.applyArabicShaping&&(c=I.applyArabicShaping(c)),c}(n.text,e,i)}),t}const Zi={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function dr(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}function pn(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}var lr=ii,Cr=function(t,e,i,n,c){var f,g,b=8*c-n-1,A=(1<<b)-1,k=A>>1,O=-7,U=c-1,V=-1,H=t[e+U];for(U+=V,f=H&(1<<-O)-1,H>>=-O,O+=b;O>0;f=256*f+t[e+U],U+=V,O-=8);for(g=f&(1<<-O)-1,f>>=-O,O+=n;O>0;g=256*g+t[e+U],U+=V,O-=8);if(f===0)f=1-k;else{if(f===A)return g?NaN:1/0*(H?-1:1);g+=Math.pow(2,n),f-=k}return(H?-1:1)*g*Math.pow(2,f-n)},Fi=function(t,e,i,n,c,f){var g,b,A,k=8*f-c-1,O=(1<<k)-1,U=O>>1,V=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,H=0,Z=1,ee=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,g=O):(g=Math.floor(Math.log(e)/Math.LN2),e*(A=Math.pow(2,-g))<1&&(g--,A*=2),(e+=g+U>=1?V/A:V*Math.pow(2,1-U))*A>=2&&(g++,A/=2),g+U>=O?(b=0,g=O):g+U>=1?(b=(e*A-1)*Math.pow(2,c),g+=U):(b=e*Math.pow(2,U-1)*Math.pow(2,c),g=0));c>=8;t[i+H]=255&b,H+=Z,b/=256,c-=8);for(g=g<<c|b,k+=c;k>0;t[i+H]=255&g,H+=Z,g/=256,k-=8);t[i+H-Z]|=128*ee};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function ii(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ii.Varint=0,ii.Fixed64=1,ii.Bytes=2,ii.Fixed32=5;var ds=4294967296,kr=1/ds,Ur=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Hr(t){return t.type===ii.Bytes?t.readVarint()+t.pos:t.pos+1}function $n(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function uo(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var c=i.pos-1;c>=t;c--)i.buf[c+n]=i.buf[c]}function zo(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function Pn(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Ps(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function Cd(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function Xl(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function Vc(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function kd(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function ca(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Hh(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Pd(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Wp(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function mv(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}ii.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),c=n>>3,f=this.pos;this.type=7&n,t(c,e,this),this.pos===f&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Pd(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=mv(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Pd(this.buf,this.pos)+Pd(this.buf,this.pos+4)*ds;return this.pos+=8,t},readSFixed64:function(){var t=Pd(this.buf,this.pos)+mv(this.buf,this.pos+4)*ds;return this.pos+=8,t},readFloat:function(){var t=Cr(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Cr(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(c,f,g){var b,A,k=g.buf;if(b=(112&(A=k[g.pos++]))>>4,A<128||(b|=(127&(A=k[g.pos++]))<<3,A<128)||(b|=(127&(A=k[g.pos++]))<<10,A<128)||(b|=(127&(A=k[g.pos++]))<<17,A<128)||(b|=(127&(A=k[g.pos++]))<<24,A<128)||(b|=(1&(A=k[g.pos++]))<<31,A<128))return $n(c,b,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Ur?function(i,n,c){return Ur.decode(i.subarray(n,c))}(this.buf,e,t):function(i,n,c){for(var f="",g=n;g<c;){var b,A,k,O=i[g],U=null,V=O>239?4:O>223?3:O>191?2:1;if(g+V>c)break;V===1?O<128&&(U=O):V===2?(192&(b=i[g+1]))==128&&(U=(31&O)<<6|63&b)<=127&&(U=null):V===3?(A=i[g+2],(192&(b=i[g+1]))==128&&(192&A)==128&&((U=(15&O)<<12|(63&b)<<6|63&A)<=2047||U>=55296&&U<=57343)&&(U=null)):V===4&&(A=i[g+2],k=i[g+3],(192&(b=i[g+1]))==128&&(192&A)==128&&(192&k)==128&&((U=(15&O)<<18|(63&b)<<12|(63&A)<<6|63&k)<=65535||U>=1114112)&&(U=null)),U===null?(U=65533,V=1):U>65535&&(U-=65536,f+=String.fromCharCode(U>>>10&1023|55296),U=56320|1023&U),f+=String.fromCharCode(U),g+=V}return f}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==ii.Bytes)return t.push(this.readVarint(e));var i=Hr(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==ii.Bytes)return t.push(this.readSVarint());var e=Hr(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ii.Bytes)return t.push(this.readBoolean());var e=Hr(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ii.Bytes)return t.push(this.readFloat());var e=Hr(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ii.Bytes)return t.push(this.readDouble());var e=Hr(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ii.Bytes)return t.push(this.readFixed32());var e=Hr(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ii.Bytes)return t.push(this.readSFixed32());var e=Hr(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ii.Bytes)return t.push(this.readFixed64());var e=Hr(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ii.Bytes)return t.push(this.readSFixed64());var e=Hr(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===ii.Varint)for(;this.buf[this.pos++]>127;);else if(e===ii.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ii.Fixed32)this.pos+=4;else{if(e!==ii.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Wp(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Wp(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Wp(this.buf,-1&t,this.pos),Wp(this.buf,Math.floor(t*kr),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Wp(this.buf,-1&t,this.pos),Wp(this.buf,Math.floor(t*kr),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var n,c;if(e>=0?(n=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(f,g,b){b.buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,b.buf[b.pos]=127&(f>>>=7)}(n,0,i),function(f,g){var b=(7&f)<<4;g.buf[g.pos++]|=b|((f>>>=3)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f)))))}(c,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(n,c,f){for(var g,b,A=0;A<c.length;A++){if((g=c.charCodeAt(A))>55295&&g<57344){if(!b){g>56319||A+1===c.length?(n[f++]=239,n[f++]=191,n[f++]=189):b=g;continue}if(g<56320){n[f++]=239,n[f++]=191,n[f++]=189,b=g;continue}g=b-55296<<10|g-56320|65536,b=null}else b&&(n[f++]=239,n[f++]=191,n[f++]=189,b=null);g<128?n[f++]=g:(g<2048?n[f++]=g>>6|192:(g<65536?n[f++]=g>>12|224:(n[f++]=g>>18|240,n[f++]=g>>12&63|128),n[f++]=g>>6&63|128),n[f++]=63&g|128)}return f}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&uo(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),Fi(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Fi(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&uo(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,ii.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,zo,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Pn,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Xl,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Ps,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Cd,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Vc,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,kd,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,ca,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Hh,e)},writeBytesField:function(t,e){this.writeTag(t,ii.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,ii.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,ii.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,ii.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,ii.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,ii.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,ii.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,ii.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,ii.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,ii.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var i_=Be(lr);const hx=3;function BE(t,e,i){e.glyphs=[],t===1&&i.readMessage(FE,e)}function FE(t,e,i){if(t===3){const{id:n,bitmap:c,width:f,height:g,left:b,top:A,advance:k}=i.readMessage(NE,{});e.glyphs.push({id:n,bitmap:new il({width:f+2*hx,height:g+2*hx},c),metrics:{width:f,height:g,left:b,top:A,advance:k}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function NE(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}const UE=hx;function ux(t){let e=0,i=0;for(const g of t)e+=g.w*g.h,i=Math.max(i,g.w);t.sort((g,b)=>b.h-g.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let c=0,f=0;for(const g of t)for(let b=n.length-1;b>=0;b--){const A=n[b];if(!(g.w>A.w||g.h>A.h)){if(g.x=A.x,g.y=A.y,f=Math.max(f,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===A.w&&g.h===A.h){const k=n.pop();b<n.length&&(n[b]=k)}else g.h===A.h?(A.x+=g.w,A.w-=g.w):g.w===A.w?(A.y+=g.h,A.h-=g.h):(n.push({x:A.x+g.w,y:A.y,w:A.w-g.w,h:g.h}),A.y+=g.h,A.h-=g.h);break}}return{w:c,h:f,fill:e/(c*f)||0}}const po=1;class dx{constructor(e,{pixelRatio:i,version:n,stretchX:c,stretchY:f,content:g}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=c,this.stretchY=f,this.content=g,this.version=n}get tl(){return[this.paddedRect.x+po,this.paddedRect.y+po]}get br(){return[this.paddedRect.x+this.paddedRect.w-po,this.paddedRect.y+this.paddedRect.h-po]}get displaySize(){return[(this.paddedRect.w-2*po)/this.pixelRatio,(this.paddedRect.h-2*po)/this.pixelRatio]}}class gv{constructor(e,i){const n={},c={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,n,f),this.addImages(i,c,f);const{w:g,h:b}=ux(f),A=new Gn({width:g||1,height:b||1});for(const k in e){const O=e[k],U=n[k].paddedRect;Gn.copy(O.data,A,{x:0,y:0},{x:U.x+po,y:U.y+po},O.data)}for(const k in i){const O=i[k],U=c[k].paddedRect,V=U.x+po,H=U.y+po,Z=O.data.width,ee=O.data.height;Gn.copy(O.data,A,{x:0,y:0},{x:V,y:H},O.data),Gn.copy(O.data,A,{x:0,y:ee-1},{x:V,y:H-1},{width:Z,height:1}),Gn.copy(O.data,A,{x:0,y:0},{x:V,y:H+ee},{width:Z,height:1}),Gn.copy(O.data,A,{x:Z-1,y:0},{x:V-1,y:H},{width:1,height:ee}),Gn.copy(O.data,A,{x:0,y:0},{x:V+Z,y:H},{width:1,height:ee})}this.image=A,this.iconPositions=n,this.patternPositions=c}addImages(e,i,n){for(const c in e){const f=e[c],g={x:0,y:0,w:f.data.width+2*po,h:f.data.height+2*po};n.push(g),i[c]=new dx(g,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(n=>e.hasImage(n)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),i),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),i)}patchUpdatedImage(e,i,n){if(!e||!i||e.version===i.version)return;e.version=i.version;const[c,f]=e.tl;n.update(i.data,void 0,{x:c,y:f})}}ni(dx,"ImagePosition"),ni(gv,"ImageAtlas");const ha={horizontal:1,vertical:2,horizontalOnly:3},_v=-17;class mm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const n=new mm;return n.scale=e||1,n.fontStack=i,n}static forImage(e){const i=new mm;return i.imageName=e,i}}class Hp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const n=new Hp;for(let c=0;c<e.sections.length;c++){const f=e.sections[c];f.image?n.addImageSection(f):n.addTextSection(f,i)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,n){let c="";for(let f=0;f<i.length;f++){const g=i.charCodeAt(f+1)||null,b=i.charCodeAt(f-1)||null;c+=!n&&(g&&Za(g)&&!Zi[i[f+1]]||b&&Za(b)&&!Zi[i[f-1]])||!Zi[i[f]]?i[f]:Zi[i[f]]}return c}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&r_[this.text.charCodeAt(n)];n++)e++;let i=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&r_[this.text.charCodeAt(n)];n--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const n=new Hp;return n.text=this.text.substring(e,i),n.sectionIndex=this.sectionIndex.slice(e,i),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(mm.forText(e.scale,e.fontStack||i));const n=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(n)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void Tt("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(mm.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Tt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function px(t,e,i,n,c,f,g,b,A,k,O,U,V,H,Z){const ee=Hp.fromFeature(t,c);U===ha.vertical&&ee.verticalizePunctuation(V);let ce=[];const _e=function(ke,nt,tt,mt,zt,at){if(!ke)return[];const bt=[],wt=function(Xt,ui,Jt,Ni,Ut,bi){let Ui=0;for(let _r=0;_r<Xt.length();_r++){const ji=Xt.getSection(_r);Ui+=yv(Xt.getCharCode(_r),ji,Ni,Ut,ui,bi)}return Ui/Math.max(1,Math.ceil(Ui/Jt))}(ke,nt,tt,mt,zt,at),Ct=ke.text.indexOf("")>=0;let Nt=0;for(let Xt=0;Xt<ke.length();Xt++){const ui=ke.getSection(Xt),Jt=ke.getCharCode(Xt);if(r_[Jt]||(Nt+=yv(Jt,ui,mt,zt,nt,at)),Xt<ke.length()-1){const Ni=!((dt=Jt)<11904||!(Zt["Bopomofo Extended"](dt)||Zt.Bopomofo(dt)||Zt["CJK Compatibility Forms"](dt)||Zt["CJK Compatibility Ideographs"](dt)||Zt["CJK Compatibility"](dt)||Zt["CJK Radicals Supplement"](dt)||Zt["CJK Strokes"](dt)||Zt["CJK Symbols and Punctuation"](dt)||Zt["CJK Unified Ideographs Extension A"](dt)||Zt["CJK Unified Ideographs"](dt)||Zt["Enclosed CJK Letters and Months"](dt)||Zt["Halfwidth and Fullwidth Forms"](dt)||Zt.Hiragana(dt)||Zt["Ideographic Description Characters"](dt)||Zt["Kangxi Radicals"](dt)||Zt["Katakana Phonetic Extensions"](dt)||Zt.Katakana(dt)||Zt["Vertical Forms"](dt)||Zt["Yi Radicals"](dt)||Zt["Yi Syllables"](dt)));(jE[Jt]||Ni||ui.imageName)&&bt.push(vv(Xt+1,Nt,wt,bt,VE(Jt,ke.getCharCode(Xt+1),Ni&&Ct),!1))}}var dt;return bv(vv(ke.length(),Nt,wt,bt,0,!0))}(ee,k,f,e,n,H),{processBidirectionalText:Me,processStyledBidirectionalText:ye}=I;if(Me&&ee.sections.length===1){const ke=Me(ee.toString(),_e);for(const nt of ke){const tt=new Hp;tt.text=nt,tt.sections=ee.sections;for(let mt=0;mt<nt.length;mt++)tt.sectionIndex.push(0);ce.push(tt)}}else if(ye){const ke=ye(ee.text,ee.sectionIndex,_e);for(const nt of ke){const tt=new Hp;tt.text=nt[0],tt.sectionIndex=nt[1],tt.sections=ee.sections,ce.push(tt)}}else ce=function(ke,nt){const tt=[],mt=ke.text;let zt=0;for(const at of nt)tt.push(ke.substring(zt,at)),zt=at;return zt<mt.length&&tt.push(ke.substring(zt,mt.length)),tt}(ee,_e);const Se=[],Le={positionedLines:Se,text:ee.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:U,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ke,nt,tt,mt,zt,at,bt,wt,Ct,Nt,dt,Xt){let ui=0,Jt=0,Ni=0;const Ut=wt==="right"?1:wt==="left"?0:.5;let bi=!1;for(const $i of zt){const Wi=$i.getSections();for(const Rr of Wi){if(Rr.imageName)continue;const jr=nt[Rr.fontStack];if(jr&&(bi=jr.ascender!==void 0&&jr.descender!==void 0,!bi))break}if(!bi)break}let Ui=0;for(const $i of zt){$i.trim();const Wi=$i.getMaxScale(),Rr=(Wi-1)*At,jr={positionedGlyphs:[],lineOffset:0};ke.positionedLines[Ui]=jr;const Vr=jr.positionedGlyphs;let zr=0;if(!$i.length()){Jt+=at,++Ui;continue}let os=0,vs=0;for(let Or=0;Or<$i.length();Or++){const $s=$i.getSection(Or),Ls=$i.getSectionIndex(Or),ps=$i.getCharCode(Or);let vr=$s.scale,Ds=null,Gr=null,Wn=null,Rs=At,fn=0;const nn=!(Ct===ha.horizontal||!dt&&!qu(ps)||dt&&(r_[ps]||(_r=ps,Zt.Arabic(_r)||Zt["Arabic Supplement"](_r)||Zt["Arabic Extended-A"](_r)||Zt["Arabic Presentation Forms-A"](_r)||Zt["Arabic Presentation Forms-B"](_r))));if($s.imageName){const Hn=mt[$s.imageName];if(!Hn)continue;Wn=$s.imageName,ke.iconsInText=ke.iconsInText||!0,Gr=Hn.paddedRect;const on=Hn.displaySize;vr=vr*At/Xt,Ds={width:on[0],height:on[1],left:po,top:-3,advance:nn?on[1]:on[0],localGlyph:!1},fn=bi?-Ds.height*vr:_v+Wi*At-on[1]*vr,Rs=Ds.advance;const nl=(nn?on[0]:on[1])*vr-At*Wi;nl>0&&nl>zr&&(zr=nl)}else{const Hn=tt[$s.fontStack];if(!Hn)continue;Hn[ps]&&(Gr=Hn[ps]);const on=nt[$s.fontStack];if(!on)continue;const nl=on.glyphs[ps];if(!nl)continue;if(Ds=nl.metrics,Rs=ps!==8203?At:0,bi){const Jp=on.ascender!==void 0?Math.abs(on.ascender):0,Sm=on.descender!==void 0?Math.abs(on.descender):0,Am=(Jp+Sm)*vr;os<Am&&(os=Am,vs=(Jp-Sm)/2*vr),fn=-Jp*vr}else fn=_v+(Wi-vr)*At}nn?(ke.verticalizable=!0,Vr.push({glyph:ps,imageName:Wn,x:ui,y:Jt+fn,vertical:nn,scale:vr,localGlyph:Ds.localGlyph,fontStack:$s.fontStack,sectionIndex:Ls,metrics:Ds,rect:Gr}),ui+=Rs*vr+Nt):(Vr.push({glyph:ps,imageName:Wn,x:ui,y:Jt+fn,vertical:nn,scale:vr,localGlyph:Ds.localGlyph,fontStack:$s.fontStack,sectionIndex:Ls,metrics:Ds,rect:Gr}),ui+=Ds.advance*vr+Nt)}Vr.length!==0&&(Ni=Math.max(ui-Nt,Ni),bi?wv(Vr,Ut,zr,vs,at*Wi/2):wv(Vr,Ut,zr,0,at/2)),ui=0;const Is=at*Wi+zr;jr.lineOffset=Math.max(zr,Rr),Jt+=Is,++Ui}var _r;const ji=Jt,{horizontalAlign:Ai,verticalAlign:qr}=fx(bt);(function($i,Wi,Rr,jr,Vr,zr){const os=(Wi-Rr)*Vr,vs=-zr*jr;for(const Is of $i)for(const Or of Is.positionedGlyphs)Or.x+=os,Or.y+=vs})(ke.positionedLines,Ut,Ai,qr,Ni,ji),ke.top+=-qr*ji,ke.bottom=ke.top+ji,ke.left+=-Ai*Ni,ke.right=ke.left+Ni,ke.hasBaseline=bi}(Le,e,i,n,ce,g,b,A,U,k,V,Z),!function(ke){for(const nt of ke)if(nt.positionedGlyphs.length!==0)return!1;return!0}(Se)&&Le}const r_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},jE={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function yv(t,e,i,n,c,f){if(e.imageName){const g=n[e.imageName];return g?g.displaySize[0]*e.scale*At/f+c:0}{const g=i[e.fontStack],b=g&&g.glyphs[t];return b?b.metrics.advance*e.scale+c:0}}function xv(t,e,i,n){const c=Math.pow(t-e,2);return n?t<e?c/2:2*c:c+Math.abs(i)*i}function VE(t,e,i){let n=0;return t===10&&(n-=1e4),i&&(n+=150),t!==40&&t!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function vv(t,e,i,n,c,f){let g=null,b=xv(e,i,c,f);for(const A of n){const k=xv(e-A.x,i,c,f)+A.badness;k<=b&&(g=A,b=k)}return{index:t,x:e,priorBreak:g,badness:b}}function bv(t){return t?bv(t.priorBreak).concat(t.index):[]}function fx(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function wv(t,e,i,n,c){if(!(e||i||n||c))return;const f=t.length-1,g=t[f],b=(g.x+g.metrics.advance*g.scale)*e;for(let A=0;A<=f;A++)t[A].x-=b,t[A].y+=i+n+c}function GE(t,e,i){const{horizontalAlign:n,verticalAlign:c}=fx(i),f=e[0]-t.displaySize[0]*n,g=e[1]-t.displaySize[1]*c;return{image:t,top:g,bottom:g+t.displaySize[1],left:f,right:f+t.displaySize[0]}}function Tv(t,e,i,n,c,f){const g=t.image;let b;if(g.content){const ce=g.content,_e=g.pixelRatio||1;b=[ce[0]/_e,ce[1]/_e,g.displaySize[0]-ce[2]/_e,g.displaySize[1]-ce[3]/_e]}const A=e.left*f,k=e.right*f;let O,U,V,H;i==="width"||i==="both"?(H=c[0]+A-n[3],U=c[0]+k+n[1]):(H=c[0]+(A+k-g.displaySize[0])/2,U=H+g.displaySize[0]);const Z=e.top*f,ee=e.bottom*f;return i==="height"||i==="both"?(O=c[1]+Z-n[0],V=c[1]+ee+n[2]):(O=c[1]+(Z+ee-g.displaySize[1])/2,V=O+g.displaySize[1]),{image:g,top:O,right:U,bottom:V,left:H,collisionPadding:b}}class Gc extends Ge{constructor(e,i,n,c,f){super(e,i),this.angle=c,this.z=n,f!==void 0&&(this.segment=f)}clone(){return new Gc(this.x,this.y,this.z,this.angle,this.segment)}}function Ev(t,e,i,n,c){if(e.segment===void 0)return!0;let f=e,g=e.segment+1,b=0;for(;b>-i/2;){if(g--,g<0)return!1;b-=t[g].dist(f),f=t[g]}b+=t[g].dist(t[g+1]),g++;const A=[];let k=0;for(;b<i/2;){const O=t[g],U=t[g+1];if(!U)return!1;let V=t[g-1].angleTo(O)-O.angleTo(U);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:b,angleDelta:V}),k+=V;b-A[0].distance>n;)k-=A.shift().angleDelta;if(k>c)return!1;g++,b+=O.dist(U)}return!0}function Sv(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Av(t,e,i){return t?.6*e*i:0}function Mv(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function $E(t,e,i,n,c,f){const g=Av(i,c,f),b=Mv(i,n)*f;let A=0;const k=Sv(t)/2;for(let O=0;O<t.length-1;O++){const U=t[O],V=t[O+1],H=U.dist(V);if(A+H>k){const Z=(k-A)/H,ee=nr(U.x,V.x,Z),ce=nr(U.y,V.y,Z),_e=new Gc(ee,ce,0,V.angleTo(U),O);return!g||Ev(t,_e,b,g,e)?_e:void 0}A+=H}}function WE(t,e,i,n,c,f,g,b,A){const k=Av(n,f,g),O=Mv(n,c),U=O*g,V=t[0].x===0||t[0].x===A||t[0].y===0||t[0].y===A;return e-U<e/4&&(e=U+e/4),Cv(t,V?e/2*b%e:(O/2+2*f)*g*b%e,e,k,i,U,V,!1,A)}function Cv(t,e,i,n,c,f,g,b,A){const k=f/2,O=Sv(t);let U=0,V=e-i,H=[];for(let Z=0;Z<t.length-1;Z++){const ee=t[Z],ce=t[Z+1],_e=ee.dist(ce),Me=ce.angleTo(ee);for(;V+i<U+_e;){V+=i;const ye=(V-U)/_e,Se=nr(ee.x,ce.x,ye),Le=nr(ee.y,ce.y,ye);if(Se>=0&&Se<A&&Le>=0&&Le<A&&V-k>=0&&V+k<=O){const ke=new Gc(Se,Le,0,Me,Z);ke._round(),n&&!Ev(t,ke,f,n,c)||H.push(ke)}}U+=_e}return b||H.length||g||(H=Cv(t,U/2,i,n,c,f,g,!0,A)),H}function kv(t,e,i,n,c){const f=[];for(let g=0;g<t.length;g++){const b=t[g];let A;for(let k=0;k<b.length-1;k++){let O=b[k],U=b[k+1];O.x<e&&U.x<e||(O.x<e?O=new Ge(e,O.y+(e-O.x)/(U.x-O.x)*(U.y-O.y))._round():U.x<e&&(U=new Ge(e,O.y+(e-O.x)/(U.x-O.x)*(U.y-O.y))._round()),O.y<i&&U.y<i||(O.y<i?O=new Ge(O.x+(i-O.y)/(U.y-O.y)*(U.x-O.x),i)._round():U.y<i&&(U=new Ge(O.x+(i-O.y)/(U.y-O.y)*(U.x-O.x),i)._round()),O.x>=n&&U.x>=n||(O.x>=n?O=new Ge(n,O.y+(n-O.x)/(U.x-O.x)*(U.y-O.y))._round():U.x>=n&&(U=new Ge(n,O.y+(n-O.x)/(U.x-O.x)*(U.y-O.y))._round()),O.y>=c&&U.y>=c||(O.y>=c?O=new Ge(O.x+(c-O.y)/(U.y-O.y)*(U.x-O.x),c)._round():U.y>=c&&(U=new Ge(O.x+(c-O.y)/(U.y-O.y)*(U.x-O.x),c)._round()),A&&O.equals(A[A.length-1])||(A=[O],f.push(A)),A.push(U)))))}}return f}ni(Gc,"Anchor");const s_=1e20;function Pv(t,e,i,n,c,f,g,b,A){for(let k=e;k<e+n;k++)Iv(t,i*f+k,f,c,g,b,A);for(let k=i;k<i+c;k++)Iv(t,k*f+e,1,n,g,b,A)}function Iv(t,e,i,n,c,f,g){f[0]=0,g[0]=-1e20,g[1]=s_,c[0]=t[e];for(let b=1,A=0,k=0;b<n;b++){c[b]=t[e+b*i];const O=b*b;do{const U=f[A];k=(c[b]-c[U]+O-U*U)/(b-U)/2}while(k<=g[A]&&--A>-1);A++,f[A]=b,g[A]=k,g[A+1]=s_}for(let b=0,A=0;b<n;b++){for(;g[A+1]<b;)A++;const k=f[A],O=b-k;t[e+b*i]=c[k]+O*O}}const rl=2,mx={none:0,ideographs:1,all:2};class qp{constructor(e,i,n){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=n,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const n=[];for(const c in e)for(const f of e[c])n.push({stack:c,id:f});fr(n,({stack:c,id:f},g)=>{let b=this.entries[c];b||(b=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let A=b.glyphs[f];if(A!==void 0)return void g(null,{stack:c,id:f,glyph:A});if(A=this._tinySDF(b,c,f),A)return b.glyphs[f]=A,void g(null,{stack:c,id:f,glyph:A});const k=Math.floor(f/256);if(256*k>65535)return void g(new Error("glyphs > 65535 not supported"));if(b.ranges[k])return void g(null,{stack:c,id:f,glyph:A});let O=b.requests[k];O||(O=b.requests[k]=[],qp.loadGlyphRange(c,k,this.url,this.requestManager,(U,V)=>{if(V){b.ascender=V.ascender,b.descender=V.descender;for(const H in V.glyphs)this._doesCharSupportLocalGlyph(+H)||(b.glyphs[+H]=V.glyphs[+H]);b.ranges[k]=!0}for(const H of O)H(U,V);delete b.requests[k]})),O.push((U,V)=>{U?g(U):V&&g(null,{stack:c,id:f,glyph:V.glyphs[f]||null})})},(c,f)=>{if(c)i(c);else if(f){const g={};for(const{stack:b,id:A,glyph:k}of f)g[b]===void 0&&(g[b]={}),g[b].glyphs===void 0&&(g[b].glyphs={}),g[b].glyphs[A]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics},g[b].ascender=this.entries[b].ascender,g[b].descender=this.entries[b].descender;i(null,g)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==mx.none&&(this.localGlyphMode===mx.all?!!this.localFontFamily:!!this.localFontFamily&&(Zt["CJK Unified Ideographs"](e)||Zt["Hangul Syllables"](e)||Zt.Hiragana(e)||Zt.Katakana(e)||Zt["CJK Symbols and Punctuation"](e)))}_tinySDF(e,i,n){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(n))return;let f=e.tinySDF;if(!f){let ee="400";/bold/i.test(i)?ee="900":/medium/i.test(i)?ee="500":/light/i.test(i)&&(ee="200"),f=e.tinySDF=new qp.TinySDF({fontFamily:c,fontWeight:ee,fontSize:24*rl,buffer:3*rl,radius:8*rl}),f.fontWeight=ee}if(this.localGlyphs[f.fontWeight][n])return this.localGlyphs[f.fontWeight][n];const g=String.fromCharCode(n),{data:b,width:A,height:k,glyphWidth:O,glyphHeight:U,glyphLeft:V,glyphTop:H,glyphAdvance:Z}=f.draw(g);return this.localGlyphs[f.fontWeight][n]={id:n,bitmap:new il({width:A,height:k},b),metrics:{width:O/rl,height:U/rl,left:V/rl,top:H/rl-27,advance:Z/rl,localGlyph:!0}}}}qp.loadGlyphRange=function(t,e,i,n,c){const f=256*e,g=f+255,b=n.transformRequest(n.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${f}-${g}`),hn.Glyphs);Ws(b,(A,k)=>{if(A)c(A);else if(k){const O={},U=function(V){return new i_(V).readFields(BE,{})}(k);for(const V of U.glyphs)O[V.id]=V;c(null,{glyphs:O,ascender:U.ascender,descender:U.descender})}})},qp.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:n=.25,fontFamily:c="sans-serif",fontWeight:f="normal",fontStyle:g="normal"}={}){this.buffer=e,this.cutoff=n,this.radius=i;const b=this.size=t+4*e,A=this._createCanvas(b),k=this.ctx=A.getContext("2d",{willReadFrequently:!0});k.font=`${g} ${f} ${t}px ${c}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:c,actualBoundingBoxRight:f}=this.ctx.measureText(t),g=Math.ceil(i),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-c))),A=Math.min(this.size-this.buffer,g+Math.ceil(n)),k=b+2*this.buffer,O=A+2*this.buffer,U=Math.max(k*O,0),V=new Uint8ClampedArray(U),H={data:V,width:k,height:O,glyphWidth:b,glyphHeight:A,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(b===0||A===0)return H;const{ctx:Z,buffer:ee,gridInner:ce,gridOuter:_e}=this;Z.clearRect(ee,ee,b,A),Z.fillText(t,ee,ee+g);const Me=Z.getImageData(ee,ee,b,A);_e.fill(s_,0,U),ce.fill(0,0,U);for(let ye=0;ye<A;ye++)for(let Se=0;Se<b;Se++){const Le=Me.data[4*(ye*b+Se)+3]/255;if(Le===0)continue;const ke=(ye+ee)*k+Se+ee;if(Le===1)_e[ke]=0,ce[ke]=s_;else{const nt=.5-Le;_e[ke]=nt>0?nt*nt:0,ce[ke]=nt<0?nt*nt:0}}Pv(_e,0,0,k,O,k,this.f,this.v,this.z),Pv(ce,ee,ee,b,A,k,this.f,this.v,this.z);for(let ye=0;ye<U;ye++){const Se=Math.sqrt(_e[ye])-Math.sqrt(ce[ye]);V[ye]=Math.round(255-255*(Se/this.radius+this.cutoff))}return H}};const gm=po;function Lv(t,e,i,n){const c=[],f=t.image,g=f.pixelRatio,b=f.paddedRect.w-2*gm,A=f.paddedRect.h-2*gm,k=t.right-t.left,O=t.bottom-t.top,U=f.stretchX||[[0,b]],V=f.stretchY||[[0,A]],H=(at,bt)=>at+bt[1]-bt[0],Z=U.reduce(H,0),ee=V.reduce(H,0),ce=b-Z,_e=A-ee;let Me=0,ye=Z,Se=0,Le=ee,ke=0,nt=ce,tt=0,mt=_e;if(f.content&&n){const at=f.content;Me=n_(U,0,at[0]),Se=n_(V,0,at[1]),ye=n_(U,at[0],at[2]),Le=n_(V,at[1],at[3]),ke=at[0]-Me,tt=at[1]-Se,nt=at[2]-at[0]-ye,mt=at[3]-at[1]-Le}const zt=(at,bt,wt,Ct)=>{const Nt=o_(at.stretch-Me,ye,k,t.left),dt=a_(at.fixed-ke,nt,at.stretch,Z),Xt=o_(bt.stretch-Se,Le,O,t.top),ui=a_(bt.fixed-tt,mt,bt.stretch,ee),Jt=o_(wt.stretch-Me,ye,k,t.left),Ni=a_(wt.fixed-ke,nt,wt.stretch,Z),Ut=o_(Ct.stretch-Se,Le,O,t.top),bi=a_(Ct.fixed-tt,mt,Ct.stretch,ee),Ui=new Ge(Nt,Xt),_r=new Ge(Jt,Xt),ji=new Ge(Jt,Ut),Ai=new Ge(Nt,Ut),qr=new Ge(dt/g,ui/g),$i=new Ge(Ni/g,bi/g),Wi=e*Math.PI/180;if(Wi){const Vr=Math.sin(Wi),zr=Math.cos(Wi),os=[zr,-Vr,Vr,zr];Ui._matMult(os),_r._matMult(os),Ai._matMult(os),ji._matMult(os)}const Rr=at.stretch+at.fixed,jr=bt.stretch+bt.fixed;return{tl:Ui,tr:_r,bl:Ai,br:ji,tex:{x:f.paddedRect.x+gm+Rr,y:f.paddedRect.y+gm+jr,w:wt.stretch+wt.fixed-Rr,h:Ct.stretch+Ct.fixed-jr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:qr,pixelOffsetBR:$i,minFontScaleX:nt/g/k,minFontScaleY:mt/g/O,isSDF:i}};if(n&&(f.stretchX||f.stretchY)){const at=Dv(U,ce,Z),bt=Dv(V,_e,ee);for(let wt=0;wt<at.length-1;wt++){const Ct=at[wt],Nt=at[wt+1];for(let dt=0;dt<bt.length-1;dt++)c.push(zt(Ct,bt[dt],Nt,bt[dt+1]))}}else c.push(zt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:A+1}));return c}function n_(t,e,i){let n=0;for(const c of t)n+=Math.max(e,Math.min(i,c[1]))-Math.max(e,Math.min(i,c[0]));return n}function Dv(t,e,i){const n=[{fixed:-1,stretch:0}];for(const[c,f]of t){const g=n[n.length-1];n.push({fixed:c-g.stretch,stretch:g.stretch}),n.push({fixed:c-g.stretch,stretch:g.stretch+(f-c)})}return n.push({fixed:e+gm,stretch:i}),n}function o_(t,e,i,n){return t/e*i+n}function a_(t,e,i,n){return t-e*i/n}function HE(t,e,i,n){const c=e+t.positionedLines[n].lineOffset;return n===0?i+c/2:i+(c+(e+t.positionedLines[n-1].lineOffset))/2}class qE{constructor(e=[],i=XE){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:n}=this,c=i[e];for(;e>0;){const f=e-1>>1,g=i[f];if(n(c,g)>=0)break;i[e]=g,e=f}i[e]=c}_down(e){const{data:i,compare:n}=this,c=this.length>>1,f=i[e];for(;e<c;){let g=1+(e<<1),b=i[g];const A=g+1;if(A<this.length&&n(i[A],b)<0&&(g=A,b=i[A]),n(b,f)>=0)break;i[e]=b,e=g}i[e]=f}}function XE(t,e){return t<e?-1:t>e?1:0}function ZE(t,e=1,i=!1){let n=1/0,c=1/0,f=-1/0,g=-1/0;const b=t[0];for(let H=0;H<b.length;H++){const Z=b[H];(!H||Z.x<n)&&(n=Z.x),(!H||Z.y<c)&&(c=Z.y),(!H||Z.x>f)&&(f=Z.x),(!H||Z.y>g)&&(g=Z.y)}const A=Math.min(f-n,g-c);let k=A/2;const O=new qE([],YE);if(A===0)return new Ge(n,c);for(let H=n;H<f;H+=A)for(let Z=c;Z<g;Z+=A)O.push(new Xp(H+k,Z+k,k,t));let U=function(H){let Z=0,ee=0,ce=0;const _e=H[0];for(let Me=0,ye=_e.length,Se=ye-1;Me<ye;Se=Me++){const Le=_e[Me],ke=_e[Se],nt=Le.x*ke.y-ke.x*Le.y;ee+=(Le.x+ke.x)*nt,ce+=(Le.y+ke.y)*nt,Z+=3*nt}return new Xp(ee/Z,ce/Z,0,H)}(t),V=O.length;for(;O.length;){const H=O.pop();(H.d>U.d||!U.d)&&(U=H,i&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,V)),H.max-U.d<=e||(k=H.h/2,O.push(new Xp(H.p.x-k,H.p.y-k,k,t)),O.push(new Xp(H.p.x+k,H.p.y-k,k,t)),O.push(new Xp(H.p.x-k,H.p.y+k,k,t)),O.push(new Xp(H.p.x+k,H.p.y+k,k,t)),V+=4)}return i&&(console.log(`num probes: ${V}`),console.log(`best distance: ${U.d}`)),U.p}function YE(t,e){return e.max-t.max}class Xp{constructor(e,i,n,c){this.p=new Ge(e,i),this.h=n,this.d=function(f,g){let b=!1,A=1/0;for(let k=0;k<g.length;k++){const O=g[k];for(let U=0,V=O.length,H=V-1;U<V;H=U++){const Z=O[U],ee=O[H];Z.y>f.y!=ee.y>f.y&&f.x<(ee.x-Z.x)*(f.y-Z.y)/(ee.y-Z.y)+Z.x&&(b=!b),A=Math.min(A,Uh(f,Z,ee))}}return(b?1:-1)*Math.sqrt(A)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}const Zp=7,gx=Number.POSITIVE_INFINITY,KE=Math.sqrt(2);function Rv(t,[e,i]){let n=0,c=0;if(i===gx){e<0&&(e=0);const f=e/KE;switch(t){case"top-right":case"top-left":c=f-Zp;break;case"bottom-right":case"bottom-left":c=-f+Zp;break;case"bottom":c=-e+Zp;break;case"top":c=e-Zp}switch(t){case"top-right":case"bottom-right":n=-f;break;case"top-left":case"bottom-left":n=f;break;case"left":n=e;break;case"right":n=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":c=i-Zp;break;case"bottom-right":case"bottom-left":case"bottom":c=-i+Zp}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}}return[n,c]}function JE(t,e,i,n,c,f,g,b,A,k){t.createArrays(),t.tilePixelRatio=pi/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const O=t.layers[0].layout,U=t.layers[0]._unevaluatedLayout._values,V={};if(t.textSizeData.kind==="composite"){const{minZoom:ee,maxZoom:ce}=t.textSizeData;V.compositeTextSizes=[U["text-size"].possiblyEvaluate(new F(ee),b),U["text-size"].possiblyEvaluate(new F(ce),b)]}if(t.iconSizeData.kind==="composite"){const{minZoom:ee,maxZoom:ce}=t.iconSizeData;V.compositeIconSizes=[U["icon-size"].possiblyEvaluate(new F(ee),b),U["icon-size"].possiblyEvaluate(new F(ce),b)]}V.layoutTextSize=U["text-size"].possiblyEvaluate(new F(A+1),b),V.layoutIconSize=U["icon-size"].possiblyEvaluate(new F(A+1),b),V.textMaxSize=U["text-size"].possiblyEvaluate(new F(18),b);const H=O.get("text-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",Z=O.get("text-size");for(const ee of t.features){const ce=O.get("text-font").evaluate(ee,{},b).join(","),_e=Z.evaluate(ee,{},b),Me=V.layoutTextSize.evaluate(ee,{},b),ye=(V.layoutIconSize.evaluate(ee,{},b),{horizontal:{},vertical:void 0}),Se=ee.text;let Le,ke=[0,0];if(Se){const mt=Se.toString(),zt=O.get("text-letter-spacing").evaluate(ee,{},b)*At,at=O.get("text-line-height").evaluate(ee,{},b)*At,bt=Ff(mt)?zt:0,wt=O.get("text-anchor").evaluate(ee,{},b),Ct=O.get("text-variable-anchor");if(!Ct){const Jt=O.get("text-radial-offset").evaluate(ee,{},b);ke=Jt?Rv(wt,[Jt*At,gx]):O.get("text-offset").evaluate(ee,{},b).map(Ni=>Ni*At)}let Nt=H?"center":O.get("text-justify").evaluate(ee,{},b);const dt=O.get("symbol-placement")==="point",Xt=dt?O.get("text-max-width").evaluate(ee,{},b)*At:1/0,ui=Jt=>{t.allowVerticalPlacement&&Hu(mt)&&(ye.vertical=px(Se,e,i,c,ce,Xt,at,wt,Jt,bt,ke,ha.vertical,!0,Me,_e))};if(!H&&Ct){const Jt=Nt==="auto"?Ct.map(Ut=>_x(Ut)):[Nt];let Ni=!1;for(let Ut=0;Ut<Jt.length;Ut++){const bi=Jt[Ut];if(!ye.horizontal[bi])if(Ni)ye.horizontal[bi]=ye.horizontal[0];else{const Ui=px(Se,e,i,c,ce,Xt,at,"center",bi,bt,ke,ha.horizontal,!1,Me,_e);Ui&&(ye.horizontal[bi]=Ui,Ni=Ui.positionedLines.length===1)}}ui("left")}else{if(Nt==="auto"&&(Nt=_x(wt)),dt||O.get("text-writing-mode").indexOf("horizontal")>=0||!Hu(mt)){const Jt=px(Se,e,i,c,ce,Xt,at,wt,Nt,bt,ke,ha.horizontal,!1,Me,_e);Jt&&(ye.horizontal[Nt]=Jt)}ui(dt?"left":Nt)}}let nt=!1;if(ee.icon&&ee.icon.name){const mt=n[ee.icon.name];mt&&(Le=GE(c[ee.icon.name],O.get("icon-offset").evaluate(ee,{},b),O.get("icon-anchor").evaluate(ee,{},b)),nt=mt.sdf,t.sdfIcons===void 0?t.sdfIcons=mt.sdf:t.sdfIcons!==mt.sdf&&Tt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(mt.pixelRatio!==t.pixelRatio||O.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const tt=Ov(ye.horizontal)||ye.vertical;t.iconsInText||(t.iconsInText=!!tt&&tt.iconsInText),(tt||Le)&&QE(t,ee,ye,Le,n,V,Me,0,ke,nt,g,b,k)}f&&t.generateCollisionDebugBuffers(A,t.collisionBoxArray)}function _x(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function QE(t,e,i,n,c,f,g,b,A,k,O,U,V){let H=f.textMaxSize.evaluate(e,{},U);H===void 0&&(H=g);const Z=t.layers[0].layout,ee=Z.get("icon-offset").evaluate(e,{},U),ce=Ov(i.horizontal)||i.vertical,_e=V.name==="globe",Me=At,ye=g/Me,Se=t.tilePixelRatio*H/Me,Le=(wt=t.overscaling,t.zoom>18&&wt>2&&(wt>>=1),Math.max(pi/(512*wt),1)*Z.get("symbol-spacing")),ke=Z.get("text-padding")*t.tilePixelRatio,nt=Z.get("icon-padding")*t.tilePixelRatio,tt=jt(Z.get("text-max-angle")),mt=Z.get("text-rotation-alignment")==="map"&&Z.get("symbol-placement")!=="point",zt=Z.get("icon-rotation-alignment")==="map"&&Z.get("symbol-placement")!=="point",at=Z.get("symbol-placement"),bt=Le/2;var wt;const Ct=Z.get("icon-text-fit");let Nt;n&&Ct!=="none"&&(t.allowVerticalPlacement&&i.vertical&&(Nt=Tv(n,i.vertical,Ct,Z.get("icon-text-fit-padding"),ee,ye)),ce&&(n=Tv(n,ce,Ct,Z.get("icon-text-fit-padding"),ee,ye)));const dt=(Xt,ui,Jt)=>{if(ui.x<0||ui.x>=pi||ui.y<0||ui.y>=pi)return;let Ni=null;if(_e){const{x:Ut,y:bi,z:Ui}=V.projectTilePoint(ui.x,ui.y,Jt);Ni={anchor:new Gc(Ut,bi,Ui,0,void 0),up:V.upVector(Jt,ui.x,ui.y)}}(function(Ut,bi,Ui,_r,ji,Ai,qr,$i,Wi,Rr,jr,Vr,zr,os,vs,Is,Or,$s,Ls,ps,vr,Ds,Gr,Wn,Rs){const fn=Ut.addToLineVertexArray(bi,_r);let nn,Hn,on,nl,Jp,Sm,Am,mb=0,gb=0,_b=0,yb=0,Lx=-1,Dx=-1;const Jl={};let xb=jf("");const Dd=Ui?Ui.anchor:bi;let Rx=0,zx=0;if(Wi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Rx,zx]=Wi.layout.get("text-offset").evaluate(vr,{},Rs).map(Oo=>Oo*At):(Rx=Wi.layout.get("text-radial-offset").evaluate(vr,{},Rs)*At,zx=gx),Ut.allowVerticalPlacement&&ji.vertical){const Oo=ji.vertical;if(vs)Sm=yx(Oo),$i&&(Am=yx($i));else{const Bo=Wi.layout.get("text-rotate").evaluate(vr,{},Rs)+90;on=l_(Rr,Dd,bi,jr,Vr,zr,Oo,os,Bo,Is),$i&&(nl=l_(Rr,Dd,bi,jr,Vr,zr,$i,$s,Bo))}}if(Ai){const Oo=Wi.layout.get("icon-rotate").evaluate(vr,{},Rs),Bo=Wi.layout.get("icon-text-fit")!=="none",Mm=Lv(Ai,Oo,Gr,Bo),Bx=$i?Lv($i,Oo,Gr,Bo):void 0;Hn=l_(Rr,Dd,bi,jr,Vr,zr,Ai,$s,Oo),mb=4*Mm.length;const vb=Ut.iconSizeData;let Rd=null;vb.kind==="source"?(Rd=[Kt*Wi.layout.get("icon-size").evaluate(vr,{},Rs)],Rd[0]>qh&&Tt(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${_m}. Reduce your "icon-size".`)):vb.kind==="composite"&&(Rd=[Kt*Ds.compositeIconSizes[0].evaluate(vr,{},Rs),Kt*Ds.compositeIconSizes[1].evaluate(vr,{},Rs)],(Rd[0]>qh||Rd[1]>qh)&&Tt(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${_m}. Reduce your "icon-size".`)),Ut.addSymbols(Ut.icon,Mm,Rd,ps,Ls,vr,!1,Ui,bi,fn.lineStartIndex,fn.lineLength,-1,Wn,Rs),Lx=Ut.icon.placedSymbolArray.length-1,Bx&&(gb=4*Bx.length,Ut.addSymbols(Ut.icon,Bx,Rd,ps,Ls,vr,ha.vertical,Ui,bi,fn.lineStartIndex,fn.lineLength,-1,Wn,Rs),Dx=Ut.icon.placedSymbolArray.length-1)}for(const Oo in ji.horizontal){const Bo=ji.horizontal[Oo];nn||(xb=jf(Bo.text),vs?Jp=yx(Bo):nn=l_(Rr,Dd,bi,jr,Vr,zr,Bo,os,Wi.layout.get("text-rotate").evaluate(vr,{},Rs),Is));const Mm=Bo.positionedLines.length===1;if(_b+=zv(Ut,Ui,bi,Bo,qr,Wi,vs,vr,Is,fn,ji.vertical?ha.horizontal:ha.horizontalOnly,Mm?Object.keys(ji.horizontal):[Oo],Jl,Lx,Ds,Wn,Rs),Mm)break}ji.vertical&&(yb+=zv(Ut,Ui,bi,ji.vertical,qr,Wi,vs,vr,Is,fn,ha.vertical,["vertical"],Jl,Dx,Ds,Wn,Rs));let Qh=-1;const Ox=(Oo,Bo)=>Oo?Math.max(Oo,Bo):Bo;Qh=Ox(Jp,Qh),Qh=Ox(Sm,Qh),Qh=Ox(Am,Qh);const MS=Qh>-1?1:0;Ut.glyphOffsetArray.length>=Zh.MAX_GLYPHS&&Tt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vr.sortKey!==void 0&&Ut.addToSortKeyRanges(Ut.symbolInstances.length,vr.sortKey),Ut.symbolInstances.emplaceBack(Dd.x,Dd.y,Dd.z,bi.x,bi.y,Jl.right>=0?Jl.right:-1,Jl.center>=0?Jl.center:-1,Jl.left>=0?Jl.left:-1,Jl.vertical>=0?Jl.vertical:-1,Lx,Dx,xb,nn!==void 0?nn:Ut.collisionBoxArray.length,nn!==void 0?nn+1:Ut.collisionBoxArray.length,on!==void 0?on:Ut.collisionBoxArray.length,on!==void 0?on+1:Ut.collisionBoxArray.length,Hn!==void 0?Hn:Ut.collisionBoxArray.length,Hn!==void 0?Hn+1:Ut.collisionBoxArray.length,nl||Ut.collisionBoxArray.length,nl?nl+1:Ut.collisionBoxArray.length,jr,_b,yb,mb,gb,MS,0,Rx,zx,Qh)})(t,ui,Ni,Xt,i,n,c,Nt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ke,mt,A,0,nt,zt,ee,e,f,k,O,U)};if(at==="line")for(const Xt of kv(e.geometry,0,0,pi,pi)){const ui=WE(Xt,Le,tt,i.vertical||ce,n,Me,Se,t.overscaling,pi);for(const Jt of ui)ce&&eS(t,ce.text,bt,Jt)||dt(Xt,Jt,U)}else if(at==="line-center"){for(const Xt of e.geometry)if(Xt.length>1){const ui=$E(Xt,tt,i.vertical||ce,n,Me,Se);ui&&dt(Xt,ui,U)}}else if(e.type==="Polygon")for(const Xt of Gp(e.geometry,0)){const ui=ZE(Xt,16);dt(Xt[0],new Gc(ui.x,ui.y,0,0,void 0),U)}else if(e.type==="LineString")for(const Xt of e.geometry)dt(Xt,new Gc(Xt[0].x,Xt[0].y,0,0,void 0),U);else if(e.type==="Point")for(const Xt of e.geometry)for(const ui of Xt)dt([ui],new Gc(ui.x,ui.y,0,0,void 0),U)}const _m=255,qh=_m*Kt;function zv(t,e,i,n,c,f,g,b,A,k,O,U,V,H,Z,ee,ce){const _e=function(Se,Le,ke,nt,tt,mt,zt,at){const bt=[];if(Le.positionedLines.length===0)return bt;const wt=nt.layout.get("text-rotate").evaluate(mt,{})*Math.PI/180,Ct=function(Jt){const Ni=Jt[0],Ut=Jt[1],bi=Ni*Ut;return bi>0?[Ni,-Ut]:bi<0?[-Ni,Ut]:Ni===0?[Ut,Ni]:[Ut,-Ni]}(ke);let Nt=Math.abs(Le.top-Le.bottom);for(const Jt of Le.positionedLines)Nt-=Jt.lineOffset;const dt=Le.positionedLines.length,Xt=Nt/dt;let ui=Le.top-ke[1];for(let Jt=0;Jt<dt;++Jt){const Ni=Le.positionedLines[Jt];ui=HE(Le,Xt,ui,Jt);for(const Ut of Ni.positionedGlyphs){if(!Ut.rect)continue;const bi=Ut.rect||{};let Ui=UE+1,_r=!0,ji=1,Ai=0;if(Ut.imageName){const Gr=zt[Ut.imageName];if(!Gr)continue;if(Gr.sdf){Tt("SDF images are not supported in formatted text and will be ignored.");continue}_r=!1,ji=Gr.pixelRatio,Ui=po/ji}const qr=(tt||at)&&Ut.vertical,$i=Ut.metrics.advance*Ut.scale/2,Wi=Ut.metrics,Rr=Ut.rect;if(Rr===null)continue;at&&Le.verticalizable&&(Ai=Ut.imageName?$i-Ut.metrics.width*Ut.scale/2:0);const jr=tt?[Ut.x+$i,Ut.y]:[0,0];let Vr=[0,0],zr=[0,0],os=!1;tt||(qr?(zr=[Ut.x+$i+Ct[0],Ut.y+Ct[1]-Ai],os=!0):Vr=[Ut.x+$i+ke[0],Ut.y+ke[1]-Ai]);const vs=Rr.w*Ut.scale/(ji*(Ut.localGlyph?rl:1)),Is=Rr.h*Ut.scale/(ji*(Ut.localGlyph?rl:1));let Or,$s,Ls,ps;if(qr){const Gr=Ut.y-ui,Wn=new Ge(-$i,$i-Gr),Rs=-Math.PI/2,fn=new Ge(...zr);Or=new Ge(-$i+Vr[0],Vr[1]),Or._rotateAround(Rs,Wn)._add(fn),Or.x+=-Gr+$i,Or.y-=(Wi.left-Ui)*Ut.scale;const nn=Ut.imageName?Wi.advance*Ut.scale:At*Ut.scale,Hn=String.fromCharCode(Ut.glyph);dr(Hn)?Or.x+=(1-Ui)*Ut.scale:pn(Hn)?Or.x+=nn-Wi.height*Ut.scale+(-Ui-1)*Ut.scale:Or.x+=Ut.imageName||Wi.width+2*Ui===Rr.w&&Wi.height+2*Ui===Rr.h?(nn-Is)/2:(nn-(Wi.height+2*Ui)*Ut.scale)/2,$s=new Ge(Or.x,Or.y-vs),Ls=new Ge(Or.x+Is,Or.y),ps=new Ge(Or.x+Is,Or.y-vs)}else{const Gr=(Wi.left-Ui)*Ut.scale-$i+Vr[0],Wn=(-Wi.top-Ui)*Ut.scale+Vr[1],Rs=Gr+vs,fn=Wn+Is;Or=new Ge(Gr,Wn),$s=new Ge(Rs,Wn),Ls=new Ge(Gr,fn),ps=new Ge(Rs,fn)}if(wt){let Gr;Gr=tt?new Ge(0,0):os?new Ge(Ct[0],Ct[1]):new Ge(ke[0],ke[1]),Or._rotateAround(wt,Gr),$s._rotateAround(wt,Gr),Ls._rotateAround(wt,Gr),ps._rotateAround(wt,Gr)}const vr=new Ge(0,0),Ds=new Ge(0,0);bt.push({tl:Or,tr:$s,bl:Ls,br:ps,tex:bi,writingMode:Le.writingMode,glyphOffset:jr,sectionIndex:Ut.sectionIndex,isSDF:_r,pixelOffsetTL:vr,pixelOffsetBR:Ds,minFontScaleX:0,minFontScaleY:0})}}return bt}(0,n,A,f,g,b,c,t.allowVerticalPlacement),Me=t.textSizeData;let ye=null;Me.kind==="source"?(ye=[Kt*f.layout.get("text-size").evaluate(b,{},ce)],ye[0]>qh&&Tt(`${t.layerIds[0]}: Value for "text-size" is >= ${_m}. Reduce your "text-size".`)):Me.kind==="composite"&&(ye=[Kt*Z.compositeTextSizes[0].evaluate(b,{},ce),Kt*Z.compositeTextSizes[1].evaluate(b,{},ce)],(ye[0]>qh||ye[1]>qh)&&Tt(`${t.layerIds[0]}: Value for "text-size" is >= ${_m}. Reduce your "text-size".`)),t.addSymbols(t.text,_e,ye,A,g,b,O,e,i,k.lineStartIndex,k.lineLength,H,ee,ce);for(const Se of U)V[Se]=t.text.placedSymbolArray.length-1;return 4*_e.length}function Ov(t){for(const e in t)return t[e];return null}function l_(t,e,i,n,c,f,g,b,A,k){let O=g.top,U=g.bottom,V=g.left,H=g.right;const Z=g.collisionPadding;if(Z&&(V-=Z[0],O-=Z[1],H+=Z[2],U+=Z[3]),A){const ee=new Ge(V,O),ce=new Ge(H,O),_e=new Ge(V,U),Me=new Ge(H,U),ye=jt(A);let Se=new Ge(0,0);k&&(Se=new Ge(k[0],k[1])),ee._rotateAround(ye,Se),ce._rotateAround(ye,Se),_e._rotateAround(ye,Se),Me._rotateAround(ye,Se),V=Math.min(ee.x,ce.x,_e.x,Me.x),H=Math.max(ee.x,ce.x,_e.x,Me.x),O=Math.min(ee.y,ce.y,_e.y,Me.y),U=Math.max(ee.y,ce.y,_e.y,Me.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,V,O,H,U,b,n,c,f),t.length-1}function yx(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function eS(t,e,i,n){const c=t.compareText;if(e in c){const f=c[e];for(let g=f.length-1;g>=0;g--)if(n.dist(f[g])<i)return!0}else c[e]=[];return c[e].push(n),!1}function Bv(t,e){const i=t.fovAboveCenter,n=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,c=(t._camera.position[2]*t.worldSize-n)/Math.cos(t._pitch),f=Math.sin(i)*c/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),g=Math.sin(t._pitch)*f+c;return Math.min(1.01*g,c*(1/t._horizonShift))}function Id(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),n=t.x*i,c=(t.x+1)*i,f=t.y*i,g=(t.y+1)*i,b=co(n),A=co(c),k=sn(f),O=sn(g),U=e.project(b,k),V=e.project(A,k),H=e.project(A,O),Z=e.project(b,O);let ee=Math.min(U.x,V.x,H.x,Z.x),ce=Math.min(U.y,V.y,H.y,Z.y),_e=Math.max(U.x,V.x,H.x,Z.x),Me=Math.max(U.y,V.y,H.y,Z.y);const ye=i/16;function Se(ke,nt,tt,mt,zt,at){const bt=(tt+zt)/2,wt=(mt+at)/2,Ct=e.project(co(bt),sn(wt)),Nt=Math.max(0,ee-Ct.x,ce-Ct.y,Ct.x-_e,Ct.y-Me);ee=Math.min(ee,Ct.x),_e=Math.max(_e,Ct.x),ce=Math.min(ce,Ct.y),Me=Math.max(Me,Ct.y),Nt>ye&&(Se(ke,Ct,tt,mt,bt,wt),Se(Ct,nt,bt,wt,zt,at))}Se(U,V,n,f,c,f),Se(V,H,c,f,c,g),Se(H,Z,c,g,n,g),Se(Z,U,n,g,n,f),ee-=ye,ce-=ye,_e+=ye,Me+=ye;const Le=1/Math.max(_e-ee,Me-ce);return{scale:Le,x:ee*Le,y:ce*Le,x2:_e*Le,y2:Me*Le,projection:e}}const tS=oo(new Float32Array(16));class Xh{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Mr(0,0)}projectTilePoint(e,i,n){return{x:e,y:i,z:0}}locationPoint(e,i,n=!0){return e._coordinatePoint(e.locationCoordinate(i),n)}pixelsPerMeter(e,i){return aa(1,e)*i}pixelSpaceConversion(e,i,n){return 1}farthestPixelDistance(e){return Bv(e,e.pixelsPerMeter)}pointCoordinate(e,i,n,c){const f=e.horizonLineFromTop(!1),g=new Ge(i,Math.max(f,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,c))}pointCoordinate3D(e,i,n){const c=new Ge(i,n);if(e.elevation)return e.elevation.pointCoordinate(c);{const f=this.pointCoordinate(e,c.x,c.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const n=e.horizonLineFromTop();return i.y<n}createInversionMatrix(e,i){return tS}createTileMatrix(e,i,n){let c,f,g;const b=n.canonical,A=oo(new Float64Array(16));if(this.isReprojectedInTileSpace){const k=Id(b,this);c=1,f=k.x+n.wrap*k.scale,g=k.y,tl(A,A,[c/k.scale,c/k.scale,e.pixelsPerMeter/i])}else c=i/e.zoomScale(b.z),f=(b.x+Math.pow(2,b.z)*n.wrap)*c,g=b.y*c;return Qu(A,A,[f,g,0]),tl(A,A,[c/pi,c/pi,1]),A}upVector(e,i,n){return[0,0,1]}upVectorScale(e,i,n){return{metersToTile:1}}}class iS extends Xh{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,n]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(jt(i));this.n=(c+Math.sin(jt(n)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n,c,r0:f}=this,g=jt(e-this.center[0]),b=jt(i),A=Math.sqrt(c-2*n*Math.sin(b))/n;return{x:A*Math.sin(g*n),y:A*Math.cos(g*n)-f,z:0}}unproject(e,i){const{n,c,r0:f}=this,g=f+i;let b=Math.atan2(e,Math.abs(g))*Math.sign(g);g*n<0&&(b-=Math.PI*Math.sign(e)*Math.sign(g));const A=jt(this.center[0])*n;b=Tr(b,-Math.PI-A,Math.PI-A);const k=vi(Ti(b/n)+this.center[0],-180,180),O=Math.asin(vi((c-(e*e+g*g)*n*n)/(2*n),-1,1)),U=vi(Ti(O),-85.051129,ho);return new Mr(k,U)}}const ym=1.340264,xm=-.081106,vm=893e-6,bm=.003796,c_=Math.sqrt(3)/2;class rS extends Xh{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(c_*Math.sin(i)),c=n*n,f=c*c*c;return{x:.5*(e*Math.cos(n)/(c_*(ym+3*xm*c+f*(7*vm+9*bm*c)))/Math.PI+.5),y:1-.5*(n*(ym+xm*c+f*(vm+bm*c))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let n=i=(2*(1-i)-1)*Math.PI,c=n*n,f=c*c*c;for(let O,U,V,H=0;H<12&&(U=n*(ym+xm*c+f*(vm+bm*c))-i,V=ym+3*xm*c+f*(7*vm+9*bm*c),O=U/V,n=vi(n-O,-Math.PI/3,Math.PI/3),c=n*n,f=c*c*c,!(Math.abs(O)<1e-12));++H);const g=c_*e*(ym+3*xm*c+f*(7*vm+9*bm*c))/Math.cos(n),b=Math.asin(Math.sin(n)/c_),A=vi(180*g/Math.PI,-180,180),k=vi(180*b/Math.PI,-85.051129,ho);return new Mr(A,k)}}class sS extends Xh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const n=360*(e-.5),c=vi(360*(.5-i),-85.051129,ho);return new Mr(n,c)}}const Yp=Math.PI/2;function h_(t){return Math.tan((Yp+t)/2)}class nS extends Xh{constructor(e){super(e),this.center=e.center||[0,30];const[i,n]=this.parallels=e.parallels||[30,30];let c=jt(i),f=jt(n);this.southernCenter=c+f<0,this.southernCenter&&(c=-c,f=-f);const g=Math.cos(c),b=h_(c);this.n=c===f?Math.sin(c):Math.log(g/Math.cos(f))/Math.log(h_(f)/b),this.f=g*Math.pow(h_(c),this.n)/this.n}project(e,i){i=jt(i),this.southernCenter&&(i=-i),e=jt(e-this.center[0]);const n=1e-6,{n:c,f}=this;f>0?i<-Yp+n&&(i=-Yp+n):i>Yp-n&&(i=Yp-n);const g=f/Math.pow(h_(i),c);let b=g*Math.sin(c*e),A=f-g*Math.cos(c*e);return b=.5*(b/Math.PI+.5),A=.5*(A/Math.PI+.5),{x:b,y:this.southernCenter?A:1-A,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n,f:c}=this,f=c-i,g=Math.sign(f),b=Math.sign(n)*Math.sqrt(e*e+f*f);let A=Math.atan2(e,Math.abs(f))*g;f*n<0&&(A-=Math.PI*Math.sign(e)*g);const k=vi(Ti(A/n)+this.center[0],-180,180),O=vi(Ti(2*Math.atan(Math.pow(c/b,1/n))-Yp),-85.051129,ho);return new Mr(k,this.southernCenter?-O:O)}}class Fv extends Xh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:oa(e),y:Ro(i),z:0}}unproject(e,i){const n=co(e),c=sn(i);return new Mr(n,c)}}const Nv=jt(ho);class oS extends Xh{project(e,i){const n=(i=jt(i))*i,c=n*n;return{x:.5*((e=jt(e))*(.8707-.131979*n+c*(c*(.003971*n-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+n*(.015085+c*(.028874*n-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let n=i=(2*(1-i)-1)*Math.PI,c=25,f=0,g=n*n;do{g=n*n;const k=g*g;f=(n*(1.007226+g*(.015085+k*(.028874*g-.044475-.005916*k)))-i)/(1.007226+g*(.045255+k*(.259866*g-.311325-.005916*11*k))),n=vi(n-f,-Nv,Nv)}while(Math.abs(f)>1e-6&&--c>0);g=n*n;const b=vi(Ti(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),A=Ti(n);return new Mr(b,A)}}const Uv=jt(ho);class aS extends Xh{project(e,i){i=jt(i),e=jt(e);const n=Math.cos(i),c=2/Math.PI,f=Math.acos(n*Math.cos(e/2)),g=Math.sin(f)/f,b=.5*(e*c+2*n*Math.sin(e/2)/g)||0,A=.5*(i+Math.sin(i)/g)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(A/Math.PI+1),z:0}}unproject(e,i){let n=e=(2*e-.5)*Math.PI,c=i=(2*(1-i)-1)*Math.PI,f=25;const g=1e-6;let b=0,A=0;do{const k=Math.cos(c),O=Math.sin(c),U=2*O*k,V=O*O,H=k*k,Z=Math.cos(n/2),ee=Math.sin(n/2),ce=2*Z*ee,_e=ee*ee,Me=1-H*Z*Z,ye=Me?1/Me:0,Se=Me?Math.acos(k*Z)*Math.sqrt(1/Me):0,Le=.5*(2*Se*k*ee+2*n/Math.PI)-e,ke=.5*(Se*O+c)-i,nt=.5*ye*(H*_e+Se*k*Z*V)+1/Math.PI,tt=ye*(ce*U/4-Se*O*ee),mt=.125*ye*(U*ee-Se*O*H*ce),zt=.5*ye*(V*Z+Se*_e*k)+.5,at=tt*mt-zt*nt;b=(ke*tt-Le*zt)/at,A=(Le*mt-ke*nt)/at,n=vi(n-b,-Math.PI,Math.PI),c=vi(c-A,-Uv,Uv)}while((Math.abs(b)>g||Math.abs(A)>g)&&--f>0);return new Mr(Ti(n),Ti(c))}}class jv extends Xh{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(jt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:n,cosPhi:c}=this;return{x:jt(e)*c*n+.5,y:-Math.sin(jt(i))/c*n+.5,z:0}}unproject(e,i){const{scale:n,cosPhi:c}=this,f=-(i-.5)/n,g=vi(Ti((e-.5)/n)/c,-180,180),b=Math.asin(vi(f*c,-1,1)),A=vi(Ti(b),-85.051129,ho);return new Mr(g,A)}}class lS extends Fv{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,n){const c=cd(e,i,n);return Qr(c,c,Bc(Do(n))),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,i){const n=Rh(i.lat,i.lng),c=Tn([],n),f=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;id(n,n,c,aa(1,0)*pi*f);const g=oo(new Float64Array(16));return el(g,e.pixelMatrix,e.globeMatrix),Qr(n,n,g),new Ge(n[0],n[1])}pixelsPerMeter(e,i){return aa(1,0)*i}pixelSpaceConversion(e,i,n){const c=aa(1,e)*i,f=nr(aa(1,45)*i,c,n);return this.pixelsPerMeter(e,i)/f}createTileMatrix(e,i,n){const c=Xf(Do(n.canonical));return el(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,i){const{center:n}=e,c=Bc(Do(i));return bp(c,c,jt(n.lng)),ed(c,c,jt(n.lat)),tl(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,i,n,c){return Eg(e,i,n,!0)||new Bh(0,0)}pointCoordinate3D(e,i,n){const c=this.pointCoordinate(e,i,n,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,i){return!Eg(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(c,f){const g=c.cameraToCenterDistance,b=c._centerAltitude*f,A=c._camera,k=c._camera.forward(),O=sa([],jn([],k,-g),[0,0,b]),U=c.worldSize/(2*Math.PI),V=[0,0,-U],H=c.width/c.height,Z=Math.tan(c.fovAboveCenter),ee=jn([],A.up(),Z),ce=jn([],A.right(),Z*H),_e=Tn([],sa([],sa([],k,ee),ce)),Me=[];let ye;if(new Wf(O,_e).closestPointOnSphere(V,U,Me)){const Se=sa([],Me,V),Le=ao([],Se,O);ye=Math.cos(c.fovAboveCenter)*Lh(Le)}else{const Se=ao([],O,V),Le=ao([],V,O);Tn(Le,Le);const ke=Lh(Se)-U;ye=Math.sqrt(ke*(ke+2*U));const nt=Math.acos(ye/(U+ke))-Math.acos(Vn(k,Le));ye*=Math.cos(nt)}return 1.01*ye}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=Oh(e.zoom);if(n>0){const c=Bv(e,aa(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return nr(i,c+f*(1-Math.cos(g)),Math.pow(n,10))}return i}upVector(e,i,n){return cd(i,n,e,1)}upVectorScale(e){return{metersToTile:Cp(zh(Do(e)))}}}function Vv(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Fv(t);case"equirectangular":return new sS(t);case"naturalEarth":return new oS(t);case"equalEarth":return new rS(t);case"winkelTripel":return new aS(t);case"albers":return i?new jv(t):new iS(t);case"lambertConformalConic":return i?new jv(t):new nS(t);case"globe":return new lS(t)}throw new Error(`Invalid projection name: ${t.name}`)}const cS=Td.types,hS=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function u_(t,e,i,n,c,f,g,b,A,k,O,U,V){const H=b?Math.min(qh,Math.round(b[0])):0,Z=b?Math.min(qh,Math.round(b[1])):0;t.emplaceBack(e,i,Math.round(32*n),Math.round(32*c),f,g,(H<<1)+(A?1:0),Z,16*k,16*O,256*U,256*V)}function d_(t,e,i,n,c,f,g){t.emplaceBack(e,i,n,c,f,g)}function p_(t,e,i,n,c){t.emplaceBack(e,i,n,c),t.emplaceBack(e,i,n,c),t.emplaceBack(e,i,n,c),t.emplaceBack(e,i,n,c)}function uS(t){for(const e of t.sections)if(Nf(e.text))return!0;return!1}class xx{constructor(e){this.layoutVertexArray=new ft,this.indexArray=new di,this.programConfigurations=e,this.segments=new us,this.dynamicLayoutVertexArray=new Pt,this.opacityVertexArray=new mi,this.placedSymbolArray=new ys,this.globeExtVertexArray=new Rt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,n,c){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Re.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,qe.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,hS,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,rt.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}ni(xx,"SymbolBuffers");class vx{constructor(e,i,n){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new n,this.segments=new us,this.collisionVertexArray=new Oi,this.collisionVertexArrayExt=new Bi}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,st.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Et.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ni(vx,"CollisionBuffers");class Zh{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=oo([]),this.placementViewportMatrix=oo([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=si(this.zoom,i["text-size"]),this.iconSizeData=si(this.zoom,i["icon-size"]);const n=this.layers[0].layout,c=n.get("symbol-sort-key"),f=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(g=>ha[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new xx(new Ul(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new xx(new Ul(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ks,this.lineVertexArray=new kh,this.symbolInstances=new Nr}calculateGlyphDependencies(e,i,n,c,f){for(let g=0;g<e.length;g++)if(i[e.charCodeAt(g)]=!0,c&&f){const b=Zi[e.charAt(g)];b&&(i[b.charCodeAt(0)]=!0)}}populate(e,i,n,c){const f=this.layers[0],g=f.layout,b=this.projection.name==="globe",A=g.get("text-font"),k=g.get("text-field"),O=g.get("icon-image"),U=(k.value.kind!=="constant"||k.value.value instanceof bn&&!k.value.value.isEmpty()||k.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),V=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,H=g.get("symbol-sort-key");if(this.features=[],!U&&!V)return;const Z=i.iconDependencies,ee=i.glyphDependencies,ce=i.availableImages,_e=new F(this.zoom);for(const{feature:Me,id:ye,index:Se,sourceLayerIndex:Le}of e){const ke=f._featureFilter.needGeometry,nt=Fc(Me,ke);if(!f._featureFilter.filter(_e,nt,n))continue;if(ke||(nt.geometry=la(Me,n,c)),b&&Me.type!==1&&n.z<=5){const at=nt.geometry,bt=.98078528056,wt=(Ct,Nt)=>Vn(cd(Ct.x,Ct.y,n,1),cd(Nt.x,Nt.y,n,1))<bt;for(let Ct=0;Ct<at.length;Ct++)at[Ct]=Uy(at[Ct],wt)}let tt,mt;if(U){const at=f.getValueAndResolveTokens("text-field",nt,n,ce),bt=bn.factory(at);uS(bt)&&(this.hasRTLText=!0),(!this.hasRTLText||T()==="unavailable"||this.hasRTLText&&I.isParsed())&&(tt=ar(bt,f,nt))}if(V){const at=f.getValueAndResolveTokens("icon-image",nt,n,ce);mt=at instanceof un?at:un.fromString(at)}if(!tt&&!mt)continue;const zt=this.sortFeaturesByKey?H.evaluate(nt,{},n):void 0;if(this.features.push({id:ye,text:tt,icon:mt,index:Se,sourceLayerIndex:Le,geometry:nt.geometry,properties:Me.properties,type:cS[Me.type],sortKey:zt}),mt&&(Z[mt.name]=!0),tt){const at=A.evaluate(nt,{},n).join(","),bt=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ha.vertical)>=0;for(const wt of tt.sections)if(wt.image)Z[wt.image.name]=!0;else{const Ct=Hu(tt.toString()),Nt=wt.fontStack||at,dt=ee[Nt]=ee[Nt]||{};this.calculateGlyphDependencies(wt.text,dt,bt,this.allowVerticalPlacement,Ct)}}}g.get("symbol-placement")==="line"&&(this.features=function(Me){const ye={},Se={},Le=[];let ke=0;function nt(at){Le.push(Me[at]),ke++}function tt(at,bt,wt){const Ct=Se[at];return delete Se[at],Se[bt]=Ct,Le[Ct].geometry[0].pop(),Le[Ct].geometry[0]=Le[Ct].geometry[0].concat(wt[0]),Ct}function mt(at,bt,wt){const Ct=ye[bt];return delete ye[bt],ye[at]=Ct,Le[Ct].geometry[0].shift(),Le[Ct].geometry[0]=wt[0].concat(Le[Ct].geometry[0]),Ct}function zt(at,bt,wt){const Ct=wt?bt[0][bt[0].length-1]:bt[0][0];return`${at}:${Ct.x}:${Ct.y}`}for(let at=0;at<Me.length;at++){const bt=Me[at],wt=bt.geometry,Ct=bt.text?bt.text.toString():null;if(!Ct){nt(at);continue}const Nt=zt(Ct,wt),dt=zt(Ct,wt,!0);if(Nt in Se&&dt in ye&&Se[Nt]!==ye[dt]){const Xt=mt(Nt,dt,wt),ui=tt(Nt,dt,Le[Xt].geometry);delete ye[Nt],delete Se[dt],Se[zt(Ct,Le[ui].geometry,!0)]=ui,Le[Xt].geometry=null}else Nt in Se?tt(Nt,dt,wt):dt in ye?mt(Nt,dt,wt):(nt(at),ye[Nt]=ke-1,Se[dt]=ke-1)}return Le.filter(at=>at.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Me,ye)=>Me.sortKey-ye.sortKey)}update(e,i,n,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,n,c),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,n,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Vv(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const n=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:c,y:f}of i)this.lineVertexArray.emplaceBack(c,f);return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,i,n,c,f,g,b,A,k,O,U,V,H,Z){const ee=e.indexArray,ce=e.layoutVertexArray,_e=e.globeExtVertexArray,Me=e.segments.prepareSegment(4*i.length,ce,ee,this.canOverlap?g.sortKey:void 0),ye=this.glyphOffsetArray.length,Se=Me.vertexLength,Le=this.allowVerticalPlacement&&b===ha.vertical?Math.PI/2:0,ke=g.text&&g.text.sections;for(let tt=0;tt<i.length;tt++){const{tl:mt,tr:zt,bl:at,br:bt,tex:wt,pixelOffsetTL:Ct,pixelOffsetBR:Nt,minFontScaleX:dt,minFontScaleY:Xt,glyphOffset:ui,isSDF:Jt,sectionIndex:Ni}=i[tt],Ut=Me.vertexLength,bi=ui[1];if(u_(ce,k.x,k.y,mt.x,bi+mt.y,wt.x,wt.y,n,Jt,Ct.x,Ct.y,dt,Xt),u_(ce,k.x,k.y,zt.x,bi+zt.y,wt.x+wt.w,wt.y,n,Jt,Nt.x,Ct.y,dt,Xt),u_(ce,k.x,k.y,at.x,bi+at.y,wt.x,wt.y+wt.h,n,Jt,Ct.x,Nt.y,dt,Xt),u_(ce,k.x,k.y,bt.x,bi+bt.y,wt.x+wt.w,wt.y+wt.h,n,Jt,Nt.x,Nt.y,dt,Xt),A){const{x:Ui,y:_r,z:ji}=A.anchor,[Ai,qr,$i]=A.up;d_(_e,Ui,_r,ji,Ai,qr,$i),d_(_e,Ui,_r,ji,Ai,qr,$i),d_(_e,Ui,_r,ji,Ai,qr,$i),d_(_e,Ui,_r,ji,Ai,qr,$i),p_(e.dynamicLayoutVertexArray,Ui,_r,ji,Le)}else p_(e.dynamicLayoutVertexArray,k.x,k.y,k.z,Le);ee.emplaceBack(Ut,Ut+1,Ut+2),ee.emplaceBack(Ut+1,Ut+2,Ut+3),Me.vertexLength+=4,Me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ui[0]),tt!==i.length-1&&Ni===i[tt+1].sectionIndex||e.programConfigurations.populatePaintArrays(ce.length,g,g.index,{},H,Z,ke&&ke[Ni])}const nt=A?A.anchor:k;e.placedSymbolArray.emplaceBack(nt.x,nt.y,nt.z,k.x,k.y,ye,this.glyphOffsetArray.length-ye,Se,O,U,k.segment,n?n[0]:0,n?n[1]:0,c[0],c[1],b,0,!1,0,V,0)}_commitLayoutVertex(e,i,n,c,f,g,b){e.emplaceBack(i,n,c,f,g,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(e,i,n,c,f,g,b){const A=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),k=A.vertexLength,O=b.tileAnchorX,U=b.tileAnchorY;for(let H=0;H<4;H++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,c,f,g,O,U,new Ge(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,c,f,g,O,U,new Ge(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,c,f,g,O,U,new Ge(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,c,f,g,O,U,new Ge(e.x1,e.y2)),A.vertexLength+=4;const V=n.indexArray;V.emplaceBack(k,k+1),V.emplaceBack(k+1,k+2),V.emplaceBack(k+2,k+3),V.emplaceBack(k+3,k),A.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,n,c,f,g){for(let b=c;b<f;b++){const A=n.get(b),k=this.getSymbolInstanceTextSize(e,g,i,b);this._addCollisionDebugVertices(A,k,this.textCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,i,n,c,f,g){for(let b=c;b<f;b++){const A=n.get(b),k=this.getSymbolInstanceIconSize(e,i,g.placedIconSymbolIndex);this._addCollisionDebugVertices(A,k,this.iconCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vx(oi,Bt.members,Gs),this.iconCollisionBox=new vx(oi,Bt.members,Gs);const n=hi(this.iconSizeData,e),c=hi(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(c,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(c,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(n,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(n,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,i,n,c){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),g=Ii(this.textSizeData,e,f)/At;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,i,n){const c=this.icon.placedSymbolArray.get(n),f=Ii(this.iconSizeData,e,c);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,i,n){e.emplaceBack(i,-n,-n),e.emplaceBack(i,n,-n),e.emplaceBack(i,n,n),e.emplaceBack(i,-n,n)}_updateTextDebugCollisionBoxes(e,i,n,c,f,g){for(let b=c;b<f;b++){const A=n.get(b),k=this.getSymbolInstanceTextSize(e,g,i,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,k,A.padding)}}_updateIconDebugCollisionBoxes(e,i,n,c,f,g){for(let b=c;b<f;b++){const A=n.get(b),k=this.getSymbolInstanceIconSize(e,i,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,k,A.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=hi(this.iconSizeData,e),c=hi(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(c,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(c,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(n,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(n,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,n,c,f,g,b,A,k){const O={};if(i<n){const{x1:U,y1:V,x2:H,y2:Z,padding:ee,projectedAnchorX:ce,projectedAnchorY:_e,projectedAnchorZ:Me,tileAnchorX:ye,tileAnchorY:Se,featureIndex:Le}=e.get(i);O.textBox={x1:U,y1:V,x2:H,y2:Z,padding:ee,projectedAnchorX:ce,projectedAnchorY:_e,projectedAnchorZ:Me,tileAnchorX:ye,tileAnchorY:Se},O.textFeatureIndex=Le}if(c<f){const{x1:U,y1:V,x2:H,y2:Z,padding:ee,projectedAnchorX:ce,projectedAnchorY:_e,projectedAnchorZ:Me,tileAnchorX:ye,tileAnchorY:Se,featureIndex:Le}=e.get(c);O.verticalTextBox={x1:U,y1:V,x2:H,y2:Z,padding:ee,projectedAnchorX:ce,projectedAnchorY:_e,projectedAnchorZ:Me,tileAnchorX:ye,tileAnchorY:Se},O.verticalTextFeatureIndex=Le}if(g<b){const{x1:U,y1:V,x2:H,y2:Z,padding:ee,projectedAnchorX:ce,projectedAnchorY:_e,projectedAnchorZ:Me,tileAnchorX:ye,tileAnchorY:Se,featureIndex:Le}=e.get(g);O.iconBox={x1:U,y1:V,x2:H,y2:Z,padding:ee,projectedAnchorX:ce,projectedAnchorY:_e,projectedAnchorZ:Me,tileAnchorX:ye,tileAnchorY:Se},O.iconFeatureIndex=Le}if(A<k){const{x1:U,y1:V,x2:H,y2:Z,padding:ee,projectedAnchorX:ce,projectedAnchorY:_e,projectedAnchorZ:Me,tileAnchorX:ye,tileAnchorY:Se,featureIndex:Le}=e.get(A);O.verticalIconBox={x1:U,y1:V,x2:H,y2:Z,padding:ee,projectedAnchorX:ce,projectedAnchorY:_e,projectedAnchorZ:Me,tileAnchorX:ye,tileAnchorY:Se},O.verticalIconFeatureIndex=Le}return O}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const n=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const n=e.placedSymbolArray.get(i),c=n.vertexStartIndex+4*n.numGlyphs;for(let f=n.vertexStartIndex;f<c;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),n=Math.cos(e),c=[],f=[],g=[];for(let b=0;b<this.symbolInstances.length;++b){g.push(b);const A=this.symbolInstances.get(b);c.push(0|Math.round(i*A.tileAnchorX+n*A.tileAnchorY)),f.push(A.featureIndex)}return g.sort((b,A)=>c[b]-c[A]||f[A]-f[b]),g}addToSortKeyRanges(e,i){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===i?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const n=this.symbolInstances.get(i);this.featureSortOrder.push(n.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:k}=n;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),f>=0&&f!==c&&this.addIndicesForPlacedSymbol(this.text,f),g>=0&&g!==f&&g!==c&&this.addIndicesForPlacedSymbol(this.text,g),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A),k>=0&&this.addIndicesForPlacedSymbol(this.icon,k)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ni(Zh,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Zh.MAX_GLYPHS=65535,Zh.addDynamicAttributes=p_;const dS=new be({"symbol-placement":new J(ut.layout_symbol["symbol-placement"]),"symbol-spacing":new J(ut.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new J(ut.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ue(ut.layout_symbol["symbol-sort-key"]),"symbol-z-order":new J(ut.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new J(ut.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new J(ut.layout_symbol["icon-ignore-placement"]),"icon-optional":new J(ut.layout_symbol["icon-optional"]),"icon-rotation-alignment":new J(ut.layout_symbol["icon-rotation-alignment"]),"icon-size":new ue(ut.layout_symbol["icon-size"]),"icon-text-fit":new J(ut.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new J(ut.layout_symbol["icon-text-fit-padding"]),"icon-image":new ue(ut.layout_symbol["icon-image"]),"icon-rotate":new ue(ut.layout_symbol["icon-rotate"]),"icon-padding":new J(ut.layout_symbol["icon-padding"]),"icon-keep-upright":new J(ut.layout_symbol["icon-keep-upright"]),"icon-offset":new ue(ut.layout_symbol["icon-offset"]),"icon-anchor":new ue(ut.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new J(ut.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new J(ut.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new J(ut.layout_symbol["text-rotation-alignment"]),"text-field":new ue(ut.layout_symbol["text-field"]),"text-font":new ue(ut.layout_symbol["text-font"]),"text-size":new ue(ut.layout_symbol["text-size"]),"text-max-width":new ue(ut.layout_symbol["text-max-width"]),"text-line-height":new ue(ut.layout_symbol["text-line-height"]),"text-letter-spacing":new ue(ut.layout_symbol["text-letter-spacing"]),"text-justify":new ue(ut.layout_symbol["text-justify"]),"text-radial-offset":new ue(ut.layout_symbol["text-radial-offset"]),"text-variable-anchor":new J(ut.layout_symbol["text-variable-anchor"]),"text-anchor":new ue(ut.layout_symbol["text-anchor"]),"text-max-angle":new J(ut.layout_symbol["text-max-angle"]),"text-writing-mode":new J(ut.layout_symbol["text-writing-mode"]),"text-rotate":new ue(ut.layout_symbol["text-rotate"]),"text-padding":new J(ut.layout_symbol["text-padding"]),"text-keep-upright":new J(ut.layout_symbol["text-keep-upright"]),"text-transform":new ue(ut.layout_symbol["text-transform"]),"text-offset":new ue(ut.layout_symbol["text-offset"]),"text-allow-overlap":new J(ut.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new J(ut.layout_symbol["text-ignore-placement"]),"text-optional":new J(ut.layout_symbol["text-optional"])});var bx={paint:new be({"icon-opacity":new ue(ut.paint_symbol["icon-opacity"]),"icon-color":new ue(ut.paint_symbol["icon-color"]),"icon-halo-color":new ue(ut.paint_symbol["icon-halo-color"]),"icon-halo-width":new ue(ut.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ue(ut.paint_symbol["icon-halo-blur"]),"icon-translate":new J(ut.paint_symbol["icon-translate"]),"icon-translate-anchor":new J(ut.paint_symbol["icon-translate-anchor"]),"text-opacity":new ue(ut.paint_symbol["text-opacity"]),"text-color":new ue(ut.paint_symbol["text-color"],{runtimeType:yn,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new ue(ut.paint_symbol["text-halo-color"]),"text-halo-width":new ue(ut.paint_symbol["text-halo-width"]),"text-halo-blur":new ue(ut.paint_symbol["text-halo-blur"]),"text-translate":new J(ut.paint_symbol["text-translate"]),"text-translate-anchor":new J(ut.paint_symbol["text-translate-anchor"])}),layout:dS};class Gv{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:gl,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ni(Gv,"FormatSectionOverride",{omit:["defaultValue"]});class f_ extends ra{constructor(e){super(e,bx)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const c=[];for(const f of n)c.indexOf(f)<0&&c.push(f);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,n,c){const f=this.layout.get(e).evaluate(i,{},n,c),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||yr(g.value)||!f?f:function(b,A){return A.replace(/{([^{}]+)}/g,(k,O)=>O in b?String(b[O]):"")}(i.properties,f)}createBucket(e){return new Zh(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of bx.paint.overridableProperties){if(!f_.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),n=new Gv(i),c=new Js(n,i.property.specification);let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new bh("source",c):new Wa("composite",c,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new pe(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,n){return!(!this.layout||i.isDataDriven()||n.isDataDriven())&&f_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const n=e.get("text-field"),c=bx.paint.properties[i];let f=!1;const g=b=>{for(const A of b)if(c.overrides&&c.overrides.hasOverride(A))return void(f=!0)};if(n.value.kind==="constant"&&n.value.value instanceof bn)g(n.value.value.sections);else if(n.value.kind==="source"){const b=k=>{f||(k instanceof Ho&&rs(k.value)===Ys?g(k.value.sections):k instanceof Xo?g(k.sections):k.eachChild(b))},A=n.value;A._styleExpression&&b(A._styleExpression.expression)}return f}getProgramConfiguration(e){return new Nl(this,e)}}var pS={paint:new be({"background-color":new J(ut.paint_background["background-color"]),"background-pattern":new J(ut.paint_background["background-pattern"]),"background-opacity":new J(ut.paint_background["background-opacity"])})},fS={paint:new be({"raster-opacity":new J(ut.paint_raster["raster-opacity"]),"raster-hue-rotate":new J(ut.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new J(ut.paint_raster["raster-brightness-min"]),"raster-brightness-max":new J(ut.paint_raster["raster-brightness-max"]),"raster-saturation":new J(ut.paint_raster["raster-saturation"]),"raster-contrast":new J(ut.paint_raster["raster-contrast"]),"raster-resampling":new J(ut.paint_raster["raster-resampling"]),"raster-fade-duration":new J(ut.paint_raster["raster-fade-duration"])})};class mS extends ra{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var gS={paint:new be({"sky-type":new J(ut.paint_sky["sky-type"]),"sky-atmosphere-sun":new J(ut.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new J(ut.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new J(ut.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new J(ut.paint_sky["sky-gradient-radius"]),"sky-gradient":new ve(ut.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new J(ut.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new J(ut.paint_sky["sky-atmosphere-color"]),"sky-opacity":new J(ut.paint_sky["sky-opacity"])})};function wx(t,e,i){const n=[0,0,1],c=rn([]);return $f(c,c,i?-jt(t)+Math.PI:jt(t)),xg(c,c,-jt(e)),gr(n,n,c),Tn(n,n)}const _S={circle:class extends ra{constructor(t){super(t,Hl)}createBucket(t){return new Nh(t)}queryRadius(t){const e=t;return jh("circle-radius",this,e)+jh("circle-stroke-width",this,e)+Ma(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,n,c,f,g,b){const A=zp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),k=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Vh(t,n,f,g,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",A,k)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Nl(this,t)}},heatmap:class extends ra{createBucket(t){return new em(t)}constructor(t){super(t,$y),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=tm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return jh("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,n,c,f,g,b){const A=this.paint.get("heatmap-radius").evaluate(e,i);return Vh(t,n,f,g,b,!0,!0,new Ge(0,0),A)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Nl(this,t)}},hillshade:class extends ra{constructor(t){super(t,Wy)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ra{constructor(t){super(t,tx)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new Nl(this,t)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new wd(t)}queryRadius(){return Ma(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,n,c,f){return!t.queryGeometry.isAboveHorizon&&Jf(Qf(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends ra{constructor(t){super(t,s)}createBucket(t){return new Ad(t)}queryRadius(){return Ma(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Nl(this,t)}queryIntersectsFeature(t,e,i,n,c,f,g,b,A){const k=zp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),O=this.paint.get("fill-extrusion-height").evaluate(e,i),U=this.paint.get("fill-extrusion-base").evaluate(e,i),V=[0,0],H=b&&f.elevation,Z=f.elevation?f.elevation.exaggeration():1,ee=t.tile.getBucket(this);if(H&&ee instanceof Ad){const Se=ee.centroidVertexArray,Le=A+1;Le<Se.length&&(V[0]=Se.geta_centroid_pos0(Le),V[1]=Se.geta_centroid_pos1(Le))}if(V[0]===0&&V[1]===1)return!1;f.projection.name==="globe"&&(n=fm([n],[new Ge(0,0),new Ge(pi,pi)],t.tileID.canonical).map(Se=>Se.polygon).flat());const ce=H?b:null,[_e,Me]=function(Se,Le,ke,nt,tt,mt,zt,at,bt,wt,Ct){return Se.projection.name==="globe"?function(Nt,dt,Xt,ui,Jt,Ni,Ut,bi,Ui,_r,ji){const Ai=[],qr=[],$i=Nt.projection.upVectorScale(ji,Nt.center.lat,Nt.worldSize).metersToTile,Wi=[0,0,0,1],Rr=[0,0,0,1],jr=(zr,os,vs,Is)=>{zr[0]=os,zr[1]=vs,zr[2]=Is,zr[3]=1},Vr=t_();Xt>0&&(Xt+=Vr),ui+=Vr;for(const zr of dt){const os=[],vs=[];for(const Is of zr){const Or=Is.x+Jt.x,$s=Is.y+Jt.y,Ls=Nt.projection.projectTilePoint(Or,$s,ji),ps=Nt.projection.upVector(ji,Is.x,Is.y);let vr=Xt,Ds=ui;if(Ut){const Gr=N(Or,$s,Xt,ui,Ut,bi,Ui,_r);vr+=Gr.base,Ds+=Gr.top}Xt!==0?jr(Wi,Ls.x+ps[0]*$i*vr,Ls.y+ps[1]*$i*vr,Ls.z+ps[2]*$i*vr):jr(Wi,Ls.x,Ls.y,Ls.z),jr(Rr,Ls.x+ps[0]*$i*Ds,Ls.y+ps[1]*$i*Ds,Ls.z+ps[2]*$i*Ds),Qr(Wi,Wi,Ni),Qr(Rr,Rr,Ni),os.push(new S(Wi[0],Wi[1],Wi[2])),vs.push(new S(Rr[0],Rr[1],Rr[2]))}Ai.push(os),qr.push(vs)}return[Ai,qr]}(Se,Le,ke,nt,tt,mt,zt,at,bt,wt,Ct):zt?function(Nt,dt,Xt,ui,Jt,Ni,Ut,bi,Ui){const _r=[],ji=[],Ai=[0,0,0,1];for(const qr of Nt){const $i=[],Wi=[];for(const Rr of qr){const jr=Rr.x+ui.x,Vr=Rr.y+ui.y,zr=N(jr,Vr,dt,Xt,Ni,Ut,bi,Ui);Ai[0]=jr,Ai[1]=Vr,Ai[2]=zr.base,Ai[3]=1,En(Ai,Ai,Jt),Ai[3]=Math.max(Ai[3],1e-5);const os=new S(Ai[0]/Ai[3],Ai[1]/Ai[3],Ai[2]/Ai[3]);Ai[0]=jr,Ai[1]=Vr,Ai[2]=zr.top,Ai[3]=1,En(Ai,Ai,Jt),Ai[3]=Math.max(Ai[3],1e-5);const vs=new S(Ai[0]/Ai[3],Ai[1]/Ai[3],Ai[2]/Ai[3]);$i.push(os),Wi.push(vs)}_r.push($i),ji.push(Wi)}return[_r,ji]}(Le,ke,nt,tt,mt,zt,at,bt,wt):function(Nt,dt,Xt,ui,Jt){const Ni=[],Ut=[],bi=Jt[8]*dt,Ui=Jt[9]*dt,_r=Jt[10]*dt,ji=Jt[11]*dt,Ai=Jt[8]*Xt,qr=Jt[9]*Xt,$i=Jt[10]*Xt,Wi=Jt[11]*Xt;for(const Rr of Nt){const jr=[],Vr=[];for(const zr of Rr){const os=zr.x+ui.x,vs=zr.y+ui.y,Is=Jt[0]*os+Jt[4]*vs+Jt[12],Or=Jt[1]*os+Jt[5]*vs+Jt[13],$s=Jt[2]*os+Jt[6]*vs+Jt[14],Ls=Jt[3]*os+Jt[7]*vs+Jt[15],ps=Is+bi,vr=Or+Ui,Ds=$s+_r,Gr=Math.max(Ls+ji,1e-5),Wn=Is+Ai,Rs=Or+qr,fn=$s+$i,nn=Math.max(Ls+Wi,1e-5);jr.push(new S(ps/Gr,vr/Gr,Ds/Gr)),Vr.push(new S(Wn/nn,Rs/nn,fn/nn))}Ni.push(jr),Ut.push(Vr)}return[Ni,Ut]}(Le,ke,nt,tt,mt)}(f,n,U,O,k,g,ce,V,Z,f.center.lat,t.tileID.canonical),ye=t.queryGeometry;return function(Se,Le,ke){let nt=1/0;Jf(ke,Le)&&(nt=L(ke,Le[0]));for(let tt=0;tt<Le.length;tt++){const mt=Le[tt],zt=Se[tt];for(let at=0;at<mt.length-1;at++){const bt=mt[at],wt=[bt,mt[at+1],zt[at+1],zt[at],bt];pd(ke,wt)&&(nt=Math.min(nt,L(ke,wt)))}}return nt!==1/0&&nt}(_e,Me,ye.isPointQuery()?ye.screenBounds:ye.screenGeometry)}},line:class extends ra{constructor(t){super(t,he),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Au,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Ue.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Q(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new Nl(this,t)}queryRadius(t){const e=t,i=Ie(jh("line-width",this,e),jh("line-gap-width",this,e)),n=jh("line-offset",this,e);return i/2+Math.abs(n)+Ma(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,n,c,f){if(t.queryGeometry.isAboveHorizon)return!1;const g=Qf(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),b=t.pixelToTileUnitsFactor/2*Ie(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),A=this.paint.get("line-offset").evaluate(e,i);return A&&(n=function(k,O){const U=[],V=new Ge(0,0);for(let H=0;H<k.length;H++){const Z=k[H],ee=[];for(let ce=0;ce<Z.length;ce++){const _e=Z[ce],Me=Z[ce+1],ye=ce===0?V:_e.sub(Z[ce-1])._unit()._perp(),Se=ce===Z.length-1?V:Me.sub(_e)._unit()._perp(),Le=ye._add(Se)._unit();Le._mult(1/(Le.x*Se.x+Le.y*Se.y)),ee.push(Le._mult(O)._add(_e))}U.push(ee)}return U}(n,A*t.pixelToTileUnitsFactor)),function(k,O,U){for(let V=0;V<O.length;V++){const H=O[V];if(k.length>=3){for(let Z=0;Z<H.length;Z++)if(Aa(k,H[Z]))return!0}if(Dg(k,H,U))return!0}return!1}(g,n,b)}isTileClipped(){return!0}},symbol:f_,background:class extends ra{constructor(t){super(t,pS)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ra{constructor(t){super(t,fS)}getProgramIds(){return["raster"]}},sky:class extends ra{constructor(t){super(t,gS),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=tm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const n=this.paint.get("sky-atmosphere-sun"),c=!n,f=t.style.light,g=f.properties.get("position");return c&&f.properties.get("anchor")==="viewport"&&Tt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?wx(g.azimuthal,90-g.polar,e):wx(n[0],90-n[1],e)}const i=this.paint.get("sky-gradient-center");return wx(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}};class wm{constructor(e,i,n,c){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(i,c)}update(e,i,n){const{width:c,height:f}=e,{context:g}=this,{gl:b}=g,{HTMLImageElement:A,HTMLCanvasElement:k,HTMLVideoElement:O,ImageData:U,ImageBitmap:V}=X;if(b.bindTexture(b.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!i||i.premultiply!==!1)),n||this.size&&this.size[0]===c&&this.size[1]===f){const{x:H,y:Z}=n||{x:0,y:0};e instanceof A||e instanceof k||e instanceof O||e instanceof U||V&&e instanceof V?b.texSubImage2D(b.TEXTURE_2D,0,H,Z,b.RGBA,b.UNSIGNED_BYTE,e):b.texSubImage2D(b.TEXTURE_2D,0,H,Z,c,f,b.RGBA,b.UNSIGNED_BYTE,e.data)}else this.size=[c,f],e instanceof A||e instanceof k||e instanceof O||e instanceof U||V&&e instanceof V?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,e):b.texImage2D(b.TEXTURE_2D,0,this.format,c,f,0,this.format,b.UNSIGNED_BYTE,e.data);this.useMipmap=!!(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(e,i){const{context:n}=this,{gl:c}=n;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class yS{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class xS{constructor(){this.tasks={},this.taskQueue=[],fi(["process"],this),this.invoker=new yS(this.process),this.nextId=0}add(e,i){const n=this.nextId++,c=function({type:f,isSymbolTile:g,zoom:b}){return b=b||0,f==="message"?0:f!=="maybePrepare"||g?f!=="parseTile"||g?f==="parseTile"&&g?300-b:f==="maybePrepare"&&g?400-b:500:200-b:100-b}(i);if(c===0){ei();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:i,priority:c,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){ei();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){const f=this.tasks[this.taskQueue[c]];f.priority<i&&(i=f.priority,e=c)}if(e===null)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class $v{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const n=e[i];this._stringToNumber[n]=i,this._numberToString[i]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const vS=["tile","layer","source","sourceLayer","state"];class Wv{constructor(e,i,n,c,f){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=n,this._y=c,this.properties=e.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of vS)this[i]!==void 0&&(e[i]=this[i]);return e}}const Ca=32,Zl=33,Yh=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,n=0,c=0,f=0,g=0,b=0;for(1&e?c=f=g=Ca:i=n=b=Ca;(e>>=1)>1;){const k=i+c>>1,O=n+f>>1;1&e?(c=i,f=n,i=g,n=b):(i=c,n=f,c=g,f=b),g=k,b=O}const A=4*t;Yh[A+0]=i,Yh[A+1]=n,Yh[A+2]=c,Yh[A+3]=f}const Yl=new Uint16Array(2178),Kh=new Uint8Array(1089),m_=new Uint16Array(1089);function Hv(t){return t===0?-.03125:t===32?.03125:0}var qv=$e([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Xv={type:2,extent:pi,loadGeometry:()=>[[new Ge(0,0),new Ge(pi+1,0),new Ge(pi+1,pi+1),new Ge(0,pi+1),new Ge(0,0)]]};class Tx{constructor(e,i,n,c,f){this.tileID=e,this.uid=Es(),this.uses=0,this.tileSize=i,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<vo.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Id(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,f){const g={};if(!f)return g;for(const b of c){const A=b.layerIds.map(k=>f.getLayer(k)).filter(Boolean);if(A.length!==0){b.layers=A,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(k=>A.filter(O=>O.id===k)[0]));for(const k of A)g[k.id]=b}}return g}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const f=this.buckets[c];if(f instanceof Zh){if(this.hasSymbolBuckets=!0,!n)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const f=this.buckets[c];if(f instanceof Zh&&f.hasRTLText){this.hasRTLText=!0,I.isLoading()||I.isLoaded()||T()!=="deferred"||P();break}}this.queryPadding=0;for(const c in this.buckets){const f=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(c).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Lr}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const n in this.buckets){const c=this.buckets[n];c.uploadPending()&&c.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new wm(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new wm(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new wm(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,n,c,f,g,b,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:b,transform:g,params:f,tileTransform:this.tileTransform},e,i,n):{}}querySourceFeatures(e,i){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const c=n.loadVTLayers(),f=i?i.sourceLayer:"",g=c._geojsonTileLayer||c[f];if(!g)return;const b=wh(i&&i.filter),{z:A,x:k,y:O}=this.tileID.canonical,U={z:A,x:k,y:O};for(let V=0;V<g.length;V++){const H=g.feature(V);if(b.needGeometry){const ce=Fc(H,!0);if(!b.filter(new F(this.tileID.overscaledZ),ce,this.tileID.canonical))continue}else if(!b.filter(new F(this.tileID.overscaledZ),H))continue;const Z=n.getId(H,f),ee=new Wv(H,A,k,O,Z);ee.tile=U,e.push(ee)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const n=Wt(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const n=Date.now();let c=!1;if(this.expirationTime>n)c=!1;else if(i)if(this.expirationTime<i)c=!0;else{const f=this.expirationTime-i;f?this.expirationTime=n+Math.max(f,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!i)return;const n=this.latestFeatureIndex.loadVTLayers(),c=i.style.listImages();for(const f in this.buckets){if(!i.style.hasLayer(f))continue;const g=this.buckets[f],b=g.layers[0].sourceLayer||"_geojsonTileLayer",A=n[b],k=e[b];if(!A||!k||Object.keys(k).length===0)continue;if(g.update(k,A,c,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof Q||g instanceof wd){const U=i.style._getSourceCache(g.layers[0].source);i._terrain&&i._terrain.enabled&&U&&g.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(U.id,this.tileID)}const O=i&&i.style&&i.style.getLayer(f);O&&(this.queryPadding=Math.max(this.queryPadding,O.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<vo.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=vo.now()+e}setTexture(e,i){const n=i.context,c=n.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new wm(n,e,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE))}setDependencies(e,i){const n={};for(const c of i)n[c]=!0;this.dependencies[e]=n}hasDependency(e,i){for(const n of e){const c=this.dependencies[n];if(c){for(const f of i)if(c[f])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const n=la(Xv,this.tileID.canonical,this.tileTransform)[0],c=new Mt,f=new Nn;for(let g=0;g<n.length;g++){const{x:b,y:A}=n[g];c.emplaceBack(b,A),f.emplaceBack(g)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(c,Lo.members),this._tileDebugSegments=us.simpleSegment(0,0,c.length,f.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const n=la(Xv,this.tileID.canonical,this.tileTransform)[0];let c,f;if(this.isRaster){const g=function(b,A){const k=Id(b,A),O=Math.pow(2,b.z);for(let ce=0;ce<Zl;ce++)for(let _e=0;_e<Zl;_e++){const Me=co((b.x+(_e+Hv(_e))/Ca)/O),ye=sn((b.y+(ce+Hv(ce))/Ca)/O),Se=A.project(Me,ye),Le=ce*Zl+_e;Yl[2*Le+0]=Math.round((Se.x*k.scale-k.x)*pi),Yl[2*Le+1]=Math.round((Se.y*k.scale-k.y)*pi)}Kh.fill(0),m_.fill(0);for(let ce=2045;ce>=0;ce--){const _e=4*ce,Me=Yh[_e+0],ye=Yh[_e+1],Se=Yh[_e+2],Le=Yh[_e+3],ke=Me+Se>>1,nt=ye+Le>>1,tt=ke+nt-ye,mt=nt+Me-ke,zt=ye*Zl+Me,at=Le*Zl+Se,bt=nt*Zl+ke,wt=Math.hypot((Yl[2*zt+0]+Yl[2*at+0])/2-Yl[2*bt+0],(Yl[2*zt+1]+Yl[2*at+1])/2-Yl[2*bt+1])>=16;Kh[bt]=Kh[bt]||(wt?1:0),ce<1022&&(Kh[bt]=Kh[bt]||Kh[(ye+mt>>1)*Zl+(Me+tt>>1)]||Kh[(Le+mt>>1)*Zl+(Se+tt>>1)])}const U=new gt,V=new di;let H=0;function Z(ce,_e){const Me=_e*Zl+ce;return m_[Me]===0&&(U.emplaceBack(Yl[2*Me+0],Yl[2*Me+1],ce*pi/Ca,_e*pi/Ca),m_[Me]=++H),m_[Me]-1}function ee(ce,_e,Me,ye,Se,Le){const ke=ce+Me>>1,nt=_e+ye>>1;if(Math.abs(ce-Se)+Math.abs(_e-Le)>1&&Kh[nt*Zl+ke])ee(Se,Le,ce,_e,ke,nt),ee(Me,ye,Se,Le,ke,nt);else{const tt=Z(ce,_e),mt=Z(Me,ye),zt=Z(Se,Le);V.emplaceBack(tt,mt,zt)}}return ee(0,0,Ca,Ca,Ca,0),ee(Ca,Ca,0,0,0,Ca),{vertices:U,indices:V}}(this.tileID.canonical,i);c=g.vertices,f=g.indices}else{c=new gt,f=new di;for(const{x:b,y:A}of n)c.emplaceBack(b,A,0,0);const g=am(c.int16,void 0,4);for(let b=0;b<g.length;b+=3)f.emplaceBack(g[b],g[b+1],g[b+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,qv.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=us.simpleSegment(0,0,c.length,f.length)}_makeGlobeTileDebugBuffers(e,i){const n=i.projection;if(!n||n.name!=="globe"||i.freezeTileCoverage)return;const c=this.tileID.canonical,f=Bc(qf(c,i)),g=Oh(i.zoom);let b;g>0&&(b=vp(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,c,i,f,b,g),this._makeGlobeTileDebugTextBuffer(e,c,i,f,b,g)}_globePoint(e,i,n,c,f,g,b){let A=cd(e,i,n);if(g){const k=1<<n.z,O=oa(c.center.lng),U=Ro(c.center.lat),V=(n.x+.5)/k-O;let H=0;V>.5?H=-1:V<-.5&&(H=1);let Z=(e/pi+n.x)/k+H,ee=(i/pi+n.y)/k;Z=(Z-O)*c._pixelsPerMercatorPixel+O,ee=(ee-U)*c._pixelsPerMercatorPixel+U;const ce=[Z*c.worldSize,ee*c.worldSize,0];Qr(ce,ce,g),A=na(A,ce,b)}return Qr(A,A,f)}_makeGlobeTileDebugBorderBuffer(e,i,n,c,f,g){const b=new Mt,A=new Nn,k=new et,O=(V,H,Z,ee,ce)=>{const _e=(Z-V)/(ce-1),Me=(ee-H)/(ce-1),ye=b.length;for(let Se=0;Se<ce;Se++){const Le=V+Se*_e,ke=H+Se*Me;b.emplaceBack(Le,ke);const nt=this._globePoint(Le,ke,i,n,c,f,g);k.emplaceBack(nt[0],nt[1],nt[2]),A.emplaceBack(ye+Se)}},U=pi;O(0,0,U,0,16),O(U,0,U,U,16),O(U,U,0,U,16),O(0,U,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(A),this._tileDebugBuffer=e.createVertexBuffer(b,Lo.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(k,wg.members),this._tileDebugSegments=us.simpleSegment(0,0,b.length,A.length)}_makeGlobeTileDebugTextBuffer(e,i,n,c,f,g){const b=pi/4,A=new Mt,k=new di,O=new et,U=25;k.reserve(32),A.reserve(U),O.reserve(U);const V=(H,Z)=>U*H+Z;for(let H=0;H<U;H++){const Z=H*b;for(let ee=0;ee<U;ee++){const ce=ee*b;A.emplaceBack(ce,Z);const _e=this._globePoint(ce,Z,i,n,c,f,g);O.emplaceBack(_e[0],_e[1],_e[2])}}for(let H=0;H<4;H++)for(let Z=0;Z<4;Z++){const ee=V(H,Z),ce=V(H,Z+1),_e=V(H+1,Z),Me=V(H+1,Z+1);k.emplaceBack(ee,ce,_e),k.emplaceBack(_e,ce,Me)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(k),this._tileDebugTextBuffer=e.createVertexBuffer(A,Lo.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(O,wg.members),this._tileDebugTextSegments=us.simpleSegment(0,0,U,32)}}class bS{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,n){const c=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},br(this.stateChanges[e][c],n),this.deletedStates[e]===null){this.deletedStates[e]={};for(const f in this.state[e])f!==c&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const f in this.state[e][c])n[f]||(this.deletedStates[e][c][f]=null)}else for(const f in n)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][f]===null&&delete this.deletedStates[e][c][f]}removeFeatureState(e,i,n){if(this.deletedStates[e]===null)return;const c=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&i!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][n]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(n in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][n]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,i){const n=String(i),c=br({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const f=this.deletedStates[e][i];if(f===null)return{};for(const g in f)delete c[g]}return c}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const n={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const f={};for(const g in this.stateChanges[c])this.state[c][g]||(this.state[c][g]={}),br(this.state[c][g],this.stateChanges[c][g]),f[g]=this.state[c][g];n[c]=f}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const f={};if(this.deletedStates[c]===null)for(const g in this.state[c])f[g]={},this.state[c][g]={};else for(const g in this.deletedStates[c]){if(this.deletedStates[c][g]===null)this.state[c][g]={};else if(this.state[c][g])for(const b of Object.keys(this.deletedStates[c][g]))delete this.state[c][g][b];f[g]=this.state[c][g]}n[c]=n[c]||{},br(n[c],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(n).length!==0)for(const c in e)e[c].setFeatureState(n,i)}}class Zv{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const n=this.toIdx(e,i);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function Yv(t,e,i,n){let c=0,f=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(n[g])<1e-15){if(i[g]<t[g]||i[g]>e[g])return null}else{const b=1/n[g];let A=(t[g]-i[g])*b,k=(e[g]-i[g])*b;if(A>k){const O=A;A=k,k=O}if(A>c&&(c=A),k<f&&(f=k),c>f)return null}return c}function Kv(t,e,i,n,c,f,g,b,A,k,O){const U=n-t,V=c-e,H=f-i,Z=g-t,ee=b-e,ce=A-i,_e=O[1]*ce-O[2]*ee,Me=O[2]*Z-O[0]*ce,ye=O[0]*ee-O[1]*Z,Se=U*_e+V*Me+H*ye;if(Math.abs(Se)<1e-15)return null;const Le=1/Se,ke=k[0]-t,nt=k[1]-e,tt=k[2]-i,mt=(ke*_e+nt*Me+tt*ye)*Le;if(mt<0||mt>1)return null;const zt=nt*H-tt*V,at=tt*U-ke*H,bt=ke*V-nt*U,wt=(O[0]*zt+O[1]*at+O[2]*bt)*Le;return wt<0||mt+wt>1?null:(Z*zt+ee*at+ce*bt)*Le}function Jv(t,e,i){return(t-e)/(i-e)}function Qv(t,e,i,n,c,f,g,b,A){const k=1<<i,O=f-n,U=g-c,V=(t+1)/k*O+n,H=(e+0)/k*U+c,Z=(e+1)/k*U+c;b[0]=(t+0)/k*O+n,b[1]=H,A[0]=V,A[1]=Z}class eb{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(f){const g=Math.ceil(Math.log2(f.dim/8)),b=[];let A=Math.ceil(Math.pow(2,g));const k=1/A,O=(H,Z,ee,ce,_e)=>{const Me=ce?1:0,ye=(H+1)*ee-Me,Se=Z*ee,Le=(Z+1)*ee-Me;_e[0]=H*ee,_e[1]=Se,_e[2]=ye,_e[3]=Le};let U=new Zv(A);const V=[];for(let H=0;H<A*A;H++){O(H%A,Math.floor(H/A),k,!1,V);const Z=Jh(V[0],V[1],f),ee=Jh(V[2],V[1],f),ce=Jh(V[2],V[3],f),_e=Jh(V[0],V[3],f);U.minimums.push(Math.min(Z,ee,ce,_e)),U.maximums.push(Math.max(Z,ee,ce,_e)),U.leaves.push(1)}for(b.push(U),A/=2;A>=1;A/=2){const H=b[b.length-1];U=new Zv(A);for(let Z=0;Z<A*A;Z++){O(Z%A,Math.floor(Z/A),2,!0,V);const ee=H.getElevation(V[0],V[1]),ce=H.getElevation(V[2],V[1]),_e=H.getElevation(V[2],V[3]),Me=H.getElevation(V[0],V[3]),ye=H.isLeaf(V[0],V[1]),Se=H.isLeaf(V[2],V[1]),Le=H.isLeaf(V[2],V[3]),ke=H.isLeaf(V[0],V[3]),nt=Math.min(ee.min,ce.min,_e.min,Me.min),tt=Math.max(ee.max,ce.max,_e.max,Me.max),mt=ye&&Se&&Le&&ke;U.maximums.push(tt),U.minimums.push(nt),U.leaves.push(tt-nt<=5&&mt?1:0)}b.push(U)}return b}(this.dem),n=i.length-1,c=i[n];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,n,0)}raycastRoot(e,i,n,c,f,g,b=1){return Yv([e,i,-100],[n,c,this.maximums[0]*b],f,g)}raycast(e,i,n,c,f,g,b=1){if(!this.nodeCount)return null;const A=this.raycastRoot(e,i,n,c,f,g,b);if(A==null)return null;const k=[],O=[],U=[],V=[],H=[{idx:0,t:A,nodex:0,nodey:0,depth:0}];for(;H.length>0;){const{idx:Z,t:ee,nodex:ce,nodey:_e,depth:Me}=H.pop();if(this.leaves[Z]){Qv(ce,_e,Me,e,i,n,c,U,V);const Se=1<<Me,Le=(ce+0)/Se,ke=(ce+1)/Se,nt=(_e+0)/Se,tt=(_e+1)/Se,mt=Jh(Le,nt,this.dem)*b,zt=Jh(ke,nt,this.dem)*b,at=Jh(ke,tt,this.dem)*b,bt=Jh(Le,tt,this.dem)*b,wt=Kv(U[0],U[1],mt,V[0],U[1],zt,V[0],V[1],at,f,g),Ct=Kv(V[0],V[1],at,U[0],V[1],bt,U[0],U[1],mt,f,g),Nt=Math.min(wt!==null?wt:Number.MAX_VALUE,Ct!==null?Ct:Number.MAX_VALUE);if(Nt!==Number.MAX_VALUE)return Nt;{const dt=id([],f,g,ee);if(tb(mt,zt,bt,at,Jv(dt[0],U[0],V[0]),Jv(dt[1],U[1],V[1]))>=dt[2])return ee}continue}let ye=0;for(let Se=0;Se<this._siblingOffset.length;Se++){Qv((ce<<1)+this._siblingOffset[Se][0],(_e<<1)+this._siblingOffset[Se][1],Me+1,e,i,n,c,U,V),U[2]=-100,V[2]=this.maximums[this.childOffsets[Z]+Se]*b;const Le=Yv(U,V,f,g);if(Le!=null){const ke=Le;k[Se]=ke;let nt=!1;for(let tt=0;tt<ye&&!nt;tt++)ke>=k[O[tt]]&&(O.splice(tt,0,Se),nt=!0);nt||(O[ye]=Se),ye++}}for(let Se=0;Se<ye;Se++){const Le=O[Se];H.push({idx:this.childOffsets[Z]+Le,t:k[Le],nodex:(ce<<1)+this._siblingOffset[Le][0],nodey:(_e<<1)+this._siblingOffset[Le][1],depth:Me+1})}}return null}_addNode(e,i,n){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,n,c,f){if(e[c].isLeaf(i,n)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const g=c-1,b=e[g];let A=0,k=0;for(let O=0;O<this._siblingOffset.length;O++){const U=2*i+this._siblingOffset[O][0],V=2*n+this._siblingOffset[O][1],H=b.getElevation(U,V),Z=b.isLeaf(U,V),ee=this._addNode(H.min,H.max,Z);Z&&(A|=1<<O),k||(k=ee)}for(let O=0;O<this._siblingOffset.length;O++)A&1<<O||this._construct(e,2*i+this._siblingOffset[O][0],2*n+this._siblingOffset[O][1],g,k+O)}}function tb(t,e,i,n,c,f){return nr(nr(t,i,f),nr(e,n,f),c)}function Jh(t,e,i){const n=i.dim,c=vi(t*n-.5,0,n-1),f=vi(e*n-.5,0,n-1),g=Math.floor(c),b=Math.floor(f),A=Math.min(g+1,n-1),k=Math.min(b+1,n-1);return tb(i.get(g,b),i.get(A,b),i.get(g,k),i.get(A,k),c-g,f-b)}const ib={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function wS(t,e,i){return(256*t*256+256*e+i)/10-1e4}function TS(t,e,i){return 256*t+e+i/256-32768}class g_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,n,c=!1,f=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return Tt(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const g=this.dim=i.height-2,b=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=n||"mapbox",this.borderReady=c,!c){for(let A=0;A<g;A++)b[this._idx(-1,A)]=b[this._idx(0,A)],b[this._idx(g,A)]=b[this._idx(g-1,A)],b[this._idx(A,-1)]=b[this._idx(A,0)],b[this._idx(A,g)]=b[this._idx(A,g-1)];b[this._idx(-1,-1)]=b[this._idx(0,0)],b[this._idx(g,-1)]=b[this._idx(g-1,0)],b[this._idx(-1,g)]=b[this._idx(0,g-1)],b[this._idx(g,g)]=b[this._idx(g-1,g-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new eb(this)}get(e,i,n=!1){n&&(e=vi(e,-1,this.dim),i=vi(i,-1,this.dim));const c=4*this._idx(e,i);return(this.encoding==="terrarium"?TS:wS)(this.pixels[c],this.pixels[c+1],this.pixels[c+2])}static getUnpackVector(e){return ib[e]}get unpackVector(){return ib[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const n=[0,0,0,0],c=g_.getUnpackVector(i);let f=Math.floor((e+c[3])/c[2]);return n[2]=f%256,f=Math.floor(f/256),n[1]=f%256,f=Math.floor(f/256),n[0]=f,n}getPixels(){return new Gn({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,f=i*this.dim+this.dim,g=n*this.dim,b=n*this.dim+this.dim;switch(i){case-1:c=f-1;break;case 1:f=c+1}switch(n){case-1:g=b-1;break;case 1:b=g+1}const A=-i*this.dim,k=-n*this.dim;for(let O=g;O<b;O++)for(let U=c;U<f;U++){const V=4*this._idx(U,O),H=4*this._idx(U+A,O+k);this.pixels[V+0]=e.pixels[H+0],this.pixels[V+1]=e.pixels[H+1],this.pixels[V+2]=e.pixels[H+2],this.pixels[V+3]=e.pixels[H+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ni(g_,"DEMData"),ni(eb,"DemMinMaxQuadTree",{omit:["dem"]});class ES{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,n){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const f={value:i,timeout:void 0};if(n!==void 0&&(f.timeout=setTimeout(()=>{this.remove(e,f)},n)),this.data[c].push(f),this.order.push(c),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const n=e.wrapped().key,c=i===void 0?0:this.data[n].indexOf(i),f=this.data[n][c];return this.data[n].splice(c,1),f.timeout&&clearTimeout(f.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(f.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const n in this.data)for(const c of this.data[n])e(c.value)||i.push(c);for(const n of i)this.remove(n.value.tileID,n)}}class Kp{constructor(e,i,n){this.func=e,this.mask=i,this.range=n}}Kp.ReadOnly=!1,Kp.ReadWrite=!0,Kp.disabled=new Kp(519,Kp.ReadOnly,[0,1]);const Ex=7680;class Sx{constructor(e,i,n,c,f,g){this.test=e,this.ref=i,this.mask=n,this.fail=c,this.depthFail=f,this.pass=g}}Sx.disabled=new Sx({func:519,mask:0},0,0,Ex,Ex,Ex);class Kl{constructor(e,i,n){this.blendFunction=e,this.blendColor=i,this.mask=n}}Kl.Replace=[1,0],Kl.disabled=new Kl(Kl.Replace,cs.transparent,[!1,!1,!1,!1]),Kl.unblended=new Kl(Kl.Replace,cs.transparent,[!0,!0,!0,!0]),Kl.alphaBlended=new Kl([1,771],cs.transparent,[!0,!0,!0,!0]);const Ax=1029,Mx=2305;class sl{constructor(e,i,n){this.enable=e,this.mode=i,this.frontFace=n}}sl.disabled=new sl(!1,Ax,Mx),sl.backCCW=new sl(!0,Ax,Mx),sl.backCW=new sl(!0,Ax,2304),sl.frontCW=new sl(!0,1028,2304),sl.frontCCW=new sl(!0,1028,Mx);class Ld extends Dr{constructor(e,i,n){super(),this.id=e,this._onlySymbols=n,i.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new ES(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new bS,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const n=this._tiles[i];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return Ts(this._tiles).map(e=>e.tileID).sort(rb).map(e=>e.key)}getRenderableIds(e){const i=[];for(const n in this._tiles)this._isIdRenderable(+n,e)&&i.push(this._tiles[n]);return e?i.sort((n,c)=>{const f=n.tileID,g=c.tileID,b=new Ge(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),A=new Ge(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-g.overscaledZ||A.y-b.y||A.x-b.x}).map(n=>n.tileID.key):i.map(n=>n.tileID).sort(rb).map(n=>n.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const n=this._tiles[e];n&&(n.state!=="loading"&&(n.state=i),this._loadTile(n,this._tileLoaded.bind(this,n,e,i)))}_tileLoaded(e,i,n,c){if(c)if(e.state="errored",c.status!==404)this._source.fire(new Go(c,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=vo.now(),n==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new bo("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let c=0;c<i.length;c++){const f=i[c];if(e.neighboringTiles&&e.neighboringTiles[f]){const g=this.getTileByID(f);n(e,g),n(g,e)}}function n(c,f){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let g=f.tileID.canonical.x-c.tileID.canonical.x;const b=f.tileID.canonical.y-c.tileID.canonical.y,A=Math.pow(2,c.tileID.canonical.z),k=f.tileID.key;g===0&&b===0||Math.abs(b)>1||(Math.abs(g)>1&&(Math.abs(g+A)===1?g+=A:Math.abs(g-A)===1&&(g-=A)),f.dem&&c.dem&&(c.dem.backfillBorder(f.dem,g,b),c.neighboringTiles&&c.neighboringTiles[k]&&(c.neighboringTiles[k].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,n,c){for(const f in this._tiles){let g=this._tiles[f];if(c[f]||!g.hasData()||g.tileID.overscaledZ<=i||g.tileID.overscaledZ>n)continue;let b=g.tileID;for(;g&&g.tileID.overscaledZ>i+1;){const k=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[k.key],g&&g.hasData()&&(b=k)}let A=b;for(;A.overscaledZ>i;)if(A=A.scaledTo(A.overscaledZ-1),e[A.key]){c[b.key]=b;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=i?n:null}for(let n=e.overscaledZ-1;n>=i;n--){const c=e.scaledTo(n),f=this._getLoadedTile(c);if(f)return f}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const n=Math.ceil(e.width/i)+1,c=Math.ceil(e.height/i)+1,f=Math.floor(n*c*5),g=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,f):f,b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(b)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const n={};for(const c in this._tiles){const f=this._tiles[c];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+i),n[f.tileID.key]=f}this._tiles=n;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,i,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!n)return;let c;this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new x(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(c=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(b=>this._source.hasTile(b)))):c=[];const f=this._updateRetainedTiles(c);if(sb(this._source.type)&&c.length!==0){const b={},A={},k=Object.keys(f);for(const U of k){const V=f[U],H=this._tiles[U];if(!H||H.fadeEndTime&&H.fadeEndTime<=vo.now())continue;const Z=this.findLoadedParent(V,Math.max(V.overscaledZ-Ld.maxOverzooming,this._source.minzoom));Z&&(this._addTile(Z.tileID),b[Z.tileID.key]=Z.tileID),A[U]=V}const O=c[c.length-1].overscaledZ;for(const U in this._tiles){const V=this._tiles[U];if(f[U]||!V.hasData())continue;let H=V.tileID;for(;H.overscaledZ>O;){H=H.scaledTo(H.overscaledZ-1);const Z=this._tiles[H.key];if(Z&&Z.hasData()&&A[H.key]){f[U]=V.tileID;break}}}for(const U in b)f[U]||(this._coveredTiles[U]=!0,f[U]=b[U])}for(const b in f)this._tiles[b].clearFadeHold();const g=function(b,A){const k=[];for(const O in b)O in A||k.push(O);return k}(this._tiles,f);for(const b of g){const A=this._tiles[b];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const n={},c=e.reduce((k,O)=>Math.min(k,O.overscaledZ),1/0),f=e[0].overscaledZ,g=Math.max(f-Ld.maxOverzooming,this._source.minzoom),b=Math.max(f+Ld.maxUnderzooming,this._source.minzoom),A={};for(const k of e){const O=this._addTile(k);i[k.key]=k,O.hasData()||c<this._source.maxzoom&&(A[k.key]=k)}this._retainLoadedChildren(A,c,b,i);for(const k of e){let O=this._tiles[k.key];if(O.hasData())continue;if(k.canonical.z>=this._source.maxzoom){const V=k.children(this._source.maxzoom)[0],H=this.getTile(V);if(H&&H.hasData()){i[V.key]=V;continue}}else{const V=k.children(this._source.maxzoom);if(i[V[0].key]&&i[V[1].key]&&i[V[2].key]&&i[V[3].key])continue}let U=O.wasRequested();for(let V=k.overscaledZ-1;V>=g;--V){const H=k.scaledTo(V);if(n[H.key]||(n[H.key]=!0,O=this.getTile(H),!O&&U&&(O=this._addTile(H)),O&&(i[H.key]=H,U=O.wasRequested(),O.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let n,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){n=this._loadedParentTiles[c.key];break}i.push(c.key);const f=c.scaledTo(c.overscaledZ-1);if(n=this._getLoadedTile(f),n)break;c=f}for(const f of i)this._loadedParentTiles[f]=n}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const n=!!i;if(!n){const c=this.map?this.map.painter:null;i=new Tx(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,c,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,n||this._source.fire(new bo("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=i.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,n){const c=[],f=this.transform;if(!f)return c;const g=f.projection.name==="globe",b=oa(f.center.lng);for(const A in this._tiles){const k=this._tiles[A];if(n&&k.clearQueryDebugViz(),k.holdingForFade())continue;let O;if(g){const U=k.tileID.canonical;if(U.z===0){const V=[Math.abs(vi(b,...Tm(U,-1))-b),Math.abs(vi(b,...Tm(U,1))-b)];O=[0,2*V.indexOf(Math.min(...V))-1]}else{const V=[Math.abs(vi(b,...Tm(U,-1))-b),Math.abs(vi(b,...Tm(U,0))-b),Math.abs(vi(b,...Tm(U,1))-b)];O=[V.indexOf(Math.min(...V))-1]}}else O=[0];for(const U of O){const V=e.containsTile(k,f,i,U);V&&c.push(V)}}return c}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(n=>this._tiles[n].tileID);for(const n of i)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(sb(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=vo.now())return!0}return!1}setFeatureState(e,i,n){this._state.updateState(e=e||"_geojsonTileLayer",i,n)}removeFeatureState(e,i,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,n)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,n){const c=this._tiles[e];c&&c.setDependencies(i,n)}reloadTilesForDependencies(e,i){for(const n in this._tiles)this._tiles[n].hasDependency(e,i)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(e,i))}_preloadTiles(e,i){if(!this._sourceLoaded){const b=()=>{this._sourceLoaded&&(this._source.off("data",b),this._preloadTiles(e,i))};return void this._source.on("data",b)}const n=new Map,c=Array.isArray(e)?e:[e],f=this.map.painter.terrain,g=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const b of c){const A=b.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const k of A)n.set(k.key,k);this.usedForTerrain&&b.updateElevation(!1)}fr(Array.from(n.values()),(b,A)=>{const k=new Tx(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(k,O=>{this._source.type==="raster-dem"&&k.dem&&this._backfillDEM(k),A(O,k)})},i)}}function rb(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||n-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function sb(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function Tm(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}Ld.maxOverzooming=10,Ld.maxUnderzooming=3;class __{constructor(e,i,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=n}static create(e,i,n){const c=n||e.findDEMTileFor(i);if(!c||!c.dem)return;const f=c.dem,g=c.tileID,b=1<<i.canonical.z-g.canonical.z;return new __(c,c.tileSize/pi/b,[(i.canonical.x/b-g.canonical.x)*f.dim,(i.canonical.y/b-g.canonical.y)*f.dim])}tileCoordToPixel(e,i){const n=i*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(n);return new Ge(c,f)}getElevationAt(e,i,n,c){const f=e*this._scale+this._offset[0],g=i*this._scale+this._offset[1],b=Math.floor(f),A=Math.floor(g),k=this._dem;return c=!!c,n?nr(nr(k.get(b,A,c),k.get(b,A+1,c),g-A),nr(k.get(b+1,A,c),k.get(b+1,A+1,c),g-A),f-b):k.get(b,A,c)}getElevationAtPixel(e,i,n){return this._dem.get(e,i,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*aa(1,e)*this._dem.stride}}class nb{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new qa(pi,16,0),this.featureIndexArray=new Fl,this.promoteId=i}insert(e,i,n,c,f,g=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,c,f,g);const A=this.grid;for(let k=0;k<i.length;k++){const O=i[k],U=[1/0,1/0,-1/0,-1/0];for(let V=0;V<O.length;V++){const H=O[V];U[0]=Math.min(U[0],H.x),U[1]=Math.min(U[1],H.y),U[2]=Math.max(U[2],H.x),U[3]=Math.max(U[3],H.y)}U[0]<pi&&U[1]<pi&&U[2]>=0&&U[3]>=0&&A.insert(b,U[0],U[1],U[2],U[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new pm(new i_(this.rawTileData)).layers,this.sourceLayerCoder=new $v(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,n,c){this.loadVTLayers();const f=e.params||{},g=wh(f.filter),b=e.tileResult,A=e.transform,k=b.bufferedTilespaceBounds,O=this.grid.query(k.min.x,k.min.y,k.max.x,k.max.y,(Z,ee,ce,_e)=>md(b.bufferedTilespaceGeometry,Z,ee,ce,_e));O.sort(SS);let U=null;A.elevation&&O.length>0&&(U=__.create(A.elevation,this.tileID));const V={};let H;for(let Z=0;Z<O.length;Z++){const ee=O[Z];if(ee===H)continue;H=ee;const ce=this.featureIndexArray.get(ee);let _e=null;this.loadMatchingFeature(V,ce,g,f.layers,f.availableImages,i,n,c,(Me,ye,Se,Le=0)=>(_e||(_e=la(Me,this.tileID.canonical,e.tileTransform)),ye.queryIntersectsFeature(b,Me,Se,_e,this.z,e.transform,e.pixelPosMatrix,U,Le)))}return V}loadMatchingFeature(e,i,n,c,f,g,b,A,k){const{featureIndex:O,bucketIndex:U,sourceLayerIndex:V,layoutVertexArrayOffset:H}=i,Z=this.bucketLayerIDs[U];if(c&&!function(Me,ye){for(let Se=0;Se<Me.length;Se++)if(ye.indexOf(Me[Se])>=0)return!0;return!1}(c,Z))return;const ee=this.sourceLayerCoder.decode(V),ce=this.vtLayers[ee].feature(O);if(n.needGeometry){const Me=Fc(ce,!0);if(!n.filter(new F(this.tileID.overscaledZ),Me,this.tileID.canonical))return}else if(!n.filter(new F(this.tileID.overscaledZ),ce))return;const _e=this.getId(ce,ee);for(let Me=0;Me<Z.length;Me++){const ye=Z[Me];if(c&&c.indexOf(ye)<0)continue;const Se=g[ye];if(!Se)continue;let Le={};_e!==void 0&&A&&(Le=A.getState(Se.sourceLayer||"_geojsonTileLayer",_e));const ke=br({},b[ye]);ke.paint=ob(ke.paint,Se.paint,ce,Le,f),ke.layout=ob(ke.layout,Se.layout,ce,Le,f);const nt=!k||k(ce,Se,Le,H);if(!nt)continue;const tt=new Wv(ce,this.z,this.x,this.y,_e);tt.layer=ke;let mt=e[ye];mt===void 0&&(mt=e[ye]=[]),mt.push({featureIndex:O,feature:tt,intersectionZ:nt})}}lookupSymbolFeatures(e,i,n,c,f,g,b,A){const k={};this.loadVTLayers();const O=wh(f);for(const U of e)this.loadMatchingFeature(k,{bucketIndex:n,sourceLayerIndex:c,featureIndex:U,layoutVertexArrayOffset:0},O,g,b,A,i);return k}loadFeature(e){const{featureIndex:i,sourceLayerIndex:n}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(n),f=this.vtFeatures[c];if(f[i])return f[i];const g=this.vtLayers[c].feature(i);return f[i]=g,g}hasLayer(e){for(const i of this.bucketLayerIDs)for(const n of i)if(e===n)return!0;return!1}getId(e,i){let n=e.id;if(this.promoteId){const c=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];c!=null&&(n=e.properties[c]),typeof n=="boolean"&&(n=Number(n))}return n}}function ob(t,e,i,n,c){return gi(t,(f,g)=>{const b=e instanceof ge?e.get(g):null;return b&&b.evaluate?b.evaluate(i,n,c):b})}function SS(t,e){return e-t}ni(nb,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class ab{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new il({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const n=this.getKey(e,i);return this.positions[n]}trim(){const e=this.width,i=this.height=ci(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,n){const c=[];let f=e.length%2==1?-e[e.length-1]*n:0,g=e[0]*n,b=!0;c.push({left:f,right:g,isDash:b,zeroLength:e[0]===0});let A=e[0];for(let k=1;k<e.length;k++){b=!b;const O=e[k];f=A*n,A+=O,g=A*n,c.push({left:f,right:g,isDash:b,zeroLength:O===0})}return c}addRoundDash(e,i,n){const c=i/2;for(let f=-n;f<=n;f++){const g=this.width*(this.nextRow+n+f);let b=0,A=e[b];for(let k=0;k<this.width;k++){k/A.right>1&&(A=e[++b]);const O=Math.abs(k-A.left),U=Math.abs(k-A.right),V=Math.min(O,U);let H;const Z=f/n*(c+1);if(A.isDash){const ee=c-Math.abs(Z);H=Math.sqrt(V*V+ee*ee)}else H=c-Math.sqrt(V*V+Z*Z);this.image.data[g+k]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(e,i){for(let A=e.length-1;A>=0;--A){const k=e[A],O=e[A+1];k.zeroLength?e.splice(A,1):O&&O.isDash===k.isDash&&(O.left=k.left,e.splice(A,1))}const n=e[0],c=e[e.length-1];n.isDash===c.isDash&&(n.left=c.left-this.width,c.right=n.right+this.width);const f=this.width*this.nextRow;let g=0,b=e[g];for(let A=0;A<this.width;A++){A/b.right>1&&(b=e[++g]);const k=Math.abs(A-b.left),O=Math.abs(A-b.right),U=Math.min(k,O);this.image.data[f+A]=Math.max(0,Math.min(255,(b.isDash?U:-U)+i+128))}}addDash(e,i){const n=this.getKey(e,i);if(this.positions[n])return this.positions[n];const c=i==="round",f=c?7:0,g=2*f+1;if(this.nextRow+g>this.height)return Tt("LineAtlas out of space"),null;e.length===0&&e.push(1);let b=0;for(let O=0;O<e.length;O++)e[O]<0&&(Tt("Negative value is found in line dasharray, replacing values with 0"),e[O]=0),b+=e[O];if(b!==0){const O=this.width/b,U=this.getDashRanges(e,this.width,O);c?this.addRoundDash(U,O,f):this.addRegularDash(U,i==="square"?.5*O:0)}const A=this.nextRow+f;this.nextRow+=g;const k={tl:[A,f],br:[b,0]};return this.positions[n]=k,k}}ni(ab,"LineAtlas");const lb=1*rl;class cb{constructor(e){const i={},n=[];for(const b in e){const A=e[b],k=i[b]={};for(const O in A.glyphs){const U=A.glyphs[+O];if(!U||U.bitmap.width===0||U.bitmap.height===0)continue;const V=U.metrics.localGlyph?lb:1,H={x:0,y:0,w:U.bitmap.width+2*V,h:U.bitmap.height+2*V};n.push(H),k[O]=H}}const{w:c,h:f}=ux(n),g=new il({width:c||1,height:f||1});for(const b in e){const A=e[b];for(const k in A.glyphs){const O=A.glyphs[+k];if(!O||O.bitmap.width===0||O.bitmap.height===0)continue;const U=i[b][k],V=O.metrics.localGlyph?lb:1;il.copy(O.bitmap,g,{x:0,y:0},{x:U.x+V,y:U.y+V},O.bitmap)}}this.image=g,this.positions=i}}ni(cb,"GlyphAtlas");class AS{constructor(e){this.tileID=new x(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Id(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,n,c,f){this.status="parsing",this.data=e,this.collisionBoxArray=new Lr;const g=new $v(Object.keys(e.layers).sort()),b=new nb(this.tileID,this.promoteId);b.bucketLayerIDs=[];const A={},k=new ab(256,256),O={featureIndex:b,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:k,availableImages:n},U=i.familiesBySource[this.source];for(const Le in U){const ke=e.layers[Le];if(!ke)continue;let nt=!1,tt=!1;for(const at of U[Le])at[0].type==="symbol"?nt=!0:tt=!0;if(this.isSymbolTile===!0&&!nt||this.isSymbolTile===!1&&!tt)continue;ke.version===1&&Tt(`Vector tile source "${this.source}" layer "${Le}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const mt=g.encode(Le),zt=[];for(let at=0;at<ke.length;at++){const bt=ke.feature(at),wt=b.getId(bt,Le);zt.push({feature:bt,id:wt,index:at,sourceLayerIndex:mt})}for(const at of U[Le]){const bt=at[0];this.isSymbolTile!==void 0&&bt.type==="symbol"!==this.isSymbolTile||bt.minzoom&&this.zoom<Math.floor(bt.minzoom)||bt.maxzoom&&this.zoom>=bt.maxzoom||bt.visibility!=="none"&&(Cx(at,this.zoom,n),(A[bt.id]=bt.createBucket({index:b.bucketLayerIDs.length,layers:at,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:mt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:n})).populate(zt,O,this.tileID.canonical,this.tileTransform),b.bucketLayerIDs.push(at.map(wt=>wt.id)))}}let V,H,Z,ee;k.trim();const ce={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},_e=()=>{if(V)return f(V);if(H&&Z&&ee){const Le=new cb(H),ke=new gv(Z,ee);for(const nt in A){const tt=A[nt];tt instanceof Zh?(Cx(tt.layers,this.zoom,n),JE(tt,H,Le.positions,Z,ke.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection)):tt.hasPattern&&(tt instanceof Q||tt instanceof wd||tt instanceof Ad)&&(Cx(tt.layers,this.zoom,n),tt.addFeatures(O,this.tileID.canonical,ke.patternPositions,n,this.tileTransform))}this.status="done",f(null,{buckets:Ts(A).filter(nt=>!nt.isEmpty()),featureIndex:b,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Le.image,lineAtlas:k,imageAtlas:ke,glyphMap:this.returnDependencies?H:null,iconMap:this.returnDependencies?Z:null,glyphPositions:this.returnDependencies?Le.positions:null})}},Me=gi(O.glyphDependencies,Le=>Object.keys(Le).map(Number));Object.keys(Me).length?c.send("getGlyphs",{uid:this.uid,stacks:Me},(Le,ke)=>{V||(V=Le,H=ke,_e())},void 0,!1,ce):H={};const ye=Object.keys(O.iconDependencies);ye.length?c.send("getImages",{icons:ye,source:this.source,tileID:this.tileID,type:"icons"},(Le,ke)=>{V||(V=Le,Z=ke,_e())},void 0,!1,ce):Z={};const Se=Object.keys(O.patternDependencies);Se.length?c.send("getImages",{icons:Se,source:this.source,tileID:this.tileID,type:"patterns"},(Le,ke)=>{V||(V=Le,ee=ke,_e())},void 0,!1,ce):ee={},_e()}}function Cx(t,e,i){const n=new F(e);for(const c of t)c.recalculate(n,i)}class hb{constructor(e){this.entries={},this.scheduler=e}request(e,i,n,c){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[g,b]=f.result;return this.scheduler?this.scheduler.add(()=>{c(g,b)},i):c(g,b),()=>{}}return f.callbacks.push(c),f.cancel||(f.cancel=n((g,b)=>{f.result=[g,b];for(const A of f.callbacks)this.scheduler?this.scheduler.add(()=>{A(g,b)},i):A(g,b);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(g=>g!==c),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function ub(t,e,i){const n=JSON.stringify(t.request);return t.data&&(this.deduped.entries[n]={result:[null,t.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},c=>{const f=Ws(t.request,(g,b,A,k)=>{g?c(g):b&&c(null,{vectorTile:i?void 0:new pm(new i_(b)),rawData:b,cacheControl:A,expires:k})});return()=>{f.cancel(),c()}},e)}const db=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class kx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,n]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=n>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const f=db[15&n];if(!f)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new kx(b,g,f,e)}constructor(e,i=64,n=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=db.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,A=(8-b%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${n}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+A,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+b+A),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+A,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=i,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Px(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,n,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:g,nodeSize:b}=this,A=[0,f.length-1,0],k=[];for(;A.length;){const O=A.pop()||0,U=A.pop()||0,V=A.pop()||0;if(U-V<=b){for(let ce=V;ce<=U;ce++){const _e=g[2*ce],Me=g[2*ce+1];_e>=e&&_e<=n&&Me>=i&&Me<=c&&k.push(f[ce])}continue}const H=V+U>>1,Z=g[2*H],ee=g[2*H+1];Z>=e&&Z<=n&&ee>=i&&ee<=c&&k.push(f[H]),(O===0?e<=Z:i<=ee)&&(A.push(V),A.push(H-1),A.push(1-O)),(O===0?n>=Z:c>=ee)&&(A.push(H+1),A.push(U),A.push(1-O))}return k}within(e,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:f,nodeSize:g}=this,b=[0,c.length-1,0],A=[],k=n*n;for(;b.length;){const O=b.pop()||0,U=b.pop()||0,V=b.pop()||0;if(U-V<=g){for(let ce=V;ce<=U;ce++)fb(f[2*ce],f[2*ce+1],e,i)<=k&&A.push(c[ce]);continue}const H=V+U>>1,Z=f[2*H],ee=f[2*H+1];fb(Z,ee,e,i)<=k&&A.push(c[H]),(O===0?e-n<=Z:i-n<=ee)&&(b.push(V),b.push(H-1),b.push(1-O)),(O===0?e+n>=Z:i+n>=ee)&&(b.push(H+1),b.push(U),b.push(1-O))}return A}}function Px(t,e,i,n,c,f){if(c-n<=i)return;const g=n+c>>1;pb(t,e,g,n,c,f),Px(t,e,i,n,g-1,1-f),Px(t,e,i,g+1,c,1-f)}function pb(t,e,i,n,c,f){for(;c>n;){if(c-n>600){const k=c-n+1,O=i-n+1,U=Math.log(k),V=.5*Math.exp(2*U/3),H=.5*Math.sqrt(U*V*(k-V)/k)*(O-k/2<0?-1:1);pb(t,e,i,Math.max(n,Math.floor(i-O*V/k+H)),Math.min(c,Math.floor(i+(k-O)*V/k+H)),f)}const g=e[2*i+f];let b=n,A=c;for(Em(t,e,n,i),e[2*c+f]>g&&Em(t,e,n,c);b<A;){for(Em(t,e,b,A),b++,A--;e[2*b+f]<g;)b++;for(;e[2*A+f]>g;)A--}e[2*n+f]===g?Em(t,e,n,A):(A++,Em(t,e,A,c)),A<=i&&(n=A+1),i<=A&&(c=A-1)}}function Em(t,e,i,n){Ix(t,i,n),Ix(e,2*i,2*n),Ix(e,2*i+1,2*n+1)}function Ix(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}function fb(t,e,i,n){const c=t-i,f=e-n;return c*c+f*f}o.ARRAY_TYPE=Un,o.AUTH_ERR_MSG=De,o.Aabb=Xs,o.Actor=class{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},fi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ei()?t:X,this.scheduler=new xS}send(t,e,i,n,c=!1,f){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=f,this.callbacks[g]=i);const b=Gt(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:t,hasCallback:!!i,targetMapId:n,mustQueue:c,sourceMapId:this.mapId,data:Xa(e,b)},b),{cancel:()=>{i&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const n=this.cancelCallbacks[i];delete this.cancelCallbacks[i],n&&n.cancel()}else if(e.mustQueue||ei()){const n=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),n&&n.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if(e.type==="<response>"){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(ba(e.error)):i(null,ba(e.data)))}else{const i=Gt(this.globalScope)?void 0:[],n=e.hasCallback?(f,g)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:f?Xa(f):null,data:Xa(g,i)},i)}:f=>{},c=ba(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,c,n);else if(this.parent.getWorkerSource){const f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],c.source)[f[1]](c,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=p,o.Color=cs,o.ColorMode=Kl,o.CullFaceMode=sl,o.DEMData=g_,o.DataConstantProperty=J,o.DedupedRequest=hb,o.DepthMode=Kp,o.EXTENT=pi,o.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,n=1<<i,c=Math.floor(t.x),f=Math.floor((t.x-c)*n),g=Math.floor(t.y*n),b=this.findDEMTileFor(new x(i,c,i,f,g));return!(!b||!b.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const n=this._source();if(!n||t.y<0||t.y>1)return e;const c=n.getSource().maxzoom,f=1<<c,g=Math.floor(t.x),b=t.x-g,A=new x(c,g,c,Math.floor(b*f),Math.floor(t.y*f)),k=this.findDEMTileFor(A);if(!k||!k.dem)return e;const O=k.dem,U=1<<k.tileID.canonical.z,V=(b*U-k.tileID.canonical.x)*O.dim,H=(t.y*U-k.tileID.canonical.y)*O.dim,Z=Math.floor(V),ee=Math.floor(H);return(i?this.exaggeration():1)*nr(nr(O.get(Z,ee),O.get(Z,ee+1),H-ee),nr(O.get(Z+1,ee),O.get(Z+1,ee+1),H-ee),V-Z)}getAtTileOffset(t,e,i){const n=1<<t.canonical.z;return this.getAtPointOrZero(new Bh(t.wrap+(t.canonical.x+e/pi)/n,(t.canonical.y+i/pi)/n))}getAtTileOffsetFunc(t,e,i,n){return c=>{const f=this.getAtTileOffset(t,c.x,c.y),g=n.upVector(t.canonical,c.x,c.y);return jn(g,g,f*n.upVectorScale(t.canonical,e,i).metersToTile),g}}getForTilePoints(t,e,i,n){if(this.isUsingMockSource())return!1;const c=__.create(this,t,n);return!!c&&(e.forEach(f=>{f[2]=this.exaggeration()*c.getElevationAt(f[0],f[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,n=e.tileID,c=1<<t.canonical.z-n.canonical.z;let f=t.canonical.x/c-n.canonical.x,g=t.canonical.y/c-n.canonical.y,b=0;for(let A=0;A<t.canonical.z-n.canonical.z&&!i.leaves[b];A++){f*=2,g*=2;const k=2*Math.floor(g)+Math.floor(f);b=i.childOffsets[b]+k,f%=1,g%=1}return{min:this.exaggeration()*i.minimums[b],max:this.exaggeration()*i.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=Go,o.EvaluationParameters=F,o.Event=bo,o.Evented=Dr,o.FillExtrusionBucket=Ad,o.Frustum=Ea,o.FrustumCorners=Hf,o.GLOBE_RADIUS=Sa,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=Mp,o.GLOBE_ZOOM_THRESHOLD_MIN=nd,o.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_fillGridMeshWithLods(t,e){const i=new Mt,n=new di,c=[],f=t+1+2,g=e[0]+1,b=e[0]+1+(1+e.length),A=(k,O,U)=>{let V=k===f-1?k-2:k===0?k:k-1;return V+=U?24575:0,[V,O]};for(let k=0;k<f;++k)i.emplaceBack(...A(k,0,!0));for(let k=0;k<g;++k)for(let O=0;O<f;++O)i.emplaceBack(...A(O,k,(O===0||O===f-1)&&!0));for(let k=0;k<e.length;++k){const O=e[k];for(let U=0;U<f;++U)i.emplaceBack(...A(U,O,!0))}for(let k=0;k<e.length;++k){const O=n.length,U=e[k]+1+2,V=new di;for(let ee=0;ee<U-1;ee++){const ce=ee===U-2,_e=ce?f*(b-e.length+k-ee):f;for(let Me=0;Me<f-1;Me++){const ye=ee*f+Me;ee===0||ce||Me===0||Me===f-2?(V.emplaceBack(ye+1,ye,ye+_e),V.emplaceBack(ye+_e,ye+_e+1,ye+1)):(n.emplaceBack(ye+1,ye,ye+_e),n.emplaceBack(ye+_e,ye+_e+1,ye+1))}}const H=us.simpleSegment(0,O,i.length,n.length-O);for(let ee=0;ee<V.uint16.length;ee+=3)n.emplaceBack(V.uint16[ee],V.uint16[ee+1],V.uint16[ee+2]);const Z=us.simpleSegment(0,O,i.length,n.length-O);c.push({withoutSkirts:H,withSkirts:Z})}return{vertices:i,indices:n,segments:c}}_createGrid(t){const e=this._fillGridMeshWithLods(Gl,od);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Lo.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new di;for(let c=0;c<=Gl;c++)e.emplaceBack(0,c+1,c+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new Ar,n=new Ar;this._poleSegments=[];for(let c=0,f=0;c<nd;c++){const g=360/(1<<c);i.emplaceBack(0,-Sa,0,.5,0),n.emplaceBack(0,-Sa,0,.5,1);for(let b=0;b<=Gl;b++){const A=b/Gl,k=nr(0,g,A),[O,U,V]=Oc(Fy,Ny,k,Sa);i.emplaceBack(O,U,V,A,0),n.emplaceBack(O,U,V,A,1)}this._poleSegments.push(us.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,bg,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(n,bg,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const i=new Gs,n=Gl,c=n+1+2,f=1;this._wireframeSegments=[];for(let g=0,b=0;g<od.length;g++){const A=od[g];for(let O=f;O<A+f;O++)for(let U=f;U<n+f;U++){const V=O*c+U;i.emplaceBack(V,V+1),i.emplaceBack(V,V+c),i.emplaceBack(V,V+c+1)}const k=A*n*3;this._wireframeSegments.push(us.simpleSegment(0,b,(A+1)*c,k)),b+=k}this._wireframeIndexBuffer=t.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},o.GlyphManager=qp,o.ImagePosition=dx,o.KDBush=kx,o.LivePerformanceUtils=Xd,o.LngLat=Mr,o.LngLatBounds=qs,o.LocalGlyphMode=mx,o.MAX_MERCATOR_LATITUDE=ho,o.MercatorCoordinate=Bh,o.ONE_EM=At,o.OverscaledTileID=x,o.PerformanceMarkers=ls,o.Point=Ge,o.Properties=be,o.RGBAImage=Gn,o.Ray=Wf,o.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ae,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Fe(t))return t;const i=Ht(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Fe(t))return t;const i=Ht(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,n){if(!Fe(t))return t;const c=Ht(t);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),i&&c.params.push(`language=${i}`),n&&c.params.push(`worldview=${n}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,n){const c=Ht(t);return Fe(t)?(c.path=`/styles/v1${c.path}/sprite${e}${i}`,this._makeAPIURL(c,this._customAccessToken||n)):(c.path+=`${e}${i}`,Dt(c))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Fe(t))return t;const n=Ht(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&n.authority!=="raster"&&i===512?"@2x":""}${Te.supported?".webp":"$1"}`),n.authority==="raster"?n.path=`/${xe.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${xe.TILE_URL_VERSION}${n.path}`);const c=this._customAccessToken||function(f){for(const g of f){const b=g.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(n.params)||xe.ACCESS_TOKEN;return xe.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,c)}canonicalizeTileURL(t,e){const i=Ht(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let n="mapbox://";i.path.match(/^\/raster\/v1\//)?n+=`raster/${i.path.replace(`/${xe.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${i.path.replace(`/${xe.TILE_URL_VERSION}/`,"")}`;let c=i.params;return e&&(c=c.filter(f=>!f.match(/^access_token=/))),c.length&&(n+=`?${c.join("&")}`),n}canonicalizeTileset(t,e){const i=!!e&&Fe(e),n=[];for(const c of t.tiles||[])Qe(c)?n.push(this.canonicalizeTileURL(c,i)):n.push(c);return n}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=Ht(xe.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,t.protocol==="http"){const c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if(n.path!=="/"&&(t.path=`${n.path}${t.path}`),!xe.REQUIRE_ACCESS_TOKEN)return Dt(t);if(e=e||xe.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(c=>c.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Dt(t)}},o.ResourceType=hn,o.SegmentVector=us,o.SourceCache=Ld,o.StencilMode=Sx,o.StructArrayLayout1ui2=Nn,o.StructArrayLayout2f1f2i16=_i,o.StructArrayLayout2i4=Mt,o.StructArrayLayout2ui4=Gs,o.StructArrayLayout3f12=Bi,o.StructArrayLayout3ui6=di,o.StructArrayLayout4i8=gt,o.StructArrayLayout5f20=Ar,o.Texture=wm,o.Tile=Tx,o.Transitionable=K,o.Uniform1f=Ms,o.Uniform1i=class extends wa{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.Uniform2f=class extends wa{constructor(t){super(t),this.current=[0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},o.Uniform3f=class extends wa{constructor(t){super(t),this.current=[0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},o.Uniform4f=pg,o.UniformColor=Ih,o.UniformMatrix2f=class extends wa{constructor(t){super(t),this.current=Py}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let n=0;n<4;n++)if(i[n]!==this.current[n]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}},o.UniformMatrix3f=class extends wa{constructor(t){super(t),this.current=hs}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let n=0;n<9;n++)if(i[n]!==this.current[n]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.UniformMatrix4f=class extends wa{constructor(t){super(t),this.current=Vf}set(t,e,i){if(this.fetchUniformLocation(t,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let n=1;n<16;n++)if(i[n]!==this.current[n]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},o.UnwrappedTileID=y,o.ValidationError=ti,o.VectorTileFeature=Td,o.VectorTileWorkerSource=class extends Dr{constructor(t,e,i,n,c){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=c||ub,this.loading={},this.loaded={},this.deduped=new hb(t.scheduler),this.isSpriteLoaded=n,this.scheduler=t.scheduler}loadTile(t,e){const i=t.uid,n=t&&t.request,c=n&&n.collectResourceTiming,f=this.loading[i]=new AS(t);f.abort=this.loadVectorData(t,(g,b)=>{const A=!this.loading[i];if(delete this.loading[i],A||g||!b)return f.status="done",A||(this.loaded[i]=f),e(g);const k=b.rawData,O={};b.expires&&(O.expires=b.expires),b.cacheControl&&(O.cacheControl=b.cacheControl),f.vectorTile=b.vectorTile||new pm(new i_(k));const U=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(V,H)=>{if(V||!H)return e(V);const Z={};if(c){const ee=gu(n);ee.length>0&&(Z.resourceTiming=JSON.parse(JSON.stringify(ee)))}e(null,br({rawTileData:k.slice(0)},H,O,Z))})};this.isSpriteLoaded?U():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(U,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):U()}),this.loaded=this.loaded||{},this.loaded[i]=f})}reloadTile(t,e){const i=this.loaded,n=t.uid,c=this;if(i&&i[n]){const f=i[n];f.showCollisionBoxes=t.showCollisionBoxes,f.enableTerrain=!!t.enableTerrain,f.projection=t.projection,f.tileTransform=Id(t.tileID.canonical,t.projection);const g=(b,A)=>{const k=f.reloadCallback;k&&(delete f.reloadCallback,f.parse(f.vectorTile,c.layerIndex,this.availableImages,c.actor,k)),e(b,A)};f.status==="parsing"?f.reloadCallback=g:f.status==="done"&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(t,e){const i=t.uid,n=this.loading[i];n&&(n.abort&&n.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,n=t.uid;i&&i[n]&&delete i[n],e()}},o.WritingMode=ha,o.ZoomDependentExpression=Wa,o.add=sa,o.addDynamicAttributes=p_,o.adjoint=function(t,e){var i=e[0],n=e[1],c=e[2],f=e[3],g=e[4],b=e[5],A=e[6],k=e[7],O=e[8];return t[0]=g*O-b*k,t[1]=c*k-n*O,t[2]=n*b-c*g,t[3]=b*A-f*O,t[4]=i*O-c*A,t[5]=c*f-i*b,t[6]=f*k-g*A,t[7]=n*A-i*k,t[8]=i*g-n*f,t},o.asyncAll=fr,o.bezier=yi,o.bindAll=fi,o.boundsAttributes=qv,o.bufferConvexPolygon=function(t,e){const i=[];for(let n=0;n<t.length;n++){const c=Tr(n-1,-1,t.length-1),f=Tr(n+1,-1,t.length-1),g=t[n],b=t[f],A=t[c].sub(g).unit(),k=b.sub(g).unit(),O=k.angleWithSep(A.x,A.y),U=A.add(k).unit().mult(-1*e/Math.sin(O/2));i.push(g.add(U))}return i},o.cacheEntryPossiblyAdded=function(t){ir++,ir>er&&(t.getActor().send("enforceCacheSizeLimit",Pi),ir=0)},o.calculateGlobeLabelMatrix=function(t,e){const{x:i,y:n}=t.point,c=Mg(i,n,t.worldSize/t._pixelsPerMercatorPixel,0,0);return el(c,c,Xf(Do(e)))},o.calculateGlobeMatrix=function(t){const{x:e,y:i}=t.point,{lng:n,lat:c}=t._center;return Mg(e,i,t.worldSize,n,c)},o.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,i=e/aa(1,t.center.lat),n=oo(new Float64Array(16));return Qu(n,n,[t.point.x,t.point.y,0]),tl(n,n,[i,i,e]),Float32Array.from(n)},o.circumferenceAtLatitude=Yf,o.clamp=vi,o.clearTileCache=function(t){if(!Cs())return;const e=X.caches.delete(wi);t&&e.catch(t).then(()=>t())},o.clipLine=kv,o.clone=function(t){var e=new Un(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},o.clone$1=Ce,o.collisionCircleLayout=$t,o.config=xe,o.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},o.create=function(){var t=new Un(16);return Un!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},o.create$1=mg,o.createExpression=Ll,o.createLayout=$e,o.createStyleLayer=function(t){return t.type==="custom"?new mS(t):new _S[t.type](t)},o.cross=Ta,o.degToRad=jt,o.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},o.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},o.dot=Vn,o.earthRadius=hd,o.ease=xi,o.easeCubicInOut=li,o.ecefToLatLng=function([t,e,i]){const n=Math.hypot(t,e,i),c=Math.atan2(t,i),f=.5*Math.PI-Math.acos(-e/n);return new Mr(Ti(c),Ti(f))},o.emitValidationErrors=dp,o.endsWith=rr,o.enforceCacheSizeLimit=function(t){Zr(),tr&&tr.then(e=>{e.keys().then(i=>{for(let n=0;n<i.length-t;n++)e.delete(i[n])})})},o.evaluateSizeForFeature=Ii,o.evaluateSizeForZoom=hi,o.evaluateVariableOffset=Rv,o.evented=v,o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},o.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},o.exported=vo,o.exported$1=Te,o.extend=br,o.extend$1=wo,o.fillExtrusionHeightLift=t_,o.filterObject=me,o.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},o.fromQuat=function(t,e){var i=e[0],n=e[1],c=e[2],f=e[3],g=i+i,b=n+n,A=c+c,k=i*g,O=n*g,U=n*b,V=c*g,H=c*b,Z=c*A,ee=f*g,ce=f*b,_e=f*A;return t[0]=1-U-Z,t[1]=O+_e,t[2]=V-ce,t[3]=0,t[4]=O-_e,t[5]=1-k-Z,t[6]=H+ee,t[7]=0,t[8]=V+ce,t[9]=H-ee,t[10]=1-k-U,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.fromScaling=Gf,o.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return Qi[e]},o.getAABBPointSquareDist=function(t,e,i){let n=0;for(let c=0;c<2;++c){const f=i?i[c]:0;t[c]>f&&(n+=(t[c]-f)*(t[c]-f)),e[c]<f&&(n+=(f-e[c])*(f-e[c]))}return n},o.getAnchorAlignment=fx,o.getAnchorJustification=_x,o.getBounds=function(t){let e=1/0,i=1/0,n=-1/0,c=-1/0;for(const f of t)e=Math.min(e,f.x),i=Math.min(i,f.y),n=Math.max(n,f.x),c=Math.max(c,f.y);return{min:new Ge(e,i),max:new Ge(n,c)}},o.getColumn=Qt,o.getDefaultExportFromCjs=Be,o.getGridMatrix=function(t,e,i,n){const c=e.getNorth(),f=e.getSouth(),g=e.getWest(),b=e.getEast(),A=1<<t.z,k=b-g,O=c-f,U=k/Gl,V=-O/od[i],H=[0,U,0,V,0,0,c,g,0];if(t.z>0){const Z=180/n;gg(H,H,[Z/k+1,0,0,0,Z/O+1,0,-.5*Z/U,.5*Z/V,1])}return H[2]=A,H[5]=t.x,H[8]=t.y,H},o.getImage=we,o.getJSON=function(t,e){return Fs(br(t,{type:"json"}),e)},o.getLatitudinalLod=function(t){const e=ho-5;t=vi(t,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(jt(t))),3);return Math.round(i*(od.length-1))},o.getMapSessionAPI=As,o.getPerformanceMeasurement=gu,o.getProjection=Vv,o.getRTLTextPluginStatus=T,o.getReferrer=gs,o.getTilePoint=function(t,{x:e,y:i},n=0){return new Ge(((e-n)*t.scale-t.x)*pi,(i*t.scale-t.y)*pi)},o.getTileVec3=function(t,e,i=0){return Vl(((e.x-i)*t.scale-t.x)*pi,(e.y*t.scale-t.y)*pi,ud(e.z,e.y))},o.getVideo=function(t,e){const i=X.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let n=0;n<t.length;n++){const c=X.document.createElement("source");ml(t[n])||(i.crossOrigin="Anonymous"),c.src=t[n],i.appendChild(c)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(t){const e=[0,0,0],i=oo(new Float64Array(16));return el(i,t.pixelMatrix,t.globeMatrix),Qr(e,e,i),new Ge(e[0],e[1])},o.globeDenormalizeECEF=Xf,o.globeECEFOrigin=function(t,e){const i=[0,0,0];return Qr(i,i,Bc(Do(e.canonical))),Qr(i,i,t),i},o.globeMetersToEcef=Cp,o.globeNormalizeECEF=Bc,o.globePixelsToTileUnits=function(t,e){return pi/(512*Math.pow(2,t))*zh(Do(e))},o.globePoleMatrixForTile=function(t,e,i){const n=oo(new Float64Array(16)),c=(e/(1<<t)-.5)*Math.PI*2;return bp(n,i.globeMatrix,c),Float32Array.from(n)},o.globeTileBounds=Do,o.globeTiltAtLngLat=Cg,o.globeToMercatorTransition=Oh,o.globeUseCustomAntiAliasing=function(t,e,i){const n=Oh(i.zoom),c=t.style.map._antialias,f=!!e.extStandardDerivatives,g=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return n===0&&!c&&!g&&f},o.identity=oo,o.identity$1=rn,o.invert=vp,o.isFullscreen=function(){return!!X.document.fullscreenElement||!!X.document.webkitFullscreenElement},o.isLngLatBehindGlobe=Zf,o.isMapAuthenticated=function(t){return Zs.has(t)},o.isMapboxURL=Fe,o.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Gt(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=sn,o.latLngToECEF=Rh,o.len=Dh,o.length=Lh,o.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},o.lngFromMercatorX=co,o.loadVectorTile=ub,o.makeRequest=Fs,o.mapValue=function(t,e,i,n,c){return vi((t-e)/(i-e)*(c-n)+n,n,c)},o.mercatorScale=Kf,o.mercatorXfromLng=oa,o.mercatorYfromLat=Ro,o.mercatorZfromAltitude=aa,o.mul=td,o.mul$1=zy,o.multiply=el,o.multiply$1=gg,o.multiply$2=Ep,o.nextPowerOfTwo=ci,o.normalize=Tn,o.normalize$1=vg,o.normalize$2=sd,o.number=nr,o.ortho=function(t,e,i,n,c,f,g){var b=1/(e-i),A=1/(n-c),k=1/(f-g);return t[0]=-2*b,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*A,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*k,t[11]=0,t[12]=(e+i)*b,t[13]=(c+n)*A,t[14]=(g+f)*k,t[15]=1,t},o.pbf=lr,o.perspective=function(t,e,i,n,c){var f,g=1/Math.tan(e/2);return t[0]=g/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=g,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=(c+n)*(f=1/(n-c)),t[14]=2*c*n*f):(t[10]=-1,t[14]=-2*n),t},o.pick=function(t,e){const i={};for(let n=0;n<e.length;n++){const c=e[n];c in t&&(i[c]=t[c])}return i},o.plugin=I,o.pointGeometry=Ne,o.polesInViewport=function(t){const e=oo(new Float64Array(16));el(e,t.pixelMatrix,t.globeMatrix);const i=[0,lo,0],n=[0,Sn,0];return Qr(i,i,e),Qr(n,n,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!Zf(t,new Mr(t.center.lat,90)),n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Zf(t,new Mr(t.center.lat,-90))]},o.polygonContainsPoint=Aa,o.polygonIntersectsBox=md,o.polygonIntersectsPolygon=pd,o.polygonizeBounds=function(t,e,i=0,n=!0){const c=new Ge(i,i),f=t.sub(c),g=e.add(c),b=[f,new Ge(g.x,f.y),g,new Ge(f.x,g.y)];return n&&b.push(f.clone()),b},o.posAttributes=Lo,o.postMapLoadEvent=is,o.postPerformanceEvent=Ss,o.postTurnstileEvent=Ji,o.potpack=ux,o.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},o.radToDeg=Ti,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(t){return t({pluginStatus:d,pluginURL:r}),v.on("pluginStateChange",t),t},o.removeAuthState=function(t){Zs.delete(t)},o.renderColorRamp=tm,o.resample=kp,o.rotateX=ed,o.rotateX$1=xg,o.rotateY=bp,o.rotateY$1=$f,o.rotateZ=function(t,e,i){var n=Math.sin(i),c=Math.cos(i),f=e[0],g=e[1],b=e[2],A=e[3],k=e[4],O=e[5],U=e[6],V=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*c+k*n,t[1]=g*c+O*n,t[2]=b*c+U*n,t[3]=A*c+V*n,t[4]=k*c-f*n,t[5]=O*c-g*n,t[6]=U*c-b*n,t[7]=V*c-A*n,t},o.rotateZ$1=function(t,e,i){i*=.5;var n=e[0],c=e[1],f=e[2],g=e[3],b=Math.sin(i),A=Math.cos(i);return t[0]=n*A+c*b,t[1]=c*A-n*b,t[2]=f*A+g*b,t[3]=g*A-f*b,t},o.scale=tl,o.scale$1=yg,o.scale$2=jn,o.scaleAndAdd=id,o.set=function(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t},o.setCacheLimits=function(t,e){Pi=t,er=e},o.setColumn=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},o.setRTLTextPlugin=function(t,e,i=!1){if(d===Dc||d===Ch||d===Zu)throw new Error("setRTLTextPlugin cannot be called multiple times.");r=vo.resolveURL(t),d=Dc,Bl=e,m(),i||P()},o.smoothstep=ws,o.spec=ut,o.squaredLength=function(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n},o.storeAuthState=function(t,e){e?Zs.add(t):Zs.delete(t)},o.sub=ao,o.subtract=Tp,o.symbolSize=Li,o.tileAABB=function(t,e,i,n,c,f,g,b,A){if(A.name==="globe")return By(t,e,new p(i,n,c));const k=Id({z:i,x:n,y:c},A);return new Xs([(f+k.x/k.scale)*e,e*(k.y/k.scale),g],[(f+k.x2/k.scale)*e,e*(k.y2/k.scale),b])},o.tileCornersToBounds=ld,o.tileTransform=Id,o.transformMat3=function(t,e,i){var n=e[0],c=e[1],f=e[2];return t[0]=n*i[0]+c*i[3]+f*i[6],t[1]=n*i[1]+c*i[4]+f*i[7],t[2]=n*i[2]+c*i[5]+f*i[8],t},o.transformMat4=Qr,o.transformMat4$1=En,o.transformQuat=gr,o.transitionTileAABBinECEF=qf,o.translate=Qu,o.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],c=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=c}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},o.triggerPluginCompletionEvent=l,o.uniqueId=Es,o.updateGlobeVertexNormal=function(t,e,i,n,c){const f=5*e+2;t.float32[f+0]=i,t.float32[f+1]=n,t.float32[f+2]=c},o.validateCustomStyleLayer=function(t){const e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFilter=t=>Fn(Pc(t)),o.validateFog=t=>Fn(hp(t)),o.validateLayer=t=>Fn(lp(t)),o.validateLight=t=>Fn(cp(t)),o.validateSource=t=>Fn(ju(t)),o.validateStyle=Lc,o.validateTerrain=t=>Fn(Vu(t)),o.values=Ts,o.vectorTile=$p,o.version=ie,o.warnOnce=Tt,o.window=X,o.wrap=Tr}),B(["./shared"],function(o){function X(Ee){if(typeof Ee=="number"||typeof Ee=="boolean"||typeof Ee=="string"||Ee==null)return JSON.stringify(Ee);if(Array.isArray(Ee)){let ne="[";for(const we of Ee)ne+=`${X(we)},`;return`${ne}]`}let se="{";for(const ne of Object.keys(Ee).sort())se+=`${ne}:${X(Ee[ne])},`;return`${se}}`}function ie(Ee){let se="";for(const ne of o.refProperties)se+=`/${X(Ee[ne])}`;return se}class oe{constructor(se){this.keyCache={},se&&this.replace(se)}replace(se){this._layerConfigs={},this._layers={},this.update(se,[])}update(se,ne){for(const De of se)this._layerConfigs[De.id]=De,(this._layers[De.id]=o.createStyleLayer(De)).compileFilter(),this.keyCache[De.id]&&delete this.keyCache[De.id];for(const De of ne)delete this.keyCache[De],delete this._layerConfigs[De],delete this._layers[De];this.familiesBySource={};const we=function(De,Fe){const Qe={};for(let Ve=0;Ve<De.length;Ve++){const Ye=Fe&&Fe[De[Ve].id]||ie(De[Ve]);Fe&&(Fe[De[Ve].id]=Ye);let Ft=Qe[Ye];Ft||(Ft=Qe[Ye]=[]),Ft.push(De[Ve])}const Ke=[];for(const Ve in Qe)Ke.push(Qe[Ve]);return Ke}(o.values(this._layerConfigs),this.keyCache);for(const De of we){const Fe=De.map(Ht=>this._layers[Ht.id]),Qe=Fe[0];if(Qe.visibility==="none")continue;const Ke=Qe.source||"";let Ve=this.familiesBySource[Ke];Ve||(Ve=this.familiesBySource[Ke]={});const Ye=Qe.sourceLayer||"_geojsonTileLayer";let Ft=Ve[Ye];Ft||(Ft=Ve[Ye]=[]),Ft.push(Fe)}}}class xe{loadTile(se,ne){const{uid:we,encoding:De,rawImageData:Fe,padding:Qe,buildQuadTree:Ke}=se,Ve=o.window.ImageBitmap&&Fe instanceof o.window.ImageBitmap?this.getImageData(Fe,Qe):Fe;ne(null,new o.DEMData(we,Ve,De,Qe<1,Ke))}getImageData(se,ne){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(se.width,se.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=se.width,this.offscreenCanvas.height=se.height,this.offscreenCanvasContext.drawImage(se,0,0,se.width,se.height);const we=this.offscreenCanvasContext.getImageData(-ne,-ne,se.width+2*ne,se.height+2*ne);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),we}}function Te(Ee,se){if(Ee.length!==0){je(Ee[0],se);for(var ne=1;ne<Ee.length;ne++)je(Ee[ne],!se)}}function je(Ee,se){for(var ne=0,we=0,De=0,Fe=Ee.length,Qe=Fe-1;De<Fe;Qe=De++){var Ke=(Ee[De][0]-Ee[Qe][0])*(Ee[Qe][1]+Ee[De][1]),Ve=ne+Ke;we+=Math.abs(ne)>=Math.abs(Ke)?ne-Ve+Ke:Ke-Ve+ne,ne=Ve}ne+we>=0!=!!se&&Ee.reverse()}var We=o.getDefaultExportFromCjs(function Ee(se,ne){var we,De=se&&se.type;if(De==="FeatureCollection")for(we=0;we<se.features.length;we++)Ee(se.features[we],ne);else if(De==="GeometryCollection")for(we=0;we<se.geometries.length;we++)Ee(se.geometries[we],ne);else if(De==="Feature")Ee(se.geometry,ne);else if(De==="Polygon")Te(se.coordinates,ne);else if(De==="MultiPolygon")for(we=0;we<se.coordinates.length;we++)Te(se.coordinates[we],ne);return se});const pt=o.VectorTileFeature.prototype.toGeoJSON;var yt={exports:{}},Ze=o.pointGeometry,Ae=o.vectorTile.VectorTileFeature,Be=He;function He(Ee,se){this.options=se||{},this.features=Ee,this.length=Ee.length}function lt(Ee,se){this.id=typeof Ee.id=="number"?Ee.id:void 0,this.type=Ee.type,this.rawGeometry=Ee.type===1?[Ee.geometry]:Ee.geometry,this.properties=Ee.tags,this.extent=se||4096}He.prototype.feature=function(Ee){return new lt(this.features[Ee],this.options.extent)},lt.prototype.loadGeometry=function(){var Ee=this.rawGeometry;this.geometry=[];for(var se=0;se<Ee.length;se++){for(var ne=Ee[se],we=[],De=0;De<ne.length;De++)we.push(new Ze(ne[De][0],ne[De][1]));this.geometry.push(we)}return this.geometry},lt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ee=this.geometry,se=1/0,ne=-1/0,we=1/0,De=-1/0,Fe=0;Fe<Ee.length;Fe++)for(var Qe=Ee[Fe],Ke=0;Ke<Qe.length;Ke++){var Ve=Qe[Ke];se=Math.min(se,Ve.x),ne=Math.max(ne,Ve.x),we=Math.min(we,Ve.y),De=Math.max(De,Ve.y)}return[se,we,ne,De]},lt.prototype.toGeoJSON=Ae.prototype.toGeoJSON;var kt=o.pbf,Ne=Be;function ht(Ee){var se=new kt;return function(ne,we){for(var De in ne.layers)we.writeMessage(3,Ge,ne.layers[De])}(Ee,se),se.finish()}function Ge(Ee,se){var ne;se.writeVarintField(15,Ee.version||1),se.writeStringField(1,Ee.name||""),se.writeVarintField(5,Ee.extent||4096);var we={keys:[],values:[],keycache:{},valuecache:{}};for(ne=0;ne<Ee.length;ne++)we.feature=Ee.feature(ne),se.writeMessage(2,ai,we);var De=we.keys;for(ne=0;ne<De.length;ne++)se.writeStringField(3,De[ne]);var Fe=we.values;for(ne=0;ne<Fe.length;ne++)se.writeMessage(4,li,Fe[ne])}function ai(Ee,se){var ne=Ee.feature;ne.id!==void 0&&se.writeVarintField(1,ne.id),se.writeMessage(2,Ot,Ee),se.writeVarintField(3,ne.type),se.writeMessage(4,Qi,ne)}function Ot(Ee,se){var ne=Ee.feature,we=Ee.keys,De=Ee.values,Fe=Ee.keycache,Qe=Ee.valuecache;for(var Ke in ne.properties){var Ve=ne.properties[Ke],Ye=Fe[Ke];if(Ve!==null){Ye===void 0&&(we.push(Ke),Fe[Ke]=Ye=we.length-1),se.writeVarint(Ye);var Ft=typeof Ve;Ft!=="string"&&Ft!=="boolean"&&Ft!=="number"&&(Ve=JSON.stringify(Ve));var Ht=Ft+":"+Ve,Dt=Qe[Ht];Dt===void 0&&(De.push(Ve),Qe[Ht]=Dt=De.length-1),se.writeVarint(Dt)}}}function jt(Ee,se){return(se<<3)+(7&Ee)}function Ti(Ee){return Ee<<1^Ee>>31}function Qi(Ee,se){for(var ne=Ee.loadGeometry(),we=Ee.type,De=0,Fe=0,Qe=ne.length,Ke=0;Ke<Qe;Ke++){var Ve=ne[Ke],Ye=1;we===1&&(Ye=Ve.length),se.writeVarint(jt(1,Ye));for(var Ft=we===3?Ve.length-1:Ve.length,Ht=0;Ht<Ft;Ht++){Ht===1&&we!==1&&se.writeVarint(jt(2,Ft-1));var Dt=Ve[Ht].x-De,Ri=Ve[Ht].y-Fe;se.writeVarint(Ti(Dt)),se.writeVarint(Ti(Ri)),De+=Dt,Fe+=Ri}we===3&&se.writeVarint(jt(7,1))}}function li(Ee,se){var ne=typeof Ee;ne==="string"?se.writeStringField(1,Ee):ne==="boolean"?se.writeBooleanField(7,Ee):ne==="number"&&(Ee%1!=0?se.writeDoubleField(3,Ee):Ee<0?se.writeSVarintField(6,Ee):se.writeVarintField(5,Ee))}yt.exports=ht,yt.exports.fromVectorTileJs=ht,yt.exports.fromGeojsonVt=function(Ee,se){se=se||{};var ne={};for(var we in Ee)ne[we]=new Ne(Ee[we].features,se),ne[we].name=we,ne[we].version=se.version,ne[we].extent=se.extent;return ht({layers:ne})},yt.exports.GeoJSONWrapper=Ne;var yi=o.getDefaultExportFromCjs(yt.exports);const xi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ee=>Ee},vi=Math.fround||(ws=new Float32Array(1),Ee=>(ws[0]=+Ee,ws[0]));var ws;const Tr=3,fr=5,Ts=6;class br{constructor(se){this.options=Object.assign(Object.create(xi),se),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(se){const{log:ne,minZoom:we,maxZoom:De}=this.options;ne&&console.time("total time");const Fe=`prepare ${se.length} points`;ne&&console.time(Fe),this.points=se;const Qe=[];for(let Ve=0;Ve<se.length;Ve++){const Ye=se[Ve];if(!Ye.geometry)continue;const[Ft,Ht]=Ye.geometry.coordinates,Dt=vi(St(Ft)),Ri=vi(ci(Ht));Qe.push(Dt,Ri,1/0,Ve,-1,1),this.options.reduce&&Qe.push(0)}let Ke=this.trees[De+1]=this._createTree(Qe);ne&&console.timeEnd(Fe);for(let Ve=De;Ve>=we;Ve--){const Ye=+Date.now();Ke=this.trees[Ve]=this._createTree(this._cluster(Ke,Ve)),ne&&console.log("z%d: %d clusters in %dms",Ve,Ke.numItems,+Date.now()-Ye)}return ne&&console.timeEnd("total time"),this}getClusters(se,ne){let we=((se[0]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,se[1]));let Fe=se[2]===180?180:((se[2]+180)%360+360)%360-180;const Qe=Math.max(-90,Math.min(90,se[3]));if(se[2]-se[0]>=360)we=-180,Fe=180;else if(we>Fe){const Ht=this.getClusters([we,De,180,Qe],ne),Dt=this.getClusters([-180,De,Fe,Qe],ne);return Ht.concat(Dt)}const Ke=this.trees[this._limitZoom(ne)],Ve=Ke.range(St(we),ci(Qe),St(Fe),ci(De)),Ye=Ke.data,Ft=[];for(const Ht of Ve){const Dt=this.stride*Ht;Ft.push(Ye[Dt+fr]>1?cn(Ye,Dt,this.clusterProps):this.points[Ye[Dt+Tr]])}return Ft}getChildren(se){const ne=this._getOriginId(se),we=this._getOriginZoom(se),De="No cluster with the specified id.",Fe=this.trees[we];if(!Fe)throw new Error(De);const Qe=Fe.data;if(ne*this.stride>=Qe.length)throw new Error(De);const Ke=this.options.radius/(this.options.extent*Math.pow(2,we-1)),Ve=Fe.within(Qe[ne*this.stride],Qe[ne*this.stride+1],Ke),Ye=[];for(const Ft of Ve){const Ht=Ft*this.stride;Qe[Ht+4]===se&&Ye.push(Qe[Ht+fr]>1?cn(Qe,Ht,this.clusterProps):this.points[Qe[Ht+Tr]])}if(Ye.length===0)throw new Error(De);return Ye}getLeaves(se,ne,we){const De=[];return this._appendLeaves(De,se,ne=ne||10,we=we||0,0),De}getTile(se,ne,we){const De=this.trees[this._limitZoom(se)],Fe=Math.pow(2,se),{extent:Qe,radius:Ke}=this.options,Ve=Ke/Qe,Ye=(we-Ve)/Fe,Ft=(we+1+Ve)/Fe,Ht={features:[]};return this._addTileFeatures(De.range((ne-Ve)/Fe,Ye,(ne+1+Ve)/Fe,Ft),De.data,ne,we,Fe,Ht),ne===0&&this._addTileFeatures(De.range(1-Ve/Fe,Ye,1,Ft),De.data,Fe,we,Fe,Ht),ne===Fe-1&&this._addTileFeatures(De.range(0,Ye,Ve/Fe,Ft),De.data,-1,we,Fe,Ht),Ht.features.length?Ht:null}getClusterExpansionZoom(se){let ne=this._getOriginZoom(se)-1;for(;ne<=this.options.maxZoom;){const we=this.getChildren(se);if(ne++,we.length!==1)break;se=we[0].properties.cluster_id}return ne}_appendLeaves(se,ne,we,De,Fe){const Qe=this.getChildren(ne);for(const Ke of Qe){const Ve=Ke.properties;if(Ve&&Ve.cluster?Fe+Ve.point_count<=De?Fe+=Ve.point_count:Fe=this._appendLeaves(se,Ve.cluster_id,we,De,Fe):Fe<De?Fe++:se.push(Ke),se.length===we)break}return Fe}_createTree(se){const ne=new o.KDBush(se.length/this.stride|0,this.options.nodeSize,Float32Array);for(let we=0;we<se.length;we+=this.stride)ne.add(se[we],se[we+1]);return ne.finish(),ne.data=se,ne}_addTileFeatures(se,ne,we,De,Fe,Qe){for(const Ke of se){const Ve=Ke*this.stride,Ye=ne[Ve+fr]>1;let Ft,Ht,Dt;if(Ye)Ft=Es(ne,Ve,this.clusterProps),Ht=ne[Ve],Dt=ne[Ve+1];else{const zi=this.points[ne[Ve+Tr]];Ft=zi.properties;const[Xi,Ji]=zi.geometry.coordinates;Ht=St(Xi),Dt=ci(Ji)}const Ri={type:1,geometry:[[Math.round(this.options.extent*(Ht*Fe-we)),Math.round(this.options.extent*(Dt*Fe-De))]],tags:Ft};let Si;Si=Ye||this.options.generateId?ne[Ve+Tr]:this.points[ne[Ve+Tr]].id,Si!==void 0&&(Ri.id=Si),Qe.features.push(Ri)}}_limitZoom(se){return Math.max(this.options.minZoom,Math.min(Math.floor(+se),this.options.maxZoom+1))}_cluster(se,ne){const{radius:we,extent:De,reduce:Fe,minPoints:Qe}=this.options,Ke=we/(De*Math.pow(2,ne)),Ve=se.data,Ye=[],Ft=this.stride;for(let Ht=0;Ht<Ve.length;Ht+=Ft){if(Ve[Ht+2]<=ne)continue;Ve[Ht+2]=ne;const Dt=Ve[Ht],Ri=Ve[Ht+1],Si=se.within(Ve[Ht],Ve[Ht+1],Ke),zi=Ve[Ht+fr];let Xi=zi;for(const Ji of Si){const Yr=Ji*Ft;Ve[Yr+2]>ne&&(Xi+=Ve[Yr+fr])}if(Xi>zi&&Xi>=Qe){let Ji,Yr=Dt*zi,is=Ri*zi,Hs=-1;const Ss=((Ht/Ft|0)<<5)+(ne+1)+this.points.length;for(const xo of Si){const As=xo*Ft;if(Ve[As+2]<=ne)continue;Ve[As+2]=ne;const Zs=Ve[As+fr];Yr+=Ve[As]*Zs,is+=Ve[As+1]*Zs,Ve[As+4]=Ss,Fe&&(Ji||(Ji=this._map(Ve,Ht,!0),Hs=this.clusterProps.length,this.clusterProps.push(Ji)),Fe(Ji,this._map(Ve,As)))}Ve[Ht+4]=Ss,Ye.push(Yr/Xi,is/Xi,1/0,Ss,-1,Xi),Fe&&Ye.push(Hs)}else{for(let Ji=0;Ji<Ft;Ji++)Ye.push(Ve[Ht+Ji]);if(Xi>1)for(const Ji of Si){const Yr=Ji*Ft;if(!(Ve[Yr+2]<=ne)){Ve[Yr+2]=ne;for(let is=0;is<Ft;is++)Ye.push(Ve[Yr+is])}}}}return Ye}_getOriginId(se){return se-this.points.length>>5}_getOriginZoom(se){return(se-this.points.length)%32}_map(se,ne,we){if(se[ne+fr]>1){const Qe=this.clusterProps[se[ne+Ts]];return we?Object.assign({},Qe):Qe}const De=this.points[se[ne+Tr]].properties,Fe=this.options.map(De);return we&&Fe===De?Object.assign({},Fe):Fe}}function cn(Ee,se,ne){return{type:"Feature",id:Ee[se+Tr],properties:Es(Ee,se,ne),geometry:{type:"Point",coordinates:[(we=Ee[se],360*(we-.5)),ri(Ee[se+1])]}};var we}function Es(Ee,se,ne){const we=Ee[se+fr],De=we>=1e4?`${Math.round(we/1e3)}k`:we>=1e3?Math.round(we/100)/10+"k":we,Fe=Ee[se+Ts],Qe=Fe===-1?{}:Object.assign({},ne[Fe]);return Object.assign(Qe,{cluster:!0,cluster_id:Ee[se+Tr],point_count:we,point_count_abbreviated:De})}function St(Ee){return Ee/360+.5}function ci(Ee){const se=Math.sin(Ee*Math.PI/180),ne=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return ne<0?0:ne>1?1:ne}function ri(Ee){const se=(180-360*Ee)*Math.PI/180;return 360*Math.atan(Math.exp(se))/Math.PI-90}function fi(Ee,se,ne,we){for(var De,Fe=we,Qe=ne-se>>1,Ke=ne-se,Ve=Ee[se],Ye=Ee[se+1],Ft=Ee[ne],Ht=Ee[ne+1],Dt=se+3;Dt<ne;Dt+=3){var Ri=rr(Ee[Dt],Ee[Dt+1],Ve,Ye,Ft,Ht);if(Ri>Fe)De=Dt,Fe=Ri;else if(Ri===Fe){var Si=Math.abs(Dt-Qe);Si<Ke&&(De=Dt,Ke=Si)}}Fe>we&&(De-se>3&&fi(Ee,se,De,we),Ee[De+2]=Fe,ne-De>3&&fi(Ee,De,ne,we))}function rr(Ee,se,ne,we,De,Fe){var Qe=De-ne,Ke=Fe-we;if(Qe!==0||Ke!==0){var Ve=((Ee-ne)*Qe+(se-we)*Ke)/(Qe*Qe+Ke*Ke);Ve>1?(ne=De,we=Fe):Ve>0&&(ne+=Qe*Ve,we+=Ke*Ve)}return(Qe=Ee-ne)*Qe+(Ke=se-we)*Ke}function gi(Ee,se,ne,we){var De={id:Ee===void 0?null:Ee,type:se,geometry:ne,tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Fe){var Qe=Fe.geometry,Ke=Fe.type;if(Ke==="Point"||Ke==="MultiPoint"||Ke==="LineString")me(Fe,Qe);else if(Ke==="Polygon"||Ke==="MultiLineString")for(var Ve=0;Ve<Qe.length;Ve++)me(Fe,Qe[Ve]);else if(Ke==="MultiPolygon")for(Ve=0;Ve<Qe.length;Ve++)for(var Ye=0;Ye<Qe[Ve].length;Ye++)me(Fe,Qe[Ve][Ye])}(De),De}function me(Ee,se){for(var ne=0;ne<se.length;ne+=3)Ee.minX=Math.min(Ee.minX,se[ne]),Ee.minY=Math.min(Ee.minY,se[ne+1]),Ee.maxX=Math.max(Ee.maxX,se[ne]),Ee.maxY=Math.max(Ee.maxY,se[ne+1])}function Ce(Ee,se,ne,we){if(se.geometry){var De=se.geometry.coordinates,Fe=se.geometry.type,Qe=Math.pow(ne.tolerance/((1<<ne.maxZoom)*ne.extent),2),Ke=[],Ve=se.id;if(ne.promoteId?Ve=se.properties[ne.promoteId]:ne.generateId&&(Ve=we||0),Fe==="Point")ct(De,Ke);else if(Fe==="MultiPoint")for(var Ye=0;Ye<De.length;Ye++)ct(De[Ye],Ke);else if(Fe==="LineString")Tt(De,Ke,Qe,!1);else if(Fe==="MultiLineString"){if(ne.lineMetrics){for(Ye=0;Ye<De.length;Ye++)Tt(De[Ye],Ke=[],Qe,!1),Ee.push(gi(Ve,"LineString",Ke,se.properties));return}xt(De,Ke,Qe,!1)}else if(Fe==="Polygon")xt(De,Ke,Qe,!0);else{if(Fe!=="MultiPolygon"){if(Fe==="GeometryCollection"){for(Ye=0;Ye<se.geometry.geometries.length;Ye++)Ce(Ee,{id:Ve,geometry:se.geometry.geometries[Ye],properties:se.properties},ne,we);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ye=0;Ye<De.length;Ye++){var Ft=[];xt(De[Ye],Ft,Qe,!0),Ke.push(Ft)}}Ee.push(gi(Ve,Fe,Ke,se.properties))}}function ct(Ee,se){se.push(Vt(Ee[0])),se.push(ei(Ee[1])),se.push(0)}function Tt(Ee,se,ne,we){for(var De,Fe,Qe=0,Ke=0;Ke<Ee.length;Ke++){var Ve=Vt(Ee[Ke][0]),Ye=ei(Ee[Ke][1]);se.push(Ve),se.push(Ye),se.push(0),Ke>0&&(Qe+=we?(De*Ye-Ve*Fe)/2:Math.sqrt(Math.pow(Ve-De,2)+Math.pow(Ye-Fe,2))),De=Ve,Fe=Ye}var Ft=se.length-3;se[2]=1,fi(se,0,Ft,ne),se[Ft+2]=1,se.size=Math.abs(Qe),se.start=0,se.end=se.size}function xt(Ee,se,ne,we){for(var De=0;De<Ee.length;De++){var Fe=[];Tt(Ee[De],Fe,ne,we),se.push(Fe)}}function Vt(Ee){return Ee/360+.5}function ei(Ee){var se=Math.sin(Ee*Math.PI/180),ne=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return ne<0?0:ne>1?1:ne}function Wt(Ee,se,ne,we,De,Fe,Qe,Ke){if(we/=se,Fe>=(ne/=se)&&Qe<we)return Ee;if(Qe<ne||Fe>=we)return null;for(var Ve=[],Ye=0;Ye<Ee.length;Ye++){var Ft=Ee[Ye],Ht=Ft.geometry,Dt=Ft.type,Ri=De===0?Ft.minX:Ft.minY,Si=De===0?Ft.maxX:Ft.maxY;if(Ri>=ne&&Si<we)Ve.push(Ft);else if(!(Si<ne||Ri>=we)){var zi=[];if(Dt==="Point"||Dt==="MultiPoint")qt(Ht,zi,ne,we,De);else if(Dt==="LineString")Gt(Ht,zi,ne,we,De,!1,Ke.lineMetrics);else if(Dt==="MultiLineString")Qt(Ht,zi,ne,we,De,!1);else if(Dt==="Polygon")Qt(Ht,zi,ne,we,De,!0);else if(Dt==="MultiPolygon")for(var Xi=0;Xi<Ht.length;Xi++){var Ji=[];Qt(Ht[Xi],Ji,ne,we,De,!0),Ji.length&&zi.push(Ji)}if(zi.length){if(Ke.lineMetrics&&Dt==="LineString"){for(Xi=0;Xi<zi.length;Xi++)Ve.push(gi(Ft.id,Dt,zi[Xi],Ft.tags));continue}Dt!=="LineString"&&Dt!=="MultiLineString"||(zi.length===1?(Dt="LineString",zi=zi[0]):Dt="MultiLineString"),Dt!=="Point"&&Dt!=="MultiPoint"||(Dt=zi.length===3?"Point":"MultiPoint"),Ve.push(gi(Ft.id,Dt,zi,Ft.tags))}}}return Ve.length?Ve:null}function qt(Ee,se,ne,we,De){for(var Fe=0;Fe<Ee.length;Fe+=3){var Qe=Ee[Fe+De];Qe>=ne&&Qe<=we&&(se.push(Ee[Fe]),se.push(Ee[Fe+1]),se.push(Ee[Fe+2]))}}function Gt(Ee,se,ne,we,De,Fe,Qe){for(var Ke,Ve,Ye=Ci(Ee),Ft=De===0?Pi:er,Ht=Ee.start,Dt=0;Dt<Ee.length-3;Dt+=3){var Ri=Ee[Dt],Si=Ee[Dt+1],zi=Ee[Dt+2],Xi=Ee[Dt+3],Ji=Ee[Dt+4],Yr=De===0?Ri:Si,is=De===0?Xi:Ji,Hs=!1;Qe&&(Ke=Math.sqrt(Math.pow(Ri-Xi,2)+Math.pow(Si-Ji,2))),Yr<ne?is>ne&&(Ve=Ft(Ye,Ri,Si,Xi,Ji,ne),Qe&&(Ye.start=Ht+Ke*Ve)):Yr>we?is<we&&(Ve=Ft(Ye,Ri,Si,Xi,Ji,we),Qe&&(Ye.start=Ht+Ke*Ve)):wi(Ye,Ri,Si,zi),is<ne&&Yr>=ne&&(Ve=Ft(Ye,Ri,Si,Xi,Ji,ne),Hs=!0),is>we&&Yr<=we&&(Ve=Ft(Ye,Ri,Si,Xi,Ji,we),Hs=!0),!Fe&&Hs&&(Qe&&(Ye.end=Ht+Ke*Ve),se.push(Ye),Ye=Ci(Ee)),Qe&&(Ht+=Ke)}var Ss=Ee.length-3;Ri=Ee[Ss],Si=Ee[Ss+1],zi=Ee[Ss+2],(Yr=De===0?Ri:Si)>=ne&&Yr<=we&&wi(Ye,Ri,Si,zi),Ss=Ye.length-3,Fe&&Ss>=3&&(Ye[Ss]!==Ye[0]||Ye[Ss+1]!==Ye[1])&&wi(Ye,Ye[0],Ye[1],Ye[2]),Ye.length&&se.push(Ye)}function Ci(Ee){var se=[];return se.size=Ee.size,se.start=Ee.start,se.end=Ee.end,se}function Qt(Ee,se,ne,we,De,Fe){for(var Qe=0;Qe<Ee.length;Qe++)Gt(Ee[Qe],se,ne,we,De,Fe,!1)}function wi(Ee,se,ne,we){Ee.push(se),Ee.push(ne),Ee.push(we)}function Pi(Ee,se,ne,we,De,Fe){var Qe=(Fe-se)/(we-se);return Ee.push(Fe),Ee.push(ne+(De-ne)*Qe),Ee.push(1),Qe}function er(Ee,se,ne,we,De,Fe){var Qe=(Fe-ne)/(De-ne);return Ee.push(se+(we-se)*Qe),Ee.push(Fe),Ee.push(1),Qe}function tr(Ee,se){for(var ne=[],we=0;we<Ee.length;we++){var De,Fe=Ee[we],Qe=Fe.type;if(Qe==="Point"||Qe==="MultiPoint"||Qe==="LineString")De=sr(Fe.geometry,se);else if(Qe==="MultiLineString"||Qe==="Polygon"){De=[];for(var Ke=0;Ke<Fe.geometry.length;Ke++)De.push(sr(Fe.geometry[Ke],se))}else if(Qe==="MultiPolygon")for(De=[],Ke=0;Ke<Fe.geometry.length;Ke++){for(var Ve=[],Ye=0;Ye<Fe.geometry[Ke].length;Ye++)Ve.push(sr(Fe.geometry[Ke][Ye],se));De.push(Ve)}ne.push(gi(Fe.id,Qe,De,Fe.tags))}return ne}function sr(Ee,se){var ne=[];ne.size=Ee.size,Ee.start!==void 0&&(ne.start=Ee.start,ne.end=Ee.end);for(var we=0;we<Ee.length;we+=3)ne.push(Ee[we]+se,Ee[we+1],Ee[we+2]);return ne}function Cs(Ee,se){if(Ee.transformed)return Ee;var ne,we,De,Fe=1<<Ee.z,Qe=Ee.x,Ke=Ee.y;for(ne=0;ne<Ee.features.length;ne++){var Ve=Ee.features[ne],Ye=Ve.geometry,Ft=Ve.type;if(Ve.geometry=[],Ft===1)for(we=0;we<Ye.length;we+=2)Ve.geometry.push(Zr(Ye[we],Ye[we+1],se,Fe,Qe,Ke));else for(we=0;we<Ye.length;we++){var Ht=[];for(De=0;De<Ye[we].length;De+=2)Ht.push(Zr(Ye[we][De],Ye[we][De+1],se,Fe,Qe,Ke));Ve.geometry.push(Ht)}}return Ee.transformed=!0,Ee}function Zr(Ee,se,ne,we,De,Fe){return[Math.round(ne*(Ee*we-De)),Math.round(ne*(se*we-Fe))]}function Bs(Ee,se,ne,we,De){for(var Fe=se===De.maxZoom?0:De.tolerance/((1<<se)*De.extent),Qe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ne,y:we,z:se,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ke=0;Ke<Ee.length;Ke++){Qe.numFeatures++,ir(Qe,Ee[Ke],Fe,De);var Ve=Ee[Ke].minX,Ye=Ee[Ke].minY,Ft=Ee[Ke].maxX,Ht=Ee[Ke].maxY;Ve<Qe.minX&&(Qe.minX=Ve),Ye<Qe.minY&&(Qe.minY=Ye),Ft>Qe.maxX&&(Qe.maxX=Ft),Ht>Qe.maxY&&(Qe.maxY=Ht)}return Qe}function ir(Ee,se,ne,we){var De=se.geometry,Fe=se.type,Qe=[];if(Fe==="Point"||Fe==="MultiPoint")for(var Ke=0;Ke<De.length;Ke+=3)Qe.push(De[Ke]),Qe.push(De[Ke+1]),Ee.numPoints++,Ee.numSimplified++;else if(Fe==="LineString")hn(Qe,De,Ee,ne,!1,!1);else if(Fe==="MultiLineString"||Fe==="Polygon")for(Ke=0;Ke<De.length;Ke++)hn(Qe,De[Ke],Ee,ne,Fe==="Polygon",Ke===0);else if(Fe==="MultiPolygon")for(var Ve=0;Ve<De.length;Ve++){var Ye=De[Ve];for(Ke=0;Ke<Ye.length;Ke++)hn(Qe,Ye[Ke],Ee,ne,!0,Ke===0)}if(Qe.length){var Ft=se.tags||null;if(Fe==="LineString"&&we.lineMetrics){for(var Ht in Ft={},se.tags)Ft[Ht]=se.tags[Ht];Ft.mapbox_clip_start=De.start/De.size,Ft.mapbox_clip_end=De.end/De.size}var Dt={geometry:Qe,type:Fe==="Polygon"||Fe==="MultiPolygon"?3:Fe==="LineString"||Fe==="MultiLineString"?2:1,tags:Ft};se.id!==null&&(Dt.id=se.id),Ee.features.push(Dt)}}function hn(Ee,se,ne,we,De,Fe){var Qe=we*we;if(we>0&&se.size<(De?Qe:we))ne.numPoints+=se.length/3;else{for(var Ke=[],Ve=0;Ve<se.length;Ve+=3)(we===0||se[Ve+2]>Qe)&&(ne.numSimplified++,Ke.push(se[Ve]),Ke.push(se[Ve+1])),ne.numPoints++;De&&function(Ye,Ft){for(var Ht=0,Dt=0,Ri=Ye.length,Si=Ri-2;Dt<Ri;Si=Dt,Dt+=2)Ht+=(Ye[Dt]-Ye[Si])*(Ye[Dt+1]+Ye[Si+1]);if(Ht>0===Ft)for(Dt=0,Ri=Ye.length;Dt<Ri/2;Dt+=2){var zi=Ye[Dt],Xi=Ye[Dt+1];Ye[Dt]=Ye[Ri-2-Dt],Ye[Dt+1]=Ye[Ri-1-Dt],Ye[Ri-2-Dt]=zi,Ye[Ri-1-Dt]=Xi}}(Ke,Fe),Ee.push(Ke)}}function Kn(Ee,se){var ne=(se=this.options=function(De,Fe){for(var Qe in Fe)De[Qe]=Fe[Qe];return De}(Object.create(this.options),se)).debug;if(ne&&console.time("preprocess data"),se.maxZoom<0||se.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(se.promoteId&&se.generateId)throw new Error("promoteId and generateId cannot be used together.");var we=function(De,Fe){var Qe=[];if(De.type==="FeatureCollection")for(var Ke=0;Ke<De.features.length;Ke++)Ce(Qe,De.features[Ke],Fe,Ke);else Ce(Qe,De.type==="Feature"?De:{geometry:De},Fe);return Qe}(Ee,se);this.tiles={},this.tileCoords=[],ne&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",se.indexMaxZoom,se.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),we=function(De,Fe){var Qe=Fe.buffer/Fe.extent,Ke=De,Ve=Wt(De,1,-1-Qe,Qe,0,-1,2,Fe),Ye=Wt(De,1,1-Qe,2+Qe,0,-1,2,Fe);return(Ve||Ye)&&(Ke=Wt(De,1,-Qe,1+Qe,0,-1,2,Fe)||[],Ve&&(Ke=tr(Ve,1).concat(Ke)),Ye&&(Ke=Ke.concat(tr(Ye,-1)))),Ke}(we,se),we.length&&this.splitTile(we,0,0,0),ne&&(we.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function gs(Ee,se,ne){return 32*((1<<Ee)*ne+se)+Ee}function Fs(Ee,se){const ne=Ee.tileID.canonical;if(!this._geoJSONIndex)return se(null,null);const we=this._geoJSONIndex.getTile(ne.z,ne.x,ne.y);if(!we)return se(null,null);const De=new class{constructor(Qe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=Qe.length,this._features=Qe}feature(Qe){return new class{constructor(Ke){this._feature=Ke,this.extent=o.EXTENT,this.type=Ke.type,this.properties=Ke.tags,"id"in Ke&&!isNaN(Ke.id)&&(this.id=parseInt(Ke.id,10))}loadGeometry(){if(this._feature.type===1){const Ke=[];for(const Ve of this._feature.geometry)Ke.push([new o.Point(Ve[0],Ve[1])]);return Ke}{const Ke=[];for(const Ve of this._feature.geometry){const Ye=[];for(const Ft of Ve)Ye.push(new o.Point(Ft[0],Ft[1]));Ke.push(Ye)}return Ke}}toGeoJSON(Ke,Ve,Ye){return pt.call(this,Ke,Ve,Ye)}}(this._features[Qe])}}(we.features);let Fe=yi(De);Fe.byteOffset===0&&Fe.byteLength===Fe.buffer.byteLength||(Fe=new Uint8Array(Fe)),se(null,{vectorTile:De,rawData:Fe.buffer})}Kn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Kn.prototype.splitTile=function(Ee,se,ne,we,De,Fe,Qe){for(var Ke=[Ee,se,ne,we],Ve=this.options,Ye=Ve.debug;Ke.length;){we=Ke.pop(),ne=Ke.pop(),se=Ke.pop(),Ee=Ke.pop();var Ft=1<<se,Ht=gs(se,ne,we),Dt=this.tiles[Ht];if(!Dt&&(Ye>1&&console.time("creation"),Dt=this.tiles[Ht]=Bs(Ee,se,ne,we,Ve),this.tileCoords.push({z:se,x:ne,y:we}),Ye)){Ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",se,ne,we,Dt.numFeatures,Dt.numPoints,Dt.numSimplified),console.timeEnd("creation"));var Ri="z"+se;this.stats[Ri]=(this.stats[Ri]||0)+1,this.total++}if(Dt.source=Ee,De){if(se===Ve.maxZoom||se===De)continue;var Si=1<<De-se;if(ne!==Math.floor(Fe/Si)||we!==Math.floor(Qe/Si))continue}else if(se===Ve.indexMaxZoom||Dt.numPoints<=Ve.indexMaxPoints)continue;if(Dt.source=null,Ee.length!==0){Ye>1&&console.time("clipping");var zi,Xi,Ji,Yr,is,Hs,Ss=.5*Ve.buffer/Ve.extent,xo=.5-Ss,As=.5+Ss,Zs=1+Ss;zi=Xi=Ji=Yr=null,is=Wt(Ee,Ft,ne-Ss,ne+As,0,Dt.minX,Dt.maxX,Ve),Hs=Wt(Ee,Ft,ne+xo,ne+Zs,0,Dt.minX,Dt.maxX,Ve),Ee=null,is&&(zi=Wt(is,Ft,we-Ss,we+As,1,Dt.minY,Dt.maxY,Ve),Xi=Wt(is,Ft,we+xo,we+Zs,1,Dt.minY,Dt.maxY,Ve),is=null),Hs&&(Ji=Wt(Hs,Ft,we-Ss,we+As,1,Dt.minY,Dt.maxY,Ve),Yr=Wt(Hs,Ft,we+xo,we+Zs,1,Dt.minY,Dt.maxY,Ve),Hs=null),Ye>1&&console.timeEnd("clipping"),Ke.push(zi||[],se+1,2*ne,2*we),Ke.push(Xi||[],se+1,2*ne,2*we+1),Ke.push(Ji||[],se+1,2*ne+1,2*we),Ke.push(Yr||[],se+1,2*ne+1,2*we+1)}}},Kn.prototype.getTile=function(Ee,se,ne){var we=this.options,De=we.extent,Fe=we.debug;if(Ee<0||Ee>24)return null;var Qe=1<<Ee,Ke=gs(Ee,se=(se%Qe+Qe)%Qe,ne);if(this.tiles[Ke])return Cs(this.tiles[Ke],De);Fe>1&&console.log("drilling down to z%d-%d-%d",Ee,se,ne);for(var Ve,Ye=Ee,Ft=se,Ht=ne;!Ve&&Ye>0;)Ye--,Ft=Math.floor(Ft/2),Ht=Math.floor(Ht/2),Ve=this.tiles[gs(Ye,Ft,Ht)];return Ve&&Ve.source?(Fe>1&&console.log("found parent tile z%d-%d-%d",Ye,Ft,Ht),Fe>1&&console.time("drilling down"),this.splitTile(Ve.source,Ye,Ft,Ht,Ee,se,ne),Fe>1&&console.timeEnd("drilling down"),this.tiles[Ke]?Cs(this.tiles[Ke],De):null):null};class Ws extends o.VectorTileWorkerSource{constructor(se,ne,we,De,Fe){super(se,ne,we,De,Fs),Fe&&(this.loadGeoJSON=Fe)}loadData(se,ne){const we=se&&se.request,De=we&&we.collectResourceTiming;this.loadGeoJSON(se,(Fe,Qe)=>{if(Fe||!Qe)return ne(Fe);if(typeof Qe!="object")return ne(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));{We(Qe,!0);try{if(se.filter){const Ve=o.createExpression(se.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ve.result==="error")throw new Error(Ve.value.map(Ft=>`${Ft.key}: ${Ft.message}`).join(", "));Qe={type:"FeatureCollection",features:Qe.features.filter(Ft=>Ve.value.evaluate({zoom:0},Ft))}}this._geoJSONIndex=se.cluster?new br(function({superclusterOptions:Ve,clusterProperties:Ye}){if(!Ye||!Ve)return Ve;const Ft={},Ht={},Dt={accumulated:null,zoom:0},Ri={properties:null},Si=Object.keys(Ye);for(const zi of Si){const[Xi,Ji]=Ye[zi],Yr=o.createExpression(Ji),is=o.createExpression(typeof Xi=="string"?[Xi,["accumulated"],["get",zi]]:Xi);Ft[zi]=Yr.value,Ht[zi]=is.value}return Ve.map=zi=>{Ri.properties=zi;const Xi={};for(const Ji of Si)Xi[Ji]=Ft[Ji].evaluate(Dt,Ri);return Xi},Ve.reduce=(zi,Xi)=>{Ri.properties=Xi;for(const Ji of Si)Dt.accumulated=zi[Ji],zi[Ji]=Ht[Ji].evaluate(Dt,Ri)},Ve}(se)).load(Qe.features):function(Ve,Ye){return new Kn(Ve,Ye)}(Qe,se.geojsonVtOptions)}catch(Ve){return ne(Ve)}this.loaded={};const Ke={};if(De){const Ve=o.getPerformanceMeasurement(we);Ve&&(Ke.resourceTiming={},Ke.resourceTiming[se.source]=JSON.parse(JSON.stringify(Ve)))}ne(null,Ke)}})}reloadTile(se,ne){const we=this.loaded;return we&&we[se.uid]?super.reloadTile(se,ne):this.loadTile(se,ne)}loadGeoJSON(se,ne){if(se.request)o.getJSON(se.request,ne);else{if(typeof se.data!="string")return ne(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));try{return ne(null,JSON.parse(se.data))}catch{return ne(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(se,ne){try{ne(null,this._geoJSONIndex.getClusterExpansionZoom(se.clusterId))}catch(we){ne(we)}}getClusterChildren(se,ne){try{ne(null,this._geoJSONIndex.getChildren(se.clusterId))}catch(we){ne(we)}}getClusterLeaves(se,ne){try{ne(null,this._geoJSONIndex.getLeaves(se.clusterId,se.limit,se.offset))}catch(we){ne(we)}}}class ml{constructor(se){this.self=se,this.actor=new o.Actor(se,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:Ws},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ne,we)=>{if(this.workerSourceTypes[ne])throw new Error(`Worker source with name "${ne}" already registered.`);this.workerSourceTypes[ne]=we},this.self.registerRTLTextPlugin=ne=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=ne.applyArabicShaping,o.plugin.processBidirectionalText=ne.processBidirectionalText,o.plugin.processStyledBidirectionalText=ne.processStyledBidirectionalText}}clearCaches(se,ne,we){delete this.layerIndexes[se],delete this.availableImages[se],delete this.workerSources[se],delete this.demWorkerSources[se],we()}checkIfReady(se,ne,we){we()}setReferrer(se,ne){this.referrer=ne}spriteLoaded(se,ne){this.isSpriteLoaded[se]=ne;for(const we in this.workerSources[se]){const De=this.workerSources[se][we];for(const Fe in De)De[Fe]instanceof o.VectorTileWorkerSource&&(De[Fe].isSpriteLoaded=ne,De[Fe].fire(new o.Event("isSpriteLoaded")))}}setImages(se,ne,we){this.availableImages[se]=ne;for(const De in this.workerSources[se]){const Fe=this.workerSources[se][De];for(const Qe in Fe)Fe[Qe].availableImages=ne}we()}enableTerrain(se,ne,we){this.terrain=ne,we()}setProjection(se,ne){this.projections[se]=o.getProjection(ne)}setLayers(se,ne,we){this.getLayerIndex(se).replace(ne),we()}updateLayers(se,ne,we){this.getLayerIndex(se).update(ne.layers,ne.removedIds),we()}loadTile(se,ne,we){const De=this.enableTerrain?o.extend({enableTerrain:this.terrain},ne):ne;De.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,ne.type,ne.source).loadTile(De,we)}loadDEMTile(se,ne,we){const De=this.enableTerrain?o.extend({buildQuadTree:this.terrain},ne):ne;this.getDEMWorkerSource(se,ne.source).loadTile(De,we)}reloadTile(se,ne,we){const De=this.enableTerrain?o.extend({enableTerrain:this.terrain},ne):ne;De.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,ne.type,ne.source).reloadTile(De,we)}abortTile(se,ne,we){this.getWorkerSource(se,ne.type,ne.source).abortTile(ne,we)}removeTile(se,ne,we){this.getWorkerSource(se,ne.type,ne.source).removeTile(ne,we)}removeSource(se,ne,we){if(!this.workerSources[se]||!this.workerSources[se][ne.type]||!this.workerSources[se][ne.type][ne.source])return;const De=this.workerSources[se][ne.type][ne.source];delete this.workerSources[se][ne.type][ne.source],De.removeSource!==void 0?De.removeSource(ne,we):we()}loadWorkerSource(se,ne,we){try{this.self.importScripts(ne.url),we()}catch(De){we(De.toString())}}syncRTLPluginState(se,ne,we){try{o.plugin.setState(ne);const De=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&De!=null){this.self.importScripts(De);const Fe=o.plugin.isParsed();we(Fe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${De}`),Fe)}}catch(De){we(De.toString())}}getAvailableImages(se){let ne=this.availableImages[se];return ne||(ne=[]),ne}getLayerIndex(se){let ne=this.layerIndexes[se];return ne||(ne=this.layerIndexes[se]=new oe),ne}getWorkerSource(se,ne,we){if(this.workerSources[se]||(this.workerSources[se]={}),this.workerSources[se][ne]||(this.workerSources[se][ne]={}),!this.workerSources[se][ne][we]){const De={send:(Fe,Qe,Ke,Ve,Ye,Ft)=>{this.actor.send(Fe,Qe,Ke,se,Ye,Ft)},scheduler:this.actor.scheduler};this.workerSources[se][ne][we]=new this.workerSourceTypes[ne](De,this.getLayerIndex(se),this.getAvailableImages(se),this.isSpriteLoaded[se])}return this.workerSources[se][ne][we]}getDEMWorkerSource(se,ne){return this.demWorkerSources[se]||(this.demWorkerSources[se]={}),this.demWorkerSources[se][ne]||(this.demWorkerSources[se][ne]=new xe),this.demWorkerSources[se][ne]}enforceCacheSizeLimit(se,ne){o.enforceCacheSizeLimit(ne)}getWorkerPerformanceMetrics(se,ne,we){we(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ml(self)),ml}),B(["./shared"],function(o){function X(d,r){if(Array.isArray(d)){if(!Array.isArray(r)||d.length!==r.length)return!1;for(let l=0;l<d.length;l++)if(!X(d[l],r[l]))return!1;return!0}if(typeof d=="object"&&d!==null&&r!==null){if(typeof r!="object"||Object.keys(d).length!==Object.keys(r).length)return!1;for(const l in d)if(!X(d[l],r[l]))return!1;return!0}return d===r}var ie=oe;function oe(d){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,v,T=new Blob([""],{type:"text/javascript"}),P=URL.createObjectURL(T);try{v=new Worker(P),m=!0}catch{m=!1}return v&&v.terminate(),URL.revokeObjectURL(P),m}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var m=document.createElement("canvas");m.width=m.height=1;var v=m.getContext("2d");if(!v)return!1;var T=v.getImageData(0,0,1,1);return T&&T.width===m.width}()?(xe[l=r&&r.failIfMajorPerformanceCaveat]===void 0&&(xe[l]=function(m){var v,T=function(P){var I=document.createElement("canvas"),F=Object.create(oe.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=P,I.getContext("webgl",F)||I.getContext("experimental-webgl",F)}(m);if(!T)return!1;try{v=T.createShader(T.VERTEX_SHADER)}catch{return!1}return!(!v||T.isContextLost())&&(T.shaderSource(v,"void main() {}"),T.compileShader(v),T.getShaderParameter(v,T.COMPILE_STATUS)===!0)}(l)),xe[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var l}(d)}var xe={};function Te(d,r,l){const m=o.window.document.createElement(d);return r!==void 0&&(m.className=r),l&&l.appendChild(m),m}function je(d,r,l){const m=o.window.document.createElementNS("http://www.w3.org/2000/svg",d);for(const v of Object.keys(r))m.setAttributeNS(null,v,r[v]);return l&&l.appendChild(m),m}oe.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const We=o.window.document&&o.window.document.documentElement.style,pt=We&&We.userSelect!==void 0?"userSelect":"WebkitUserSelect";let yt;function Ze(){We&&pt&&(yt=We[pt],We[pt]="none")}function Ae(){We&&pt&&(We[pt]=yt)}function Be(d){d.preventDefault(),d.stopPropagation(),o.window.removeEventListener("click",Be,!0)}function He(){o.window.addEventListener("click",Be,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",Be,!0)},0)}function lt(d,r){const l=d.getBoundingClientRect();return ht(d,l,r)}function kt(d,r){const l=d.getBoundingClientRect(),m=[];for(let v=0;v<r.length;v++)m.push(ht(d,l,r[v]));return m}function Ne(d){return o.window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function ht(d,r,l){const m=d.offsetWidth===r.width?1:d.offsetWidth/r.width;return new o.Point((l.clientX-r.left)*m,(l.clientY-r.top)*m)}function Ge(d,r){var l=r[0],m=r[1],v=r[2],T=r[3],P=l*T-v*m;return P?(d[0]=T*(P=1/P),d[1]=-m*P,d[2]=-v*P,d[3]=l*P,d):null}function ai(d){const{userImage:r}=d;return!!(r&&r.render&&r.render())&&(d.data.replace(new Uint8Array(r.data.buffer)),!0)}class Ot extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:l,callback:m}of this.requestors)this._notify(l,m);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,l){this._validate(r,l)&&(this.images[r]=l)}_validate(r,l){let m=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),m=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),m=!1),this._validateContent(l.content,l)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),m=!1),m}_validateStretch(r,l){if(!r)return!0;let m=0;for(const v of r){if(v[0]<m||v[1]<v[0]||l<v[1])return!1;m=v[1]}return!0}_validateContent(r,l){return!(r&&(r.length!==4||r[0]<0||l.data.width<r[0]||r[1]<0||l.data.height<r[1]||r[2]<0||l.data.width<r[2]||r[3]<0||l.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,l){l.version=this.images[r].version+1,this.images[r]=l,this.updatedImages[r]=!0}removeImage(r){const l=this.images[r];delete this.images[r],delete this.patterns[r],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,l){let m=!0;if(!this.isLoaded())for(const v of r)this.images[v]||(m=!1);this.isLoaded()||m?this._notify(r,l):this.requestors.push({ids:r,callback:l})}_notify(r,l){const m={};for(const v of r){this.images[v]||this.fire(new o.Event("styleimagemissing",{id:v}));const T=this.images[v];T?m[v]={data:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)}:o.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,m)}getPixelSize(){const{width:r,height:l}=this.atlasImage;return{width:r,height:l}}getPattern(r){const l=this.patterns[r],m=this.getImage(r);if(!m)return null;if(l&&l.position.version===m.version)return l.position;if(l)l.position.version=m.version;else{const v={w:m.data.width+2,h:m.data.height+2,x:0,y:0},T=new o.ImagePosition(v,m);this.patterns[r]={bin:v,position:T}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const l=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(r,this.atlasImage,l.RGBA),this.atlasTexture&&this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const T in this.patterns)r.push(this.patterns[T].bin);const{w:l,h:m}=o.potpack(r),v=this.atlasImage;v.resize({width:l||1,height:m||1});for(const T in this.patterns){const{bin:P}=this.patterns[T],I=P.x+1,F=P.y+1,G=this.images[T].data,$=G.width,K=G.height;o.RGBAImage.copy(G,v,{x:0,y:0},{x:I,y:F},{width:$,height:K}),o.RGBAImage.copy(G,v,{x:0,y:K-1},{x:I,y:F-1},{width:$,height:1}),o.RGBAImage.copy(G,v,{x:0,y:0},{x:I,y:F+K},{width:$,height:1}),o.RGBAImage.copy(G,v,{x:$-1,y:0},{x:I-1,y:F},{width:1,height:K}),o.RGBAImage.copy(G,v,{x:0,y:0},{x:I+$,y:F},{width:1,height:K})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const l of r){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const m=this.images[l];ai(m)&&this.updateImage(l,m)}}}const jt=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(d,r){return function([l,m,v]){const T=o.degToRad(m+90),P=o.degToRad(v);return{x:l*Math.cos(T)*Math.sin(P),y:l*Math.sin(T)*Math.sin(P),z:l*Math.cos(P),azimuthal:m,polar:v}}(d.expression.evaluate(r))}interpolate(d,r,l){return{x:o.number(d.x,r.x,l),y:o.number(d.y,r.y,l),z:o.number(d.z,r.z,l),azimuthal:o.number(d.azimuthal,r.azimuthal,l),polar:o.number(d.polar,r.polar,l)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)});class Ti extends o.Evented{constructor(r){super(),this._transitionable=new o.Transitionable(jt),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l={}){if(!this._validate(o.validateLight,r,l))for(const m in r){const v=r[m];o.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),v):this._transitionable.setValue(m,v)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,m){return(!m||m.validate!==!1)&&o.emitValidationErrors(this,r.call(o.validateStyle,o.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const Qi=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)});let li=class extends o.Evented{constructor(d,r){super(),this._transitionable=new o.Transitionable(Qi),this.set(d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(d){for(const r in d){const l=d[r];o.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-11),l):this._transitionable.setValue(r,l)}}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}};function yi(d,r,l,m){const v=o.smoothstep(45,65,l),[T,P]=xi(d,m),I=o.length(r);let F=1-Math.min(1,Math.exp((I-T)/(P-T)*-6));return F*=F*F,F=Math.min(1,1.00747*F),F*v*d.alpha}function xi(d,r){const l=.5/Math.tan(.5*r);return[d.range[0]+l,d.range[1]+l]}const vi=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])});class ws extends o.Evented{constructor(r,l){super(),this._transitionable=new o.Transitionable(vi),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const r=this._transform,l=r.projection.name==="globe",m=o.globeToMercatorTransition(r.zoom),v=this.properties.get("range"),T=[.5,3];return{range:l?[o.number(T[0],v[0],m),o.number(T[1],v[1],m)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,l={}){if(!this._validate(o.validateFog,r,l)){for(const m of Object.keys(o.spec.fog))r&&r[m]===void 0&&(r[m]=o.spec.fog[m].default);for(const m in r){const v=r[m];o.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),v):this._transitionable.setValue(m,v)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,r))*l.a}getOpacityAtLatLng(r,l){return this._transform.projection.supportsFog?function(m,v,T){const P=o.MercatorCoordinate.fromLngLat(v),I=T.elevation?T.elevation.getAtPointOrZero(P):0,F=[P.x,P.y,I];return o.transformMat4(F,F,T.mercatorFogMatrix),yi(m,F,T.pitch,T._fov)}(this.state,r,l):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?xi(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,m){return(!m||m.validate!==!1)&&o.emitValidationErrors(this,r.call(o.validateStyle,o.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Tr{constructor(r,l){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const m=this.workerPool.acquire(this.id);for(let v=0;v<m.length;v++){const T=new Tr.Actor(m[v],l,this.id);T.name=`Worker ${v}`,this.actors.push(T)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,l,m){o.asyncAll(this.actors,(v,T)=>{v.send(r,l,T)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function fr(d,r,l){return r*(o.EXTENT/(d.tileSize*Math.pow(2,l-d.tileID.overscaledZ)))}Tr.Actor=o.Actor;class Ts{constructor(r,l,m,v){this.screenBounds=r,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(r,l){let m,v;if(r instanceof o.Point||typeof r[0]=="number"){const T=o.Point.convert(r);m=[T],v=l.isPointAboveHorizon(T)}else{const T=o.Point.convert(r[0]),P=o.Point.convert(r[1]);m=[T,P],v=o.polygonizeBounds(T,P).every(I=>l.isPointAboveHorizon(I))}return new Ts(m,l.getCameraPoint(),v,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const l=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new o.Point(1,1)):this.screenBounds[1],v=o.polygonizeBounds(l,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<m.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?v[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(v[3]=this.cameraPoint)),o.bufferConvexPolygon(v,r)}bufferedCameraGeometryGlobe(r){const l=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new o.Point(1,1)):this.screenBounds[1],v=o.polygonizeBounds(l,m,r),T=this.cameraPoint.clone();switch(3*((T.y>l.y)+(T.y>m.y))+((T.x>l.x)+(T.x>m.x))){case 0:v[0]=T,v[4]=T.clone();break;case 1:v.splice(1,0,T);break;case 2:v[1]=T;break;case 3:v.splice(4,0,T);break;case 5:v.splice(2,0,T);break;case 6:v[3]=T;break;case 7:v.splice(3,0,T);break;case 8:v[2]=T}return v}containsTile(r,l,m,v=0){const T=r.queryPadding/l._pixelsPerMercatorPixel+1,P=m?this._bufferedCameraMercator(T,l):this._bufferedScreenMercator(T,l);let I=r.tileID.wrap+(P.unwrapped?v:0);const F=P.polygon.map(ge=>o.getTilePoint(r.tileTransform,ge,I));if(!o.polygonIntersectsBox(F,0,0,o.EXTENT,o.EXTENT))return;I=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const G=this.screenGeometryMercator.polygon.map(ge=>o.getTileVec3(r.tileTransform,ge,I)),$=G.map(ge=>new o.Point(ge[0],ge[1])),K=l.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),le=o.getTileVec3(r.tileTransform,K,I),de=G.map(ge=>{const J=o.sub(ge,ge,le);return o.normalize(J,J),new o.Ray(le,J)}),fe=fr(r,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:$,tilespaceRays:de,bufferedTilespaceGeometry:F,bufferedTilespaceBounds:(pe=o.getBounds(F),pe.min.x=o.clamp(pe.min.x,0,o.EXTENT),pe.min.y=o.clamp(pe.min.y,0,o.EXTENT),pe.max.x=o.clamp(pe.max.x,0,o.EXTENT),pe.max.y=o.clamp(pe.max.y,0,o.EXTENT),pe),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:fe};var pe}_bufferedScreenMercator(r,l){const m=Es(r);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let v;return v=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),l):{polygon:this.bufferedScreenGeometry(r).map(T=>l.pointCoordinate3D(T)),unwrapped:!0},this._screenRaycastCache[m]=v,v}}_bufferedCameraMercator(r,l){const m=Es(r);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let v;return v=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),l):{polygon:this.bufferedCameraGeometry(r).map(T=>l.pointCoordinate3D(T)),unwrapped:!0},this._cameraRaycastCache[m]=v,v}}_projectAndResample(r,l){const m=function(T,P){const I=o.multiply([],P.pixelMatrix,P.globeMatrix),F=[0,-o.GLOBE_RADIUS,0,1],G=[0,o.GLOBE_RADIUS,0,1],$=[0,0,0,1];o.transformMat4$1(F,F,I),o.transformMat4$1(G,G,I),o.transformMat4$1($,$,I);const K=new o.Point(F[0]/F[3],F[1]/F[3]),le=new o.Point(G[0]/G[3],G[1]/G[3]),de=o.polygonContainsPoint(T,K)&&F[3]<$[3],fe=o.polygonContainsPoint(T,le)&&G[3]<$[3];if(!de&&!fe)return null;const pe=function(Oe,Xe,$e){for(let it=1;it<Oe.length;it++){const Mt=cn(Xe.pointCoordinate3D(Oe[it-1]).x),et=cn(Xe.pointCoordinate3D(Oe[it]).x);if($e<0){if(Mt<et)return{idx:it,t:-Mt/(et-1-Mt)}}else if(et<Mt)return{idx:it,t:(1-Mt)/(et+1-Mt)}}return null}(T,P,de?-1:1);if(!pe)return null;const{idx:ge,t:J}=pe;let ue=ge>1?br(T.slice(0,ge),P):[],ve=ge<T.length?br(T.slice(ge),P):[];ue=ue.map(Oe=>new o.Point(cn(Oe.x),Oe.y)),ve=ve.map(Oe=>new o.Point(cn(Oe.x),Oe.y));const be=[...ue];be.length===0&&be.push(ve[ve.length-1]);const ze=o.number(be[be.length-1].y,(ve.length===0?ue[0]:ve[0]).y,J);let Pe;return Pe=de?[new o.Point(0,ze),new o.Point(0,0),new o.Point(1,0),new o.Point(1,ze)]:[new o.Point(1,ze),new o.Point(1,1),new o.Point(0,1),new o.Point(0,ze)],be.push(...Pe),ve.length===0?be.push(ue[0]):be.push(...ve),{polygon:be.map(Oe=>new o.MercatorCoordinate(Oe.x,Oe.y)),unwrapped:!1}}(r,l);if(m)return m;const v=function(T,P){let I=!1,F=-1/0,G=0;for(let K=0;K<T.length-1;K++)T[K].x>F&&(F=T[K].x,G=K);for(let K=0;K<T.length-1;K++){const le=(G+K)%(T.length-1),de=T[le],fe=T[le+1];Math.abs(de.x-fe.x)>.5&&(de.x<fe.x?(de.x+=1,le===0&&(T[T.length-1].x+=1)):(fe.x+=1,le+1===T.length-1&&(T[0].x+=1)),I=!0)}const $=o.mercatorXfromLng(P.center.lng);return I&&$<Math.abs($-1)&&T.forEach(K=>{K.x-=1}),{polygon:T,unwrapped:I}}(br(r,l).map(T=>new o.Point(cn(T.x),T.y)),l);return{polygon:v.polygon.map(T=>new o.MercatorCoordinate(T.x,T.y)),unwrapped:v.unwrapped}}}function br(d,r){return o.resample(d,l=>{const m=r.pointCoordinate3D(l);l.x=m.x,l.y=m.y},1/256)}function cn(d){return d<0?1+d%1:d%1}function Es(d){return 100*d|0}function St(d,r,l,m,v){const T=function(P,I){if(P)return v(P);if(I){d.url&&I.tiles&&d.tiles&&delete d.tiles;const F=o.pick(o.extend(I,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(F.vectorLayers=I.vector_layers,F.vectorLayerIds=F.vectorLayers.map(G=>G.id)),F.tiles=r.canonicalizeTileset(F,d.url),v(null,F)}};return d.url?o.getJSON(r.transformRequest(r.normalizeSourceURL(d.url,null,l,m),o.ResourceType.Source),T):o.exported.frame(()=>T(null,d))}class ci{constructor(r,l,m){this.bounds=o.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=l||0,this.maxzoom=m||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const l=Math.pow(2,r.z),m=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*l),v=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*l),T=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*l),P=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*l);return r.x>=m&&r.x<T&&r.y>=v&&r.y<P}}class ri{constructor(r,l,m){this.context=r;const v=r.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class rr{constructor(r,l,m,v){this.length=l.length,this.attributes=m,this.itemSize=l.bytesPerElement,this.dynamicDraw=v,this.context=r;const T=r.gl;this.buffer=T.createBuffer(),r.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let m=0;m<this.attributes.length;m++){const v=l.attributes[this.attributes[m].name];v!==void 0&&r.enableVertexAttribArray(v)}}setVertexAttribPointers(r,l,m){for(let v=0;v<this.attributes.length;v++){const T=this.attributes[v],P=l.attributes[T.name];P!==void 0&&r.vertexAttribPointer(P,T.components,r[fi[T.type]],!1,this.itemSize,T.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class gi{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class me extends gi{getDefault(){return o.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Ce extends gi{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class ct extends gi{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Tt extends gi{getDefault(){return[!0,!0,!0,!0]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class xt extends gi{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Vt extends gi{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class ei extends gi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Wt extends gi{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class qt extends gi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class Gt extends gi{getDefault(){return[0,1]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Ci extends gi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class Qt extends gi{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class wi extends gi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class Pi extends gi{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class er extends gi{getDefault(){return o.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class tr extends gi{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class sr extends gi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class Cs extends gi{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Zr extends gi{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let Bs,ir=class extends gi{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class hn extends gi{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Kn extends gi{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class gs extends gi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Fs extends gi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Ws extends gi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class ml extends gi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Ee extends gi{getDefault(){return null}set(r){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class se extends gi{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class ne extends gi{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class we extends gi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class De extends gi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Fe extends gi{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class Qe extends Fe{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Ke extends Fe{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Ve extends Ke{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ye{constructor(r,l,m,v){this.context=r,this.width=l,this.height=m;const T=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Qe(r,T),v&&(this.depthAttachment=new Ke(r,T))}destroy(){const r=this.context.gl,l=this.colorAttachment.get();if(l&&r.deleteTexture(l),this.depthAttachment){const m=this.depthAttachment.get();m&&r.deleteRenderbuffer(m)}r.deleteFramebuffer(this.framebuffer)}}class Ft{constructor(r,l=!1){if(this.gl=r,this.isWebGL2=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),l){const m=r;this.extVertexArrayObject={createVertexArrayOES:m.createVertexArray.bind(r),deleteVertexArrayOES:m.deleteVertexArray.bind(r),bindVertexArrayOES:m.bindVertexArray.bind(r)}}this.clearColor=new me(this),this.clearDepth=new Ce(this),this.clearStencil=new ct(this),this.colorMask=new Tt(this),this.depthMask=new xt(this),this.stencilMask=new Vt(this),this.stencilFunc=new ei(this),this.stencilOp=new Wt(this),this.stencilTest=new qt(this),this.depthRange=new Gt(this),this.depthTest=new Ci(this),this.depthFunc=new Qt(this),this.blend=new wi(this),this.blendFunc=new Pi(this),this.blendColor=new er(this),this.blendEquation=new tr(this),this.cullFace=new sr(this),this.cullFaceSide=new Cs(this),this.frontFace=new Zr(this),this.program=new ir(this),this.activeTexture=new hn(this),this.viewport=new Kn(this),this.bindFramebuffer=new gs(this),this.bindRenderbuffer=new Fs(this),this.bindTexture=new Ws(this),this.bindVertexBuffer=new ml(this),this.bindElementBuffer=new Ee(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new se(this),this.pixelStoreUnpack=new ne(this),this.pixelStoreUnpackPremultiplyAlpha=new we(this),this.pixelStoreUnpackFlipY=new De(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),l||(this.extTextureHalfFloat=r.getExtension("OES_texture_half_float")),(l||this.extTextureHalfFloat&&r.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=l||r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l){return new ri(this,r,l)}createVertexBuffer(r,l,m){return new rr(this,r,l,m)}createRenderbuffer(r,l,m){const v=this.gl,T=v.createRenderbuffer();return this.bindRenderbuffer.set(T),v.renderbufferStorage(v.RENDERBUFFER,r,l,m),this.bindRenderbuffer.set(null),T}createFramebuffer(r,l,m){return new Ye(this,r,l,m)}clear({color:r,depth:l,stencil:m}){const v=this.gl;let T=0;r&&(T|=v.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(T|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),m!==void 0&&(T|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),v.clear(T)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){X(r.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ht extends o.Evented{constructor(r,l,m,v){if(super(),this.id=r,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(l,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(r){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map._worldview;this._tileJSONRequest=St(this._options,this.map._requestManager,l,m,(v,T)=>{this._tileJSONRequest=null,this._loaded=!0,v?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),m&&m.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new o.ErrorEvent(v))):T&&(o.extend(this,T),T.bounds&&(this.tileBounds=new ci(T.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(T.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(v)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(r,l){const m=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(m,o.ResourceType.Tile),data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile};if(v.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=l:r.request=r.actor.send("reloadTile",v,T.bind(this));else if(r.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",v,T.bind(this),void 0,!0);else{const P=o.loadVectorTile.call({deduped:this._deduped},v,(I,F)=>{I||!F?T.call(this,I):(v.data={cacheControl:F.cacheControl,expires:F.expires,rawData:F.rawData.slice(0)},r.actor&&r.actor.send("loadTile",v,T.bind(this),void 0,!0))},!0);r.request={cancel:P}}function T(P,I){return delete r.request,r.aborted?l(null):P&&P.status!==404?l(P):(I&&I.resourceTiming&&(r.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&r.setExpiryData(I),r.loadVectorData(I,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),l(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id})}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Dt extends o.Evented{constructor(r,l,m,v){super(),this.id=r,this.dispatcher=m,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},l),o.extend(this,o.pick(l,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=St(this._options,this.map._requestManager,null,null,(l,m)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new o.ErrorEvent(l)):m&&(o.extend(this,m),m.bounds&&(this.tileBounds=new ci(m.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(m.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(l)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){const m=o.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);r.request=o.getImage(this.map._requestManager.transformRequest(v,o.ResourceType.Tile),(T,P,I,F)=>(delete r.request,r.aborted?(r.state="unloaded",l(null)):T?(r.state="errored",l(T)):P?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:I,expires:F}),r.setTexture(P,this.map.painter),r.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(r,l,m){r.setTexture(l,m)}static unloadTileData(r,l){r.texture&&l.saveTileTexture(r.texture)}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l()}unloadTile(r,l){r.texture&&this.map.painter.saveTileTexture(r.texture),l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Ri(d,r,l,m,v,T,P,I){const F=[d,l,v,r,m,T,1,1,1],G=[P,I,1],$=o.adjoint([],F),[K,le,de]=o.transformMat3(G,G,o.transpose($,$));return o.multiply$1(F,[K,0,0,0,le,0,0,0,de],F)}class Si extends o.Evented{constructor(r,l,m,v){super(),this.id=r,this.dispatcher=m,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=l,this._dirty=!1}load(r,l){this._loaded=l||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(m,v)=>{if(this._imageRequest=null,this._loaded=!0,m)this.fire(new o.ErrorEvent(m));else if(v){const{HTMLImageElement:T}=o.window;this.image=v instanceof T?o.exported.getImageData(v):v,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const l=r.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let v=1/0,T=1/0,P=-1/0,I=-1/0;for(const K of m)v=Math.min(v,K.x),T=Math.min(T,K.y),P=Math.max(P,K.x),I=Math.max(I,K.y);const F=Math.max(P-v,I-T),G=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),$=Math.pow(2,G);return new o.CanonicalTileID(G,Math.floor((v+P)/2*$),Math.floor((T+I)/2*$))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const F in this.tiles){const G=this.tiles[F];G.state!=="loaded"&&(G.state="loaded",G.texture=this.texture)}if(this._boundsArray)return;const l=o.tileTransform(this.tileID,this.map.transform.projection),[m,v,T,P]=this.coordinates.map(F=>{const G=l.projection.project(F[0],F[1]);return o.getTilePoint(l,G)._round()});this.perspectiveTransform=function(F,G,$,K,le,de,fe,pe,ge,J){const ue=Ri(0,0,F,0,0,G,F,G),ve=Ri($,K,le,de,fe,pe,ge,J);return o.multiply$1(ve,o.adjoint(ue,ue),ve),[ve[6]/ve[8]*F/o.EXTENT,ve[7]/ve[8]*G/o.EXTENT]}(this.width,this.height,m.x,m.y,v.x,v.y,P.x,P.y,T.x,T.y);const I=this._boundsArray=new o.StructArrayLayout4i8;I.emplaceBack(m.x,m.y,0,0),I.emplaceBack(v.x,v.y,o.EXTENT,0),I.emplaceBack(P.x,P.y,0,o.EXTENT),I.emplaceBack(T.x,T.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(I,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,l=r.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(r,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(r)}loadTile(r,l){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},l(null)):(r.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const zi={vector:Ht,raster:Dt,"raster-dem":class extends Dt{constructor(d,r,l,m){super(d,r,l,m),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(d,r){const l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(v,T){v&&(d.state="errored",r(v)),T&&(d.dem=T,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",r(null))}d.request=o.getImage(this.map._requestManager.transformRequest(l,o.ResourceType.Tile),(function(v,T,P,I){if(delete d.request,d.aborted)d.state="unloaded",r(null);else if(v)d.state="errored",r(v);else if(T){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:P,expires:I});const F=o.window.ImageBitmap&&T instanceof o.window.ImageBitmap&&(Bs==null&&(Bs=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),Bs),G=1-(T.width-o.prevPowerOfTwo(T.width))/2;G<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const $=F?T:o.exported.getImageData(T,G),K={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:$,encoding:this.encoding,padding:G};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",K,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const r=d.canonical,l=Math.pow(2,r.z),m=(r.x-1+l)%l,v=r.x===0?d.wrap-1:d.wrap,T=(r.x+1+l)%l,P=r.x+1===l?d.wrap+1:d.wrap,I={};return I[new o.OverscaledTileID(d.overscaledZ,v,r.z,m,r.y).key]={backfilled:!1},I[new o.OverscaledTileID(d.overscaledZ,P,r.z,T,r.y).key]={backfilled:!1},r.y>0&&(I[new o.OverscaledTileID(d.overscaledZ,v,r.z,m,r.y-1).key]={backfilled:!1},I[new o.OverscaledTileID(d.overscaledZ,d.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},I[new o.OverscaledTileID(d.overscaledZ,P,r.z,T,r.y-1).key]={backfilled:!1}),r.y+1<l&&(I[new o.OverscaledTileID(d.overscaledZ,v,r.z,m,r.y+1).key]={backfilled:!1},I[new o.OverscaledTileID(d.overscaledZ,d.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},I[new o.OverscaledTileID(d.overscaledZ,P,r.z,T,r.y+1).key]={backfilled:!1}),I}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends o.Evented{constructor(d,r,l,m){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(m),this._data=r.data,this._options=o.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const v=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*v,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*v,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.EXTENT,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*v,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},r),this}getClusterChildren(d,r){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},r),this}getClusterLeaves(d,r,l,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:r,offset:l},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=o.extend({},this.workerOptions),r=this._data;typeof r=="string"?(d.request=this.map._requestManager.transformRequest(o.exported.resolveURL(r),o.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(l,m)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new o.ErrorEvent(l));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(v.resourceTiming=m.resourceTiming[this.id]),this.fire(new o.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,r){const l=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(l,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,v)=>(delete d.request,d.unloadVectorData(),d.aborted?r(null):m?r(m):(d.loadVectorData(v,this.map.painter,l==="reloadTile"),r(null))),void 0,l==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Si{constructor(d,r,l,m){super(d,r,l,m),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const r of d.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.ResourceType.Source).url);o.getVideo(this.urls,(r,l)=>{this._loaded=!0,r?this.fire(new o.ErrorEvent(r)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const r=this.video.seekable;d<r.start(0)||d>r.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,r=d.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(d,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Si,canvas:class extends Si{constructor(d,r,l,m){super(d,r,l,m),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(T=>typeof T!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends o.Evented{constructor(d,r,l,m){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=r,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ci(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:r,y:l,z:m}=d.canonical;return this._implementation.hasTile({x:r,y:l,z:m})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,r){const{x:l,y:m,z:v}=d.tileID.canonical,T=new o.window.AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:l,y:m,z:v},{signal:T.signal})).then((function(P){return delete d.request,d.aborted?(d.state="unloaded",r(null)):P===void 0?(d.state="errored",r(null)):P===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",r(null)):function(I){return I instanceof o.window.ImageData||I instanceof o.window.HTMLCanvasElement||I instanceof o.window.ImageBitmap||I instanceof o.window.HTMLImageElement}(P)?(this.loadTileData(d,P),d.state="loaded",void r(null)):(d.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(P=>{P.code!==20&&(d.state="errored",r(P))}),d.request.cancel=()=>T.abort()}loadTileData(d,r){Dt.loadTileData(d,r,this._map.painter)}unloadTileData(d){Dt.unloadTileData(d,this._map.painter)}unloadTile(d,r){if(this.unloadTileData(d),this._implementation.unloadTile){const{x:l,y:m,z:v}=d.tileID.canonical;this._implementation.unloadTile({x:l,y:m,z:v})}r()}abortTile(d,r){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Xi=function(d,r,l,m){const v=new zi[r.type](d,r,l,m);if(v.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${v.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],v),v};function Ji(d,r){const l=o.identity([]);return o.scale(l,l,[.5*d.width,.5*-d.height,1]),o.translate(l,l,[1,-1,0]),o.multiply(l,l,d.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(l)}function Yr(d,r,l,m,v,T,P,I=!1){const F=d.tilesIn(m,P,I);F.sort(Hs);const G=[];for(const K of F)G.push({wrappedTileID:K.tile.tileID.wrapped().key,queryResults:K.tile.queryRenderedFeatures(r,l,d._state,K,v,T,Ji(d.transform,K.tile.tileID),I)});const $=function(K){const le={},de={};for(const fe of K){const pe=fe.queryResults,ge=fe.wrappedTileID,J=de[ge]=de[ge]||{};for(const ue in pe){const ve=pe[ue],be=J[ue]=J[ue]||{},ze=le[ue]=le[ue]||[];for(const Pe of ve)be[Pe.featureIndex]||(be[Pe.featureIndex]=!0,ze.push(Pe))}}return le}(G);for(const K in $)$[K].forEach(le=>{const de=le.feature,fe=de.layer;fe&&fe.type!=="background"&&fe.type!=="sky"&&(de.source=fe.source,fe["source-layer"]&&(de.sourceLayer=fe["source-layer"]),de.state=de.id!==void 0?d.getFeatureState(fe["source-layer"],de.id):{})});return $}function is(d,r){const l=d.getRenderableIds().map(T=>d.getTileByID(T)),m=[],v={};for(let T=0;T<l.length;T++){const P=l[T],I=P.tileID.canonical.key;v[I]||(v[I]=!0,P.querySourceFeatures(m,r))}return m}function Hs(d,r){const l=d.tileID,m=r.tileID;return l.overscaledZ-m.overscaledZ||l.canonical.y-m.canonical.y||l.wrap-m.wrap||l.canonical.x-m.canonical.x}function Ss(){return Bl.workerClass!=null?new Bl.workerClass:new o.window.Worker(Bl.workerUrl)}const xo="mapboxgl_preloaded_worker_pool";class As{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<As.workerCount;)this.workers.push(new Ss);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[xo]}numActive(){return Object.keys(this.active).length}}let Zs;function ls(){return Zs||(Zs=new As),Zs}function Xd(d,r){const l={};for(const m in d)m!=="ref"&&(l[m]=d[m]);return o.refProperties.forEach(m=>{m in r&&(l[m]=r[m])}),l}function Zd(d){d=d.slice();const r=Object.create(null);for(let l=0;l<d.length;l++)r[d[l].id]=d[l];for(let l=0;l<d.length;l++)"ref"in d[l]&&(d[l]=Xd(d[l],r[d[l].ref]));return d}As.workerCount=2;const mr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function gu(d,r,l){l.push({command:mr.addSource,args:[d,r[d]]})}function cc(d,r,l){r.push({command:mr.removeSource,args:[d]}),l[d]=!0}function Qc(d,r,l,m){cc(d,l,m),gu(d,r,l)}function eh(d,r,l){let m;for(m in d[l])if(d[l].hasOwnProperty(m)&&m!=="data"&&!X(d[l][m],r[l][m]))return!1;for(m in r[l])if(r[l].hasOwnProperty(m)&&m!=="data"&&!X(d[l][m],r[l][m]))return!1;return!0}function Jn(d,r,l,m,v,T){let P;for(P in r=r||{},d=d||{})d.hasOwnProperty(P)&&(X(d[P],r[P])||l.push({command:T,args:[m,P,r[P],v]}));for(P in r)r.hasOwnProperty(P)&&!d.hasOwnProperty(P)&&(X(d[P],r[P])||l.push({command:T,args:[m,P,r[P],v]}))}function vo(d){return d.id}function _u(d,r){return d[r.id]=r,d}class hc{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.clamp(r,0,1);let l=1,m=this._distances[l];const v=r*this.paddedLength+this.padding;for(;m<v&&l<this._distances.length;)m=this._distances[++l];const T=l-1,P=this._distances[T],I=m-P,F=I>0?(v-P)/I:0;return this.points[T].mult(1-F).add(this.points[l].mult(F))}}class bo{constructor(r,l,m){const v=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(r/m),this.yCellCount=Math.ceil(l/m);for(let P=0;P<this.xCellCount*this.yCellCount;P++)v.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,m,v,T){this._forEachCell(l,m,v,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(T)}insertCircle(r,l,m,v){this._forEachCell(l-v,m-v,l+v,m+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(m),this.circles.push(v)}_insertBoxCell(r,l,m,v,T,P){this.boxCells[T].push(P)}_insertCircleCell(r,l,m,v,T,P){this.circleCells[T].push(P)}_query(r,l,m,v,T,P){if(m<0||r>this.width||v<0||l>this.height)return!T&&[];const I=[];if(r<=0&&l<=0&&this.width<=m&&this.height<=v){if(T)return!0;for(let F=0;F<this.boxKeys.length;F++)I.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const G=this.circles[3*F],$=this.circles[3*F+1],K=this.circles[3*F+2];I.push({key:this.circleKeys[F],x1:G-K,y1:$-K,x2:G+K,y2:$+K})}return P?I.filter(P):I}return this._forEachCell(r,l,m,v,this._queryCell,I,{hitTest:T,seenUids:{box:{},circle:{}}},P),T?I.length>0:I}_queryCircle(r,l,m,v,T){const P=r-m,I=r+m,F=l-m,G=l+m;if(I<0||P>this.width||G<0||F>this.height)return!v&&[];const $=[];return this._forEachCell(P,F,I,G,this._queryCellCircle,$,{hitTest:v,circle:{x:r,y:l,radius:m},seenUids:{box:{},circle:{}}},T),v?$.length>0:$}query(r,l,m,v,T){return this._query(r,l,m,v,!1,T)}hitTest(r,l,m,v,T){return this._query(r,l,m,v,!0,T)}hitTestCircle(r,l,m,v){return this._queryCircle(r,l,m,!0,v)}_queryCell(r,l,m,v,T,P,I,F){const G=I.seenUids,$=this.boxCells[T];if($!==null){const le=this.bboxes;for(const de of $)if(!G.box[de]){G.box[de]=!0;const fe=4*de;if(r<=le[fe+2]&&l<=le[fe+3]&&m>=le[fe+0]&&v>=le[fe+1]&&(!F||F(this.boxKeys[de]))){if(I.hitTest)return P.push(!0),!0;P.push({key:this.boxKeys[de],x1:le[fe],y1:le[fe+1],x2:le[fe+2],y2:le[fe+3]})}}}const K=this.circleCells[T];if(K!==null){const le=this.circles;for(const de of K)if(!G.circle[de]){G.circle[de]=!0;const fe=3*de;if(this._circleAndRectCollide(le[fe],le[fe+1],le[fe+2],r,l,m,v)&&(!F||F(this.circleKeys[de]))){if(I.hitTest)return P.push(!0),!0;{const pe=le[fe],ge=le[fe+1],J=le[fe+2];P.push({key:this.circleKeys[de],x1:pe-J,y1:ge-J,x2:pe+J,y2:ge+J})}}}}}_queryCellCircle(r,l,m,v,T,P,I,F){const G=I.circle,$=I.seenUids,K=this.boxCells[T];if(K!==null){const de=this.bboxes;for(const fe of K)if(!$.box[fe]){$.box[fe]=!0;const pe=4*fe;if(this._circleAndRectCollide(G.x,G.y,G.radius,de[pe+0],de[pe+1],de[pe+2],de[pe+3])&&(!F||F(this.boxKeys[fe])))return P.push(!0),!0}}const le=this.circleCells[T];if(le!==null){const de=this.circles;for(const fe of le)if(!$.circle[fe]){$.circle[fe]=!0;const pe=3*fe;if(this._circlesCollide(de[pe],de[pe+1],de[pe+2],G.x,G.y,G.radius)&&(!F||F(this.circleKeys[fe])))return P.push(!0),!0}}}_forEachCell(r,l,m,v,T,P,I,F){const G=this._convertToXCellCoord(r),$=this._convertToYCellCoord(l),K=this._convertToXCellCoord(m),le=this._convertToYCellCoord(v);for(let de=G;de<=K;de++)for(let fe=$;fe<=le;fe++)if(T.call(this,r,l,m,v,this.xCellCount*fe+de,P,I,F))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,m,v,T,P){const I=v-r,F=T-l,G=m+P;return G*G>I*I+F*F}_circleAndRectCollide(r,l,m,v,T,P,I){const F=(P-v)/2,G=Math.abs(r-(v+F));if(G>F+m)return!1;const $=(I-T)/2,K=Math.abs(l-(T+$));if(K>$+m)return!1;if(G<=F||K<=$)return!0;const le=G-F,de=K-$;return le*le+de*de<=m*m}}const Go={unknown:0,flipRequired:1,flipNotRequired:2},Dr=Math.tan(85*Math.PI/180);function ut(d,r,l,m,v,T,P){const I=o.create();if(l)if(T.name==="globe"){const F=o.calculateGlobeLabelMatrix(v,r);o.multiply(I,I,F)}else{const F=Ge([],P);I[0]=F[0],I[1]=F[1],I[4]=F[2],I[5]=F[3],m||o.rotateZ(I,I,v.angle)}else o.multiply(I,v.labelPlaneMatrix,d);return I}function wo(d,r,l,m,v,T,P){const I=ut(d,r,l,m,v,T,P);return T.name==="globe"&&l||(I[2]=I[6]=I[10]=I[14]=0),I}function _s(d,r,l,m,v,T,P){if(l){if(T.name==="globe"){const I=ut(d,r,l,m,v,T,P);return o.invert(I,I),o.multiply(I,d,I),I}{const I=o.clone(d),F=o.identity([]);return F[0]=P[0],F[1]=P[1],F[4]=P[2],F[5]=P[3],o.multiply(I,I,F),m||o.rotateZ(I,I,-v.angle),I}}return v.glCoordMatrix}function Ns(d,r,l,m){const v=[d,r,l,1];l?o.transformMat4$1(v,v,m):Gi(v,v,m);const T=v[3];return v[0]/=T,v[1]/=T,v[2]/=T,v}function Yd(d,r){return Math.min(.5+d/r*.5,1.5)}function To(d,r){const l=d[0]/d[3],m=d[1]/d[3];return l>=-r[0]&&l<=r[0]&&m>=-r[1]&&m<=r[1]}function th(d,r,l,m,v,T,P,I,F,G){const $=l.transform,K=m?d.textSizeData:d.iconSizeData,le=o.evaluateSizeForZoom(K,l.transform.zoom),de=$.projection.name==="globe",fe=[256/l.width*2+1,256/l.height*2+1],pe=m?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;pe.clear();let ge=null;de&&(ge=m?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const J=d.lineVertexArray,ue=m?d.text.placedSymbolArray:d.icon.placedSymbolArray,ve=l.transform.width/l.transform.height;let be,ze=!1;for(let Pe=0;Pe<ue.length;Pe++){const Oe=ue.get(Pe),{numGlyphs:Xe,writingMode:$e}=Oe;if($e!==o.WritingMode.vertical||ze||be===o.WritingMode.horizontal||(ze=!0),be=$e,(Oe.hidden||$e===o.WritingMode.vertical)&&!ze){Ln(Xe,pe);continue}ze=!1;const it=new o.Point(Oe.tileAnchorX,Oe.tileAnchorY);let{x:Mt,y:et,z:gt}=$.projection.projectTilePoint(it.x,it.y,G.canonical);if(F){const[ki,oi,_i]=F(it);Mt+=ki,et+=oi,gt+=_i}const ot=[Mt,et,gt,1];if(o.transformMat4$1(ot,ot,r),!To(ot,fe)){Ln(Xe,pe);continue}const Pt=Yd(l.transform.cameraToCenterDistance,ot[3]),Je=o.evaluateSizeForFeature(K,le,Oe),_t=P?Je/Pt:Je*Pt,Lt=Ns(Mt,et,gt,v);if(Lt[3]<=0){Ln(Xe,pe);continue}let ft={};const Rt=P?null:F,mi=Yt(Oe,_t,!1,I,r,v,T,d.glyphOffsetArray,J,pe,ge,Lt,it,ft,ve,Rt,$.projection,G,P);ze=mi.useVertical,Rt&&mi.needsFlipping&&(ft={}),(mi.notEnoughRoom||ze||mi.needsFlipping&&Yt(Oe,_t,!0,I,r,v,T,d.glyphOffsetArray,J,pe,ge,Lt,it,ft,ve,Rt,$.projection,G,P).notEnoughRoom)&&Ln(Xe,pe)}m?(d.text.dynamicLayoutVertexBuffer.updateData(pe),ge&&d.text.globeExtVertexBuffer.updateData(ge)):(d.icon.dynamicLayoutVertexBuffer.updateData(pe),ge&&d.icon.globeExtVertexBuffer.updateData(ge))}function Kd(d,r,l,m,v,T,P,I,F,G,$,K,le,de,fe,pe){const{lineStartIndex:ge,glyphStartIndex:J,segment:ue}=I,ve=J+I.numGlyphs,be=ge+I.lineLength,ze=r.getoffsetX(J),Pe=r.getoffsetX(ve-1),Oe=yn(d*ze,l,m,v,T,P,ue,ge,be,F,G,$,K,le,!0,de,fe,pe);if(!Oe)return null;const Xe=yn(d*Pe,l,m,v,T,P,ue,ge,be,F,G,$,K,le,!0,de,fe,pe);return Xe?{first:Oe,last:Xe}:null}function gl(d,r,l,m){return d===o.WritingMode.horizontal&&Math.abs(m)>Math.abs(l)?{useVertical:!0}:d===o.WritingMode.vertical?m>0?{needsFlipping:!0}:null:r!==Go.unknown&&function(v,T){return v===0||Math.abs(T/v)>Dr}(l,m)?r===Go.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function Yt(d,r,l,m,v,T,P,I,F,G,$,K,le,de,fe,pe,ge,J,ue){const ve=r/24,be=d.lineOffsetX*ve,ze=d.lineOffsetY*ve,{lineStartIndex:Pe,glyphStartIndex:Oe,numGlyphs:Xe,segment:$e,writingMode:it,flipState:Mt}=d,et=Pe+d.lineLength,gt=ot=>{if($){const[Lt,ft,Rt]=ot.up,mi=G.length;o.updateGlobeVertexNormal($,mi+0,Lt,ft,Rt),o.updateGlobeVertexNormal($,mi+1,Lt,ft,Rt),o.updateGlobeVertexNormal($,mi+2,Lt,ft,Rt),o.updateGlobeVertexNormal($,mi+3,Lt,ft,Rt)}const[Pt,Je,_t]=ot.point;o.addDynamicAttributes(G,Pt,Je,_t,ot.angle)};if(Xe>1){const ot=Kd(ve,I,be,ze,l,K,le,d,F,T,de,pe,!1,ge,J,ue);if(!ot)return{notEnoughRoom:!0};if(m&&!l){let[Pt,Je,_t]=ot.first.point,[Lt,ft,Rt]=ot.last.point;[Pt,Je]=Ns(Pt,Je,_t,P),[Lt,ft]=Ns(Lt,ft,Rt,P);const mi=gl(it,Mt,(Lt-Pt)*fe,ft-Je);if(d.flipState=mi&&mi.needsFlipping?Go.flipRequired:Go.flipNotRequired,mi)return mi}gt(ot.first);for(let Pt=Oe+1;Pt<Oe+Xe-1;Pt++){const Je=yn(ve*I.getoffsetX(Pt),be,ze,l,K,le,$e,Pe,et,F,T,de,pe,!1,!1,ge,J,ue);if(!Je)return G.length-=4*(Pt-Oe),{notEnoughRoom:!0};gt(Je)}gt(ot.last)}else{if(m&&!l){const Pt=Ns(le.x,le.y,0,v),Je=Pe+$e+1,_t=new o.Point(F.getx(Je),F.gety(Je)),Lt=Ns(_t.x,_t.y,0,v),ft=Lt[3]>0?Lt:Vi(le,_t,Pt,1,v,void 0,ge,J.canonical),Rt=gl(it,Mt,(ft[0]-Pt[0])*fe,ft[1]-Pt[1]);if(d.flipState=Rt&&Rt.needsFlipping?Go.flipRequired:Go.flipNotRequired,Rt)return Rt}const ot=yn(ve*I.getoffsetX(Oe),be,ze,l,K,le,$e,Pe,et,F,T,de,pe,!1,!1,ge,J,ue);if(!ot)return{notEnoughRoom:!0};gt(ot)}return{}}function Ki(d,r,l,m,v){const{x:T,y:P,z:I}=m.projectTilePoint(d.x,d.y,r);if(!v)return Ns(T,P,I,l);const[F,G,$]=v(d);return Ns(T+F,P+G,I+$,l)}function Vi(d,r,l,m,v,T,P,I){const F=Ki(d.sub(r)._unit()._add(d),I,v,P,T);return o.sub(F,l,F),o.normalize(F,F),o.scaleAndAdd(F,l,F,m)}function yn(d,r,l,m,v,T,P,I,F,G,$,K,le,de,fe,pe,ge,J){const ue=m?d-r:d+r;let ve=ue>0?1:-1,be=0;m&&(ve*=-1,be=Math.PI),ve<0&&(be+=Math.PI);let ze=I+P+(ve>0?0:1)|0,Pe=v,Oe=v,Xe=0,$e=0;const it=Math.abs(ue),Mt=[],et=[];let gt=T,ot=gt;const Pt=()=>Vi(ot,gt,Oe,it-Xe+1,$,le,pe,ge.canonical);for(;Xe+$e<=it;){if(ze+=ve,ze<I||ze>=F)return null;if(Oe=Pe,ot=gt,Mt.push(Oe),de&&et.push(ot),gt=new o.Point(G.getx(ze),G.gety(ze)),Pe=K[ze],!Pe){const _i=Ki(gt,ge.canonical,$,pe,le);Pe=_i[3]>0?K[ze]=_i:Pt()}Xe+=$e,$e=o.distance(Oe,Pe)}fe&&le&&(K[ze]&&(Pe=Pt(),$e=o.distance(Oe,Pe)),K[ze]=Pe);const Je=(it-Xe)/$e,_t=gt.sub(ot)._mult(Je)._add(ot),Lt=o.sub([],Pe,Oe),ft=o.scaleAndAdd([],Oe,Lt,Je);let Rt=[0,0,1],mi=Lt[0],ki=Lt[1];if(J&&(Rt=pe.upVector(ge.canonical,_t.x,_t.y),Rt[0]!==0||Rt[1]!==0||Rt[2]!==1)){const _i=[Rt[2],0,-Rt[0]],Oi=o.cross([],Rt,_i);o.normalize(_i,_i),o.normalize(Oi,Oi),mi=o.dot(Lt,_i),ki=o.dot(Lt,Oi)}if(l){const _i=o.cross([],Rt,Lt);o.normalize(_i,_i),o.scaleAndAdd(ft,ft,_i,l*ve)}const oi=be+Math.atan2(ki,mi);return Mt.push(ft),de&&et.push(_t),{point:ft,angle:oi,path:Mt,tilePath:et,up:Rt}}function Ln(d,r){const l=r.length,m=l+4*d;r.resize(m),r.float32.fill(-1/0,4*l,4*m)}function Gi(d,r,l){const m=r[0],v=r[1];return d[0]=l[0]*m+l[4]*v+l[12],d[1]=l[1]*m+l[5]*v+l[13],d[3]=l[3]*m+l[7]*v+l[15],d}const xn=100;class Ys{constructor(r,l,m=new bo(r.width+200,r.height+200,25),v=new bo(r.width+200,r.height+200,25)){this.transform=r,this.grid=m,this.ignoredGrid=v,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+xn,this.screenBottomBoundary=r.height+xn,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=l}placeCollisionBox(r,l,m,v,T,P,I,F){let G=m.projectedAnchorX,$=m.projectedAnchorY,K=m.projectedAnchorZ;const le=m.elevation,de=m.tileID,fe=r.getProjection();if(le&&de){const[Pe,Oe,Xe]=fe.upVector(de.canonical,m.tileAnchorX,m.tileAnchorY),$e=fe.upVectorScale(de.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;G+=Pe*le*$e,$+=Oe*le*$e,K+=Xe*le*$e}const pe=this.projectAndGetPerspectiveRatio(I,G,$,K,m.tileID,fe.name==="globe"||!!le||this.transform.pitch>0,fe),ge=P*pe.perspectiveRatio,J=(m.x1*l+v.x-m.padding)*ge+pe.point.x,ue=(m.y1*l+v.y-m.padding)*ge+pe.point.y,ve=(m.x2*l+v.x+m.padding)*ge+pe.point.x,be=(m.y2*l+v.y+m.padding)*ge+pe.point.y,ze=pe.perspectiveRatio<=.55||pe.occluded;return!this.isInsideGrid(J,ue,ve,be)||!T&&this.grid.hitTest(J,ue,ve,be,F)||ze?{box:[],offscreen:!1,occluded:pe.occluded}:{box:[J,ue,ve,be],offscreen:this.isOffscreen(J,ue,ve,be),occluded:!1}}placeCollisionCircles(r,l,m,v,T,P,I,F,G,$,K,le,de,fe,pe){const ge=[],J=this.transform.elevation,ue=r.getProjection(),ve=J?J.getAtTileOffsetFunc(pe,this.transform.center.lat,this.transform.worldSize,ue):null,be=new o.Point(m.tileAnchorX,m.tileAnchorY);let{x:ze,y:Pe,z:Oe}=ue.projectTilePoint(be.x,be.y,pe.canonical);if(ve){const[_t,Lt,ft]=ve(be);ze+=_t,Pe+=Lt,Oe+=ft}const Xe=ue.name==="globe",$e=this.projectAndGetPerspectiveRatio(I,ze,Pe,Oe,pe,Xe||!!J||this.transform.pitch>0,ue),{perspectiveRatio:it}=$e,Mt=(K?P/it:P*it)/o.ONE_EM,et=Ns(ze,Pe,Oe,F),gt=$e.signedDistanceFromCamera>0?Kd(Mt,T,m.lineOffsetX*Mt,m.lineOffsetY*Mt,!1,et,be,m,v,F,{},J&&!K?ve:null,K&&!!J,ue,pe,K):null;let ot=!1,Pt=!1,Je=!0;if(gt&&!$e.occluded){const _t=.5*de*it+fe,Lt=new o.Point(-100,-100),ft=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),Rt=new hc,{first:mi,last:ki}=gt,oi=mi.path.length;let _i=[];for(let di=oi-1;di>=1;di--)_i.push(mi.path[di]);for(let di=1;di<ki.path.length;di++)_i.push(ki.path[di]);const Oi=2.5*_t;G&&(_i=_i.map(([di,xr,Er],Sr)=>(ve&&!Xe&&(Er=ve(Sr<oi-1?mi.tilePath[oi-1-Sr]:ki.tilePath[Sr-oi+2])[2]),Ns(di,xr,Er,G))),_i.some(di=>di[3]<=0)&&(_i=[]));let Bi=[];if(_i.length>0){let di=1/0,xr=-1/0,Er=1/0,Sr=-1/0;for(const Ar of _i)di=Math.min(di,Ar[0]),Er=Math.min(Er,Ar[1]),xr=Math.max(xr,Ar[0]),Sr=Math.max(Sr,Ar[1]);xr>=Lt.x&&di<=ft.x&&Sr>=Lt.y&&Er<=ft.y&&(Bi=[_i.map(Ar=>new o.Point(Ar[0],Ar[1]))],(di<Lt.x||xr>ft.x||Er<Lt.y||Sr>ft.y)&&(Bi=o.clipLine(Bi,Lt.x,Lt.y,ft.x,ft.y)))}for(const di of Bi){Rt.reset(di,.25*_t);let xr=0;xr=Rt.length<=.5*_t?1:Math.ceil(Rt.paddedLength/Oi)+1;for(let Er=0;Er<xr;Er++){const Sr=Er/Math.max(xr-1,1),Ar=Rt.lerp(Sr),en=Ar.x+xn,Gs=Ar.y+xn;ge.push(en,Gs,_t,0);const Nn=en-_t,wr=Gs-_t,Fr=en+_t,Lr=Gs+_t;if(Je=Je&&this.isOffscreen(Nn,wr,Fr,Lr),Pt=Pt||this.isInsideGrid(Nn,wr,Fr,Lr),!l&&this.grid.hitTestCircle(en,Gs,_t,le)&&(ot=!0,!$))return{circles:[],offscreen:!1,collisionDetected:ot,occluded:!1}}}}return{circles:!$&&ot||!Pt?[]:ge,offscreen:Je,collisionDetected:ot,occluded:$e.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let m=1/0,v=1/0,T=-1/0,P=-1/0;for(const $ of r){const K=new o.Point($.x+xn,$.y+xn);m=Math.min(m,K.x),v=Math.min(v,K.y),T=Math.max(T,K.x),P=Math.max(P,K.y),l.push(K)}const I=this.grid.query(m,v,T,P).concat(this.ignoredGrid.query(m,v,T,P)),F={},G={};for(const $ of I){const K=$.key;if(F[K.bucketInstanceId]===void 0&&(F[K.bucketInstanceId]={}),F[K.bucketInstanceId][K.featureIndex])continue;const le=[new o.Point($.x1,$.y1),new o.Point($.x2,$.y1),new o.Point($.x2,$.y2),new o.Point($.x1,$.y2)];o.polygonIntersectsPolygon(l,le)&&(F[K.bucketInstanceId][K.featureIndex]=!0,G[K.bucketInstanceId]===void 0&&(G[K.bucketInstanceId]=[]),G[K.bucketInstanceId].push(K.featureIndex))}return G}insertCollisionBox(r,l,m,v,T){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:T},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,m,v,T){const P=l?this.ignoredGrid:this.grid,I={bucketInstanceId:m,featureIndex:v,collisionGroupID:T};for(let F=0;F<r.length;F+=4)P.insertCircle(I,r[F],r[F+1],r[F+2])}projectAndGetPerspectiveRatio(r,l,m,v,T,P,I){const F=[l,m,v,1];let G=!1;v||this.transform.pitch>0?(o.transformMat4$1(F,F,r),this.fogState&&T&&I.name!=="globe"&&(G=function(le,de,fe,pe,ge,J){const ue=J.calculateFogTileMatrix(ge),ve=[de,fe,pe];return o.transformMat4(ve,ve,ue),yi(le,ve,J.pitch,J._fov)}(this.fogState,l,m,v,T.toUnwrapped(),this.transform)>.9)):Gi(F,F,r);const $=F[3];return{point:new o.Point((F[0]/$+1)/2*this.transform.width+xn,(-F[1]/$+1)/2*this.transform.height+xn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/$*.5,1.5),signedDistanceFromCamera:$,occluded:P&&F[2]>$||G}}isOffscreen(r,l,m,v){return m<xn||r>=this.screenRightBoundary||v<xn||l>this.screenBottomBoundary}isInsideGrid(r,l,m,v){return m>=0&&r<this.gridRightBoundary&&v>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const r=o.identity([]);return o.translate(r,r,[-100,-100,0]),r}}function Qn(d,r,l){const m=r.createTileMatrix(d,d.worldSize,l.toUnwrapped());return o.multiply(new Float32Array(16),d.projMatrix,m)}function Dn(d,r,l){if(r.projection.name===l.projection.name)return d.projMatrix;const m=l.clone();return m.setProjection(r.projection),Qn(m,r.getProjection(),d)}function Wr(d,r,l){return r.name===l.projection.name?d.projMatrix:Qn(l,r,d)}class Jd{constructor(r,l,m,v){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):v&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class eo{constructor(r,l,m,v,T,P=!1){this.text=new Jd(r?r.text:null,l,m,T),this.icon=new Jd(r?r.icon:null,l,v,T),this.clipped=P}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class pa{constructor(r,l,m,v=!1){this.text=r,this.icon=l,this.skipFade=m,this.clipped=v}}class uc{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class yu{constructor(r,l,m,v,T){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=m,this.bucketIndex=v,this.tileID=T}}class xu{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:m=>m.collisionGroupID===l}}return this.collisionGroups[r]}}function _l(d,r,l,m,v){const{horizontalAlign:T,verticalAlign:P}=o.getAnchorAlignment(d),I=-(T-.5)*r,F=-(P-.5)*l,G=o.evaluateVariableOffset(d,m);return new o.Point(I+G[0]*v,F+G[1]*v)}function Eo(d,r,l,m,v){const T=new o.Point(d,r);return l&&T._rotate(m?v:-v),T}class ih{constructor(r,l,m,v,T){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Ys(this.transform,T),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new xu(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,m,v){const T=m.getBucket(l),P=m.latestFeatureIndex;if(!T||!P||l.id!==T.layerIds[0])return;const I=T.layers[0].layout,F=m.collisionBoxArray,G=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),$=m.tileSize/o.EXTENT,K=m.tileID.toUnwrapped();this.transform.setProjection(T.projection);const le=(de=m.tileID,fe=T.getProjection(),pe=this.transform,fe.name===this.projection?pe.calculateProjMatrix(de.toUnwrapped()):Qn(pe,fe,de));var de,fe,pe;const ge=I.get("text-pitch-alignment")==="map",J=I.get("text-rotation-alignment")==="map";l.compileFilter();const ue=l.dynamicFilter(),ve=l.dynamicFilterNeedsFeature(),be=this.transform.calculatePixelsToTileUnitsMatrix(m),ze=wo(le,m.tileID.canonical,ge,J,this.transform,T.getProjection(),be);let Pe=null;if(ge){const $e=_s(le,m.tileID.canonical,ge,J,this.transform,T.getProjection(),be);Pe=o.multiply([],this.transform.labelPlaneMatrix,$e)}let Oe=null;ue&&m.latestFeatureIndex&&(Oe={unwrappedTileID:K,dynamicFilter:ue,dynamicFilterNeedsFeature:ve,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[T.bucketInstanceId]=new yu(T.bucketInstanceId,P,T.sourceLayerIndex,T.index,m.tileID);const Xe={bucket:T,layout:I,posMatrix:le,textLabelPlaneMatrix:ze,labelToScreenMatrix:Pe,clippingData:Oe,scale:G,textPixelRatio:$,holdingForFade:m.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(T.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(T.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(v)for(const $e of T.sortKeyRanges){const{sortKey:it,symbolInstanceStart:Mt,symbolInstanceEnd:et}=$e;r.push({sortKey:it,symbolInstanceStart:Mt,symbolInstanceEnd:et,parameters:Xe})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Xe})}attemptAnchorPlacement(r,l,m,v,T,P,I,F,G,$,K,le,de,fe,pe,ge,J,ue){const{textOffset0:ve,textOffset1:be,crossTileID:ze}=le,Pe=[ve,be],Oe=_l(r,m,v,Pe,T),Xe=this.collisionIndex.placeCollisionBox(fe,T,l,Eo(Oe.x,Oe.y,P,I,this.transform.angle),K,F,G,$.predicate);if(ge){const $e=fe.getSymbolInstanceIconSize(ue,this.transform.zoom,le.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(fe,$e,ge,Eo(Oe.x,Oe.y,P,I,this.transform.angle),K,F,G,$.predicate).box.length===0)return}if(Xe.box.length>0){let $e;return this.prevPlacement&&this.prevPlacement.variableOffsets[ze]&&this.prevPlacement.placements[ze]&&this.prevPlacement.placements[ze].text&&($e=this.prevPlacement.variableOffsets[ze].anchor),this.variableOffsets[ze]={textOffset:Pe,width:m,height:v,anchor:r,textScale:T,prevAnchor:$e},this.markUsedJustification(fe,r,le,pe),fe.allowVerticalPlacement&&(this.markUsedOrientation(fe,pe,le),this.placedOrientations[ze]=pe),{shift:Oe,placedGlyphBoxes:Xe}}}placeLayerBucketPart(r,l,m,v){const{bucket:T,layout:P,posMatrix:I,textLabelPlaneMatrix:F,labelToScreenMatrix:G,clippingData:$,textPixelRatio:K,holdingForFade:le,collisionBoxArray:de,partiallyEvaluatedTextSize:fe,partiallyEvaluatedIconSize:pe,collisionGroup:ge}=r.parameters,J=P.get("text-optional"),ue=P.get("icon-optional"),ve=P.get("text-allow-overlap"),be=P.get("icon-allow-overlap"),ze=P.get("text-rotation-alignment")==="map",Pe=P.get("text-pitch-alignment")==="map",Oe=P.get("icon-text-fit")!=="none",Xe=P.get("symbol-z-order")==="viewport-y";this.transform.setProjection(T.projection);let $e=ve&&(be||!T.hasIconData()||ue),it=be&&(ve||!T.hasTextData()||J);!T.collisionArrays&&de&&T.deserializeCollisionBoxes(de),m&&v&&T.updateCollisionDebugBuffers(this.transform.zoom,de);const Mt=(et,gt,ot)=>{const{crossTileID:Pt,numVerticalGlyphVertices:Je}=et;if($){const Fr={zoom:this.transform.zoom,pitch:this.transform.pitch};let Lr=null;if($.dynamicFilterNeedsFeature){const or=this.retainedQueryData[T.bucketInstanceId];Lr=$.featureIndex.loadFeature({featureIndex:et.featureIndex,bucketIndex:or.bucketIndex,sourceLayerIndex:or.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,$.dynamicFilter)(Fr,Lr,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new o.Point(et.tileAnchorX,et.tileAnchorY),this.transform.calculateDistanceTileData($.unwrappedTileID)))return this.placements[Pt]=new pa(!1,!1,!1,!0),void l.add(Pt)}if(l.has(Pt))return;if(le)return void(this.placements[Pt]=new pa(!1,!1,!1));let _t=!1,Lt=!1,ft=!0,Rt=!1,mi=!1,ki=null,oi={box:null,offscreen:null,occluded:null},_i={box:null},Oi=null,Bi=null,di=null,xr=0,Er=0,Sr=0;ot.textFeatureIndex?xr=ot.textFeatureIndex:et.useRuntimeCollisionCircles&&(xr=et.featureIndex),ot.verticalTextFeatureIndex&&(Er=ot.verticalTextFeatureIndex);const Ar=Fr=>{Fr.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const Lr=this.transform.elevation;(Lr||Fr.elevation)&&(Fr.elevation=Lr?Lr.getAtTileOffset(Fr.tileID,Fr.tileAnchorX,Fr.tileAnchorY):0)},en=ot.textBox;if(en){Ar(en);const Fr=or=>{let ys=o.WritingMode.horizontal;if(T.allowVerticalPlacement&&!or&&this.prevPlacement){const dn=this.prevPlacement.placedOrientations[Pt];dn&&(this.placedOrientations[Pt]=dn,ys=dn,this.markUsedOrientation(T,ys,et))}return ys},Lr=(or,ys)=>{if(T.allowVerticalPlacement&&Je>0&&ot.verticalTextBox){for(const dn of T.writingModes)if(dn===o.WritingMode.vertical?(oi=ys(),_i=oi):oi=or(),oi&&oi.box&&oi.box.length)break}else oi=or()};if(P.get("text-variable-anchor")){let or=P.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Pt]){const Nr=this.prevPlacement.variableOffsets[Pt];or.indexOf(Nr.anchor)>0&&(or=or.filter(ks=>ks!==Nr.anchor),or.unshift(Nr.anchor))}const ys=(Nr,ks,kh)=>{const ea=T.getSymbolInstanceTextSize(fe,et,this.transform.zoom,gt),Fl=(Nr.x2-Nr.x1)*ea+2*Nr.padding,Po=(Nr.y2-Nr.y1)*ea+2*Nr.padding,ta=Oe&&!be?ks:null;ta&&Ar(ta);let Ya={box:[],offscreen:!1,occluded:!1};const ns=ve?2*or.length:or.length;for(let Rc=0;Rc<ns;++Rc){const Yu=this.attemptAnchorPlacement(or[Rc%or.length],Nr,Fl,Po,ea,ze,Pe,K,I,ge,Rc>=or.length,et,gt,T,kh,ta,fe,pe);if(Yu&&(Ya=Yu.placedGlyphBoxes,Ya&&Ya.box&&Ya.box.length)){_t=!0,ki=Yu.shift;break}}return Ya};Lr(()=>ys(en,ot.iconBox,o.WritingMode.horizontal),()=>{const Nr=ot.verticalTextBox;return Nr&&Ar(Nr),T.allowVerticalPlacement&&!(oi&&oi.box&&oi.box.length)&&Je>0&&Nr?ys(Nr,ot.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),oi&&(_t=oi.box,ft=oi.offscreen,Rt=oi.occluded);const dn=Fr(!(!oi||!oi.box));if(!_t&&this.prevPlacement){const Nr=this.prevPlacement.variableOffsets[Pt];Nr&&(this.variableOffsets[Pt]=Nr,this.markUsedJustification(T,Nr.anchor,et,dn))}}else{const or=(ys,dn)=>{const Nr=T.getSymbolInstanceTextSize(fe,et,this.transform.zoom,gt),ks=this.collisionIndex.placeCollisionBox(T,Nr,ys,new o.Point(0,0),ve,K,I,ge.predicate);return ks&&ks.box&&ks.box.length&&(this.markUsedOrientation(T,dn,et),this.placedOrientations[Pt]=dn),ks};Lr(()=>or(en,o.WritingMode.horizontal),()=>{const ys=ot.verticalTextBox;return T.allowVerticalPlacement&&Je>0&&ys?(Ar(ys),or(ys,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Fr(!!(oi&&oi.box&&oi.box.length))}}if(Oi=oi,_t=Oi&&Oi.box&&Oi.box.length>0,ft=Oi&&Oi.offscreen,Rt=Oi&&Oi.occluded,et.useRuntimeCollisionCircles){const Fr=T.text.placedSymbolArray.get(et.centerJustifiedTextSymbolIndex>=0?et.centerJustifiedTextSymbolIndex:et.verticalPlacedTextSymbolIndex),Lr=o.evaluateSizeForFeature(T.textSizeData,fe,Fr),or=P.get("text-padding");Bi=this.collisionIndex.placeCollisionCircles(T,ve,Fr,T.lineVertexArray,T.glyphOffsetArray,Lr,I,F,G,m,Pe,ge.predicate,et.collisionCircleDiameter*Lr/o.ONE_EM,or,this.retainedQueryData[T.bucketInstanceId].tileID),_t=ve||Bi.circles.length>0&&!Bi.collisionDetected,ft=ft&&Bi.offscreen,Rt=Bi.occluded}if(ot.iconFeatureIndex&&(Sr=ot.iconFeatureIndex),ot.iconBox){const Fr=Lr=>{Ar(Lr);const or=Oe&&ki?Eo(ki.x,ki.y,ze,Pe,this.transform.angle):new o.Point(0,0),ys=T.getSymbolInstanceIconSize(pe,this.transform.zoom,et.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,ys,Lr,or,be,K,I,ge.predicate)};_i&&_i.box&&_i.box.length&&ot.verticalIconBox?(di=Fr(ot.verticalIconBox),Lt=di.box.length>0):(di=Fr(ot.iconBox),Lt=di.box.length>0),ft=ft&&di.offscreen,mi=di.occluded}const Gs=J||et.numHorizontalGlyphVertices===0&&Je===0,Nn=ue||et.numIconVertices===0;if(Gs||Nn?Nn?Gs||(Lt=Lt&&_t):_t=Lt&&_t:Lt=_t=Lt&&_t,_t&&Oi&&Oi.box&&this.collisionIndex.insertCollisionBox(Oi.box,P.get("text-ignore-placement"),T.bucketInstanceId,_i&&_i.box&&Er?Er:xr,ge.ID),Lt&&di&&this.collisionIndex.insertCollisionBox(di.box,P.get("icon-ignore-placement"),T.bucketInstanceId,Sr,ge.ID),Bi&&(_t&&this.collisionIndex.insertCollisionCircles(Bi.circles,P.get("text-ignore-placement"),T.bucketInstanceId,xr,ge.ID),m)){const Fr=T.bucketInstanceId;let Lr=this.collisionCircleArrays[Fr];Lr===void 0&&(Lr=this.collisionCircleArrays[Fr]=new uc);for(let or=0;or<Bi.circles.length;or+=4)Lr.circles.push(Bi.circles[or+0]),Lr.circles.push(Bi.circles[or+1]),Lr.circles.push(Bi.circles[or+2]),Lr.circles.push(Bi.collisionDetected?1:0)}const wr=T.projection.name!=="globe";$e=$e&&(wr||!Rt),it=it&&(wr||!mi),this.placements[Pt]=new pa(_t||$e,Lt||it,ft||T.justReloaded),l.add(Pt)};if(Xe){const et=T.getSortedSymbolIndexes(this.transform.angle);for(let gt=et.length-1;gt>=0;--gt){const ot=et[gt];Mt(T.symbolInstances.get(ot),ot,T.collisionArrays[ot])}}else for(let et=r.symbolInstanceStart;et<r.symbolInstanceEnd;et++)Mt(T.symbolInstances.get(et),et,T.collisionArrays[et]);if(m&&T.bucketInstanceId in this.collisionCircleArrays){const et=this.collisionCircleArrays[T.bucketInstanceId];o.invert(et.invProjMatrix,I),et.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(r,l,m,v){const{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:F,crossTileID:G}=m,$=o.getAnchorJustification(l),K=v===o.WritingMode.vertical?F:$==="left"?T:$==="center"?P:$==="right"?I:-1;T>=0&&(r.text.placedSymbolArray.get(T).crossTileID=K>=0&&T!==K?0:G),P>=0&&(r.text.placedSymbolArray.get(P).crossTileID=K>=0&&P!==K?0:G),I>=0&&(r.text.placedSymbolArray.get(I).crossTileID=K>=0&&I!==K?0:G),F>=0&&(r.text.placedSymbolArray.get(F).crossTileID=K>=0&&F!==K?0:G)}markUsedOrientation(r,l,m){const v=l===o.WritingMode.horizontal||l===o.WritingMode.horizontalOnly?l:0,T=l===o.WritingMode.vertical?l:0,{leftJustifiedTextSymbolIndex:P,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:F,verticalPlacedTextSymbolIndex:G}=m,$=r.text.placedSymbolArray;P>=0&&($.get(P).placedOrientation=v),I>=0&&($.get(I).placedOrientation=v),F>=0&&($.get(F).placedOrientation=v),G>=0&&($.get(G).placedOrientation=T)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let m=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const v=l?l.symbolFadeChange(r):1,T=l?l.opacities:{},P=l?l.variableOffsets:{},I=l?l.placedOrientations:{};for(const F in this.placements){const G=this.placements[F],$=T[F];$?(this.opacities[F]=new eo($,v,G.text,G.icon,null,G.clipped),m=m||G.text!==$.text.placed||G.icon!==$.icon.placed):(this.opacities[F]=new eo(null,v,G.text,G.icon,G.skipFade,G.clipped),m=m||G.text||G.icon)}for(const F in T){const G=T[F];if(!this.opacities[F]){const $=new eo(G,v,!1,!1);$.isHidden()||(this.opacities[F]=$,m=m||G.text.placed||G.icon.placed)}}for(const F in P)this.variableOffsets[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.variableOffsets[F]=P[F]);for(const F in I)this.placedOrientations[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.placedOrientations[F]=I[F]);m?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l){const m=new Set;for(const v of l){const T=v.getBucket(r);T&&v.latestFeatureIndex&&r.id===T.layerIds[0]&&this.updateBucketOpacities(T,m,v.collisionBoxArray)}}updateBucketOpacities(r,l,m){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const v=r.layers[0].layout,T=!!r.layers[0].dynamicFilter(),P=new eo(null,0,!1,!1,!0),I=v.get("text-allow-overlap"),F=v.get("icon-allow-overlap"),G=v.get("text-variable-anchor"),$=v.get("text-rotation-alignment")==="map",K=v.get("text-pitch-alignment")==="map",le=v.get("icon-text-fit")!=="none",de=new eo(null,0,I&&(F||!r.hasIconData()||v.get("icon-optional")),F&&(I||!r.hasTextData()||v.get("text-optional")),!0);!r.collisionArrays&&m&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(m);const fe=(ge,J,ue)=>{for(let ve=0;ve<J/4;ve++)ge.opacityVertexArray.emplaceBack(ue)};let pe=0;for(let ge=0;ge<r.symbolInstances.length;ge++){const J=r.symbolInstances.get(ge),{numHorizontalGlyphVertices:ue,numVerticalGlyphVertices:ve,crossTileID:be,numIconVertices:ze}=J,Pe=l.has(be);let Oe=this.opacities[be];Pe?Oe=P:Oe||(Oe=de,this.opacities[be]=Oe),l.add(be);const Xe=ue>0||ve>0,$e=ze>0,it=this.placedOrientations[be],Mt=it===o.WritingMode.vertical,et=it===o.WritingMode.horizontal||it===o.WritingMode.horizontalOnly;if(!Xe&&!$e||Oe.isHidden()||pe++,Xe){const gt=wn(Oe.text);fe(r.text,ue,Mt?rs:gt),fe(r.text,ve,et?rs:gt);const ot=Oe.text.isHidden(),{leftJustifiedTextSymbolIndex:Pt,centerJustifiedTextSymbolIndex:Je,rightJustifiedTextSymbolIndex:_t,verticalPlacedTextSymbolIndex:Lt}=J,ft=r.text.placedSymbolArray,Rt=ot||Mt?1:0;Pt>=0&&(ft.get(Pt).hidden=Rt),Je>=0&&(ft.get(Je).hidden=Rt),_t>=0&&(ft.get(_t).hidden=Rt),Lt>=0&&(ft.get(Lt).hidden=ot||et?1:0);const mi=this.variableOffsets[be];mi&&this.markUsedJustification(r,mi.anchor,J,it);const ki=this.placedOrientations[be];ki&&(this.markUsedJustification(r,"left",J,ki),this.markUsedOrientation(r,ki,J))}if($e){const gt=wn(Oe.icon),{placedIconSymbolIndex:ot,verticalPlacedIconSymbolIndex:Pt}=J,Je=r.icon.placedSymbolArray,_t=Oe.icon.isHidden()?1:0;ot>=0&&(fe(r.icon,ze,Mt?rs:gt),Je.get(ot).hidden=_t),Pt>=0&&(fe(r.icon,J.numVerticalIconVertices,et?rs:gt),Je.get(Pt).hidden=_t)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const gt=r.collisionArrays[ge];if(gt){let ot=new o.Point(0,0),Pt=!0;if(gt.textBox||gt.verticalTextBox){if(G){const _t=this.variableOffsets[be];_t?(ot=_l(_t.anchor,_t.width,_t.height,_t.textOffset,_t.textScale),$&&ot._rotate(K?this.transform.angle:-this.transform.angle)):Pt=!1}T&&(Pt=!Oe.clipped),gt.textBox&&$o(r.textCollisionBox.collisionVertexArray,Oe.text.placed,!Pt||Mt,ot.x,ot.y),gt.verticalTextBox&&$o(r.textCollisionBox.collisionVertexArray,Oe.text.placed,!Pt||et,ot.x,ot.y)}const Je=Pt&&!!(!et&&gt.verticalIconBox);gt.iconBox&&$o(r.iconCollisionBox.collisionVertexArray,Oe.icon.placed,Je,le?ot.x:0,le?ot.y:0),gt.verticalIconBox&&$o(r.iconCollisionBox.collisionVertexArray,Oe.icon.placed,!Je,le?ot.x:0,le?ot.y:0)}}}if(r.fullyClipped=pe===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const ge=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=ge.invProjMatrix,r.placementViewportMatrix=ge.viewportMatrix,r.collisionCircleArray=ge.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){const m=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*m>r}setStale(){this.stale=!0}}function $o(d,r,l,m,v){d.emplaceBack(r?1:0,l?1:0,m||0,v||0),d.emplaceBack(r?1:0,l?1:0,m||0,v||0),d.emplaceBack(r?1:0,l?1:0,m||0,v||0),d.emplaceBack(r?1:0,l?1:0,m||0,v||0)}const vn=Math.pow(2,25),cs=Math.pow(2,24),vu=Math.pow(2,17),dc=Math.pow(2,16),bn=Math.pow(2,9),un=Math.pow(2,8),bu=Math.pow(2,1);function wn(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const r=d.placed?1:0,l=Math.floor(127*d.opacity);return l*vn+r*cs+l*vu+r*dc+l*bn+r*un+l*bu+r}const rs=0;class Wo{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,l,m,v,T){const P=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(P,v,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((I,F)=>I.sortKey-F.sortKey));this._currentPartIndex<P.length;){const I=P[this._currentPartIndex];if(l.placeLayerBucketPart(I,this._seenCrossTileIDs,m,I.symbolInstanceStart===0),this._currentPartIndex++,T())return!0}return!1}}class pc{constructor(r,l,m,v,T,P,I,F){this.placement=new ih(r,T,P,I,F),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(r,l,m){const v=o.exported.now(),T=()=>{const P=o.exported.now()-v;return!this._forceFullPlacement&&P>2};for(;this._currentPlacementIndex>=0;){const P=l[r[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=I)&&(!P.maxzoom||P.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new Wo(P)),this._inProgressLayer.continuePlacement(m[P.source],this.placement,this._showCollisionBoxes,P,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Ho=512/o.EXTENT/2;class Us{constructor(r,l,m){this.tileID=r,this.bucketInstanceId=m,this.index=new o.KDBush(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=r.canonical.x*o.EXTENT,T=r.canonical.y*o.EXTENT;for(let P=0;P<l.length;P++){const{key:I,crossTileID:F,tileAnchorX:G,tileAnchorY:$}=l.get(P),K=Math.floor((v+G)*Ho),le=Math.floor((T+$)*Ho);this.index.add(K,le),this.keys.push(I),this.crossTileIDs.push(F)}this.index.finish()}findMatches(r,l,m){const v=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),T=Ho/Math.pow(2,l.canonical.z-this.tileID.canonical.z),P=l.canonical.x*o.EXTENT,I=l.canonical.y*o.EXTENT;for(let F=0;F<r.length;F++){const G=r.get(F);if(G.crossTileID)continue;const{key:$,tileAnchorX:K,tileAnchorY:le}=G,de=Math.floor((P+K)*T),fe=Math.floor((I+le)*T),pe=this.index.range(de-v,fe-v,de+v,fe+v);for(const ge of pe){const J=this.crossTileIDs[ge];if(this.keys[ge]===$&&!m.has(J)){m.add(J),G.crossTileID=J;break}}}}}class rh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class wu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const l=Math.round((r-this.lng)/360);if(l!==0)for(const m in this.indexes){const v=this.indexes[m],T={};for(const P in v){const I=v[P];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+l),T[I.tileID.key]=I}this.indexes[m]=T}this.lng=r}addBucket(r,l,m){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let T=0;T<l.symbolInstances.length;T++)l.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const v=this.usedCrossTileIDs[r.overscaledZ];for(const T in this.indexes){const P=this.indexes[T];if(Number(T)>r.overscaledZ)for(const I in P){const F=P[I];F.tileID.isChildOf(r)&&F.findMatches(l.symbolInstances,r,v)}else{const I=P[r.scaledTo(Number(T)).key];I&&I.findMatches(l.symbolInstances,r,v)}}for(let T=0;T<l.symbolInstances.length;T++){const P=l.symbolInstances.get(T);P.crossTileID||(P.crossTileID=m.generate(),v.add(P.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Us(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(const m of l.crossTileIDs)this.usedCrossTileIDs[r].delete(m)}removeStaleBuckets(r){let l=!1;for(const m in this.indexes){const v=this.indexes[m];for(const T in v)r[v[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,v[T]),delete v[T],l=!0)}return l}}class qo{constructor(){this.layerIndexes={},this.crossTileIDs=new rh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,m,v){let T=this.layerIndexes[r.id];T===void 0&&(T=this.layerIndexes[r.id]=new wu);let P=!1;const I={};v.name!=="globe"&&T.handleWrapJump(m);for(const F of l){const G=F.getBucket(r);G&&r.id===G.layerIds[0]&&(G.bucketInstanceId||(G.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(F.tileID,G,this.crossTileIDs)&&(P=!0),I[G.bucketInstanceId]=!0)}return T.removeStaleBuckets(I)&&(P=!0),P}pruneUnusedLayers(r){const l={};r.forEach(m=>{l[m]=!0});for(const m in this.layerIndexes)l[m]||delete this.layerIndexes[m]}}const Xo=(d,r)=>o.emitValidationErrors(d,r&&r.filter(l=>l.identifier!=="source.canvas")),yl=o.pick(mr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),xl=o.pick(mr,["setCenter","setZoom","setBearing","setPitch"]),to={version:8,layers:[],sources:{}},Zo={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class So extends o.Evented{constructor(r,l={}){super(),this.map=r,this.dispatcher=new Tr(ls(),this),this.imageManager=new Ot,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(r._requestManager,l.localFontFamily?o.LocalGlyphMode.all:l.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.crossTileSymbolIndex=new qo,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const m=this;this._rtlTextPluginCallback=So.registerForPluginStateChange(v=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(T,P)=>{if(o.triggerPluginCompletionEvent(T),P&&P.every(I=>I))for(const I in m._sourceCaches){const F=m._sourceCaches[I],G=F.getSource().type;G!=="vector"&&G!=="geojson"||F.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const T=this.getSource(v.sourceId);if(T&&T.vectorLayerIds)for(const P in this._layers){const I=this._layers[P];I.source===T.id&&this._validateLayer(I)}})}loadURL(r,l={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const m=typeof l.validate=="boolean"?l.validate:!o.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,l.accessToken);const v=this.map._requestManager.transformRequest(r,o.ResourceType.Style);this._request=o.getJSON(v,(T,P)=>{this._request=null,T?this.fire(new o.ErrorEvent(T)):P&&this._load(P,m)})}loadJSON(r,l={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(r,l.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(to,!1)}_updateLayerCount(r,l){const m=l?1:-1;r.is3D()&&(this._num3DLayers+=m),r.type==="circle"&&(this._numCircleLayers+=m),r.type==="symbol"&&(this._numSymbolLayers+=m)}_load(r,l){if(l&&Xo(this,o.validateStyle(r)))return;this._loaded=!0,this.stylesheet=o.clone$1(r),this._updateMapProjection();for(const v in r.sources)this.addSource(v,r.sources[v],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const m=Zd(this.stylesheet.layers);this._order=m.map(v=>v.id),this._layers={},this._serializedLayers={};for(const v of m){const T=o.createStyleLayer(v);T.setEventedParent(this,{layer:{id:T.id}}),this._layers[T.id]=T,this._serializedLayers[T.id]=T.serialize(),this._updateLayerCount(T,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ti(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(l,m,v){let T,P,I;const F=o.exported.devicePixelRatio>1?"@2x":"";let G=o.getJSON(m.transformRequest(m.normalizeSpriteURL(l,F,".json"),o.ResourceType.SpriteJSON),(le,de)=>{G=null,I||(I=le,T=de,K())}),$=o.getImage(m.transformRequest(m.normalizeSpriteURL(l,F,".png"),o.ResourceType.SpriteImage),(le,de)=>{$=null,I||(I=le,P=de,K())});function K(){if(I)v(I);else if(T&&P){const le=o.exported.getImageData(P),de={};for(const fe in T){const{width:pe,height:ge,x:J,y:ue,sdf:ve,pixelRatio:be,stretchX:ze,stretchY:Pe,content:Oe}=T[fe],Xe=new o.RGBAImage({width:pe,height:ge});o.RGBAImage.copy(le,Xe,{x:J,y:ue},{x:0,y:0},{width:pe,height:ge}),de[fe]={data:Xe,pixelRatio:be,sdf:ve,stretchX:ze,stretchY:Pe,content:Oe}}v(null,de)}}return{cancel(){G&&(G.cancel(),G=null),$&&($.cancel(),$=null)}}}(r,this.map._requestManager,(l,m)=>{if(this._spriteRequest=null,l)this.fire(new o.ErrorEvent(l));else if(m)for(const v in m)this.imageManager.addImage(v,m[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(r){const l=this.getSource(r.source);if(!l)return;const m=r.sourceLayer;m&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(m)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${l.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const l=[];for(const m of r){const v=this._layers[m];v.type!=="custom"&&l.push(v.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&(typeof r.isLayerDraped=="function"?r.isLayerDraped():Zo[r.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const l=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);(v.length||T.length)&&this._updateWorkerLayers(v,T);for(const P in this._updatedSources){const I=this._updatedSources[P];I==="reload"?this._reloadSource(P):I==="clear"&&this._clearSource(P)}this._updateTilesForChangedImages();for(const P in this._updatedPaintProps)this._layers[P].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const m={};for(const v in this._sourceCaches){const T=this._sourceCaches[v];m[v]=T.used,T.used=!1}for(const v of this._order){const T=this._layers[v];if(T.recalculate(r,this._availableImages),!T.isHidden(r.zoom)){const I=this._getLayerSourceCache(T);I&&(I.used=!0)}const P=this.map.painter;if(P){const I=T.getProgramIds();if(!I)continue;const F=T.getProgramConfiguration(r.zoom);for(const G of I)P.useProgram(G,F)}}for(const v in m){const T=this._sourceCaches[v];m[v]!==T.used&&T.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:T.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),Xo(this,o.validateStyle(r)))return!1;(r=o.clone$1(r)).layers=Zd(r.layers);const l=function(v,T){if(!v)return[{command:mr.setStyle,args:[T]}];let P=[];try{if(!X(v.version,T.version))return[{command:mr.setStyle,args:[T]}];X(v.center,T.center)||P.push({command:mr.setCenter,args:[T.center]}),X(v.zoom,T.zoom)||P.push({command:mr.setZoom,args:[T.zoom]}),X(v.bearing,T.bearing)||P.push({command:mr.setBearing,args:[T.bearing]}),X(v.pitch,T.pitch)||P.push({command:mr.setPitch,args:[T.pitch]}),X(v.sprite,T.sprite)||P.push({command:mr.setSprite,args:[T.sprite]}),X(v.glyphs,T.glyphs)||P.push({command:mr.setGlyphs,args:[T.glyphs]}),X(v.transition,T.transition)||P.push({command:mr.setTransition,args:[T.transition]}),X(v.light,T.light)||P.push({command:mr.setLight,args:[T.light]}),X(v.fog,T.fog)||P.push({command:mr.setFog,args:[T.fog]}),X(v.projection,T.projection)||P.push({command:mr.setProjection,args:[T.projection]});const I={},F=[];(function(K,le,de,fe){let pe;for(pe in le=le||{},K=K||{})K.hasOwnProperty(pe)&&(le.hasOwnProperty(pe)||cc(pe,de,fe));for(pe in le){if(!le.hasOwnProperty(pe))continue;const ge=le[pe];K.hasOwnProperty(pe)?X(K[pe],ge)||(K[pe].type==="geojson"&&ge.type==="geojson"&&eh(K,le,pe)?de.push({command:mr.setGeoJSONSourceData,args:[pe,ge.data]}):Qc(pe,le,de,fe)):gu(pe,le,de)}})(v.sources,T.sources,F,I);const G=[];v.layers&&v.layers.forEach(K=>{K.source&&I[K.source]?P.push({command:mr.removeLayer,args:[K.id]}):G.push(K)});let $=v.terrain;$&&I[$.source]&&(P.push({command:mr.setTerrain,args:[void 0]}),$=void 0),P=P.concat(F),X($,T.terrain)||P.push({command:mr.setTerrain,args:[T.terrain]}),function(K,le,de){le=le||[];const fe=(K=K||[]).map(vo),pe=le.map(vo),ge=K.reduce(_u,{}),J=le.reduce(_u,{}),ue=fe.slice(),ve=Object.create(null);let be,ze,Pe,Oe,Xe,$e,it;for(be=0,ze=0;be<fe.length;be++)Pe=fe[be],J.hasOwnProperty(Pe)?ze++:(de.push({command:mr.removeLayer,args:[Pe]}),ue.splice(ue.indexOf(Pe,ze),1));for(be=0,ze=0;be<pe.length;be++)Pe=pe[pe.length-1-be],ue[ue.length-1-be]!==Pe&&(ge.hasOwnProperty(Pe)?(de.push({command:mr.removeLayer,args:[Pe]}),ue.splice(ue.lastIndexOf(Pe,ue.length-ze),1)):ze++,$e=ue[ue.length-be],de.push({command:mr.addLayer,args:[J[Pe],$e]}),ue.splice(ue.length-be,0,Pe),ve[Pe]=!0);for(be=0;be<pe.length;be++)if(Pe=pe[be],Oe=ge[Pe],Xe=J[Pe],!ve[Pe]&&!X(Oe,Xe))if(X(Oe.source,Xe.source)&&X(Oe["source-layer"],Xe["source-layer"])&&X(Oe.type,Xe.type)){for(it in Jn(Oe.layout,Xe.layout,de,Pe,null,mr.setLayoutProperty),Jn(Oe.paint,Xe.paint,de,Pe,null,mr.setPaintProperty),X(Oe.filter,Xe.filter)||de.push({command:mr.setFilter,args:[Pe,Xe.filter]}),X(Oe.minzoom,Xe.minzoom)&&X(Oe.maxzoom,Xe.maxzoom)||de.push({command:mr.setLayerZoomRange,args:[Pe,Xe.minzoom,Xe.maxzoom]}),Oe)Oe.hasOwnProperty(it)&&it!=="layout"&&it!=="paint"&&it!=="filter"&&it!=="metadata"&&it!=="minzoom"&&it!=="maxzoom"&&(it.indexOf("paint.")===0?Jn(Oe[it],Xe[it],de,Pe,it.slice(6),mr.setPaintProperty):X(Oe[it],Xe[it])||de.push({command:mr.setLayerProperty,args:[Pe,it,Xe[it]]}));for(it in Xe)Xe.hasOwnProperty(it)&&!Oe.hasOwnProperty(it)&&it!=="layout"&&it!=="paint"&&it!=="filter"&&it!=="metadata"&&it!=="minzoom"&&it!=="maxzoom"&&(it.indexOf("paint.")===0?Jn(Oe[it],Xe[it],de,Pe,it.slice(6),mr.setPaintProperty):X(Oe[it],Xe[it])||de.push({command:mr.setLayerProperty,args:[Pe,it,Xe[it]]}))}else de.push({command:mr.removeLayer,args:[Pe]}),$e=ue[ue.lastIndexOf(Pe)+1],de.push({command:mr.addLayer,args:[Xe,$e]})}(G,T.layers,P)}catch(I){console.warn("Unable to compute style diff:",I),P=[{command:mr.setStyle,args:[T]}]}return P}(this.serialize(),r).filter(v=>!(v.command in xl));if(l.length===0)return!1;const m=l.filter(v=>!(v.command in yl));if(m.length>0)throw new Error(`Unimplemented: ${m.map(v=>v.command).join(", ")}.`);return l.forEach(v=>{v.command!=="setTransition"&&v.command!=="setProjection"&&this[v.command].apply(this,v.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,l){return this.getImage(r)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,l),this._afterImageUpdated(r),this)}updateImage(r,l){this.imageManager.updateImage(r,l)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,l,m={}){if(this._checkLoaded(),this.getSource(r)!==void 0)throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(o.validateSource,`sources.${r}`,l,null,m))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const v=Xi(r,l,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:v.serialize(),sourceId:r}));const T=P=>{const I=(P?"symbol:":"other:")+r,F=this._sourceCaches[I]=new o.SourceCache(I,v,P);(P?this._symbolSourceCaches:this._otherSourceCaches)[r]=F,F.style=this,F.onAdd(this.map)};T(!1),l.type!=="vector"&&l.type!=="geojson"||T(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const l=this.getSource(r);if(!l)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===r)return this.fire(new o.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new o.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(r);for(const v of m)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,l){this._checkLoaded(),this.getSource(r).setData(l),this._changed=!0}getSource(r){const l=this._getSourceCache(r);return l&&l.getSource()}_getSources(){const r=[];for(const l in this._otherSourceCaches){const m=this._getSourceCache(l);m&&r.push(m.getSource())}return r}addLayer(r,l,m={}){this._checkLoaded();const v=r.id;if(this.getLayer(v))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let T;if(r.type==="custom"){if(Xo(this,o.validateCustomStyleLayer(r)))return;T=o.createStyleLayer(r)}else{if(typeof r.source=="object"&&(this.addSource(v,r.source),r=o.clone$1(r),r=o.extend(r,{source:v})),this._validate(o.validateLayer,`layers.${v}`,r,{arrayIndex:-1},m))return;T=o.createStyleLayer(r),this._validateLayer(T),T.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[T.id]=T.serialize(),this._updateLayerCount(T,!0)}const P=l?this._order.indexOf(l):this._order.length;if(l&&P===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(P,0,v),this._layerOrderChanged=!0,this._layers[v]=T;const I=this._getLayerSourceCache(T);if(this._removedLayers[v]&&T.source&&I&&T.type!=="custom"){const F=this._removedLayers[v];delete this._removedLayers[v],F.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",I.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,l){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===l)return;const m=this._order.indexOf(r);this._order.splice(m,1);const v=l?this._order.indexOf(l):this._order.length;l&&v===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(v,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const l=this._layers[r];if(!l)return void this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const m=this._order.indexOf(r);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=l,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const l in this._layers)if(this._layers[l].type===r)return!0;return!1}setLayerZoomRange(r,l,m){this._checkLoaded();const v=this.getLayer(r);v?v.minzoom===l&&v.maxzoom===m||(l!=null&&(v.minzoom=l),m!=null&&(v.maxzoom=m),this._updateLayer(v)):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,l,m={}){this._checkLoaded();const v=this.getLayer(r);if(v){if(!X(v.filter,l))return l==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(o.validateFilter,`layers.${v.id}.filter`,l,{layerType:v.type},m)||(v.filter=o.clone$1(l),this._updateLayer(v)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const l=this.getLayer(r);return l&&o.clone$1(l.filter)}setLayoutProperty(r,l,m,v={}){this._checkLoaded();const T=this.getLayer(r);T?X(T.getLayoutProperty(l),m)||(T.setLayoutProperty(l,m,v),this._updateLayer(T)):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,l){const m=this.getLayer(r);if(m)return m.getLayoutProperty(l);this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,l,m,v={}){this._checkLoaded();const T=this.getLayer(r);T?X(T.getPaintProperty(l),m)||(T.setPaintProperty(l,m,v)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,l){const m=this.getLayer(r);return m&&m.getPaintProperty(l)}setFeatureState(r,l){this._checkLoaded();const m=r.source,v=r.sourceLayer,T=this.getSource(m);if(!T)return void this.fire(new o.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const P=T.type;if(P==="geojson"&&v)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(P==="vector"&&!v)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const I=this._getSourceCaches(m);for(const F of I)F.setFeatureState(v,r.id,l)}removeFeatureState(r,l){this._checkLoaded();const m=r.source,v=this.getSource(m);if(!v)return void this.fire(new o.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const T=v.type,P=T==="vector"?r.sourceLayer:void 0;if(T==="vector"&&!P)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const I=this._getSourceCaches(m);for(const F of I)F.removeFeatureState(P,r.id,l)}getFeatureState(r){this._checkLoaded();const l=r.source,m=r.sourceLayer,v=this.getSource(l);if(v){if(v.type!=="vector"||m)return r.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(m,r.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const l in this._sourceCaches){const m=this._sourceCaches[l].getSource();r[m.id]||(r[m.id]=m.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},l=>l!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0;const l=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&l&&l.getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",l.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const l=P=>this._layers[P].type==="fill-extrusion",m={},v=[];for(let P=this._order.length-1;P>=0;P--){const I=this._order[P];if(l(I)){m[I]=P;for(const F of r){const G=F[I];if(G)for(const $ of G)v.push($)}}}v.sort((P,I)=>I.intersectionZ-P.intersectionZ);const T=[];for(let P=this._order.length-1;P>=0;P--){const I=this._order[P];if(l(I))for(let F=v.length-1;F>=0;F--){const G=v[F].feature;if(m[G.layer.id]<P)break;T.push(G),v.pop()}else for(const F of r){const G=F[I];if(G)for(const $ of G)T.push($.feature)}}return T}queryRenderedFeatures(r,l,m){l&&l.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);const v={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const F of l.layers){const G=this._layers[F];if(!G)return this.fire(new o.ErrorEvent(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];v[G.source]=!0}}const T=[];l.availableImages=this._availableImages;const P=l&&l.layers?l.layers.some(F=>{const G=this.getLayer(F);return G&&G.is3D()}):this.has3DLayers(),I=Ts.createFromScreenPoints(r,m);for(const F in this._sourceCaches){const G=this._sourceCaches[F].getSource().id;l.layers&&!v[G]||T.push(Yr(this._sourceCaches[F],this._layers,this._serializedLayers,I,l,m,P,!!this.map._showQueryGeometry))}return this.placement&&T.push(function(F,G,$,K,le,de,fe){const pe={},ge=de.queryRenderedSymbols(K),J=[];for(const ue of Object.keys(ge).map(Number))J.push(fe[ue]);J.sort(Hs);for(const ue of J){const ve=ue.featureIndex.lookupSymbolFeatures(ge[ue.bucketInstanceId],G,ue.bucketIndex,ue.sourceLayerIndex,le.filter,le.layers,le.availableImages,F);for(const be in ve){const ze=pe[be]=pe[be]||[],Pe=ve[be];Pe.sort((Oe,Xe)=>{const $e=ue.featureSortOrder;if($e){const it=$e.indexOf(Oe.featureIndex);return $e.indexOf(Xe.featureIndex)-it}return Xe.featureIndex-Oe.featureIndex});for(const Oe of Pe)ze.push(Oe)}}for(const ue in pe)pe[ue].forEach(ve=>{const be=ve.feature,ze=$(F[ue]);if(!ze)return;const Pe=ze.getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=Pe});return pe}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),I.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(r,l){l&&l.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",l.filter,null,l);const m=this._getSourceCaches(r);let v=[];for(const T of m)v=v.concat(is(T,l));return v}addSourceType(r,l,m){return So.getSourceType(r)?m(new Error(`A source type called "${r}" already exists.`)):(So.setSourceType(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(r,l={}){this._checkLoaded();const m=this.light.getLight();let v=!1;for(const P in r)if(!X(r[P],m[P])){v=!0;break}if(!v)return;const T=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,l),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,l=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let m=r;if(l===1){if(typeof m.source=="object"){const v="terrain-dem-src";this.addSource(v,m.source),m=o.clone$1(m),m=o.extend(m,{source:v})}if(this._validate(o.validateTerrain,"terrain",m))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,l)}else{const v=this.terrain,T=v.get();for(const P of Object.keys(o.spec.terrain))!m.hasOwnProperty(P)&&o.spec.terrain[P].default&&(m[P]=o.spec.terrain[P].default);for(const P in m)if(!X(m[P],T[P])){v.set(m),this.stylesheet.terrain=m;const I=this._setTransitionParameters({duration:0});v.updateTransitions(I);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const l=this.fog=new ws(r,this.map.transform);this.stylesheet.fog=r;const m=this._setTransitionParameters({duration:0});l.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,m=l.get();Object.keys(r).length===0&&l.set(r);for(const v in r)if(!X(r[v],m[v])){l.set(r),this.stylesheet.fog=r;const T=this._setTransitionParameters({duration:0});l.updateTransitions(T);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:o.exported.now(),transition:o.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(m=>this.isLayerDraped(this._layers[m])),l=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...l)}_createTerrain(r,l){const m=this.terrain=new li(r,l);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const v=this._setTransitionParameters({duration:0});m.updateTransitions(v)}_force3DLayerUpdate(){for(const r in this._layers){const l=this._layers[r];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const l=this._layers[r];l.type==="symbol"&&this._updateLayer(l)}}_validate(r,l,m,v,T={}){return(!T||T.validate!==!1)&&Xo(this,r.call(o.validateStyle,o.extend({key:l,style:this.serialize(),value:m,styleSpec:o.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const l=this._getSourceCaches(r);for(const m of l)m.clearTiles()}_reloadSource(r){const l=this._getSourceCaches(r);for(const m of l)m.resume(),m.reload()}_reloadSources(){for(const r of this._getSources())r.reload&&r.reload()}_updateSources(r){for(const l in this._sourceCaches)this._sourceCaches[l].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const l=this._sourceCaches[r];l.resume(),l.reload()}}_updatePlacement(r,l,m,v,T=!1){let P=!1,I=!1;const F={};for(const G of this._order){const $=this._layers[G];if($.type!=="symbol")continue;if(!F[$.source]){const le=this._getLayerSourceCache($);if(!le)continue;F[$.source]=le.getRenderableIds(!0).map(de=>le.getTileByID(de)).sort((de,fe)=>fe.tileID.overscaledZ-de.tileID.overscaledZ||(de.tileID.isLessThan(fe.tileID)?-1:1))}const K=this.crossTileSymbolIndex.addLayer($,F[$.source],r.center.lng,r.projection);P=P||K}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),T=T||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(T||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),r.zoom))&&(this.pauseablePlacement=new pc(r,this._order,T,l,m,v,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,F),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),I=!0),P&&this.pauseablePlacement.placement.setStale()),I||P)for(const G of this._order){const $=this._layers[G];$.type==="symbol"&&this.placement.updateLayerOpacities($,F[$.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,l,m){this.imageManager.getImages(l.icons,m),this._updateTilesForChangedImages();const v=T=>{T&&T.setDependencies(l.tileID.key,l.type,l.icons)};v(this._otherSourceCaches[l.source]),v(this._symbolSourceCaches[l.source])}getGlyphs(r,l,m){this.glyphManager.getGlyphs(l.stacks,m)}getResource(r,l,m){return o.makeRequest(l,m)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const l=[];return this._otherSourceCaches[r]&&l.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&l.push(this._symbolSourceCaches[r]),l}_isSourceCacheLoaded(r){const l=this._getSourceCaches(r);return l.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):l.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}So.getSourceType=function(d){return zi[d]},So.setSourceType=function(d,r){zi[d]=r},So.registerForPluginStateChange=o.registerForPluginStateChange;var Tu=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,za="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ao=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,ss=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,js=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let fc={},vl={};const bl=[];Rn(Tu,bl),Rn(Ao,bl),Rn(ss,bl),Rn(js,bl),fc=pr("",Ao),vl=pr(js,ss);const wl=pr(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),sh=Tu,Tl=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var nh={background:pr(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:pr(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:pr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:pr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:pr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:pr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:pr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:pr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:pr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:pr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:pr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:pr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:pr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:pr(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:pr(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:pr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:pr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:pr(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:pr(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:pr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:pr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:pr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:pr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:pr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:pr(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:pr(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,za),skyboxGradient:pr(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,za),skyboxCapture:pr(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:pr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:pr(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Rn(d,r){const l=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of l)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=m.split(" ");for(const T of v)r.includes(T)||r.push(T)}}function pr(d,r){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),v={},T=[...bl];return Rn(d,T),Rn(r,T),{fragmentSource:d=d.replace(l,(P,I,F,G,$)=>(v[$]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${$}
varying ${F} ${G} ${$};
#else
uniform ${F} ${G} u_${$};
#endif
`:`
#ifdef HAS_UNIFORM_u_${$}
    ${F} ${G} ${$} = u_${$};
#endif
`)),vertexSource:r=r.replace(l,(P,I,F,G,$)=>{const K=G==="float"?"vec2":"vec4",le=$.match(/color/)?"color":K;return v[$]?I==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${F} ${K} a_${$};
varying ${F} ${G} ${$};
#else
uniform ${F} ${G} u_${$};
#endif
`:le==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${F} ${G} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${le}(a_${$}, u_${$}_t);
#else
    ${F} ${G} ${$} = u_${$};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${F} ${K} a_${$};
#else
uniform ${F} ${G} u_${$};
#endif
`:le==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${F} ${G} ${$} = a_${$};
#else
    ${F} ${G} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${F} ${G} ${$} = unpack_mix_${le}(a_${$}, u_${$}_t);
#else
    ${F} ${G} ${$} = u_${$};
#endif
`}),staticAttributes:m,usedDefines:T}}class Mf{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,l,m,v,T,P,I){this.context=r;let F=this.boundPaintVertexBuffers.length!==v.length;for(let $=0;!F&&$<v.length;$++)this.boundPaintVertexBuffers[$]!==v[$]&&(F=!0);let G=this.boundDynamicVertexBuffers.length!==I.length;for(let $=0;!G&&$<I.length;$++)this.boundDynamicVertexBuffers[$]!==I[$]&&(G=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==m||F||G||this.boundIndexBuffer!==T||this.boundVertexOffset!==P)this.freshBind(l,m,v,T,P,I);else{r.bindVertexArrayOES.set(this.vao);for(const $ of I)$&&$.bind();T&&T.dynamicDraw&&T.bind()}}freshBind(r,l,m,v,T,P){let I;const F=r.numAttributes,G=this.context,$=G.gl;if(G.extVertexArrayObject)this.vao&&this.destroy(),this.vao=G.extVertexArrayObject.createVertexArrayOES(),G.bindVertexArrayOES.set(this.vao),I=0,this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=v,this.boundVertexOffset=T,this.boundDynamicVertexBuffers=P;else{I=G.currentNumAttributes||0;for(let K=F;K<I;K++)$.disableVertexAttribArray(K)}l.enableAttributes($,r),l.bind(),l.setVertexAttribPointers($,r,T);for(const K of m)K.enableAttributes($,r),K.bind(),K.setVertexAttribPointers($,r,T);for(const K of P)K&&(K.enableAttributes($,r),K.bind(),K.setVertexAttribPointers($,r,T));v&&v.bind(),G.currentNumAttributes=F}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Oa(d,r){const l=Math.pow(2,r.canonical.z),m=r.canonical.y;return[new o.MercatorCoordinate(0,m/l).toLngLat().lat,new o.MercatorCoordinate(0,(m+1)/l).toLngLat().lat]}function Eu(d,r,l,m,v,T,P){const I=d.context,F=I.gl,G=l.fbo;if(!G)return;d.prepareDrawTile();const $=d.useProgram("hillshade");I.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,G.colorAttachment.get());const K=((pe,ge,J,ue)=>{const ve=J.paint.get("hillshade-shadow-color"),be=J.paint.get("hillshade-highlight-color"),ze=J.paint.get("hillshade-accent-color");let Pe=J.paint.get("hillshade-illumination-direction")*(Math.PI/180);J.paint.get("hillshade-illumination-anchor")==="viewport"&&(Pe-=pe.transform.angle);const Oe=!pe.options.moving;return{u_matrix:ue||pe.transform.calculateProjMatrix(ge.tileID.toUnwrapped(),Oe),u_image:0,u_latrange:Oa(0,ge.tileID),u_light:[J.paint.get("hillshade-exaggeration"),Pe],u_shadow:ve,u_highlight:be,u_accent:ze}})(d,l,m,d.terrain?r.projMatrix:null);d.prepareDrawProgram(I,$,r.toUnwrapped());const{tileBoundsBuffer:le,tileBoundsIndexBuffer:de,tileBoundsSegments:fe}=d.getTileBoundsBuffers(l);$.draw(I,F.TRIANGLES,v,T,P,o.CullFaceMode.disabled,K,m.id,le,de,fe)}function oh(d,r,l){if(!r.needsDEMTextureUpload)return;const m=d.context,v=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||d.getTileTexture(l.stride);const T=l.getPixels();r.demTexture?r.demTexture.update(T,{premultiply:!1}):r.demTexture=new o.Texture(m,T,v.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function ah(d,r,l,m,v,T){const P=d.context,I=P.gl;if(!r.dem)return;const F=r.dem;if(P.activeTexture.set(I.TEXTURE1),oh(d,r,F),!r.demTexture)return;r.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);const G=F.dim;P.activeTexture.set(I.TEXTURE0);let $=r.fbo;if(!$){const fe=new o.Texture(P,{width:G,height:G,data:null},I.RGBA);fe.bind(I.LINEAR,I.CLAMP_TO_EDGE),$=r.fbo=P.createFramebuffer(G,G,!0),$.colorAttachment.set(fe.texture)}P.bindFramebuffer.set($.framebuffer),P.viewport.set([0,0,G,G]);const{tileBoundsBuffer:K,tileBoundsIndexBuffer:le,tileBoundsSegments:de}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(P,I.TRIANGLES,m,v,T,o.CullFaceMode.disabled,((fe,pe)=>{const ge=pe.stride,J=o.create();return o.ortho(J,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(J,J,[0,-o.EXTENT,0]),{u_matrix:J,u_image:1,u_dimension:[ge,ge],u_zoom:fe.overscaledZ,u_unpack:pe.unpackVector}})(r.tileID,F),l.id,K,le,de),r.needsHillshadePrepare=!1}const lh=d=>({u_matrix:new o.UniformMatrix4f(d),u_image0:new o.Uniform1i(d),u_skirt_height:new o.Uniform1f(d)}),fa=(d,r)=>({u_matrix:d,u_image0:0,u_skirt_height:r}),ch=(d,r,l,m,v,T,P,I,F,G,$,K,le,de,fe)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:l,u_zoom_transition:v,u_merc_center:T,u_image0:0,u_frustum_tl:P,u_frustum_tr:I,u_frustum_br:F,u_frustum_bl:G,u_globe_pos:$,u_globe_radius:K,u_viewport:le,u_grid_matrix:fe?Float32Array.from(fe):new Float32Array(9),u_skirt_height:de});function Ba(d,r){return d!=null&&r!=null&&!(!d.hasData()||!r.hasData())&&d.demTexture!=null&&r.demTexture!=null&&d.tileID.key!==r.tileID.key}const io=new class{constructor(){this.operations={}}newMorphing(d,r,l,m,v){if(d in this.operations){const T=this.operations[d];T.to.tileID.key!==l.tileID.key&&(T.queued=l)}else this.operations[d]={startTime:m,phase:0,duration:v,from:r,to:l,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const r=this.operations[d];return{from:r.from,to:r.to,phase:r.phase}}update(d){for(const r in this.operations){const l=this.operations[r];for(l.phase=(d-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,d)){delete this.operations[r];break}}}_nextOp(d,r){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=r,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Fa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function hh(d){return 6*Math.pow(1.5,22-d)}function Qd(d,r){const l=1<<d.z;return!r&&(d.x===0||d.x===l-1)||d.y===0||d.y===l-1}const mc=d=>({u_matrix:d});function Su(d,r,l,m,v){if(v>0){const T=o.exported.now(),P=(T-d.timeAdded)/v,I=r?(T-r.timeAdded)/v:-1,F=l.getSource(),G=m.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),$=!r||Math.abs(r.tileID.overscaledZ-G)>Math.abs(d.tileID.overscaledZ-G),K=$&&d.refreshedUponExpiration?1:o.clamp($?P:1-I,0,1);return d.refreshedUponExpiration&&P>=1&&(d.refreshedUponExpiration=!1),r?{opacity:1,mix:1-K}:{opacity:K,mix:0}}return{opacity:1,mix:0}}class gc extends o.SourceCache{constructor(r){const l={type:"raster-dem",maxzoom:r.transform.maxZoom},m=new Tr(ls(),null),v=Xi("mock-dem",l,m,r.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,l){r.state="loaded",l(null)}}class uh extends o.SourceCache{constructor(r){const l=Xi("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new Tr(ls(),null),r.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,l,m){if(r.freezeTileCoverage)return;this.transform=r;const v=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((T,P)=>{if(T[P.key]="",!this._tiles[P.key]){const I=new o.Tile(P,this._source.tileSize*P.overscaleFactor(),r.tileZoom);I.state="loaded",this._tiles[P.key]=I}return T},{});for(const T in this._tiles)T in v||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(r){const l=this.proxyCachedFBO[r];if(l!==void 0){const m=Object.values(l);this.renderCachePool.push(...m),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class dh extends o.OverscaledTileID{constructor(r,l,m){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=l,this.projMatrix=m}}class Au extends o.Elevation{constructor(r,l){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,v,T]=function(F){const G=new o.StructArrayLayout2i4,$=new o.StructArrayLayout3ui6,K=131;G.reserve(17161),$.reserve(33800);const le=o.EXTENT/128,de=o.EXTENT+le/2,fe=de+le;for(let ge=-le;ge<fe;ge+=le)for(let J=-le;J<fe;J+=le){const ue=J<0||J>de||ge<0||ge>de?24575:0,ve=o.clamp(Math.round(J),0,o.EXTENT),be=o.clamp(Math.round(ge),0,o.EXTENT);G.emplaceBack(ve+ue,be)}const pe=(ge,J)=>{const ue=J*K+ge;$.emplaceBack(ue+1,ue,ue+K),$.emplaceBack(ue+K,ue+K+1,ue+1)};for(let ge=1;ge<129;ge++)for(let J=1;J<129;J++)pe(J,ge);return[0,129].forEach(ge=>{for(let J=0;J<130;J++)pe(J,ge),pe(ge,J)}),[G,$,32768]}(),P=r.context;this.gridBuffer=P.createVertexBuffer(m,o.posAttributes.members),this.gridIndexBuffer=P.createIndexBuffer(v),this.gridSegments=o.SegmentVector.simpleSegment(0,0,m.length,v.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,m.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new uh(l.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.EXTENT,0,o.EXTENT,0,1);const I=P.gl;this._overlapStencilMode=new o.StencilMode({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new gc(l.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,l,m){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const v=r.terrain.properties;this.sourceCache=r.terrain.drapeRenderMode===0?this._mockSourceCache:r._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const T=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const P=this.getScaledDemTileSize();this.sourceCache.update(l,P,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,T(),this._initializing=!0),T(),l.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||r.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=l.getIds().map(F=>{const G=l.getTileByID(F).tileID;return G.projMatrix=m.calculateProjMatrix(G.toUnwrapped()),G});(function(F,G){const $=G.transform.pointCoordinate(G.transform.getCameraPoint()),K=new o.Point($.x,$.y);F.sort((le,de)=>{if(de.overscaledZ-le.overscaledZ)return de.overscaledZ-le.overscaledZ;const fe=new o.Point(le.canonical.x+(1<<le.canonical.z)*le.wrap,le.canonical.y),pe=new o.Point(de.canonical.x+(1<<de.canonical.z)*de.wrap,de.canonical.y),ge=K.mult(1<<le.canonical.z);return ge.x-=.5,ge.y-=.5,ge.distSqr(fe)-ge.distSqr(pe)})})(v,this.painter),this._previousZoom=m.zoom;const T=this.proxyToSource||{};this.proxyToSource={},v.forEach(F=>{this.proxyToSource[F.key]={}}),this.terrainTileForTile={};const P=this._style._sourceCaches;for(const F in P){const G=P[F];if(!G.used||(G!==this.sourceCache&&this.resetTileLookupCache(G.id),this._setupProxiedCoordsForOrtho(G,r[F],T),G.usedForTerrain))continue;const $=r[F];G.getSource().reparseOverscaled&&this._assignTerrainTiles($)}this.proxiedCoords[l.id]=v.map(F=>new dh(F,F.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const I={};this._visibleDemTiles=[];for(const F of this.proxyCoords){const G=this.terrainTileForTile[F.key];if(!G)continue;const $=G.tileID.key;$ in I||(this._visibleDemTiles.push(G),I[$]=$)}}_assignTerrainTiles(r){this._initializing||r.forEach(l=>{if(this.terrainTileForTile[l.key])return;const m=this._findTileCoveringTileID(l,this.sourceCache);m&&(this.terrainTileForTile[l.key]=m)})}_prepareDEMTextures(){const r=this.painter.context,l=r.gl;for(const m in this.terrainTileForTile){const v=this.terrainTileForTile[m],T=v.dem;!T||v.demTexture&&!v.needsDEMTextureUpload||(r.activeTexture.set(l.TEXTURE1),oh(this.painter,v,T))}}_prepareDemTileUniforms(r,l,m,v){if(!l||l.demTexture==null)return!1;const T=r.tileID.canonical,P=Math.pow(2,l.tileID.canonical.z-T.z),I=v||"";return m[`u_dem_tl${I}`]=[T.x*P%1,T.y*P%1],m[`u_dem_scale${I}`]=P,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,l=r.gl;if(!this._emptyDepthBufferTexture){const m=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(r,m,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const l=this._visibleDemTiles.reduce((m,v)=>{if(!v.dem)return m;const T=v.dem.tree.minimums[0];return T>0&&r++,m+T},0);return r?l/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,l=r.gl;r.activeTexture.set(l.TEXTURE2);const m=this._getLoadedAreaMinimum(),v=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(v,{premultiply:!1}):T=this._emptyDEMTexture=new o.Texture(r,v,l.RGBA,{premultiply:!1}),T}setupElevationDraw(r,l,m){const v=this.painter.context,T=v.gl,P=(I=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(I),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var I;P.u_dem_size=this.sourceCache.getSource().tileSize,P.u_exaggeration=this.exaggeration();let F=null,G=null,$=1;if(m&&m.morphing&&this._useVertexMorphing){const K=m.morphing.srcDemTile,le=m.morphing.dstDemTile;$=m.morphing.phase,K&&le&&(this._prepareDemTileUniforms(r,K,P,"_prev")&&(G=K),this._prepareDemTileUniforms(r,le,P)&&(F=le))}if(G&&F?(v.activeTexture.set(T.TEXTURE2),F.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),v.activeTexture.set(T.TEXTURE4),G.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),P.u_dem_lerp=$):(F=this.terrainTileForTile[r.tileID.key],v.activeTexture.set(T.TEXTURE2),(this._prepareDemTileUniforms(r,F,P)?F.demTexture:this.emptyDEMTexture).bind(T.NEAREST,T.CLAMP_TO_EDGE)),v.activeTexture.set(T.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),this._depthFBO&&(P.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),P.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&F){const K=(1<<F.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;P.u_meter_to_dem=K}if(m&&m.labelPlaneMatrixInv&&(P.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),l.setTerrainUniformValues(v,P),this.painter.transform.projection.name==="globe"){const K=this.globeUniformValues(this.painter.transform,r.tileID.canonical,m&&m.useDenormalizedUpVectorScale);l.setGlobeUniformValues(v,K)}}globeUniformValues(r,l,m){const v=r.projection;return{u_tile_tl_up:v.upVector(l,0,0),u_tile_tr_up:v.upVector(l,o.EXTENT,0),u_tile_br_up:v.upVector(l,o.EXTENT,o.EXTENT),u_tile_bl_up:v.upVector(l,0,o.EXTENT),u_tile_up_scale:m?o.globeMetersToEcef(1):v.upVectorScale(l,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const l=this.painter,m=this.painter.context;r.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,T,P,I,F){if(v.transform.projection.name==="globe")(function(G,$,K,le,de){const fe=G.context,pe=fe.gl;let ge,J;const ue=G.options.showTerrainWireframe?2:0,ve=G.transform,be=o.globeUseCustomAntiAliasing(G,fe,ve),ze=(Pt,Je)=>{if(J===Pt)return;const _t=[Fa[Pt],"PROJECTION_GLOBE_VIEW"];be&&_t.push("CUSTOM_ANTIALIASING"),Je&&_t.push(Fa[ue]),ge=G.useProgram("globeRaster",null,_t),J=Pt},Pe=G.colorModeForRenderPass(),Oe=new o.DepthMode(pe.LEQUAL,o.DepthMode.ReadWrite,G.depthRangeFor3D);io.update(de);const Xe=o.calculateGlobeMercatorMatrix(ve),$e=[o.mercatorXfromLng(ve.center.lng),o.mercatorYfromLat(ve.center.lat)],it=ue?[!1,!0]:[!1],Mt=G.globeSharedBuffers,et=[ve.width*o.exported.devicePixelRatio,ve.height*o.exported.devicePixelRatio],gt=Float32Array.from(ve.globeMatrix),ot={useDenormalizedUpVectorScale:!0};if(it.forEach(Pt=>{const Je=G.transform,_t=hh(Je.zoom)*$.exaggeration();J=-1;const Lt=Pt?pe.LINES:pe.TRIANGLES;for(const ft of le){const Rt=K.getTile(ft),mi=o.StencilMode.disabled,ki=$.prevTerrainTileForTile[ft.key],oi=$.terrainTileForTile[ft.key];Ba(ki,oi)&&io.newMorphing(ft.key,ki,oi,de,250),fe.activeTexture.set(pe.TEXTURE0),Rt.texture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE);const _i=io.getMorphValuesForProxy(ft.key),Oi=_i?1:0;_i&&o.extend$1(ot,{morphing:{srcDemTile:_i.from,dstDemTile:_i.to,phase:o.easeCubicInOut(_i.phase)}});const Bi=o.tileCornersToBounds(ft.canonical),di=o.getLatitudinalLod(Bi.getCenter().lat),xr=o.getGridMatrix(ft.canonical,Bi,di,Je.worldSize/Je._pixelsPerMercatorPixel),Er=o.globeNormalizeECEF(o.globeTileBounds(ft.canonical)),Sr=ch(Je.projMatrix,gt,Xe,Er,o.globeToMercatorTransition(Je.zoom),$e,Je.frustumCorners.TL,Je.frustumCorners.TR,Je.frustumCorners.BR,Je.frustumCorners.BL,Je.globeCenterInViewSpace,Je.globeRadius,et,_t,xr);if(ze(Oi,Pt),$.setupElevationDraw(Rt,ge,ot),G.prepareDrawProgram(fe,ge,ft.toUnwrapped()),Mt){const[Ar,en,Gs]=Pt?Mt.getWirefameBuffers(G.context,di):Mt.getGridBuffers(di,_t!==0);ge.draw(fe,Lt,Oe,mi,Pe,o.CullFaceMode.backCCW,Sr,"globe_raster",Ar,en,Gs)}}}),Mt){const Pt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];be&&Pt.push("CUSTOM_ANTIALIASING"),ge=G.useProgram("globeRaster",null,Pt);for(const Je of le){const{x:_t,y:Lt,z:ft}=Je.canonical,Rt=Lt===0,mi=Lt===(1<<ft)-1,[ki,oi,_i,Oi]=Mt.getPoleBuffers(ft);if(Oi&&(Rt||mi)){const Bi=K.getTile(Je);fe.activeTexture.set(pe.TEXTURE0),Bi.texture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE);let di=o.globePoleMatrixForTile(ft,_t,ve);const xr=o.globeNormalizeECEF(o.globeTileBounds(Je.canonical)),Er=(Sr,Ar)=>Sr.draw(fe,pe.TRIANGLES,Oe,o.StencilMode.disabled,Pe,o.CullFaceMode.disabled,ch(ve.projMatrix,di,di,xr,0,$e,ve.frustumCorners.TL,ve.frustumCorners.TR,ve.frustumCorners.BR,ve.frustumCorners.BL,ve.globeCenterInViewSpace,ve.globeRadius,et,0),"globe_pole_raster",Ar,_i,Oi);$.setupElevationDraw(Bi,ge,ot),G.prepareDrawProgram(fe,ge,Je.toUnwrapped()),Rt&&Er(ge,ki),mi&&(di=o.scale(o.create(),di,[1,-1,1]),Er(ge,oi))}}}})(v,T,P,I,F);else{const G=v.context,$=G.gl;let K,le;const de=v.options.showTerrainWireframe?2:0,fe=(ve,be)=>{if(le===ve)return;const ze=[Fa[ve]];be&&ze.push(Fa[de]),K=v.useProgram("terrainRaster",null,ze),le=ve},pe=v.colorModeForRenderPass(),ge=new o.DepthMode($.LEQUAL,o.DepthMode.ReadWrite,v.depthRangeFor3D);io.update(F);const J=v.transform,ue=hh(J.zoom)*T.exaggeration();(de?[!1,!0]:[!1]).forEach(ve=>{le=-1;const be=ve?$.LINES:$.TRIANGLES,[ze,Pe]=ve?T.getWirefameBuffer():[T.gridIndexBuffer,T.gridSegments];for(const Oe of I){const Xe=P.getTile(Oe),$e=o.StencilMode.disabled,it=T.prevTerrainTileForTile[Oe.key],Mt=T.terrainTileForTile[Oe.key];Ba(it,Mt)&&io.newMorphing(Oe.key,it,Mt,F,250),G.activeTexture.set($.TEXTURE0),Xe.texture.bind($.LINEAR,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST);const et=io.getMorphValuesForProxy(Oe.key),gt=et?1:0;let ot;et&&(ot={morphing:{srcDemTile:et.from,dstDemTile:et.to,phase:o.easeCubicInOut(et.phase)}});const Pt=fa(Oe.projMatrix,Qd(Oe.canonical,J.renderWorldCopies)?ue/10:ue);fe(gt,ve),T.setupElevationDraw(Xe,K,ot),v.prepareDrawProgram(G,K,Oe.toUnwrapped()),K.draw(G,be,ge,$e,pe,o.CullFaceMode.backCCW,Pt,"terrain_raster",T.gridBuffer,ze,Pe)}})}}(l,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const l=this.painter,m=this.painter.context,v=this.proxySourceCache,T=this.proxiedCoords[v.id],P=this._drapedRenderBatches.shift(),I=[],F=l.style.order;let G=0;for(const $ of T){const K=v.getTileByID($.proxyTileKey),le=v.proxyCachedFBO[$.key]?v.proxyCachedFBO[$.key][r]:void 0,de=le!==void 0?v.renderCache[le]:this.pool[G++],fe=le!==void 0;if(K.texture=de.tex,fe&&!de.dirty){I.push(K.tileID);continue}let pe;m.bindFramebuffer.set(de.fb.framebuffer),this.renderedToTile=!1,de.dirty&&(m.clear({color:o.Color.transparent,stencil:0}),de.dirty=!1);for(let ge=P.start;ge<=P.end;++ge){const J=l.style._layers[F[ge]];if(J.isHidden(l.transform.zoom))continue;const ue=l.style._getLayerSourceCache(J),ve=ue?this.proxyToSource[$.key][ue.id]:[$];if(!ve)continue;const be=ve;m.viewport.set([0,0,de.fb.width,de.fb.height]),pe!==(ue?ue.id:null)&&(this._setupStencil(de,ve,J,ue),pe=ue?ue.id:null),l.renderLayer(l,ue,J,be)}this.renderedToTile?(de.dirty=!0,I.push(K.tileID)):fe||--G,G===5&&(G=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,l.width,l.height]),P.end+1}postRender(){}renderCacheEfficiency(r){const l=r.order.length;if(l===0)return{efficiency:100};let m,v=0,T=0,P=!1;for(let I=0;I<l;++I){const F=r._layers[r.order[I]];this._style.isLayerDraped(F)?(P&&++v,++T):P||(P=!0,m=F.id)}return T===0?{efficiency:100}:{efficiency:100*(1-v/T),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{r=Math.min(r,l.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,l,m){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(T=>T.dem).map(T=>{const P=T.tileID,I=1<<P.overscaledZ,{x:F,y:G}=P.canonical,$=F/I,K=(F+1)/I,le=G/I,de=(G+1)/I;return{minx:$,miny:le,maxx:K,maxy:de,t:T.dem.tree.raycastRoot($,le,K,de,r,l,m),tile:T}});v.sort((T,P)=>(T.t!==null?T.t:Number.MAX_VALUE)-(P.t!==null?P.t:Number.MAX_VALUE));for(const T of v){if(T.t==null)return null;const P=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,r,l,m);if(P!=null)return P}return null}_createFBO(){const r=this.painter.context,l=r.gl,m=this.drapeBufferSize;r.activeTexture.set(l.TEXTURE0);const v=new o.Texture(r,{width:m[0],height:m[1],data:null},l.RGBA);v.bind(l.LINEAR,l.CLAMP_TO_EDGE);const T=r.createFramebuffer(m[0],m[1],!1);return T.colorAttachment.set(v.texture),T.depthAttachment=new Ve(r,T.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:T,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const l=this._style._layers[r],m=l.isHidden(this.painter.transform.zoom);return l.type==="custom"?!m&&l.shouldRedrape():!m&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const m of this._style._getSources())if(m instanceof Ht){r=!0;break}if(!r)return;const l={};for(let m=0;m<this._style.order.length;++m){const v=this._style._layers[this._style.order[m]],T=this._style._getLayerSourceCache(v);if(T&&!l[T.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof o.ZoomDependentExpression){l[T.id]=!0;for(const P of this.proxyCoords){const I=this.proxyToSource[P.key][T.id];if(I)for(const F of I)this._clearRenderCacheForTile(T.id,F)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const m in this._style._sourceCaches)if(this._style._sourceCaches[m]._source instanceof Dt){r=!0;break}if(!r)return;const l={};for(let m=0;m<this._style.order.length;++m){const v=this._style._layers[this._style.order[m]],T=this._style._getLayerSourceCache(v);if(!T||l[T.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;const P=v.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const F=this.proxyToSource[I.key][T.id];if(F)for(const G of F){const $=Su(T.getTile(G),T.findLoadedParent(G,0),T,this.painter.transform,P);($.opacity!==1||$.mix!==0)&&this._clearRenderCacheForTile(T.id,G)}}}}_setupDrapedRenderBatches(){const r=this._style.order,l=r.length;if(l===0)return;const m=[];let v,T=0,P=this._style._layers[r[T]];for(;!this._style.isLayerDraped(P)&&P.isHidden(this.painter.transform.zoom)&&++T<l;)P=this._style._layers[r[T]];for(;T<l;++T){const I=this._style._layers[r[T]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?v===void 0&&(v=T):v!==void 0&&(m.push({start:v,end:T-1}),v=void 0))}v!==void 0&&m.push({start:v,end:T-1}),this._drapedRenderBatches=m}_setupRenderCache(r){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const P=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let I=0;I<P.length;++I){const F=Object.values(P[I]);l.renderCachePool.push(...F)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,v=this._tilesDirty;for(let P=m.length-1;P>=0;P--){const I=m[P];if(l.getTileByID(I.key),l.proxyCachedFBO[I.key]!==void 0){const F=r[I.key],G=this.proxyToSource[I.key];let $=0;for(const K in G){const le=G[K],de=F[K];if(!de||de.length!==le.length||le.some((fe,pe)=>fe!==de[pe]||v[K]&&v[K].hasOwnProperty(fe.key))){$=-1;break}++$}for(const K in l.proxyCachedFBO[I.key])l.renderCache[l.proxyCachedFBO[I.key][K]].dirty=$<0||$!==Object.values(F).length}}const T=[...this._drapedRenderBatches];T.sort((P,I)=>I.end-I.start-(P.end-P.start));for(const P of T)for(const I of m){if(l.proxyCachedFBO[I.key])continue;let F=l.renderCachePool.pop();F===void 0&&l.renderCache.length<50&&(F=l.renderCache.length,l.renderCache.push(this._createFBO())),F!==void 0&&(l.proxyCachedFBO[I.key]={},l.proxyCachedFBO[I.key][P.start]=F,l.renderCache[F].dirty=!0)}this._tilesDirty={}}_setupStencil(r,l,m,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,P=T.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let I;if(m.isTileClipped())I=l.length,this._overlapStencilMode.test={func:P.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:P.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(r,l){const m=this.painter,v=this.painter.context,T=v.gl;m._tileClippingMaskIDs={},v.setColorMode(o.ColorMode.disabled),v.setDepthMode(o.DepthMode.disabled);const P=m.useProgram("clippingMask");for(const I of r){const F=m._tileClippingMaskIDs[I.key]=--l;P.draw(v,T.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:T.ALWAYS,mask:0},F,255,T.KEEP,T.KEEP,T.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,mc(I.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(r){const l=this.painter.transform;if(r.x<0||r.x>l.width||r.y<0||r.y>l.height)return null;const m=[r.x,r.y,1,1];o.transformMat4$1(m,m,l.pixelMatrixInverse),o.scale$1(m,m,1/m[3]),m[0]/=l.worldSize,m[1]/=l.worldSize;const v=l._camera.position,T=o.mercatorZfromAltitude(1,l.center.lat),P=[v[0],v[1],v[2]/T,0],I=o.subtract([],m.slice(0,3),P);o.normalize(I,I);const F=this.raycast(P,I,this._exaggeration);return F!==null&&F?(o.scaleAndAdd(P,P,I,F),P[3]=P[2],P[2]*=T,P):null}drawDepth(){const r=this.painter,l=r.context,m=this.proxySourceCache,v=Math.ceil(r.width),T=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===T||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const P=l.gl,I=l.createFramebuffer(v,T,!0);l.activeTexture.set(P.TEXTURE0);const F=new o.Texture(l,{width:v,height:T,data:null},P.RGBA);F.bind(P.NEAREST,P.CLAMP_TO_EDGE),I.colorAttachment.set(F.texture);const G=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,v,T);I.depthAttachment.set(G),this._depthFBO=I,this._depthTexture=F}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,v,T]),function(P,I,F,G){if(P.transform.projection.name==="globe")return;const $=P.context,K=$.gl;$.clear({depth:1});const le=P.useProgram("terrainDepth"),de=new o.DepthMode(K.LESS,o.DepthMode.ReadWrite,P.depthRangeFor3D);for(const fe of G){const pe=F.getTile(fe),ge=fa(fe.projMatrix,0);I.setupElevationDraw(pe,le),le.draw($,K.TRIANGLES,de,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,ge,"terrain_depth",I.gridBuffer,I.gridIndexBuffer,I.gridNoSkirtSegments)}}(r,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,l,m){if(r.getSource()instanceof Si)return this._setupProxiedCoordsForImageSource(r,l,m);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const v=this.proxiedCoords[r.id]=[],T=this.proxyCoords;for(let I=0;I<T.length;I++){const F=T[I],G=this._findTileCoveringTileID(F,r);if(G){const $=this._createProxiedId(F,G,m[F.key]&&m[F.key][r.id]);v.push($),this.proxyToSource[F.key][r.id]=[$]}}let P=!1;for(let I=0;I<l.length;I++){const F=r.getTile(l[I]);if(!F||!F.hasData())continue;const G=this._findTileCoveringTileID(F.tileID,this.proxySourceCache);if(G&&G.tileID.canonical.z!==F.tileID.canonical.z){const $=this.proxyToSource[G.tileID.key][r.id],K=this._createProxiedId(G.tileID,F,m[G.tileID.key]&&m[G.tileID.key][r.id]);$?$.splice($.length-1,0,K):this.proxyToSource[G.tileID.key][r.id]=[K],v.push(K),P=!0}}this._sourceTilesOverlap[r.id]=P}_setupProxiedCoordsForImageSource(r,l,m){if(!r.getSource().loaded())return;const v=this.proxiedCoords[r.id]=[],T=this.proxyCoords,P=r.getSource(),I=new o.Point(P.tileID.x,P.tileID.y)._div(1<<P.tileID.z),F=P.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce(($,K)=>($.min.x=Math.min($.min.x,K.x-I.x),$.min.y=Math.min($.min.y,K.y-I.y),$.max.x=Math.max($.max.x,K.x-I.x),$.max.y=Math.max($.max.y,K.y-I.y),$),{min:new o.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),G=($,K)=>{const le=$.wrap+$.canonical.x/(1<<$.canonical.z),de=$.canonical.y/(1<<$.canonical.z),fe=o.EXTENT/(1<<$.canonical.z),pe=K.wrap+K.canonical.x/(1<<K.canonical.z),ge=K.canonical.y/(1<<K.canonical.z);return le+fe<pe+F.min.x||le>pe+F.max.x||de+fe<ge+F.min.y||de>ge+F.max.y};for(let $=0;$<T.length;$++){const K=T[$];for(let le=0;le<l.length;le++){const de=r.getTile(l[le]);if(!de||!de.hasData()||G(K,de.tileID))continue;const fe=this._createProxiedId(K,de,m[K.key]&&m[K.key][r.id]),pe=this.proxyToSource[K.key][r.id];pe?pe.push(fe):this.proxyToSource[K.key][r.id]=[fe],v.push(fe)}}}_createProxiedId(r,l,m){let v=this.orthoMatrix;if(m){const T=m.find(P=>P.key===l.tileID.key);if(T)return T}if(l.tileID.key!==r.key){const T=r.canonical.z-l.tileID.canonical.z;let P,I,F;v=o.create();const G=l.tileID.wrap-r.wrap<<r.overscaledZ;T>0?(P=o.EXTENT>>T,I=P*((l.tileID.canonical.x<<T)-r.canonical.x+G),F=P*((l.tileID.canonical.y<<T)-r.canonical.y)):(P=o.EXTENT<<-T,I=o.EXTENT*(l.tileID.canonical.x-(r.canonical.x+G<<-T)),F=o.EXTENT*(l.tileID.canonical.y-(r.canonical.y<<-T))),o.ortho(v,0,P,0,P,0,1),o.translate(v,v,[I,F,0])}return new dh(l.tileID,r.key,v)}_findTileCoveringTileID(r,l){let m=l.getTile(r);if(m&&m.hasData())return m;const v=this._findCoveringTileCache[l.id],T=v[r.key];if(m=T?l.getTileByID(T):null,m&&m.hasData()||T===null)return m;let P=m?m.tileID:r,I=P.overscaledZ;const F=l.getSource().minzoom,G=[];if(!T){const K=l.getSource().maxzoom;if(r.canonical.z>=K){const le=r.canonical.z-K;l.getSource().reparseOverscaled?(I=Math.max(r.canonical.z+2,l.transform.tileZoom),P=new o.OverscaledTileID(I,r.wrap,K,r.canonical.x>>le,r.canonical.y>>le)):le!==0&&(I=K,P=new o.OverscaledTileID(I,r.wrap,K,r.canonical.x>>le,r.canonical.y>>le))}P.key!==r.key&&(G.push(P.key),m=l.getTile(P))}const $=K=>{G.forEach(le=>{v[le]=K}),G.length=0};for(I-=1;I>=F&&(!m||!m.hasData());I--){m&&$(m.tileID.key);const K=P.calculateScaledKey(I);if(m=l.getTileByID(K),m&&m.hasData())break;const le=v[K];if(le===null)break;le===void 0?G.push(K):m=l.getTileByID(le)}return $(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,l){let m=this._tilesDirty[r];m||(m=this._tilesDirty[r]={}),m[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(l){let m=0;const v=new o.StructArrayLayout2ui4,T=131;for(let P=1;P<129;P++){for(let I=1;I<129;I++)m=P*T+I,v.emplaceBack(m,m+1),v.emplaceBack(m,m+T),v.emplaceBack(m+1,m+T),P===128&&v.emplaceBack(m+T,m+T+1);v.emplaceBack(m+1,m+1+T)}return v}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class nr{static cacheKey(r,l,m,v){let T=`${l}${v?v.cacheKey:""}`;for(const P of m)r.usedDefines.includes(P)&&(T+=`/${P}`);return T}constructor(r,l,m,v,T,P){const I=r.gl;this.program=I.createProgram();const F=function(J){const ue=[];for(let ve=0;ve<J.length;ve++){if(J[ve]===null)continue;const be=J[ve].split(" ");ue.push(be.pop())}return ue}(m.staticAttributes),G=v?v.getBinderAttributes():[],$=F.concat(G);let K=v?v.defines():[];K=K.concat(P.map(J=>`#define ${J}`));const le=r.isWebGL2?`#version 300 es
`:"",de=le+K.concat(r.extStandardDerivatives&&le.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(Tl):Tl,Tl,sh,wl.fragmentSource,vl.fragmentSource,m.fragmentSource).join(`
`),fe=le+K.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,sh,wl.vertexSource,vl.vertexSource,fc.vertexSource,m.vertexSource).join(`
`),pe=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(pe,de),I.compileShader(pe),I.attachShader(this.program,pe);const ge=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(ge,fe),I.compileShader(ge),I.attachShader(this.program,ge),this.attributes={},this.numAttributes=$.length;for(let J=0;J<this.numAttributes;J++)$[J]&&(I.bindAttribLocation(this.program,J,$[J]),this.attributes[$[J]]=J);I.linkProgram(this.program),I.deleteShader(ge),I.deleteShader(pe),this.fixedUniforms=T(r),this.binderUniforms=v?v.getUniforms(r):[],P.includes("TERRAIN")&&(this.terrainUniforms=(J=>({u_dem:new o.Uniform1i(J),u_dem_prev:new o.Uniform1i(J),u_dem_unpack:new o.Uniform4f(J),u_dem_tl:new o.Uniform2f(J),u_dem_scale:new o.Uniform1f(J),u_dem_tl_prev:new o.Uniform2f(J),u_dem_scale_prev:new o.Uniform1f(J),u_dem_size:new o.Uniform1f(J),u_dem_lerp:new o.Uniform1f(J),u_exaggeration:new o.Uniform1f(J),u_depth:new o.Uniform1i(J),u_depth_size_inv:new o.Uniform2f(J),u_meter_to_dem:new o.Uniform1f(J),u_label_plane_matrix_inv:new o.UniformMatrix4f(J)}))(r)),P.includes("GLOBE")&&(this.globeUniforms=(J=>({u_tile_tl_up:new o.Uniform3f(J),u_tile_tr_up:new o.Uniform3f(J),u_tile_br_up:new o.Uniform3f(J),u_tile_bl_up:new o.Uniform3f(J),u_tile_up_scale:new o.Uniform1f(J)}))(r)),P.includes("FOG")&&(this.fogUniforms=(J=>({u_fog_matrix:new o.UniformMatrix4f(J),u_fog_range:new o.Uniform2f(J),u_fog_color:new o.Uniform4f(J),u_fog_horizon_blend:new o.Uniform1f(J),u_fog_temporal_offset:new o.Uniform1f(J),u_frustum_tl:new o.Uniform3f(J),u_frustum_tr:new o.Uniform3f(J),u_frustum_br:new o.Uniform3f(J),u_frustum_bl:new o.Uniform3f(J),u_globe_pos:new o.Uniform3f(J),u_globe_radius:new o.Uniform1f(J),u_globe_transition:new o.Uniform1f(J),u_is_globe:new o.Uniform1i(J),u_viewport:new o.Uniform2f(J)}))(r))}}setTerrainUniformValues(r,l){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const v in l)m[v]&&m[v].set(this.program,v,l[v])}}setGlobeUniformValues(r,l){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const v in l)m[v]&&m[v].set(this.program,v,l[v])}}setFogUniformValues(r,l){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const v in l)m[v].set(this.program,v,l[v])}}draw(r,l,m,v,T,P,I,F,G,$,K,le,de,fe,pe){const ge=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(m),r.setStencilMode(v),r.setColorMode(T),r.setCullFace(P);for(const ue of Object.keys(this.fixedUniforms))this.fixedUniforms[ue].set(this.program,ue,I[ue]);fe&&fe.setUniforms(this.program,r,this.binderUniforms,le,{zoom:de});const J={[ge.LINES]:2,[ge.TRIANGLES]:3,[ge.LINE_STRIP]:1}[l];for(const ue of K.get()){const ve=ue.vaos||(ue.vaos={});(ve[F]||(ve[F]=new Mf)).bind(r,this,G,fe?fe.getPaintVertexBuffers():[],$,ue.vertexOffset,pe||[]),ge.drawElements(l,ue.primitiveLength*J,ge.UNSIGNED_SHORT,ue.primitiveOffset*J*2)}}}function Mo(d,r){const l=Math.pow(2,r.tileID.overscaledZ),m=r.tileSize*Math.pow(2,d.transform.tileZoom)/l,v=m*(r.tileID.canonical.x+r.tileID.wrap*l),T=m*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_tile_units_to_pixels:1/fr(r,1,d.transform.tileZoom),u_pixel_coord_upper:[v>>16,T>>16],u_pixel_coord_lower:[65535&v,65535&T]}}const Mu=o.create(),ph=(d,r,l,m,v,T,P,I,F,G,$)=>{const K=r.style.light,le=K.properties.get("position"),de=[le.x,le.y,le.z],fe=o.create$1();K.properties.get("anchor")==="viewport"&&(o.fromRotation(fe,-r.transform.angle),o.transformMat3(de,de,fe));const pe=K.properties.get("color"),ge=r.transform,J={u_matrix:d,u_lightpos:de,u_lightintensity:K.properties.get("intensity"),u_lightcolor:[pe.r,pe.g,pe.b],u_vertical_gradient:+l,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Mu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:T};return ge.projection.name==="globe"&&(J.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],J.u_zoom_transition=F,J.u_inv_rot_matrix=$,J.u_merc_center=G,J.u_up_dir=ge.projection.upVector(new o.CanonicalTileID(0,0,0),G[0]*o.EXTENT,G[1]*o.EXTENT),J.u_height_lift=I),J},ep=(d,r,l,m,v,T,P,I,F,G,$,K)=>{const le=ph(d,r,l,m,v,T,P,F,G,$,K),de={u_height_factor:-Math.pow(2,P.overscaledZ)/I.tileSize/8};return o.extend(le,Mo(r,I),de)},Na=d=>({u_matrix:d}),Cu=(d,r,l)=>o.extend(Na(d),Mo(r,l)),ku=(d,r)=>({u_matrix:d,u_world:r}),Pu=(d,r,l,m)=>o.extend(Cu(d,r,l),{u_world:m}),fh=o.create(),El=(d,r,l,m,v,T)=>{const P=d.transform,I=P.projection.name==="globe";let F;if(T.paint.get("circle-pitch-alignment")==="map")if(I){const $=o.globePixelsToTileUnits(P.zoom,r.canonical)*P._pixelsPerMercatorPixel;F=Float32Array.from([$,0,0,$])}else F=P.calculatePixelsToTileUnitsMatrix(l);else F=new Float32Array([P.pixelsToGLUnits[0],0,0,P.pixelsToGLUnits[1]]);const G={u_camera_to_center_distance:P.cameraToCenterDistance,u_matrix:d.translatePosMatrix(r.projMatrix,l,T.paint.get("circle-translate"),T.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:F,u_inv_rot_matrix:fh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){G.u_inv_rot_matrix=m,G.u_merc_center=v,G.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],G.u_zoom_transition=o.globeToMercatorTransition(P.zoom);const $=v[0]*o.EXTENT,K=v[1]*o.EXTENT;G.u_up_dir=P.projection.upVector(new o.CanonicalTileID(0,0,0),$,K)}return G},Iu=d=>{const r=[];return d.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r},mh=(d,r,l,m)=>{const v=o.EXTENT/l.tileSize;return{u_matrix:d,u_camera_to_center_distance:r.getCameraToCenterDistance(m),u_extrude_scale:[r.pixelsToGLUnits[0]/v,r.pixelsToGLUnits[1]/v]}},Ua=(d,r,l=1)=>({u_matrix:d,u_color:r,u_overlay:0,u_overlay_scale:l}),ma=o.create(),tp=(d,r,l,m,v,T,P)=>{const I=d.transform,F=I.projection.name==="globe",G=F?o.globePixelsToTileUnits(I.zoom,r.canonical)*I._pixelsPerMercatorPixel:fr(l,1,T),$={u_matrix:r.projMatrix,u_extrude_scale:G,u_intensity:P,u_inv_rot_matrix:ma,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(F){$.u_inv_rot_matrix=m,$.u_merc_center=v,$.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],$.u_zoom_transition=o.globeToMercatorTransition(I.zoom);const K=v[0]*o.EXTENT,le=v[1]*o.EXTENT;$.u_up_dir=I.projection.upVector(new o.CanonicalTileID(0,0,0),K,le)}return $},ja=(d,r,l,m,v,T,P)=>{const I=d.transform,F=I.calculatePixelsToTileUnitsMatrix(r);return{u_matrix:Va(d,r,l,m),u_pixels_to_tile_units:F,u_device_pixel_ratio:T,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:yc(l)?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ro(r,d.transform),u_alpha_discard_threshold:0,u_trim_offset:P}},_c=(d,r,l,m,v)=>{const T=d.transform;return{u_matrix:Va(d,r,l,m),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:v,u_image:0,u_tile_units_to_pixels:ro(r,T),u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ro(d,r){return 1/fr(d,1,r.tileZoom)}function Va(d,r,l,m){return d.translatePosMatrix(m||r.tileID.projMatrix,r,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function yc(d){const r=d.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}const xc=(d,r,l,m,v,T)=>{return{u_matrix:d,u_tl_parent:r,u_scale_parent:l,u_fade_t:m.mix,u_opacity:m.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(I=v.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(P=v.paint.get("raster-contrast"),P>0?1/(1-P):1+P),u_spin_weights:zn(v.paint.get("raster-hue-rotate")),u_perspective_transform:T};var P,I};function zn(d){d*=Math.PI/180;const r=Math.sin(d),l=Math.cos(d);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}const gh=o.create(),Lu=(d,r,l,m,v,T,P,I,F,G,$,K,le,de,fe,pe)=>{const ge=v.transform,J={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:ge.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:ge.width/ge.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:P,u_coord_matrix:I,u_is_text:+F,u_pitch_with_map:+m,u_texsize:G,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:gh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:gh,u_up_vector:[0,-1,0]};return pe.name==="globe"&&(J.u_tile_id=[$.canonical.x,$.canonical.y,1<<$.canonical.z],J.u_zoom_transition=K,J.u_inv_rot_matrix=de,J.u_merc_center=le,J.u_camera_forward=ge._camera.forward(),J.u_ecef_origin=o.globeECEFOrigin(ge.globeMatrix,$.toUnwrapped()),J.u_tile_matrix=Float32Array.from(ge.globeMatrix),J.u_up_vector=fe),J},_h=(d,r,l,m,v,T,P,I,F,G,$,K,le,de,fe,pe,ge)=>o.extend(Lu(d,r,l,m,v,T,P,I,F,G,K,le,de,fe,pe,ge),{u_gamma_scale:m?v.transform.cameraToCenterDistance*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:1}),vc=(d,r,l,m,v,T,P,I,F,G,$,K,le,de,fe,pe)=>o.extend(_h(d,r,l,m,v,T,P,I,!0,F,!0,$,K,le,de,fe,pe),{u_texsize_icon:G,u_texture_icon:1}),Du=(d,r,l)=>({u_matrix:d,u_opacity:r,u_color:l}),Cf=(d,r,l,m,v)=>o.extend(function(T,P,I){const F=P.imageManager.getPattern(T.toString()),{width:G,height:$}=P.imageManager.getPixelSize(),K=Math.pow(2,I.tileID.overscaledZ),le=I.tileSize*Math.pow(2,P.transform.tileZoom)/K,de=le*(I.tileID.canonical.x+I.tileID.wrap*K),fe=le*I.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[G,$],u_pattern_size:F.displaySize,u_tile_units_to_pixels:1/fr(I,1,P.transform.tileZoom),u_pixel_coord_upper:[de>>16,fe>>16],u_pixel_coord_lower:[65535&de,65535&fe]}}(m,l,v),{u_matrix:d,u_opacity:r}),Ru={fillExtrusion:d=>({u_matrix:new o.UniformMatrix4f(d),u_lightpos:new o.Uniform3f(d),u_lightintensity:new o.Uniform1f(d),u_lightcolor:new o.Uniform3f(d),u_vertical_gradient:new o.Uniform1f(d),u_opacity:new o.Uniform1f(d),u_edge_radius:new o.Uniform1f(d),u_ao:new o.Uniform2f(d),u_tile_id:new o.Uniform3f(d),u_zoom_transition:new o.Uniform1f(d),u_inv_rot_matrix:new o.UniformMatrix4f(d),u_merc_center:new o.Uniform2f(d),u_up_dir:new o.Uniform3f(d),u_height_lift:new o.Uniform1f(d)}),fillExtrusionPattern:d=>({u_matrix:new o.UniformMatrix4f(d),u_lightpos:new o.Uniform3f(d),u_lightintensity:new o.Uniform1f(d),u_lightcolor:new o.Uniform3f(d),u_vertical_gradient:new o.Uniform1f(d),u_height_factor:new o.Uniform1f(d),u_edge_radius:new o.Uniform1f(d),u_ao:new o.Uniform2f(d),u_tile_id:new o.Uniform3f(d),u_zoom_transition:new o.Uniform1f(d),u_inv_rot_matrix:new o.UniformMatrix4f(d),u_merc_center:new o.Uniform2f(d),u_up_dir:new o.Uniform3f(d),u_height_lift:new o.Uniform1f(d),u_image:new o.Uniform1i(d),u_texsize:new o.Uniform2f(d),u_pixel_coord_upper:new o.Uniform2f(d),u_pixel_coord_lower:new o.Uniform2f(d),u_tile_units_to_pixels:new o.Uniform1f(d),u_opacity:new o.Uniform1f(d)}),fill:d=>({u_matrix:new o.UniformMatrix4f(d)}),fillPattern:d=>({u_matrix:new o.UniformMatrix4f(d),u_image:new o.Uniform1i(d),u_texsize:new o.Uniform2f(d),u_pixel_coord_upper:new o.Uniform2f(d),u_pixel_coord_lower:new o.Uniform2f(d),u_tile_units_to_pixels:new o.Uniform1f(d)}),fillOutline:d=>({u_matrix:new o.UniformMatrix4f(d),u_world:new o.Uniform2f(d)}),fillOutlinePattern:d=>({u_matrix:new o.UniformMatrix4f(d),u_world:new o.Uniform2f(d),u_image:new o.Uniform1i(d),u_texsize:new o.Uniform2f(d),u_pixel_coord_upper:new o.Uniform2f(d),u_pixel_coord_lower:new o.Uniform2f(d),u_tile_units_to_pixels:new o.Uniform1f(d)}),circle:d=>({u_camera_to_center_distance:new o.Uniform1f(d),u_extrude_scale:new o.UniformMatrix2f(d),u_device_pixel_ratio:new o.Uniform1f(d),u_matrix:new o.UniformMatrix4f(d),u_inv_rot_matrix:new o.UniformMatrix4f(d),u_merc_center:new o.Uniform2f(d),u_tile_id:new o.Uniform3f(d),u_zoom_transition:new o.Uniform1f(d),u_up_dir:new o.Uniform3f(d)}),collisionBox:d=>({u_matrix:new o.UniformMatrix4f(d),u_camera_to_center_distance:new o.Uniform1f(d),u_extrude_scale:new o.Uniform2f(d)}),collisionCircle:d=>({u_matrix:new o.UniformMatrix4f(d),u_inv_matrix:new o.UniformMatrix4f(d),u_camera_to_center_distance:new o.Uniform1f(d),u_viewport_size:new o.Uniform2f(d)}),debug:d=>({u_color:new o.UniformColor(d),u_matrix:new o.UniformMatrix4f(d),u_overlay:new o.Uniform1i(d),u_overlay_scale:new o.Uniform1f(d)}),clippingMask:d=>({u_matrix:new o.UniformMatrix4f(d)}),heatmap:d=>({u_extrude_scale:new o.Uniform1f(d),u_intensity:new o.Uniform1f(d),u_matrix:new o.UniformMatrix4f(d),u_inv_rot_matrix:new o.UniformMatrix4f(d),u_merc_center:new o.Uniform2f(d),u_tile_id:new o.Uniform3f(d),u_zoom_transition:new o.Uniform1f(d),u_up_dir:new o.Uniform3f(d)}),heatmapTexture:d=>({u_image:new o.Uniform1i(d),u_color_ramp:new o.Uniform1i(d),u_opacity:new o.Uniform1f(d)}),hillshade:d=>({u_matrix:new o.UniformMatrix4f(d),u_image:new o.Uniform1i(d),u_latrange:new o.Uniform2f(d),u_light:new o.Uniform2f(d),u_shadow:new o.UniformColor(d),u_highlight:new o.UniformColor(d),u_accent:new o.UniformColor(d)}),hillshadePrepare:d=>({u_matrix:new o.UniformMatrix4f(d),u_image:new o.Uniform1i(d),u_dimension:new o.Uniform2f(d),u_zoom:new o.Uniform1f(d),u_unpack:new o.Uniform4f(d)}),line:d=>({u_matrix:new o.UniformMatrix4f(d),u_pixels_to_tile_units:new o.UniformMatrix2f(d),u_device_pixel_ratio:new o.Uniform1f(d),u_units_to_pixels:new o.Uniform2f(d),u_dash_image:new o.Uniform1i(d),u_gradient_image:new o.Uniform1i(d),u_image_height:new o.Uniform1f(d),u_texsize:new o.Uniform2f(d),u_tile_units_to_pixels:new o.Uniform1f(d),u_alpha_discard_threshold:new o.Uniform1f(d),u_trim_offset:new o.Uniform2f(d)}),linePattern:d=>({u_matrix:new o.UniformMatrix4f(d),u_texsize:new o.Uniform2f(d),u_pixels_to_tile_units:new o.UniformMatrix2f(d),u_device_pixel_ratio:new o.Uniform1f(d),u_image:new o.Uniform1i(d),u_units_to_pixels:new o.Uniform2f(d),u_tile_units_to_pixels:new o.Uniform1f(d),u_alpha_discard_threshold:new o.Uniform1f(d)}),raster:d=>({u_matrix:new o.UniformMatrix4f(d),u_tl_parent:new o.Uniform2f(d),u_scale_parent:new o.Uniform1f(d),u_fade_t:new o.Uniform1f(d),u_opacity:new o.Uniform1f(d),u_image0:new o.Uniform1i(d),u_image1:new o.Uniform1i(d),u_brightness_low:new o.Uniform1f(d),u_brightness_high:new o.Uniform1f(d),u_saturation_factor:new o.Uniform1f(d),u_contrast_factor:new o.Uniform1f(d),u_spin_weights:new o.Uniform3f(d),u_perspective_transform:new o.Uniform2f(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new o.Uniform1i(d),u_is_size_feature_constant:new o.Uniform1i(d),u_size_t:new o.Uniform1f(d),u_size:new o.Uniform1f(d),u_camera_to_center_distance:new o.Uniform1f(d),u_rotate_symbol:new o.Uniform1i(d),u_aspect_ratio:new o.Uniform1f(d),u_fade_change:new o.Uniform1f(d),u_matrix:new o.UniformMatrix4f(d),u_label_plane_matrix:new o.UniformMatrix4f(d),u_coord_matrix:new o.UniformMatrix4f(d),u_is_text:new o.Uniform1i(d),u_pitch_with_map:new o.Uniform1i(d),u_texsize:new o.Uniform2f(d),u_tile_id:new o.Uniform3f(d),u_zoom_transition:new o.Uniform1f(d),u_inv_rot_matrix:new o.UniformMatrix4f(d),u_merc_center:new o.Uniform2f(d),u_camera_forward:new o.Uniform3f(d),u_tile_matrix:new o.UniformMatrix4f(d),u_up_vector:new o.Uniform3f(d),u_ecef_origin:new o.Uniform3f(d),u_texture:new o.Uniform1i(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new o.Uniform1i(d),u_is_size_feature_constant:new o.Uniform1i(d),u_size_t:new o.Uniform1f(d),u_size:new o.Uniform1f(d),u_camera_to_center_distance:new o.Uniform1f(d),u_rotate_symbol:new o.Uniform1i(d),u_aspect_ratio:new o.Uniform1f(d),u_fade_change:new o.Uniform1f(d),u_matrix:new o.UniformMatrix4f(d),u_label_plane_matrix:new o.UniformMatrix4f(d),u_coord_matrix:new o.UniformMatrix4f(d),u_is_text:new o.Uniform1i(d),u_pitch_with_map:new o.Uniform1i(d),u_texsize:new o.Uniform2f(d),u_texture:new o.Uniform1i(d),u_gamma_scale:new o.Uniform1f(d),u_device_pixel_ratio:new o.Uniform1f(d),u_tile_id:new o.Uniform3f(d),u_zoom_transition:new o.Uniform1f(d),u_inv_rot_matrix:new o.UniformMatrix4f(d),u_merc_center:new o.Uniform2f(d),u_camera_forward:new o.Uniform3f(d),u_tile_matrix:new o.UniformMatrix4f(d),u_up_vector:new o.Uniform3f(d),u_ecef_origin:new o.Uniform3f(d),u_is_halo:new o.Uniform1i(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new o.Uniform1i(d),u_is_size_feature_constant:new o.Uniform1i(d),u_size_t:new o.Uniform1f(d),u_size:new o.Uniform1f(d),u_camera_to_center_distance:new o.Uniform1f(d),u_rotate_symbol:new o.Uniform1i(d),u_aspect_ratio:new o.Uniform1f(d),u_fade_change:new o.Uniform1f(d),u_matrix:new o.UniformMatrix4f(d),u_label_plane_matrix:new o.UniformMatrix4f(d),u_coord_matrix:new o.UniformMatrix4f(d),u_is_text:new o.Uniform1i(d),u_pitch_with_map:new o.Uniform1i(d),u_texsize:new o.Uniform2f(d),u_texsize_icon:new o.Uniform2f(d),u_texture:new o.Uniform1i(d),u_texture_icon:new o.Uniform1i(d),u_gamma_scale:new o.Uniform1f(d),u_device_pixel_ratio:new o.Uniform1f(d),u_is_halo:new o.Uniform1i(d)}),background:d=>({u_matrix:new o.UniformMatrix4f(d),u_opacity:new o.Uniform1f(d),u_color:new o.UniformColor(d)}),backgroundPattern:d=>({u_matrix:new o.UniformMatrix4f(d),u_opacity:new o.Uniform1f(d),u_image:new o.Uniform1i(d),u_pattern_tl:new o.Uniform2f(d),u_pattern_br:new o.Uniform2f(d),u_texsize:new o.Uniform2f(d),u_pattern_size:new o.Uniform2f(d),u_pixel_coord_upper:new o.Uniform2f(d),u_pixel_coord_lower:new o.Uniform2f(d),u_tile_units_to_pixels:new o.Uniform1f(d)}),terrainRaster:lh,terrainDepth:lh,skybox:d=>({u_matrix:new o.UniformMatrix4f(d),u_sun_direction:new o.Uniform3f(d),u_cubemap:new o.Uniform1i(d),u_opacity:new o.Uniform1f(d),u_temporal_offset:new o.Uniform1f(d)}),skyboxGradient:d=>({u_matrix:new o.UniformMatrix4f(d),u_color_ramp:new o.Uniform1i(d),u_center_direction:new o.Uniform3f(d),u_radius:new o.Uniform1f(d),u_opacity:new o.Uniform1f(d),u_temporal_offset:new o.Uniform1f(d)}),skyboxCapture:d=>({u_matrix_3f:new o.UniformMatrix3f(d),u_sun_direction:new o.Uniform3f(d),u_sun_intensity:new o.Uniform1f(d),u_color_tint_r:new o.Uniform4f(d),u_color_tint_m:new o.Uniform4f(d),u_luminance:new o.Uniform1f(d)}),globeRaster:d=>({u_proj_matrix:new o.UniformMatrix4f(d),u_globe_matrix:new o.UniformMatrix4f(d),u_normalize_matrix:new o.UniformMatrix4f(d),u_merc_matrix:new o.UniformMatrix4f(d),u_zoom_transition:new o.Uniform1f(d),u_merc_center:new o.Uniform2f(d),u_image0:new o.Uniform1i(d),u_grid_matrix:new o.UniformMatrix3f(d),u_skirt_height:new o.Uniform1f(d),u_frustum_tl:new o.Uniform3f(d),u_frustum_tr:new o.Uniform3f(d),u_frustum_br:new o.Uniform3f(d),u_frustum_bl:new o.Uniform3f(d),u_globe_pos:new o.Uniform3f(d),u_globe_radius:new o.Uniform1f(d),u_viewport:new o.Uniform2f(d)}),globeAtmosphere:d=>({u_frustum_tl:new o.Uniform3f(d),u_frustum_tr:new o.Uniform3f(d),u_frustum_br:new o.Uniform3f(d),u_frustum_bl:new o.Uniform3f(d),u_horizon:new o.Uniform1f(d),u_transition:new o.Uniform1f(d),u_fadeout_range:new o.Uniform1f(d),u_color:new o.Uniform4f(d),u_high_color:new o.Uniform4f(d),u_space_color:new o.Uniform4f(d),u_star_intensity:new o.Uniform1f(d),u_star_density:new o.Uniform1f(d),u_star_size:new o.Uniform1f(d),u_temporal_offset:new o.Uniform1f(d),u_horizon_angle:new o.Uniform1f(d),u_rotation_matrix:new o.UniformMatrix4f(d)})};let so;function bc(d,r,l,m,v,T,P){const I=d.context,F=I.gl,G=d.transform,$=d.useProgram("collisionBox"),K=[];let le=0,de=0;for(let be=0;be<m.length;be++){const ze=m[be],Pe=r.getTile(ze),Oe=Pe.getBucket(l);if(!Oe)continue;const Xe=Dn(ze,Oe,G);let $e=Xe;v[0]===0&&v[1]===0||($e=d.translatePosMatrix(Xe,Pe,v,T));const it=P?Oe.textCollisionBox:Oe.iconCollisionBox,Mt=Oe.collisionCircleArray;if(Mt.length>0){const et=o.create(),gt=$e;o.mul(et,Oe.placementInvProjMatrix,G.glCoordMatrix),o.mul(et,et,Oe.placementViewportMatrix),K.push({circleArray:Mt,circleOffset:de,transform:gt,invTransform:et,projection:Oe.getProjection()}),le+=Mt.length/4,de=le}it&&(d.terrain&&d.terrain.setupElevationDraw(Pe,$),$.draw(I,F.LINES,o.DepthMode.disabled,o.StencilMode.disabled,d.colorModeForRenderPass(),o.CullFaceMode.disabled,mh($e,G,Pe,Oe.getProjection()),l.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,null,G.zoom,null,[it.collisionVertexBuffer,it.collisionVertexBufferExt]))}if(!P||!K.length)return;const fe=d.useProgram("collisionCircle"),pe=new o.StructArrayLayout2f1f2i16;pe.resize(4*le),pe._trim();let ge=0;for(const be of K)for(let ze=0;ze<be.circleArray.length/4;ze++){const Pe=4*ze,Oe=be.circleArray[Pe+0],Xe=be.circleArray[Pe+1],$e=be.circleArray[Pe+2],it=be.circleArray[Pe+3];pe.emplace(ge++,Oe,Xe,$e,it,0),pe.emplace(ge++,Oe,Xe,$e,it,1),pe.emplace(ge++,Oe,Xe,$e,it,2),pe.emplace(ge++,Oe,Xe,$e,it,3)}(!so||so.length<2*le)&&(so=function(be){const ze=2*be,Pe=new o.StructArrayLayout3ui6;Pe.resize(ze),Pe._trim();for(let Oe=0;Oe<ze;Oe++){const Xe=6*Oe;Pe.uint16[Xe+0]=4*Oe+0,Pe.uint16[Xe+1]=4*Oe+1,Pe.uint16[Xe+2]=4*Oe+2,Pe.uint16[Xe+3]=4*Oe+2,Pe.uint16[Xe+4]=4*Oe+3,Pe.uint16[Xe+5]=4*Oe+0}return Pe}(le));const J=I.createIndexBuffer(so,!0),ue=I.createVertexBuffer(pe,o.collisionCircleLayout.members,!0);for(const be of K){const ze={u_matrix:be.transform,u_inv_matrix:be.invTransform,u_camera_to_center_distance:(ve=G).getCameraToCenterDistance(be.projection),u_viewport_size:[ve.width,ve.height]};fe.draw(I,F.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,d.colorModeForRenderPass(),o.CullFaceMode.disabled,ze,l.id,ue,J,o.SegmentVector.simpleSegment(0,2*be.circleOffset,be.circleArray.length,be.circleArray.length/2),null,G.zoom)}var ve;ue.destroy(),J.destroy()}const zu=o.create();function Ou({width:d,height:r,anchor:l,textOffset:m,textScale:v},T){const{horizontalAlign:P,verticalAlign:I}=o.getAnchorAlignment(l),F=-(P-.5)*d,G=-(I-.5)*r,$=o.evaluateVariableOffset(l,m);return new o.Point((F/v+$[0])*T,(G/v+$[1])*T)}function kf(d,r,l,m,v,T,P,I,F,G,$){const K=d.text.placedSymbolArray,le=d.text.dynamicLayoutVertexArray,de=d.icon.dynamicLayoutVertexArray,fe={},pe=d.getProjection(),ge=Wr(I,pe,T),J=T.elevation,ue=pe.upVectorScale(I.canonical,T.center.lat,T.worldSize).metersToTile;le.clear();for(let ve=0;ve<K.length;ve++){const be=K.get(ve),{tileAnchorX:ze,tileAnchorY:Pe,numGlyphs:Oe}=be,Xe=be.hidden||!be.crossTileID||d.allowVerticalPlacement&&!be.placedOrientation?null:m[be.crossTileID];if(Xe){let $e=0,it=0,Mt=0;if(J){const Rt=J?J.getAtTileOffset(I,ze,Pe):0,[mi,ki,oi]=pe.upVector(I.canonical,ze,Pe);$e=Rt*mi*ue,it=Rt*ki*ue,Mt=Rt*oi*ue}let[et,gt,ot,Pt]=Ns(be.projectedAnchorX+$e,be.projectedAnchorY+it,be.projectedAnchorZ+Mt,l?ge:P);const Je=Yd(T.getCameraToCenterDistance(pe),Pt);let _t=v.evaluateSizeForFeature(d.textSizeData,G,be)*Je/o.ONE_EM;l&&(_t*=d.tilePixelRatio/F);const Lt=Ou(Xe,_t);l?({x:et,y:gt,z:ot}=pe.projectTilePoint(ze+Lt.x,Pe+Lt.y,I.canonical),[et,gt,ot]=Ns(et+$e,gt+it,ot+Mt,P)):(r&&Lt._rotate(-T.angle),et+=Lt.x,gt+=Lt.y,ot=0);const ft=d.allowVerticalPlacement&&be.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Rt=0;Rt<Oe;Rt++)o.addDynamicAttributes(le,et,gt,ot,ft);$&&be.associatedIconIndex>=0&&(fe[be.associatedIconIndex]={x:et,y:gt,z:ot,angle:ft})}else Ln(Oe,le)}if($){de.clear();const ve=d.icon.placedSymbolArray;for(let be=0;be<ve.length;be++){const ze=ve.get(be),{numGlyphs:Pe}=ze,Oe=fe[be];if(ze.hidden||!Oe)Ln(Pe,de);else{const{x:Xe,y:$e,z:it,angle:Mt}=Oe;for(let et=0;et<Pe;et++)o.addDynamicAttributes(de,Xe,$e,it,Mt)}}d.icon.dynamicLayoutVertexBuffer.updateData(de)}d.text.dynamicLayoutVertexBuffer.updateData(le)}function Sl(d,r,l){return l.iconsInText&&r?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function ip(d,r,l,m,v,T,P,I,F,G,$,K){const le=d.context,de=le.gl,fe=d.transform,pe=I==="map",ge=F==="map",J=pe&&l.layout.get("symbol-placement")!=="point",ue=pe&&!ge&&!J,ve=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let be=!1;const ze=d.depthModeForSublayer(0,o.DepthMode.ReadOnly),Pe=[o.mercatorXfromLng(fe.center.lng),o.mercatorYfromLat(fe.center.lat)],Oe=l.layout.get("text-variable-anchor"),Xe=fe.projection.name==="globe",$e=[],it=[0,-1,0];let Mt=it;!Xe&&!fe.mercatorFromTransition||pe||(Mt=function(et){const gt=et._camera.getWorldToCamera(et.worldSize,1),ot=o.multiply([],gt,et.globeMatrix);o.invert(ot,ot);const Pt=[0,0,0],Je=[0,1,0,0];return o.transformMat4$1(Je,Je,ot),Pt[0]=Je[0],Pt[1]=Je[1],Pt[2]=Je[2],o.normalize(Pt,Pt),Pt}(fe));for(const et of m){const gt=r.getTile(et),ot=gt.getBucket(l);if(!ot||ot.projection.name==="mercator"&&Xe)continue;const Pt=v?ot.text:ot.icon;if(!Pt||ot.fullyClipped||!Pt.segments.get().length)continue;const Je=Pt.programConfigurations.get(l.id),_t=v||ot.sdfIcons,Lt=v?ot.textSizeData:ot.iconSizeData,ft=ge||fe.pitch!==0,Rt=o.evaluateSizeForZoom(Lt,fe.zoom);let mi,ki,oi,_i,Oi=[0,0],Bi=null;if(v)ki=gt.glyphAtlasTexture,oi=de.LINEAR,mi=gt.glyphAtlasTexture.size,ot.iconsInText&&(Oi=gt.imageAtlasTexture.size,Bi=gt.imageAtlasTexture,_i=ft||d.options.rotating||d.options.zooming||Lt.kind==="composite"||Lt.kind==="camera"?de.LINEAR:de.NEAREST);else{const Po=l.layout.get("icon-size").constantOr(0)!==1||ot.iconsNeedLinear;ki=gt.imageAtlasTexture,oi=_t||d.options.rotating||d.options.zooming||Po||ft?de.LINEAR:de.NEAREST,mi=gt.imageAtlasTexture.size}const di=ot.projection.name==="globe",xr=di?Mt:it,Er=di?o.globeToMercatorTransition(fe.zoom):0,Sr=Wr(et,ot.getProjection(),fe),Ar=fe.calculatePixelsToTileUnitsMatrix(gt),en=ut(Sr,gt.tileID.canonical,ge,pe,fe,ot.getProjection(),Ar),Gs=d.terrain&&ge&&J?o.invert(o.create(),en):zu,Nn=_s(Sr,gt.tileID.canonical,ge,pe,fe,ot.getProjection(),Ar),wr=Oe&&ot.hasTextData(),Fr=l.layout.get("icon-text-fit")!=="none"&&wr&&ot.hasIconData();if(J){const Po=fe.elevation,ta=Po?Po.getAtTileOffsetFunc(et,fe.center.lat,fe.worldSize,ot.getProjection()):null,Ya=wo(Sr,gt.tileID.canonical,ge,pe,fe,ot.getProjection(),Ar);th(ot,Sr,d,v,Ya,Nn,ge,G,ta,et)}const Lr=J||v&&Oe||Fr,or=d.translatePosMatrix(Sr,gt,T,P),ys=Lr?zu:en,dn=d.translatePosMatrix(Nn,gt,T,P,!0),Nr=ot.getProjection().createInversionMatrix(fe,et.canonical),ks=[];d.terrainRenderModeElevated()&&ge&&ks.push("PITCH_WITH_MAP_TERRAIN"),di&&ks.push("PROJECTION_GLOBE_VIEW"),Lr&&ks.push("PROJECTED_POS_ON_VIEWPORT");const kh=_t&&l.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ea;ea=_t?ot.iconsInText?vc(Lt.kind,Rt,ue,ge,d,or,ys,dn,mi,Oi,et,Er,Pe,Nr,xr,ot.getProjection()):_h(Lt.kind,Rt,ue,ge,d,or,ys,dn,v,mi,!0,et,Er,Pe,Nr,xr,ot.getProjection()):Lu(Lt.kind,Rt,ue,ge,d,or,ys,dn,v,mi,et,Er,Pe,Nr,xr,ot.getProjection());const Fl={program:d.useProgram(Sl(_t,v,ot),Je,ks),buffers:Pt,uniformValues:ea,atlasTexture:ki,atlasTextureIcon:Bi,atlasInterpolation:oi,atlasInterpolationIcon:_i,isSDF:_t,hasHalo:kh,tile:gt,labelPlaneMatrixInv:Gs};if(ve&&ot.canOverlap){be=!0;const Po=Pt.segments.get();for(const ta of Po)$e.push({segments:new o.SegmentVector([ta]),sortKey:ta.sortKey,state:Fl})}else $e.push({segments:Pt.segments,sortKey:0,state:Fl})}be&&$e.sort((et,gt)=>et.sortKey-gt.sortKey);for(const et of $e){const gt=et.state;if(d.terrain&&d.terrain.setupElevationDraw(gt.tile,gt.program,{useDepthForOcclusion:!Xe,labelPlaneMatrixInv:gt.labelPlaneMatrixInv}),le.activeTexture.set(de.TEXTURE0),gt.atlasTexture.bind(gt.atlasInterpolation,de.CLAMP_TO_EDGE),gt.atlasTextureIcon&&(le.activeTexture.set(de.TEXTURE1),gt.atlasTextureIcon&&gt.atlasTextureIcon.bind(gt.atlasInterpolationIcon,de.CLAMP_TO_EDGE)),gt.isSDF){const ot=gt.uniformValues;gt.hasHalo&&(ot.u_is_halo=1,wc(gt.buffers,et.segments,l,d,gt.program,ze,$,K,ot)),ot.u_is_halo=0}wc(gt.buffers,et.segments,l,d,gt.program,ze,$,K,gt.uniformValues)}}function wc(d,r,l,m,v,T,P,I,F){const G=m.context,$=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.globeExtVertexBuffer];v.draw(G,G.gl.TRIANGLES,T,P,I,o.CullFaceMode.disabled,F,l.id,d.layoutVertexBuffer,d.indexBuffer,r,l.paint,m.transform.zoom,d.programConfigurations.get(l.id),$)}function Bu(d,r,l,m,v,T,P){const I=d.context.gl,F=l.paint.get("fill-pattern"),G=F&&F.constantOr(1);let $,K,le,de,fe;P?(K=G&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=I.LINES):(K=G?"fillPattern":"fill",$=I.TRIANGLES);for(const pe of m){const ge=r.getTile(pe);if(G&&!ge.patternsLoaded())continue;const J=ge.getBucket(l);if(!J)continue;d.prepareDrawTile();const ue=J.programConfigurations.get(l.id),ve=d.useProgram(K,ue);G&&(d.context.activeTexture.set(I.TEXTURE0),ge.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ue.updatePaintBuffers());const be=F.constantOr(null);if(be&&ge.imageAtlas){const Pe=ge.imageAtlas.patternPositions[be.toString()];Pe&&ue.setConstantPatternPositions(Pe)}const ze=d.translatePosMatrix(pe.projMatrix,ge,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(P){de=J.indexBuffer2,fe=J.segments2;const Pe=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];le=K==="fillOutlinePattern"&&G?Pu(ze,d,ge,Pe):ku(ze,Pe)}else de=J.indexBuffer,fe=J.segments,le=G?Cu(ze,d,ge):Na(ze);d.prepareDrawProgram(d.context,ve,pe.toUnwrapped()),ve.draw(d.context,$,v,d.stencilModeForClipping(pe),T,o.CullFaceMode.disabled,le,l.id,J.layoutVertexBuffer,de,fe,l.paint,d.transform.zoom,ue)}}function yh(d,r,l,m,v,T,P){const I=d.context,F=I.gl,G=d.transform,$=l.paint.get("fill-extrusion-pattern"),K=$.constantOr(1),le=l.paint.get("fill-extrusion-opacity"),de=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),l.paint.get("fill-extrusion-ambient-occlusion-radius")],fe=l.layout.get("fill-extrusion-edge-radius"),pe=fe>0&&!l.paint.get("fill-extrusion-rounded-roof"),ge=pe?0:fe,J=G.projection.name==="globe"?o.fillExtrusionHeightLift():0,ue=G.projection.name==="globe",ve=ue?o.globeToMercatorTransition(G.zoom):0,be=[o.mercatorXfromLng(G.center.lng),o.mercatorYfromLat(G.center.lat)],ze=[];ue&&ze.push("PROJECTION_GLOBE_VIEW"),de[0]>0&&ze.push("FAUX_AO"),pe&&ze.push("ZERO_ROOF_RADIUS");for(const Pe of m){const Oe=r.getTile(Pe),Xe=Oe.getBucket(l);if(!Xe||Xe.projection.name!==G.projection.name)continue;const $e=Xe.programConfigurations.get(l.id),it=d.useProgram(K?"fillExtrusionPattern":"fillExtrusion",$e,ze);if(d.terrain){const _t=d.terrain;if(d.style.terrainSetForDrapingOnly())_t.setupElevationDraw(Oe,it,{useMeterToDem:!0});else{if(!Xe.enableTerrain)continue;if(_t.setupElevationDraw(Oe,it,{useMeterToDem:!0}),Ga(I,r,Pe,Xe,l,_t),!Xe.centroidVertexBuffer){const Lt=it.attributes.a_centroid_pos;Lt!==void 0&&F.vertexAttrib2f(Lt,0,0)}}}K&&(d.context.activeTexture.set(F.TEXTURE0),Oe.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),$e.updatePaintBuffers());const Mt=$.constantOr(null);if(Mt&&Oe.imageAtlas){const _t=Oe.imageAtlas.patternPositions[Mt.toString()];_t&&$e.setConstantPatternPositions(_t)}const et=d.translatePosMatrix(Pe.projMatrix,Oe,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),gt=G.projection.createInversionMatrix(G,Pe.canonical),ot=l.paint.get("fill-extrusion-vertical-gradient"),Pt=K?ep(et,d,ot,le,de,ge,Pe,Oe,J,ve,be,gt):ph(et,d,ot,le,de,ge,Pe,J,ve,be,gt);d.prepareDrawProgram(I,it,Pe.toUnwrapped());const Je=[];d.terrain&&Je.push(Xe.centroidVertexBuffer),ue&&Je.push(Xe.layoutVertexExtBuffer),it.draw(I,I.gl.TRIANGLES,v,T,P,o.CullFaceMode.backCCW,Pt,l.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,l.paint,d.transform.zoom,$e,Je)}}function Ga(d,r,l,m,v,T){const P=[J=>{let ue=J.canonical.x-1,ve=J.wrap;return ue<0&&(ue=(1<<J.canonical.z)-1,ve--),new o.OverscaledTileID(J.overscaledZ,ve,J.canonical.z,ue,J.canonical.y)},J=>{let ue=J.canonical.x+1,ve=J.wrap;return ue===1<<J.canonical.z&&(ue=0,ve++),new o.OverscaledTileID(J.overscaledZ,ve,J.canonical.z,ue,J.canonical.y)},J=>new o.OverscaledTileID(J.overscaledZ,J.wrap,J.canonical.z,J.canonical.x,(J.canonical.y===0?1<<J.canonical.z:J.canonical.y)-1),J=>new o.OverscaledTileID(J.overscaledZ,J.wrap,J.canonical.z,J.canonical.x,J.canonical.y===(1<<J.canonical.z)-1?0:J.canonical.y+1)],I=J=>{const ue=r.getSource().minzoom,ve=ze=>{const Pe=r.getTileByID(ze);if(Pe&&Pe.hasData())return Pe.getBucket(v)},be=[0,-1,1];for(const ze of be){if(J.overscaledZ+ze<ue)continue;const Pe=ve(J.calculateScaledKey(J.overscaledZ+ze));if(Pe)return Pe}},F=[0,0,0],G=(J,ue)=>(F[0]=Math.min(J.min.y,ue.min.y),F[1]=Math.max(J.max.y,ue.max.y),F[2]=o.EXTENT-ue.min.x>J.max.x?ue.min.x-o.EXTENT:J.max.x,F),$=(J,ue)=>(F[0]=Math.min(J.min.x,ue.min.x),F[1]=Math.max(J.max.x,ue.max.x),F[2]=o.EXTENT-ue.min.y>J.max.y?ue.min.y-o.EXTENT:J.max.y,F),K=[(J,ue)=>G(J,ue),(J,ue)=>G(ue,J),(J,ue)=>$(J,ue),(J,ue)=>$(ue,J)],le=new o.Point(0,0);let de,fe,pe;const ge=(J,ue,ve,be,ze)=>{const Pe=[[be?ve:J,be?J:ve,0],[be?ve:ue,be?ue:ve,0]],Oe=ze<0?o.EXTENT+ze:ze,Xe=[be?Oe:(J+ue)/2,be?(J+ue)/2:Oe,0];return ve===0&&ze<0||ve!==0&&ze>0?T.getForTilePoints(pe,[Xe],!0,fe):Pe.push(Xe),T.getForTilePoints(l,Pe,!0,de),Math.max(Pe[0][2],Pe[1][2],Xe[2])/T.exaggeration()};for(let J=0;J<4;J++){const ue=(J<2?1:5)-J,ve=m.borders[J];if(ve.length===0)continue;const be=pe=P[J](l),ze=I(be);if(!(ze&&ze instanceof o.FillExtrusionBucket&&ze.enableTerrain)||m.borderDoneWithNeighborZ[J]===ze.canonical.z&&ze.borderDoneWithNeighborZ[ue]===m.canonical.z||(fe=T.findDEMTileFor(be),!fe||!fe.dem))continue;if(!de){const $e=T.findDEMTileFor(l);if(!$e||!$e.dem)return;de=$e}const Pe=ze.borders[ue];let Oe=0;const Xe=ze.borderDoneWithNeighborZ[ue]!==m.canonical.z;if(m.canonical.z===ze.canonical.z){for(let $e=0;$e<ve.length;$e++){const it=m.featuresOnBorder[ve[$e]],Mt=it.borders[J];let et;for(;Oe<Pe.length&&(et=ze.featuresOnBorder[Pe[Oe]],!(et.borders[ue][1]>Mt[0]+3));)Xe&&ze.encodeCentroid(void 0,et,!1),Oe++;if(et&&Oe<Pe.length){const gt=Oe;let ot=0;for(;!(et.borders[ue][0]>Mt[1]-3)&&(ot++,++Oe!==Pe.length);)et=ze.featuresOnBorder[Pe[Oe]];if(et=ze.featuresOnBorder[Pe[gt]],it.intersectsCount()>1||et.intersectsCount()>1||ot!==1){ot!==1&&(Oe=gt),m.encodeCentroid(void 0,it,!1),Xe&&ze.encodeCentroid(void 0,et,!1);continue}const Pt=K[J](it,et),Je=J%2?o.EXTENT-1:0;le.x=ge(Pt[0],Math.min(o.EXTENT-1,Pt[1]),Je,J<2,Pt[2]),le.y=0,m.encodeCentroid(le,it,!1),Xe&&ze.encodeCentroid(le,et,!1)}else m.encodeCentroid(void 0,it,!1)}m.borderDoneWithNeighborZ[J]=ze.canonical.z,m.needsCentroidUpdate=!0,Xe&&(ze.borderDoneWithNeighborZ[ue]=m.canonical.z,ze.needsCentroidUpdate=!0)}else{for(const $e of ve)m.encodeCentroid(void 0,m.featuresOnBorder[$e],!1);if(Xe){for(const $e of Pe)ze.encodeCentroid(void 0,ze.featuresOnBorder[$e],!1);ze.borderDoneWithNeighborZ[ue]=m.canonical.z,ze.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[J]=ze.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(d)}const On=new o.Color(1,0,0,1),Pf=new o.Color(0,1,0,1),If=new o.Color(0,0,1,1),Lf=new o.Color(1,0,1,1),Df=new o.Color(0,1,1,1);function Rf(d,r,l){const m=d.context,v=d.transform,T=m.gl,P=v.projection.name==="globe",I=P?["PROJECTION_GLOBE_VIEW"]:null;let F=l.projMatrix;if(P&&o.globeToMercatorTransition(v.zoom)>0){const it=o.transitionTileAABBinECEF(l.canonical,v),Mt=o.globeDenormalizeECEF(it);F=o.multiply(new Float32Array(16),v.globeMatrix,Mt),o.multiply(F,v.projMatrix,F)}const G=d.useProgram("debug",null,I),$=r.getTileByID(l.key);d.terrain&&d.terrain.setupElevationDraw($,G);const K=o.DepthMode.disabled,le=o.StencilMode.disabled,de=d.colorModeForRenderPass(),fe="$debug";m.activeTexture.set(T.TEXTURE0),d.emptyTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),P?$._makeGlobeTileDebugBuffers(d.context,v):$._makeDebugTileBoundsBuffers(d.context,v.projection);const pe=$._tileDebugBuffer||d.debugBuffer,ge=$._tileDebugIndexBuffer||d.debugIndexBuffer,J=$._tileDebugSegments||d.debugSegments;G.draw(m,T.LINE_STRIP,K,le,de,o.CullFaceMode.disabled,Ua(F,o.Color.red),fe,pe,ge,J,null,null,null,[$._globeTileDebugBorderBuffer]);const ue=$.latestRawTileData,ve=Math.floor((ue&&ue.byteLength||0)/1024),be=r.getTile(l).tileSize,ze=512/Math.min(be,512)*(l.overscaledZ/v.zoom)*.5;let Pe=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(Pe+=` => ${l.overscaledZ}`),Pe+=` ${ve}kb`,function(it,Mt){it.initDebugOverlayCanvas();const et=it.debugOverlayCanvas,gt=it.context.gl,ot=it.debugOverlayCanvas.getContext("2d");ot.clearRect(0,0,et.width,et.height),ot.shadowColor="white",ot.shadowBlur=2,ot.lineWidth=1.5,ot.strokeStyle="white",ot.textBaseline="top",ot.font="bold 36px Open Sans, sans-serif",ot.fillText(Mt,5,5),ot.strokeText(Mt,5,5),it.debugOverlayTexture.update(et),it.debugOverlayTexture.bind(gt.LINEAR,gt.CLAMP_TO_EDGE)}(d,Pe);const Oe=$._tileDebugTextBuffer||d.debugBuffer,Xe=$._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,$e=$._tileDebugTextSegments||d.debugSegments;G.draw(m,T.TRIANGLES,K,le,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,Ua(F,o.Color.transparent,ze),fe,Oe,Xe,$e,null,null,null,[$._globeTileDebugTextBuffer])}function Tc(d,r,l,m){Ml(d,0,r+l/2,d.transform.width,l,m)}function Al(d,r,l,m){Ml(d,r-l/2,0,l,d.transform.height,m)}function Ml(d,r,l,m,v,T){const P=d.context,I=P.gl;I.enable(I.SCISSOR_TEST),I.scissor(r*o.exported.devicePixelRatio,l*o.exported.devicePixelRatio,m*o.exported.devicePixelRatio,v*o.exported.devicePixelRatio),P.clear({color:T}),I.disable(I.SCISSOR_TEST)}const Ec=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:xh}=Ec;function Yo(d,r,l,m){d.emplaceBack(r,l,m)}class Sc{constructor(r){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,Yo(this.vertexArray,-1,-1,1),Yo(this.vertexArray,1,-1,1),Yo(this.vertexArray,-1,1,1),Yo(this.vertexArray,1,1,1),Yo(this.vertexArray,-1,-1,-1),Yo(this.vertexArray,1,-1,-1),Yo(this.vertexArray,-1,1,-1),Yo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,xh),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function Ks(d,r,l,m,v,T){const P=d.gl,I=r.paint.get("sky-atmosphere-color"),F=r.paint.get("sky-atmosphere-halo-color"),G=r.paint.get("sky-atmosphere-sun-intensity"),$=((K,le,de,fe,pe)=>({u_matrix_3f:K,u_sun_direction:le,u_sun_intensity:de,u_color_tint_r:[fe.r,fe.g,fe.b,fe.a],u_color_tint_m:[pe.r,pe.g,pe.b,pe.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),m),v,G,I,F);P.framebufferTexture2D(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0,P.TEXTURE_CUBE_MAP_POSITIVE_X+T,r.skyboxTexture,0),l.draw(d,P.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,$,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Ac=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Mc{constructor(r){const l=new o.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const m=new o.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(l,Ac.members),this.indexBuffer=r.createIndexBuffer(m),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const $a={symbol:function(d,r,l,m,v){if(d.renderPass!=="translucent")return;const T=o.StencilMode.disabled,P=d.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(I,F,G,$,K,le,de){const fe=F.transform,pe=K==="map",ge=le==="map";for(const J of I){const ue=$.getTile(J),ve=ue.getBucket(G);if(!ve||!ve.text||!ve.text.segments.get().length)continue;const be=o.evaluateSizeForZoom(ve.textSizeData,fe.zoom),ze=Wr(J,ve.getProjection(),fe),Pe=fe.calculatePixelsToTileUnitsMatrix(ue),Oe=ut(ze,ue.tileID.canonical,ge,pe,fe,ve.getProjection(),Pe),Xe=G.layout.get("icon-text-fit")!=="none"&&ve.hasIconData();if(be){const $e=Math.pow(2,fe.zoom-ue.tileID.overscaledZ);kf(ve,pe,ge,de,o.symbolSize,fe,Oe,J,$e,be,Xe)}}}(m,d,l,r,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),v),l.paint.get("icon-opacity").constantOr(1)!==0&&ip(d,r,l,m,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),T,P),l.paint.get("text-opacity").constantOr(1)!==0&&ip(d,r,l,m,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),T,P),r.map.showCollisionBoxes&&(bc(d,r,l,m,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),bc(d,r,l,m,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(d,r,l,m){if(d.renderPass!=="translucent")return;const v=l.paint.get("circle-opacity"),T=l.paint.get("circle-stroke-width"),P=l.paint.get("circle-stroke-opacity"),I=l.layout.get("circle-sort-key").constantOr(1)!==void 0;if(v.constantOr(1)===0&&(T.constantOr(1)===0||P.constantOr(1)===0))return;const F=d.context,G=F.gl,$=d.transform,K=d.depthModeForSublayer(0,o.DepthMode.ReadOnly),le=o.StencilMode.disabled,de=d.colorModeForRenderPass(),fe=$.projection.name==="globe",pe=[o.mercatorXfromLng($.center.lng),o.mercatorYfromLat($.center.lat)],ge=[];for(let ue=0;ue<m.length;ue++){const ve=m[ue],be=r.getTile(ve),ze=be.getBucket(l);if(!ze||ze.projection.name!==$.projection.name)continue;const Pe=ze.programConfigurations.get(l.id),Oe=Iu(l);fe&&Oe.push("PROJECTION_GLOBE_VIEW");const Xe=d.useProgram("circle",Pe,Oe),$e=ze.layoutVertexBuffer,it=ze.globeExtVertexBuffer,Mt=ze.indexBuffer,et=$.projection.createInversionMatrix($,ve.canonical),gt={programConfiguration:Pe,program:Xe,layoutVertexBuffer:$e,globeExtVertexBuffer:it,indexBuffer:Mt,uniformValues:El(d,ve,be,et,pe,l),tile:be};if(I){const ot=ze.segments.get();for(const Pt of ot)ge.push({segments:new o.SegmentVector([Pt]),sortKey:Pt.sortKey,state:gt})}else ge.push({segments:ze.segments,sortKey:0,state:gt})}I&&ge.sort((ue,ve)=>ue.sortKey-ve.sortKey);const J={useDepthForOcclusion:!fe};for(const ue of ge){const{programConfiguration:ve,program:be,layoutVertexBuffer:ze,globeExtVertexBuffer:Pe,indexBuffer:Oe,uniformValues:Xe,tile:$e}=ue.state,it=ue.segments;d.terrain&&d.terrain.setupElevationDraw($e,be,J),d.prepareDrawProgram(F,be,$e.tileID.toUnwrapped()),be.draw(F,G.TRIANGLES,K,le,de,o.CullFaceMode.disabled,Xe,l.id,ze,Oe,it,l.paint,$.zoom,ve,[Pe])}},heatmap:function(d,r,l,m){if(l.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const v=d.context,T=v.gl,P=o.StencilMode.disabled,I=new o.ColorMode([T.ONE,T.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(de,fe,pe,ge){const J=de.gl,ue=fe.width*ge,ve=fe.height*ge;de.activeTexture.set(J.TEXTURE1),de.viewport.set([0,0,ue,ve]);let be=pe.heatmapFbo;if(!be||be&&(be.width!==ue||be.height!==ve)){be&&be.destroy();const ze=J.createTexture();J.bindTexture(J.TEXTURE_2D,ze),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.LINEAR),be=pe.heatmapFbo=de.createFramebuffer(ue,ve,!1),function(Pe,Oe,Xe,$e,it,Mt){const et=Pe.gl;et.texImage2D(et.TEXTURE_2D,0,Pe.isWebGL2&&Pe.extRenderToTextureHalfFloat?et.RGBA16F:et.RGBA,it,Mt,0,et.RGBA,Pe.extRenderToTextureHalfFloat?Pe.isWebGL2?et.HALF_FLOAT:Pe.extTextureHalfFloat.HALF_FLOAT_OES:et.UNSIGNED_BYTE,null),$e.colorAttachment.set(Xe)}(de,0,ze,be,ue,ve)}else J.bindTexture(J.TEXTURE_2D,be.colorAttachment.get()),de.bindFramebuffer.set(be.framebuffer)})(v,d,l,d.transform.projection.name==="globe"?.5:.25),v.clear({color:o.Color.transparent});const F=d.transform,G=F.projection.name==="globe",$=G?["PROJECTION_GLOBE_VIEW"]:null,K=G?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,le=[o.mercatorXfromLng(F.center.lng),o.mercatorYfromLat(F.center.lat)];for(let de=0;de<m.length;de++){const fe=m[de];if(r.hasRenderableParent(fe))continue;const pe=r.getTile(fe),ge=pe.getBucket(l);if(!ge||ge.projection.name!==F.projection.name)continue;const J=ge.programConfigurations.get(l.id),ue=d.useProgram("heatmap",J,$),{zoom:ve}=d.transform;d.terrain&&d.terrain.setupElevationDraw(pe,ue),d.prepareDrawProgram(v,ue,fe.toUnwrapped());const be=F.projection.createInversionMatrix(F,fe.canonical);ue.draw(v,T.TRIANGLES,o.DepthMode.disabled,P,I,K,tp(d,fe,pe,be,le,ve,l.paint.get("heatmap-intensity")),l.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,l.paint,d.transform.zoom,J,G?[ge.globeExtVertexBuffer]:null)}v.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(v,T){const P=v.context,I=P.gl,F=T.heatmapFbo;if(!F)return;P.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,F.colorAttachment.get()),P.activeTexture.set(I.TEXTURE1);let G=T.colorRampTexture;G||(G=T.colorRampTexture=new o.Texture(P,T.colorRamp,I.RGBA)),G.bind(I.LINEAR,I.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(P,I.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,v.colorModeForRenderPass(),o.CullFaceMode.disabled,(($,K,le,de)=>({u_image:0,u_color_ramp:1,u_opacity:K.paint.get("heatmap-opacity")}))(0,T),T.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,T.paint,v.transform.zoom)}(d,l))},line:function(d,r,l,m){if(d.renderPass!=="translucent")return;const v=l.paint.get("line-opacity"),T=l.paint.get("line-width");if(v.constantOr(1)===0||T.constantOr(1)===0)return;const P=d.depthModeForSublayer(0,o.DepthMode.ReadOnly),I=d.colorModeForRenderPass(),F=d.terrain&&d.terrain.renderingToTexture?1:o.exported.devicePixelRatio,G=l.paint.get("line-dasharray"),$=G.constantOr(1),K=l.layout.get("line-cap"),le=l.paint.get("line-pattern"),de=le.constantOr(1),fe=l.paint.get("line-gradient"),pe=de?"linePattern":"line",ge=d.context,J=ge.gl,ue=(be=>{const ze=[];yc(be)&&ze.push("RENDER_LINE_DASH"),be.paint.get("line-gradient")&&ze.push("RENDER_LINE_GRADIENT");const Pe=be.paint.get("line-trim-offset");Pe[0]===0&&Pe[1]===0||ze.push("RENDER_LINE_TRIM_OFFSET");const Oe=be.paint.get("line-pattern").constantOr(1),Xe=be.paint.get("line-opacity").constantOr(1)!==1;return!Oe&&Xe&&ze.push("RENDER_LINE_ALPHA_DISCARD"),ze})(l);let ve=ue.includes("RENDER_LINE_ALPHA_DISCARD");d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(ve=!1);for(const be of m){const ze=r.getTile(be);if(de&&!ze.patternsLoaded())continue;const Pe=ze.getBucket(l);if(!Pe)continue;d.prepareDrawTile();const Oe=Pe.programConfigurations.get(l.id),Xe=d.useProgram(pe,Oe,ue),$e=le.constantOr(null);if($e&&ze.imageAtlas){const _t=ze.imageAtlas.patternPositions[$e.toString()];_t&&Oe.setConstantPatternPositions(_t)}const it=G.constantOr(null),Mt=K.constantOr(null);if(!de&&it&&Mt&&ze.lineAtlas){const _t=ze.lineAtlas.getDash(it,Mt);_t&&Oe.setConstantPatternPositions(_t)}let[et,gt]=l.paint.get("line-trim-offset");(Mt==="round"||Mt==="square")&&et!==gt&&(et===0&&(et-=1),gt===1&&(gt+=1));const ot=d.terrain?be.projMatrix:null,Pt=de?_c(d,ze,l,ot,F):ja(d,ze,l,ot,Pe.lineClipsArray.length,F,[et,gt]);if(fe){const _t=Pe.gradients[l.id];let Lt=_t.texture;if(l.gradientVersion!==_t.version){let ft=256;if(l.stepInterpolant){const Rt=r.getSource().maxzoom,mi=be.canonical.z===Rt?Math.ceil(1<<d.transform.maxZoom-be.canonical.z):1;ft=o.clamp(o.nextPowerOfTwo(Pe.maxLineLength/o.EXTENT*1024*mi),256,ge.maxTextureSize)}_t.gradient=o.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:ft,image:_t.gradient||void 0,clips:Pe.lineClipsArray}),_t.texture?_t.texture.update(_t.gradient):_t.texture=new o.Texture(ge,_t.gradient,J.RGBA),_t.version=l.gradientVersion,Lt=_t.texture}ge.activeTexture.set(J.TEXTURE1),Lt.bind(l.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}$&&(ge.activeTexture.set(J.TEXTURE0),ze.lineAtlasTexture.bind(J.LINEAR,J.REPEAT),Oe.updatePaintBuffers()),de&&(ge.activeTexture.set(J.TEXTURE0),ze.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),Oe.updatePaintBuffers()),d.prepareDrawProgram(ge,Xe,be.toUnwrapped());const Je=_t=>{Xe.draw(ge,J.TRIANGLES,P,_t,I,o.CullFaceMode.disabled,Pt,l.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,l.paint,d.transform.zoom,Oe,[Pe.layoutVertexBuffer2])};if(ve){const _t=d.stencilModeForClipping(be).ref;_t===0&&d.terrain&&ge.clear({stencil:0});const Lt={func:J.EQUAL,mask:255};Pt.u_alpha_discard_threshold=.8,Je(new o.StencilMode(Lt,_t,255,J.KEEP,J.KEEP,J.INVERT)),Pt.u_alpha_discard_threshold=0,Je(new o.StencilMode(Lt,_t,255,J.KEEP,J.KEEP,J.KEEP))}else Je(d.stencilModeForClipping(be))}ve&&(d.resetStencilClippingMasks(),d.terrain&&ge.clear({stencil:0}))},fill:function(d,r,l,m){const v=l.paint.get("fill-color"),T=l.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const P=d.colorModeForRenderPass(),I=l.paint.get("fill-pattern"),F=d.opaquePassEnabledForLayer()&&!I.constantOr(1)&&v.constantOr(o.Color.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===F){const G=d.depthModeForSublayer(1,d.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);Bu(d,r,l,m,G,P,!1)}if(d.renderPass==="translucent"&&l.paint.get("fill-antialias")){const G=d.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);Bu(d,r,l,m,G,P,!0)}},"fill-extrusion":function(d,r,l,m){const v=l.paint.get("fill-extrusion-opacity");if(v!==0&&d.renderPass==="translucent"){const T=new o.DepthMode(d.context.gl.LEQUAL,o.DepthMode.ReadWrite,d.depthRangeFor3D);if(v!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))yh(d,r,l,m,T,o.StencilMode.disabled,o.ColorMode.disabled),yh(d,r,l,m,T,d.stencilModeFor3D(),d.colorModeForRenderPass()),d.resetStencilClippingMasks();else{const P=d.colorModeForRenderPass();yh(d,r,l,m,T,o.StencilMode.disabled,P)}}},hillshade:function(d,r,l,m){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const v=d.context,T=d.depthModeForSublayer(0,o.DepthMode.ReadOnly),P=d.colorModeForRenderPass(),I=d.terrain&&d.terrain.renderingToTexture,[F,G]=d.renderPass!=="translucent"||I?[{},m]:d.stencilConfigForOverlap(m);for(const $ of G){const K=r.getTile($);if(K.needsHillshadePrepare&&d.renderPass==="offscreen")ah(d,K,l,T,o.StencilMode.disabled,P);else if(d.renderPass==="translucent"){const le=I&&d.terrain?d.terrain.stencilModeForRTTOverlap($):F[$.overscaledZ];Eu(d,$,K,l,T,le,P)}}v.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,r,l,m,v,T){if(d.renderPass!=="translucent"||l.paint.get("raster-opacity")===0||!m.length)return;const P=d.context,I=P.gl,F=r.getSource(),G=d.useProgram("raster"),$=d.colorModeForRenderPass(),K=d.terrain&&d.terrain.renderingToTexture,[le,de]=F instanceof Si||K?[{},m]:d.stencilConfigForOverlap(m),fe=de[de.length-1].overscaledZ,pe=!d.options.moving;for(const ge of de){const J=K?o.DepthMode.disabled:d.depthModeForSublayer(ge.overscaledZ-fe,l.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,I.LESS),ue=ge.toUnwrapped(),ve=r.getTile(ge);if(K&&(!ve||!ve.hasData()))continue;const be=K?ge.projMatrix:d.transform.calculateProjMatrix(ue,pe),ze=d.terrain&&K?d.terrain.stencilModeForRTTOverlap(ge):le[ge.overscaledZ],Pe=T?0:l.paint.get("raster-fade-duration");ve.registerFadeDuration(Pe);const Oe=r.findLoadedParent(ge,0),Xe=Su(ve,Oe,r,d.transform,Pe);let $e,it;d.terrain&&d.terrain.prepareDrawTile();const Mt=l.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;P.activeTexture.set(I.TEXTURE0),ve.texture.bind(Mt,I.CLAMP_TO_EDGE),P.activeTexture.set(I.TEXTURE1),Oe?(Oe.texture.bind(Mt,I.CLAMP_TO_EDGE),$e=Math.pow(2,Oe.tileID.overscaledZ-ve.tileID.overscaledZ),it=[ve.tileID.canonical.x*$e%1,ve.tileID.canonical.y*$e%1]):ve.texture.bind(Mt,I.CLAMP_TO_EDGE),ve.texture.useMipmap&&P.extTextureFilterAnisotropic&&d.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);const et=xc(be,it||[0,0],$e||1,Xe,l,F instanceof Si?F.perspectiveTransform:[0,0]);if(d.prepareDrawProgram(P,G,ue),F instanceof Si)F.boundsBuffer&&F.boundsSegments&&G.draw(P,I.TRIANGLES,J,o.StencilMode.disabled,$,o.CullFaceMode.disabled,et,l.id,F.boundsBuffer,d.quadTriangleIndexBuffer,F.boundsSegments);else{const{tileBoundsBuffer:gt,tileBoundsIndexBuffer:ot,tileBoundsSegments:Pt}=d.getTileBoundsBuffers(ve);G.draw(P,I.TRIANGLES,J,ze,$,o.CullFaceMode.disabled,et,l.id,gt,ot,Pt)}}d.resetStencilClippingMasks()},background:function(d,r,l,m){const v=l.paint.get("background-color"),T=l.paint.get("background-opacity");if(T===0)return;const P=d.context,I=P.gl,F=d.transform,G=F.tileSize,$=l.paint.get("background-pattern");if(d.isPatternMissing($))return;const K=!$&&v.a===1&&T===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==K)return;const le=o.StencilMode.disabled,de=d.depthModeForSublayer(0,K==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),fe=d.colorModeForRenderPass(),pe=d.useProgram($?"backgroundPattern":"background");let ge,J=m;J||(ge=d.getBackgroundTiles(),J=Object.values(ge).map(ue=>ue.tileID)),$&&(P.activeTexture.set(I.TEXTURE0),d.imageManager.bind(d.context));for(const ue of J){const ve=ue.toUnwrapped(),be=m?ue.projMatrix:d.transform.calculateProjMatrix(ve);d.prepareDrawTile();const ze=r?r.getTile(ue):ge?ge[ue.key]:new o.Tile(ue,G,F.zoom,d),Pe=$?Cf(be,T,d,$,{tileID:ue,tileSize:G}):Du(be,T,v);d.prepareDrawProgram(P,pe,ve);const{tileBoundsBuffer:Oe,tileBoundsIndexBuffer:Xe,tileBoundsSegments:$e}=d.getTileBoundsBuffers(ze);pe.draw(P,I.TRIANGLES,de,le,fe,o.CullFaceMode.disabled,Pe,l.id,Oe,Xe,$e)}},sky:function(d,r,l){const m=d.transform,v=m.projection.name==="mercator"||m.projection.name==="globe"?1:o.smoothstep(7,8,m.zoom),T=l.paint.get("sky-opacity")*v;if(T===0)return;const P=d.context,I=l.paint.get("sky-type"),F=new o.DepthMode(P.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),G=d.frameCounter/1e3%1;I==="atmosphere"?d.renderPass==="offscreen"?l.needsSkyboxCapture(d)&&(function($,K,le,de){const fe=$.context,pe=fe.gl;let ge=K.skyboxFbo;if(!ge){ge=K.skyboxFbo=fe.createFramebuffer(32,32,!1),K.skyboxGeometry=new Sc(fe),K.skyboxTexture=fe.gl.createTexture(),pe.bindTexture(pe.TEXTURE_CUBE_MAP,K.skyboxTexture),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_WRAP_S,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_WRAP_T,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_MIN_FILTER,pe.LINEAR),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_MAG_FILTER,pe.LINEAR);for(let be=0;be<6;++be)pe.texImage2D(pe.TEXTURE_CUBE_MAP_POSITIVE_X+be,0,pe.RGBA,32,32,0,pe.RGBA,pe.UNSIGNED_BYTE,null)}fe.bindFramebuffer.set(ge.framebuffer),fe.viewport.set([0,0,32,32]);const J=K.getCenter($,!0),ue=$.useProgram("skyboxCapture"),ve=new Float64Array(16);o.identity(ve),o.rotateY(ve,ve,.5*-Math.PI),Ks(fe,K,ue,ve,J,0),o.identity(ve),o.rotateY(ve,ve,.5*Math.PI),Ks(fe,K,ue,ve,J,1),o.identity(ve),o.rotateX(ve,ve,.5*-Math.PI),Ks(fe,K,ue,ve,J,2),o.identity(ve),o.rotateX(ve,ve,.5*Math.PI),Ks(fe,K,ue,ve,J,3),o.identity(ve),Ks(fe,K,ue,ve,J,4),o.identity(ve),o.rotateY(ve,ve,Math.PI),Ks(fe,K,ue,ve,J,5),fe.viewport.set([0,0,$.width,$.height])}(d,l),l.markSkyboxValid(d)):d.renderPass==="sky"&&function($,K,le,de,fe){const pe=$.context,ge=pe.gl,J=$.transform,ue=$.useProgram("skybox");pe.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_CUBE_MAP,K.skyboxTexture);const ve=((be,ze,Pe,Oe,Xe)=>({u_matrix:be,u_sun_direction:ze,u_cubemap:0,u_opacity:Oe,u_temporal_offset:Xe}))(J.skyboxMatrix,K.getCenter($,!1),0,de,fe);$.prepareDrawProgram(pe,ue),ue.draw(pe,ge.TRIANGLES,le,o.StencilMode.disabled,$.colorModeForRenderPass(),o.CullFaceMode.backCW,ve,"skybox",K.skyboxGeometry.vertexBuffer,K.skyboxGeometry.indexBuffer,K.skyboxGeometry.segment)}(d,l,F,T,G):I==="gradient"&&d.renderPass==="sky"&&function($,K,le,de,fe){const pe=$.context,ge=pe.gl,J=$.transform,ue=$.useProgram("skyboxGradient");K.skyboxGeometry||(K.skyboxGeometry=new Sc(pe)),pe.activeTexture.set(ge.TEXTURE0);let ve=K.colorRampTexture;ve||(ve=K.colorRampTexture=new o.Texture(pe,K.colorRamp,ge.RGBA)),ve.bind(ge.LINEAR,ge.CLAMP_TO_EDGE);const be=((ze,Pe,Oe,Xe,$e)=>({u_matrix:ze,u_color_ramp:0,u_center_direction:Pe,u_radius:o.degToRad(Oe),u_opacity:Xe,u_temporal_offset:$e}))(J.skyboxMatrix,K.getCenter($,!1),K.paint.get("sky-gradient-radius"),de,fe);$.prepareDrawProgram(pe,ue),ue.draw(pe,ge.TRIANGLES,le,o.StencilMode.disabled,$.colorModeForRenderPass(),o.CullFaceMode.backCW,be,"skyboxGradient",K.skyboxGeometry.vertexBuffer,K.skyboxGeometry.indexBuffer,K.skyboxGeometry.segment)}(d,l,F,T,G)},debug:function(d,r,l){for(let m=0;m<l.length;m++)Rf(d,r,l[m])},custom:function(d,r,l,m){const v=d.context,T=l.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&l.isLayerDraped()){if(d.renderPass==="offscreen"){const P=T.prerender;if(P){if(d.setCustomLayerDefaults(),v.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const I=d.transform.pointMerc;P.call(T,v.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(d.transform.zoom),[I.x,I.y],d.transform.pixelsPerMeterRatio)}else P.call(T,v.gl,d.transform.customLayerMatrix());v.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const I=T.renderToTile;if(I){const F=m[0].canonical,G=new o.MercatorCoordinate(F.x+m[0].wrap*(1<<F.z),F.y,F.z);v.setDepthMode(o.DepthMode.disabled),v.setStencilMode(o.StencilMode.disabled),v.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),I.call(T,v.gl,G),v.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),v.setColorMode(d.colorModeForRenderPass()),v.setStencilMode(o.StencilMode.disabled);const P=T.renderingMode==="3d"?new o.DepthMode(d.context.gl.LEQUAL,o.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,o.DepthMode.ReadOnly);if(v.setDepthMode(P),d.transform.projection.name==="globe"){const I=d.transform.pointMerc;T.render(v.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(d.transform.zoom),[I.x,I.y],d.transform.pixelsPerMeterRatio)}else T.render(v.gl,d.transform.customLayerMatrix());v.setDirty(),d.setBaseState(),v.bindFramebuffer.set(null)}}else o.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Cl{constructor(r,l,m=!1){this.context=new Ft(r,m),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,l){const m=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Au(this,r));const v=this._terrain;this.transform.elevation=m?v:null,v.update(r,this.transform,l)}_updateFog(r){const l=r.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,v]=l.getFovAdjustedRange(this.transform._fov);if(m>v)return void(this.transform.fogCullDistSq=null);const T=m+.78*(v-m);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,l){if(this.width=r*o.exported.devicePixelRatio,this.height=l*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const r=this.context,l=new o.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(o.EXTENT,0),l.emplaceBack(0,o.EXTENT),l.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(l,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const m=new o.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(o.EXTENT,0),m.emplaceBack(0,o.EXTENT),m.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=r.createVertexBuffer(m,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const v=new o.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(v,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const T=new o.StructArrayLayout4i8;T.emplaceBack(0,0,0,0),T.emplaceBack(o.EXTENT,0,o.EXTENT,0),T.emplaceBack(0,o.EXTENT,0,o.EXTENT),T.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(T,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const P=new o.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(P);const I=new o.StructArrayLayout1ui2;for(const G of[0,1,3,2,0])I.emplaceBack(G);this.debugIndexBuffer=r.createIndexBuffer(I),this.emptyTexture=new o.Texture(r,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=o.create();const F=this.context.gl;this.stencilClearMode=new o.StencilMode({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new Mc(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,l=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,l.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,mc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,l,m){if(!l||this.currentStencilSource===l.id||!r.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const F of m)if(this._tileClippingMaskIDs[F.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=l.id;const v=this.context,T=v.gl;this.nextStencilID+m.length>256&&this.clearStencil(),v.setColorMode(o.ColorMode.disabled),v.setDepthMode(o.DepthMode.disabled);const P=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of m){const F=l.getTile(I),G=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:$,tileBoundsIndexBuffer:K,tileBoundsSegments:le}=this.getTileBoundsBuffers(F);P.draw(v,T.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:T.ALWAYS,mask:0},G,255,T.KEEP,T.KEEP,T.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,mc(I.projMatrix),"$clipping",$,K,le)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,l=this.context.gl;return new o.StencilMode({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const l=this.context.gl;return new o.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){const l=this.context.gl,m=r.sort((P,I)=>I.overscaledZ-P.overscaledZ),v=m[m.length-1].overscaledZ,T=m[0].overscaledZ-v+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const P={};for(let I=0;I<T;I++)P[I+v]=new o.StencilMode({func:l.GEQUAL,mask:255},I+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=T,[P,m]}return[{[v]:o.StencilMode.disabled},m]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([r.CONSTANT_COLOR,r.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(r,l,m){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new o.DepthMode(m||this.context.gl.LEQUAL,l,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,l){this.style=r,this.options=l,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const m=this.style.order,v=this.style._sourceCaches;for(const G in v){const $=v[G];$.used&&$.prepare(this.context)}const T={},P={},I={};for(const G in v){const $=v[G];T[G]=$.getVisibleCoordinates(),P[G]=T[G].slice().reverse(),I[G]=$.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let G=0;G<m.length;G++)if(this.style._layers[m[G]].is3D()){this.opaquePassCutoff=G;break}if(this.terrain&&(this.terrain.updateTileBinding(I),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const G of m){const $=this.style._layers[G],K=r._getLayerSourceCache($);if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;const le=K?P[K.id]:void 0;($.type==="custom"||$.isSky()||le&&le.length)&&this.renderLayer(this,K,$,le)}this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon];const F=this.terrain;if(F&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&F.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const G=this.style._layers[m[this.currentLayer]],$=r._getLayerSourceCache(G);if(G.isSky())continue;const K=$?P[$.id]:void 0;this._renderTileClippingMasks(G,$,K),this.renderLayer(this,$,G,K)}if(this.style.fog&&this.transform.projection.supportsFog&&function(G,$){const K=G.context,le=K.gl,de=G.transform,fe=new o.DepthMode(le.LEQUAL,o.DepthMode.ReadOnly,[0,1]),pe=G.useProgram("globeAtmosphere",null,de.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ge=o.globeToMercatorTransition(de.zoom),J=$.properties.get("color").toArray01(),ue=$.properties.get("high-color").toArray01(),ve=$.properties.get("space-color").toArray01PremultipliedAlpha(),be=o.identity$1([]);o.rotateY$1(be,be,-o.degToRad(de._center.lng)),o.rotateX$1(be,be,o.degToRad(de._center.lat)),o.rotateZ$1(be,be,de.angle),o.rotateX$1(be,be,-de._pitch);const ze=o.fromQuat(new Float32Array(16),be),Pe=o.mapValue($.properties.get("star-intensity"),0,1,0,.25),Oe=5e-4,Xe=o.mapValue($.properties.get("horizon-blend"),0,1,Oe,.25),$e=o.globeUseCustomAntiAliasing(G,K,de)&&Xe===Oe?de.worldSize/(2*Math.PI*1.025)-1:de.globeRadius,it=G.frameCounter/1e3%1,Mt=o.length(de.globeCenterInViewSpace),et=Math.sqrt(Math.pow(Mt,2)-Math.pow($e,2)),gt=Math.acos(et/Mt),ot=((Je,_t,Lt,ft,Rt,mi,ki,oi,_i,Oi,Bi,di,xr,Er)=>({u_frustum_tl:Je,u_frustum_tr:_t,u_frustum_br:Lt,u_frustum_bl:ft,u_horizon:Rt,u_transition:mi,u_fadeout_range:ki,u_color:oi,u_high_color:_i,u_space_color:Oi,u_star_intensity:Bi,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:di,u_horizon_angle:xr,u_rotation_matrix:Er}))(de.frustumCorners.TL,de.frustumCorners.TR,de.frustumCorners.BR,de.frustumCorners.BL,de.frustumCorners.horizon,ge,Xe,J,ue,ve,Pe,it,gt,ze);G.prepareDrawProgram(K,pe);const Pt=G.atmosphereBuffer;Pt&&pe.draw(K,le.TRIANGLES,fe,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,ot,"skybox",Pt.vertexBuffer,Pt.indexBuffer,Pt.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const G=this.style._layers[m[this.currentLayer]],$=r._getLayerSourceCache(G);G.isSky()&&this.renderLayer(this,$,G,$?P[$.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const G=this.style._layers[m[this.currentLayer]],$=r._getLayerSourceCache(G);if(G.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(G)){if(G.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const K=$?(G.type==="symbol"?I:P)[$.id]:void 0;this._renderTileClippingMasks(G,$,$?T[$.id]:void 0),this.renderLayer(this,$,G,K),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let G=null;o.values(this.style._layers).forEach($=>{const K=r._getLayerSourceCache($);K&&!$.isHidden(this.transform.zoom)&&(!G||G.getSource().maxzoom<K.getSource().maxzoom)&&(G=K)}),G&&this.options.showTileBoundaries&&$a.debug(this,G,G.getVisibleCoordinates())}this.options.showPadding&&function(G){const $=G.transform.padding;Tc(G,G.transform.height-($.top||0),3,On),Tc(G,$.bottom||0,3,Pf),Al(G,$.left||0,3,If),Al(G,G.transform.width-($.right||0),3,Lf);const K=G.transform.centerPoint;(function(le,de,fe,pe){Ml(le,de-1,fe-10,2,20,pe),Ml(le,de-10,fe-1,20,2,pe)})(G,K.x,G.transform.height-K.y,Df)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(r,l,m,v){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||v&&v.length)&&(this.id=m.id,this.gpuTimingStart(m),(!r.transform.projection.unsupportedLayers||!r.transform.projection.unsupportedLayers.includes(m.type)||r.terrain&&m.type==="custom")&&$a[m.type](r,l,m,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let m=this.gpuTimers[r.id];m||(m=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),m.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,l=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),r.beginQueryEXT(r.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const l={};for(const m in r){const v=r[m],T=this.context.extTimerQuery,P=T.getQueryObjectEXT(v.query,T.QUERY_RESULT_EXT)/1e6;T.deleteQueryEXT(v.query),l[m]=P}return l}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery;let m=0;for(const v of r)m+=l.getQueryObjectEXT(v,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(v);return m}translatePosMatrix(r,l,m,v,T){if(!m[0]&&!m[1])return r;const P=T?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(P){const G=Math.sin(P),$=Math.cos(P);m=[m[0]*$-m[1]*G,m[0]*G+m[1]*$]}const I=[T?m[0]:fr(l,m[0],this.transform.zoom),T?m[1]:fr(l,m[1],this.transform.zoom),0],F=new Float32Array(16);return o.translate(F,r,I),F}saveTileTexture(r){const l=this._tileTextures[r.size[0]];l?l.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const l=this._tileTextures[r];return l&&l.length>0?l.pop():null}isPatternMissing(r){return r===null||r!==void 0&&!this.imageManager.getPattern(r.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,l=this.terrain&&this.terrain.exaggeration()===0,m=this.style&&this.style.fog,v=[];return this.terrainRenderModeElevated()&&v.push("TERRAIN"),this.transform.projection.name==="globe"&&v.push("GLOBE"),l&&v.push("ZERO_EXAGGERATION"),m&&!r&&m.getOpacity(this.transform.pitch)!==0&&v.push("FOG"),r&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}useProgram(r,l,m){this.cache=this.cache||{};const v=m||[],T=this.currentGlobalDefines().concat(v),P=nr.cacheKey(nh[r],r,T,l);return this.cache[P]||(this.cache[P]=new nr(this.context,r,nh[r],l,Ru[r],T)),this.cache[P]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,l,m){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const T=v.getOpacity(this.transform.pitch),P=((I,F,G,$,K,le,de,fe,pe,ge,J)=>{const ue=I.transform,ve=F.properties.get("color").toArray01();ve[3]=$;const be=I.frameCounter/1e3%1;return{u_fog_matrix:G?ue.calculateFogTileMatrix(G):I.identityMat,u_fog_range:F.getFovAdjustedRange(ue._fov),u_fog_color:ve,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_temporal_offset:be,u_frustum_tl:K,u_frustum_tr:le,u_frustum_br:de,u_frustum_bl:fe,u_globe_pos:pe,u_globe_radius:ge,u_viewport:J,u_globe_transition:o.globeToMercatorTransition(ue.zoom),u_is_globe:+(ue.projection.name==="globe")}})(this,v,m,T,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);l.setFogUniformValues(r,P)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,l=r.createTexture();return r.bindTexture(r.TEXTURE_2D,l),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,l=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const v of m)l[v.key]=r[v.key]||new o.Tile(v,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class Mn{constructor(r=0,l=0,m=0,v=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(m)||m<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=m,this.right=v}interpolate(r,l,m){return l.top!=null&&r.top!=null&&(this.top=o.number(r.top,l.top,m)),l.bottom!=null&&r.bottom!=null&&(this.bottom=o.number(r.bottom,l.bottom,m)),l.left!=null&&r.left!=null&&(this.left=o.number(r.left,l.left,m)),l.right!=null&&r.right!=null&&(this.right=o.number(r.right,l.right,m)),this}getCenter(r,l){const m=o.clamp((this.left+r-this.right)/2,0,r),v=o.clamp((this.top+l-this.bottom)/2,0,l);return new o.Point(m,v)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Mn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ko(d,r){const l=o.getColumn(d,3);o.fromQuat(d,r),o.setColumn(d,3,l)}function ur(d,r){const l=o.identity$1([]);return o.rotateZ$1(l,l,-r),o.rotateX$1(l,l,-d),l}function kl(d,r){const l=[d[0],d[1],0],m=[r[0],r[1],0];if(o.length(l)>=1e-15){const P=o.normalize([],l);o.scale$2(m,P,o.dot(m,P)),r[0]=m[0],r[1]=m[1]}const v=o.cross([],r,d);if(o.len(v)<1e-15)return null;const T=Math.atan2(-v[1],v[0]);return ur(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),T)}class rp{constructor(r,l){this.position=r,this.orientation=l}get position(){return this._position}set position(r){if(r){const l=r instanceof o.MercatorCoordinate?r:new o.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(l.x=o.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(r,l){if(this.orientation=null,!this.position)return;const m=this.position,v=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(r)):0,T=o.MercatorCoordinate.fromLngLat(r,v),P=[T.x-m.x,T.y-m.y,T.z-m.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=kl(P,l)}setPitchBearing(r,l){this.orientation=ur(o.degToRad(r),o.degToRad(-l))}}class Pl{constructor(r,l){this._transform=o.identity([]),this.orientation=l,this.position=r}get mercatorPosition(){const r=this.position;return new o.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=o.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var l;r&&o.setColumn(this._transform,3,[(l=r)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||o.identity$1([]),r&&Ko(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,l){this._orientation=ur(r,l),Ko(this._transform,this._orientation)}forward(){const r=o.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=o.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=o.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,l){const m=new Float64Array(16);return o.invert(m,this.getWorldToCamera(r,l)),m}getWorldToCameraPosition(r,l,m){const v=this.position;o.scale$2(v,v,-r);const T=new Float64Array(16);return o.fromScaling(T,[m,m,m]),o.translate(T,T,v),T[10]*=l,T}getWorldToCamera(r,l){const m=new Float64Array(16),v=new Float64Array(4),T=this.position;return o.conjugate(v,this._orientation),o.scale$2(T,T,-r),o.fromQuat(m,v),o.translate(m,m,T),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=l,m[9]*=l,m[10]*=l,m[11]*=l,m}getCameraToClipPerspective(r,l,m,v){const T=new Float64Array(16);return o.perspective(T,r,l,m,v),T}getDistanceToElevation(r,l=!1){const m=r===0?0:o.mercatorZfromAltitude(r,l?o.latFromMercatorY(this.position[1]):this.position[1]),v=this.forward();return(m-this.position[2])/v[2]}clone(){return new Pl([...this.position],[...this.orientation])}}function Il(d,r){const l=Cc(d.projection,d.zoom,d.width,d.height),m=function(T,P,I,F,G){const $=new o.LngLat(I.lng-180*Jo,I.lat),K=new o.LngLat(I.lng+180*Jo,I.lat),le=T.project($.lng,$.lat),de=T.project(K.lng,K.lat),fe=-Math.atan2(de.y-le.y,de.x-le.x),pe=o.MercatorCoordinate.fromLngLat(I);pe.y=o.clamp(pe.y,-1+Jo,1-Jo);const ge=pe.toLngLat(),J=T.project(ge.lng,ge.lat),ue=o.MercatorCoordinate.fromLngLat(ge);ue.x+=Jo;const ve=ue.toLngLat(),be=T.project(ve.lng,ve.lat),ze=Js(be.x-J.x,be.y-J.y,fe),Pe=o.MercatorCoordinate.fromLngLat(ge);Pe.y+=Jo;const Oe=Pe.toLngLat(),Xe=T.project(Oe.lng,Oe.lat),$e=Js(Xe.x-J.x,Xe.y-J.y,fe),it=Math.abs(ze.x)/Math.abs($e.y),Mt=o.identity([]);o.rotateZ(Mt,Mt,-fe*(1-(G?0:F)));const et=o.identity([]);return o.scale(et,et,[1,1-(1-it)*F,1]),et[4]=-$e.x/$e.y*F,o.rotateZ(et,et,fe),o.multiply(et,Mt,et),et}(d.projection,0,d.center,l,r),v=sp(d);return o.scale(m,m,[v,v,1]),m}function sp(d){const r=d.projection,l=Cc(d.projection,d.zoom,d.width,d.height),m=vh(r,d.center),v=vh(r,o.LngLat.convert(r.center));return Math.pow(2,m*l+(1-l)*v)}function Cc(d,r,l,m,v=1/0){const T=d.range;if(!T)return 0;const P=Math.min(v,Math.max(l,m)),I=Math.log(P/1024)/Math.LN2;return o.smoothstep(T[0]+I,T[1]+I,r)}const Jo=1/4e4;function vh(d,r){const l=o.clamp(r.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),m=new o.LngLat(r.lng-180*Jo,l),v=new o.LngLat(r.lng+180*Jo,l),T=d.project(m.lng,l),P=d.project(v.lng,l),I=o.MercatorCoordinate.fromLngLat(m),F=o.MercatorCoordinate.fromLngLat(v),G=P.x-T.x,$=P.y-T.y,K=F.x-I.x,le=F.y-I.y,de=Math.sqrt((K*K+le*le)/(G*G+$*$));return Math.log(de)/Math.LN2}function Js(d,r,l){const m=Math.cos(l),v=Math.sin(l);return{x:d*m-r*v,y:d*v+r*m}}class yr{constructor(r,l,m,v,T,P,I){this.tileSize=512,this._renderWorldCopies=T===void 0||T,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=m??0,this._maxPitch=v??60,this.setProjection(P),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Mn,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Pl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new yr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r,l=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(r||m)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const m=!X(l,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const l=r!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.Point(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const l=-r*Math.PI/180;var m;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(m=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),function(v,T,P){var I=T[0],F=T[1],G=T[2],$=T[3],K=Math.sin(P),le=Math.cos(P);v[0]=I*le+G*K,v[1]=F*le+$*K,v[2]=I*-K+G*le,v[3]=F*-K+$*le}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const l=o.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=o.degToRad(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let v=0,T=0;for(let P=0;P<l.length;P++){const I=new o.Point(l[P][0]*this.width,m+l[P][1]*(this.height-m)),F=r.pointCoordinate(I);if(!F)continue;const G=1/Math.hypot(F[0]-this._camera.position[0],F[1]-this._camera.position[1]);v+=F[3]*G,T+=G}return T===0?NaN:v/T}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*l,v=this._mercatorZfromZoom(r),T=this._mercatorZfromZoom(this._maxZoom),P=Math.max(v-m,T);this._setZoom(this._zoomFromMercatorZ(P))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let m;m=r.z<this._camera.position[2]?[l.x,l.y,l.z]:[r.x,r.y,r.z];const v=o.length(o.sub([],this._camera.position,m));return o.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let l=!1;if(r.orientation&&!o.exactEquals(r.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(r.orientation)),r.position){const m=[r.position.x,r.position.y,r.position.z];o.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,l=new rp;return l.position=new o.MercatorCoordinate(r[0],r[1],r[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(r){if(!o.length$1(r))return!1;o.normalize$1(r,r);const l=o.transformQuat([],[0,0,-1],r),m=o.transformQuat([],[0,-1,0],r);if(m[2]<0)return!1;const v=kl(l,m);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(r){const l=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;r[2]=o.clamp(r[2],v/m,v/l),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,m){this._unmodified=!1,this._edgeInsets.interpolate(r,l,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){const l=[new o.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const m=this.pointCoordinate(new o.Point(0,0)),v=this.pointCoordinate(new o.Point(this.width,0)),T=this.pointCoordinate(new o.Point(this.width,this.height)),P=this.pointCoordinate(new o.Point(0,this.height)),I=Math.floor(Math.min(m.x,v.x,T.x,P.x)),F=Math.floor(Math.max(m.x,v.x,T.x,P.x)),G=1;for(let $=I-G;$<=F+G;$++)$!==0&&l.push(new o.UnwrappedTileID($,r))}return l}coveringTiles(r){let l=this.coveringZoomLevel(r);const m=l,v=this.elevation&&!r.isTerrainDEM,T=this.projection.name==="mercator";if(r.minzoom!==void 0&&l<r.minzoom)return[];r.maxzoom!==void 0&&l>r.maxzoom&&(l=r.maxzoom);const P=this.locationCoordinate(this.center),I=this.center.lat,F=1<<l,G=[F*P.x,F*P.y,0],$=this.projection.name==="globe",K=!$,le=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,K),de=$?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),fe=F*o.mercatorZfromAltitude(1,this.center.lat),pe=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),ge=[F*de.x,F*de.y,pe*(K?1:fe)],J=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),ue=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,ve=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,be=r.isTerrainDEM?-ve:this._elevation?this._elevation.getMinElevationBelowMSL():0,ze=this.projection.isReprojectedInTileSpace?sp(this):1,Pe=Je=>{const Lt=new o.MercatorCoordinate(Je.x+25e-6,Je.y,Je.z),ft=new o.MercatorCoordinate(Je.x,Je.y+25e-6,Je.z),Rt=Je.toLngLat(),mi=Lt.toLngLat(),ki=ft.toLngLat(),oi=this.locationCoordinate(Rt),_i=this.locationCoordinate(mi),Oi=this.locationCoordinate(ki),Bi=Math.hypot(_i.x-oi.x,_i.y-oi.y),di=Math.hypot(Oi.x-oi.x,Oi.y-oi.y);return Math.sqrt(Bi*di)*ze/25e-6},Oe=Je=>{const _t=ve,Lt=be;return{aabb:o.tileAABB(this,F,0,0,0,Je,Lt,_t,this.projection),zoom:0,x:0,y:0,minZ:Lt,maxZ:_t,wrap:Je,fullyVisible:!1}},Xe=[];let $e=[];const it=l,Mt=r.reparseOverscaled?m:l,et=Je=>Je*Je,gt=et((pe-this._centerAltitude)*fe),ot=Je=>{if(!this._elevation||!Je.tileID||!T)return;const _t=this._elevation.getMinMaxForTile(Je.tileID),Lt=Je.aabb;_t?(Lt.min[2]=_t.min,Lt.max[2]=_t.max,Lt.center[2]=(Lt.min[2]+Lt.max[2])/2):(Je.shouldSplit=Pt(Je),Je.shouldSplit||(Lt.min[2]=Lt.max[2]=Lt.center[2]=this._centerAltitude))},Pt=Je=>{if(Je.zoom<ue)return!0;if(Je.zoom===it)return!1;if(Je.shouldSplit!=null)return Je.shouldSplit;const _t=Je.aabb.distanceX(ge),Lt=Je.aabb.distanceY(ge);let ft=gt,Rt=1;if($){ft=et(Je.aabb.distanceZ(ge));const oi=Math.pow(2,Je.zoom),_i=o.latFromMercatorY((Je.y+1)/oi),Oi=o.latFromMercatorY(Je.y/oi),Bi=Math.min(Math.max(I,_i),Oi),di=o.circumferenceAtLatitude(Bi)/o.circumferenceAtLatitude(I);if(Rt=Bi===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,di/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&Je.zoom===it-1&&di>=.9)return!0}else if(v&&(ft=et(Je.aabb.distanceZ(ge)*fe)),this.projection.isReprojectedInTileSpace&&m<=5){const oi=Math.pow(2,Je.zoom),_i=Pe(new o.MercatorCoordinate((Je.x+.5)/oi,(Je.y+.5)/oi));Rt=_i>.85?1:_i}const mi=_t*_t+Lt*Lt+ft,ki=et((1<<it-Je.zoom)*J*Rt*((oi,_i)=>{if(_i*et(.707)<oi)return 1;const Oi=Math.sqrt(_i/oi);return Oi/(1.4144271570014144+(Math.pow(1.1,Oi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ft,gt),mi));return mi<ki};if(this.renderWorldCopies)for(let Je=1;Je<=3;Je++)Xe.push(Oe(-Je)),Xe.push(Oe(Je));for(Xe.push(Oe(0));Xe.length>0;){const Je=Xe.pop(),_t=Je.x,Lt=Je.y;let ft=Je.fullyVisible;if(!ft){const Rt=Je.aabb.intersects(le);if(Rt===0)continue;ft=Rt===2}if(Je.zoom!==it&&Pt(Je))for(let Rt=0;Rt<4;Rt++){const mi=(_t<<1)+Rt%2,ki=(Lt<<1)+(Rt>>1),oi={aabb:T?Je.aabb.quadrant(Rt):o.tileAABB(this,F,Je.zoom+1,mi,ki,Je.wrap,Je.minZ,Je.maxZ,this.projection),zoom:Je.zoom+1,x:mi,y:ki,wrap:Je.wrap,fullyVisible:ft,tileID:void 0,shouldSplit:void 0,minZ:Je.minZ,maxZ:Je.maxZ};v&&!$&&(oi.tileID=new o.OverscaledTileID(Je.zoom+1===it?Mt:Je.zoom+1,Je.wrap,Je.zoom+1,mi,ki),ot(oi)),Xe.push(oi)}else{const Rt=Je.zoom===it?Mt:Je.zoom;if(r.minzoom&&r.minzoom>Rt)continue;const mi=G[0]-(.5+_t+(Je.wrap<<Je.zoom))*(1<<l-Je.zoom),ki=G[1]-.5-Lt,oi=Je.tileID?Je.tileID:new o.OverscaledTileID(Rt,Je.wrap,Je.zoom,_t,Lt);$e.push({tileID:oi,distanceSq:mi*mi+ki*ki})}}if(this.fogCullDistSq){const Je=this.fogCullDistSq,_t=this.horizonLineFromTop();$e=$e.filter(Lt=>{const ft=[0,0,0,1],Rt=[o.EXTENT,o.EXTENT,0,1],mi=this.calculateFogTileMatrix(Lt.tileID.toUnwrapped());o.transformMat4$1(ft,ft,mi),o.transformMat4$1(Rt,Rt,mi);const ki=o.getAABBPointSquareDist(ft,Rt);if(ki===0)return!0;let oi=!1;const _i=this._elevation;if(_i&&ki>Je&&_t!==0){const Oi=this.calculateProjMatrix(Lt.tileID.toUnwrapped());let Bi;r.isTerrainDEM||(Bi=_i.getMinMaxForTile(Lt.tileID)),Bi||(Bi={min:be,max:ve});const di=o.furthestTileCorner(this.rotation),xr=[di[0]*o.EXTENT,di[1]*o.EXTENT,Bi.max];o.transformMat4(xr,xr,Oi),oi=(1-xr[1])*this.height*.5<_t}return ki<Je||oi})}return $e.sort((Je,_t)=>Je.distanceSq-_t.distanceSq).map(Je=>Je.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const l=o.clamp(r.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),m=this.projection.project(r.lng,l);return new o.Point(m.x*this.worldSize,m.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,l){let m,v;const T=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;m=(l.x-T.x)/I,v=(l.y-T.y)/I}else{const I=this.pointCoordinate(l),F=this.pointCoordinate(T);m=I.x-F.x,v=I.y-F.y}const P=this.locationCoordinate(r);this.setLocation(new o.MercatorCoordinate(P.x-m,P.y-v))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,l){const m=l?o.mercatorZfromAltitude(l,r.lat):void 0,v=this.projection.project(r.lng,r.lat);return new o.MercatorCoordinate(v.x,v.y,m)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,l){const m=l??this._centerAltitude,v=[r.x,r.y,0,1],T=[r.x,r.y,1,1];o.transformMat4$1(v,v,this.pixelMatrixInverse),o.transformMat4$1(T,T,this.pixelMatrixInverse);const P=T[3];o.scale$1(v,v,1/v[3]),o.scale$1(T,T,1/P);const I=v[2],F=T[2];return{p0:v,p1:T,t:I===F?0:(m-I)/(F-I)}}screenPointToMercatorRay(r){const l=[r.x,r.y,0,1],m=[r.x,r.y,1,1];return o.transformMat4$1(l,l,this.pixelMatrixInverse),o.transformMat4$1(m,m,this.pixelMatrixInverse),o.scale$1(l,l,1/l[3]),o.scale$1(m,m,1/m[3]),l[2]=o.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,m[2]=o.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,o.scale$1(l,l,1/this.worldSize),o.scale$1(m,m,1/this.worldSize),new o.Ray([l[0],l[1],l[2]],o.normalize([],o.sub([],m,l)))}rayIntersectionCoordinate(r){const{p0:l,p1:m,t:v}=r,T=o.mercatorZfromAltitude(l[2],this._center.lat),P=o.mercatorZfromAltitude(m[2],this._center.lat);return new o.MercatorCoordinate(o.number(l[0],m[0],v)/this.worldSize,o.number(l[1],m[1],v)/this.worldSize,o.number(T,P,v))}pointCoordinate(r,l=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,l)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let l=this.projection.pointCoordinate3D(this,r.x,r.y);if(l)return new o.MercatorCoordinate(l[0],l[1],l[2]);let m=0,v=this.horizonLineFromTop();if(r.y>v)return this.pointCoordinate(r);const T=.02*v,P=r.clone();for(let I=0;I<10&&v-m>T;I++){P.y=o.number(m,v,.66);const F=this.projection.pointCoordinate3D(this,P.x,P.y);F?(v=P.y,l=F):m=P.y}return l?new o.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(r);const l=this.pointCoordinate(r);return l.y>=0&&l.y<=1}_coordinatePoint(r,l){const m=l&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,v=[r.x*this.worldSize,r.y*this.worldSize,m+r.toAltitude(),1];return o.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new o.Point(v[0]/v[3],v[1]/v[3]):new o.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:l}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,T=this.pointLocation3D(new o.Point(l,r)),P=this.pointLocation3D(new o.Point(v,r)),I=this.pointLocation3D(new o.Point(v,m)),F=this.pointLocation3D(new o.Point(l,m));let G=Math.min(T.lng,P.lng,I.lng,F.lng),$=Math.max(T.lng,P.lng,I.lng,F.lng),K=Math.min(T.lat,P.lat,I.lat,F.lat),le=Math.max(T.lat,P.lat,I.lat,F.lat);const de=Math.pow(2,-this.zoom)/16*270,fe=this.projection.name==="globe"?1:4,pe=(ge,J,ue,ve,be)=>{const ze=(ge+ue)/2,Pe=(J+ve)/2,Oe=new o.Point(ze,Pe),{lng:Xe,lat:$e}=this.pointLocation3D(Oe),it=Math.max(0,G-Xe,K-$e,Xe-$,$e-le);G=Math.min(G,Xe),$=Math.max($,Xe),K=Math.min(K,$e),le=Math.max(le,$e),(be<fe||it>de)&&(pe(ge,J,ze,Pe,be+1),pe(ze,Pe,ue,ve,be+1))};if(pe(l,r,v,r,1),pe(v,r,v,m,1),pe(v,m,l,m,1),pe(l,m,l,r,1),this.projection.name==="globe"){const[ge,J]=o.polesInViewport(this);ge?(le=90,$=180,G=-180):J&&(K=-90,$=180,G=-180)}return new o.LngLatBounds(new o.LngLat(G,K),new o.LngLat($,le))}_getBoundsRectangular(r,l){const{top:m,left:v}=this._edgeInsets,T=this.height-this._edgeInsets.bottom,P=this.width-this._edgeInsets.right,I=new o.Point(v,m),F=new o.Point(P,m),G=new o.Point(P,T),$=new o.Point(v,T);let K=this.pointCoordinate(I,r),le=this.pointCoordinate(F,r);const de=this.pointCoordinate(G,l),fe=this.pointCoordinate($,l),pe=(ge,J)=>(J.y-ge.y)/(J.x-ge.x);return K.y>1&&le.y>=0?K=new o.MercatorCoordinate((1-fe.y)/pe(fe,K)+fe.x,1):K.y<0&&le.y<=1&&(K=new o.MercatorCoordinate(-fe.y/pe(fe,K)+fe.x,0)),le.y>1&&K.y>=0?le=new o.MercatorCoordinate((1-de.y)/pe(de,le)+de.x,1):le.y<0&&K.y<=1&&(le=new o.MercatorCoordinate(-de.y/pe(de,le)+de.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(K)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(fe)).extend(this.coordinateLocation(de))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=r.visibleDemTiles.reduce((m,v)=>{if(v.dem){const T=v.dem.tree;m.min=Math.min(m.min,T.minimums[0]),m.max=Math.max(m.max,T.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*r.exaggeration(),l.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-l*(1-this._horizonShift);return r?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,l){return this.projection.createTileMatrix(this,l,r)}calculateDistanceTileData(r){const l=r.key,m=this._distanceTileDataCache;if(m[l])return m[l];const v=r.canonical,T=1/this.height,P=this.cameraWorldSize,I=P/this.zoomScale(v.z),F=(v.x+Math.pow(2,v.z)*r.wrap)*I,G=v.y*I,$=this.point;$.x*=P/this.worldSize,$.y*=P/this.worldSize;const K=this.angle,le=Math.sin(-K),de=-Math.cos(-K);return m[l]={bearing:[le,de],center:[($.x-F)*T,($.y-G)*T],scale:I/o.EXTENT*T},m[l]}calculateFogTileMatrix(r){const l=r.key,m=this._fogTileMatrixCache;if(m[l])return m[l];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return o.multiply(v,this.worldToFogMatrix,v),m[l]=new Float32Array(v),m[l]}calculateProjMatrix(r,l=!1){const m=r.key,v=l?this._alignedProjMatrixCache:this._projMatrixCache;if(v[m])return v[m];const T=this.calculatePosMatrix(r,this.worldSize);return o.multiply(T,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,T),v[m]=new Float32Array(T),v[m]}calculatePixelsToTileUnitsMatrix(r){const l=r.tileID.key,m=this._pixelsToTileUnitsCache;if(m[l])return m[l];const v=function(T,P){const{scale:I}=T.tileTransform,F=I*o.EXTENT/(T.tileSize*Math.pow(2,P.zoom-T.tileID.overscaledZ+T.tileID.canonical.z));return G=new Float32Array(4),le=($=P.inverseAdjustmentMatrix)[1],de=$[2],fe=$[3],ge=(K=[F,F])[1],G[0]=$[0]*(pe=K[0]),G[1]=le*pe,G[2]=de*ge,G[3]=fe*ge,G;var G,$,K,le,de,fe,pe,ge}(r,this);return m[l]=v,m[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,l=o.fromScaling([],[r,r,r]);return o.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const l=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(l),v=this._camera.forward(),T=o.mercatorZfromAltitude(1,this._center.lat);m[2]/=T,v[2]/=T,o.normalize(v,v);const P=r.raycast(m,v,r.exaggeration());if(P){const I=o.scaleAndAdd([],m,v,P),F=new o.MercatorCoordinate(I[0],I[1],o.mercatorZfromAltitude(I[2],o.latFromMercatorY(I[1]))),G=(F.z+o.length([F.x-m[0],F.y-m[1],F.z-m[2]*T]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(G),this._centerAltitude=F.toAltitude(),this._center=this.coordinateLocation(F),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const l=this._elevation,m=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(m),T=l.getAtPointOrZero(new o.MercatorCoordinate(...v)),P=this.pixelsPerMeter/this.worldSize*T,I=this._minimumHeightOverTerrain(),F=v[2]-P;if(F<=I)if(F<0||r){const G=this.locationCoordinate(this._center,this._centerAltitude),$=[v[0],v[1],G.z-v[2]],K=o.length($);$[2]-=(I-F)/this._pixelsPerMercatorPixel;const le=o.length($);if(le===0)return;o.scale$2($,$,K/le*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],G.z*this._pixelsPerMercatorPixel-$[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const le=this.center;return le.lat=o.clamp(le.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(le.lng=o.clamp(le.lng,this.minLng,this.maxLng)),this.center=le,void(this._constraining=!1)}const l=this._unmodified,{x:m,y:v}=this.point;let T=0,P=m,I=v;const F=this.width/2,G=this.height/2,$=this.worldMinY*this.scale,K=this.worldMaxY*this.scale;if(v-G<$&&(I=$+G),v+G>K&&(I=K-G),K-$<this.height&&(T=Math.max(T,this.height/(K-$)),I=(K+$)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const le=this.worldMinX*this.scale,de=this.worldMaxX*this.scale,fe=this.worldSize/2-(le+de)/2;P=(m+fe+this.worldSize)%this.worldSize-fe,P-F<le&&(P=le+F),P+F>de&&(P=de-F),de-le<this.width&&(T=Math.max(T,this.width/(de-le)),P=(de+le)/2)}P===m&&I===v||(this.center=this.unproject(new o.Point(P,I))),T&&(this.zoom+=this.scaleZoom(T)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,l=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const m=Cc(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this.projection.zAxisUnit==="meters"?l:1,T=this._camera.getWorldToCamera(this.worldSize,v),P=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);P[8]=2*-r.x/this.width,P[9]=2*r.y/this.height;let I=o.mul([],P,T);if(this.projection.isReprojectedInTileSpace){const Pe=this.locationCoordinate(this.center),Oe=o.identity([]);o.translate(Oe,Oe,[Pe.x*this.worldSize,Pe.y*this.worldSize,0]),o.multiply(Oe,Oe,Il(this)),o.translate(Oe,Oe,[-Pe.x*this.worldSize,-Pe.y*this.worldSize,0]),o.multiply(I,I,Oe),this.inverseAdjustmentMatrix=function(Xe){const $e=Il(Xe,!0);return Ge([],[$e[0],$e[1],$e[4],$e[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],I,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=I,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const F=o.invert([],P);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height);const G=new Float32Array(16);o.identity(G),o.scale(G,G,[1,-1,1]),o.rotateX(G,G,this._pitch),o.rotateZ(G,G,this.angle);const $=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),K=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;$[8]=2*-r.x/this.width,$[9]=2*(r.y+K)/this.height,this.skyboxMatrix=o.multiply(G,$,G);const le=this.point,de=le.x,fe=le.y,pe=this.width%2/2,ge=this.height%2/2,J=Math.cos(this.angle),ue=Math.sin(this.angle),ve=de-Math.round(de)+J*pe+ue*ge,be=fe-Math.round(fe)+J*ge+ue*pe,ze=new Float64Array(I);if(o.translate(ze,ze,[ve>.5?ve-1:ve,be>.5?be-1:be,0]),this.alignedProjMatrix=ze,I=o.create(),o.scale(I,I,[this.width/2,-this.height/2,1]),o.translate(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=o.create(),o.scale(I,I,[1,-1,1]),o.translate(I,I,[-1,-1,0]),o.scale(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},I=o.invert(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=I,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const Pe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(Pe,Pe,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=I;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,m=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,T=[r,r,l];o.scale$2(T,T,v),o.scale$2(m,m,-1),o.multiply$2(m,m,T);const P=o.create();o.translate(P,P,m),o.scale(P,P,T),this.mercatorFogMatrix=P,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,l,v)}_computeCameraPosition(r){const l=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),v=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-r/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-m[0]*T,v.y/this.worldSize-m[1]*T,r/this.worldSize*this._centerAltitude-m[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],v=r[2];let T=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(T=Math.min((l-m)/v,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,r,T),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,l=this._camera.forward(),{pitch:m,bearing:v}=this._camera.getPitchBearing(),T=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,P=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),I=Math.max((r[2]-T)/Math.cos(m),P),F=this._zoomFromMercatorZ(I);o.scaleAndAdd(r,r,l,I),this._pitch=o.clamp(m,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(v,-Math.PI,Math.PI),this._setZoom(o.clamp(F,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let l=0,m=o.GLOBE_ZOOM_THRESHOLD_MAX,v=0,T=1/0;for(;m-l>1e-6&&m>l;){const P=l+.5*(m-l),I=this.tileSize*Math.pow(2,P),F=this.getCameraToCenterDistance(this.projection,P,I),G=this.scaleZoom(F/(r*this.tileSize)),$=Math.abs(P-G);$<T&&(T=$,v=P),P<G?l=P:m=P}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,l){const m=Math.min(r.x,l.x),v=Math.max(r.x,l.x),T=Math.min(r.y,l.y),P=Math.max(r.y,l.y);if(T<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new o.Point(m,T),new o.Point(v,P),new o.Point(m,P),new o.Point(v,T)],F=this.renderWorldCopies?-3:0,G=this.renderWorldCopies?4:1;for(const $ of I){const K=this.pointRayIntersection($);if(K.t<0)return!0;const le=this.rayIntersectionCoordinate(K);if(le.x<F||le.y<0||le.x>G||le.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.Point(0,0),new o.Point(this.width,this.height))}zoomDeltaToMovement(r,l){const m=o.length(o.sub([],this._camera.position,r)),v=this._zoomFromMercatorZ(m)+l;return m-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([l,m,v],T){const P=[l,m,v,1];o.transformMat4$1(P,P,T);const I=P[3]=Math.max(P[3],1e-6);return P[0]/=I,P[1]/=I,P[2]/=I,P}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.Point(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,r))}}getCameraToCenterDistance(r,l=this.zoom,m=this.worldSize){const v=Cc(r,l,this.width,this.height,1024),T=r.pixelSpaceConversion(this.center.lat,m,v);return .5/Math.tan(.5*this._fov)*this.height*T}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.multiply(r,r,this.globeMatrix),r}}function Ll(d,r){let l=!1,m=null;const v=()=>{m=null,l&&(d(),m=setTimeout(v,r),l=!1)};return()=>(l=!0,m||v(),m)}class bh{constructor(r){this._hashName=r&&encodeURIComponent(r),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ll(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,o.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const l=Wa(r);if(this._hashName){const m=this._hashName;let v=!1;const T=o.window.location.hash.slice(1).split("&").map(P=>{const I=P.split("=")[0];return I===m?(v=!0,`${I}=${l}`):P}).filter(P=>P);return v||T.push(`${m}=${l}`),`#${T.join("&")}`}return`#${l}`}_getCurrentHash(){const r=o.window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(l=m)}),(l&&l[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(m=>isNaN(m))){const m=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(l[3]||0):r.getBearing();return r.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:m,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,r)}}function Wa(d,r){const l=d.getCenter(),m=Math.round(100*d.getZoom())/100,v=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,v),P=Math.round(l.lng*T)/T,I=Math.round(l.lat*T)/T,F=d.getBearing(),G=d.getPitch();let $=r?`/${P}/${I}/${m}`:`${m}/${I}/${P}`;return(F||G)&&($+="/"+Math.round(10*F)/10),G&&($+=`/${Math.round(G)}`),$}const ga={linearity:.3,easing:o.bezier(0,0,.3,1)},Br=o.extend({deceleration:2500,maxSpeed:1400},ga),kc=o.extend({deceleration:20,maxSpeed:1400},ga),ti=o.extend({deceleration:1e3,maxSpeed:360},ga),Bn=o.extend({deceleration:1e3,maxSpeed:90},ga);class Mi{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,l=o.exported.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)l.zoom+=T.zoomDelta||0,l.bearing+=T.bearingDelta||0,l.pitch+=T.pitchDelta||0,T.panDelta&&l.pan._add(T.panDelta),T.around&&(l.around=T.around),T.pinchAround&&(l.pinchAround=T.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(l.pan.mag()){const T=_a(l.pan.mag(),m,o.extend({},Br,r||{}));v.offset=l.pan.mult(T.amount/l.pan.mag()),v.center=this._map.transform.center,Dl(v,T)}if(l.zoom){const T=_a(l.zoom,m,kc);v.zoom=this._map.transform.zoom+T.amount,Dl(v,T)}if(l.bearing){const T=_a(l.bearing,m,ti);v.bearing=this._map.transform.bearing+o.clamp(T.amount,-179,179),Dl(v,T)}if(l.pitch){const T=_a(l.pitch,m,Bn);v.pitch=this._map.transform.pitch+T.amount,Dl(v,T)}if(v.zoom||v.bearing){const T=l.pinchAround===void 0?l.around:l.pinchAround;v.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function Dl(d,r){(!d.duration||d.duration<r.duration)&&(d.duration=r.duration,d.easing=r.easing)}function _a(d,r,l){const{maxSpeed:m,linearity:v,deceleration:T}=l,P=o.clamp(d*v/(r/1e3),-m,m),I=Math.abs(P)/(T*v);return{easing:l.easing,duration:1e3*I,amount:P*(I/2)}}class Vs extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,m,v={}){const T=lt(l.getCanvasContainer(),m),P=l.unproject(T);super(r,o.extend({point:T,lngLat:P,originalEvent:m},v)),this._defaultPrevented=!1,this.target=l}}class ya extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,m){const v=r==="touchend"?m.changedTouches:m.touches,T=kt(l.getCanvasContainer(),v),P=T.map(F=>l.unproject(F)),I=T.reduce((F,G,$,K)=>F.add(G.div(K.length)),new o.Point(0,0));super(r,{points:T,point:I,lngLats:P,lngLat:l.unproject(I),originalEvent:m}),this._defaultPrevented=!1}}class qi extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,m){super(r,{originalEvent:m}),this._defaultPrevented=!1}}class Rl{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new qi(r.type,this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new Vs(r.type,this._map,r))}mouseup(r){this._map.fire(new Vs(r.type,this._map,r))}preclick(r){const l=o.extend({},r);l.type="preclick",this._map.fire(new Vs(l.type,this._map,l))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Vs(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Vs(r.type,this._map,r))}mouseover(r){this._map.fire(new Vs(r.type,this._map,r))}mouseout(r){this._map.fire(new Vs(r.type,this._map,r))}touchstart(r){return this._firePreventable(new ya(r.type,this._map,r))}touchmove(r){this._map.fire(new ya(r.type,this._map,r))}touchend(r){this._map.fire(new ya(r.type,this._map,r))}touchcancel(r){this._map.fire(new ya(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wh{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Vs(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Vs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Vs(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class np{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&r.button===0&&(Ze(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;const m=l,v=this._startPos,T=this._lastPos;if(!v||!T||T.equals(m)||!this._box&&m.dist(v)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=Te("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const P=Math.min(v.x,m.x),I=Math.max(v.x,m.x),F=Math.min(v.y,m.y),G=Math.max(v.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${P}px,${F}px)`,this._box.style.width=I-P+"px",this._box.style.height=G-F+"px")})}mouseupWindow(r,l){if(!this._active)return;const m=this._startPos,v=l;if(m&&r.button===0){if(this.reset(),He(),m.x!==v.x||m.y!==v.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:T=>T.fitScreenCoordinates(m,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ae(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new o.Event(r,{originalEvent:l}))}}function Th(d,r){const l={};for(let m=0;m<d.length;m++)l[d[m].identifier]=r[m];return l}class Ha{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,l,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),m.length===this.numTouches&&(this.centroid=function(v){const T=new o.Point(0,0);for(const P of v)T._add(P);return T.div(v.length)}(l),this.touches=Th(m,l)))}touchmove(r,l,m){if(this.aborted||!this.centroid)return;const v=Th(m,l);for(const T in this.touches){const P=v[T];(!P||P.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(r,l,m){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class xa{constructor(r){this.singleTap=new Ha(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,l,m){this.singleTap.touchstart(r,l,m)}touchmove(r,l,m){this.singleTap.touchmove(r,l,m)}touchend(r,l,m){const v=this.singleTap.touchend(r,l,m);if(v){const T=r.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(v)<30;if(T&&P||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class zf{constructor(){this._zoomIn=new xa({numTouches:1,numTaps:2}),this._zoomOut=new xa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,m){this._zoomIn.touchstart(r,l,m),this._zoomOut.touchstart(r,l,m)}touchmove(r,l,m){this._zoomIn.touchmove(r,l,m),this._zoomOut.touchmove(r,l,m)}touchend(r,l,m){const v=this._zoomIn.touchend(r,l,m),T=this._zoomOut.touchend(r,l,m);return v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(v)},{originalEvent:r})}):T?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(T)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const op={0:1,2:2};class zl{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,l){return!1}_move(r,l){return{}}mousedown(r,l){if(this._lastPoint)return;const m=Ne(r);this._correctButton(r,m)&&(this._lastPoint=l,this._eventButton=m)}mousemoveWindow(r,l){const m=this._lastPoint;if(m){if(r.preventDefault(),this._eventButton!=null&&function(v,T){const P=op[T];return v.buttons===void 0||(v.buttons&P)!==P}(r,this._eventButton))this.reset();else if(this._moved||!(l.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(m,l)}}mouseupWindow(r){this._lastPoint&&Ne(r)===this._eventButton&&(this._moved&&He(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ol extends zl{mousedown(r,l){super.mousedown(r,l),this._lastPoint&&(this._active=!0)}_correctButton(r,l){return l===0&&!r.ctrlKey}_move(r,l){return{around:l,panDelta:l.sub(r)}}}class Fu extends zl{_correctButton(r,l){return l===0&&r.ctrlKey||l===2}_move(r,l){const m=.8*(l.x-r.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(r){r.preventDefault()}}class Eh extends zl{_correctButton(r,l){return l===0&&r.ctrlKey||l===2}_move(r,l){const m=-.5*(l.y-r.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(r){r.preventDefault()}}class Sh{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.Point(0,0)}touchstart(r,l,m){return this._calculateTransform(r,l,m)}touchmove(r,l,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,l,m)}}touchend(r,l,m){this._calculateTransform(r,l,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,m){m.length>0&&(this._active=!0);const v=Th(m,l),T=new o.Point(0,0),P=new o.Point(0,0);let I=0;for(const G in v){const $=v[G],K=this._touches[G];K&&(T._add($),P._add($.sub(K)),I++,v[G]=$)}if(this._touches=v,I<this._minTouches||!P.mag())return;const F=P.div(I);return this._sum._add(F),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(I),panDelta:F}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Te("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Pc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,l,m){return{}}touchstart(r,l,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,m){const v=this._firstTwoTouches;if(!v)return;r.preventDefault();const[T,P]=v,I=Ic(m,l,T),F=Ic(m,l,P);if(!I||!F)return;const G=this._aroundCenter?null:I.add(F).div(2);return this._move([I,F],G,r)}touchend(r,l,m){if(!this._firstTwoTouches)return;const[v,T]=this._firstTwoTouches,P=Ic(m,l,v),I=Ic(m,l,T);P&&I||(this._active&&He(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ic(d,r,l){for(let m=0;m<d.length;m++)if(d[m].identifier===l)return r[m]}function Nu(d,r){return Math.log(d/r)/Math.LN2}class ap extends Pc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){const m=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Nu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Nu(this._distance,m),pinchAround:l}}}function Ah(d,r){return 180*d.angleWith(r)/Math.PI}class lp extends Pc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){const m=this._vector;if(this._vector=r[0].sub(r[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ah(this._vector,m),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const l=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const v=Ah(r,m);return Math.abs(v)<l}}function va(d){return Math.abs(d.y)>Math.abs(d.x)}class Uu extends Pc{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,va(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,m){const v=this._lastPoints;if(!v)return;const T=r[0].sub(v[0]),P=r[1].sub(v[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(T,P,m.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(T.y+P.y)/2*-.5})}gestureBeginsVertically(r,l,m){if(this._valid!==void 0)return this._valid;const v=r.mag()>=2,T=l.mag()>=2;if(!v&&!T)return;if(!v||!T)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const P=r.y>0==l.y>0;return va(r)&&va(l)&&P}}const ju={panStep:100,bearingStep:15,pitchStep:10};class Co{constructor(){const r=ju;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,m=0,v=0,T=0,P=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?m=-1:(r.preventDefault(),T=-1);break;case 39:r.shiftKey?m=1:(r.preventDefault(),T=1);break;case 38:r.shiftKey?v=1:(r.preventDefault(),P=-1);break;case 40:r.shiftKey?v=-1:(r.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(m=0,v=0),{cameraAnimation:I=>{const F=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:cp,zoom:l?Math.round(F)+l*(r.shiftKey?2:1):F,bearing:I.getBearing()+m*this._bearingStep,pitch:I.getPitch()+v*this._pitchStep,offset:[-T*this._panStep,-P*this._panStep],center:I.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function cp(d){return d*(2-d)}const Vu=4.000244140625;class hp{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=r.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const m=o.exported.now(),v=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,l!==0&&l%Vu==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(v*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=lt(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const F=this._type==="wheel"&&Math.abs(this._delta)>Vu?this._wheelZoomRate:this._defaultZoomRate;let G=2/(1+Math.exp(-Math.abs(this._delta*F)));this._delta<0&&G!==0&&(G=1/G);const $=l(),K=Math.pow(2,$),le=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):K;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(le*G))),this._type==="wheel"&&(this._startZoom=$,this._easing=this._smoothOutEasing(200)),this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:l(),v=this._startZoom,T=this._easing;let P,I=!1;if(this._type==="wheel"&&v&&T){const F=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),G=T(F);P=o.number(v,m,G),F<1?this._frameId||(this._frameId=!0):I=!0}else P=m,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:P-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=o.ease;if(this._prevEase){const m=this._prevEase,v=(o.exported.now()-m.start)/m.duration,T=m.easing(v+.01)-m.easing(v),P=.27/Math.sqrt(T*T+1e-4)*.01,I=Math.sqrt(.0729-P*P);l=o.bezier(P,I,.25,1)}return this._prevEase={start:o.exported.now(),duration:r,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Te("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Gu{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Qs{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,l){return r.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(r.shiftKey?-1:1),around:m.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Of{constructor(){this._tap=new xa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,l,m){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=l[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(r,l,m))}touchmove(r,l,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const v=l[0],T=v.y-this._swipePoint.y;return this._swipePoint=v,r.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(r,l,m)}touchend(r,l,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(r,l,m)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lc{constructor(r,l,m){this._el=r,this._mousePan=l,this._touchPan=m}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Bf{constructor(r,l,m){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class up{constructor(r,l,m,v){this._el=r,this._touchZoom=l,this._touchRotate=m,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Fn=d=>d.zoom||d.drag||d.pitch||d.rotate;class dp extends o.Event{}class pp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,l){const m=o.sub([],l,r);this.radius=o.length(m[2]<0?o.div([],m,this.constants):[m[0],m[1],0])}projectRay(r){o.div(r,r,this.constants),o.normalize(r,r),o.mul$1(r,r,this.constants);const l=o.scale$2([],r,this.radius);if(l[2]>0){const m=o.scale$2([],[0,0,1],o.dot(l,[0,0,1])),v=o.scale$2([],o.normalize([],[l[0],l[1],0]),this.radius),T=o.add([],l,o.scale$2([],o.sub([],o.add([],v,m),l),2));l[0]=T[0],l[1]=T[1]}return l}}function no(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class ko{constructor(r,l){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Mi(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new pp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),o.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[v,T,P]of this._listeners)v.addEventListener(T,v===o.window.document?this.handleWindowEvent:this.handleEvent,P)}destroy(){for(const[r,l,m]of this._listeners)r.removeEventListener(l,r===o.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(r){const l=this._map,m=l.getCanvasContainer();this._add("mapEvent",new Rl(l,r));const v=l.boxZoom=new np(l,r);this._add("boxZoom",v);const T=new zf,P=new Qs;l.doubleClickZoom=new Gu(P,T),this._add("tapZoom",T),this._add("clickZoom",P);const I=new Of;this._add("tapDragZoom",I);const F=l.touchPitch=new Uu(l);this._add("touchPitch",F);const G=new Fu(r),$=new Eh(r);l.dragRotate=new Bf(r,G,$),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",$,["mouseRotate"]);const K=new Ol(r),le=new Sh(l,r);l.dragPan=new Lc(m,K,le),this._add("mousePan",K),this._add("touchPan",le,["touchZoom","touchRotate"]);const de=new lp,fe=new ap;l.touchZoomRotate=new up(m,fe,de,I),this._add("touchRotate",de,["touchPan","touchZoom"]),this._add("touchZoom",fe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new wh(l));const pe=l.scrollZoom=new hp(l,this);this._add("scrollZoom",pe,["mousePan"]);const ge=l.keyboard=new Co;this._add("keyboard",ge);for(const J of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[J]&&l[J].enable(r[J])}_add(r,l,m){this._handlers.push({handlerName:r,handler:l,allowed:m}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Fn(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,l,m){for(const v in r)if(v!==m&&(!l||l.indexOf(v)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const l=[];for(const m of r)this._el.contains(m.target)&&l.push(m);return l}handleEvent(r,l){this._updatingCamera=!0;const m=r.type==="renderFrame",v=m?void 0:r,T={needsRenderFrame:!1},P={},I={},F=r.touches?this._getMapTouches(r.touches):void 0,G=F?kt(this._el,F):m?void 0:lt(this._el,r);for(const{handlerName:le,handler:de,allowed:fe}of this._handlers){if(!de.isEnabled())continue;let pe;this._blockedByActive(I,fe,le)?de.reset():de[l||r.type]&&(pe=de[l||r.type](r,G,F),this.mergeHandlerResult(T,P,pe,le,v),pe&&pe.needsRenderFrame&&this._triggerRenderFrame()),(pe||de.isActive())&&(I[le]=de)}const $={};for(const le in this._previousActiveHandlers)I[le]||($[le]=v);this._previousActiveHandlers=I,(Object.keys($).length||no(T))&&(this._changes.push([T,P,$]),this._triggerRenderFrame()),(Object.keys(I).length||no(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:K}=T;K&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],K(this._map))}mergeHandlerResult(r,l,m,v,T){if(!m)return;o.extend(r,m);const P={handlerName:v,originalEvent:m.originalEvent||T};m.zoomDelta!==void 0&&(l.zoom=P),m.panDelta!==void 0&&(l.drag=P),m.pitchDelta!==void 0&&(l.pitch=P),m.bearingDelta!==void 0&&(l.rotate=P)}_applyChanges(){const r={},l={},m={};for(const[v,T,P]of this._changes)v.panDelta&&(r.panDelta=(r.panDelta||new o.Point(0,0))._add(v.panDelta)),v.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(r.around=v.around),v.aroundCoord!==void 0&&(r.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(r.pinchAround=v.pinchAround),v.noInertia&&(r.noInertia=v.noInertia),o.extend(l,T),o.extend(m,P);this._updateMapTransform(r,l,m),this._changes=[]}_updateMapTransform(r,l,m){const v=this._map,T=v.transform,P=ue=>[ue.x,ue.y,ue.z];if((ue=>{const ve=this._eventsInProgress.drag;return ve&&!this._handlersById[ve.handlerName].isActive()})()&&!no(r)){const ue=T.zoom;T.cameraElevationReference="sea",T.recenterOnTerrain(),T.cameraElevationReference="ground",ue!==T.zoom&&this._map._update(!0)}if(T._isCameraConstrained&&v._stop(!0),!no(r))return void this._fireEvents(l,m,!0);let{panDelta:I,zoomDelta:F,bearingDelta:G,pitchDelta:$,around:K,aroundCoord:le,pinchAround:de}=r;T._isCameraConstrained&&(F>0&&(F=0),T._isCameraConstrained=!1),de!==void 0&&(K=de),(F||(ue=>l[ue]&&!this._eventsInProgress[ue])("drag"))&&K&&(this._dragOrigin=P(T.pointCoordinate3D(K)),this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",v._stop(!0),K=K||v.transform.centerPoint,G&&(T.bearing+=G),$&&(T.pitch+=$),T._updateCameraState();const fe=[0,0,0];if(I)if(T.projection.name==="mercator"){const ue=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(K).dir),ve=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(K.sub(I)).dir);fe[0]=ve[0]-ue[0],fe[1]=ve[1]-ue[1]}else{const ue=T.pointCoordinate(K);if(T.projection.name==="globe"){I=I.rotate(-T.angle);const ve=T._pixelsPerMercatorPixel/T.worldSize;fe[0]=-I.x*o.mercatorScale(o.latFromMercatorY(ue.y))*ve,fe[1]=-I.y*o.mercatorScale(T.center.lat)*ve}else{const ve=T.pointCoordinate(K.sub(I));ue&&ve&&(fe[0]=ve.x-ue.x,fe[1]=ve.y-ue.y)}}const pe=T.zoom,ge=[0,0,0];if(F){const ue=P(le||T.pointCoordinate3D(K)),ve={dir:o.normalize([],o.sub([],ue,T._camera.position))};if(ve.dir[2]<0){const be=T.zoomDeltaToMovement(ue,F);o.scale$2(ge,ve.dir,be)}}const J=o.add(fe,fe,ge);T._translateCameraConstrained(J),F&&Math.abs(T.zoom-pe)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,m,!0)}_fireEvents(r,l,m){const v=Fn(this._eventsInProgress),T=Fn(r),P={};for(const $ in r){const{originalEvent:K}=r[$];this._eventsInProgress[$]||(P[`${$}start`]=K),this._eventsInProgress[$]=r[$]}!v&&T&&this._fireEvent("movestart",T.originalEvent);for(const $ in P)this._fireEvent($,P[$]);T&&this._fireEvent("move",T.originalEvent);for(const $ in r){const{originalEvent:K}=r[$];this._fireEvent($,K)}const I={};let F;for(const $ in this._eventsInProgress){const{handlerName:K,originalEvent:le}=this._eventsInProgress[$];this._handlersById[K].isActive()||(delete this._eventsInProgress[$],F=l[K]||le,I[`${$}end`]=F)}for(const $ in I)this._fireEvent($,I[$]);const G=Fn(this._eventsInProgress);if(m&&(v||T)&&!G){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),K=le=>le!==0&&-this._bearingSnap<le&&le<this._bearingSnap;$?(K($.bearing||this._map.getBearing())&&($.bearing=0),this._map.easeTo($,{originalEvent:F})):(this._map.fire(new o.Event("moveend",{originalEvent:F})),K(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new o.Event(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new dp("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const qa="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Qo extends o.Evented{constructor(r,l){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,m){return r=o.Point.convert(r).mult(-1),this.panTo(this.transform.center,o.extend({offset:r},l),m)}panTo(r,l,m){return this.easeTo(o.extend({center:r},l),m)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,m){return this.easeTo(o.extend({zoom:r},l),m)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,m){return this.easeTo(o.extend({bearing:r},l),m)}resetNorth(r,l){return this.rotateTo(0,o.extend({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){r=o.LngLatBounds.convert(r);const m=l&&l.bearing||0,v=l&&l.pitch||0,T=r.getNorthWest(),P=r.getSouthEast();return this._cameraForBounds(this.transform,T,P,m,v,l)}_extendCameraOptions(r){const l={top:0,bottom:0,right:0,left:0};if(typeof(r=o.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){const m=r.padding;r.padding={top:m,bottom:m,right:m,left:m}}return r.padding=o.extend(l,r.padding),r}_minimumAABBFrustumDistance(r,l){const m=l.max[0]-l.min[0],v=l.max[1]-l.min[1];return m/v>r.aspect?m/(2*Math.tan(.5*r.fovX)*r.aspect):v/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,l,m,v,T,P){const I=r.clone(),F=this._extendCameraOptions(P);I.bearing=v,I.pitch=T;const G=o.LngLat.convert(l),$=o.LngLat.convert(m),K=.5*(G.lat+$.lat),le=.5*(G.lng+$.lng),de=o.latLngToECEF(K,le),fe=o.normalize([],de),pe=o.normalize([],o.cross([],fe,[0,1,0])),ge=o.cross([],pe,fe),J=[pe[0],pe[1],pe[2],0,ge[0],ge[1],ge[2],0,fe[0],fe[1],fe[2],0,0,0,0,1],ue=[de,o.latLngToECEF(G.lat,G.lng),o.latLngToECEF($.lat,G.lng),o.latLngToECEF($.lat,$.lng),o.latLngToECEF(G.lat,$.lng),o.latLngToECEF(K,G.lng),o.latLngToECEF(K,$.lng),o.latLngToECEF(G.lat,le),o.latLngToECEF($.lat,le)];let ve=o.Aabb.fromPoints(ue.map(ft=>[o.dot(pe,ft),o.dot(ge,ft),o.dot(fe,ft)]));const be=o.transformMat4([],ve.center,J);o.squaredLength(be)===0&&o.set(be,0,0,1),o.normalize(be,be),o.scale$2(be,be,o.GLOBE_RADIUS),I.center=o.ecefToLatLng(be);const ze=I.getWorldToCameraMatrix(),Pe=o.invert(new Float64Array(16),ze);ve=o.Aabb.applyTransform(ve,o.multiply([],ze,J)),o.transformMat4(be,be,ze);const Oe=.5*(ve.max[2]-ve.min[2]),Xe=this._minimumAABBFrustumDistance(I,ve),$e=o.scale$2([],[0,0,1],Oe),it=o.add($e,be,$e),Mt=Xe+(I.pitch===0?0:o.distance(be,it)),et=I.globeCenterInViewSpace,gt=o.sub([],be,[et[0],et[1],et[2]]);o.normalize(gt,gt),o.scale$2(gt,gt,Mt);const ot=o.add([],be,gt);o.transformMat4(ot,ot,Pe);const Pt=o.earthRadius/o.GLOBE_RADIUS,Je=o.length(ot),_t=o.mercatorZfromAltitude(Math.max(Je*Pt-o.earthRadius,Number.EPSILON),0),Lt=Math.min(I.zoomFromMercatorZAdjusted(_t),F.maxZoom);return Lt>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(I.setProjection({name:"mercator"}),I.zoom=Lt,this._cameraForBounds(I,l,m,v,T,P)):{center:I.center,zoom:Lt,bearing:v,pitch:T}}queryTerrainElevation(r,l){const m=this.transform.elevation;return m?(l=o.extend({},{exaggerated:!0},l),m.getAtPoint(o.MercatorCoordinate.fromLngLat(r),null,l.exaggerated)):null}_cameraForBounds(r,l,m,v,T,P){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,l,m,v,T,P);const I=r.clone(),F=this._extendCameraOptions(P),G=I.padding;I.bearing=v,I.pitch=T;const $=o.LngLat.convert(l),K=o.LngLat.convert(m),le=new o.LngLat($.lng,K.lat),de=new o.LngLat(K.lng,$.lat),fe=I.project($),pe=I.project(K),ge=this.queryTerrainElevation($),J=this.queryTerrainElevation(K),ue=this.queryTerrainElevation(le),ve=this.queryTerrainElevation(de),be=[[fe.x,fe.y,Math.min(ge||0,J||0,ue||0,ve||0)],[pe.x,pe.y,Math.max(ge||0,J||0,ue||0,ve||0)]];let ze=o.Aabb.fromPoints(be);const Pe=I.getWorldToCameraMatrix(),Oe=o.invert(new Float64Array(16),Pe);ze=o.Aabb.applyTransform(ze,Pe);const Xe=o.sub([],ze.max,ze.min),$e=G.left||0,it=G.right||0,Mt=G.bottom||0,et=G.top||0,{left:gt,right:ot,top:Pt,bottom:Je}=F.padding,_t=.5*($e+it),Lt=.5*(et+Mt),ft=Math.min(I.scaleZoom(I.scale*Math.min((I.width-($e+it+gt+ot))/Xe[0],(I.height-(Mt+et+Je+Pt))/Xe[1])),F.maxZoom),Rt=I.scale/I.zoomScale(ft);ze=new o.Aabb([ze.min[0]-(gt+_t)*Rt,ze.min[1]-(Je+Lt)*Rt,ze.min[2]],[ze.max[0]+(ot+_t)*Rt,ze.max[1]+(Pt+Lt)*Rt,ze.max[2]]);const mi=.5*Xe[2],ki=this._minimumAABBFrustumDistance(I,ze),oi=[0,0,1,0];o.transformMat4$1(oi,oi,Pe),o.normalize$2(oi,oi);const _i=o.scale$2([],oi,ki+mi),Oi=o.add([],ze.center,_i),Bi=(typeof F.offset.x=="number"&&typeof F.offset.y=="number"?new o.Point(F.offset.x,F.offset.y):o.Point.convert(F.offset)).rotate(-o.degToRad(v));ze.center[0]-=Bi.x*Rt,ze.center[1]+=Bi.y*Rt,o.transformMat4(ze.center,ze.center,Oe),o.transformMat4(Oi,Oi,Oe);const di=[ze.center[0],ze.center[1],Oi[2]*I.pixelsPerMeter];o.scale$2(di,di,1/I.worldSize);const xr=o.lngFromMercatorX(di[0]),Er=o.latFromMercatorY(di[1]),Sr=Math.min(I._zoomFromMercatorZ(di[2]),F.maxZoom),Ar=new o.LngLat(xr,Er);return I.mercatorFromTransition&&Sr<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(I.setProjection({name:"globe"}),I.zoom=Sr,this._cameraForBounds(I,l,m,v,T,P)):{center:Ar,zoom:Sr,bearing:v,pitch:T}}fitBounds(r,l,m){const v=this.cameraForBounds(r,l);return this._fitInternal(v,l,m)}fitScreenCoordinates(r,l,m,v,T){const P=o.Point.convert(r),I=o.Point.convert(l),F=new o.Point(Math.min(P.x,I.x),Math.min(P.y,I.y)),G=new o.Point(Math.max(P.x,I.x),Math.max(P.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(P,I))return this;const $=this.transform.pointLocation3D(F),K=this.transform.pointLocation3D(G),le=this.transform.pointLocation3D(new o.Point(F.x,G.y)),de=this.transform.pointLocation3D(new o.Point(G.x,F.y)),fe=[Math.min($.lng,K.lng,le.lng,de.lng),Math.min($.lat,K.lat,le.lat,de.lat)],pe=[Math.max($.lng,K.lng,le.lng,de.lng),Math.max($.lat,K.lat,le.lat,de.lat)],ge=v&&v.pitch?v.pitch:this.getPitch(),J=this._cameraForBounds(this.transform,fe,pe,m,ge,v);return this._fitInternal(J,v,T)}_fitInternal(r,l,m){return r?(delete(l=o.extend(r,l)).padding,l.linear?this.easeTo(l,m):this.flyTo(l,m)):this}jumpTo(r,l){this.stop();const m=r.preloadOnly?this.transform.clone():this.transform;let v=!1,T=!1,P=!1;return"zoom"in r&&m.zoom!==+r.zoom&&(v=!0,m.zoom=+r.zoom),r.center!==void 0&&(m.center=o.LngLat.convert(r.center)),"bearing"in r&&m.bearing!==+r.bearing&&(T=!0,m.bearing=+r.bearing),"pitch"in r&&m.pitch!==+r.pitch&&(P=!0,m.pitch=+r.pitch),r.padding==null||m.isPaddingEqual(r.padding)||(m.padding=r.padding),r.preloadOnly?(this._preloadTiles(m),this):(this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),v&&this.fire(new o.Event("zoomstart",l)).fire(new o.Event("zoom",l)).fire(new o.Event("zoomend",l)),T&&this.fire(new o.Event("rotatestart",l)).fire(new o.Event("rotate",l)).fire(new o.Event("rotateend",l)),P&&this.fire(new o.Event("pitchstart",l)).fire(new o.Event("pitch",l)).fire(new o.Event("pitchend",l)),this.fire(new o.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(qa),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,l){const m=this.transform;if(!m.projection.supportsFreeCamera)return o.warnOnce(qa),this;this.stop();const v=m.zoom,T=m.pitch,P=m.bearing;m.setFreeCameraOptions(r);const I=v!==m.zoom,F=T!==m.pitch,G=P!==m.bearing;return this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),I&&this.fire(new o.Event("zoomstart",l)).fire(new o.Event("zoom",l)).fire(new o.Event("zoomend",l)),G&&this.fire(new o.Event("rotatestart",l)).fire(new o.Event("rotate",l)).fire(new o.Event("rotateend",l)),F&&this.fire(new o.Event("pitchstart",l)).fire(new o.Event("pitch",l)).fire(new o.Event("pitchend",l)),this.fire(new o.Event("moveend",l)),this}easeTo(r,l){this._stop(!1,r.easeId),((r=o.extend({offset:[0,0],duration:500,easing:o.ease},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const m=this.transform,v=this.getZoom(),T=this.getBearing(),P=this.getPitch(),I=this.getPadding(),F="zoom"in r?+r.zoom:v,G="bearing"in r?this._normalizeBearing(r.bearing,T):T,$="pitch"in r?+r.pitch:P,K="padding"in r?r.padding:m.padding,le=o.Point.convert(r.offset);let de,fe,pe;if(m.projection.name==="globe"){const $e=o.MercatorCoordinate.fromLngLat(m.center),it=le.rotate(-m.angle);$e.x+=it.x/m.worldSize,$e.y+=it.y/m.worldSize;const Mt=$e.toLngLat(),et=o.LngLat.convert(r.center||Mt);this._normalizeCenter(et),de=m.centerPoint.add(it),fe=new o.Point($e.x,$e.y).mult(m.worldSize),pe=new o.Point(o.mercatorXfromLng(et.lng),o.mercatorYfromLat(et.lat)).mult(m.worldSize).sub(fe)}else{de=m.centerPoint.add(le);const $e=m.pointLocation(de),it=o.LngLat.convert(r.center||$e);this._normalizeCenter(it),fe=m.project($e),pe=m.project(it).sub(fe)}const ge=m.zoomScale(F-v);let J,ue;r.around&&(J=o.LngLat.convert(r.around),ue=m.locationPoint(J));const ve=this._zooming||F!==v,be=this._rotating||T!==G,ze=this._pitching||$!==P,Pe=!m.isPaddingEqual(K),Oe=$e=>it=>{if(ve&&($e.zoom=o.number(v,F,it)),be&&($e.bearing=o.number(T,G,it)),ze&&($e.pitch=o.number(P,$,it)),Pe&&($e.interpolatePadding(I,K,it),de=$e.centerPoint.add(le)),J)$e.setLocationAtPoint(J,ue);else{const Mt=$e.zoomScale($e.zoom-v),et=F>v?Math.min(2,ge):Math.max(.5,ge),gt=Math.pow(et,1-it),ot=$e.unproject(fe.add(pe.mult(it*gt)).mult(Mt));$e.setLocationAtPoint($e.renderWorldCopies?ot.wrap():ot,de)}return r.preloadOnly||this._fireMoveEvents(l),$e};if(r.preloadOnly){const $e=this._emulate(Oe,r.duration,m);return this._preloadTiles($e),this}const Xe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ve,this._rotating=be,this._pitching=ze,this._padding=Pe,this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,Xe),this._ease(Oe(m),$e=>{m.recenterOnTerrain(),this._afterEase(l,$e)},r),this}_prepareEase(r,l,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||m.moving||this.fire(new o.Event("movestart",r)),this._zooming&&!m.zooming&&this.fire(new o.Event("zoomstart",r)),this._rotating&&!m.rotating&&this.fire(new o.Event("rotatestart",r)),this._pitching&&!m.pitching&&this.fire(new o.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new o.Event("move",r)),this._zooming&&this.fire(new o.Event("zoom",r)),this._rotating&&this.fire(new o.Event("rotate",r)),this._pitching&&this.fire(new o.Event("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,v=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new o.Event("zoomend",r)),v&&this.fire(new o.Event("rotateend",r)),T&&this.fire(new o.Event("pitchend",r)),this.fire(new o.Event("moveend",r))}flyTo(r,l){if(this._prefersReducedMotion(r)){const ft=o.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ft,l)}this.stop(),r=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},r);const m=this.transform,v=this.getZoom(),T=this.getBearing(),P=this.getPitch(),I=this.getPadding(),F="zoom"in r?o.clamp(+r.zoom,m.minZoom,m.maxZoom):v,G="bearing"in r?this._normalizeBearing(r.bearing,T):T,$="pitch"in r?+r.pitch:P,K="padding"in r?r.padding:m.padding,le=m.zoomScale(F-v),de=o.Point.convert(r.offset);let fe=m.centerPoint.add(de);const pe=m.pointLocation(fe),ge=o.LngLat.convert(r.center||pe);this._normalizeCenter(ge);const J=m.project(pe),ue=m.project(ge).sub(J);let ve=r.curve;const be=Math.max(m.width,m.height),ze=be/le,Pe=ue.mag();if("minZoom"in r){const ft=o.clamp(Math.min(r.minZoom,v,F),m.minZoom,m.maxZoom),Rt=be/m.zoomScale(ft-v);ve=Math.sqrt(Rt/Pe*2)}const Oe=ve*ve;function Xe(ft){const Rt=(ze*ze-be*be+(ft?-1:1)*Oe*Oe*Pe*Pe)/(2*(ft?ze:be)*Oe*Pe);return Math.log(Math.sqrt(Rt*Rt+1)-Rt)}function $e(ft){return(Math.exp(ft)-Math.exp(-ft))/2}function it(ft){return(Math.exp(ft)+Math.exp(-ft))/2}const Mt=Xe(0);let et=function(ft){return it(Mt)/it(Mt+ve*ft)},gt=function(ft){return be*((it(Mt)*($e(Rt=Mt+ve*ft)/it(Rt))-$e(Mt))/Oe)/Pe;var Rt},ot=(Xe(1)-Mt)/ve;if(Math.abs(Pe)<1e-6||!isFinite(ot)){if(Math.abs(be-ze)<1e-6)return this.easeTo(r,l);const ft=ze<be?-1:1;ot=Math.abs(Math.log(ze/be))/ve,gt=function(){return 0},et=function(Rt){return Math.exp(ft*ve*Rt)}}r.duration="duration"in r?+r.duration:1e3*ot/("screenSpeed"in r?+r.screenSpeed/ve:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Pt=T!==G,Je=$!==P,_t=!m.isPaddingEqual(K),Lt=ft=>Rt=>{const mi=Rt*ot,ki=1/et(mi);ft.zoom=Rt===1?F:v+ft.scaleZoom(ki),Pt&&(ft.bearing=o.number(T,G,Rt)),Je&&(ft.pitch=o.number(P,$,Rt)),_t&&(ft.interpolatePadding(I,K,Rt),fe=ft.centerPoint.add(de));const oi=Rt===1?ge:ft.unproject(J.add(ue.mult(gt(mi))).mult(ki));return ft.setLocationAtPoint(ft.renderWorldCopies?oi.wrap():oi,fe),ft._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(l),ft};if(r.preloadOnly){const ft=this._emulate(Lt,r.duration,m);return this._preloadTiles(ft),this}return this._zooming=!0,this._rotating=Pt,this._pitching=Je,this._padding=_t,this._prepareEase(l,!1),this._ease(Lt(m),()=>this._afterEase(l),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,l)}if(!r){const m=this.handlers;m&&m.stop(!1)}return this}_ease(r,l,m){m.animate===!1||m.duration===0?(r(1),l()):(this._easeStart=o.exported.now(),this._easeOptions=m,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,l){r=o.wrap(r,-180,180);const m=Math.abs(r-l);return Math.abs(r-360-l)<m&&(r-=360),Math.abs(r+360-l)<m&&(r+=360),r}_normalizeCenter(r){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const m=r.lng-l.center.lng;r.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&o.exported.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,l,m){const v=Math.ceil(15*l/1e3),T=[],P=r(m.clone());for(let I=0;I<=v;I++){const F=P(I/v);T.push(F.clone())}return T}}class ni{constructor(r={}){this.options=r,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const l=this.options&&this.options.compact;return this._map=r,this._container=Te("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Te("button","mapboxgl-ctrl-attrib-button",this._container),Te("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Te("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,l){const m=this._map._getUIString(`AttributionControl.${l}`);r.setAttribute("aria-label",m),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(r){const m=l.reduce((v,T,P)=>(T.value&&(v+=`${T.key}=${T.value}${P<l.length-1?"&":""}`),v),"?");r.href=`${o.config.FEEDBACK_URL}/${m}#${Wa(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const l=this._map.style._sourceCaches;for(const v in l){const T=l[v];if(T.used){const P=T.getSource();P.attribution&&r.indexOf(P.attribution)<0&&r.push(P.attribution)}}r.sort((v,T)=>v.length-T.length),r=r.filter((v,T)=>{for(let P=T+1;P<r.length;P++)if(r[P].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const m=r.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,r.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class $u{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=Te("div","mapboxgl-ctrl");const l=Te("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const l in r){const m=r[l].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Wu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){const l=this._currentlyRunning,m=l?this._queue.concat(l):this._queue;for(const v of m)if(v.id===r)return void(v.cancelled=!0)}run(r=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const m of l)if(!m.cancelled&&(m.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Xa(d,r,l){if(d=new o.LngLat(d.lng,d.lat),r){const m=new o.LngLat(d.lng-360,d.lat),v=new o.LngLat(d.lng+360,d.lat),T=360*Math.ceil(Math.abs(d.lng-l.center.lng)/360),P=l.locationPoint(d).distSqr(r),I=r.x<0||r.y<0||r.x>l.width||r.y>l.height;l.locationPoint(m).distSqr(r)<P&&(I||Math.abs(m.lng-l.center.lng)<T)?d=m:l.locationPoint(v).distSqr(r)<P&&(I||Math.abs(v.lng-l.center.lng)<T)&&(d=v)}for(;Math.abs(d.lng-l.center.lng)>180;){const m=l.locationPoint(d);if(m.x>=0&&m.y>=0&&m.x<=l.width&&m.y<=l.height)break;d.lng>l.center.lng?d.lng-=360:d.lng+=360}return d}const ba={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Zt extends o.Evented{constructor(r,l){if(super(),(r instanceof o.window.HTMLElement||l)&&(r=o.extend({element:r},l)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=o.Point.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=Te("div");const v=41,T=27,P=je("svg",{display:"block",height:v*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${v}`},this._element),I=je("radialGradient",{id:"shadowGradient"},je("defs",{},P));je("stop",{offset:"10%","stop-opacity":.4},I),je("stop",{offset:"100%","stop-opacity":.05},I),je("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},P),je("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},P),je("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},P),je("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},P),this._offset=o.Point.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const m=this._element.classList;for(const v in ba)m.remove(`mapboxgl-marker-anchor-${v}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const l=r.code,m=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(r){const l=r.originalEvent.target,m=this._element;this._popup&&(l===m||m.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,l=this._pos;if(!r||!l)return!1;const m=r.unproject(l),v=r.getFreeCameraOptions();if(!v.position)return!1;const T=v.position.toLngLat();return T.distanceTo(m)<.9*T.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const l=this._pos;if(!l||l.x<0||l.x>r.transform.width||l.y<0||l.y>r.transform.height)return void this._clearFadeTimer();const m=r.unproject(l);let v;r._showingGlobe()&&o.isLngLatBehindGlobe(r.transform,this._lngLat)?v=0:(v=1-r._queryFogOpacity(m),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${ba[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const r=this._pos,l=this._map,m=this.getPitchAlignment();if(!l||!r||m!=="map")return"";if(!l._showingGlobe()){const F=l.getPitch();return F?`rotateX(${F}deg)`:""}const v=o.radToDeg(o.globeTiltAtLngLat(l.transform,this._lngLat)),T=r.sub(o.globeCenterToScreenPoint(l.transform)),P=Math.abs(T.x)+Math.abs(T.y);if(P===0)return"";const I=v/P;return`rotateX(${-T.y*I}deg) rotateY(${T.x*I}deg)`}_calculateZTransform(){const r=this._pos,l=this._map;if(!l||!r)return"";let m=0;const v=this.getRotationAlignment();if(v==="map")if(l._showingGlobe()){const T=l.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),P=l.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(T);m=o.radToDeg(Math.atan2(P.y,P.x))-90}else m=-l.getBearing();else if(v==="horizon"){const T=o.smoothstep(4,6,l.getZoom()),P=o.globeCenterToScreenPoint(l.transform);P.y+=T*l.transform.height;const I=r.sub(P),F=o.radToDeg(Math.atan2(I.y,I.x));m=(F>90?F-270:F+90)*(1-T)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(r){o.window.cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Xa(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),r===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=o.Point.convert(r),this._update(),this}_onMove(r){const l=this._map;if(!l)return;const m=this._pointerdownPos,v=this._positionDelta;if(m&&v){if(!this._isDragging){const T=this._clickTolerance||l._clickTolerance;if(r.point.dist(m)<T)return;this._isDragging=!0}this._pos=r.point.sub(v),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(r){const l=this._map,m=this._pos;l&&m&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(m),this._pointerdownPos=r.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const l=this._map;return l&&(r?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Hu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ff=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Mh(d=new o.Point(0,0),r="bottom"){if(typeof d=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(r){case"top":return new o.Point(0,d);case"top-left":return new o.Point(l,l);case"top-right":return new o.Point(-l,l);case"bottom":return new o.Point(0,-d);case"bottom-left":return new o.Point(l,-l);case"bottom-right":return new o.Point(-l,-l);case"left":return new o.Point(d,0);case"right":return new o.Point(-d,0)}return new o.Point(0,0)}return d instanceof o.Point||Array.isArray(d)?o.Point.convert(d):o.Point.convert(d[r]||[0,0])}class qu{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const l=o.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,l,m){this._start=this.getValue(l),this._end=r,this._startTime=l,this._endTime=l+m}}const Za={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},fp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Xu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Nf{constructor(r,l,m=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Fu({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,m&&(this.mousePitch=new Eh({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(r,l){this.mouseRotate.mousedown(r,l),this.mousePitch&&this.mousePitch.mousedown(r,l),Ze()}move(r,l){const m=this.map,v=this.mouseRotate.mousemoveWindow(r,l),T=v&&v.bearingDelta;if(T&&m.setBearing(m.getBearing()+T),this.mousePitch){const P=this.mousePitch.mousemoveWindow(r,l),I=P&&P.pitchDelta;I&&m.setPitch(m.getPitch()+I)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ae(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(o.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),lt(this.element,r)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,lt(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=kt(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=kt(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Dc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ch={maxWidth:100,unit:"metric"},Zu={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Bl={version:o.version,supported:ie,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends Qo{constructor(d){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),(d=o.extend({},fp,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(d.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new yr(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._useWebGL2=d.useWebGL2,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new Wu,this._domRenderTaskQueue=new Wu,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Za,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new qu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,typeof d.container=="string"){if(this._container=o.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new ko(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new bh(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,o.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new ni({customAttribution:d.customAttribution})),this._logoControl=new $u,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new o.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new o.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(d,r){if(r===void 0&&(r=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=d.onAdd(this);this._controls.push(d);const m=this._controlPositions[r];return r.indexOf("bottom")!==-1?m.insertBefore(l,m.firstChild):m.appendChild(l),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(d);return r>-1&&this._controls.splice(r,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new o.Event("movestart",d)).fire(new o.Event("move",d)),this.fire(new o.Event("resize",d)),r&&this.fire(new o.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(o.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?o.window.navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(r=>r==="auto"?o.window.navigator.language:r):d}setLanguage(d){const r=this._parseLanguage(d);if(!this.style||r===this._language)return this;this._language=r,this.style._reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,r=d.projection.name;let l;r==="globe"&&d.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(d.setMercatorFromTransition(),l=!0):r==="mercator"&&d.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(d.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,r){return this._updateProjection(d||r||{name:"mercator"})}_updateProjection(d){let r;if(r=d.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const l in this.style._sourceCaches)this.style._sourceCaches[l].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(d){return this.transform.locationPoint3D(o.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(o.Point.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,r,l){if(d==="mouseenter"||d==="mouseover"){let m=!1;const v=P=>{const I=r.filter(G=>this.getLayer(G)),F=I.length?this.queryRenderedFeatures(P.point,{layers:I}):[];F.length?m||(m=!0,l.call(this,new Vs(d,this,P.originalEvent,{features:F}))):m=!1},T=()=>{m=!1};return{layers:new Set(r),listener:l,delegates:{mousemove:v,mouseout:T}}}if(d==="mouseleave"||d==="mouseout"){let m=!1;const v=P=>{const I=r.filter(F=>this.getLayer(F));(I.length?this.queryRenderedFeatures(P.point,{layers:I}):[]).length?m=!0:m&&(m=!1,l.call(this,new Vs(d,this,P.originalEvent)))},T=P=>{m&&(m=!1,l.call(this,new Vs(d,this,P.originalEvent)))};return{layers:new Set(r),listener:l,delegates:{mousemove:v,mouseout:T}}}{const m=v=>{const T=r.filter(I=>this.getLayer(I)),P=T.length?this.queryRenderedFeatures(v.point,{layers:T}):[];P.length&&(v.features=P,l.call(this,v),delete v.features)};return{layers:new Set(r),listener:l,delegates:{[d]:m}}}}on(d,r,l){if(l===void 0)return super.on(d,r);Array.isArray(r)||(r=[r]);const m=this._createDelegatedListener(d,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(m);for(const v in m.delegates)this.on(v,m.delegates[v]);return this}once(d,r,l){if(l===void 0)return super.once(d,r);Array.isArray(r)||(r=[r]);const m=this._createDelegatedListener(d,r,l);for(const v in m.delegates)this.once(v,m.delegates[v]);return this}off(d,r,l){if(l===void 0)return super.off(d,r);r=new Set(Array.isArray(r)?r:[r]);const m=(T,P)=>{if(T.size!==P.size)return!1;for(const I of T)if(!P.has(I))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[d]:void 0;return v&&(T=>{for(let P=0;P<T.length;P++){const I=T[P];if(I.listener===l&&m(I.layers,r)){for(const F in I.delegates)this.off(F,I.delegates[F]);return T.splice(P,1),this}}})(v),this}queryRenderedFeatures(d,r){return this.style?(r!==void 0||d===void 0||d instanceof o.Point||Array.isArray(d)||(r=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(d,r){return this.style.querySourceFeatures(d,r)}isPointOnSurface(d){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&o.warnOnce(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.Point.convert(d))}setStyle(d,r){return(r=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(d,r))}_getUIString(d){const r=this._locale[d];if(r==null)throw new Error(`Missing UI string '${d}'`);return r}_updateStyle(d,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new So(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new So(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,r){if(typeof d=="string"){const l=this._requestManager.normalizeStyleURL(d),m=this._requestManager.transformRequest(l,o.ResourceType.Style);o.getJSON(m,(v,T)=>{v?this.fire(new o.ErrorEvent(v)):T&&this._updateDiff(T,r)})}else typeof d=="object"&&this._updateDiff(d,r)}_updateDiff(d,r){try{this.style.setState(d)&&this._update(!0)}catch(l){o.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(d,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(d,r){return this._lazyInitEmptyStyle(),this.style.addSource(d,r),this._update(!0)}isSourceLoaded(d){return!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const r in d){const l=d[r]._tiles;for(const m in l){const v=l[m];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}addSourceType(d,r,l){this._lazyInitEmptyStyle(),this.style.addSourceType(d,r,l)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,r,{pixelRatio:l=1,sdf:m=!1,stretchX:v,stretchY:T,content:P}={}){if(this._lazyInitEmptyStyle(),r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap){const{width:I,height:F,data:G}=o.exported.getImageData(r);this.style.addImage(d,{data:new o.RGBAImage({width:I,height:F},G),pixelRatio:l,stretchX:v,stretchY:T,content:P,sdf:m,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:F}=r,G=r;this.style.addImage(d,{data:new o.RGBAImage({width:I,height:F},new Uint8Array(G.data)),pixelRatio:l,stretchX:v,stretchY:T,content:P,sdf:m,version:0,userImage:G}),G.onAdd&&G.onAdd(this,d)}}updateImage(d,r){const l=this.style.getImage(d);if(!l)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap?o.exported.getImageData(r):r,{width:v,height:T}=m;v!==void 0&&T!==void 0?v===l.data.width&&T===l.data.height?(l.data.replace(m.data,!(r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap)),this.style.updateImage(d,l)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${v}, ${T})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,r){o.getImage(this._requestManager.transformRequest(d,o.ResourceType.Image),(l,m)=>{r(l,m instanceof o.window.HTMLImageElement?o.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(d,r){return this._lazyInitEmptyStyle(),this.style.addLayer(d,r),this._update(!0)}moveLayer(d,r){return this.style.moveLayer(d,r),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,r,l){return this.style.setLayerZoomRange(d,r,l),this._update(!0)}setFilter(d,r,l={}){return this.style.setFilter(d,r,l),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,r,l,m={}){return this.style.setPaintProperty(d,r,l,m),this._update(!0)}getPaintProperty(d,r){return this.style.getPaintProperty(d,r)}setLayoutProperty(d,r,l,m={}){return this.style.setLayoutProperty(d,r,l,m),this._update(!0)}getLayoutProperty(d,r){return this.style.getLayoutProperty(d,r)}setLight(d,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(d),this.transform):0}setFeatureState(d,r){return this.style.setFeatureState(d,r),this._update()}removeFeatureState(d,r){return this.style.removeFeatureState(d,r),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let l,m,v,T=this._container;for(;T&&(!m||!v);){const P=o.window.getComputedStyle(T).transform;P&&P!=="none"&&(l=P.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(m=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(v=l[3])),T=T.parentElement}this._containerWidth=m?Math.abs(d/m):d,this._containerHeight=v?Math.abs(r/v):r}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=Te("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=Te("div","mapboxgl-canvas-container",d);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=Te("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=Te("div","mapboxgl-control-container",d),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{m[v]=Te("div",`mapboxgl-ctrl-${v}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,r){const l=o.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(d),this._canvas.height=l*Math.ceil(r),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${r}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const r=this._markers.indexOf(d);r!==-1&&this._markers.splice(r,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const r=this._popups.indexOf(d);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const d=o.extend({},ie.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._useWebGL2&&this._canvas.getContext("webgl2",d),l=r||this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);l?(this._useWebGL2&&!r&&o.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),o.storeAuthState(l,!0),this.painter=new Cl(l,this.transform,!!r),this.on("data",m=>{m.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(l)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let r;const l=this.painter.context.extTimerQuery,m=o.exported.now();if(this.listens("gpu-timing-frame")&&(r=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,F=this.transform.pitch,G=o.exported.now(),$=new o.EvaluationParameters(I,{now:G,fadeDuration:v,pitch:F,transition:this.style.getTransition()});this.style.update($)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const I=o.exported.now()-m;l.endQueryEXT(l.TIME_ELAPSED_EXT,r),setTimeout(()=>{const F=l.getQueryObjectEXT(r,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(r),this.fire(new o.Event("gpu-timing-frame",{cpuTime:I,gpuTime:F})),o.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:F}})},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(I);this.fire(new o.Event("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(I);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:F}))},50)}const P=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(P||this._repaint)this.triggerRepaint();else{const I=!this.isMoving()&&this.loaded();if(I&&(T=this._updateAverageElevation(m,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||P||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const r of this._markers)d&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!d||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(d,r=!1){const l=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);if((r||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const m=this.transform.averageElevation;let v=this.transform.sampleAverageElevation(),T=!1;this.transform.elevation&&(T=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=d;const P=Math.abs(m-v);if(P>1){if(this._isInitialLoad||T)return this._averageElevation.jumpTo(v),l(v);this._averageElevation.easeTo(v,d,300)}else if(P>1e-4)return this._averageElevation.jumpTo(v),l(v)}return!!this._averageElevation.isEasing(d)&&l(this._averageElevation.getValue(d))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===o.AUTH_ERR_MSG||d.status===401)){const r=this.painter.context.gl;o.storeAuthState(r,!1),this._logoControl instanceof $u&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const l=this.painter.context.gl,m=l.createFramebuffer();function v(T){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,T,0);const P=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,P),P}return l.bindFramebuffer(l.FRAMEBUFFER,m),this._canvasPixelComparison(v(d),r.canvasCopies.map(v),r.timeStamps)}_canvasPixelComparison(d,r,l){let m=l[1]-l[0];const v=d.length/4;for(let T=0;T<r.length;T++){const P=r[T];let I=0;for(let F=0;F<P.length;F+=4)P[F]===d[F]&&P[F+1]===d[F+1]&&P[F+2]===d[F+2]&&P[F+3]===d[F+3]&&(I+=1);m+=(l[T+2]-l[T+1])*(1-I/v)}return m}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=o.exported.frame(r=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(r)}))}_preloadTiles(d){const r=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(r,(l,m)=>l._preloadTiles(d,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){o.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,d&&this._update())}_setCacheLimits(d,r){o.setCacheLimits(d,r)}get version(){return o.version}},NavigationControl:class{constructor(d){this.options=o.extend({},Xu,d),this._container=Te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),Te("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),Te("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:r}):l.resetNorth({},{originalEvent:r}))}),this._compassIcon=Te("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const r=d.getZoom(),l=r===d.getMaxZoom(),m=r===d.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Nf(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,r){const l=Te("button",d,this._container);return l.type="button",l.addEventListener("click",r),l}_setButtonTitle(d,r){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${r}`);d.setAttribute("aria-label",l),d.firstElementChild&&d.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends o.Evented{constructor(d){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},Dc,d),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ll(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=Te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const r=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,d(l)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(l=>r(l.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(d){const r=this._map.getMaxBounds(),l=d.coords;return!!r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",d)),this._finish()}}_updateCamera(d){const r=new o.LngLat(d.coords.longitude,d.coords.latitude),l=d.coords.accuracy,m=this._map.getBearing(),v=o.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(l),v,{geolocateSource:!0})}_updateMarker(d){if(d){const r=new o.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,r=o.mercatorZfromAltitude(1,d._center.lat)*d.worldSize,l=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=Te("button","mapboxgl-ctrl-geolocate",this._container),Te("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Te("div","mapboxgl-user-location"),this._dotElement.appendChild(Te("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Te("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Zt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Te("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Zt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ni,ScaleControl:class{constructor(d){this.options=o.extend({},Ch,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,r=this._map,l=r._containerHeight/2,m=r._containerWidth/2-d/2,v=r.unproject([m,l]),T=r.unproject([m+d,l]),P=v.distanceTo(T);if(this.options.unit==="imperial"){const I=3.2808*P;I>5280?this._setScale(d,I/5280,"mile"):this._setScale(d,I,"foot")}else this.options.unit==="nautical"?this._setScale(d,P/1852,"nautical-mile"):P>=1e3?this._setScale(d,P/1e3,"kilometer"):this._setScale(d,P,"meter")}_setScale(d,r,l){this._map._requestDomTask(()=>{const m=function(T){const P=Math.pow(10,`${Math.floor(T)}`.length-1);let I=T/P;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(F){const G=Math.pow(10,Math.ceil(-Math.log(F)/Math.LN10));return Math.round(F*G)/G}(I),P*I}(r),v=m/r;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(m):`${m}&nbsp;${Zu[l]}`,this._container.style.width=d*v+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=Te("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof o.window.HTMLElement?this._container=d.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=Te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=Te("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Te("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(d){super(),this.options=o.extend(Object.create(Hu),d),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=o.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(o.window.document.createTextNode(d))}setHTML(d){const r=o.window.document.createDocumentFragment(),l=o.window.document.createElement("body");let m;for(l.innerHTML=d;m=l.firstChild,m;)r.appendChild(m);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=Te("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(d),this.options.closeButton){const l=this._closeButton=Te("button","mapboxgl-popup-close-button",r);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let r;return this._classList.delete(d)?r=!1:(this._classList.add(d),r=!0),this._updateClassList(),r}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const r=this._map,l=this._container,m=this._pos;if(!r||!l||!m)return"bottom";const v=l.offsetWidth,T=l.offsetHeight,P=m.x<v/2,I=m.x>r.transform.width-v/2;if(m.y+d<T)return P?"top-left":I?"top-right":"top";if(m.y>r.transform.height-T){if(P)return"bottom-left";if(I)return"bottom-right"}return P?"left":I?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),d.className=r.join(" ")}_update(d){const r=this._map,l=this._content;if(!r||!this._lngLat&&!this._trackPointer||!l)return;let m=this._container;if(m||(m=this._container=Te("div","mapboxgl-popup",r.getContainer()),this._tip=Te("div","mapboxgl-popup-tip",m),m.appendChild(l)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Xa(this._lngLat,this._pos,r.transform)),!this._trackPointer||d){const v=this._pos=this._trackPointer&&d?d:r.project(this._lngLat),T=Mh(this.options.offset),P=this._anchor=this._getAnchor(T.y),I=Mh(this.options.offset,P),F=v.add(I).round();r._requestDomTask(()=>{this._container&&P&&(this._container.style.transform=`${ba[P]} translate(${F.x}px,${F.y}px)`)})}if(!this._marker&&r._showingGlobe()){const v=o.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Ff);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:Zt,Style:So,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.Point,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:rp,Evented:o.Evented,config:o.config,prewarm:function(){ls().acquire(xo)},clearPrewarmedResources:function(){const d=Zs;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(xo),Zs=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(d){o.config.ACCESS_TOKEN=d},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(d){o.config.API_URL=d},get workerCount(){return As.workerCount},set workerCount(d){As.workerCount=d},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){o.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){o.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return Bl});var q=D;return q})})(sE);var sI=sE.exports;const oE=rE(sI);/*!
 * pinia v3.0.2
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let aE;const wy=a=>aE=a,lE=Symbol();function M0(a){return a&&typeof a=="object"&&Object.prototype.toString.call(a)==="[object Object]"&&typeof a.toJSON!="function"}var Hm;(function(a){a.direct="direct",a.patchObject="patch object",a.patchFunction="patch function"})(Hm||(Hm={}));function nI(){const a=U0(!0),h=a.run(()=>Kr({}));let _=[],w=[];const M=cy({install(D){wy(M),M._a=D,D.provide(lE,M),D.config.globalProperties.$pinia=M,w.forEach(B=>_.push(B)),w=[]},use(D){return this._a?_.push(D):w.push(D),this},_p:_,_a:null,_e:a,_s:new Map,state:h});return M}const cE=()=>{};function E1(a,h,_,w=cE){a.push(h);const M=()=>{const D=a.indexOf(h);D>-1&&(a.splice(D,1),w())};return!_&&j0()&&W1(M),M}function tf(a,...h){a.slice().forEach(_=>{_(...h)})}const oI=a=>a(),S1=Symbol(),Qx=Symbol();function C0(a,h){a instanceof Map&&h instanceof Map?h.forEach((_,w)=>a.set(w,_)):a instanceof Set&&h instanceof Set&&h.forEach(a.add,a);for(const _ in h){if(!h.hasOwnProperty(_))continue;const w=h[_],M=a[_];M0(M)&&M0(w)&&a.hasOwnProperty(_)&&!Os(w)&&!nc(w)?a[_]=C0(M,w):a[_]=w}return a}const aI=Symbol();function lI(a){return!M0(a)||!Object.prototype.hasOwnProperty.call(a,aI)}const{assign:ru}=Object;function cI(a){return!!(Os(a)&&a.effect)}function hI(a,h,_,w){const{state:M,actions:D,getters:B}=h,q=_.state.value[a];let o;function X(){q||(_.state.value[a]=M?M():{});const ie=cw(_.state.value[a]);return ru(ie,D,Object.keys(B||{}).reduce((oe,xe)=>(oe[xe]=cy(An(()=>{wy(_);const Te=_._s.get(a);return B[xe].call(Te,Te)})),oe),{}))}return o=hE(a,X,h,_,w,!0),o}function hE(a,h,_={},w,M,D){let B;const q=ru({actions:{}},_),o={deep:!0};let X,ie,oe=[],xe=[],Te;const je=w.state.value[a];!D&&!je&&(w.state.value[a]={}),Kr({});let We;function pt(Ne){let ht;X=ie=!1,typeof Ne=="function"?(Ne(w.state.value[a]),ht={type:Hm.patchFunction,storeId:a,events:Te}):(C0(w.state.value[a],Ne),ht={type:Hm.patchObject,payload:Ne,storeId:a,events:Te});const Ge=We=Symbol();Ef().then(()=>{We===Ge&&(X=!0)}),ie=!0,tf(oe,ht,w.state.value[a])}const yt=D?function(){const{state:ht}=_,Ge=ht?ht():{};this.$patch(ai=>{ru(ai,Ge)})}:cE;function Ze(){B.stop(),oe=[],xe=[],w._s.delete(a)}const Ae=(Ne,ht="")=>{if(S1 in Ne)return Ne[Qx]=ht,Ne;const Ge=function(){wy(w);const ai=Array.from(arguments),Ot=[],jt=[];function Ti(yi){Ot.push(yi)}function Qi(yi){jt.push(yi)}tf(xe,{args:ai,name:Ge[Qx],store:He,after:Ti,onError:Qi});let li;try{li=Ne.apply(this&&this.$id===a?this:He,ai)}catch(yi){throw tf(jt,yi),yi}return li instanceof Promise?li.then(yi=>(tf(Ot,yi),yi)).catch(yi=>(tf(jt,yi),Promise.reject(yi))):(tf(Ot,li),li)};return Ge[S1]=!0,Ge[Qx]=ht,Ge},Be={_p:w,$id:a,$onAction:E1.bind(null,xe),$patch:pt,$reset:yt,$subscribe(Ne,ht={}){const Ge=E1(oe,Ne,ht.detached,()=>ai()),ai=B.run(()=>ul(()=>w.state.value[a],Ot=>{(ht.flush==="sync"?ie:X)&&Ne({storeId:a,type:Hm.direct,events:Te},Ot)},ru({},o,ht)));return Ge},$dispose:Ze},He=wf(Be);w._s.set(a,He);const kt=(w._a&&w._a.runWithContext||oI)(()=>w._e.run(()=>(B=U0()).run(()=>h({action:Ae}))));for(const Ne in kt){const ht=kt[Ne];if(Os(ht)&&!cI(ht)||nc(ht))D||(je&&lI(ht)&&(Os(ht)?ht.value=je[Ne]:C0(ht,je[Ne])),w.state.value[a][Ne]=ht);else if(typeof ht=="function"){const Ge=Ae(ht,Ne);kt[Ne]=Ge,q.actions[Ne]=ht}}return ru(He,kt),ru(Pr(He),kt),Object.defineProperty(He,"$state",{get:()=>w.state.value[a],set:Ne=>{pt(ht=>{ru(ht,Ne)})}}),w._p.forEach(Ne=>{ru(He,B.run(()=>Ne({store:He,app:w._a,pinia:w,options:q})))}),je&&D&&_.hydrate&&_.hydrate(He.$state,je),X=!0,ie=!0,He}/*! #__NO_SIDE_EFFECTS__ */function uI(a,h,_){let w;const M=typeof h=="function";w=M?_:h;function D(B,q){const o=Bw();return B=B||(o?Ia(lE,null):null),B&&wy(B),B=aE,B._s.has(a)||(M?hE(a,h,w,B):hI(a,w,B)),B._s.get(a)}return D.$id=a,D}const uE=uI("map",{state:()=>({map:null,boundaries:{},visibleLayer:null}),actions:{setMap(a){this.map=a},setBoundaries(a){this.boundaries=a},highlightFeature(a,h){var o,X;if(!this.map||!a)return;const _={country:"countries-outline",watershed:"watersheds-outline",commune:"communes-outline"},w=_[h],M=Object.values(_);for(const ie of M)(o=this.map)!=null&&o.getLayer(ie)&&(this.map.setLayoutProperty(ie,"visibility","none"),this.map.setPaintProperty(ie,"line-color","rgba(0,0,0,0)"));(X=this.map)!=null&&X.getLayer(w)&&(this.map.setLayoutProperty(w,"visibility","visible"),this.map.setPaintProperty(w,"line-color","#000000"),this.map.setPaintProperty(w,"line-width",4)),this.visibleLayer=h;const D=a.geometry.coordinates.flat(1/0),B=D.filter((ie,oe)=>oe%2===0),q=D.filter((ie,oe)=>oe%2!==0);if(B.length&&q.length){const ie=new oE.LngLatBounds([Math.min(...B),Math.min(...q)],[Math.max(...B),Math.max(...q)]);this.map.fitBounds(ie,{padding:40})}},resetView(){if(!this.map)return;this.map.flyTo({center:[1.8,11.5],zoom:4.2,essential:!0});const a=["countries-outline","watersheds-outline","communes-outline"];for(const h of a)this.map.getLayer(h)&&this.map.setLayoutProperty(h,"visibility","none");this.visibleLayer=null}}}),dI=ln({__name:"MapboxMap",setup(a){const h=Kr(null),_=uE(),w="pk.eyJ1Ijoib3N1bWFpIiwiYSI6ImNtOThheGt3bDAxMDYyanM1cDVoZG5jaGIifQ.rhfXn8CCj3FZ-OTeH-z-Ag",M="http://127.0.0.1:8000/api/v1";return lc(()=>{const D=new oE.Map({container:h.value,style:"mapbox://styles/mapbox/light-v10",center:[1,12],zoom:4.2,accessToken:w});_.setMap(D),D.on("load",()=>{D.addSource("komadogou-landcover",{type:"raster",tiles:[`${M}/proxy_geoserver/komadogou-landcover/{z}/{x}/{y}.png`],tileSize:256}),D.addLayer({id:"komadogou-landcover",type:"raster",source:"komadogou-landcover",paint:{"raster-opacity":.6}}),D.addSource("komadogou-rivers",{type:"raster",tiles:[`${M}/proxy_geoserver/komadogou-river-streams/{z}/{x}/{y}.png`],tileSize:256}),D.addLayer({id:"komadogou-rivers",type:"raster",source:"komadogou-rivers",paint:{"raster-opacity":.1}}),D.addSource("boundaries",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),[{id:"countries-outline",key:"country"},{id:"watersheds-outline",key:"watershed"},{id:"communes-outline",key:"commune"}].forEach(({id:q,key:o})=>{D.addLayer({id:q,type:"line",source:"boundaries",filter:["==",["get","layer"],o],layout:{visibility:"none"},paint:{"line-color":"#000000","line-width":2}})})})}),(D,B)=>(Di(),Yi("div",{ref_key:"mapContainer",ref:h,class:"mapbox-map w-full h-full"},null,512))}}),pI=yo(dI,[["__scopeId","data-v-78edaa31"]]),fI={class:"map-control-panel"},mI={class:"dropdown-group"},gI=["value"],_I={key:0,class:"spinner"},yI={key:0,class:"dropdown-group"},xI=["value"],vI={key:0,class:"spinner"},bI={key:1,class:"dropdown-group"},wI=["value"],TI={key:0,class:"spinner"},EI=ln({__name:"MapControlPanel",setup(a){const h=uE(),_=Kr(null),w=Kr(null),M=Kr(null),D=Kr(!1),B=Kr(!1),q=Kr(!1),o=Kr([]),X=Kr([]),ie=Kr([]);async function oe(){try{const He=await(await fetch("http://127.0.0.1:8000/api/v1/boundaries/all")).json();o.value=He.countries.features,X.value=He.watersheds.features,ie.value=He.communes.features,h.setBoundaries(He)}catch(Be){console.error("Failed to load boundaries:",Be)}}lc(async()=>{D.value=!0,await oe(),D.value=!1}),ul(()=>_.value,()=>{w.value=null,M.value=null}),ul(()=>w.value,()=>{M.value=null});const xe=An(()=>{if(!_.value)return[];const Be=je(_.value);return X.value.filter(He=>We(He,Be))}),Te=An(()=>{if(!w.value)return[];const Be=je(w.value);return ie.value.filter(He=>We(He,Be))});function je(Be){const He=Be.geometry.coordinates.flat(1/0),lt=He.filter((Ne,ht)=>ht%2===0),kt=He.filter((Ne,ht)=>ht%2!==0);return[Math.min(...lt),Math.min(...kt),Math.max(...lt),Math.max(...kt)]}function We(Be,[He,lt,kt,Ne]){const[ht,Ge,ai,Ot]=je(Be);return!(ai<He||ht>kt||Ot<lt||Ge>Ne)}function pt(){B.value=!0,h.highlightFeature(_.value,"country"),setTimeout(()=>B.value=!1,500)}function yt(){q.value=!0,h.highlightFeature(w.value,"watershed"),setTimeout(()=>q.value=!1,500)}function Ze(){h.highlightFeature(M.value,"commune")}function Ae(){_.value=null,w.value=null,M.value=null,h.resetView()}return(Be,He)=>(Di(),Yi("div",fI,[He[9]||(He[9]=It("h3",{class:"panel-title"},"Map Controls",-1)),It("div",mI,[He[4]||(He[4]=It("label",{class:"dropdown-label"},"Country",-1)),rc(It("select",{"onUpdate:modelValue":He[0]||(He[0]=lt=>_.value=lt),onChange:pt},[He[3]||(He[3]=It("option",{disabled:"",value:""},"Select a country",-1)),(Di(!0),Yi(es,null,hl(o.value,lt=>(Di(),Yi("option",{key:lt.properties.id,value:lt},zs(lt.properties.name),9,gI))),128))],544),[[Vm,_.value]]),D.value?(Di(),Yi("span",_I,"")):ll("",!0)]),xe.value.length?(Di(),Yi("div",yI,[He[6]||(He[6]=It("label",{class:"dropdown-label"},"Watershed",-1)),rc(It("select",{"onUpdate:modelValue":He[1]||(He[1]=lt=>w.value=lt),onChange:yt},[He[5]||(He[5]=It("option",{disabled:"",value:""},"Select a watershed",-1)),(Di(!0),Yi(es,null,hl(xe.value,lt=>(Di(),Yi("option",{key:lt.properties.id,value:lt},zs(lt.properties.layer||lt.properties.name),9,xI))),128))],544),[[Vm,w.value]]),B.value?(Di(),Yi("span",vI,"")):ll("",!0)])):ll("",!0),Te.value.length?(Di(),Yi("div",bI,[He[8]||(He[8]=It("label",{class:"dropdown-label"},"Commune",-1)),rc(It("select",{"onUpdate:modelValue":He[2]||(He[2]=lt=>M.value=lt),onChange:Ze},[He[7]||(He[7]=It("option",{disabled:"",value:""},"Select a commune",-1)),(Di(!0),Yi(es,null,hl(Te.value,lt=>(Di(),Yi("option",{key:lt.properties.id,value:lt},zs(lt.properties.name),9,wI))),128))],544),[[Vm,M.value]]),q.value?(Di(),Yi("span",TI,"")):ll("",!0)])):ll("",!0),It("button",{class:"reset-btn",onClick:Ae},"Reset Map View")]))}}),SI=yo(EI,[["__scopeId","data-v-b388a9ab"]]),AI={key:0,class:"legend-container"},MI={class:"legend-list"},CI=ln({__name:"LandcoverLegend",props:{show:{type:Boolean}},setup(a){const h={Water:"#2b83ba",Forest:"#1a9850",Cropland:"#d7191c",Grassland:"#fdae61",Shrubland:"#abdda4",Wetland:"#66c2a5",Bareland:"#ffffbf",Urban:"#f46d43"};return(_,w)=>_.show?(Di(),Yi("div",AI,[w[0]||(w[0]=It("h4",{class:"legend-title"},"Landcover Legend",-1)),It("ul",MI,[(Di(),Yi(es,null,hl(h,(M,D)=>It("li",{key:D},[It("span",{class:"legend-swatch",style:Hd({backgroundColor:M})},null,4),jo(" "+zs(D),1)])),64))])])):ll("",!0)}}),kI=yo(CI,[["__scopeId","data-v-e61a3f00"]]),PI={class:"dashboard-container"},II={class:"map-area"},LI={class:"overlay-panels"},DI=ln({__name:"DashboardView",setup(a){return(h,_)=>(Di(),Yi("div",PI,[hr(iI),It("div",II,[hr(pI),It("div",LI,[hr(SI),hr(kI,{show:!0})])])]))}}),RI=yo(DI,[["__scopeId","data-v-17382083"]]);function dE(a,h){return function(){return a.apply(h,arguments)}}const{toString:zI}=Object.prototype,{getPrototypeOf:dv}=Object,Ty=(a=>h=>{const _=zI.call(h);return a[_]||(a[_]=_.slice(8,-1).toLowerCase())})(Object.create(null)),fl=a=>(a=a.toLowerCase(),h=>Ty(h)===a),Ey=a=>h=>typeof h===a,{isArray:Sf}=Array,sg=Ey("undefined");function OI(a){return a!==null&&!sg(a)&&a.constructor!==null&&!sg(a.constructor)&&da(a.constructor.isBuffer)&&a.constructor.isBuffer(a)}const pE=fl("ArrayBuffer");function BI(a){let h;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?h=ArrayBuffer.isView(a):h=a&&a.buffer&&pE(a.buffer),h}const FI=Ey("string"),da=Ey("function"),fE=Ey("number"),Sy=a=>a!==null&&typeof a=="object",NI=a=>a===!0||a===!1,L_=a=>{if(Ty(a)!=="object")return!1;const h=dv(a);return(h===null||h===Object.prototype||Object.getPrototypeOf(h)===null)&&!(Symbol.toStringTag in a)&&!(Symbol.iterator in a)},UI=fl("Date"),jI=fl("File"),VI=fl("Blob"),GI=fl("FileList"),$I=a=>Sy(a)&&da(a.pipe),WI=a=>{let h;return a&&(typeof FormData=="function"&&a instanceof FormData||da(a.append)&&((h=Ty(a))==="formdata"||h==="object"&&da(a.toString)&&a.toString()==="[object FormData]"))},HI=fl("URLSearchParams"),[qI,XI,ZI,YI]=["ReadableStream","Request","Response","Headers"].map(fl),KI=a=>a.trim?a.trim():a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function hg(a,h,{allOwnKeys:_=!1}={}){if(a===null||typeof a>"u")return;let w,M;if(typeof a!="object"&&(a=[a]),Sf(a))for(w=0,M=a.length;w<M;w++)h.call(null,a[w],w,a);else{const D=_?Object.getOwnPropertyNames(a):Object.keys(a),B=D.length;let q;for(w=0;w<B;w++)q=D[w],h.call(null,a[q],q,a)}}function mE(a,h){h=h.toLowerCase();const _=Object.keys(a);let w=_.length,M;for(;w-- >0;)if(M=_[w],h===M.toLowerCase())return M;return null}const Bd=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,gE=a=>!sg(a)&&a!==Bd;function k0(){const{caseless:a}=gE(this)&&this||{},h={},_=(w,M)=>{const D=a&&mE(h,M)||M;L_(h[D])&&L_(w)?h[D]=k0(h[D],w):L_(w)?h[D]=k0({},w):Sf(w)?h[D]=w.slice():h[D]=w};for(let w=0,M=arguments.length;w<M;w++)arguments[w]&&hg(arguments[w],_);return h}const JI=(a,h,_,{allOwnKeys:w}={})=>(hg(h,(M,D)=>{_&&da(M)?a[D]=dE(M,_):a[D]=M},{allOwnKeys:w}),a),QI=a=>(a.charCodeAt(0)===65279&&(a=a.slice(1)),a),eL=(a,h,_,w)=>{a.prototype=Object.create(h.prototype,w),a.prototype.constructor=a,Object.defineProperty(a,"super",{value:h.prototype}),_&&Object.assign(a.prototype,_)},tL=(a,h,_,w)=>{let M,D,B;const q={};if(h=h||{},a==null)return h;do{for(M=Object.getOwnPropertyNames(a),D=M.length;D-- >0;)B=M[D],(!w||w(B,a,h))&&!q[B]&&(h[B]=a[B],q[B]=!0);a=_!==!1&&dv(a)}while(a&&(!_||_(a,h))&&a!==Object.prototype);return h},iL=(a,h,_)=>{a=String(a),(_===void 0||_>a.length)&&(_=a.length),_-=h.length;const w=a.indexOf(h,_);return w!==-1&&w===_},rL=a=>{if(!a)return null;if(Sf(a))return a;let h=a.length;if(!fE(h))return null;const _=new Array(h);for(;h-- >0;)_[h]=a[h];return _},sL=(a=>h=>a&&h instanceof a)(typeof Uint8Array<"u"&&dv(Uint8Array)),nL=(a,h)=>{const w=(a&&a[Symbol.iterator]).call(a);let M;for(;(M=w.next())&&!M.done;){const D=M.value;h.call(a,D[0],D[1])}},oL=(a,h)=>{let _;const w=[];for(;(_=a.exec(h))!==null;)w.push(_);return w},aL=fl("HTMLFormElement"),lL=a=>a.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(_,w,M){return w.toUpperCase()+M}),A1=(({hasOwnProperty:a})=>(h,_)=>a.call(h,_))(Object.prototype),cL=fl("RegExp"),_E=(a,h)=>{const _=Object.getOwnPropertyDescriptors(a),w={};hg(_,(M,D)=>{let B;(B=h(M,D,a))!==!1&&(w[D]=B||M)}),Object.defineProperties(a,w)},hL=a=>{_E(a,(h,_)=>{if(da(a)&&["arguments","caller","callee"].indexOf(_)!==-1)return!1;const w=a[_];if(da(w)){if(h.enumerable=!1,"writable"in h){h.writable=!1;return}h.set||(h.set=()=>{throw Error("Can not rewrite read-only method '"+_+"'")})}})},uL=(a,h)=>{const _={},w=M=>{M.forEach(D=>{_[D]=!0})};return Sf(a)?w(a):w(String(a).split(h)),_},dL=()=>{},pL=(a,h)=>a!=null&&Number.isFinite(a=+a)?a:h;function fL(a){return!!(a&&da(a.append)&&a[Symbol.toStringTag]==="FormData"&&a[Symbol.iterator])}const mL=a=>{const h=new Array(10),_=(w,M)=>{if(Sy(w)){if(h.indexOf(w)>=0)return;if(!("toJSON"in w)){h[M]=w;const D=Sf(w)?[]:{};return hg(w,(B,q)=>{const o=_(B,M+1);!sg(o)&&(D[q]=o)}),h[M]=void 0,D}}return w};return _(a,0)},gL=fl("AsyncFunction"),_L=a=>a&&(Sy(a)||da(a))&&da(a.then)&&da(a.catch),yE=((a,h)=>a?setImmediate:h?((_,w)=>(Bd.addEventListener("message",({source:M,data:D})=>{M===Bd&&D===_&&w.length&&w.shift()()},!1),M=>{w.push(M),Bd.postMessage(_,"*")}))(`axios@${Math.random()}`,[]):_=>setTimeout(_))(typeof setImmediate=="function",da(Bd.postMessage)),yL=typeof queueMicrotask<"u"?queueMicrotask.bind(Bd):typeof process<"u"&&process.nextTick||yE,vt={isArray:Sf,isArrayBuffer:pE,isBuffer:OI,isFormData:WI,isArrayBufferView:BI,isString:FI,isNumber:fE,isBoolean:NI,isObject:Sy,isPlainObject:L_,isReadableStream:qI,isRequest:XI,isResponse:ZI,isHeaders:YI,isUndefined:sg,isDate:UI,isFile:jI,isBlob:VI,isRegExp:cL,isFunction:da,isStream:$I,isURLSearchParams:HI,isTypedArray:sL,isFileList:GI,forEach:hg,merge:k0,extend:JI,trim:KI,stripBOM:QI,inherits:eL,toFlatObject:tL,kindOf:Ty,kindOfTest:fl,endsWith:iL,toArray:rL,forEachEntry:nL,matchAll:oL,isHTMLForm:aL,hasOwnProperty:A1,hasOwnProp:A1,reduceDescriptors:_E,freezeMethods:hL,toObjectSet:uL,toCamelCase:lL,noop:dL,toFiniteNumber:pL,findKey:mE,global:Bd,isContextDefined:gE,isSpecCompliantForm:fL,toJSONObject:mL,isAsyncFn:gL,isThenable:_L,setImmediate:yE,asap:yL};function cr(a,h,_,w,M){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=a,this.name="AxiosError",h&&(this.code=h),_&&(this.config=_),w&&(this.request=w),M&&(this.response=M,this.status=M.status?M.status:null)}vt.inherits(cr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:vt.toJSONObject(this.config),code:this.code,status:this.status}}});const xE=cr.prototype,vE={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(a=>{vE[a]={value:a}});Object.defineProperties(cr,vE);Object.defineProperty(xE,"isAxiosError",{value:!0});cr.from=(a,h,_,w,M,D)=>{const B=Object.create(xE);return vt.toFlatObject(a,B,function(o){return o!==Error.prototype},q=>q!=="isAxiosError"),cr.call(B,a.message,h,_,w,M),B.cause=a,B.name=a.name,D&&Object.assign(B,D),B};const xL=null;function P0(a){return vt.isPlainObject(a)||vt.isArray(a)}function bE(a){return vt.endsWith(a,"[]")?a.slice(0,-2):a}function M1(a,h,_){return a?a.concat(h).map(function(M,D){return M=bE(M),!_&&D?"["+M+"]":M}).join(_?".":""):h}function vL(a){return vt.isArray(a)&&!a.some(P0)}const bL=vt.toFlatObject(vt,{},null,function(h){return/^is[A-Z]/.test(h)});function Ay(a,h,_){if(!vt.isObject(a))throw new TypeError("target must be an object");h=h||new FormData,_=vt.toFlatObject(_,{metaTokens:!0,dots:!1,indexes:!1},!1,function(We,pt){return!vt.isUndefined(pt[We])});const w=_.metaTokens,M=_.visitor||ie,D=_.dots,B=_.indexes,o=(_.Blob||typeof Blob<"u"&&Blob)&&vt.isSpecCompliantForm(h);if(!vt.isFunction(M))throw new TypeError("visitor must be a function");function X(je){if(je===null)return"";if(vt.isDate(je))return je.toISOString();if(!o&&vt.isBlob(je))throw new cr("Blob is not supported. Use a Buffer instead.");return vt.isArrayBuffer(je)||vt.isTypedArray(je)?o&&typeof Blob=="function"?new Blob([je]):Buffer.from(je):je}function ie(je,We,pt){let yt=je;if(je&&!pt&&typeof je=="object"){if(vt.endsWith(We,"{}"))We=w?We:We.slice(0,-2),je=JSON.stringify(je);else if(vt.isArray(je)&&vL(je)||(vt.isFileList(je)||vt.endsWith(We,"[]"))&&(yt=vt.toArray(je)))return We=bE(We),yt.forEach(function(Ae,Be){!(vt.isUndefined(Ae)||Ae===null)&&h.append(B===!0?M1([We],Be,D):B===null?We:We+"[]",X(Ae))}),!1}return P0(je)?!0:(h.append(M1(pt,We,D),X(je)),!1)}const oe=[],xe=Object.assign(bL,{defaultVisitor:ie,convertValue:X,isVisitable:P0});function Te(je,We){if(!vt.isUndefined(je)){if(oe.indexOf(je)!==-1)throw Error("Circular reference detected in "+We.join("."));oe.push(je),vt.forEach(je,function(yt,Ze){(!(vt.isUndefined(yt)||yt===null)&&M.call(h,yt,vt.isString(Ze)?Ze.trim():Ze,We,xe))===!0&&Te(yt,We?We.concat(Ze):[Ze])}),oe.pop()}}if(!vt.isObject(a))throw new TypeError("data must be an object");return Te(a),h}function C1(a){const h={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(a).replace(/[!'()~]|%20|%00/g,function(w){return h[w]})}function pv(a,h){this._pairs=[],a&&Ay(a,this,h)}const wE=pv.prototype;wE.append=function(h,_){this._pairs.push([h,_])};wE.toString=function(h){const _=h?function(w){return h.call(this,w,C1)}:C1;return this._pairs.map(function(M){return _(M[0])+"="+_(M[1])},"").join("&")};function wL(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function TE(a,h,_){if(!h)return a;const w=_&&_.encode||wL;vt.isFunction(_)&&(_={serialize:_});const M=_&&_.serialize;let D;if(M?D=M(h,_):D=vt.isURLSearchParams(h)?h.toString():new pv(h,_).toString(w),D){const B=a.indexOf("#");B!==-1&&(a=a.slice(0,B)),a+=(a.indexOf("?")===-1?"?":"&")+D}return a}class k1{constructor(){this.handlers=[]}use(h,_,w){return this.handlers.push({fulfilled:h,rejected:_,synchronous:w?w.synchronous:!1,runWhen:w?w.runWhen:null}),this.handlers.length-1}eject(h){this.handlers[h]&&(this.handlers[h]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(h){vt.forEach(this.handlers,function(w){w!==null&&h(w)})}}const EE={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},TL=typeof URLSearchParams<"u"?URLSearchParams:pv,EL=typeof FormData<"u"?FormData:null,SL=typeof Blob<"u"?Blob:null,AL={isBrowser:!0,classes:{URLSearchParams:TL,FormData:EL,Blob:SL},protocols:["http","https","file","blob","url","data"]},fv=typeof window<"u"&&typeof document<"u",I0=typeof navigator=="object"&&navigator||void 0,ML=fv&&(!I0||["ReactNative","NativeScript","NS"].indexOf(I0.product)<0),CL=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",kL=fv&&window.location.href||"http://localhost",PL=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:fv,hasStandardBrowserEnv:ML,hasStandardBrowserWebWorkerEnv:CL,navigator:I0,origin:kL},Symbol.toStringTag,{value:"Module"})),Zn={...PL,...AL};function IL(a,h){return Ay(a,new Zn.classes.URLSearchParams,Object.assign({visitor:function(_,w,M,D){return Zn.isNode&&vt.isBuffer(_)?(this.append(w,_.toString("base64")),!1):D.defaultVisitor.apply(this,arguments)}},h))}function LL(a){return vt.matchAll(/\w+|\[(\w*)]/g,a).map(h=>h[0]==="[]"?"":h[1]||h[0])}function DL(a){const h={},_=Object.keys(a);let w;const M=_.length;let D;for(w=0;w<M;w++)D=_[w],h[D]=a[D];return h}function SE(a){function h(_,w,M,D){let B=_[D++];if(B==="__proto__")return!0;const q=Number.isFinite(+B),o=D>=_.length;return B=!B&&vt.isArray(M)?M.length:B,o?(vt.hasOwnProp(M,B)?M[B]=[M[B],w]:M[B]=w,!q):((!M[B]||!vt.isObject(M[B]))&&(M[B]=[]),h(_,w,M[B],D)&&vt.isArray(M[B])&&(M[B]=DL(M[B])),!q)}if(vt.isFormData(a)&&vt.isFunction(a.entries)){const _={};return vt.forEachEntry(a,(w,M)=>{h(LL(w),M,_,0)}),_}return null}function RL(a,h,_){if(vt.isString(a))try{return(h||JSON.parse)(a),vt.trim(a)}catch(w){if(w.name!=="SyntaxError")throw w}return(_||JSON.stringify)(a)}const ug={transitional:EE,adapter:["xhr","http","fetch"],transformRequest:[function(h,_){const w=_.getContentType()||"",M=w.indexOf("application/json")>-1,D=vt.isObject(h);if(D&&vt.isHTMLForm(h)&&(h=new FormData(h)),vt.isFormData(h))return M?JSON.stringify(SE(h)):h;if(vt.isArrayBuffer(h)||vt.isBuffer(h)||vt.isStream(h)||vt.isFile(h)||vt.isBlob(h)||vt.isReadableStream(h))return h;if(vt.isArrayBufferView(h))return h.buffer;if(vt.isURLSearchParams(h))return _.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),h.toString();let q;if(D){if(w.indexOf("application/x-www-form-urlencoded")>-1)return IL(h,this.formSerializer).toString();if((q=vt.isFileList(h))||w.indexOf("multipart/form-data")>-1){const o=this.env&&this.env.FormData;return Ay(q?{"files[]":h}:h,o&&new o,this.formSerializer)}}return D||M?(_.setContentType("application/json",!1),RL(h)):h}],transformResponse:[function(h){const _=this.transitional||ug.transitional,w=_&&_.forcedJSONParsing,M=this.responseType==="json";if(vt.isResponse(h)||vt.isReadableStream(h))return h;if(h&&vt.isString(h)&&(w&&!this.responseType||M)){const B=!(_&&_.silentJSONParsing)&&M;try{return JSON.parse(h)}catch(q){if(B)throw q.name==="SyntaxError"?cr.from(q,cr.ERR_BAD_RESPONSE,this,null,this.response):q}}return h}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Zn.classes.FormData,Blob:Zn.classes.Blob},validateStatus:function(h){return h>=200&&h<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};vt.forEach(["delete","get","head","post","put","patch"],a=>{ug.headers[a]={}});const zL=vt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),OL=a=>{const h={};let _,w,M;return a&&a.split(`
`).forEach(function(B){M=B.indexOf(":"),_=B.substring(0,M).trim().toLowerCase(),w=B.substring(M+1).trim(),!(!_||h[_]&&zL[_])&&(_==="set-cookie"?h[_]?h[_].push(w):h[_]=[w]:h[_]=h[_]?h[_]+", "+w:w)}),h},P1=Symbol("internals");function Lm(a){return a&&String(a).trim().toLowerCase()}function D_(a){return a===!1||a==null?a:vt.isArray(a)?a.map(D_):String(a)}function BL(a){const h=Object.create(null),_=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let w;for(;w=_.exec(a);)h[w[1]]=w[2];return h}const FL=a=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(a.trim());function e0(a,h,_,w,M){if(vt.isFunction(w))return w.call(this,h,_);if(M&&(h=_),!!vt.isString(h)){if(vt.isString(w))return h.indexOf(w)!==-1;if(vt.isRegExp(w))return w.test(h)}}function NL(a){return a.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(h,_,w)=>_.toUpperCase()+w)}function UL(a,h){const _=vt.toCamelCase(" "+h);["get","set","has"].forEach(w=>{Object.defineProperty(a,w+_,{value:function(M,D,B){return this[w].call(this,h,M,D,B)},configurable:!0})})}let Vo=class{constructor(h){h&&this.set(h)}set(h,_,w){const M=this;function D(q,o,X){const ie=Lm(o);if(!ie)throw new Error("header name must be a non-empty string");const oe=vt.findKey(M,ie);(!oe||M[oe]===void 0||X===!0||X===void 0&&M[oe]!==!1)&&(M[oe||o]=D_(q))}const B=(q,o)=>vt.forEach(q,(X,ie)=>D(X,ie,o));if(vt.isPlainObject(h)||h instanceof this.constructor)B(h,_);else if(vt.isString(h)&&(h=h.trim())&&!FL(h))B(OL(h),_);else if(vt.isHeaders(h))for(const[q,o]of h.entries())D(o,q,w);else h!=null&&D(_,h,w);return this}get(h,_){if(h=Lm(h),h){const w=vt.findKey(this,h);if(w){const M=this[w];if(!_)return M;if(_===!0)return BL(M);if(vt.isFunction(_))return _.call(this,M,w);if(vt.isRegExp(_))return _.exec(M);throw new TypeError("parser must be boolean|regexp|function")}}}has(h,_){if(h=Lm(h),h){const w=vt.findKey(this,h);return!!(w&&this[w]!==void 0&&(!_||e0(this,this[w],w,_)))}return!1}delete(h,_){const w=this;let M=!1;function D(B){if(B=Lm(B),B){const q=vt.findKey(w,B);q&&(!_||e0(w,w[q],q,_))&&(delete w[q],M=!0)}}return vt.isArray(h)?h.forEach(D):D(h),M}clear(h){const _=Object.keys(this);let w=_.length,M=!1;for(;w--;){const D=_[w];(!h||e0(this,this[D],D,h,!0))&&(delete this[D],M=!0)}return M}normalize(h){const _=this,w={};return vt.forEach(this,(M,D)=>{const B=vt.findKey(w,D);if(B){_[B]=D_(M),delete _[D];return}const q=h?NL(D):String(D).trim();q!==D&&delete _[D],_[q]=D_(M),w[q]=!0}),this}concat(...h){return this.constructor.concat(this,...h)}toJSON(h){const _=Object.create(null);return vt.forEach(this,(w,M)=>{w!=null&&w!==!1&&(_[M]=h&&vt.isArray(w)?w.join(", "):w)}),_}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([h,_])=>h+": "+_).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(h){return h instanceof this?h:new this(h)}static concat(h,..._){const w=new this(h);return _.forEach(M=>w.set(M)),w}static accessor(h){const w=(this[P1]=this[P1]={accessors:{}}).accessors,M=this.prototype;function D(B){const q=Lm(B);w[q]||(UL(M,B),w[q]=!0)}return vt.isArray(h)?h.forEach(D):D(h),this}};Vo.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);vt.reduceDescriptors(Vo.prototype,({value:a},h)=>{let _=h[0].toUpperCase()+h.slice(1);return{get:()=>a,set(w){this[_]=w}}});vt.freezeMethods(Vo);function t0(a,h){const _=this||ug,w=h||_,M=Vo.from(w.headers);let D=w.data;return vt.forEach(a,function(q){D=q.call(_,D,M.normalize(),h?h.status:void 0)}),M.normalize(),D}function AE(a){return!!(a&&a.__CANCEL__)}function Af(a,h,_){cr.call(this,a??"canceled",cr.ERR_CANCELED,h,_),this.name="CanceledError"}vt.inherits(Af,cr,{__CANCEL__:!0});function ME(a,h,_){const w=_.config.validateStatus;!_.status||!w||w(_.status)?a(_):h(new cr("Request failed with status code "+_.status,[cr.ERR_BAD_REQUEST,cr.ERR_BAD_RESPONSE][Math.floor(_.status/100)-4],_.config,_.request,_))}function jL(a){const h=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return h&&h[1]||""}function VL(a,h){a=a||10;const _=new Array(a),w=new Array(a);let M=0,D=0,B;return h=h!==void 0?h:1e3,function(o){const X=Date.now(),ie=w[D];B||(B=X),_[M]=o,w[M]=X;let oe=D,xe=0;for(;oe!==M;)xe+=_[oe++],oe=oe%a;if(M=(M+1)%a,M===D&&(D=(D+1)%a),X-B<h)return;const Te=ie&&X-ie;return Te?Math.round(xe*1e3/Te):void 0}}function GL(a,h){let _=0,w=1e3/h,M,D;const B=(X,ie=Date.now())=>{_=ie,M=null,D&&(clearTimeout(D),D=null),a.apply(null,X)};return[(...X)=>{const ie=Date.now(),oe=ie-_;oe>=w?B(X,ie):(M=X,D||(D=setTimeout(()=>{D=null,B(M)},w-oe)))},()=>M&&B(M)]}const K_=(a,h,_=3)=>{let w=0;const M=VL(50,250);return GL(D=>{const B=D.loaded,q=D.lengthComputable?D.total:void 0,o=B-w,X=M(o),ie=B<=q;w=B;const oe={loaded:B,total:q,progress:q?B/q:void 0,bytes:o,rate:X||void 0,estimated:X&&q&&ie?(q-B)/X:void 0,event:D,lengthComputable:q!=null,[h?"download":"upload"]:!0};a(oe)},_)},I1=(a,h)=>{const _=a!=null;return[w=>h[0]({lengthComputable:_,total:a,loaded:w}),h[1]]},L1=a=>(...h)=>vt.asap(()=>a(...h)),$L=Zn.hasStandardBrowserEnv?((a,h)=>_=>(_=new URL(_,Zn.origin),a.protocol===_.protocol&&a.host===_.host&&(h||a.port===_.port)))(new URL(Zn.origin),Zn.navigator&&/(msie|trident)/i.test(Zn.navigator.userAgent)):()=>!0,WL=Zn.hasStandardBrowserEnv?{write(a,h,_,w,M,D){const B=[a+"="+encodeURIComponent(h)];vt.isNumber(_)&&B.push("expires="+new Date(_).toGMTString()),vt.isString(w)&&B.push("path="+w),vt.isString(M)&&B.push("domain="+M),D===!0&&B.push("secure"),document.cookie=B.join("; ")},read(a){const h=document.cookie.match(new RegExp("(^|;\\s*)("+a+")=([^;]*)"));return h?decodeURIComponent(h[3]):null},remove(a){this.write(a,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function HL(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}function qL(a,h){return h?a.replace(/\/?\/$/,"")+"/"+h.replace(/^\/+/,""):a}function CE(a,h,_){let w=!HL(h);return a&&(w||_==!1)?qL(a,h):h}const D1=a=>a instanceof Vo?{...a}:a;function $d(a,h){h=h||{};const _={};function w(X,ie,oe,xe){return vt.isPlainObject(X)&&vt.isPlainObject(ie)?vt.merge.call({caseless:xe},X,ie):vt.isPlainObject(ie)?vt.merge({},ie):vt.isArray(ie)?ie.slice():ie}function M(X,ie,oe,xe){if(vt.isUndefined(ie)){if(!vt.isUndefined(X))return w(void 0,X,oe,xe)}else return w(X,ie,oe,xe)}function D(X,ie){if(!vt.isUndefined(ie))return w(void 0,ie)}function B(X,ie){if(vt.isUndefined(ie)){if(!vt.isUndefined(X))return w(void 0,X)}else return w(void 0,ie)}function q(X,ie,oe){if(oe in h)return w(X,ie);if(oe in a)return w(void 0,X)}const o={url:D,method:D,data:D,baseURL:B,transformRequest:B,transformResponse:B,paramsSerializer:B,timeout:B,timeoutMessage:B,withCredentials:B,withXSRFToken:B,adapter:B,responseType:B,xsrfCookieName:B,xsrfHeaderName:B,onUploadProgress:B,onDownloadProgress:B,decompress:B,maxContentLength:B,maxBodyLength:B,beforeRedirect:B,transport:B,httpAgent:B,httpsAgent:B,cancelToken:B,socketPath:B,responseEncoding:B,validateStatus:q,headers:(X,ie,oe)=>M(D1(X),D1(ie),oe,!0)};return vt.forEach(Object.keys(Object.assign({},a,h)),function(ie){const oe=o[ie]||M,xe=oe(a[ie],h[ie],ie);vt.isUndefined(xe)&&oe!==q||(_[ie]=xe)}),_}const kE=a=>{const h=$d({},a);let{data:_,withXSRFToken:w,xsrfHeaderName:M,xsrfCookieName:D,headers:B,auth:q}=h;h.headers=B=Vo.from(B),h.url=TE(CE(h.baseURL,h.url,h.allowAbsoluteUrls),a.params,a.paramsSerializer),q&&B.set("Authorization","Basic "+btoa((q.username||"")+":"+(q.password?unescape(encodeURIComponent(q.password)):"")));let o;if(vt.isFormData(_)){if(Zn.hasStandardBrowserEnv||Zn.hasStandardBrowserWebWorkerEnv)B.setContentType(void 0);else if((o=B.getContentType())!==!1){const[X,...ie]=o?o.split(";").map(oe=>oe.trim()).filter(Boolean):[];B.setContentType([X||"multipart/form-data",...ie].join("; "))}}if(Zn.hasStandardBrowserEnv&&(w&&vt.isFunction(w)&&(w=w(h)),w||w!==!1&&$L(h.url))){const X=M&&D&&WL.read(D);X&&B.set(M,X)}return h},XL=typeof XMLHttpRequest<"u",ZL=XL&&function(a){return new Promise(function(_,w){const M=kE(a);let D=M.data;const B=Vo.from(M.headers).normalize();let{responseType:q,onUploadProgress:o,onDownloadProgress:X}=M,ie,oe,xe,Te,je;function We(){Te&&Te(),je&&je(),M.cancelToken&&M.cancelToken.unsubscribe(ie),M.signal&&M.signal.removeEventListener("abort",ie)}let pt=new XMLHttpRequest;pt.open(M.method.toUpperCase(),M.url,!0),pt.timeout=M.timeout;function yt(){if(!pt)return;const Ae=Vo.from("getAllResponseHeaders"in pt&&pt.getAllResponseHeaders()),He={data:!q||q==="text"||q==="json"?pt.responseText:pt.response,status:pt.status,statusText:pt.statusText,headers:Ae,config:a,request:pt};ME(function(kt){_(kt),We()},function(kt){w(kt),We()},He),pt=null}"onloadend"in pt?pt.onloadend=yt:pt.onreadystatechange=function(){!pt||pt.readyState!==4||pt.status===0&&!(pt.responseURL&&pt.responseURL.indexOf("file:")===0)||setTimeout(yt)},pt.onabort=function(){pt&&(w(new cr("Request aborted",cr.ECONNABORTED,a,pt)),pt=null)},pt.onerror=function(){w(new cr("Network Error",cr.ERR_NETWORK,a,pt)),pt=null},pt.ontimeout=function(){let Be=M.timeout?"timeout of "+M.timeout+"ms exceeded":"timeout exceeded";const He=M.transitional||EE;M.timeoutErrorMessage&&(Be=M.timeoutErrorMessage),w(new cr(Be,He.clarifyTimeoutError?cr.ETIMEDOUT:cr.ECONNABORTED,a,pt)),pt=null},D===void 0&&B.setContentType(null),"setRequestHeader"in pt&&vt.forEach(B.toJSON(),function(Be,He){pt.setRequestHeader(He,Be)}),vt.isUndefined(M.withCredentials)||(pt.withCredentials=!!M.withCredentials),q&&q!=="json"&&(pt.responseType=M.responseType),X&&([xe,je]=K_(X,!0),pt.addEventListener("progress",xe)),o&&pt.upload&&([oe,Te]=K_(o),pt.upload.addEventListener("progress",oe),pt.upload.addEventListener("loadend",Te)),(M.cancelToken||M.signal)&&(ie=Ae=>{pt&&(w(!Ae||Ae.type?new Af(null,a,pt):Ae),pt.abort(),pt=null)},M.cancelToken&&M.cancelToken.subscribe(ie),M.signal&&(M.signal.aborted?ie():M.signal.addEventListener("abort",ie)));const Ze=jL(M.url);if(Ze&&Zn.protocols.indexOf(Ze)===-1){w(new cr("Unsupported protocol "+Ze+":",cr.ERR_BAD_REQUEST,a));return}pt.send(D||null)})},YL=(a,h)=>{const{length:_}=a=a?a.filter(Boolean):[];if(h||_){let w=new AbortController,M;const D=function(X){if(!M){M=!0,q();const ie=X instanceof Error?X:this.reason;w.abort(ie instanceof cr?ie:new Af(ie instanceof Error?ie.message:ie))}};let B=h&&setTimeout(()=>{B=null,D(new cr(`timeout ${h} of ms exceeded`,cr.ETIMEDOUT))},h);const q=()=>{a&&(B&&clearTimeout(B),B=null,a.forEach(X=>{X.unsubscribe?X.unsubscribe(D):X.removeEventListener("abort",D)}),a=null)};a.forEach(X=>X.addEventListener("abort",D));const{signal:o}=w;return o.unsubscribe=()=>vt.asap(q),o}},KL=function*(a,h){let _=a.byteLength;if(_<h){yield a;return}let w=0,M;for(;w<_;)M=w+h,yield a.slice(w,M),w=M},JL=async function*(a,h){for await(const _ of QL(a))yield*KL(_,h)},QL=async function*(a){if(a[Symbol.asyncIterator]){yield*a;return}const h=a.getReader();try{for(;;){const{done:_,value:w}=await h.read();if(_)break;yield w}}finally{await h.cancel()}},R1=(a,h,_,w)=>{const M=JL(a,h);let D=0,B,q=o=>{B||(B=!0,w&&w(o))};return new ReadableStream({async pull(o){try{const{done:X,value:ie}=await M.next();if(X){q(),o.close();return}let oe=ie.byteLength;if(_){let xe=D+=oe;_(xe)}o.enqueue(new Uint8Array(ie))}catch(X){throw q(X),X}},cancel(o){return q(o),M.return()}},{highWaterMark:2})},My=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",PE=My&&typeof ReadableStream=="function",eD=My&&(typeof TextEncoder=="function"?(a=>h=>a.encode(h))(new TextEncoder):async a=>new Uint8Array(await new Response(a).arrayBuffer())),IE=(a,...h)=>{try{return!!a(...h)}catch{return!1}},tD=PE&&IE(()=>{let a=!1;const h=new Request(Zn.origin,{body:new ReadableStream,method:"POST",get duplex(){return a=!0,"half"}}).headers.has("Content-Type");return a&&!h}),z1=64*1024,L0=PE&&IE(()=>vt.isReadableStream(new Response("").body)),J_={stream:L0&&(a=>a.body)};My&&(a=>{["text","arrayBuffer","blob","formData","stream"].forEach(h=>{!J_[h]&&(J_[h]=vt.isFunction(a[h])?_=>_[h]():(_,w)=>{throw new cr(`Response type '${h}' is not supported`,cr.ERR_NOT_SUPPORT,w)})})})(new Response);const iD=async a=>{if(a==null)return 0;if(vt.isBlob(a))return a.size;if(vt.isSpecCompliantForm(a))return(await new Request(Zn.origin,{method:"POST",body:a}).arrayBuffer()).byteLength;if(vt.isArrayBufferView(a)||vt.isArrayBuffer(a))return a.byteLength;if(vt.isURLSearchParams(a)&&(a=a+""),vt.isString(a))return(await eD(a)).byteLength},rD=async(a,h)=>{const _=vt.toFiniteNumber(a.getContentLength());return _??iD(h)},sD=My&&(async a=>{let{url:h,method:_,data:w,signal:M,cancelToken:D,timeout:B,onDownloadProgress:q,onUploadProgress:o,responseType:X,headers:ie,withCredentials:oe="same-origin",fetchOptions:xe}=kE(a);X=X?(X+"").toLowerCase():"text";let Te=YL([M,D&&D.toAbortSignal()],B),je;const We=Te&&Te.unsubscribe&&(()=>{Te.unsubscribe()});let pt;try{if(o&&tD&&_!=="get"&&_!=="head"&&(pt=await rD(ie,w))!==0){let He=new Request(h,{method:"POST",body:w,duplex:"half"}),lt;if(vt.isFormData(w)&&(lt=He.headers.get("content-type"))&&ie.setContentType(lt),He.body){const[kt,Ne]=I1(pt,K_(L1(o)));w=R1(He.body,z1,kt,Ne)}}vt.isString(oe)||(oe=oe?"include":"omit");const yt="credentials"in Request.prototype;je=new Request(h,{...xe,signal:Te,method:_.toUpperCase(),headers:ie.normalize().toJSON(),body:w,duplex:"half",credentials:yt?oe:void 0});let Ze=await fetch(je);const Ae=L0&&(X==="stream"||X==="response");if(L0&&(q||Ae&&We)){const He={};["status","statusText","headers"].forEach(ht=>{He[ht]=Ze[ht]});const lt=vt.toFiniteNumber(Ze.headers.get("content-length")),[kt,Ne]=q&&I1(lt,K_(L1(q),!0))||[];Ze=new Response(R1(Ze.body,z1,kt,()=>{Ne&&Ne(),We&&We()}),He)}X=X||"text";let Be=await J_[vt.findKey(J_,X)||"text"](Ze,a);return!Ae&&We&&We(),await new Promise((He,lt)=>{ME(He,lt,{data:Be,headers:Vo.from(Ze.headers),status:Ze.status,statusText:Ze.statusText,config:a,request:je})})}catch(yt){throw We&&We(),yt&&yt.name==="TypeError"&&/fetch/i.test(yt.message)?Object.assign(new cr("Network Error",cr.ERR_NETWORK,a,je),{cause:yt.cause||yt}):cr.from(yt,yt&&yt.code,a,je)}}),D0={http:xL,xhr:ZL,fetch:sD};vt.forEach(D0,(a,h)=>{if(a){try{Object.defineProperty(a,"name",{value:h})}catch{}Object.defineProperty(a,"adapterName",{value:h})}});const O1=a=>`- ${a}`,nD=a=>vt.isFunction(a)||a===null||a===!1,LE={getAdapter:a=>{a=vt.isArray(a)?a:[a];const{length:h}=a;let _,w;const M={};for(let D=0;D<h;D++){_=a[D];let B;if(w=_,!nD(_)&&(w=D0[(B=String(_)).toLowerCase()],w===void 0))throw new cr(`Unknown adapter '${B}'`);if(w)break;M[B||"#"+D]=w}if(!w){const D=Object.entries(M).map(([q,o])=>`adapter ${q} `+(o===!1?"is not supported by the environment":"is not available in the build"));let B=h?D.length>1?`since :
`+D.map(O1).join(`
`):" "+O1(D[0]):"as no adapter specified";throw new cr("There is no suitable adapter to dispatch the request "+B,"ERR_NOT_SUPPORT")}return w},adapters:D0};function i0(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new Af(null,a)}function B1(a){return i0(a),a.headers=Vo.from(a.headers),a.data=t0.call(a,a.transformRequest),["post","put","patch"].indexOf(a.method)!==-1&&a.headers.setContentType("application/x-www-form-urlencoded",!1),LE.getAdapter(a.adapter||ug.adapter)(a).then(function(w){return i0(a),w.data=t0.call(a,a.transformResponse,w),w.headers=Vo.from(w.headers),w},function(w){return AE(w)||(i0(a),w&&w.response&&(w.response.data=t0.call(a,a.transformResponse,w.response),w.response.headers=Vo.from(w.response.headers))),Promise.reject(w)})}const DE="1.8.4",Cy={};["object","boolean","number","function","string","symbol"].forEach((a,h)=>{Cy[a]=function(w){return typeof w===a||"a"+(h<1?"n ":" ")+a}});const F1={};Cy.transitional=function(h,_,w){function M(D,B){return"[Axios v"+DE+"] Transitional option '"+D+"'"+B+(w?". "+w:"")}return(D,B,q)=>{if(h===!1)throw new cr(M(B," has been removed"+(_?" in "+_:"")),cr.ERR_DEPRECATED);return _&&!F1[B]&&(F1[B]=!0,console.warn(M(B," has been deprecated since v"+_+" and will be removed in the near future"))),h?h(D,B,q):!0}};Cy.spelling=function(h){return(_,w)=>(console.warn(`${w} is likely a misspelling of ${h}`),!0)};function oD(a,h,_){if(typeof a!="object")throw new cr("options must be an object",cr.ERR_BAD_OPTION_VALUE);const w=Object.keys(a);let M=w.length;for(;M-- >0;){const D=w[M],B=h[D];if(B){const q=a[D],o=q===void 0||B(q,D,a);if(o!==!0)throw new cr("option "+D+" must be "+o,cr.ERR_BAD_OPTION_VALUE);continue}if(_!==!0)throw new cr("Unknown option "+D,cr.ERR_BAD_OPTION)}}const R_={assertOptions:oD,validators:Cy},Ql=R_.validators;let jd=class{constructor(h){this.defaults=h,this.interceptors={request:new k1,response:new k1}}async request(h,_){try{return await this._request(h,_)}catch(w){if(w instanceof Error){let M={};Error.captureStackTrace?Error.captureStackTrace(M):M=new Error;const D=M.stack?M.stack.replace(/^.+\n/,""):"";try{w.stack?D&&!String(w.stack).endsWith(D.replace(/^.+\n.+\n/,""))&&(w.stack+=`
`+D):w.stack=D}catch{}}throw w}}_request(h,_){typeof h=="string"?(_=_||{},_.url=h):_=h||{},_=$d(this.defaults,_);const{transitional:w,paramsSerializer:M,headers:D}=_;w!==void 0&&R_.assertOptions(w,{silentJSONParsing:Ql.transitional(Ql.boolean),forcedJSONParsing:Ql.transitional(Ql.boolean),clarifyTimeoutError:Ql.transitional(Ql.boolean)},!1),M!=null&&(vt.isFunction(M)?_.paramsSerializer={serialize:M}:R_.assertOptions(M,{encode:Ql.function,serialize:Ql.function},!0)),_.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?_.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:_.allowAbsoluteUrls=!0),R_.assertOptions(_,{baseUrl:Ql.spelling("baseURL"),withXsrfToken:Ql.spelling("withXSRFToken")},!0),_.method=(_.method||this.defaults.method||"get").toLowerCase();let B=D&&vt.merge(D.common,D[_.method]);D&&vt.forEach(["delete","get","head","post","put","patch","common"],je=>{delete D[je]}),_.headers=Vo.concat(B,D);const q=[];let o=!0;this.interceptors.request.forEach(function(We){typeof We.runWhen=="function"&&We.runWhen(_)===!1||(o=o&&We.synchronous,q.unshift(We.fulfilled,We.rejected))});const X=[];this.interceptors.response.forEach(function(We){X.push(We.fulfilled,We.rejected)});let ie,oe=0,xe;if(!o){const je=[B1.bind(this),void 0];for(je.unshift.apply(je,q),je.push.apply(je,X),xe=je.length,ie=Promise.resolve(_);oe<xe;)ie=ie.then(je[oe++],je[oe++]);return ie}xe=q.length;let Te=_;for(oe=0;oe<xe;){const je=q[oe++],We=q[oe++];try{Te=je(Te)}catch(pt){We.call(this,pt);break}}try{ie=B1.call(this,Te)}catch(je){return Promise.reject(je)}for(oe=0,xe=X.length;oe<xe;)ie=ie.then(X[oe++],X[oe++]);return ie}getUri(h){h=$d(this.defaults,h);const _=CE(h.baseURL,h.url,h.allowAbsoluteUrls);return TE(_,h.params,h.paramsSerializer)}};vt.forEach(["delete","get","head","options"],function(h){jd.prototype[h]=function(_,w){return this.request($d(w||{},{method:h,url:_,data:(w||{}).data}))}});vt.forEach(["post","put","patch"],function(h){function _(w){return function(D,B,q){return this.request($d(q||{},{method:h,headers:w?{"Content-Type":"multipart/form-data"}:{},url:D,data:B}))}}jd.prototype[h]=_(),jd.prototype[h+"Form"]=_(!0)});let aD=class RE{constructor(h){if(typeof h!="function")throw new TypeError("executor must be a function.");let _;this.promise=new Promise(function(D){_=D});const w=this;this.promise.then(M=>{if(!w._listeners)return;let D=w._listeners.length;for(;D-- >0;)w._listeners[D](M);w._listeners=null}),this.promise.then=M=>{let D;const B=new Promise(q=>{w.subscribe(q),D=q}).then(M);return B.cancel=function(){w.unsubscribe(D)},B},h(function(D,B,q){w.reason||(w.reason=new Af(D,B,q),_(w.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(h){if(this.reason){h(this.reason);return}this._listeners?this._listeners.push(h):this._listeners=[h]}unsubscribe(h){if(!this._listeners)return;const _=this._listeners.indexOf(h);_!==-1&&this._listeners.splice(_,1)}toAbortSignal(){const h=new AbortController,_=w=>{h.abort(w)};return this.subscribe(_),h.signal.unsubscribe=()=>this.unsubscribe(_),h.signal}static source(){let h;return{token:new RE(function(M){h=M}),cancel:h}}};function lD(a){return function(_){return a.apply(null,_)}}function cD(a){return vt.isObject(a)&&a.isAxiosError===!0}const R0={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(R0).forEach(([a,h])=>{R0[h]=a});function zE(a){const h=new jd(a),_=dE(jd.prototype.request,h);return vt.extend(_,jd.prototype,h,{allOwnKeys:!0}),vt.extend(_,h,null,{allOwnKeys:!0}),_.create=function(M){return zE($d(a,M))},_}const bs=zE(ug);bs.Axios=jd;bs.CanceledError=Af;bs.CancelToken=aD;bs.isCancel=AE;bs.VERSION=DE;bs.toFormData=Ay;bs.AxiosError=cr;bs.Cancel=bs.CanceledError;bs.all=function(h){return Promise.all(h)};bs.spread=lD;bs.isAxiosError=cD;bs.mergeConfig=$d;bs.AxiosHeaders=Vo;bs.formToJSON=a=>SE(vt.isHTMLForm(a)?new FormData(a):a);bs.getAdapter=LE.getAdapter;bs.HttpStatusCode=R0;bs.default=bs;const{Axios:xR,AxiosError:vR,CanceledError:bR,isCancel:wR,CancelToken:TR,VERSION:ER,all:SR,Cancel:AR,isAxiosError:MR,spread:CR,toFormData:kR,AxiosHeaders:PR,HttpStatusCode:IR,formToJSON:LR,getAdapter:DR,mergeConfig:RR}=bs,hD={class:"flex items-center justify-between bg-white p-4 rounded-lg shadow"},uD={class:"truncate font-medium"},dD=["href"],pD=ln({__name:"ResourceCard",props:{resource:{}},setup(a){return(h,_)=>(Di(),Yi("div",hD,[It("span",uD,zs(h.resource.filename),1),It("a",{href:h.resource.url,download:"",class:"ml-4 text-blue-600 hover:underline"}," Download ",8,dD)]))}}),fD=yo(pD,[["__scopeId","data-v-e834b7f8"]]),mD={class:"resources-view container mx-auto p-6"},gD={class:"upload-section mb-8"},_D=["disabled"],yD={class:"files-list"},xD={key:0,class:"text-gray-500"},vD={key:1,class:"space-y-4"},bD=ln({__name:"ResourcesView",setup(a){const h=Kr([]),_=Kr(null);async function w(){try{const B=await bs.get("http://127.0.0.1:8000/api/v1/resources/files");h.value=B.data.map(q=>({filename:q,url:`http://127.0.0.1:8000/api/v1/resources/files/${encodeURIComponent(q)}`}))}catch(B){console.error("Failed to fetch files",B)}}function M(B){var o;const q=B.target;_.value=((o=q.files)==null?void 0:o[0])||null}async function D(){if(!_.value)return;const B=new FormData;B.append("file",_.value);try{await bs.post("http://127.0.0.1:8000/api/v1/resources/upload",B,{headers:{"Content-Type":"multipart/form-data"}}),_.value=null,await w()}catch(q){console.error("Upload failed",q)}}return lc(w),(B,q)=>(Di(),Yi("div",mD,[q[2]||(q[2]=It("h1",{class:"text-3xl font-bold mb-6"},"Resources",-1)),It("section",gD,[q[0]||(q[0]=It("h2",{class:"text-xl font-semibold mb-4"},"Upload a File",-1)),It("input",{type:"file",onChange:M,class:"block w-full text-sm text-gray-600 file:py-2 file:px-4 file:border-0 file:rounded-lg file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),It("button",{onClick:D,disabled:!_.value,class:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50"}," Upload ",8,_D)]),It("section",yD,[q[1]||(q[1]=It("h2",{class:"text-xl font-semibold mb-4"},"Available Files",-1)),h.value.length===0?(Di(),Yi("div",xD,"No files uploaded yet.")):(Di(),Yi("div",vD,[(Di(!0),Yi(es,null,hl(h.value,o=>(Di(),ff(fD,{key:o.filename,resource:o},null,8,["resource"]))),128))]))])]))}}),wD=yo(bD,[["__scopeId","data-v-e1dc2f06"]]),TD="/projects/soil_values/assets/about-hero-BXZVnN9R.jpg",ED={class:"about-page-container"},SD={class:"about-view space-y-16 px-6 py-8 lg:px-16 lg:py-12"},AD={class:"hero text-center space-y-6"},MD=["src"],CD={class:"mission-section bg-gradient-to-r from-indigo-50 to-white rounded-2xl p-10 grid md:grid-cols-2 gap-10 items-center"},kD={class:"relative"},PD=["src"],ID={class:"objectives-section text-center max-w-5xl mx-auto space-y-8"},LD={class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-8"},DD={class:"font-semibold text-gray-900 mb-3 text-lg"},RD={class:"text-gray-600"},zD={class:"features-section bg-white rounded-2xl p-10 space-y-6 shadow-inner"},OD={class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-8 mt-6"},BD={class:"font-medium text-gray-900 mb-2"},FD={class:"text-gray-600"},ND={__name:"AboutView",setup(a){const h=[{title:"Centralized Data Hub",description:"All soil & spatial data in one PostGIS-backed repository."},{title:"Evidence-Based Decisions",description:"Visualize fertility, erosion & climate risk models."},{title:"Mobile-First Design",description:"Offline-capable field data entry & fast load times."},{title:"API & Integration",description:"Open endpoints for custom apps & M&E systems."},{title:"Predictive Analytics",description:"AI-driven scenario planning and forecasts."},{title:"Collaborative Platform",description:"Shared workspace for stakeholders & partners."}],_=[{title:"Interactive Mapping",description:"Layered GIS viewer for soil, land-use & cover."},{title:"Time-Series Analysis",description:"Track landscape changes over decades."},{title:"Custom Reporting",description:"Exportable M&E dashboards & reports."},{title:"Mobile Uploads",description:"Real-time survey & sensor data from the field."},{title:"User Management",description:"Role-based access for Knowledge Partners & MEL teams."},{title:"Data Export",description:"High-res maps and raw data downloads."}];return(w,M)=>(Di(),Yi("div",ED,[It("section",SD,[It("div",AD,[M[0]||(M[0]=It("h1",{class:"text-5xl font-extrabold text-indigo-800 leading-tight"},[jo(" Transforming Soil Health"),It("br",{class:"hidden sm:block"}),jo(" Across West Africa ")],-1)),M[1]||(M[1]=It("p",{class:"text-xl text-gray-700 max-w-3xl mx-auto"}," The Soil Values GeoPortal delivers powerful, data-driven tools to support communities, researchers, and policymakers in the Sahel region. ",-1)),It("img",{src:oc(TD),alt:"Community members working in fields",class:"mx-auto rounded-2xl shadow-2xl object-cover",style:{width:"25%",height:"20%"}},null,8,MD)]),It("div",CD,[M[3]||(M[3]=It("div",{class:"space-y-5"},[It("h2",{class:"text-3xl font-semibold text-indigo-900"},"Our Mission & Scope"),It("p",{class:"text-gray-700 leading-relaxed"}," Serving Burkina Faso, Mali, Niger, and Nigeria across nine key watersheds, we blend Integrated Soil Fertility Management, community-driven planning, and real-time data to fight land degradation. "),It("ul",{class:"list-disc list-inside text-gray-700 space-y-2 pl-4"},[It("li",null,"Integrated Soil Fertility Management"),It("li",null,"Community-driven Watershed Planning"),It("li",null,"Evidence-Based Decision Support")])],-1)),It("div",kD,[It("img",{src:w.coverageMap,alt:"Watershed coverage map",class:"rounded-2xl border border-gray-200 w-full shadow",style:{width:"25%",height:"20%"}},null,8,PD),M[2]||(M[2]=It("span",{class:"absolute bottom-4 right-4 bg-white px-4 py-1 rounded-tl-lg text-sm font-medium text-gray-600 border-l border-t border-gray-200 shadow-sm"}," 9 Watersheds  4 Countries ",-1))])]),It("div",ID,[M[4]||(M[4]=It("h2",{class:"text-3xl font-semibold text-indigo-900"},"Key Objectives",-1)),It("div",LD,[(Di(),Yi(es,null,hl(h,(D,B)=>It("div",{key:B,class:"objective-card bg-white rounded-xl p-8 shadow-lg border-l-4 border-indigo-500 hover:-translate-y-2 transition-transform"},[It("h3",DD,zs(D.title),1),It("p",RD,zs(D.description),1)])),64))])]),It("div",zD,[M[5]||(M[5]=It("h2",{class:"text-3xl font-semibold text-indigo-900 text-center"},"Portal Capabilities",-1)),It("div",OD,[(Di(),Yi(es,null,hl(_,(D,B)=>It("div",{key:B,class:"feature-card bg-indigo-50 rounded-xl p-6 shadow hover:shadow-xl transition-shadow border-l-4 border-indigo-400 hover:-translate-y-1 transition-transform"},[It("h4",BD,zs(D.title),1),It("p",FD,zs(D.description),1)])),64))])]),M[6]||(M[6]=yy('<div class="data-tech-section grid md:grid-cols-2 gap-10 max-w-5xl mx-auto bg-white rounded-2xl p-10 shadow-lg" data-v-33c06634><div data-v-33c06634><h3 class="text-2xl font-semibold text-indigo-900 mb-4" data-v-33c06634>Data Sources</h3><ul class="list-disc list-inside text-gray-700 space-y-2 pl-4" data-v-33c06634><li data-v-33c06634>Esri World Light Gray Base</li><li data-v-33c06634>Esri Sentinel-2 Land Cover (2024)</li><li data-v-33c06634>CGIAR Soil Organic Carbon</li><li data-v-33c06634>WorldClim Climate Layers</li><li data-v-33c06634>National Ministry of Agriculture Soils Surveys</li></ul></div><div data-v-33c06634><h3 class="text-2xl font-semibold text-indigo-900 mb-4" data-v-33c06634>Technology Stack</h3><ul class="list-disc list-inside text-gray-700 space-y-2 pl-4" data-v-33c06634><li data-v-33c06634>Vue 3 &amp; Mapbox GL JS</li><li data-v-33c06634>Tailwind CSS</li><li data-v-33c06634>FastAPI &amp; Python</li><li data-v-33c06634>PostgreSQL /PostGIS</li><li data-v-33c06634>Docker, Kubernetes &amp; Nginx</li></ul></div></div><div class="partners-section text-center space-y-6 max-w-4xl mx-auto" data-v-33c06634><h2 class="text-3xl font-semibold text-indigo-900" data-v-33c06634>Our Partners</h2><p class="text-gray-700 leading-relaxed text-lg" data-v-33c06634> IFDC, Wageningen University &amp; Research (WUR) and SNV collaborate with AGRA, ICRAF, IITA, ISRIC &amp; IWMI to deliver world-class expertise in soil health, water management, and climate resilience. </p></div><div class="cta-section text-center space-y-6" data-v-33c06634><h3 class="text-2xl font-semibold text-indigo-800" data-v-33c06634>Ready to dive in?</h3><p class="text-gray-700 max-w-2xl mx-auto" data-v-33c06634> Explore the GeoPortal now and unlock the insights you need for sustainable soil management. </p><button class="bg-indigo-600 text-white font-semibold px-10 py-3 rounded-full hover:bg-indigo-700 transition-colors shadow-lg" data-v-33c06634> Get Started </button></div>',3))])]))}},UD=yo(ND,[["__scopeId","data-v-33c06634"]]),jD={class:"bg-white p-4 rounded-lg shadow flex flex-col md:flex-row items-start"},VD={class:"flex-1"},GD={class:"font-semibold text-lg mb-1"},$D={class:"text-sm text-gray-600 mb-2"},WD={key:0},HD=["src"],qD={key:1},XD=["href"],ZD=ln({__name:"EventCard",props:{event:{}},setup(a){const h=a,_=An(()=>h.event.url.toLowerCase().endsWith(".mp4"));return(w,M)=>(Di(),Yi("div",jD,[It("div",VD,[It("h3",GD,zs(w.event.title),1),It("p",$D,zs(w.event.date),1),_.value?(Di(),Yi("div",WD,[It("video",{src:w.event.url,controls:"",class:"w-full h-auto rounded"},null,8,HD)])):(Di(),Yi("div",qD,[It("a",{href:w.event.url,download:"",class:"text-blue-600 hover:underline"}," Download File ",8,XD)]))])]))}}),YD=yo(ZD,[["__scopeId","data-v-6a577710"]]),KD={class:"events-view container mx-auto p-6"},JD={class:"upload-event mb-8"},QD=["disabled"],eR={class:"events-list"},tR={key:0,class:"text-gray-500"},iR={key:1,class:"space-y-6"},rR=ln({__name:"EventsView",setup(a){const h=Kr([]),_=Kr(""),w=Kr(""),M=Kr(null),D=An(()=>_.value.trim()!==""&&w.value!==""&&M.value!==null);async function B(){try{const X=await bs.get("http://127.0.0.1:8000/api/v1/events/list");h.value=X.data}catch(X){console.error("Failed to fetch events",X)}}function q(X){var ie;M.value=((ie=X.target.files)==null?void 0:ie[0])||null}async function o(){if(!D.value)return;const X=new FormData;X.append("title",_.value),X.append("date",w.value),X.append("file",M.value);try{await bs.post("http://127.0.0.1:8000/api/v1/events/upload",X,{headers:{"Content-Type":"multipart/form-data"}}),_.value="",w.value="",M.value=null,await B()}catch(ie){console.error("Upload failed",ie)}}return lc(B),(X,ie)=>(Di(),Yi("div",KD,[ie[4]||(ie[4]=It("h1",{class:"text-3xl font-bold mb-6"},"Events",-1)),It("section",JD,[ie[2]||(ie[2]=It("h2",{class:"text-xl font-semibold mb-4"},"Upload Event",-1)),rc(It("input",{"onUpdate:modelValue":ie[0]||(ie[0]=oe=>_.value=oe),placeholder:"Event Title",class:"block w-full mb-2 p-2 border rounded"},null,512),[[sc,_.value]]),rc(It("input",{type:"date","onUpdate:modelValue":ie[1]||(ie[1]=oe=>w.value=oe),class:"block w-full mb-2 p-2 border rounded",q:""},null,512),[[sc,w.value]]),It("input",{type:"file",onChange:q,class:"block w-full text-sm text-gray-600 file:py-2 file:px-4 file:border-0 file:rounded-lg file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100 mb-4"},null,32),It("button",{onClick:o,disabled:!D.value,class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50"}," Upload Event ",8,QD)]),It("section",eR,[ie[3]||(ie[3]=It("h2",{class:"text-xl font-semibold mb-4"},"Upcoming Events",-1)),h.value.length===0?(Di(),Yi("div",tR," No events uploaded yet. ")):(Di(),Yi("div",iR,[(Di(!0),Yi(es,null,hl(h.value,oe=>(Di(),ff(YD,{key:oe.id,event:oe},null,8,["event"]))),128))]))])]))}}),sR=yo(rR,[["__scopeId","data-v-3a86c377"]]),nR={class:"contact-view container mx-auto p-6"},oR=["disabled"],aR={key:0,class:"text-green-600"},lR={key:1,class:"text-red-600"},cR=ln({__name:"ContactView",setup(a){const h=Kr({name:"",email:"",subject:"",message:""}),_=Kr(!1),w=Kr(!1),M=Kr(!1);async function D(){_.value=!0,w.value=!1,M.value=!1;try{await bs.post("http://127.0.0.1:8000/api/v1/contact/send",h.value),w.value=!0,h.value={name:"",email:"",subject:"",message:""}}catch(B){console.error(B),M.value=!0}finally{_.value=!1}}return(B,q)=>(Di(),Yi("div",nR,[q[8]||(q[8]=It("h1",{class:"text-3xl font-bold mb-6"},"Contact Us",-1)),It("form",{onSubmit:RT(D,["prevent"]),class:"space-y-4 max-w-lg"},[It("div",null,[q[4]||(q[4]=It("label",{class:"block text-sm font-medium mb-1"},"Name",-1)),rc(It("input",{"onUpdate:modelValue":q[0]||(q[0]=o=>h.value.name=o),type:"text",required:"",class:"w-full p-2 border rounded"},null,512),[[sc,h.value.name]])]),It("div",null,[q[5]||(q[5]=It("label",{class:"block text-sm font-medium mb-1"},"Email",-1)),rc(It("input",{"onUpdate:modelValue":q[1]||(q[1]=o=>h.value.email=o),type:"email",required:"",class:"w-full p-2 border rounded"},null,512),[[sc,h.value.email]])]),It("div",null,[q[6]||(q[6]=It("label",{class:"block text-sm font-medium mb-1"},"Subject",-1)),rc(It("input",{"onUpdate:modelValue":q[2]||(q[2]=o=>h.value.subject=o),type:"text",required:"",class:"w-full p-2 border rounded"},null,512),[[sc,h.value.subject]])]),It("div",null,[q[7]||(q[7]=It("label",{class:"block text-sm font-medium mb-1"},"Message",-1)),rc(It("textarea",{"onUpdate:modelValue":q[3]||(q[3]=o=>h.value.message=o),rows:"5",required:"",class:"w-full p-2 border rounded"},null,512),[[sc,h.value.message]])]),It("button",{type:"submit",disabled:_.value,class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50"},zs(_.value?"Sending...":"Send Message"),9,oR),w.value?(Di(),Yi("p",aR," Your message has been sent. Thank you!")):ll("",!0),M.value?(Di(),Yi("p",lR," Failed to send. Please try again.")):ll("",!0)],32)]))}}),hR=yo(cR,[["__scopeId","data-v-ffa967a6"]]),uR=[{path:"/",name:"Home",component:PP},{path:"/dashboard",name:"Dashboard",component:RI},{path:"/resources",name:"Resources",component:wD},{path:"/events",name:"Events",component:sR},{path:"/about",name:"About",component:UD},{path:"/contact",name:"Contact",component:hR}],dR=lP({history:Bk("/projects/soil_values/"),routes:uR});var OE={exports:{}},r0={exports:{}},N1;function pR(){return N1||(N1=1,function(a,h){(function(_,w){_._Highcharts=w(),a.exports=_._Highcharts})(typeof window>"u"?iE:window,()=>(()=>{var fm;let _,w;var M,D,B,q,o,X,ie,oe,xe,Te,je,We,pt,yt,Ze,Ae,Be,He,lt={};lt.d=(R,s)=>{for(var u in s)lt.o(s,u)&&!lt.o(R,u)&&Object.defineProperty(R,u,{enumerable:!0,get:s[u]})},lt.o=(R,s)=>Object.prototype.hasOwnProperty.call(R,s);var kt={};lt.d(kt,{default:()=>t_}),function(R){var s,u,p,y,x,E,S;R.SVG_NS="http://www.w3.org/2000/svg",R.product="Highcharts",R.version="12.2.0",R.win=typeof window<"u"?window:{},R.doc=R.win.document,R.svg=!!((p=(u=(s=R.doc)==null?void 0:s.createElementNS)==null?void 0:u.call(s,R.SVG_NS,"svg"))!=null&&p.createSVGRect),R.pageLang=(E=(x=(y=R.doc)==null?void 0:y.documentElement)==null?void 0:x.closest("[lang]"))==null?void 0:E.lang,R.userAgent=((S=R.win.navigator)==null?void 0:S.userAgent)||"",R.isChrome=R.win.chrome,R.isFirefox=R.userAgent.indexOf("Firefox")!==-1,R.isMS=/(edge|msie|trident)/i.test(R.userAgent)&&!R.win.opera,R.isSafari=!R.isChrome&&R.userAgent.indexOf("Safari")!==-1,R.isTouchDevice=/(Mobile|Android|Windows Phone)/.test(R.userAgent),R.isWebKit=R.userAgent.indexOf("AppleWebKit")!==-1,R.deg2rad=2*Math.PI/360,R.marginNames=["plotTop","marginRight","marginBottom","plotLeft"],R.noop=function(){},R.supportsPassiveEvents=function(){let C=!1;if(!R.isMS){let L=Object.defineProperty({},"passive",{get:function(){C=!0}});R.win.addEventListener&&R.win.removeEventListener&&(R.win.addEventListener("testPassive",R.noop,L),R.win.removeEventListener("testPassive",R.noop,L))}return C}(),R.charts=[],R.composed=[],R.dateFormats={},R.seriesTypes={},R.symbolSizes={},R.chartCount=0}(M||(M={}));let Ne=M,{charts:ht,doc:Ge,win:ai}=Ne;function Ot(R,s,u,p){let y=s?"Highcharts error":"Highcharts warning";R===32&&(R=`${y}: Deprecated member`);let x=vi(R),E=x?`${y} #${R}: www.highcharts.com/errors/${R}/`:R.toString();if(p!==void 0){let S="";x&&(E+="?"),ri(p,function(C,L){S+=`
 - ${L}: ${C}`,x&&(E+=encodeURI(L)+"="+encodeURI(C))}),E+=S}rr(Ne,"displayError",{chart:u,code:R,message:E,params:p},function(){if(s)throw Error(E);ai.console&&Ot.messages.indexOf(E)===-1&&console.warn(E)}),Ot.messages.push(E)}function jt(R,s){return parseInt(R,s||10)}function Ti(R){return typeof R=="string"}function Qi(R){let s=Object.prototype.toString.call(R);return s==="[object Array]"||s==="[object Array Iterator]"}function li(R,s){return!!R&&typeof R=="object"&&(!s||!Qi(R))}function yi(R){return li(R)&&typeof R.nodeType=="number"}function xi(R){let s=R==null?void 0:R.constructor;return!!(li(R,!0)&&!yi(R)&&(s!=null&&s.name)&&s.name!=="Object")}function vi(R){return typeof R=="number"&&!isNaN(R)&&R<1/0&&R>-1/0}function ws(R){return R!=null}function Tr(R,s,u){let p,y=Ti(s)&&!ws(u),x=(E,S)=>{ws(E)?R.setAttribute(S,E):y?(p=R.getAttribute(S))||S!=="class"||(p=R.getAttribute(S+"Name")):R.removeAttribute(S)};return Ti(s)?x(u,s):ri(s,x),p}function fr(R){return Qi(R)?R:[R]}function Ts(R,s){let u;for(u in R||(R={}),s)R[u]=s[u];return R}function br(){let R=arguments,s=R.length;for(let u=0;u<s;u++){let p=R[u];if(p!=null)return p}}function cn(R,s){Ts(R.style,s)}function Es(R){return Math.pow(10,Math.floor(Math.log(R)/Math.LN10))}function St(R,s){return R>1e14?R:parseFloat(R.toPrecision(s||14))}(Ot||(Ot={})).messages=[],Math.easeInOutSine=function(R){return-.5*(Math.cos(Math.PI*R)-1)};let ci=Array.prototype.find?function(R,s){return R.find(s)}:function(R,s){let u,p=R.length;for(u=0;u<p;u++)if(s(R[u],u))return R[u]};function ri(R,s,u){for(let p in R)Object.hasOwnProperty.call(R,p)&&s.call(u||R[p],R[p],p,R)}function fi(R,s,u){function p(E,S){let C=R.removeEventListener;C&&C.call(R,E,S,!1)}function y(E){let S,C;R.nodeName&&(s?(S={})[s]=!0:S=E,ri(S,function(L,N){if(E[N])for(C=E[N].length;C--;)p(N,E[N][C].fn)}))}let x=typeof R=="function"&&R.prototype||R;if(Object.hasOwnProperty.call(x,"hcEvents")){let E=x.hcEvents;if(s){let S=E[s]||[];u?(E[s]=S.filter(function(C){return u!==C.fn}),p(s,u)):(y(E),E[s]=[])}else y(E),delete x.hcEvents}}function rr(R,s,u,p){if(u=u||{},(Ge==null?void 0:Ge.createEvent)&&(R.dispatchEvent||R.fireEvent&&R!==Ne)){let y=Ge.createEvent("Events");y.initEvent(s,!0,!0),u=Ts(y,u),R.dispatchEvent?R.dispatchEvent(u):R.fireEvent(s,u)}else if(R.hcEvents){u.target||Ts(u,{preventDefault:function(){u.defaultPrevented=!0},target:R,type:s});let y=[],x=R,E=!1;for(;x.hcEvents;)Object.hasOwnProperty.call(x,"hcEvents")&&x.hcEvents[s]&&(y.length&&(E=!0),y.unshift.apply(y,x.hcEvents[s])),x=Object.getPrototypeOf(x);E&&y.sort((S,C)=>S.order-C.order),y.forEach(S=>{S.fn.call(R,u)===!1&&u.preventDefault()})}p&&!u.defaultPrevented&&p.call(R,u)}let gi=function(){let R=Math.random().toString(36).substring(2,9)+"-",s=0;return function(){return"highcharts-"+(_?"":R)+s++}}();ai.jQuery&&(ai.jQuery.fn.highcharts=function(){let R=[].slice.call(arguments);if(this[0])return R[0]?(new Ne[Ti(R[0])?R.shift():"Chart"](this[0],R[0],R[1]),this):ht[Tr(this[0],"data-highcharts-chart")]});let me={addEvent:function(R,s,u,p={}){let y=typeof R=="function"&&R.prototype||R;Object.hasOwnProperty.call(y,"hcEvents")||(y.hcEvents={});let x=y.hcEvents;Ne.Point&&R instanceof Ne.Point&&R.series&&R.series.chart&&(R.series.chart.runTrackerClick=!0);let E=R.addEventListener;E&&E.call(R,s,u,!!Ne.supportsPassiveEvents&&{passive:p.passive===void 0?s.indexOf("touch")!==-1:p.passive,capture:!1}),x[s]||(x[s]=[]);let S={fn:u,order:typeof p.order=="number"?p.order:1/0};return x[s].push(S),x[s].sort((C,L)=>C.order-L.order),function(){fi(R,s,u)}},arrayMax:function(R){let s=R.length,u=R[0];for(;s--;)R[s]>u&&(u=R[s]);return u},arrayMin:function(R){let s=R.length,u=R[0];for(;s--;)R[s]<u&&(u=R[s]);return u},attr:Tr,clamp:function(R,s,u){return R>s?R<u?R:u:s},clearTimeout:function(R){ws(R)&&clearTimeout(R)},correctFloat:St,createElement:function(R,s,u,p,y){let x=Ge.createElement(R);return s&&Ts(x,s),y&&cn(x,{padding:"0",border:"none",margin:"0"}),u&&cn(x,u),p&&p.appendChild(x),x},crisp:function(R,s=0,u){let p=s%2/2,y=u?-1:1;return(Math.round(R*y-p)+p)*y},css:cn,defined:ws,destroyObjectProperties:function(R,s,u){ri(R,function(p,y){p!==s&&(p!=null&&p.destroy)&&p.destroy(),(p!=null&&p.destroy||!u)&&delete R[y]})},diffObjects:function(R,s,u,p){let y={};return function x(E,S,C,L){let N=u?S:E;ri(E,function(z,j){if(!L&&p&&p.indexOf(j)>-1&&S[j]){z=fr(z),C[j]=[];for(let W=0;W<Math.max(z.length,S[j].length);W++)S[j][W]&&(z[W]===void 0?C[j][W]=S[j][W]:(C[j][W]={},x(z[W],S[j][W],C[j][W],L+1)))}else li(z,!0)&&!z.nodeType?(C[j]=Qi(z)?[]:{},x(z,S[j]||{},C[j],L+1),Object.keys(C[j]).length===0&&(j!=="colorAxis"||L!==0)&&delete C[j]):(E[j]!==S[j]||j in E&&!(j in S))&&j!=="__proto__"&&j!=="constructor"&&(C[j]=N[j])})}(R,s,y,0),y},discardElement:function(R){var s;(s=R==null?void 0:R.parentElement)==null||s.removeChild(R)},erase:function(R,s){let u=R.length;for(;u--;)if(R[u]===s){R.splice(u,1);break}},error:Ot,extend:Ts,extendClass:function(R,s){let u=function(){};return u.prototype=new R,Ts(u.prototype,s),u},find:ci,fireEvent:rr,getAlignFactor:(R="")=>({center:.5,right:1,middle:.5,bottom:1})[R]||0,getClosestDistance:function(R,s){let u,p,y,x=!s;return R.forEach(E=>{if(E.length>1)for(y=E.length-1;y>0;y--)(p=E[y]-E[y-1])<0&&!x?(s==null||s(),s=void 0):p&&(u===void 0||p<u)&&(u=p)}),u},getMagnitude:Es,getNestedProperty:function(R,s){let u=R.split(".");for(;u.length&&ws(s);){let p=u.shift();if(p===void 0||p==="__proto__")return;if(p==="this"){let x;return li(s)&&(x=s["@this"]),x??s}let y=s[p.replace(/[\\'"]/g,"")];if(!ws(y)||typeof y=="function"||typeof y.nodeType=="number"||y===ai)return;s=y}return s},getStyle:function R(s,u,p){var E;let y;if(u==="width"){let S=Math.min(s.offsetWidth,s.scrollWidth),C=(E=s.getBoundingClientRect)==null?void 0:E.call(s).width;return C<S&&C>=S-1&&(S=Math.floor(C)),Math.max(0,S-(R(s,"padding-left",!0)||0)-(R(s,"padding-right",!0)||0))}if(u==="height")return Math.max(0,Math.min(s.offsetHeight,s.scrollHeight)-(R(s,"padding-top",!0)||0)-(R(s,"padding-bottom",!0)||0));let x=ai.getComputedStyle(s,void 0);return x&&(y=x.getPropertyValue(u),br(p,u!=="opacity")&&(y=jt(y))),y},insertItem:function(R,s){let u,p=R.options.index,y=s.length;for(u=R.options.isInternal?y:0;u<y+1;u++)if(!s[u]||vi(p)&&p<br(s[u].options.index,s[u]._i)||s[u].options.isInternal){s.splice(u,0,R);break}return u},isArray:Qi,isClass:xi,isDOMElement:yi,isFunction:function(R){return typeof R=="function"},isNumber:vi,isObject:li,isString:Ti,merge:function(R,...s){let u,p=[R,...s],y={},x=function(S,C){return typeof S!="object"&&(S={}),ri(C,function(L,N){N!=="__proto__"&&N!=="constructor"&&(!li(L,!0)||xi(L)||yi(L)?S[N]=C[N]:S[N]=x(S[N]||{},L))}),S};R===!0&&(y=p[1],p=Array.prototype.slice.call(p,2));let E=p.length;for(u=0;u<E;u++)y=x(y,p[u]);return y},normalizeTickInterval:function(R,s,u,p,y){let x,E=R;u=br(u,Es(R));let S=R/u;for(!s&&(s=y?[1,1.2,1.5,2,2.5,3,4,5,6,8,10]:[1,2,2.5,5,10],p===!1&&(u===1?s=s.filter(function(C){return C%1==0}):u<=.1&&(s=[1/u]))),x=0;x<s.length&&(E=s[x],(!y||!(E*u>=R))&&(y||!(S<=(s[x]+(s[x+1]||s[x]))/2)));x++);return St(E*u,-Math.round(Math.log(.001)/Math.LN10))},objectEach:ri,offset:function(R){let s=Ge.documentElement,u=R.parentElement||R.parentNode?R.getBoundingClientRect():{top:0,left:0,width:0,height:0};return{top:u.top+(ai.pageYOffset||s.scrollTop)-(s.clientTop||0),left:u.left+(ai.pageXOffset||s.scrollLeft)-(s.clientLeft||0),width:u.width,height:u.height}},pad:function(R,s,u){return Array((s||2)+1-String(R).replace("-","").length).join(u||"0")+R},pick:br,pInt:jt,pushUnique:function(R,s){return 0>R.indexOf(s)&&!!R.push(s)},relativeLength:function(R,s,u){return/%$/.test(R)?s*parseFloat(R)/100+(u||0):parseFloat(R)},removeEvent:fi,replaceNested:function(R,...s){let u,p;do for(p of(u=R,s))R=R.replace(p[0],p[1]);while(R!==u);return R},splat:fr,stableSort:function(R,s){let u,p,y=R.length;for(p=0;p<y;p++)R[p].safeI=p;for(R.sort(function(x,E){return(u=s(x,E))===0?x.safeI-E.safeI:u}),p=0;p<y;p++)delete R[p].safeI},syncTimeout:function(R,s,u){return s>0?setTimeout(R,s,u):(R.call(0,u),-1)},timeUnits:{millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:24192e5,year:314496e5},ucfirst:function(R){return Ti(R)?R.substring(0,1).toUpperCase()+R.substring(1):String(R)},uniqueKey:gi,useSerialIds:function(R){return _=br(R,_)},wrap:function(R,s,u){let p=R[s];R[s]=function(){let y=arguments,x=this;return u.apply(this,[function(){return p.apply(x,arguments.length?arguments:y)}].concat([].slice.call(arguments)))}}},{pageLang:Ce,win:ct}=Ne,{defined:Tt,error:xt,extend:Vt,isNumber:ei,isObject:Wt,isString:qt,merge:Gt,objectEach:Ci,pad:Qt,splat:wi,timeUnits:Pi,ucfirst:er}=me,tr=Ne.isSafari&&ct.Intl&&!ct.Intl.DateTimeFormat.prototype.formatRange,sr=R=>R.main===void 0,Cs=class{constructor(R,s){this.options={timezone:"UTC"},this.variableTimezone=!1,this.Date=ct.Date,this.update(R),this.lang=s}update(R={}){this.dTLCache={},this.options=R=Gt(!0,this.options,R);let{timezoneOffset:s,useUTC:u}=R;this.Date=R.Date||ct.Date||Date;let p=R.timezone;Tt(u)&&(p=u?"UTC":void 0),s&&s%60==0&&(p="Etc/GMT"+(s>0?"+":"")+s/60),this.variableTimezone=p!=="UTC"&&(p==null?void 0:p.indexOf("Etc/GMT"))!==0,this.timezone=p,["months","shortMonths","weekdays","shortWeekdays"].forEach(y=>{let x=/months/i.test(y),E=/short/.test(y),S={timeZone:"UTC"};S[x?"month":"weekday"]=E?"short":"long",this[y]=(x?[0,1,2,3,4,5,6,7,8,9,10,11]:[3,4,5,6,7,8,9]).map(C=>this.dateFormat(S,(x?31:1)*24*36e5*C))})}toParts(R){let[s,u,p,y,x,E,S]=this.dateTimeFormat({weekday:"narrow",day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},R,"es").split(/(?:, | |\/|:)/g);return[y,+p-1,u,x,E,S,Math.floor(Number(R)||0)%1e3,"DLMXJVS".indexOf(s)].map(Number)}dateTimeFormat(R,s,u=this.options.locale||Ce){let p=JSON.stringify(R)+u;qt(R)&&(R=this.str2dtf(R));let y=this.dTLCache[p];if(!y){R.timeZone??(R.timeZone=this.timezone);try{y=new Intl.DateTimeFormat(u,R)}catch(x){/Invalid time zone/i.test(x.message)?(xt(34),R.timeZone="UTC",y=new Intl.DateTimeFormat(u,R)):xt(x.message,!1)}}return this.dTLCache[p]=y,(y==null?void 0:y.format(s))||""}str2dtf(R,s={}){let u={L:{fractionalSecondDigits:3},S:{second:"2-digit"},M:{minute:"numeric"},H:{hour:"2-digit"},k:{hour:"numeric"},E:{weekday:"narrow"},a:{weekday:"short"},A:{weekday:"long"},d:{day:"2-digit"},e:{day:"numeric"},b:{month:"short"},B:{month:"long"},m:{month:"2-digit"},o:{month:"numeric"},y:{year:"2-digit"},Y:{year:"numeric"}};return Object.keys(u).forEach(p=>{R.indexOf(p)!==-1&&Vt(s,u[p])}),s}makeTime(R,s,u=1,p=0,y,x,E){let S=this.Date.UTC(R,s,u,p,y||0,x||0,E||0);if(this.timezone!=="UTC"){let C=this.getTimezoneOffset(S);if(S+=C,[2,3,8,9,10,11].indexOf(s)!==-1&&(p<5||p>20)){let L=this.getTimezoneOffset(S);C!==L?S+=L-C:C-36e5!==this.getTimezoneOffset(S-36e5)||tr||(S-=36e5)}}return S}parse(R){if(!qt(R))return R??void 0;let s=(R=R.replace(/\//g,"-").replace(/(GMT|UTC)/,"")).indexOf("Z")>-1||/([+-][0-9]{2}):?[0-9]{2}$/.test(R),u=/^[0-9]{4}-[0-9]{2}(-[0-9]{2}|)$/.test(R);s||u||(R+="Z");let p=Date.parse(R);if(ei(p))return p+(!s||u?this.getTimezoneOffset(p):0)}getTimezoneOffset(R){if(this.timezone!=="UTC"){let[s,u,p,y,x=0]=this.dateTimeFormat({timeZoneName:"shortOffset"},R,"en").split(/(GMT|:)/).map(Number),E=-(36e5*(p+x/60));if(ei(E))return E}return 0}dateFormat(R,s,u){let p=this.lang;if(!Tt(s)||isNaN(s))return(p==null?void 0:p.invalidDate)||"";if(qt(R=R??"%Y-%m-%d %H:%M:%S")){let y,x=/%\[([a-zA-Z]+)\]/g;for(;y=x.exec(R);)R=R.replace(y[0],this.dateTimeFormat(y[1],s,p==null?void 0:p.locale))}if(qt(R)&&R.indexOf("%")!==-1){let y=this,[x,E,S,C,L,N,z,j]=this.toParts(s),W=(p==null?void 0:p.weekdays)||this.weekdays,Y=(p==null?void 0:p.shortWeekdays)||this.shortWeekdays,re=(p==null?void 0:p.months)||this.months,te=(p==null?void 0:p.shortMonths)||this.shortMonths;Ci(Vt({a:Y?Y[j]:W[j].substr(0,3),A:W[j],d:Qt(S),e:Qt(S,2," "),w:j,v:(p==null?void 0:p.weekFrom)??"",b:te[E],B:re[E],m:Qt(E+1),o:E+1,y:x.toString().substr(2,2),Y:x,H:Qt(C),k:C,I:Qt(C%12||12),l:C%12||12,M:Qt(L),p:C<12?"AM":"PM",P:C<12?"am":"pm",S:Qt(N),L:Qt(z,3)},Ne.dateFormats),function(Q,ae){if(qt(R))for(;R.indexOf("%"+ae)!==-1;)R=R.replace("%"+ae,typeof Q=="function"?Q.call(y,s):Q)})}else if(Wt(R)){let y=(this.getTimezoneOffset(s)||0)/36e5,x=this.timezone||"Etc/GMT"+(y>=0?"+":"")+y,{prefix:E="",suffix:S=""}=R;R=E+this.dateTimeFormat(Vt({timeZone:x},R),s)+S}return u?er(R):R}resolveDTLFormat(R){return Wt(R,!0)?Wt(R,!0)&&sr(R)?{main:R}:R:{main:(R=wi(R))[0],from:R[1],to:R[2]}}getDateFormat(R,s,u,p){let y=this.dateFormat("%m-%d %H:%M:%S.%L",s),x="01-01 00:00:00.000",E={millisecond:15,second:12,minute:9,hour:6,day:3},S="millisecond",C=S;for(S in Pi){if(R&&R===Pi.week&&+this.dateFormat("%w",s)===u&&y.substr(6)===x.substr(6)){S="week";break}if(R&&Pi[S]>R){S=C;break}if(E[S]&&y.substr(E[S])!==x.substr(E[S]))break;S!=="week"&&(C=S)}return this.resolveDTLFormat(p[S]).main}},{defined:Zr,extend:Bs,timeUnits:ir}=me,hn=class extends Cs{getTimeTicks(R,s,u,p){let y=this,x=[],E={},{count:S=1,unitRange:C}=R,[L,N,z,j,W,Y]=y.toParts(s),re=(s||0)%1e3,te;if(p??(p=1),Zr(s)){if(re=C>=ir.second?0:S*Math.floor(re/S),C>=ir.second&&(Y=C>=ir.minute?0:S*Math.floor(Y/S)),C>=ir.minute&&(W=C>=ir.hour?0:S*Math.floor(W/S)),C>=ir.hour&&(j=C>=ir.day?0:S*Math.floor(j/S)),C>=ir.day&&(z=C>=ir.month?1:Math.max(1,S*Math.floor(z/S))),C>=ir.month&&(N=C>=ir.year?0:S*Math.floor(N/S)),C>=ir.year&&(L-=L%S),C===ir.week){S&&(s=y.makeTime(L,N,z,j,W,Y,re));let he=this.dateTimeFormat({timeZone:this.timezone,weekday:"narrow"},s,"es"),Ue="DLMXJVS".indexOf(he);z+=-Ue+p+(Ue<p?-7:0)}s=y.makeTime(L,N,z,j,W,Y,re),y.variableTimezone&&Zr(u)&&(te=u-s>4*ir.month||y.getTimezoneOffset(s)!==y.getTimezoneOffset(u));let Q=s,ae=1;for(;Q<u;)x.push(Q),C===ir.year?Q=y.makeTime(L+ae*S,0):C===ir.month?Q=y.makeTime(L,N+ae*S):te&&(C===ir.day||C===ir.week)?Q=y.makeTime(L,N,z+ae*S*(C===ir.day?1:7)):te&&C===ir.hour&&S>1?Q=y.makeTime(L,N,z,j+ae*S):Q+=C*S,ae++;x.push(Q),C<=ir.hour&&x.length<1e4&&x.forEach(he=>{he%18e5==0&&y.dateFormat("%H%M%S%L",he)==="000000000"&&(E[he]="day")})}return x.info=Bs(R,{higherRanks:E,totalRange:C*S}),x}},{isTouchDevice:Kn}=Ne,{fireEvent:gs,merge:Fs}=me,Ws={colors:["#2caffe","#544fc5","#00e272","#fe6a35","#6b8abc","#d568fb","#2ee0ca","#fa4b42","#feb56a","#91e8e1"],symbols:["circle","diamond","square","triangle","triangle-down"],lang:{weekFrom:"week from",chartTitle:"Chart title",locale:void 0,loading:"Loading...",months:void 0,seriesName:"Series {add index 1}",shortMonths:void 0,weekdays:void 0,numericSymbols:["k","M","G","T","P","E"],pieSliceName:"Slice",resetZoom:"Reset zoom",yAxisTitle:"Values",resetZoomTitle:"Reset zoom level 1:1"},global:{buttonTheme:{fill:"#f7f7f7",padding:8,r:2,stroke:"#cccccc","stroke-width":1,style:{color:"#333333",cursor:"pointer",fontSize:"0.8em",fontWeight:"normal"},states:{hover:{fill:"#e6e6e6"},select:{fill:"#e6e9ff",style:{color:"#000000",fontWeight:"bold"}},disabled:{style:{color:"#cccccc"}}}}},time:{Date:void 0,timezone:"UTC",timezoneOffset:0,useUTC:void 0},chart:{alignThresholds:!1,panning:{enabled:!1,type:"x"},styledMode:!1,borderRadius:0,colorCount:10,allowMutatingData:!0,ignoreHiddenSeries:!0,spacing:[10,10,15,10],resetZoomButton:{theme:{},position:{}},reflow:!0,type:"line",zooming:{singleTouch:!1,resetButton:{theme:{zIndex:6},position:{align:"right",x:-10,y:10}}},width:null,height:null,borderColor:"#334eff",backgroundColor:"#ffffff",plotBorderColor:"#cccccc"},title:{style:{color:"#333333",fontWeight:"bold"},text:"Chart title",margin:15,minScale:.67},subtitle:{style:{color:"#666666",fontSize:"0.8em"},text:""},caption:{margin:15,style:{color:"#666666",fontSize:"0.8em"},text:"",align:"left",verticalAlign:"bottom"},plotOptions:{},legend:{enabled:!0,align:"center",alignColumns:!0,className:"highcharts-no-tooltip",events:{},layout:"horizontal",itemMarginBottom:2,itemMarginTop:2,labelFormatter:function(){return this.name},borderColor:"#999999",borderRadius:0,navigation:{style:{fontSize:"0.8em"},activeColor:"#0022ff",inactiveColor:"#cccccc"},itemStyle:{color:"#333333",cursor:"pointer",fontSize:"0.8em",textDecoration:"none",textOverflow:"ellipsis"},itemHoverStyle:{color:"#000000"},itemHiddenStyle:{color:"#666666",textDecoration:"line-through"},shadow:!1,itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},squareSymbol:!0,symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{fontSize:"0.8em",fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"45%"},style:{position:"absolute",backgroundColor:"#ffffff",opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:{duration:300,easing:R=>Math.sqrt(1-Math.pow(R-1,2))},borderRadius:3,dateTimeLabelFormats:{millisecond:"%[AebHMSL]",second:"%[AebHMS]",minute:"%[AebHM]",hour:"%[AebHM]",day:"%[AebY]",week:"%v %[AebY]",month:"%[BY]",year:"%Y"},footerFormat:"",headerShape:"callout",hideDelay:500,padding:8,position:{x:0,y:3},shared:!1,snap:Kn?25:10,headerFormat:'<span style="font-size: 0.8em">{ucfirst point.key}</span><br/>',pointFormat:'<span style="color:{point.color}"></span> {series.name}: <b>{point.y}</b><br/>',backgroundColor:"#ffffff",borderWidth:void 0,stickOnContact:!1,style:{color:"#333333",cursor:"default",fontSize:"0.8em"},useHTML:!1},credits:{enabled:!0,href:"https://www.highcharts.com?credits",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#999999",fontSize:"0.6em"},text:"Highcharts.com"}},ml=new hn(Ws.time,Ws.lang),Ee={defaultOptions:Ws,defaultTime:ml,getOptions:function(){return Ws},setOptions:function(R){var s;return gs(Ne,"setOptions",{options:R}),Fs(!0,Ws,R),R.time&&ml.update(Ws.time),R.lang&&"locale"in R.lang&&ml.update({locale:R.lang.locale}),(s=R.lang)!=null&&s.chartTitle&&(Ws.title={...Ws.title,text:R.lang.chartTitle}),Ws}},{win:se}=Ne,{isNumber:ne,isString:we,merge:De,pInt:Fe,defined:Qe}=me,Ke=(R,s,u)=>`color-mix(in srgb,${R},${s} ${100*u}%)`,Ve=R=>we(R)&&!!R&&R!=="none";class Ye{static parse(s){return s?new Ye(s):Ye.None}constructor(s){let u,p,y,x;this.rgba=[NaN,NaN,NaN,NaN],this.input=s;let E=Ne.Color;if(E&&E!==Ye)return new E(s);if(typeof s=="object"&&s.stops!==void 0)this.stops=s.stops.map(S=>new Ye(S[1]));else if(typeof s=="string")for(this.input=s=Ye.names[s.toLowerCase()]||s,y=Ye.parsers.length;y--&&!p;)(u=(x=Ye.parsers[y]).regex.exec(s))&&(p=x.parse(u));p&&(this.rgba=p)}get(s){let u=this.input,p=this.rgba;if(this.output)return this.output;if(typeof u=="object"&&this.stops!==void 0){let y=De(u);return y.stops=[].slice.call(y.stops),this.stops.forEach((x,E)=>{y.stops[E]=[y.stops[E][0],x.get(s)]}),y}return p&&ne(p[0])?s!=="rgb"&&(s||p[3]!==1)?s==="a"?`${p[3]}`:"rgba("+p.join(",")+")":"rgb("+p[0]+","+p[1]+","+p[2]+")":u}brighten(s){let u=this.rgba;if(this.stops)this.stops.forEach(function(p){p.brighten(s)});else if(ne(s)&&s!==0)if(ne(u[0]))for(let p=0;p<3;p++)u[p]+=Fe(255*s),u[p]<0&&(u[p]=0),u[p]>255&&(u[p]=255);else Ye.useColorMix&&Ve(this.input)&&(this.output=Ke(this.input,s>0?"white":"black",Math.abs(s)));return this}setOpacity(s){return this.rgba[3]=s,this}tweenTo(s,u){let p=this.rgba,y=s.rgba;if(!ne(p[0])||!ne(y[0]))return Ye.useColorMix&&Ve(this.input)&&Ve(s.input)&&u<.99?Ke(this.input,s.input,u):s.input||"none";let x=y[3]!==1||p[3]!==1,E=(C,L)=>C+(p[L]-C)*(1-u),S=y.slice(0,3).map(E).map(Math.round);return x&&S.push(E(y[3],3)),(x?"rgba(":"rgb(")+S.join(",")+")"}}Ye.names={white:"#ffffff",black:"#000000"},Ye.parsers=[{regex:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d?(?:\.\d+)?)\s*\)/,parse:function(R){return[Fe(R[1]),Fe(R[2]),Fe(R[3]),parseFloat(R[4],10)]}},{regex:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/,parse:function(R){return[Fe(R[1]),Fe(R[2]),Fe(R[3]),1]}},{regex:/^#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])?$/i,parse:function(R){return[Fe(R[1]+R[1],16),Fe(R[2]+R[2],16),Fe(R[3]+R[3],16),Qe(R[4])?Fe(R[4]+R[4],16)/255:1]}},{regex:/^#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})?$/i,parse:function(R){return[Fe(R[1],16),Fe(R[2],16),Fe(R[3],16),Qe(R[4])?Fe(R[4],16)/255:1]}}],Ye.useColorMix=(fm=se.CSS)==null?void 0:fm.supports("color","color-mix(in srgb,red,blue 9%)"),Ye.None=new Ye("");let{parse:Ft}=Ye,{win:Ht}=Ne,{isNumber:Dt,objectEach:Ri}=me;class Si{constructor(s,u,p){this.pos=NaN,this.options=u,this.elem=s,this.prop=p}dSetter(){let s=this.paths,u=s==null?void 0:s[0],p=s==null?void 0:s[1],y=this.now||0,x=[];if(y!==1&&u&&p)if(u.length===p.length&&y<1)for(let E=0;E<p.length;E++){let S=u[E],C=p[E],L=[];for(let N=0;N<C.length;N++){let z=S[N],j=C[N];Dt(z)&&Dt(j)&&(C[0]!=="A"||N!==4&&N!==5)?L[N]=z+y*(j-z):L[N]=j}x.push(L)}else x=p;else x=this.toD||[];this.elem.attr("d",x,void 0,!0)}update(){let s=this.elem,u=this.prop,p=this.now,y=this.options.step;this[u+"Setter"]?this[u+"Setter"]():s.attr?s.element&&s.attr(u,p,null,!0):s.style[u]=p+this.unit,y&&y.call(s,p,this)}run(s,u,p){let y=this,x=y.options,E=function(L){return!E.stopped&&y.step(L)},S=Ht.requestAnimationFrame||function(L){setTimeout(L,13)},C=function(){for(let L=0;L<Si.timers.length;L++)Si.timers[L]()||Si.timers.splice(L--,1);Si.timers.length&&S(C)};s!==u||this.elem["forceAnimate:"+this.prop]?(this.startTime=+new Date,this.start=s,this.end=u,this.unit=p,this.now=this.start,this.pos=0,E.elem=this.elem,E.prop=this.prop,E()&&Si.timers.push(E)===1&&S(C)):(delete x.curAnim[this.prop],x.complete&&Object.keys(x.curAnim).length===0&&x.complete.call(this.elem))}step(s){let u,p,y=+new Date,x=this.options,E=this.elem,S=x.complete,C=x.duration,L=x.curAnim;return E.attr&&!E.element?u=!1:s||y>=C+this.startTime?(this.now=this.end,this.pos=1,this.update(),L[this.prop]=!0,p=!0,Ri(L,function(N){N!==!0&&(p=!1)}),p&&S&&S.call(E),u=!1):(this.pos=x.easing((y-this.startTime)/C),this.now=this.start+(this.end-this.start)*this.pos,this.update(),u=!0),u}initPath(s,u,p){let y=s.startX,x=s.endX,E=p.slice(),S=s.isArea,C=S?2:1,L=u&&p.length>u.length&&p.hasStackedCliffs,N,z,j,W,Y=u==null?void 0:u.slice();if(!Y||L)return[E,E];function re(Q,ae){for(;Q.length<z;){let he=Q[0],Ue=ae[z-Q.length];if(Ue&&he[0]==="M"&&(Ue[0]==="C"?Q[0]=["C",he[1],he[2],he[1],he[2],he[1],he[2]]:Q[0]=["L",he[1],he[2]]),Q.unshift(he),S){let Ie=Q.pop();Q.push(Q[Q.length-1],Ie)}}}function te(Q){for(;Q.length<z;){let ae=Q[Math.floor(Q.length/C)-1].slice();if(ae[0]==="C"&&(ae[1]=ae[5],ae[2]=ae[6]),S){let he=Q[Math.floor(Q.length/C)].slice();Q.splice(Q.length/2,0,ae,he)}else Q.push(ae)}}if(y&&x&&x.length){for(j=0;j<y.length;j++){if(y[j]===x[0]){N=j;break}if(y[0]===x[x.length-y.length+j]){N=j,W=!0;break}if(y[y.length-1]===x[x.length-y.length+j]){N=y.length-j;break}}N===void 0&&(Y=[])}return Y.length&&Dt(N)&&(z=E.length+N*C,W?(re(Y,E),te(E)):(re(E,Y),te(Y))),[Y,E]}fillSetter(){Si.prototype.strokeSetter.apply(this,arguments)}strokeSetter(){this.elem.attr(this.prop,Ft(this.start).tweenTo(Ft(this.end),this.pos),void 0,!0)}}Si.timers=[];let{defined:zi,getStyle:Xi,isArray:Ji,isNumber:Yr,isObject:is,merge:Hs,objectEach:Ss,pick:xo}=me;function As(R){return is(R)?Hs({duration:500,defer:0},R):{duration:500*!!R,defer:0}}function Zs(R,s){let u=Si.timers.length;for(;u--;)Si.timers[u].elem!==R||s&&s!==Si.timers[u].prop||(Si.timers[u].stopped=!0)}let ls={animate:function(R,s,u){let p,y="",x,E,S;is(u)||(S=arguments,u={duration:S[2],easing:S[3],complete:S[4]}),Yr(u.duration)||(u.duration=400),u.easing=typeof u.easing=="function"?u.easing:Math[u.easing]||Math.easeInOutSine,u.curAnim=Hs(s),Ss(s,function(C,L){Zs(R,L),E=new Si(R,u,L),x=void 0,L==="d"&&Ji(s.d)?(E.paths=E.initPath(R,R.pathArray,s.d),E.toD=s.d,p=0,x=1):R.attr?p=R.attr(L):(p=parseFloat(Xi(R,L))||0,L!=="opacity"&&(y="px")),x||(x=C),typeof x=="string"&&x.match("px")&&(x=x.replace(/px/g,"")),E.run(p,x,y)})},animObject:As,getDeferredAnimation:function(R,s,u){let p=As(s),y=u?[u]:R.series,x=0,E=0;return y.forEach(S=>{let C=As(S.options.animation);x=is(s)&&zi(s.defer)?p.defer:Math.max(x,C.duration+C.defer),E=Math.min(p.duration,C.duration)}),R.renderer.forExport&&(x=0),{defer:Math.max(0,x-E),duration:Math.min(x,E)}},setAnimation:function(R,s){s.renderer.globalAnimation=xo(R,s.options.chart.animation,!0)},stop:Zs},{SVG_NS:Xd,win:Zd}=Ne,{attr:mr,createElement:gu,css:cc,error:Qc,isFunction:eh,isString:Jn,objectEach:vo,splat:_u}=me,{trustedTypes:hc}=Zd,bo=hc&&eh(hc.createPolicy)&&hc.createPolicy("highcharts",{createHTML:R=>R}),Go=bo?bo.createHTML(""):"";class Dr{static filterUserAttributes(s){return vo(s,(u,p)=>{let y=!0;Dr.allowedAttributes.indexOf(p)===-1&&(y=!1),["background","dynsrc","href","lowsrc","src"].indexOf(p)!==-1&&(y=Jn(u)&&Dr.allowedReferences.some(x=>u.indexOf(x)===0)),y||(Qc(33,!1,void 0,{"Invalid attribute in config":`${p}`}),delete s[p]),Jn(u)&&s[p]&&(s[p]=u.replace(/</g,"&lt;"))}),s}static parseStyle(s){return s.split(";").reduce((u,p)=>{let y=p.split(":").map(E=>E.trim()),x=y.shift();return x&&y.length&&(u[x.replace(/-([a-z])/g,E=>E[1].toUpperCase())]=y.join(":")),u},{})}static setElementHTML(s,u){s.innerHTML=Dr.emptyHTML,u&&new Dr(u).addToDOM(s)}constructor(s){this.nodes=typeof s=="string"?this.parseMarkup(s):s}addToDOM(s){return function u(p,y){let x;return _u(p).forEach(function(E){let S,C=E.tagName,L=E.textContent?Ne.doc.createTextNode(E.textContent):void 0,N=Dr.bypassHTMLFiltering;if(C)if(C==="#text")S=L;else if(Dr.allowedTags.indexOf(C)!==-1||N){let z=C==="svg"?Xd:y.namespaceURI||Xd,j=Ne.doc.createElementNS(z,C),W=E.attributes||{};vo(E,function(Y,re){re!=="tagName"&&re!=="attributes"&&re!=="children"&&re!=="style"&&re!=="textContent"&&(W[re]=Y)}),mr(j,N?W:Dr.filterUserAttributes(W)),E.style&&cc(j,E.style),L&&j.appendChild(L),u(E.children||[],j),S=j}else Qc(33,!1,void 0,{"Invalid tagName in config":C});S&&y.appendChild(S),x=S}),x}(this.nodes,s)}parseMarkup(s){let u,p=[];s=s.trim().replace(/ style=(["'])/g," data-style=$1");try{u=new DOMParser().parseFromString(bo?bo.createHTML(s):s,"text/html")}catch{}if(!u){let x=gu("div");x.innerHTML=s,u={body:x}}let y=(x,E)=>{let S=x.nodeName.toLowerCase(),C={tagName:S};S==="#text"&&(C.textContent=x.textContent||"");let L=x.attributes;if(L){let N={};[].forEach.call(L,z=>{z.name==="data-style"?C.style=Dr.parseStyle(z.value):N[z.name]=z.value}),C.attributes=N}if(x.childNodes.length){let N=[];[].forEach.call(x.childNodes,z=>{y(z,N)}),N.length&&(C.children=N)}E.push(C)};return[].forEach.call(u.body.childNodes,x=>y(x,p)),p}}Dr.allowedAttributes=["alt","aria-controls","aria-describedby","aria-expanded","aria-haspopup","aria-hidden","aria-label","aria-labelledby","aria-live","aria-pressed","aria-readonly","aria-roledescription","aria-selected","class","clip-path","color","colspan","cx","cy","d","dx","dy","disabled","fill","filterUnits","flood-color","flood-opacity","height","href","id","in","in2","markerHeight","markerWidth","offset","opacity","operator","orient","padding","paddingLeft","paddingRight","patternUnits","r","radius","refX","refY","role","scope","slope","src","startOffset","stdDeviation","stroke","stroke-linecap","stroke-width","style","tableValues","result","rowspan","summary","target","tabindex","text-align","text-anchor","textAnchor","textLength","title","type","valign","width","x","x1","x2","xlink:href","y","y1","y2","zIndex"],Dr.allowedReferences=["https://","http://","mailto:","/","../","./","#"],Dr.allowedTags=["a","abbr","b","br","button","caption","circle","clipPath","code","dd","defs","div","dl","dt","em","feComponentTransfer","feComposite","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMorphology","feOffset","feMerge","feMergeNode","filter","h1","h2","h3","h4","h5","h6","hr","i","img","li","linearGradient","marker","ol","p","path","pattern","pre","rect","small","span","stop","strong","style","sub","sup","svg","table","text","textPath","thead","title","tbody","tspan","td","th","tr","u","ul","#text"],Dr.emptyHTML=Go,Dr.bypassHTMLFiltering=!1;let{defaultOptions:ut,defaultTime:wo}=Ee,{pageLang:_s}=Ne,{extend:Ns,getNestedProperty:Yd,isArray:To,isNumber:th,isObject:Kd,isString:gl,pick:Yt,ucfirst:Ki}=me,Vi={add:(R,s)=>R+s,divide:(R,s)=>s!==0?R/s:"",eq:(R,s)=>R==s,each:function(R){let s=arguments[arguments.length-1];return!!To(R)&&R.map((u,p)=>Gi(s.body,Ns(Kd(u)?u:{"@this":u},{"@index":p,"@first":p===0,"@last":p===R.length-1}))).join("")},ge:(R,s)=>R>=s,gt:(R,s)=>R>s,if:R=>!!R,le:(R,s)=>R<=s,lt:(R,s)=>R<s,multiply:(R,s)=>R*s,ne:(R,s)=>R!=s,subtract:(R,s)=>R-s,ucfirst:Ki,unless:R=>!R},yn={},Ln=R=>/^["'].+["']$/.test(R);function Gi(R="",s,u){var te;let p=/\{([a-zA-Z\u00C0-\u017F\d:\.,;\-\/<>\[\]%_@+"'= #\(\)]+)\}/g,y=/\(([a-zA-Z\u00C0-\u017F\d:\.,;\-\/<>\[\]%_@+"'= ]+)\)/g,x=[],E=/f$/,S=/\.(\d)/,C=((te=u==null?void 0:u.options)==null?void 0:te.lang)||ut.lang,L=(u==null?void 0:u.time)||wo,N=(u==null?void 0:u.numberFormatter)||xn,z=(Q="")=>{let ae;return Q==="true"||Q!=="false"&&((ae=Number(Q)).toString()===Q?ae:Ln(Q)?Q.slice(1,-1):Yd(Q,s))},j,W,Y=0,re;for(;(j=p.exec(R))!==null;){let Q=j,ae=y.exec(j[1]);ae&&(j=ae,re=!0),W!=null&&W.isBlock||(W={ctx:s,expression:j[1],find:j[0],isBlock:j[1].charAt(0)==="#",start:j.index,startInner:j.index+j[0].length,length:j[0].length});let he=(W.isBlock?Q:j)[1].split(" ")[0].replace("#","");Vi[he]&&(W.isBlock&&he===W.fn&&Y++,W.fn||(W.fn=he));let Ue=j[1]==="else";if(W.isBlock&&W.fn&&(j[1]===`/${W.fn}`||Ue))if(Y)!Ue&&Y--;else{let Ie=W.startInner,Re=R.substr(Ie,j.index-Ie);W.body===void 0?(W.body=Re,W.startInner=j.index+j[0].length):W.elseBody=Re,W.find+=Re+j[0],Ue||(x.push(W),W=void 0)}else W.isBlock||x.push(W);if(ae&&!(W!=null&&W.isBlock))break}return x.forEach(Q=>{let ae,he,{body:Ue,elseBody:Ie,expression:Re,fn:rt}=Q;if(rt){let qe=[Q],st=[],Et=Re.length,Bt=0,$t;for(he=0;he<=Et;he++){let At=Re.charAt(he);$t||At!=='"'&&At!=="'"?$t===At&&($t=""):$t=At,$t||At!==" "&&he!==Et||(st.push(Re.substr(Bt,he-Bt)),Bt=he+1)}for(he=Vi[rt].length;he--;)qe.unshift(z(st[he+1]));ae=Vi[rt].apply(s,qe),Q.isBlock&&typeof ae=="boolean"&&(ae=Gi(ae?Ue:Ie,s,u))}else{let qe=Ln(Re)?[Re]:Re.split(":");if(ae=z(qe.shift()||""),qe.length&&typeof ae=="number"){let st=qe.join(":");if(E.test(st)){let Et=parseInt((st.match(S)||["","-1"])[1],10);ae!==null&&(ae=N(ae,Et,C.decimalPoint,st.indexOf(",")>-1?C.thousandsSep:""))}else ae=L.dateFormat(st,ae)}y.lastIndex=0,y.test(Q.find)&&gl(ae)&&(ae=`"${ae}"`)}R=R.replace(Q.find,Yt(ae,""))}),re?Gi(R,s,u):R}function xn(R,s,u,p){var re;s*=1;let y,x,[E,S]=(R=+R||0).toString().split("e").map(Number),C=((re=this==null?void 0:this.options)==null?void 0:re.lang)||ut.lang,L=(R.toString().split(".")[1]||"").split("e")[0].length,N=s,z={};u??(u=C.decimalPoint),p??(p=C.thousandsSep),s===-1?s=Math.min(L,20):th(s)?s&&S<0&&((x=s+S)>=0?(E=+E.toExponential(x).split("e")[0],s=x):(E=Math.floor(E),R=s<20?+(E*Math.pow(10,S)).toFixed(s):0,S=0)):s=2,S&&(s??(s=2),R=E),th(s)&&s>=0&&(z.minimumFractionDigits=s,z.maximumFractionDigits=s),p===""&&(z.useGrouping=!1);let j=p||u,W=j?"en":(this==null?void 0:this.locale)||C.locale||_s,Y=JSON.stringify(z)+W;return y=(yn[Y]??(yn[Y]=new Intl.NumberFormat(W,z))).format(R),j&&(y=y.replace(/([,\.])/g,"_$1").replace(/_\,/g,p??",").replace("_.",u??".")),(s||+y!=0)&&(!(S<0)||N)||(y="0"),S&&+y!=0&&(y+="e"+(S<0?"":"+")+S),y}let Ys={dateFormat:function(R,s,u){return wo.dateFormat(R,s,u)},format:Gi,helpers:Vi,numberFormat:xn};(function(R){let s;R.rendererTypes={},R.getRendererType=function(u=s){return R.rendererTypes[u]||R.rendererTypes[s]},R.registerRendererType=function(u,p,y){R.rendererTypes[u]=p,(!s||y)&&(s=u,Ne.Renderer=p)}})(D||(D={}));let Qn=D,{clamp:Dn,pick:Wr,pushUnique:Jd,stableSort:eo}=me;(B||(B={})).distribute=function R(s,u,p){let y=s,x=y.reducedLen||u,E=(he,Ue)=>he.target-Ue.target,S=[],C=s.length,L=[],N=S.push,z,j,W,Y=!0,re,te,Q=0,ae;for(z=C;z--;)Q+=s[z].size;if(Q>x){for(eo(s,(he,Ue)=>(Ue.rank||0)-(he.rank||0)),W=(ae=s[0].rank===s[s.length-1].rank)?C/2:-1,j=ae?W:C-1;W&&Q>x;)re=s[z=Math.floor(j)],Jd(L,z)&&(Q-=re.size),j+=W,ae&&j>=s.length&&(W/=2,j=W);L.sort((he,Ue)=>Ue-he).forEach(he=>N.apply(S,s.splice(he,1)))}for(eo(s,E),s=s.map(he=>({size:he.size,targets:[he.target],align:Wr(he.align,.5)}));Y;){for(z=s.length;z--;)re=s[z],te=(Math.min.apply(0,re.targets)+Math.max.apply(0,re.targets))/2,re.pos=Dn(te-re.size*re.align,0,u-re.size);for(z=s.length,Y=!1;z--;)z>0&&s[z-1].pos+s[z-1].size>s[z].pos&&(s[z-1].size+=s[z].size,s[z-1].targets=s[z-1].targets.concat(s[z].targets),s[z-1].align=.5,s[z-1].pos+s[z-1].size>u&&(s[z-1].pos=u-s[z-1].size),s.splice(z,1),Y=!0)}return N.apply(y,S),z=0,s.some(he=>{let Ue=0;return(he.targets||[]).some(()=>(y[z].pos=he.pos+Ue,p!==void 0&&Math.abs(y[z].pos-y[z].target)>p?(y.slice(0,z+1).forEach(Ie=>delete Ie.pos),y.reducedLen=(y.reducedLen||u)-.1*u,y.reducedLen>.1*u&&R(y,u,p),!0):(Ue+=y[z].size,z++,!1)))}),eo(y,E),y};let pa=B,{animate:uc,animObject:yu,stop:xu}=ls,{deg2rad:_l,doc:Eo,svg:ih,SVG_NS:$o,win:vn,isFirefox:cs}=Ne,{addEvent:vu,attr:dc,createElement:bn,crisp:un,css:bu,defined:wn,erase:rs,extend:Wo,fireEvent:pc,getAlignFactor:Ho,isArray:Us,isFunction:rh,isNumber:wu,isObject:qo,isString:Xo,merge:yl,objectEach:xl,pick:to,pInt:Zo,pushUnique:So,replaceNested:Tu,syncTimeout:za,uniqueKey:Ao}=me;class ss{_defaultGetter(s){let u=to(this[s+"Value"],this[s],this.element?this.element.getAttribute(s):null,0);return/^-?[\d\.]+$/.test(u)&&(u=parseFloat(u)),u}_defaultSetter(s,u,p){p.setAttribute(u,s)}add(s){let u,p=this.renderer,y=this.element;return s&&(this.parentGroup=s),this.textStr!==void 0&&this.element.nodeName==="text"&&p.buildText(this),this.added=!0,(!s||s.handleZ||this.zIndex)&&(u=this.zIndexSetter()),u||(s?s.element:p.box).appendChild(y),this.onAdd&&this.onAdd(),this}addClass(s,u){let p=u?"":this.attr("class")||"";return(s=(s||"").split(/ /g).reduce(function(y,x){return p.indexOf(x)===-1&&y.push(x),y},p?[p]:[]).join(" "))!==p&&this.attr("class",s),this}afterSetters(){this.doTransform&&(this.updateTransform(),this.doTransform=!1)}align(s,u,p,y=!0){let x=this.renderer,E=x.alignedObjects,S=!!s;s?(this.alignOptions=s,this.alignByTranslate=u,this.alignTo=p):(s=this.alignOptions||{},u=this.alignByTranslate,p=this.alignTo);let C=!p||Xo(p)?p||"renderer":void 0;C&&(S&&So(E,this),p=void 0);let L=to(p,x[C],x),N=(L.x||0)+(s.x||0)+((L.width||0)-(s.width||0))*Ho(s.align),z=(L.y||0)+(s.y||0)+((L.height||0)-(s.height||0))*Ho(s.verticalAlign),j={"text-align":s==null?void 0:s.align};return j[u?"translateX":"x"]=Math.round(N),j[u?"translateY":"y"]=Math.round(z),y&&(this[this.placed?"animate":"attr"](j),this.placed=!0),this.alignAttr=j,this}alignSetter(s){let u={left:"start",center:"middle",right:"end"};u[s]&&(this.alignValue=s,this.element.setAttribute("text-anchor",u[s]))}animate(s,u,p){let y=yu(to(u,this.renderer.globalAnimation,!0)),x=y.defer;return Eo.hidden&&(y.duration=0),y.duration!==0?(p&&(y.complete=p),za(()=>{this.element&&uc(this,s,y)},x)):(this.attr(s,void 0,p||y.complete),xl(s,function(E,S){y.step&&y.step.call(this,E,{prop:S,pos:1,elem:this})},this)),this}applyTextOutline(s){let u=this.element;s.indexOf("contrast")!==-1&&(s=s.replace(/contrast/g,this.renderer.getContrast(u.style.fill)));let p=s.indexOf(" "),y=s.substring(p+1),x=s.substring(0,p);if(x&&x!=="none"&&Ne.svg){this.fakeTS=!0,x=x.replace(/(^[\d\.]+)(.*?)$/g,function(N,z,j){return 2*Number(z)+j}),this.removeTextOutline();let E=Eo.createElementNS($o,"tspan");dc(E,{class:"highcharts-text-outline",fill:y,stroke:y,"stroke-width":x,"stroke-linejoin":"round"});let S=u.querySelector("textPath")||u;[].forEach.call(S.childNodes,N=>{let z=N.cloneNode(!0);z.removeAttribute&&["fill","stroke","stroke-width","stroke"].forEach(j=>z.removeAttribute(j)),E.appendChild(z)});let C=0;[].forEach.call(S.querySelectorAll("text tspan"),N=>{C+=Number(N.getAttribute("dy"))});let L=Eo.createElementNS($o,"tspan");L.textContent="",dc(L,{x:Number(u.getAttribute("x")),dy:-C}),E.appendChild(L),S.insertBefore(E,S.firstChild)}}attr(s,u,p,y){let{element:x}=this,E=ss.symbolCustomAttribs,S,C,L=this,N;return typeof s=="string"&&u!==void 0&&(S=s,(s={})[S]=u),typeof s=="string"?L=(this[s+"Getter"]||this._defaultGetter).call(this,s,x):(xl(s,function(z,j){N=!1,y||xu(this,j),this.symbolName&&E.indexOf(j)!==-1&&(C||(this.symbolAttr(s),C=!0),N=!0),this.rotation&&(j==="x"||j==="y")&&(this.doTransform=!0),N||(this[j+"Setter"]||this._defaultSetter).call(this,z,j,x)},this),this.afterSetters()),p&&p.call(this),L}clip(s){if(s&&!s.clipPath){let u=Ao()+"-",p=this.renderer.createElement("clipPath").attr({id:u}).add(this.renderer.defs);Wo(s,{clipPath:p,id:u,count:0}),s.add(p)}return this.attr("clip-path",s?`url(${this.renderer.url}#${s.id})`:"none")}crisp(s,u){u=Math.round(u||s.strokeWidth||0);let p=s.x||this.x||0,y=s.y||this.y||0,x=(s.width||this.width||0)+p,E=(s.height||this.height||0)+y,S=un(p,u),C=un(y,u);return Wo(s,{x:S,y:C,width:un(x,u)-S,height:un(E,u)-C}),wn(s.strokeWidth)&&(s.strokeWidth=u),s}complexColor(s,u,p){let y=this.renderer,x,E,S,C,L,N,z,j,W,Y,re=[],te;pc(this.renderer,"complexColor",{args:arguments},function(){if(s.radialGradient?E="radialGradient":s.linearGradient&&(E="linearGradient"),E){if(S=s[E],L=y.gradients,N=s.stops,W=p.radialReference,Us(S)&&(s[E]=S={x1:S[0],y1:S[1],x2:S[2],y2:S[3],gradientUnits:"userSpaceOnUse"}),E==="radialGradient"&&W&&!wn(S.gradientUnits)&&(C=S,S=yl(S,y.getRadialAttr(W,C),{gradientUnits:"userSpaceOnUse"})),xl(S,function(Q,ae){ae!=="id"&&re.push(ae,Q)}),xl(N,function(Q){re.push(Q)}),L[re=re.join(",")])Y=L[re].attr("id");else{S.id=Y=Ao();let Q=L[re]=y.createElement(E).attr(S).add(y.defs);Q.radAttr=C,Q.stops=[],N.forEach(function(ae){ae[1].indexOf("rgba")===0?(z=(x=Ye.parse(ae[1])).get("rgb"),j=x.get("a")):(z=ae[1],j=1);let he=y.createElement("stop").attr({offset:ae[0],"stop-color":z,"stop-opacity":j}).add(Q);Q.stops.push(he)})}te="url("+y.url+"#"+Y+")",p.setAttribute(u,te),p.gradient=re,s.toString=function(){return te}}})}css(s){let u=this.styles,p={},y=this.element,x,E=!u;if(u&&xl(s,function(S,C){u&&u[C]!==S&&(p[C]=S,E=!0)}),E){u&&(s=Wo(u,p)),s.width===null||s.width==="auto"?delete this.textWidth:y.nodeName.toLowerCase()==="text"&&s.width&&(x=this.textWidth=Zo(s.width)),Wo(this.styles,s),x&&!ih&&this.renderer.forExport&&delete s.width;let S=cs&&s.fontSize||null;S&&(wu(S)||/^\d+$/.test(S))&&(s.fontSize+="px");let C=yl(s);y.namespaceURI===this.SVG_NS&&(["textOutline","textOverflow","whiteSpace","width"].forEach(L=>C&&delete C[L]),C.color&&(C.fill=C.color,delete C.color)),bu(y,C)}return this.added&&(this.element.nodeName==="text"&&this.renderer.buildText(this),s.textOutline&&this.applyTextOutline(s.textOutline)),this}dashstyleSetter(s){let u,p=this["stroke-width"];if(p==="inherit"&&(p=1),s){let y=(s=s.toLowerCase()).replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(",");for(u=y.length;u--;)y[u]=""+Zo(y[u])*to(p,NaN);s=y.join(",").replace(/NaN/g,"none"),this.element.setAttribute("stroke-dasharray",s)}}destroy(){let s=this,u=s.element||{},p=s.renderer,y=u.ownerSVGElement,x=u.nodeName==="SPAN"&&s.parentGroup||void 0,E,S;if(u.onclick=u.onmouseout=u.onmouseover=u.onmousemove=u.point=null,xu(s),s.clipPath&&y){let C=s.clipPath;[].forEach.call(y.querySelectorAll("[clip-path],[CLIP-PATH]"),function(L){L.getAttribute("clip-path").indexOf(C.element.id)>-1&&L.removeAttribute("clip-path")}),s.clipPath=C.destroy()}if(s.stops){for(S=0;S<s.stops.length;S++)s.stops[S].destroy();s.stops.length=0,s.stops=void 0}for(s.safeRemoveChild(u);x!=null&&x.div&&x.div.childNodes.length===0;)E=x.parentGroup,s.safeRemoveChild(x.div),delete x.div,x=E;s.alignOptions&&rs(p.alignedObjects,s),xl(s,(C,L)=>{var N,z,j;(((N=s[L])==null?void 0:N.parentGroup)===s||["connector","foreignObject"].indexOf(L)!==-1)&&((j=(z=s[L])==null?void 0:z.destroy)==null||j.call(z)),delete s[L]})}dSetter(s,u,p){Us(s)&&(typeof s[0]=="string"&&(s=this.renderer.pathToSegments(s)),this.pathArray=s,s=s.reduce((y,x,E)=>x!=null&&x.join?(E?y+" ":"")+x.join(" "):(x||"").toString(),"")),/(NaN| {2}|^$)/.test(s)&&(s="M 0 0"),this[u]!==s&&(p.setAttribute(u,s),this[u]=s)}fillSetter(s,u,p){typeof s=="string"?p.setAttribute(u,s):s&&this.complexColor(s,u,p)}hrefSetter(s,u,p){p.setAttributeNS("http://www.w3.org/1999/xlink",u,s)}getBBox(s,u){let p,y,x,E,{alignValue:S,element:C,renderer:L,styles:N,textStr:z}=this,{cache:j,cacheKeys:W}=L,Y=C.namespaceURI===this.SVG_NS,re=to(u,this.rotation,0),te=L.styledMode?C&&ss.prototype.getStyle.call(C,"font-size"):N.fontSize;if(wn(z)&&((E=z.toString()).indexOf("<")===-1&&(E=E.replace(/\d/g,"0")),E+=["",L.rootFontSize,te,re,this.textWidth,S,N.lineClamp,N.textOverflow,N.fontWeight].join(",")),E&&!s&&(p=j[E]),!p||p.polygon){if(Y||L.forExport){try{x=this.fakeTS&&function(ae){let he=C.querySelector(".highcharts-text-outline");he&&bu(he,{display:ae})},rh(x)&&x("none"),p=C.getBBox?Wo({},C.getBBox()):{width:C.offsetWidth,height:C.offsetHeight,x:0,y:0},rh(x)&&x("")}catch{}(!p||p.width<0)&&(p={x:0,y:0,width:0,height:0})}else p=this.htmlGetBBox();y=p.height,Y&&(p.height=y={"11px,17":14,"13px,20":16}[`${te||""},${Math.round(y)}`]||y),re&&(p=this.getRotatedBox(p,re));let Q={bBox:p};pc(this,"afterGetBBox",Q),p=Q.bBox}if(E&&(z===""||p.height>0)){for(;W.length>250;)delete j[W.shift()];j[E]||W.push(E),j[E]=p}return p}getRotatedBox(s,u){let{x:p,y,width:x,height:E}=s,{alignValue:S,translateY:C,rotationOriginX:L=0,rotationOriginY:N=0}=this,z=Ho(S),j=Number(this.element.getAttribute("y")||0)-(C?0:y),W=u*_l,Y=(u-90)*_l,re=Math.cos(W),te=Math.sin(W),Q=x*re,ae=x*te,he=Math.cos(Y),Ue=Math.sin(Y),[[Ie,Re],[rt,qe]]=[L,N].map(dr=>[dr-dr*re,dr*te]),st=p+z*(x-Q)+Ie+qe+j*he,Et=st+Q,Bt=Et-E*he,$t=Bt-Q,At=y+j-z*ae-Re+rt+j*Ue,Kt=At+ae,si=Kt-E*Ue,Ii=si-ae,hi=Math.min(st,Et,Bt,$t),Li=Math.min(At,Kt,si,Ii),ar=Math.max(st,Et,Bt,$t)-hi,Zi=Math.max(At,Kt,si,Ii)-Li;return{x:hi,y:Li,width:ar,height:Zi,polygon:[[st,At],[Et,Kt],[Bt,si],[$t,Ii]]}}getStyle(s){return vn.getComputedStyle(this.element||this,"").getPropertyValue(s)}hasClass(s){return(""+this.attr("class")).split(" ").indexOf(s)!==-1}hide(){return this.attr({visibility:"hidden"})}htmlGetBBox(){return{height:0,width:0,x:0,y:0}}constructor(s,u){this.onEvents={},this.opacity=1,this.SVG_NS=$o,this.element=u==="span"||u==="body"?bn(u):Eo.createElementNS(this.SVG_NS,u),this.renderer=s,this.styles={},pc(this,"afterInit")}on(s,u){let{onEvents:p}=this;return p[s]&&p[s](),p[s]=vu(this.element,s,u),this}opacitySetter(s,u,p){let y=Number(Number(s).toFixed(3));this.opacity=y,p.setAttribute(u,y)}reAlign(){var s;(s=this.alignOptions)!=null&&s.width&&this.alignOptions.align!=="left"&&(this.alignOptions.width=this.getBBox().width,this.placed=!1,this.align())}removeClass(s){return this.attr("class",(""+this.attr("class")).replace(Xo(s)?RegExp(`(^| )${s}( |$)`):s," ").replace(/ +/g," ").trim())}removeTextOutline(){let s=this.element.querySelector("tspan.highcharts-text-outline");s&&this.safeRemoveChild(s)}safeRemoveChild(s){let u=s.parentNode;u&&u.removeChild(s)}setRadialReference(s){let u=this.element.gradient&&this.renderer.gradients[this.element.gradient]||void 0;return this.element.radialReference=s,u!=null&&u.radAttr&&u.animate(this.renderer.getRadialAttr(s,u.radAttr)),this}shadow(s){var x;let{renderer:u}=this,p=yl(((x=this.parentGroup)==null?void 0:x.rotation)===90?{offsetX:-1,offsetY:-1}:{},qo(s)?s:{}),y=u.shadowDefinition(p);return this.attr({filter:s?`url(${u.url}#${y})`:"none"})}show(s=!0){return this.attr({visibility:s?"inherit":"visible"})}"stroke-widthSetter"(s,u,p){this[u]=s,p.setAttribute(u,s)}strokeWidth(){if(!this.renderer.styledMode)return this["stroke-width"]||0;let s=this.getStyle("stroke-width"),u=0,p;return/px$/.test(s)?u=Zo(s):s!==""&&(dc(p=Eo.createElementNS($o,"rect"),{width:s,"stroke-width":0}),this.element.parentNode.appendChild(p),u=p.getBBox().width,p.parentNode.removeChild(p)),u}symbolAttr(s){let u=this;ss.symbolCustomAttribs.forEach(function(p){u[p]=to(s[p],u[p])}),u.attr({d:u.renderer.symbols[u.symbolName](u.x,u.y,u.width,u.height,u)})}textSetter(s){s!==this.textStr&&(delete this.textPxLength,this.textStr=s,this.added&&this.renderer.buildText(this),this.reAlign())}titleSetter(s){let u=this.element,p=u.getElementsByTagName("title")[0]||Eo.createElementNS(this.SVG_NS,"title");u.insertBefore?u.insertBefore(p,u.firstChild):u.appendChild(p),p.textContent=Tu(to(s,""),[/<[^>]*>/g,""]).replace(/&lt;/g,"<").replace(/&gt;/g,">")}toFront(){let s=this.element;return s.parentNode.appendChild(s),this}translate(s,u){return this.attr({translateX:s,translateY:u})}updateTransform(s="transform"){let{element:u,foreignObject:p,matrix:y,padding:x,rotation:E=0,rotationOriginX:S,rotationOriginY:C,scaleX:L,scaleY:N,text:z,translateX:j=0,translateY:W=0}=this,Y=["translate("+j+","+W+")"];wn(y)&&Y.push("matrix("+y.join(",")+")"),E&&(Y.push("rotate("+E+" "+(S??u.getAttribute("x")??this.x??0)+" "+(C??u.getAttribute("y")??this.y??0)+")"),(z==null?void 0:z.element.tagName)!=="SPAN"||z!=null&&z.foreignObject||z.attr({rotation:E,rotationOriginX:(S||0)-x,rotationOriginY:(C||0)-x})),(wn(L)||wn(N))&&Y.push("scale("+to(L,1)+" "+to(N,1)+")"),Y.length&&!(z||this).textPath&&((p==null?void 0:p.element)||u).setAttribute(s,Y.join(" "))}visibilitySetter(s,u,p){s==="inherit"?p.removeAttribute(u):this[u]!==s&&p.setAttribute(u,s),this[u]=s}xGetter(s){return this.element.nodeName==="circle"&&(s==="x"?s="cx":s==="y"&&(s="cy")),this._defaultGetter(s)}zIndexSetter(s,u){let p=this.renderer,y=this.parentGroup,x=(y||p).element||p.box,E=this.element,S=x===p.box,C,L,N,z=!1,j,W=this.added,Y;if(wn(s)?(E.setAttribute("data-z-index",s),s*=1,this[u]===s&&(W=!1)):wn(this[u])&&E.removeAttribute("data-z-index"),this[u]=s,W){for((s=this.zIndex)&&y&&(y.handleZ=!0),Y=(C=x.childNodes).length-1;Y>=0&&!z;Y--)j=!wn(N=(L=C[Y]).getAttribute("data-z-index")),L!==E&&(s<0&&j&&!S&&!Y?(x.insertBefore(E,C[Y]),z=!0):(Zo(N)<=s||j&&(!wn(s)||s>=0))&&(x.insertBefore(E,C[Y+1]),z=!0));z||(x.insertBefore(E,C[3*!!S]),z=!0)}return z}}ss.symbolCustomAttribs=["anchorX","anchorY","clockwise","end","height","innerR","r","start","width","x","y"],ss.prototype.strokeSetter=ss.prototype.fillSetter,ss.prototype.yGetter=ss.prototype.xGetter,ss.prototype.matrixSetter=ss.prototype.rotationOriginXSetter=ss.prototype.rotationOriginYSetter=ss.prototype.rotationSetter=ss.prototype.scaleXSetter=ss.prototype.scaleYSetter=ss.prototype.translateXSetter=ss.prototype.translateYSetter=ss.prototype.verticalAlignSetter=function(R,s){this[s]=R,this.doTransform=!0};let js=ss,{defined:fc,extend:vl,getAlignFactor:bl,isNumber:wl,merge:sh,pick:Tl,removeEvent:nh}=me;class Rn extends js{constructor(s,u,p,y,x,E,S,C,L,N){let z;super(s,"g"),this.paddingLeftSetter=this.paddingSetter,this.paddingRightSetter=this.paddingSetter,this.doUpdate=!1,this.textStr=u,this.x=p,this.y=y,this.anchorX=E,this.anchorY=S,this.baseline=L,this.className=N,this.addClass(N==="button"?"highcharts-no-tooltip":"highcharts-label"),N&&this.addClass("highcharts-"+N),this.text=s.text(void 0,0,0,C).attr({zIndex:1}),typeof x=="string"&&((z=/^url\((.*?)\)$/.test(x))||this.renderer.symbols[x])&&(this.symbolKey=x),this.bBox=Rn.emptyBBox,this.padding=3,this.baselineOffset=0,this.needsBox=s.styledMode||z,this.deferredAttr={},this.alignFactor=0}alignSetter(s){let u=bl(s);this.textAlign=s,u!==this.alignFactor&&(this.alignFactor=u,this.bBox&&wl(this.xSetting)&&this.attr({x:this.xSetting}))}anchorXSetter(s,u){this.anchorX=s,this.boxAttr(u,Math.round(s)-this.getCrispAdjust()-this.xSetting)}anchorYSetter(s,u){this.anchorY=s,this.boxAttr(u,s-this.ySetting)}boxAttr(s,u){this.box?this.box.attr(s,u):this.deferredAttr[s]=u}css(s){if(s){let u={};s=sh(s),Rn.textProps.forEach(p=>{s[p]!==void 0&&(u[p]=s[p],delete s[p])}),this.text.css(u),"fontSize"in u||"fontWeight"in u?this.updateTextPadding():("width"in u||"textOverflow"in u)&&this.updateBoxSize()}return js.prototype.css.call(this,s)}destroy(){nh(this.element,"mouseenter"),nh(this.element,"mouseleave"),this.text&&this.text.destroy(),this.box&&(this.box=this.box.destroy()),js.prototype.destroy.call(this)}fillSetter(s,u){s&&(this.needsBox=!0),this.fill=s,this.boxAttr(u,s)}getBBox(s,u){this.textStr&&this.bBox.width===0&&this.bBox.height===0&&this.updateBoxSize();let{padding:p,height:y=0,translateX:x=0,translateY:E=0,width:S=0}=this,C=Tl(this.paddingLeft,p),L=u??(this.rotation||0),N={width:S,height:y,x:x+this.bBox.x-C,y:E+this.bBox.y-p+this.baselineOffset};return L&&(N=this.getRotatedBox(N,L)),N}getCrispAdjust(){return(this.renderer.styledMode&&this.box?this.box.strokeWidth():this["stroke-width"]?parseInt(this["stroke-width"],10):0)%2/2}heightSetter(s){this.heightSetting=s,this.doUpdate=!0}afterSetters(){super.afterSetters(),this.doUpdate&&(this.updateBoxSize(),this.doUpdate=!1)}onAdd(){this.text.add(this),this.attr({text:Tl(this.textStr,""),x:this.x||0,y:this.y||0}),this.box&&fc(this.anchorX)&&this.attr({anchorX:this.anchorX,anchorY:this.anchorY})}paddingSetter(s,u){wl(s)?s!==this[u]&&(this[u]=s,this.updateTextPadding()):this[u]=void 0}rSetter(s,u){this.boxAttr(u,s)}strokeSetter(s,u){this.stroke=s,this.boxAttr(u,s)}"stroke-widthSetter"(s,u){s&&(this.needsBox=!0),this["stroke-width"]=s,this.boxAttr(u,s)}"text-alignSetter"(s){this.textAlign=this["text-align"]=s,this.updateTextPadding()}textSetter(s){s!==void 0&&this.text.attr({text:s}),this.updateTextPadding(),this.reAlign()}updateBoxSize(){let s,u=this.text,p={},y=this.padding,x=this.bBox=(!wl(this.widthSetting)||!wl(this.heightSetting)||this.textAlign)&&fc(u.textStr)?u.getBBox(void 0,0):Rn.emptyBBox;this.width=this.getPaddedWidth(),this.height=(this.heightSetting||x.height||0)+2*y;let E=this.renderer.fontMetrics(u);if(this.baselineOffset=y+Math.min((this.text.firstLineMetrics||E).b,x.height||1/0),this.heightSetting&&(this.baselineOffset+=(this.heightSetting-E.h)/2),this.needsBox&&!u.textPath){if(!this.box){let S=this.box=this.symbolKey?this.renderer.symbol(this.symbolKey):this.renderer.rect();S.addClass((this.className==="button"?"":"highcharts-label-box")+(this.className?" highcharts-"+this.className+"-box":"")),S.add(this)}p.x=s=this.getCrispAdjust(),p.y=(this.baseline?-this.baselineOffset:0)+s,p.width=Math.round(this.width),p.height=Math.round(this.height),this.box.attr(vl(p,this.deferredAttr)),this.deferredAttr={}}}updateTextPadding(){let s=this.text,u=s.styles.textAlign||this.textAlign;if(!s.textPath){this.updateBoxSize();let p=this.baseline?0:this.baselineOffset,y=(this.paddingLeft??this.padding)+bl(u)*(this.widthSetting??this.bBox.width);(y!==s.x||p!==s.y)&&(s.attr({align:u,x:y}),p!==void 0&&s.attr("y",p)),s.x=y,s.y=p}}widthSetter(s){this.widthSetting=wl(s)?s:void 0,this.doUpdate=!0}getPaddedWidth(){let s=this.padding,u=Tl(this.paddingLeft,s),p=Tl(this.paddingRight,s);return(this.widthSetting||this.bBox.width||0)+u+p}xSetter(s){this.x=s,this.alignFactor&&(s-=this.alignFactor*this.getPaddedWidth(),this["forceAnimate:x"]=!0),this.xSetting=Math.round(s),this.attr("translateX",this.xSetting)}ySetter(s){this.ySetting=this.y=Math.round(s),this.attr("translateY",this.ySetting)}}Rn.emptyBBox={width:0,height:0,x:0,y:0},Rn.textProps=["color","direction","fontFamily","fontSize","fontStyle","fontWeight","lineClamp","lineHeight","textAlign","textDecoration","textOutline","textOverflow","whiteSpace","width"];let{defined:pr,isNumber:Mf,pick:Oa}=me;function Eu(R,s,u,p,y){let x=[];if(y){let E=y.start||0,S=y.end||0,C=Oa(y.r,u),L=Oa(y.r,p||u),N=2e-4/(y.borderRadius?1:Math.max(C,1)),z=Math.abs(S-E-2*Math.PI)<N;z&&(E=Math.PI/2,S=2.5*Math.PI-N);let j=y.innerR,W=Oa(y.open,z),Y=Math.cos(E),re=Math.sin(E),te=Math.cos(S),Q=Math.sin(S),ae=Oa(y.longArc,S-E-Math.PI<N?0:1),he=["A",C,L,0,ae,Oa(y.clockwise,1),R+C*te,s+L*Q];he.params={start:E,end:S,cx:R,cy:s},x.push(["M",R+C*Y,s+L*re],he),pr(j)&&((he=["A",j,j,0,ae,pr(y.clockwise)?1-y.clockwise:0,R+j*Y,s+j*re]).params={start:S,end:E,cx:R,cy:s},x.push(W?["M",R+j*te,s+j*Q]:["L",R+j*te,s+j*Q],he)),W||x.push(["Z"])}return x}function oh(R,s,u,p,y){return y!=null&&y.r?ah(R,s,u,p,y):[["M",R,s],["L",R+u,s],["L",R+u,s+p],["L",R,s+p],["Z"]]}function ah(R,s,u,p,y){let x=(y==null?void 0:y.r)||0;return[["M",R+x,s],["L",R+u-x,s],["A",x,x,0,0,1,R+u,s+x],["L",R+u,s+p-x],["A",x,x,0,0,1,R+u-x,s+p],["L",R+x,s+p],["A",x,x,0,0,1,R,s+p-x],["L",R,s+x],["A",x,x,0,0,1,R+x,s],["Z"]]}let lh={arc:Eu,callout:function(R,s,u,p,y){let x=Math.min((y==null?void 0:y.r)||0,u,p),E=x+6,S=y==null?void 0:y.anchorX,C=(y==null?void 0:y.anchorY)||0,L=ah(R,s,u,p,{r:x});if(!Mf(S)||S<u&&S>0&&C<p&&C>0)return L;if(R+S>u-E)if(C>s+E&&C<s+p-E)L.splice(3,1,["L",R+u,C-6],["L",R+u+6,C],["L",R+u,C+6],["L",R+u,s+p-x]);else if(S<u){let N=C<s+E,z=N?s:s+p;L.splice(N?2:5,0,["L",S,C],["L",R+u-x,z])}else L.splice(3,1,["L",R+u,p/2],["L",S,C],["L",R+u,p/2],["L",R+u,s+p-x]);else if(R+S<E)if(C>s+E&&C<s+p-E)L.splice(7,1,["L",R,C+6],["L",R-6,C],["L",R,C-6],["L",R,s+x]);else if(S>0){let N=C<s+E,z=N?s:s+p;L.splice(N?1:6,0,["L",S,C],["L",R+x,z])}else L.splice(7,1,["L",R,p/2],["L",S,C],["L",R,p/2],["L",R,s+x]);else C>p&&S<u-E?L.splice(5,1,["L",S+6,s+p],["L",S,s+p+6],["L",S-6,s+p],["L",R+x,s+p]):C<0&&S>E&&L.splice(1,1,["L",S-6,s],["L",S,s-6],["L",S+6,s],["L",u-x,s]);return L},circle:function(R,s,u,p){return Eu(R+u/2,s+p/2,u/2,p/2,{start:.5*Math.PI,end:2.5*Math.PI,open:!1})},diamond:function(R,s,u,p){return[["M",R+u/2,s],["L",R+u,s+p/2],["L",R+u/2,s+p],["L",R,s+p/2],["Z"]]},rect:oh,roundedRect:ah,square:oh,triangle:function(R,s,u,p){return[["M",R+u/2,s],["L",R+u,s+p],["L",R,s+p],["Z"]]},"triangle-down":function(R,s,u,p){return[["M",R,s],["L",R+u,s],["L",R+u/2,s+p],["Z"]]}},{doc:fa,SVG_NS:ch,win:Ba}=Ne,{attr:io,extend:Fa,fireEvent:hh,isString:Qd,objectEach:mc,pick:Su}=me,gc=(R,s)=>R.substring(0,s)+"",uh=class{constructor(R){let s=R.styles;this.renderer=R.renderer,this.svgElement=R,this.width=R.textWidth,this.textLineHeight=s==null?void 0:s.lineHeight,this.textOutline=s==null?void 0:s.textOutline,this.ellipsis=(s==null?void 0:s.textOverflow)==="ellipsis",this.lineClamp=s==null?void 0:s.lineClamp,this.noWrap=(s==null?void 0:s.whiteSpace)==="nowrap"}buildSVG(){let R=this.svgElement,s=R.element,u=R.renderer,p=Su(R.textStr,"").toString(),y=p.indexOf("<")!==-1,x=s.childNodes,E=!R.added&&u.box,S=[p,this.ellipsis,this.noWrap,this.textLineHeight,this.textOutline,R.getStyle("font-size"),R.styles.lineClamp,this.width].join(",");if(S!==R.textCache){R.textCache=S,delete R.actualWidth;for(let C=x.length;C--;)s.removeChild(x[C]);if(y||this.ellipsis||this.width||R.textPath||p.indexOf(" ")!==-1&&(!this.noWrap||/<br.*?>/g.test(p))){if(p!==""){E&&E.appendChild(s);let C=new Dr(p);this.modifyTree(C.nodes),C.addToDOM(s),this.modifyDOM(),this.ellipsis&&(s.textContent||"").indexOf("")!==-1&&R.attr("title",this.unescapeEntities(R.textStr||"",["&lt;","&gt;"])),E&&E.removeChild(s)}}else s.appendChild(fa.createTextNode(this.unescapeEntities(p)));Qd(this.textOutline)&&R.applyTextOutline&&R.applyTextOutline(this.textOutline)}}modifyDOM(){let R,s=this.svgElement,u=io(s.element,"x");for(s.firstLineMetrics=void 0;(R=s.element.firstChild)&&/^[\s\u200B]*$/.test(R.textContent||" ");)s.element.removeChild(R);[].forEach.call(s.element.querySelectorAll("tspan.highcharts-br"),(E,S)=>{E.nextSibling&&E.previousSibling&&(S===0&&E.previousSibling.nodeType===1&&(s.firstLineMetrics=s.renderer.fontMetrics(E.previousSibling)),io(E,{dy:this.getLineHeight(E.nextSibling),x:u}))});let p=this.width||0;if(!p)return;let y=(E,S)=>{var re;let C=E.textContent||"",L=C.replace(/([^\^])-/g,"$1- ").split(" "),N=!this.noWrap&&(L.length>1||s.element.childNodes.length>1),z=this.getLineHeight(S),j=Math.max(0,p-.8*z),W=0,Y=s.actualWidth;if(N){let te=[],Q=[];for(;S.firstChild&&S.firstChild!==E;)Q.push(S.firstChild),S.removeChild(S.firstChild);for(;L.length;)if(L.length&&!this.noWrap&&W>0&&(te.push(E.textContent||""),E.textContent=L.join(" ").replace(/- /g,"-")),this.truncate(E,void 0,L,W===0&&Y||0,p,j,(ae,he)=>L.slice(0,he).join(" ").replace(/- /g,"-")),Y=s.actualWidth,W++,this.lineClamp&&W>=this.lineClamp){L.length&&(this.truncate(E,E.textContent||"",void 0,0,p,j,gc),E.textContent=((re=E.textContent)==null?void 0:re.replace("",""))+"");break}Q.forEach(ae=>{S.insertBefore(ae,E)}),te.forEach(ae=>{S.insertBefore(fa.createTextNode(ae),E);let he=fa.createElementNS(ch,"tspan");he.textContent="",io(he,{dy:z,x:u}),S.insertBefore(he,E)})}else this.ellipsis&&C&&this.truncate(E,C,void 0,0,p,j,gc)},x=E=>{[].slice.call(E.childNodes).forEach(S=>{S.nodeType===Ba.Node.TEXT_NODE?y(S,E):(S.className.baseVal.indexOf("highcharts-br")!==-1&&(s.actualWidth=0),x(S))})};x(s.element)}getLineHeight(R){let s=R.nodeType===Ba.Node.TEXT_NODE?R.parentElement:R;return this.textLineHeight?parseInt(this.textLineHeight.toString(),10):this.renderer.fontMetrics(s||this.svgElement.element).h}modifyTree(R){let s=(u,p)=>{let{attributes:y={},children:x,style:E={},tagName:S}=u,C=this.renderer.styledMode;if(S==="b"||S==="strong"?C?y.class="highcharts-strong":E.fontWeight="bold":(S==="i"||S==="em")&&(C?y.class="highcharts-emphasized":E.fontStyle="italic"),E!=null&&E.color&&(E.fill=E.color),S==="br"){y.class="highcharts-br",u.textContent="";let L=R[p+1];L!=null&&L.textContent&&(L.textContent=L.textContent.replace(/^ +/gm,""))}else S==="a"&&x&&x.some(L=>L.tagName==="#text")&&(u.children=[{children:x,tagName:"tspan"}]);S!=="#text"&&S!=="a"&&(u.tagName="tspan"),Fa(u,{attributes:y,style:E}),x&&x.filter(L=>L.tagName!=="#text").forEach(s)};R.forEach(s),hh(this.svgElement,"afterModifyTree",{nodes:R})}truncate(R,s,u,p,y,x,E){let S,C,L=this.svgElement,{rotation:N}=L,z=[],j=u&&!p?1:0,W=(s||u||"").length,Y=W;u||(y=x);let re=function(te,Q){let ae=Q||te,he=R.parentNode;if(he&&z[ae]===void 0&&he.getSubStringLength)try{z[ae]=p+he.getSubStringLength(0,u?ae+1:ae)}catch{}return z[ae]};if(L.rotation=0,p+(C=re(R.textContent.length))>y){for(;j<=W;)Y=Math.ceil((j+W)/2),u&&(S=E(u,Y)),C=re(Y,S&&S.length-1),j===W?j=W+1:C>y?W=Y-1:j=Y;W===0?R.textContent="":s&&W===s.length-1||(R.textContent=S||E(s||u,Y)),this.ellipsis&&C>y&&this.truncate(R,R.textContent||"",void 0,0,y,x,gc)}u&&u.splice(0,Y),L.actualWidth=C,L.rotation=N}unescapeEntities(R,s){return mc(this.renderer.escapes,function(u,p){s&&s.indexOf(u)!==-1||(R=R.toString().replace(RegExp(u,"g"),p))}),R}},{defaultOptions:dh}=Ee,{charts:Au,deg2rad:nr,doc:Mo,isFirefox:Mu,isMS:ph,isWebKit:ep,noop:Na,SVG_NS:Cu,symbolSizes:ku,win:Pu}=Ne,{addEvent:fh,attr:El,createElement:Iu,crisp:mh,css:Ua,defined:ma,destroyObjectProperties:tp,extend:ja,isArray:_c,isNumber:ro,isObject:Va,isString:yc,merge:xc,pick:zn,pInt:gh,replaceNested:Lu,uniqueKey:_h}=me;class vc{constructor(s,u,p,y,x,E,S){let C,L;this.x=0,this.y=0;let N=this.createElement("svg").attr({version:"1.1",class:"highcharts-root"}),z=N.element;S||N.css(this.getStyle(y||{})),s.appendChild(z),El(s,"dir","ltr"),s.innerHTML.indexOf("xmlns")===-1&&El(z,"xmlns",this.SVG_NS),this.box=z,this.boxWrapper=N,this.alignedObjects=[],this.url=this.getReferenceURL(),this.createElement("desc").add().element.appendChild(Mo.createTextNode("Created with Highcharts 12.2.0")),this.defs=this.createElement("defs").add(),this.allowHTML=E,this.forExport=x,this.styledMode=S,this.gradients={},this.cache={},this.cacheKeys=[],this.imgCount=0,this.rootFontSize=N.getStyle("font-size"),this.setSize(u,p,!1),Mu&&s.getBoundingClientRect&&((C=function(){Ua(s,{left:0,top:0}),L=s.getBoundingClientRect(),Ua(s,{left:Math.ceil(L.left)-L.left+"px",top:Math.ceil(L.top)-L.top+"px"})})(),this.unSubPixelFix=fh(Pu,"resize",C))}definition(s){return new Dr([s]).addToDOM(this.defs.element)}getReferenceURL(){if((Mu||ep)&&Mo.getElementsByTagName("base").length){if(!ma(w)){let s=_h(),u=new Dr([{tagName:"svg",attributes:{width:8,height:8},children:[{tagName:"defs",children:[{tagName:"clipPath",attributes:{id:s},children:[{tagName:"rect",attributes:{width:4,height:4}}]}]},{tagName:"rect",attributes:{id:"hitme",width:8,height:8,"clip-path":`url(#${s})`,fill:"rgba(0,0,0,0.001)"}}]}]).addToDOM(Mo.body);Ua(u,{position:"fixed",top:0,left:0,zIndex:9e5});let p=Mo.elementFromPoint(6,6);w=(p==null?void 0:p.id)==="hitme",Mo.body.removeChild(u)}if(w)return Lu(Pu.location.href.split("#")[0],[/<[^>]*>/g,""],[/([\('\)])/g,"\\$1"],[/ /g,"%20"])}return""}getStyle(s){return this.style=ja({fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif',fontSize:"1rem"},s),this.style}setStyle(s){this.boxWrapper.css(this.getStyle(s))}isHidden(){return!this.boxWrapper.getBBox().width}destroy(){let s=this.defs;return this.box=null,this.boxWrapper=this.boxWrapper.destroy(),tp(this.gradients||{}),this.gradients=null,this.defs=s.destroy(),this.unSubPixelFix&&this.unSubPixelFix(),this.alignedObjects=null,null}createElement(s){return new this.Element(this,s)}getRadialAttr(s,u){return{cx:s[0]-s[2]/2+(u.cx||0)*s[2],cy:s[1]-s[2]/2+(u.cy||0)*s[2],r:(u.r||0)*s[2]}}shadowDefinition(s){let u=[`highcharts-drop-shadow-${this.chartIndex}`,...Object.keys(s).map(y=>`${y}-${s[y]}`)].join("-").toLowerCase().replace(/[^a-z\d\-]/g,""),p=xc({color:"#000000",offsetX:1,offsetY:1,opacity:.15,width:5},s);return this.defs.element.querySelector(`#${u}`)||this.definition({tagName:"filter",attributes:{id:u,filterUnits:p.filterUnits},children:this.getShadowFilterContent(p)}),u}getShadowFilterContent(s){return[{tagName:"feDropShadow",attributes:{dx:s.offsetX,dy:s.offsetY,"flood-color":s.color,"flood-opacity":Math.min(5*s.opacity,1),stdDeviation:s.width/2}}]}buildText(s){new uh(s).buildSVG()}getContrast(s){let u=Ye.parse(s).rgba,p=" clamp(0,calc(9e9*(0.5 - (0.2126*r + 0.7152*g + 0.0722*b))),1)";if(ro(u[0])||!Ye.useColorMix){let y=u.map(E=>{let S=E/255;return S<=.04?S/12.92:Math.pow((S+.055)/1.055,2.4)}),x=.2126*y[0]+.7152*y[1]+.0722*y[2];return 1.05/(x+.05)>(x+.05)/.05?"#FFFFFF":"#000000"}return"color(from "+s+" srgb"+p+p+p+")"}button(s,u,p,y,x={},E,S,C,L,N){let z=this.label(s,u,p,L,void 0,void 0,N,void 0,"button"),j=this.styledMode,W=arguments,Y=0;x=xc(dh.global.buttonTheme,x),j&&(delete x.fill,delete x.stroke,delete x["stroke-width"]);let re=x.states||{},te=x.style||{};delete x.states,delete x.style;let Q=[Dr.filterUserAttributes(x)],ae=[te];return j||["hover","select","disabled"].forEach((he,Ue)=>{Q.push(xc(Q[0],Dr.filterUserAttributes(W[Ue+5]||re[he]||{}))),ae.push(Q[Ue+1].style),delete Q[Ue+1].style}),fh(z.element,ph?"mouseover":"mouseenter",function(){Y!==3&&z.setState(1)}),fh(z.element,ph?"mouseout":"mouseleave",function(){Y!==3&&z.setState(Y)}),z.setState=(he=0)=>{if(he!==1&&(z.state=Y=he),z.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][he]),!j){z.attr(Q[he]);let Ue=ae[he];Va(Ue)&&z.css(Ue)}},z.attr(Q[0]),!j&&(z.css(ja({cursor:"default"},te)),N&&z.text.css({pointerEvents:"none"})),z.on("touchstart",he=>he.stopPropagation()).on("click",function(he){Y!==3&&(y==null||y.call(z,he))})}crispLine(s,u){let[p,y]=s;return ma(p[1])&&p[1]===y[1]&&(p[1]=y[1]=mh(p[1],u)),ma(p[2])&&p[2]===y[2]&&(p[2]=y[2]=mh(p[2],u)),s}path(s){let u=this.styledMode?{}:{fill:"none"};return _c(s)?u.d=s:Va(s)&&ja(u,s),this.createElement("path").attr(u)}circle(s,u,p){let y=Va(s)?s:s===void 0?{}:{x:s,y:u,r:p},x=this.createElement("circle");return x.xSetter=x.ySetter=function(E,S,C){C.setAttribute("c"+S,E)},x.attr(y)}arc(s,u,p,y,x,E){let S;Va(s)?(u=(S=s).y,p=S.r,y=S.innerR,x=S.start,E=S.end,s=S.x):S={innerR:y,start:x,end:E};let C=this.symbol("arc",s,u,p,p,S);return C.r=p,C}rect(s,u,p,y,x,E){let S=Va(s)?s:s===void 0?{}:{x:s,y:u,r:x,width:Math.max(p||0,0),height:Math.max(y||0,0)},C=this.createElement("rect");return this.styledMode||(E!==void 0&&(S["stroke-width"]=E,ja(S,C.crisp(S))),S.fill="none"),C.rSetter=function(L,N,z){C.r=L,El(z,{rx:L,ry:L})},C.rGetter=function(){return C.r||0},C.attr(S)}roundedRect(s){return this.symbol("roundedRect").attr(s)}setSize(s,u,p){this.width=s,this.height=u,this.boxWrapper.animate({width:s,height:u},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:zn(p,!0)?void 0:0}),this.alignElements()}g(s){let u=this.createElement("g");return s?u.attr({class:"highcharts-"+s}):u}image(s,u,p,y,x,E){let S={preserveAspectRatio:"none"};ro(u)&&(S.x=u),ro(p)&&(S.y=p),ro(y)&&(S.width=y),ro(x)&&(S.height=x);let C=this.createElement("image").attr(S),L=function(N){C.attr({href:s}),E.call(C,N)};if(E){C.attr({href:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="});let N=new Pu.Image;fh(N,"load",L),N.src=s,N.complete&&L({})}else C.attr({href:s});return C}symbol(s,u,p,y,x,E){var te,Q;let S,C,L,N,z=this,j=/^url\((.*?)\)$/,W=j.test(s),Y=!W&&(this.symbols[s]?s:"circle"),re=Y&&this.symbols[Y];if(re)typeof u=="number"&&(C=re.call(this.symbols,u||0,p||0,y||0,x||0,E)),S=this.path(C),z.styledMode||S.attr("fill","none"),ja(S,{symbolName:Y||void 0,x:u,y:p,width:y,height:x}),E&&ja(S,E);else if(W){L=s.match(j)[1];let ae=S=this.image(L);ae.imgwidth=zn(E==null?void 0:E.width,(te=ku[L])==null?void 0:te.width),ae.imgheight=zn(E==null?void 0:E.height,(Q=ku[L])==null?void 0:Q.height),N=he=>he.attr({width:he.width,height:he.height}),["width","height"].forEach(he=>{ae[`${he}Setter`]=function(Ue,Ie){this[Ie]=Ue;let{alignByTranslate:Re,element:rt,width:qe,height:st,imgwidth:Et,imgheight:Bt}=this,$t=Ie==="width"?Et:Bt,At=1;E&&E.backgroundSize==="within"&&qe&&st&&Et&&Bt?(At=Math.min(qe/Et,st/Bt),El(rt,{width:Math.round(Et*At),height:Math.round(Bt*At)})):rt&&$t&&rt.setAttribute(Ie,$t),!Re&&Et&&Bt&&this.translate(((qe||0)-Et*At)/2,((st||0)-Bt*At)/2)}}),ma(u)&&ae.attr({x:u,y:p}),ae.isImg=!0,ae.symbolUrl=s,ma(ae.imgwidth)&&ma(ae.imgheight)?N(ae):(ae.attr({width:0,height:0}),Iu("img",{onload:function(){let he=Au[z.chartIndex];this.width===0&&(Ua(this,{position:"absolute",top:"-999em"}),Mo.body.appendChild(this)),ku[L]={width:this.width,height:this.height},ae.imgwidth=this.width,ae.imgheight=this.height,ae.element&&N(ae),this.parentNode&&this.parentNode.removeChild(this),z.imgCount--,z.imgCount||!he||he.hasLoaded||he.onload()},src:L}),this.imgCount++)}return S}clipRect(s,u,p,y){return this.rect(s,u,p,y,0)}text(s,u,p,y){let x={};if(y&&(this.allowHTML||!this.forExport))return this.html(s,u,p);x.x=Math.round(u||0),p&&(x.y=Math.round(p)),ma(s)&&(x.text=s);let E=this.createElement("text").attr(x);return y&&(!this.forExport||this.allowHTML)||(E.xSetter=function(S,C,L){let N=L.getElementsByTagName("tspan"),z=L.getAttribute(C);for(let j=0,W;j<N.length;j++)(W=N[j]).getAttribute(C)===z&&W.setAttribute(C,S);L.setAttribute(C,S)}),E}fontMetrics(s){let u=gh(js.prototype.getStyle.call(s,"font-size")||0),p=u<24?u+3:Math.round(1.2*u),y=Math.round(.8*p);return{h:p,b:y,f:u}}rotCorr(s,u,p){let y=s;return u&&p&&(y=Math.max(y*Math.cos(u*nr),4)),{x:-s/3*Math.sin(u*nr),y}}pathToSegments(s){let u=[],p=[],y={A:8,C:7,H:2,L:3,M:3,Q:5,S:5,T:3,V:2};for(let x=0;x<s.length;x++)yc(p[0])&&ro(s[x])&&p.length===y[p[0].toUpperCase()]&&s.splice(x,0,p[0].replace("M","L").replace("m","l")),typeof s[x]=="string"&&(p.length&&u.push(p.slice(0)),p.length=0),p.push(s[x]);return u.push(p.slice(0)),u}label(s,u,p,y,x,E,S,C,L){return new Rn(this,s,u,p,y,x,E,S,C,L)}alignElements(){this.alignedObjects.forEach(s=>s.align())}}ja(vc.prototype,{Element:js,SVG_NS:Cu,escapes:{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},symbols:lh,draw:Na}),Qn.registerRendererType("svg",vc,!0);let{composed:Du,isFirefox:Cf}=Ne,{attr:Ru,css:so,createElement:bc,defined:zu,extend:Ou,getAlignFactor:kf,isNumber:Sl,pInt:ip,pushUnique:wc}=me;function Bu(R,s,u){var y;let p=((y=this.div)==null?void 0:y.style)||u.style;js.prototype[`${s}Setter`].call(this,R,s,u),p&&(p[s]=R)}let yh=(R,s)=>{var u;if(!R.div){let p=Ru(R.element,"class"),y=R.css,x=bc("div",p?{className:p}:void 0,{position:"absolute",left:`${R.translateX||0}px`,top:`${R.translateY||0}px`,...R.styles,display:R.display,opacity:R.opacity,visibility:R.visibility},((u=R.parentGroup)==null?void 0:u.div)||s);R.classSetter=(E,S,C)=>{C.setAttribute("class",E),x.className=E},R.translateXSetter=R.translateYSetter=(E,S)=>{R[S]=E,x.style[S==="translateX"?"left":"top"]=`${E}px`,R.doTransform=!0},R.opacitySetter=R.visibilitySetter=Bu,R.css=E=>(y.call(R,E),E.cursor&&(x.style.cursor=E.cursor),E.pointerEvents&&(x.style.pointerEvents=E.pointerEvents),R),R.on=function(){return js.prototype.on.apply({element:x,onEvents:R.onEvents},arguments),R},R.div=x}return R.div};class Ga extends js{static compose(s){wc(Du,this.compose)&&(s.prototype.html=function(u,p,y){return new Ga(this,"span").attr({text:u,x:Math.round(p),y:Math.round(y)})})}constructor(s,u){super(s,u),Ga.useForeignObject?this.foreignObject=s.createElement("foreignObject").attr({zIndex:2}):this.css({position:"absolute",...s.styledMode?{}:{fontFamily:s.style.fontFamily,fontSize:s.style.fontSize}}),this.element.style.whiteSpace="nowrap"}getSpanCorrection(s,u,p){this.xCorr=-s*p,this.yCorr=-u}css(s){let u,{element:p}=this,y=p.tagName==="SPAN"&&s&&"width"in s,x=y&&s.width;return y&&(delete s.width,this.textWidth=ip(x)||void 0,u=!0),(s==null?void 0:s.textOverflow)==="ellipsis"&&(s.overflow="hidden",s.whiteSpace="nowrap"),s!=null&&s.lineClamp&&(s.display="-webkit-box",s.WebkitLineClamp=s.lineClamp,s.WebkitBoxOrient="vertical",s.overflow="hidden"),Sl(Number(s==null?void 0:s.fontSize))&&(s.fontSize+="px"),Ou(this.styles,s),so(p,s),u&&this.updateTransform(),this}htmlGetBBox(){let{element:s}=this;return{x:s.offsetLeft,y:s.offsetTop,width:s.offsetWidth,height:s.offsetHeight}}updateTransform(){var ae;if(!this.added){this.alignOnAdd=!0;return}let{element:s,foreignObject:u,oldTextWidth:p,renderer:y,rotation:x,rotationOriginX:E,rotationOriginY:S,scaleX:C,scaleY:L,styles:{display:N="inline-block",whiteSpace:z},textAlign:j="left",textWidth:W,translateX:Y=0,translateY:re=0,x:te=0,y:Q=0}=this;if(u||so(s,{marginLeft:`${Y}px`,marginTop:`${re}px`}),s.tagName==="SPAN"){let he,Ue=[x,j,s.innerHTML,W,this.textAlign].join(","),Ie=-(((ae=this.parentGroup)==null?void 0:ae.padding)*1)||0;if(W!==p){let st=this.textPxLength?this.textPxLength:(so(s,{width:"",whiteSpace:z||"nowrap"}),s.offsetWidth),Et=W||0,Bt=s.style.textOverflow===""&&s.style.webkitLineClamp;(Et>p||st>Et||Bt)&&(/[\-\s\u00AD]/.test(s.textContent||s.innerText)||s.style.textOverflow==="ellipsis")&&(so(s,{width:(x||C||st>Et||Bt)&&Sl(W)?W+"px":"auto",display:N,whiteSpace:z||"normal"}),this.oldTextWidth=W)}u&&(so(s,{display:"inline-block",verticalAlign:"top"}),u.attr({width:y.width,height:y.height})),Ue!==this.cTT&&(he=y.fontMetrics(s).b,zu(x)&&!u&&(x!==(this.oldRotation||0)||j!==this.oldAlign)&&so(s,{transform:`rotate(${x}deg)`,transformOrigin:`${Ie}% ${Ie}px`}),this.getSpanCorrection(!zu(x)&&!this.textWidth&&this.textPxLength||s.offsetWidth,he,kf(j)));let{xCorr:Re=0,yCorr:rt=0}=this,qe={left:`${te+Re}px`,top:`${Q+rt}px`,textAlign:j,transformOrigin:`${(E??te)-Re-te-Ie}px ${(S??Q)-rt-Q-Ie}px`};(C||L)&&(qe.transform=`scale(${C??1},${L??1})`),u?(super.updateTransform(),Sl(te)&&Sl(Q)?(u.attr({x:te+Re,y:Q+rt,width:s.offsetWidth+3,height:s.offsetHeight,"transform-origin":s.getAttribute("transform-origin")||"0 0"}),so(s,{display:N,textAlign:j})):Cf&&u.attr({width:0,height:0})):so(s,qe),this.cTT=Ue,this.oldRotation=x,this.oldAlign=j}}add(s){let{foreignObject:u,renderer:p}=this,y=p.box.parentNode,x=[];if(u)u.add(s),super.add(p.createElement("body").attr({xmlns:"http://www.w3.org/1999/xhtml"}).css({background:"transparent",margin:"0 3px 0 0"}).add(u));else{let E;if(this.parentGroup=s,s&&!(E=s.div)){let S=s;for(;S;)x.push(S),S=S.parentGroup;for(let C of x.reverse())E=yh(C,y)}(E||y).appendChild(this.element)}return this.added=!0,this.alignOnAdd&&this.updateTransform(),this}textSetter(s){s!==this.textStr&&(delete this.bBox,delete this.oldTextWidth,Dr.setElementHTML(this.element,s??""),this.textStr=s,this.doTransform=!0)}alignSetter(s){this.alignValue=this.textAlign=s,this.doTransform=!0}xSetter(s,u){this[u]=s,this.doTransform=!0}}let On=Ga.prototype;On.visibilitySetter=On.opacitySetter=Bu,On.ySetter=On.rotationSetter=On.rotationOriginXSetter=On.rotationOriginYSetter=On.xSetter,function(R){R.xAxis={alignTicks:!0,allowDecimals:void 0,panningEnabled:!0,zIndex:2,zoomEnabled:!0,dateTimeLabelFormats:{millisecond:{main:"%[HMSL]",range:!1},second:{main:"%[HMS]",range:!1},minute:{main:"%[HM]",range:!1},hour:{main:"%[HM]",range:!1},day:{main:"%[eb]"},week:{main:"%[eb]"},month:{main:"%[bY]"},year:{main:"%Y"}},endOnTick:!1,gridLineDashStyle:"Solid",gridZIndex:1,labels:{autoRotationLimit:80,distance:15,enabled:!0,indentation:10,overflow:"justify",reserveSpace:void 0,rotation:void 0,staggerLines:0,step:0,useHTML:!1,zIndex:7,style:{color:"#333333",cursor:"default",fontSize:"0.8em",textOverflow:"ellipsis"}},maxPadding:.01,minorGridLineDashStyle:"Solid",minorTickLength:2,minorTickPosition:"outside",minorTicksPerMajor:5,minPadding:.01,offset:void 0,reversed:void 0,reversedStacks:!1,showEmpty:!0,showFirstLabel:!0,showLastLabel:!0,startOfWeek:1,startOnTick:!1,tickLength:10,tickPixelInterval:100,tickmarkPlacement:"between",tickPosition:"outside",title:{align:"middle",useHTML:!1,x:0,y:0,style:{color:"#666666",fontSize:"0.8em"}},visible:!0,minorGridLineColor:"#f2f2f2",minorGridLineWidth:1,minorTickColor:"#999999",lineColor:"#333333",lineWidth:1,gridLineColor:"#e6e6e6",gridLineWidth:void 0,tickColor:"#333333"},R.yAxis={reversedStacks:!0,endOnTick:!0,maxPadding:.05,minPadding:.05,tickPixelInterval:72,showLastLabel:!0,labels:{x:void 0},startOnTick:!0,title:{},stackLabels:{animation:{},allowOverlap:!1,enabled:!1,crop:!0,overflow:"justify",formatter:function(){let{numberFormatter:s}=this.axis.chart;return s(this.total||0,-1)},style:{color:"#000000",fontSize:"0.7em",fontWeight:"bold",textOutline:"1px contrast"}},gridLineWidth:1,lineWidth:0}}(q||(q={}));let Pf=q,{addEvent:If,isFunction:Lf,objectEach:Df,removeEvent:Rf}=me;(o||(o={})).registerEventOptions=function(R,s){R.eventOptions=R.eventOptions||{},Df(s.events,function(u,p){R.eventOptions[p]!==u&&(R.eventOptions[p]&&(Rf(R,p,R.eventOptions[p]),delete R.eventOptions[p]),Lf(u)&&(R.eventOptions[p]=u,If(R,p,u,{order:0})))})};let Tc=o,{deg2rad:Al}=Ne,{clamp:Ml,correctFloat:Ec,defined:xh,destroyObjectProperties:Yo,extend:Sc,fireEvent:Ks,getAlignFactor:Ac,isNumber:Mc,merge:$a,objectEach:Cl,pick:Mn}=me,Ko=class{constructor(R,s,u,p,y){this.isNew=!0,this.isNewLabel=!0,this.axis=R,this.pos=s,this.type=u||"",this.parameters=y||{},this.tickmarkOffset=this.parameters.tickmarkOffset,this.options=this.parameters.options,Ks(this,"init"),u||p||this.addLabel()}addLabel(){var rt;let R=this,s=R.axis,u=s.options,p=s.chart,y=s.categories,x=s.logarithmic,E=s.names,S=R.pos,C=Mn((rt=R.options)==null?void 0:rt.labels,u.labels),L=s.tickPositions,N=S===L[0],z=S===L[L.length-1],j=(!C.step||C.step===1)&&s.tickInterval===1,W=L.info,Y=R.label,re,te,Q,ae=this.parameters.category||(y?Mn(y[S],E[S],S):S);x&&Mc(ae)&&(ae=Ec(x.lin2log(ae))),s.dateTime&&(W?re=(te=p.time.resolveDTLFormat(u.dateTimeLabelFormats[!u.grid&&W.higherRanks[S]||W.unitName])).main:Mc(ae)&&(re=s.dateTime.getXDateFormat(ae,u.dateTimeLabelFormats||{}))),R.isFirst=N,R.isLast=z;let he={axis:s,chart:p,dateTimeLabelFormat:re,isFirst:N,isLast:z,pos:S,tick:R,tickPositionInfo:W,value:ae};Ks(this,"labelFormat",he);let Ue=qe=>C.formatter?C.formatter.call(qe,qe):C.format?(qe.text=s.defaultLabelFormatter.call(qe),Ys.format(C.format,qe,p)):s.defaultLabelFormatter.call(qe),Ie=Ue.call(he,he),Re=te==null?void 0:te.list;Re?R.shortenLabel=function(){for(Q=0;Q<Re.length;Q++)if(Sc(he,{dateTimeLabelFormat:Re[Q]}),Y.attr({text:Ue.call(he,he)}),Y.getBBox().width<s.getSlotWidth(R)-2*(C.padding||0))return;Y.attr({text:""})}:R.shortenLabel=void 0,j&&s._addedPlotLB&&R.moveLabel(Ie,C),xh(Y)||R.movedLabel?Y&&Y.textStr!==Ie&&!j&&(!Y.textWidth||C.style.width||Y.styles.width||Y.css({width:null}),Y.attr({text:Ie}),Y.textPxLength=Y.getBBox().width):(R.label=Y=R.createLabel(Ie,C),R.rotation=0)}createLabel(R,s,u){let p=this.axis,{renderer:y,styledMode:x}=p.chart,E=s.style.whiteSpace,S=xh(R)&&s.enabled?y.text(R,u==null?void 0:u.x,u==null?void 0:u.y,s.useHTML).add(p.labelGroup):void 0;return S&&(x||S.css($a(s.style)),S.textPxLength=S.getBBox().width,!x&&E&&S.css({whiteSpace:E})),S}destroy(){Yo(this,this.axis)}getPosition(R,s,u,p){let y=this.axis,x=y.chart,E=p&&x.oldChartHeight||x.chartHeight,S={x:R?Ec(y.translate(s+u,void 0,void 0,p)+y.transB):y.left+y.offset+(y.opposite?(p&&x.oldChartWidth||x.chartWidth)-y.right-y.left:0),y:R?E-y.bottom+y.offset-(y.opposite?y.height:0):Ec(E-y.translate(s+u,void 0,void 0,p)-y.transB)};return S.y=Ml(S.y,-1e9,1e9),Ks(this,"afterGetPosition",{pos:S}),S}getLabelPosition(R,s,u,p,y,x,E,S){let C,L,N=this.axis,z=N.transA,j=N.isLinked&&N.linkedParent?N.linkedParent.reversed:N.reversed,W=N.staggerLines,Y=N.tickRotCorr||{x:0,y:0},re=p||N.reserveSpaceDefault?0:-N.labelOffset*(N.labelAlign==="center"?.5:1),te=y.distance,Q={};return C=N.side===0?u.rotation?-te:-u.getBBox().height:N.side===2?Y.y+te:Math.cos(u.rotation*Al)*(Y.y-u.getBBox(!1,0).height/2),xh(y.y)&&(C=N.side===0&&N.horiz?y.y+C:y.y),R=R+Mn(y.x,[0,1,0,-1][N.side]*te)+re+Y.x-(x&&p?x*z*(j?-1:1):0),s=s+C-(x&&!p?x*z*(j?1:-1):0),W&&(L=E/(S||1)%W,N.opposite&&(L=W-L-1),s+=L*(N.labelOffset/W)),Q.x=R,Q.y=Math.round(s),Ks(this,"afterGetLabelPosition",{pos:Q,tickmarkOffset:x,index:E}),Q}getLabelSize(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0}getMarkPath(R,s,u,p,y=!1,x){return x.crispLine([["M",R,s],["L",R+(y?0:-u),s+(y?u:0)]],p)}handleOverflow(R){var te;let s=this.axis,u=s.options.labels,p=R.x,y=s.chart.chartWidth,x=s.chart.spacing,E=Mn(s.labelLeft,Math.min(s.pos,x[3])),S=Mn(s.labelRight,Math.max(s.isRadial?0:s.pos+s.len,y-x[1])),C=this.label,L=this.rotation,N=Ac(s.labelAlign||C.attr("align")),z=C.getBBox().width,j=s.getSlotWidth(this),W=j,Y=1,re;L||u.overflow!=="justify"?L<0&&p-N*z<E?re=Math.round(p/Math.cos(L*Al)-E):L>0&&p+N*z>S&&(re=Math.round((y-p)/Math.cos(L*Al))):(p-N*z<E?W=R.x+W*(1-N)-E:p+(1-N)*z>S&&(W=S-R.x+W*N,Y=-1),(W=Math.min(j,W))<j&&s.labelAlign==="center"&&(R.x+=Y*(j-W-N*(j-Math.min(z,W)))),(z>W||s.autoRotation&&((te=C==null?void 0:C.styles)!=null&&te.width))&&(re=W)),re&&C&&(this.shortenLabel?this.shortenLabel():C.css(Sc({},{width:Math.floor(re)+"px",lineClamp:+!s.isRadial})))}moveLabel(R,s){let u=this,p=u.label,y=u.axis,x=!1,E;p&&p.textStr===R?(u.movedLabel=p,x=!0,delete u.label):Cl(y.ticks,function(S){x||S.isNew||S===u||!S.label||S.label.textStr!==R||(u.movedLabel=S.label,x=!0,S.labelPos=u.movedLabel.xy,delete S.label)}),!x&&(u.labelPos||p)&&(E=u.labelPos||p.xy,u.movedLabel=u.createLabel(R,s,E),u.movedLabel&&u.movedLabel.attr({opacity:0}))}render(R,s,u){var Y;let p=this.axis,y=p.horiz,x=this.pos,E=Mn(this.tickmarkOffset,p.tickmarkOffset),S=this.getPosition(y,x,E,s),C=S.x,L=S.y,N=p.pos,z=N+p.len,j=y?C:L,W=Mn(u,(Y=this.label)==null?void 0:Y.newOpacity,1);!p.chart.polar&&(Ec(j)<N||j>z)&&(u=0),u??(u=1),this.isActive=!0,this.renderGridLine(s,u),this.renderMark(S,u),this.renderLabel(S,s,W,R),this.isNew=!1,Ks(this,"afterRender")}renderGridLine(R,s){let u=this.axis,p=u.options,y={},x=this.pos,E=this.type,S=Mn(this.tickmarkOffset,u.tickmarkOffset),C=u.chart.renderer,L=this.gridLine,N,z=p.gridLineWidth,j=p.gridLineColor,W=p.gridLineDashStyle;this.type==="minor"&&(z=p.minorGridLineWidth,j=p.minorGridLineColor,W=p.minorGridLineDashStyle),L||(u.chart.styledMode||(y.stroke=j,y["stroke-width"]=z||0,y.dashstyle=W),E||(y.zIndex=1),R&&(s=0),this.gridLine=L=C.path().attr(y).addClass("highcharts-"+(E?E+"-":"")+"grid-line").add(u.gridGroup)),L&&(N=u.getPlotLinePath({value:x+S,lineWidth:L.strokeWidth(),force:"pass",old:R,acrossPanes:!1}))&&L[R||this.isNew?"attr":"animate"]({d:N,opacity:s})}renderMark(R,s){let u=this.axis,p=u.options,y=u.chart.renderer,x=this.type,E=u.tickSize(x?x+"Tick":"tick"),S=R.x,C=R.y,L=Mn(p[x!=="minor"?"tickWidth":"minorTickWidth"],!x&&u.isXAxis?1:0),N=p[x!=="minor"?"tickColor":"minorTickColor"],z=this.mark,j=!z;E&&(u.opposite&&(E[0]=-E[0]),z||(this.mark=z=y.path().addClass("highcharts-"+(x?x+"-":"")+"tick").add(u.axisGroup),u.chart.styledMode||z.attr({stroke:N,"stroke-width":L})),z[j?"attr":"animate"]({d:this.getMarkPath(S,C,E[0],z.strokeWidth(),u.horiz,y),opacity:s}))}renderLabel(R,s,u,p){let y=this.axis,x=y.horiz,E=y.options,S=this.label,C=E.labels,L=C.step,N=Mn(this.tickmarkOffset,y.tickmarkOffset),z=R.x,j=R.y,W=!0;S&&Mc(z)&&(S.xy=R=this.getLabelPosition(z,j,S,x,C,N,p,L),(!this.isFirst||this.isLast||E.showFirstLabel)&&(!this.isLast||this.isFirst||E.showLastLabel)?!x||C.step||C.rotation||s||u===0||this.handleOverflow(R):W=!1,L&&p%L&&(W=!1),W&&Mc(R.y)?(R.opacity=u,S[this.isNewLabel?"attr":"animate"](R).show(!0),this.isNewLabel=!1):(S.hide(),this.isNewLabel=!0))}replaceMovedLabel(){let R=this.label,s=this.axis;R&&!this.isNew&&(R.animate({opacity:0},void 0,R.destroy),delete this.label),s.isDirty=!0,this.label=this.movedLabel,delete this.movedLabel}},{animObject:ur}=ls,{xAxis:kl,yAxis:rp}=Pf,{defaultOptions:Pl}=Ee,{registerEventOptions:Il}=Tc,{deg2rad:sp}=Ne,{arrayMax:Cc,arrayMin:Jo,clamp:vh,correctFloat:Js,defined:yr,destroyObjectProperties:Ll,erase:bh,error:Wa,extend:ga,fireEvent:Br,getClosestDistance:kc,insertItem:ti,isArray:Bn,isNumber:Mi,isString:Dl,merge:_a,normalizeTickInterval:Vs,objectEach:ya,pick:qi,relativeLength:Rl,removeEvent:wh,splat:np,syncTimeout:Th}=me,Ha=(R,s)=>Vs(s,void 0,void 0,qi(R.options.allowDecimals,s<.5||R.tickAmount!==void 0),!!R.tickAmount);ga(Pl,{xAxis:kl,yAxis:_a(kl,rp)});class xa{constructor(s,u,p){this.init(s,u,p)}init(s,u,p=this.coll){let y=p==="xAxis",x=this.isZAxis||(s.inverted?!y:y);this.chart=s,this.horiz=x,this.isXAxis=y,this.coll=p,Br(this,"init",{userOptions:u}),this.opposite=qi(u.opposite,this.opposite),this.side=qi(u.side,this.side,x?2*!this.opposite:this.opposite?1:3),this.setOptions(u);let E=this.options,S=E.labels;this.type??(this.type=E.type||"linear"),this.uniqueNames??(this.uniqueNames=E.uniqueNames??!0),Br(this,"afterSetType"),this.userOptions=u,this.minPixelPadding=0,this.reversed=qi(E.reversed,this.reversed),this.visible=E.visible,this.zoomEnabled=E.zoomEnabled,this.hasNames=this.type==="category"||E.categories===!0,this.categories=Bn(E.categories)&&E.categories||(this.hasNames?[]:void 0),this.names||(this.names=[],this.names.keys={}),this.plotLinesAndBandsGroups={},this.positiveValuesOnly=!!this.logarithmic,this.isLinked=yr(E.linkedTo),this.ticks={},this.labelEdge=[],this.minorTicks={},this.plotLinesAndBands=[],this.alternateBands={},this.len??(this.len=0),this.minRange=this.userMinRange=E.minRange||E.maxZoom,this.range=E.range,this.offset=E.offset||0,this.max=void 0,this.min=void 0;let C=qi(E.crosshair,np(s.options.tooltip.crosshairs)[+!y]);this.crosshair=C===!0?{}:C,s.axes.indexOf(this)===-1&&(y?s.axes.splice(s.xAxis.length,0,this):s.axes.push(this),ti(this,s[this.coll])),s.orderItems(this.coll),this.series=this.series||[],s.inverted&&!this.isZAxis&&y&&!yr(this.reversed)&&(this.reversed=!0),this.labelRotation=Mi(S.rotation)?S.rotation:void 0,Il(this,E),Br(this,"afterInit")}setOptions(s){let u=this.horiz?{labels:{autoRotation:[-45],padding:3},margin:15}:{labels:{padding:1},title:{rotation:90*this.side}};this.options=_a(u,this.coll==="yAxis"?{title:{text:this.chart.options.lang.yAxisTitle}}:{},Pl[this.coll],s),Br(this,"afterSetOptions",{userOptions:s})}defaultLabelFormatter(){let s=this.axis,{numberFormatter:u}=this.chart,p=Mi(this.value)?this.value:NaN,y=s.chart.time,x=s.categories,E=this.dateTimeLabelFormat,S=Pl.lang,C=S.numericSymbols,L=S.numericSymbolMagnitude||1e3,N=s.logarithmic?Math.abs(p):s.tickInterval,z=C==null?void 0:C.length,j,W;if(x)W=`${this.value}`;else if(E)W=y.dateFormat(E,p,!0);else if(z&&C&&N>=1e3)for(;z--&&W===void 0;)N>=(j=Math.pow(L,z+1))&&10*p%j==0&&C[z]!==null&&p!==0&&(W=u(p/j,-1)+C[z]);return W===void 0&&(W=Math.abs(p)>=1e4?u(p,-1):u(p,-1,void 0,"")),W}getSeriesExtremes(){let s,u=this;Br(this,"getSeriesExtremes",null,function(){u.hasVisibleSeries=!1,u.dataMin=u.dataMax=u.threshold=void 0,u.softThreshold=!u.isXAxis,u.series.forEach(p=>{if(p.reserveSpace()){let y=p.options,x,E=y.threshold,S,C;if(u.hasVisibleSeries=!0,u.positiveValuesOnly&&0>=(E||0)&&(E=void 0),u.isXAxis)(x=p.getColumn("x")).length&&(x=u.logarithmic?x.filter(L=>L>0):x,S=(s=p.getXExtremes(x)).min,C=s.max,Mi(S)||S instanceof Date||(x=x.filter(Mi),S=(s=p.getXExtremes(x)).min,C=s.max),x.length&&(u.dataMin=Math.min(qi(u.dataMin,S),S),u.dataMax=Math.max(qi(u.dataMax,C),C)));else{let L=p.applyExtremes();Mi(L.dataMin)&&(S=L.dataMin,u.dataMin=Math.min(qi(u.dataMin,S),S)),Mi(L.dataMax)&&(C=L.dataMax,u.dataMax=Math.max(qi(u.dataMax,C),C)),yr(E)&&(u.threshold=E),(!y.softThreshold||u.positiveValuesOnly)&&(u.softThreshold=!1)}}})}),Br(this,"afterGetSeriesExtremes")}translate(s,u,p,y,x,E){var re;let S=this.linkedParent||this,C=y&&S.old?S.old.min:S.min;if(!Mi(C))return NaN;let L=S.minPixelPadding,N=(S.isOrdinal||((re=S.brokenAxis)==null?void 0:re.hasBreaks)||S.logarithmic&&x)&&S.lin2val,z=1,j=0,W=y&&S.old?S.old.transA:S.transA,Y=0;return W||(W=S.transA),p&&(z*=-1,j=S.len),S.reversed&&(z*=-1,j-=z*(S.sector||S.len)),u?(Y=(s=s*z+j-L)/W+C,N&&(Y=S.lin2val(Y))):(N&&(s=S.val2lin(s)),Y=z*(s-C)*W+j+z*L+(Mi(E)?W*E:0),S.isRadial||(Y=Js(Y))),Y}toPixels(s,u){var p;return this.translate(((p=this.chart)==null?void 0:p.time.parse(s))??NaN,!1,!this.horiz,void 0,!0)+(u?0:this.pos)}toValue(s,u){return this.translate(s-(u?0:this.pos),!0,!this.horiz,void 0,!0)}getPlotLinePath(s){let u=this,p=u.chart,y=u.left,x=u.top,E=s.old,S=s.value,C=s.lineWidth,L=E&&p.oldChartHeight||p.chartHeight,N=E&&p.oldChartWidth||p.chartWidth,z=u.transB,j=s.translatedValue,W=s.force,Y,re,te,Q,ae;function he(Ie,Re,rt){return W!=="pass"&&(Ie<Re||Ie>rt)&&(W?Ie=vh(Ie,Re,rt):ae=!0),Ie}let Ue={value:S,lineWidth:C,old:E,force:W,acrossPanes:s.acrossPanes,translatedValue:j};return Br(this,"getPlotLinePath",Ue,function(Ie){Y=te=(j=vh(j=qi(j,u.translate(S,void 0,void 0,E)),-1e9,1e9))+z,re=Q=L-j-z,Mi(j)?u.horiz?(re=x,Q=L-u.bottom+(u.options.isInternal?0:p.scrollablePixelsY||0),Y=te=he(Y,y,y+u.width)):(Y=y,te=N-u.right+(p.scrollablePixelsX||0),re=Q=he(re,x,x+u.height)):(ae=!0,W=!1),Ie.path=ae&&!W?void 0:p.renderer.crispLine([["M",Y,re],["L",te,Q]],C||1)}),Ue.path}getLinearTickPositions(s,u,p){let y,x,E,S=Js(Math.floor(u/s)*s),C=Js(Math.ceil(p/s)*s),L=[];if(Js(S+s)===S&&(E=20),this.single)return[u];for(y=S;y<=C&&(L.push(y),(y=Js(y+s,E))!==x);)x=y;return L}getMinorTickInterval(){let{minorTicks:s,minorTickInterval:u}=this.options;return s===!0?qi(u,"auto"):s!==!1?u:void 0}getMinorTickPositions(){var N;let s=this.options,u=this.tickPositions,p=this.minorTickInterval,y=this.pointRangePadding||0,x=(this.min||0)-y,E=(this.max||0)+y,S=(N=this.brokenAxis)!=null&&N.hasBreaks?this.brokenAxis.unitLength:E-x,C=[],L;if(S&&S/p<this.len/3){let z=this.logarithmic;if(z)this.paddedTicks.forEach(function(j,W,Y){W&&C.push.apply(C,z.getLogTickPositions(p,Y[W-1],Y[W],!0))});else if(this.dateTime&&this.getMinorTickInterval()==="auto")C=C.concat(this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(p),x,E,s.startOfWeek));else for(L=x+(u[0]-x)%p;L<=E&&L!==C[0];L+=p)C.push(L)}return C.length!==0&&this.trimTicks(C),C}adjustForMinRange(){let s=this.options,u=this.logarithmic,p=this.chart.time,{max:y,min:x,minRange:E}=this,S,C,L,N;this.isXAxis&&E===void 0&&!u&&(E=yr(s.min)||yr(s.max)||yr(s.floor)||yr(s.ceiling)?null:Math.min(5*(kc(this.series.map(z=>{let j=z.getColumn("x");return z.xIncrement?j.slice(0,2):j}))||0),this.dataMax-this.dataMin)),Mi(y)&&Mi(x)&&Mi(E)&&y-x<E&&(C=this.dataMax-this.dataMin>=E,S=(E-y+x)/2,L=[x-S,p.parse(s.min)??x-S],C&&(L[2]=u?u.log2lin(this.dataMin):this.dataMin),N=[(x=Cc(L))+E,p.parse(s.max)??x+E],C&&(N[2]=u?u.log2lin(this.dataMax):this.dataMax),(y=Jo(N))-x<E&&(L[0]=y-E,L[1]=p.parse(s.min)??y-E,x=Cc(L))),this.minRange=E,this.min=x,this.max=y}getClosest(){let s,u;if(this.categories)u=1;else{let p=[];this.series.forEach(function(y){let x=y.closestPointRange,E=y.getColumn("x");E.length===1?p.push(E[0]):y.sorted&&yr(x)&&y.reserveSpace()&&(u=yr(u)?Math.min(u,x):x)}),p.length&&(p.sort((y,x)=>y-x),s=kc([p]))}return s&&u?Math.min(s,u):s||u}nameToX(s){let u=Bn(this.options.categories),p=u?this.categories:this.names,y=s.options.x,x;return s.series.requireSorting=!1,yr(y)||(y=this.uniqueNames&&p?u?p.indexOf(s.name):qi(p.keys[s.name],-1):s.series.autoIncrement()),y===-1?!u&&p&&(x=p.length):Mi(y)&&(x=y),x!==void 0?(this.names[x]=s.name,this.names.keys[s.name]=x):s.x&&(x=s.x),x}updateNames(){let s=this,u=this.names;u.length>0&&(Object.keys(u.keys).forEach(function(p){delete u.keys[p]}),u.length=0,this.minRange=this.userMinRange,(this.series||[]).forEach(p=>{p.xIncrement=null,(!p.points||p.isDirtyData)&&(s.max=Math.max(s.max||0,p.dataTable.rowCount-1),p.processData(),p.generatePoints());let y=p.getColumn("x").slice();p.data.forEach((x,E)=>{let S=y[E];x!=null&&x.options&&x.name!==void 0&&(S=s.nameToX(x))!==void 0&&S!==x.x&&(y[E]=x.x=S)}),p.dataTable.setColumn("x",y)}))}setAxisTranslation(){var j;let s=this,u=s.max-s.min,p=s.linkedParent,y=!!s.categories,x=s.isXAxis,E=s.axisPointRange||0,S,C=0,L=0,N,z=s.transA;(x||y||E)&&(S=s.getClosest(),p?(C=p.minPointOffset,L=p.pointRangePadding):s.series.forEach(function(W){let Y=y?1:x?qi(W.options.pointRange,S,0):s.axisPointRange||0,re=W.options.pointPlacement;if(E=Math.max(E,Y),!s.single||y){let te=W.is("xrange")?!x:x;C=Math.max(C,te&&Dl(re)?0:Y/2),L=Math.max(L,te&&re==="on"?0:Y)}}),N=(j=s.ordinal)!=null&&j.slope&&S?s.ordinal.slope/S:1,s.minPointOffset=C*=N,s.pointRangePadding=L*=N,s.pointRange=Math.min(E,s.single&&y?1:u),x&&(s.closestPointRange=S)),s.translationSlope=s.transA=z=s.staticScale||s.len/(u+L||1),s.transB=s.horiz?s.left:s.bottom,s.minPixelPadding=z*C,Br(this,"afterSetAxisTranslation")}minFromRange(){let{max:s,min:u}=this;return Mi(s)&&Mi(u)&&s-u||void 0}setTickInterval(s){var si,Ii,hi,Li;let{categories:u,chart:p,dataMax:y,dataMin:x,dateTime:E,isXAxis:S,logarithmic:C,options:L,softThreshold:N}=this,z=p.time,j=Mi(this.threshold)?this.threshold:void 0,W=this.minRange||0,{ceiling:Y,floor:re,linkedTo:te,softMax:Q,softMin:ae}=L,he=Mi(te)&&((si=p[this.coll])==null?void 0:si[te]),Ue=L.tickPixelInterval,Ie=L.maxPadding,Re=L.minPadding,rt=0,qe,st=Mi(L.tickInterval)&&L.tickInterval>=0?L.tickInterval:void 0,Et,Bt,$t,At;if(E||u||he||this.getTickAmount(),$t=qi(this.userMin,z.parse(L.min)),At=qi(this.userMax,z.parse(L.max)),he?(this.linkedParent=he,qe=he.getExtremes(),this.min=qi(qe.min,qe.dataMin),this.max=qi(qe.max,qe.dataMax),this.type!==he.type&&Wa(11,!0,p)):(N&&yr(j)&&Mi(y)&&Mi(x)&&(x>=j?(Et=j,Re=0):y<=j&&(Bt=j,Ie=0)),this.min=qi($t,Et,x),this.max=qi(At,Bt,y)),Mi(this.max)&&Mi(this.min)&&(C&&(this.positiveValuesOnly&&!s&&0>=Math.min(this.min,qi(x,this.min))&&Wa(10,!0,p),this.min=Js(C.log2lin(this.min),16),this.max=Js(C.log2lin(this.max),16)),this.range&&Mi(x)&&(this.userMin=this.min=$t=Math.max(x,this.minFromRange()||0),this.userMax=At=this.max,this.range=void 0)),Br(this,"foundExtremes"),this.adjustForMinRange(),Mi(this.min)&&Mi(this.max)){if(!Mi(this.userMin)&&Mi(ae)&&ae<this.min&&(this.min=$t=ae),!Mi(this.userMax)&&Mi(Q)&&Q>this.max&&(this.max=At=Q),u||this.axisPointRange||(Ii=this.stacking)!=null&&Ii.usePercentage||he||!(rt=this.max-this.min)||(!yr($t)&&Re&&(this.min-=rt*Re),yr(At)||!Ie||(this.max+=rt*Ie)),!Mi(this.userMin)&&Mi(re)&&(this.min=Math.max(this.min,re)),!Mi(this.userMax)&&Mi(Y)&&(this.max=Math.min(this.max,Y)),N&&Mi(x)&&Mi(y)){let ar=j||0;!yr($t)&&this.min<ar&&x>=ar?this.min=L.minRange?Math.min(ar,this.max-W):ar:!yr(At)&&this.max>ar&&y<=ar&&(this.max=L.minRange?Math.max(ar,this.min+W):ar)}!p.polar&&this.min>this.max&&(yr(L.min)?this.max=this.min:yr(L.max)&&(this.min=this.max)),rt=this.max-this.min}if(this.min!==this.max&&Mi(this.min)&&Mi(this.max)?he&&!st&&Ue===he.options.tickPixelInterval?this.tickInterval=st=he.tickInterval:this.tickInterval=qi(st,this.tickAmount?rt/Math.max(this.tickAmount-1,1):void 0,u?1:rt*Ue/Math.max(this.len,Ue)):this.tickInterval=1,S&&!s){let ar=this.min!==((hi=this.old)==null?void 0:hi.min)||this.max!==((Li=this.old)==null?void 0:Li.max);this.series.forEach(function(Zi){var dr;Zi.forceCrop=(dr=Zi.forceCropping)==null?void 0:dr.call(Zi),Zi.processData(ar)}),Br(this,"postProcessData",{hasExtremesChanged:ar})}this.setAxisTranslation(),Br(this,"initialAxisTranslation"),this.pointRange&&!st&&(this.tickInterval=Math.max(this.pointRange,this.tickInterval));let Kt=qi(L.minTickInterval,E&&!this.series.some(ar=>!ar.sorted)?this.closestPointRange:0);!st&&Kt&&this.tickInterval<Kt&&(this.tickInterval=Kt),E||C||st||(this.tickInterval=Ha(this,this.tickInterval)),this.tickAmount||(this.tickInterval=this.unsquish()),this.setTickPositions()}setTickPositions(){var N,z;let s=this.options,u=s.tickPositions,p=s.tickPositioner,y=this.getMinorTickInterval(),x=!this.isPanning,E=x&&s.startOnTick,S=x&&s.endOnTick,C=[],L;if(this.tickmarkOffset=this.categories&&s.tickmarkPlacement==="between"&&this.tickInterval===1?.5:0,this.single=this.min===this.max&&yr(this.min)&&!this.tickAmount&&(this.min%1==0||s.allowDecimals!==!1),u)C=u.slice();else if(Mi(this.min)&&Mi(this.max)){if(!((N=this.ordinal)!=null&&N.positions)&&(this.max-this.min)/this.tickInterval>Math.max(2*this.len,200))C=[this.min,this.max],Wa(19,!1,this.chart);else if(this.dateTime)C=this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(this.tickInterval,s.units),this.min,this.max,s.startOfWeek,(z=this.ordinal)==null?void 0:z.positions,this.closestPointRange,!0);else if(this.logarithmic)C=this.logarithmic.getLogTickPositions(this.tickInterval,this.min,this.max);else{let j=this.tickInterval,W=j;for(;W<=2*j&&(C=this.getLinearTickPositions(this.tickInterval,this.min,this.max),this.tickAmount&&C.length>this.tickAmount);)this.tickInterval=Ha(this,W*=1.1)}C.length>this.len&&(C=[C[0],C[C.length-1]])[0]===C[1]&&(C.length=1),p&&(this.tickPositions=C,(L=p.apply(this,[this.min,this.max]))&&(C=L))}this.tickPositions=C,this.minorTickInterval=y==="auto"&&this.tickInterval?this.tickInterval/s.minorTicksPerMajor:y,this.paddedTicks=C.slice(0),this.trimTicks(C,E,S),!this.isLinked&&Mi(this.min)&&Mi(this.max)&&(this.single&&C.length<2&&!this.categories&&!this.series.some(j=>j.is("heatmap")&&j.options.pointPlacement==="between")&&(this.min-=.5,this.max+=.5),u||L||this.adjustTickAmount()),Br(this,"afterSetTickPositions")}trimTicks(s,u,p){let y=s[0],x=s[s.length-1],E=!this.isOrdinal&&this.minPointOffset||0;if(Br(this,"trimTicks"),!this.isLinked||!this.grid){if(u&&y!==-1/0)this.min=y;else for(;this.min-E>s[0];)s.shift();if(p)this.max=x;else for(;this.max+E<s[s.length-1];)s.pop();s.length===0&&yr(y)&&!this.options.tickPositions&&s.push((x+y)/2)}}alignToOthers(){let s,u=this,p=u.chart,y=[this],x=u.options,E=p.options.chart,S=this.coll==="yAxis"&&E.alignThresholds,C=[];if(u.thresholdAlignment=void 0,(E.alignTicks!==!1&&x.alignTicks||S)&&x.startOnTick!==!1&&x.endOnTick!==!1&&!u.logarithmic){let L=z=>{let{horiz:j,options:W}=z;return[j?W.left:W.top,W.width,W.height,W.pane].join(",")},N=L(this);p[this.coll].forEach(function(z){let{series:j}=z;j.length&&j.some(W=>W.visible)&&z!==u&&L(z)===N&&(s=!0,y.push(z))})}if(s&&S){y.forEach(N=>{let z=N.getThresholdAlignment(u);Mi(z)&&C.push(z)});let L=C.length>1?C.reduce((N,z)=>N+=z,0)/C.length:void 0;y.forEach(N=>{N.thresholdAlignment=L})}return s}getThresholdAlignment(s){if((!Mi(this.dataMin)||this!==s&&this.series.some(u=>u.isDirty||u.isDirtyData))&&this.getSeriesExtremes(),Mi(this.threshold)){let u=vh((this.threshold-(this.dataMin||0))/((this.dataMax||0)-(this.dataMin||0)),0,1);return this.options.reversed&&(u=1-u),u}}getTickAmount(){let s=this.options,u=s.tickPixelInterval,p=s.tickAmount;yr(s.tickInterval)||p||!(this.len<u)||this.isRadial||this.logarithmic||!s.startOnTick||!s.endOnTick||(p=2),!p&&this.alignToOthers()&&(p=Math.ceil(this.len/u)+1),p<4&&(this.finalTickAmt=p,p=5),this.tickAmount=p}adjustTickAmount(){let s=this,{finalTickAmt:u,max:p,min:y,options:x,tickPositions:E,tickAmount:S,thresholdAlignment:C}=s,L=E==null?void 0:E.length,N=qi(s.threshold,s.softThreshold?0:null),z,j,W=s.tickInterval,Y,re=()=>E.push(Js(E[E.length-1]+W)),te=()=>E.unshift(Js(E[0]-W));if(Mi(C)&&(Y=C<.5?Math.ceil(C*(S-1)):Math.floor(C*(S-1)),x.reversed&&(Y=S-1-Y)),s.hasData()&&Mi(y)&&Mi(p)){let Q=()=>{s.transA*=(L-1)/(S-1),s.min=x.startOnTick?E[0]:Math.min(y,E[0]),s.max=x.endOnTick?E[E.length-1]:Math.max(p,E[E.length-1])};if(Mi(Y)&&Mi(s.threshold)){for(;E[Y]!==N||E.length!==S||E[0]>y||E[E.length-1]<p;){for(E.length=0,E.push(s.threshold);E.length<S;)E[Y]===void 0||E[Y]>s.threshold?te():re();if(W>8*s.tickInterval)break;W*=2}Q()}else if(L<S){for(;E.length<S;)E.length%2||y===N?re():te();Q()}if(yr(u)){for(j=z=E.length;j--;)(u===3&&j%2==1||u<=2&&j>0&&j<z-1)&&E.splice(j,1);s.finalTickAmt=void 0}}}setScale(){var E,S,C,L,N;let{coll:s,stacking:u}=this,p=!1,y=!1;this.series.forEach(z=>{var j;p=p||z.isDirtyData||z.isDirty,y=y||((j=z.xAxis)==null?void 0:j.isDirty)||!1}),this.setAxisSize();let x=this.len!==((E=this.old)==null?void 0:E.len);x||p||y||this.isLinked||this.forceRedraw||this.userMin!==((S=this.old)==null?void 0:S.userMin)||this.userMax!==((C=this.old)==null?void 0:C.userMax)||this.alignToOthers()?(u&&s==="yAxis"&&u.buildStacks(),this.forceRedraw=!1,this.userMinRange||(this.minRange=void 0),this.getSeriesExtremes(),this.setTickInterval(),u&&s==="xAxis"&&u.buildStacks(),this.isDirty||(this.isDirty=x||this.min!==((L=this.old)==null?void 0:L.min)||this.max!==((N=this.old)==null?void 0:N.max))):u&&u.cleanStacks(),p&&delete this.allExtremes,Br(this,"afterSetScale")}setExtremes(s,u,p=!0,y,x){let E=this.chart;this.series.forEach(S=>{delete S.kdTree}),s=E.time.parse(s),u=E.time.parse(u),Br(this,"setExtremes",x=ga(x,{min:s,max:u}),S=>{this.userMin=S.min,this.userMax=S.max,this.eventArgs=S,p&&E.redraw(y)})}setAxisSize(){let s=this.chart,u=this.options,p=u.offsets||[0,0,0,0],y=this.horiz,x=this.width=Math.round(Rl(qi(u.width,s.plotWidth-p[3]+p[1]),s.plotWidth)),E=this.height=Math.round(Rl(qi(u.height,s.plotHeight-p[0]+p[2]),s.plotHeight)),S=this.top=Math.round(Rl(qi(u.top,s.plotTop+p[0]),s.plotHeight,s.plotTop)),C=this.left=Math.round(Rl(qi(u.left,s.plotLeft+p[3]),s.plotWidth,s.plotLeft));this.bottom=s.chartHeight-E-S,this.right=s.chartWidth-x-C,this.len=Math.max(y?x:E,0),this.pos=y?C:S}getExtremes(){let s=this.logarithmic;return{min:s?Js(s.lin2log(this.min)):this.min,max:s?Js(s.lin2log(this.max)):this.max,dataMin:this.dataMin,dataMax:this.dataMax,userMin:this.userMin,userMax:this.userMax}}getThreshold(s){let u=this.logarithmic,p=u?u.lin2log(this.min):this.min,y=u?u.lin2log(this.max):this.max;return s===null||s===-1/0?s=p:s===1/0?s=y:p>s?s=p:y<s&&(s=y),this.translate(s,0,1,0,1)}autoLabelAlign(s){let u=(qi(s,0)-90*this.side+720)%360,p={align:"center"};return Br(this,"autoLabelAlign",p,function(y){u>15&&u<165?y.align="right":u>195&&u<345&&(y.align="left")}),p.align}tickSize(s){let u=this.options,p=qi(u[s==="tick"?"tickWidth":"minorTickWidth"],s==="tick"&&this.isXAxis&&!this.categories?1:0),y=u[s==="tick"?"tickLength":"minorTickLength"],x;p&&y&&(u[s+"Position"]==="inside"&&(y=-y),x=[y,p]);let E={tickSize:x};return Br(this,"afterTickSize",E),E.tickSize}labelMetrics(){let s=this.chart.renderer,u=this.ticks,p=u[Object.keys(u)[0]]||{};return this.chart.renderer.fontMetrics(p.label||p.movedLabel||s.box)}unsquish(){let s=this.options.labels,u=s.padding||0,p=this.horiz,y=this.tickInterval,x=this.len/((+!!this.categories+this.max-this.min)/y),E=s.rotation,S=Js(.8*this.labelMetrics().h),C=Math.max(this.max-this.min,0),L=function(Y){let re=(Y+2*u)/(x||1);return(re=re>1?Math.ceil(re):1)*y>C&&Y!==1/0&&x!==1/0&&C&&(re=Math.ceil(C/y)),Js(re*y)},N=y,z,j=Number.MAX_VALUE,W;if(p){if(!s.staggerLines&&(Mi(E)?W=[E]:x<s.autoRotationLimit&&(W=s.autoRotation)),W){let Y,re;for(let te of W)(te===E||te&&te>=-90&&te<=90)&&(re=(Y=L(Math.abs(S/Math.sin(sp*te))))+Math.abs(te/360))<j&&(j=re,z=te,N=Y)}}else N=L(.75*S);return this.autoRotation=W,this.labelRotation=qi(z,Mi(E)?E:0),s.step?y:N}getSlotWidth(s){let u=this.chart,p=this.horiz,y=this.options.labels,x=Math.max(this.tickPositions.length-+!this.categories,1),E=u.margin[3];if(s&&Mi(s.slotWidth))return s.slotWidth;if(p&&y.step<2&&!this.isRadial)return y.rotation?0:(this.staggerLines||1)*this.len/x;if(!p){let S=y.style.width;if(S!==void 0)return parseInt(String(S),10);if(E)return E-u.spacing[3]}return .33*u.chartWidth}renderUnsquish(){let s=this.chart,u=s.renderer,p=this.tickPositions,y=this.ticks,x=this.options.labels,E=x.style,S=this.horiz,C=this.getSlotWidth(),L=Math.max(1,Math.round(C-(S?2*(x.padding||0):x.distance||0))),N={},z=this.labelMetrics(),j=E.lineClamp,W,Y=j??(Math.floor(this.len/(p.length*z.h))||1),re=0;Dl(x.rotation)||(N.rotation=x.rotation||0),p.forEach(function(te){var he;let Q=y[te];Q.movedLabel&&Q.replaceMovedLabel();let ae=((he=Q.label)==null?void 0:he.textPxLength)||0;ae>re&&(re=ae)}),this.maxLabelLength=re,this.autoRotation?re>L&&re>z.h?N.rotation=this.labelRotation:this.labelRotation=0:C&&(W=L),N.rotation&&(W=re>.5*s.chartHeight?.33*s.chartHeight:re,j||(Y=1)),this.labelAlign=x.align||this.autoLabelAlign(this.labelRotation),this.labelAlign&&(N.align=this.labelAlign),p.forEach(function(te){let Q=y[te],ae=Q==null?void 0:Q.label,he=E.width,Ue={};ae&&(ae.attr(N),Q.shortenLabel?Q.shortenLabel():W&&!he&&E.whiteSpace!=="nowrap"&&(W<(ae.textPxLength||0)||ae.element.tagName==="SPAN")?ae.css(ga(Ue,{width:`${W}px`,lineClamp:Y})):!ae.styles.width||Ue.width||he||ae.css({width:"auto"}),Q.rotation=N.rotation)},this),this.tickRotCorr=u.rotCorr(z.b,this.labelRotation||0,this.side!==0)}hasData(){return this.series.some(function(s){return s.hasData()})||this.options.showEmpty&&yr(this.min)&&yr(this.max)}addTitle(s){let u,p=this.chart.renderer,y=this.horiz,x=this.opposite,E=this.options.title,S=this.chart.styledMode;this.axisTitle||((u=E.textAlign)||(u=(y?{low:"left",middle:"center",high:"right"}:{low:x?"right":"left",middle:"center",high:x?"left":"right"})[E.align]),this.axisTitle=p.text(E.text||"",0,0,E.useHTML).attr({zIndex:7,rotation:E.rotation||0,align:u}).addClass("highcharts-axis-title"),S||this.axisTitle.css(_a(E.style)),this.axisTitle.add(this.axisGroup),this.axisTitle.isNew=!0),S||E.style.width||this.isRadial||this.axisTitle.css({width:this.len+"px"}),this.axisTitle[s?"show":"hide"](s)}generateTick(s){let u=this.ticks;u[s]?u[s].addLabel():u[s]=new Ko(this,s)}createGroups(){let{axisParent:s,chart:u,coll:p,options:y}=this,x=u.renderer,E=(S,C,L)=>x.g(S).attr({zIndex:L}).addClass(`highcharts-${p.toLowerCase()}${C} `+(this.isRadial?`highcharts-radial-axis${C} `:"")+(y.className||"")).add(s);this.axisGroup||(this.gridGroup=E("grid","-grid",y.gridZIndex),this.axisGroup=E("axis","",y.zIndex),this.labelGroup=E("axis-labels","-labels",y.labels.zIndex))}getOffset(){let s=this,{chart:u,horiz:p,options:y,side:x,ticks:E,tickPositions:S,coll:C}=s,L=u.inverted&&!s.isZAxis?[1,0,3,2][x]:x,N=s.hasData(),z=y.title,j=y.labels,W=Mi(y.crossing),Y=u.axisOffset,re=u.clipOffset,te=[-1,1,1,-1][x],Q,ae=0,he,Ue=0,Ie=0,Re,rt;if(s.showAxis=Q=N||y.showEmpty,s.staggerLines=s.horiz&&j.staggerLines||void 0,s.createGroups(),N||s.isLinked?(S.forEach(function(qe){s.generateTick(qe)}),s.renderUnsquish(),s.reserveSpaceDefault=x===0||x===2||{1:"left",3:"right"}[x]===s.labelAlign,qi(j.reserveSpace,!W&&null,s.labelAlign==="center"||null,s.reserveSpaceDefault)&&S.forEach(function(qe){Ie=Math.max(E[qe].getLabelSize(),Ie)}),s.staggerLines&&(Ie*=s.staggerLines),s.labelOffset=Ie*(s.opposite?-1:1)):ya(E,function(qe,st){qe.destroy(),delete E[st]}),z!=null&&z.text&&z.enabled!==!1&&(s.addTitle(Q),Q&&!W&&z.reserveSpace!==!1&&(s.titleOffset=ae=s.axisTitle.getBBox()[p?"height":"width"],Ue=yr(he=z.offset)?0:qi(z.margin,p?5:10))),s.renderLine(),s.offset=te*qi(y.offset,Y[x]?Y[x]+(y.margin||0):0),s.tickRotCorr=s.tickRotCorr||{x:0,y:0},rt=x===0?-s.labelMetrics().h:x===2?s.tickRotCorr.y:0,Re=Math.abs(Ie)+Ue,Ie&&(Re-=rt,Re+=te*(p?qi(j.y,s.tickRotCorr.y+te*j.distance):qi(j.x,te*j.distance))),s.axisTitleMargin=qi(he,Re),s.getMaxLabelDimensions&&(s.maxLabelDimensions=s.getMaxLabelDimensions(E,S)),C!=="colorAxis"&&re){let qe=this.tickSize("tick");Y[x]=Math.max(Y[x],(s.axisTitleMargin||0)+ae+te*s.offset,Re,S!=null&&S.length&&qe?qe[0]+te*s.offset:0);let st=!s.axisLine||y.offset?0:s.axisLine.strokeWidth()/2;re[L]=Math.max(re[L],st)}Br(this,"afterGetOffset")}getLinePath(s){let u=this.chart,p=this.opposite,y=this.offset,x=this.horiz,E=this.left+(p?this.width:0)+y,S=u.chartHeight-this.bottom-(p?this.height:0)+y;return p&&(s*=-1),u.renderer.crispLine([["M",x?this.left:E,x?S:this.top],["L",x?u.chartWidth-this.right:E,x?S:u.chartHeight-this.bottom]],s)}renderLine(){this.axisLine||(this.axisLine=this.chart.renderer.path().addClass("highcharts-axis-line").add(this.axisGroup),this.chart.styledMode||this.axisLine.attr({stroke:this.options.lineColor,"stroke-width":this.options.lineWidth,zIndex:7}))}getTitlePosition(s){let u=this.horiz,p=this.left,y=this.top,x=this.len,E=this.options.title,S=u?p:y,C=this.opposite,L=this.offset,N=E.x,z=E.y,j=this.chart.renderer.fontMetrics(s),W=s?Math.max(s.getBBox(!1,0).height-j.h-1,0):0,Y={low:S+(u?0:x),middle:S+x/2,high:S+(u?x:0)}[E.align],re=(u?y+this.height:p)+(u?1:-1)*(C?-1:1)*(this.axisTitleMargin||0)+[-W,W,j.f,-W][this.side],te={x:u?Y+N:re+(C?this.width:0)+L+N,y:u?re+z-(C?this.height:0)+L:Y+z};return Br(this,"afterGetTitlePosition",{titlePosition:te}),te}renderMinorTick(s,u){let p=this.minorTicks;p[s]||(p[s]=new Ko(this,s,"minor")),u&&p[s].isNew&&p[s].render(null,!0),p[s].render(null,!1,1)}renderTick(s,u,p){var E;let y=this.isLinked,x=this.ticks;(!y||s>=this.min&&s<=this.max||(E=this.grid)!=null&&E.isColumn)&&(x[s]||(x[s]=new Ko(this,s)),p&&x[s].isNew&&x[s].render(u,!0,-1),x[s].render(u))}render(){let s,u,p=this,y=p.chart,x=p.logarithmic,E=y.renderer,S=p.options,C=p.isLinked,L=p.tickPositions,N=p.axisTitle,z=p.ticks,j=p.minorTicks,W=p.alternateBands,Y=S.stackLabels,re=S.alternateGridColor,te=S.crossing,Q=p.tickmarkOffset,ae=p.axisLine,he=p.showAxis,Ue=ur(E.globalAnimation);if(p.labelEdge.length=0,p.overlap=!1,[z,j,W].forEach(function(Ie){ya(Ie,function(Re){Re.isActive=!1})}),Mi(te)){let Ie=this.isXAxis?y.yAxis[0]:y.xAxis[0],Re=[1,-1,-1,1][this.side];if(Ie){let rt=Ie.toPixels(te,!0);p.horiz&&(rt=Ie.len-rt),p.offset=Re*rt}}if(p.hasData()||C){let Ie=p.chart.hasRendered&&p.old&&Mi(p.old.min);p.minorTickInterval&&!p.categories&&p.getMinorTickPositions().forEach(function(Re){p.renderMinorTick(Re,Ie)}),L.length&&(L.forEach(function(Re,rt){p.renderTick(Re,rt,Ie)}),Q&&(p.min===0||p.single)&&(z[-1]||(z[-1]=new Ko(p,-1,null,!0)),z[-1].render(-1))),re&&L.forEach(function(Re,rt){u=L[rt+1]!==void 0?L[rt+1]+Q:p.max-Q,rt%2==0&&Re<p.max&&u<=p.max+(y.polar?-Q:Q)&&(W[Re]||(W[Re]=new Ne.PlotLineOrBand(p,{})),s=Re+Q,W[Re].options={from:x?x.lin2log(s):s,to:x?x.lin2log(u):u,color:re,className:"highcharts-alternate-grid"},W[Re].render(),W[Re].isActive=!0)}),p._addedPlotLB||(p._addedPlotLB=!0,(S.plotLines||[]).concat(S.plotBands||[]).forEach(function(Re){p.addPlotBandOrLine(Re)}))}[z,j,W].forEach(function(Ie){let Re=[],rt=Ue.duration;ya(Ie,function(qe,st){qe.isActive||(qe.render(st,!1,0),qe.isActive=!1,Re.push(st))}),Th(function(){let qe=Re.length;for(;qe--;)Ie[Re[qe]]&&!Ie[Re[qe]].isActive&&(Ie[Re[qe]].destroy(),delete Ie[Re[qe]])},Ie!==W&&y.hasRendered&&rt?rt:0)}),ae&&(ae[ae.isPlaced?"animate":"attr"]({d:this.getLinePath(ae.strokeWidth())}),ae.isPlaced=!0,ae[he?"show":"hide"](he)),N&&he&&(N[N.isNew?"attr":"animate"](p.getTitlePosition(N)),N.isNew=!1),Y!=null&&Y.enabled&&p.stacking&&p.stacking.renderStackTotals(),p.old={len:p.len,max:p.max,min:p.min,transA:p.transA,userMax:p.userMax,userMin:p.userMin},p.isDirty=!1,Br(this,"afterRender")}redraw(){this.visible&&(this.render(),this.plotLinesAndBands.forEach(function(s){s.render()})),this.series.forEach(function(s){s.isDirty=!0})}getKeepProps(){return this.keepProps||xa.keepProps}destroy(s){let u=this,p=u.plotLinesAndBands,y=this.eventOptions;if(Br(this,"destroy",{keepEvents:s}),s||wh(u),[u.ticks,u.minorTicks,u.alternateBands].forEach(function(x){Ll(x)}),p){let x=p.length;for(;x--;)p[x].destroy()}for(let x in["axisLine","axisTitle","axisGroup","gridGroup","labelGroup","cross","scrollbar"].forEach(function(E){u[E]&&(u[E]=u[E].destroy())}),u.plotLinesAndBandsGroups)u.plotLinesAndBandsGroups[x]=u.plotLinesAndBandsGroups[x].destroy();ya(u,function(x,E){u.getKeepProps().indexOf(E)===-1&&delete u[E]}),this.eventOptions=y}drawCrosshair(s,u){var z;let p=this.crosshair,y=(p==null?void 0:p.snap)??!0,x=this.chart,E,S,C,L=this.cross,N;if(Br(this,"drawCrosshair",{e:s,point:u}),s||(s=(z=this.cross)==null?void 0:z.e),p&&(yr(u)||!y)!==!1){if(y?yr(u)&&(S=qi(this.coll!=="colorAxis"?u.crosshairPos:null,this.isXAxis?u.plotX:this.len-u.plotY)):S=s&&(this.horiz?s.chartX-this.pos:this.len-s.chartY+this.pos),yr(S)&&(N={value:u&&(this.isXAxis?u.x:qi(u.stackY,u.y)),translatedValue:S},x.polar&&ga(N,{isCrosshair:!0,chartX:s==null?void 0:s.chartX,chartY:s==null?void 0:s.chartY,point:u}),E=this.getPlotLinePath(N)||null),!yr(E)){this.hideCrosshair();return}C=this.categories&&!this.isRadial,L||(this.cross=L=x.renderer.path().addClass("highcharts-crosshair highcharts-crosshair-"+(C?"category ":"thin ")+(p.className||"")).attr({zIndex:qi(p.zIndex,2)}).add(),!x.styledMode&&(L.attr({stroke:p.color||(C?Ye.parse("#ccd3ff").setOpacity(.25).get():"#cccccc"),"stroke-width":qi(p.width,1)}).css({"pointer-events":"none"}),p.dashStyle&&L.attr({dashstyle:p.dashStyle}))),L.show().attr({d:E}),C&&!p.width&&L.attr({"stroke-width":this.transA}),this.cross.e=s}else this.hideCrosshair();Br(this,"afterDrawCrosshair",{e:s,point:u})}hideCrosshair(){this.cross&&this.cross.hide(),Br(this,"afterHideCrosshair")}update(s,u){let p=this.chart;s=_a(this.userOptions,s),this.destroy(!0),this.init(p,s),p.isDirtyBox=!0,qi(u,!0)&&p.redraw()}remove(s){let u=this.chart,p=this.coll,y=this.series,x=y.length;for(;x--;)y[x]&&y[x].remove(!1);bh(u.axes,this),bh(u[p]||[],this),u.orderItems(p),this.destroy(),u.isDirtyBox=!0,qi(s,!0)&&u.redraw()}setTitle(s,u){this.update({title:s},u)}setCategories(s,u){this.update({categories:s},u)}}xa.keepProps=["coll","extKey","hcEvents","len","names","series","userMax","userMin"];let{addEvent:zf,getMagnitude:op,normalizeTickInterval:zl,timeUnits:Ol}=me;(function(R){function s(){return this.chart.time.getTimeTicks.apply(this.chart.time,arguments)}function u(){if(this.type!=="datetime"){this.dateTime=void 0;return}this.dateTime||(this.dateTime=new p(this))}R.compose=function(y){return y.keepProps.includes("dateTime")||(y.keepProps.push("dateTime"),y.prototype.getTimeTicks=s,zf(y,"afterSetType",u)),y};class p{constructor(x){this.axis=x}normalizeTimeTickInterval(x,E){let S=E||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]],C=S[S.length-1],L=Ol[C[0]],N=C[1],z;for(z=0;z<S.length&&(L=Ol[(C=S[z])[0]],N=C[1],!S[z+1]||!(x<=(L*N[N.length-1]+Ol[S[z+1][0]])/2));z++);L===Ol.year&&x<5*L&&(N=[1,2,5]);let j=zl(x/L,N,C[0]==="year"?Math.max(op(x/L),1):1);return{unitRange:L,count:j,unitName:C[0]}}getXDateFormat(x,E){let{axis:S}=this,C=S.chart.time;return S.closestPointRange?C.getDateFormat(S.closestPointRange,x,S.options.startOfWeek,E)||C.resolveDTLFormat(E.year).main:C.resolveDTLFormat(E.day).main}}R.Additions=p})(X||(X={}));let Fu=X,{addEvent:Eh,normalizeTickInterval:Sh,pick:Pc}=me;(function(R){function s(){this.type!=="logarithmic"?this.logarithmic=void 0:this.logarithmic??(this.logarithmic=new p(this))}function u(){let y=this.logarithmic;y&&(this.lin2val=function(x){return y.lin2log(x)},this.val2lin=function(x){return y.log2lin(x)})}R.compose=function(y){return y.keepProps.includes("logarithmic")||(y.keepProps.push("logarithmic"),Eh(y,"afterSetType",s),Eh(y,"afterInit",u)),y};class p{constructor(x){this.axis=x}getLogTickPositions(x,E,S,C){let L=this.axis,N=L.len,z=L.options,j=[];if(C||(this.minorAutoInterval=void 0),x>=.5)x=Math.round(x),j=L.getLinearTickPositions(x,E,S);else if(x>=.08){let W,Y,re,te,Q,ae,he,Ue=Math.floor(E);for(W=x>.3?[1,2,4]:x>.15?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9],Y=Ue;Y<S+1&&!he;Y++)for(re=0,te=W.length;re<te&&!he;re++)(Q=this.log2lin(this.lin2log(Y)*W[re]))>E&&(!C||ae<=S)&&ae!==void 0&&j.push(ae),ae>S&&(he=!0),ae=Q}else{let W=this.lin2log(E),Y=this.lin2log(S),re=C?L.getMinorTickInterval():z.tickInterval,te=z.tickPixelInterval/(C?5:1),Q=C?N/L.tickPositions.length:N;x=Sh(x=Pc(re==="auto"?null:re,this.minorAutoInterval,(Y-W)*te/(Q||1))),j=L.getLinearTickPositions(x,W,Y).map(this.log2lin),C||(this.minorAutoInterval=x/5)}return C||(L.tickInterval=x),j}lin2log(x){return Math.pow(10,x)}log2lin(x){return Math.log(x)/Math.LN10}}R.Additions=p})(ie||(ie={}));let Ic=ie,{erase:Nu,extend:ap,isNumber:Ah}=me;(function(R){let s;function u(L){return this.addPlotBandOrLine(L,"plotBands")}function p(L,N){let z=this.userOptions,j=new s(this,L);if(this.visible&&(j=j.render()),j){if(this._addedPlotLB||(this._addedPlotLB=!0,(z.plotLines||[]).concat(z.plotBands||[]).forEach(W=>{this.addPlotBandOrLine(W)})),N){let W=z[N]||[];W.push(L),z[N]=W}this.plotLinesAndBands.push(j)}return j}function y(L){return this.addPlotBandOrLine(L,"plotLines")}function x(L,N,z){z=z||this.options;let j=this.getPlotLinePath({value:N,force:!0,acrossPanes:z.acrossPanes}),W=[],Y=this.horiz,re=!Ah(this.min)||!Ah(this.max)||L<this.min&&N<this.min||L>this.max&&N>this.max,te=this.getPlotLinePath({value:L,force:!0,acrossPanes:z.acrossPanes}),Q,ae=1,he;if(te&&j)for(re&&(he=te.toString()===j.toString(),ae=0),Q=0;Q<te.length;Q+=2){let Ue=te[Q],Ie=te[Q+1],Re=j[Q],rt=j[Q+1];(Ue[0]==="M"||Ue[0]==="L")&&(Ie[0]==="M"||Ie[0]==="L")&&(Re[0]==="M"||Re[0]==="L")&&(rt[0]==="M"||rt[0]==="L")&&(Y&&Re[1]===Ue[1]?(Re[1]+=ae,rt[1]+=ae):Y||Re[2]!==Ue[2]||(Re[2]+=ae,rt[2]+=ae),W.push(["M",Ue[1],Ue[2]],["L",Ie[1],Ie[2]],["L",rt[1],rt[2]],["L",Re[1],Re[2]],["Z"])),W.isFlat=he}return W}function E(L){this.removePlotBandOrLine(L)}function S(L){let N=this.plotLinesAndBands,z=this.options,j=this.userOptions;if(N){let W=N.length;for(;W--;)N[W].id===L&&N[W].destroy();[z.plotLines||[],j.plotLines||[],z.plotBands||[],j.plotBands||[]].forEach(function(Y){var re;for(W=Y.length;W--;)((re=Y[W])==null?void 0:re.id)===L&&Nu(Y,Y[W])})}}function C(L){this.removePlotBandOrLine(L)}R.compose=function(L,N){let z=N.prototype;return z.addPlotBand||(s=L,ap(z,{addPlotBand:u,addPlotLine:y,addPlotBandOrLine:p,getPlotBandPath:x,removePlotBand:E,removePlotLine:C,removePlotBandOrLine:S})),N}})(oe||(oe={}));let lp=oe,{addEvent:va,arrayMax:Uu,arrayMin:ju,defined:Co,destroyObjectProperties:cp,erase:Vu,fireEvent:hp,merge:Gu,objectEach:Qs,pick:Of}=me;class Lc{static compose(s,u){return va(s,"afterInit",function(){this.labelCollectors.push(()=>{var y;let p=[];for(let x of this.axes)for(let{label:E,options:S}of x.plotLinesAndBands)E&&!((y=S==null?void 0:S.label)!=null&&y.allowOverlap)&&p.push(E);return p})}),lp.compose(Lc,u)}constructor(s,u){this.axis=s,this.options=u,this.id=u.id}render(){hp(this,"render");let{axis:s,options:u}=this,{horiz:p,logarithmic:y}=s,{color:x,events:E,zIndex:S=0}=u,{renderer:C,time:L}=s.chart,N={},z=L.parse(u.to),j=L.parse(u.from),W=L.parse(u.value),Y=u.borderWidth,re=u.label,{label:te,svgElem:Q}=this,ae=[],he,Ue=Co(j)&&Co(z),Ie=Co(W),Re=!Q,rt={class:"highcharts-plot-"+(Ue?"band ":"line ")+(u.className||"")},qe=Ue?"bands":"lines";if(!s.chart.styledMode&&(Ie?(rt.stroke=x||"#999999",rt["stroke-width"]=Of(u.width,1),u.dashStyle&&(rt.dashstyle=u.dashStyle)):Ue&&(rt.fill=x||"#e6e9ff",Y&&(rt.stroke=u.borderColor,rt["stroke-width"]=Y))),N.zIndex=S,qe+="-"+S,(he=s.plotLinesAndBandsGroups[qe])||(s.plotLinesAndBandsGroups[qe]=he=C.g("plot-"+qe).attr(N).add()),Q||(this.svgElem=Q=C.path().attr(rt).add(he)),Co(W))ae=s.getPlotLinePath({value:(y==null?void 0:y.log2lin(W))??W,lineWidth:Q.strokeWidth(),acrossPanes:u.acrossPanes});else{if(!(Co(j)&&Co(z)))return;ae=s.getPlotBandPath((y==null?void 0:y.log2lin(j))??j,(y==null?void 0:y.log2lin(z))??z,u)}return!this.eventsAdded&&E&&(Qs(E,(st,Et)=>{Q==null||Q.on(Et,Bt=>{E[Et].apply(this,[Bt])})}),this.eventsAdded=!0),(Re||!Q.d)&&(ae!=null&&ae.length)?Q.attr({d:ae}):Q&&(ae?(Q.show(),Q.animate({d:ae})):Q.d&&(Q.hide(),te&&(this.label=te=te.destroy()))),re&&(Co(re.text)||Co(re.formatter))&&(ae!=null&&ae.length)&&s.width>0&&s.height>0&&!ae.isFlat?(re=Gu({align:p&&Ue?"center":void 0,x:p?!Ue&&4:10,verticalAlign:!p&&Ue?"middle":void 0,y:p?Ue?16:10:Ue?6:-4,rotation:p&&!Ue?90:0,...Ue?{inside:!0}:{}},re),this.renderLabel(re,ae,Ue,S)):te&&te.hide(),this}renderLabel(s,u,p,y){var Y;let x=this.axis,E=x.chart.renderer,S=s.inside,C=this.label;C||(this.label=C=E.text(this.getLabelText(s),0,0,s.useHTML).attr({align:s.textAlign||s.align,rotation:s.rotation,class:"highcharts-plot-"+(p?"band":"line")+"-label "+(s.className||""),zIndex:y}),x.chart.styledMode||C.css(Gu({fontSize:"0.8em",textOverflow:p&&!S?"":"ellipsis"},s.style)),C.add());let L=u.xBounds||[u[0][1],u[1][1],p?u[2][1]:u[0][1]],N=u.yBounds||[u[0][2],u[1][2],p?u[2][2]:u[0][2]],z=ju(L),j=ju(N),W=Uu(L)-z;C.align(s,!1,{x:z,y:j,width:W,height:Uu(N)-j}),C.alignAttr.y-=E.fontMetrics(C).b,(!C.alignValue||C.alignValue==="left"||Co(S))&&C.css({width:(((Y=s.style)==null?void 0:Y.width)||(p&&S?W:C.rotation===90?x.height-(C.alignAttr.y-x.top):(s.clip?x.width:x.chart.chartWidth)-(C.alignAttr.x-x.left)))+"px"}),C.show(!0)}getLabelText(s){return Co(s.formatter)?s.formatter.call(this):s.text}destroy(){Vu(this.axis.plotLinesAndBands,this),delete this.axis,cp(this)}}let{animObject:Bf}=ls,{format:up}=Ys,{composed:Fn,dateFormats:dp,doc:pp,isSafari:no}=Ne,{distribute:ko}=pa,{addEvent:qa,clamp:Qo,css:ni,discardElement:$u,extend:Wu,fireEvent:Xa,getAlignFactor:ba,isArray:Zt,isNumber:Hu,isObject:Ff,isString:Mh,merge:qu,pick:Za,pushUnique:fp,splat:Xu,syncTimeout:Nf}=me;class Dc{constructor(s,u,p){this.allowShared=!0,this.crosshairs=[],this.distance=0,this.isHidden=!0,this.isSticky=!1,this.options={},this.outside=!1,this.chart=s,this.init(s,u),this.pointer=p}bodyFormatter(s){return s.map(u=>{let p=u.series.tooltipOptions,y=u.formatPrefix||"point";return(p[y+"Formatter"]||u.tooltipFormatter).call(u,p[y+"Format"]||"")})}cleanSplit(s){this.chart.series.forEach(function(u){let p=u==null?void 0:u.tt;p&&(!p.isActive||s?u.tt=p.destroy():p.isActive=!1)})}defaultFormatter(s){let u,p=this.points||Xu(this);return(u=(u=[s.headerFooterFormatter(p[0])]).concat(s.bodyFormatter(p))).push(s.headerFooterFormatter(p[0],!0)),u}destroy(){this.label&&(this.label=this.label.destroy()),this.split&&(this.cleanSplit(!0),this.tt&&(this.tt=this.tt.destroy())),this.renderer&&(this.renderer=this.renderer.destroy(),$u(this.container)),me.clearTimeout(this.hideTimer)}getAnchor(s,u){var L;let p,{chart:y,pointer:x}=this,E=y.inverted,S=y.plotTop,C=y.plotLeft;if(s=Xu(s),(L=s[0].series)!=null&&L.yAxis&&!s[0].series.yAxis.options.reversedStacks&&(s=s.slice().reverse()),this.followPointer&&u)u.chartX===void 0&&(u=x.normalize(u)),p=[u.chartX-C,u.chartY-S];else if(s[0].tooltipPos)p=s[0].tooltipPos;else{let N=0,z=0;s.forEach(function(j){let W=j.pos(!0);W&&(N+=W[0],z+=W[1])}),N/=s.length,z/=s.length,this.shared&&s.length>1&&u&&(E?N=u.chartX:z=u.chartY),p=[N-C,z-S]}return p.map(Math.round)}getClassName(s,u,p){let y=this.options,x=s.series,E=x.options;return[y.className,"highcharts-label",p&&"highcharts-tooltip-header",u?"highcharts-tooltip-box":"highcharts-tooltip",!p&&"highcharts-color-"+Za(s.colorIndex,x.colorIndex),E==null?void 0:E.className].filter(Mh).join(" ")}getLabel({anchorX:s,anchorY:u}={anchorX:0,anchorY:0}){let p=this,y=this.chart.styledMode,x=this.options,E=this.split&&this.allowShared,S=this.container,C=this.chart.renderer;if(this.label){let L=!this.label.hasClass("highcharts-label");(!E&&L||E&&!L)&&this.destroy()}if(!this.label){if(this.outside){let L=this.chart,N=L.options.chart.style,z=Qn.getRendererType();this.container=S=Ne.doc.createElement("div"),S.className="highcharts-tooltip-container "+(L.renderTo.className.match(/(highcharts[a-zA-Z0-9-]+)\s?/gm)||""),ni(S,{position:"absolute",top:"1px",pointerEvents:"none",zIndex:Math.max(this.options.style.zIndex||0,((N==null?void 0:N.zIndex)||0)+3)}),this.renderer=C=new z(S,0,0,N,void 0,void 0,C.styledMode)}if(E?this.label=C.g("tooltip"):(this.label=C.label("",s,u,x.shape||"callout",void 0,void 0,x.useHTML,void 0,"tooltip").attr({padding:x.padding,r:x.borderRadius}),y||this.label.attr({fill:x.backgroundColor,"stroke-width":x.borderWidth||0}).css(x.style).css({pointerEvents:x.style.pointerEvents||(this.shouldStickOnContact()?"auto":"none")})),p.outside){let L=this.label;[L.xSetter,L.ySetter].forEach((N,z)=>{L[z?"ySetter":"xSetter"]=j=>{N.call(L,p.distance),L[z?"y":"x"]=j,S&&(S.style[z?"top":"left"]=`${j}px`)}})}this.label.attr({zIndex:8}).shadow(x.shadow??!x.fixed).add()}return S&&!S.parentElement&&Ne.doc.body.appendChild(S),this.label}getPlayingField(){let{body:s,documentElement:u}=pp,{chart:p,distance:y,outside:x}=this;return{width:x?Math.max(s.scrollWidth,u.scrollWidth,s.offsetWidth,u.offsetWidth,u.clientWidth)-2*y-2:p.chartWidth,height:x?Math.max(s.scrollHeight,u.scrollHeight,s.offsetHeight,u.offsetHeight,u.clientHeight):p.chartHeight}}getPosition(s,u,p){var si,Ii;let{distance:y,chart:x,outside:E,pointer:S}=this,{inverted:C,plotLeft:L,plotTop:N,polar:z}=x,{plotX:j=0,plotY:W=0}=p,Y={},re=C&&p.h||0,{height:te,width:Q}=this.getPlayingField(),ae=S.getChartPosition(),he=hi=>hi*ae.scaleX,Ue=hi=>hi*ae.scaleY,Ie=hi=>{let Li=hi==="x";return[hi,Li?Q:te,Li?s:u].concat(E?[Li?he(s):Ue(u),Li?ae.left-y+he(j+L):ae.top-y+Ue(W+N),0,Li?Q:te]:[Li?s:u,Li?j+L:W+N,Li?L:N,Li?L+x.plotWidth:N+x.plotHeight])},Re=Ie("y"),rt=Ie("x"),qe,st=!!p.negative;!z&&((Ii=(si=x.hoverSeries)==null?void 0:si.yAxis)!=null&&Ii.reversed)&&(st=!st);let Et=!this.followPointer&&Za(p.ttBelow,!z&&!C===st),Bt=function(hi,Li,ar,Zi,dr,pn,lr){let Cr=E?hi==="y"?Ue(y):he(y):y,Fi=(ar-Zi)/2,ii=Zi<dr-y,ds=dr+y+Zi<Li,kr=dr-Cr-ar+Fi,Ur=dr+Cr-Fi;if(Et&&ds)Y[hi]=Ur;else if(!Et&&ii)Y[hi]=kr;else if(ii)Y[hi]=Math.min(lr-Zi,kr-re<0?kr:kr-re);else{if(!ds)return Y[hi]=0,!1;Y[hi]=Math.max(pn,Ur+re+ar>Li?Ur:Ur+re)}},$t=function(hi,Li,ar,Zi,dr){if(dr<y||dr>Li-y)return!1;dr<ar/2?Y[hi]=1:dr>Li-Zi/2?Y[hi]=Li-Zi-2:Y[hi]=dr-ar/2},At=function(hi){[Re,rt]=[rt,Re],qe=hi},Kt=()=>{Bt.apply(0,Re)!==!1?$t.apply(0,rt)!==!1||qe||(At(!0),Kt()):qe?Y.x=Y.y=0:(At(!0),Kt())};return(C&&!z||this.len>1)&&At(),Kt(),Y}getFixedPosition(s,u,p){var j;let y=p.series,{chart:x,options:E,split:S}=this,C=E.position,L=C.relativeTo,N=E.shared||(j=y==null?void 0:y.yAxis)!=null&&j.isRadial&&(L==="pane"||!L)?"plotBox":L,z=N==="chart"?x.renderer:x[N]||x.getClipBox(y,!0);return{x:z.x+(z.width-s)*ba(C.align)+C.x,y:z.y+(z.height-u)*ba(C.verticalAlign)+(!S&&C.y||0)}}hide(s){let u=this;me.clearTimeout(this.hideTimer),s=Za(s,this.options.hideDelay),this.isHidden||(this.hideTimer=Nf(function(){let p=u.getLabel();u.getLabel().animate({opacity:0},{duration:s&&150,complete:()=>{p.hide(),u.container&&u.container.remove()}}),u.isHidden=!0},s))}init(s,u){this.chart=s,this.options=u,this.crosshairs=[],this.isHidden=!0,this.split=u.split&&!s.inverted&&!s.polar,this.shared=u.shared||this.split,this.outside=Za(u.outside,!!(s.scrollablePixelsX||s.scrollablePixelsY))}shouldStickOnContact(s){return!!(!this.followPointer&&this.options.stickOnContact&&(!s||this.pointer.inClass(s.target,"highcharts-tooltip")))}move(s,u,p,y){let{followPointer:x,options:E}=this,S=Bf(!x&&!this.isHidden&&!E.fixed&&E.animation),C=x||(this.len||0)>1,L={x:s,y:u};C?L.anchorX=L.anchorY=NaN:(L.anchorX=p,L.anchorY=y),S.step=()=>this.drawTracker(),this.getLabel().animate(L,S)}refresh(s,u){let{chart:p,options:y,pointer:x,shared:E}=this,S=Xu(s),C=S[0],L=y.format,N=y.formatter||this.defaultFormatter,z=p.styledMode,j=this.allowShared;if(!y.enabled||!C.series)return;me.clearTimeout(this.hideTimer),this.allowShared=!(!Zt(s)&&s.series&&s.series.noSharedTooltip),j=j&&!this.allowShared,this.followPointer=!this.split&&C.series.tooltipOptions.followPointer;let W=this.getAnchor(s,u),Y=W[0],re=W[1];E&&this.allowShared&&(x.applyInactiveState(S),S.forEach(ae=>ae.setState("hover")),C.points=S),this.len=S.length;let te=Mh(L)?up(L,C,p):N.call(C,this);C.points=void 0;let Q=C.series;if(this.distance=Za(Q.tooltipOptions.distance,16),te===!1)this.hide();else{if(this.split&&this.allowShared)this.renderSplit(te,S);else{let ae=Y,he=re;if(u&&x.isDirectTouch&&(ae=u.chartX-p.plotLeft,he=u.chartY-p.plotTop),p.polar||Q.options.clip===!1||S.some(Ue=>x.isDirectTouch||Ue.series.shouldShowTooltip(ae,he))){let Ue=this.getLabel(j&&this.tt||{});(!y.style.width||z)&&Ue.css({width:(this.outside?this.getPlayingField():p.spacingBox).width+"px"}),Ue.attr({class:this.getClassName(C),text:te&&te.join?te.join(""):te}),this.outside&&Ue.attr({x:Qo(Ue.x||0,0,this.getPlayingField().width-(Ue.width||0)-1)}),z||Ue.attr({stroke:y.borderColor||C.color||Q.color||"#666666"}),this.updatePosition({plotX:Y,plotY:re,negative:C.negative,ttBelow:C.ttBelow,series:Q,h:W[2]||0})}else{this.hide();return}}this.isHidden&&this.label&&this.label.attr({opacity:1}).show(),this.isHidden=!1}Xa(this,"refresh")}renderSplit(s,u){var dr,pn;let p=this,{chart:y,chart:{chartWidth:x,chartHeight:E,plotHeight:S,plotLeft:C,plotTop:L,scrollablePixelsY:N=0,scrollablePixelsX:z,styledMode:j},distance:W,options:Y,options:{fixed:re,position:te,positioner:Q},pointer:ae}=p,{scrollLeft:he=0,scrollTop:Ue=0}=((dr=y.scrollablePlotArea)==null?void 0:dr.scrollingContainer)||{},Ie=p.outside&&typeof z!="number"?pp.documentElement.getBoundingClientRect():{left:he,right:he+x},Re=p.getLabel(),rt=this.renderer||y.renderer,qe=!!((pn=y.xAxis[0])!=null&&pn.opposite),{left:st,top:Et}=ae.getChartPosition(),Bt=Q||re,$t=L+Ue,At=0,Kt=S-N,si=function(lr,Cr,Fi,ii=[0,0],ds=!0){let kr,Ur;if(Fi.isHeader)Ur=qe?0:Kt,kr=Qo(ii[0]-lr/2,Ie.left,Ie.right-lr-(p.outside?st:0));else if(re&&Fi){let Hr=p.getFixedPosition(lr,Cr,Fi);kr=Hr.x,Ur=Hr.y-$t}else Ur=ii[1]-$t,kr=Qo(kr=ds?ii[0]-lr-W:ii[0]+W,ds?kr:Ie.left,Ie.right);return{x:kr,y:Ur}};Mh(s)&&(s=[!1,s]);let Ii=s.slice(0,u.length+1).reduce(function(lr,Cr,Fi){if(Cr!==!1&&Cr!==""){let ii=u[Fi-1]||{isHeader:!0,plotX:u[0].plotX,plotY:S,series:{}},ds=ii.isHeader,kr=ds?p:ii.series,Ur=kr.tt=function(Pn,Ps,Cd){let Xl=Pn,{isHeader:Vc,series:kd}=Ps,ca=kd.tooltipOptions||Y;if(!Xl){let Hh={padding:ca.padding,r:ca.borderRadius};j||(Hh.fill=ca.backgroundColor,Hh["stroke-width"]=ca.borderWidth??(re&&!Vc?0:1)),Xl=rt.label("",0,0,ca[Vc?"headerShape":"shape"]||(re&&!Vc?"rect":"callout"),void 0,void 0,ca.useHTML).addClass(p.getClassName(Ps,!0,Vc)).attr(Hh).add(Re)}return Xl.isActive=!0,Xl.attr({text:Cd}),j||Xl.css(ca.style).attr({stroke:ca.borderColor||Ps.color||kd.color||"#333333"}),Xl}(kr.tt,ii,Cr.toString()),Hr=Ur.getBBox(),$n=Hr.width+Ur.strokeWidth();ds&&(At=Hr.height,Kt+=At,qe&&($t-=At));let{anchorX:uo,anchorY:zo}=function(Pn){let Ps,Cd,{isHeader:Xl,plotX:Vc=0,plotY:kd=0,series:ca}=Pn;if(Xl)Ps=Math.max(C+Vc,C),Cd=L+S/2;else{let{xAxis:Hh,yAxis:Pd}=ca;Ps=Hh.pos+Qo(Vc,-W,Hh.len+W),ca.shouldShowTooltip(0,Pd.pos-L+kd,{ignoreX:!0})&&(Cd=Pd.pos+kd)}return{anchorX:Ps=Qo(Ps,Ie.left-W,Ie.right+W),anchorY:Cd}}(ii);if(typeof zo=="number"){let Pn=Hr.height+1,Ps=(Q||si).call(p,$n,Pn,ii,[uo,zo]);lr.push({align:Bt?0:void 0,anchorX:uo,anchorY:zo,boxWidth:$n,point:ii,rank:Za(Ps.rank,+!!ds),size:Pn,target:Ps.y,tt:Ur,x:Ps.x})}else Ur.isActive=!1}return lr},[]);!Bt&&Ii.some(lr=>{let{outside:Cr}=p,Fi=(Cr?st:0)+lr.anchorX;return Fi<Ie.left&&Fi+lr.boxWidth<Ie.right||Fi<st-Ie.left+lr.boxWidth&&Ie.right-Fi>Fi})&&(Ii=Ii.map(lr=>{let{x:Cr,y:Fi}=si.call(this,lr.boxWidth,lr.size,lr.point,[lr.anchorX,lr.anchorY],!1);return Wu(lr,{target:Fi,x:Cr})})),p.cleanSplit(),ko(Ii,Kt);let hi={left:st,right:st};Ii.forEach(function(lr){let{x:Cr,boxWidth:Fi,isHeader:ii}=lr;!ii&&(p.outside&&st+Cr<hi.left&&(hi.left=st+Cr),!ii&&p.outside&&hi.left+Fi>hi.right&&(hi.right=st+Cr))}),Ii.forEach(function(lr){let{x:Cr,anchorX:Fi,anchorY:ii,pos:ds,point:{isHeader:kr}}=lr,Ur={visibility:ds===void 0?"hidden":"inherit",x:Cr,y:(ds||0)+$t+(re&&te.y||0),anchorX:Fi,anchorY:ii};if(p.outside&&Cr<Fi){let Hr=st-hi.left;Hr>0&&(kr||(Ur.x=Cr+Hr,Ur.anchorX=Fi+Hr),kr&&(Ur.x=(hi.right-hi.left)/2,Ur.anchorX=Fi+Hr))}lr.tt.attr(Ur)});let{container:Li,outside:ar,renderer:Zi}=p;if(ar&&Li&&Zi){let{width:lr,height:Cr,x:Fi,y:ii}=Re.getBBox();Zi.setSize(lr+Fi,Cr+ii,!1),Li.style.left=hi.left+"px",Li.style.top=Et+"px"}no&&Re.attr({opacity:Re.opacity===1?.999:1})}drawTracker(){if(!this.shouldStickOnContact()){this.tracker&&(this.tracker=this.tracker.destroy());return}let s=this.chart,u=this.label,p=this.shared?s.hoverPoints:s.hoverPoint;if(!u||!p)return;let y={x:0,y:0,width:0,height:0},x=this.getAnchor(p),E=u.getBBox();x[0]+=s.plotLeft-(u.translateX||0),x[1]+=s.plotTop-(u.translateY||0),y.x=Math.min(0,x[0]),y.y=Math.min(0,x[1]),y.width=x[0]<0?Math.max(Math.abs(x[0]),E.width-x[0]):Math.max(Math.abs(x[0]),E.width),y.height=x[1]<0?Math.max(Math.abs(x[1]),E.height-Math.abs(x[1])):Math.max(Math.abs(x[1]),E.height),this.tracker?this.tracker.attr(y):(this.tracker=u.renderer.rect(y).addClass("highcharts-tracker").add(u),s.styledMode||this.tracker.attr({fill:"rgba(0,0,0,0)"}))}styledModeFormat(s){return s.replace('style="font-size: 0.8em"','class="highcharts-header"').replace(/style="color:{(point|series)\.color}"/g,'class="highcharts-color-{$1.colorIndex} {series.options.className} {point.options.className}"')}headerFooterFormatter(s,u){let p=s.series,y=p.tooltipOptions,x=p.xAxis,E=x==null?void 0:x.dateTime,S={isFooter:u,point:s},C=y.xDateFormat||"",L=y[u?"footerFormat":"headerFormat"];return Xa(this,"headerFormatter",S,function(N){if(E&&!C&&Hu(s.key)&&(C=E.getXDateFormat(s.key,y.dateTimeLabelFormats)),E&&C){if(Ff(C)){let z=C;dp[0]=j=>p.chart.time.dateFormat(z,j),C="%0"}(s.tooltipDateKeys||["key"]).forEach(z=>{L=L.replace(RegExp("point\\."+z+"([ \\)}])"),`(point.${z}:${C})$1`)})}p.chart.styledMode&&(L=this.styledModeFormat(L)),N.text=up(L,s,this.chart)}),S.text||""}update(s){this.destroy(),this.init(this.chart,qu(!0,this.options,s))}updatePosition(s){var Ie;let{chart:u,container:p,distance:y,options:x,pointer:E,renderer:S}=this,{height:C=0,width:L=0}=this.getLabel(),{fixed:N,positioner:z}=x,{left:j,top:W,scaleX:Y,scaleY:re}=E.getChartPosition(),te=(z||N&&this.getFixedPosition||this.getPosition).call(this,L,C,s),Q=Ne.doc,ae=(s.plotX||0)+u.plotLeft,he=(s.plotY||0)+u.plotTop,Ue;if(S&&p){if(z||N){let{scrollLeft:Re=0,scrollTop:rt=0}=((Ie=u.scrollablePlotArea)==null?void 0:Ie.scrollingContainer)||{};te.x+=Re+j-y,te.y+=rt+W-y}Ue=(x.borderWidth||0)+2*y+2,S.setSize(Qo(L+Ue,0,Q.documentElement.clientWidth)-1,C+Ue,!1),(Y!==1||re!==1)&&(ni(p,{transform:`scale(${Y}, ${re})`}),ae*=Y,he*=re),ae+=j-te.x,he+=W-te.y}this.move(Math.round(te.x),Math.round(te.y||0),ae,he)}}(function(R){R.compose=function(s){fp(Fn,"Core.Tooltip")&&qa(s,"afterInit",function(){let u=this.chart;u.options.tooltip&&(u.tooltip=new R(u,u.options.tooltip,this))})}})(Dc||(Dc={}));let Ch=Dc,{animObject:Zu}=ls,{defaultOptions:Bl}=Ee,{format:d}=Ys,{addEvent:r,crisp:l,erase:m,extend:v,fireEvent:T,getNestedProperty:P,isArray:I,isFunction:F,isNumber:G,isObject:$,merge:K,pick:le,syncTimeout:de,removeEvent:fe,uniqueKey:pe}=me;class ge{animateBeforeDestroy(){let s=this,u={x:s.startXPos,opacity:0},p=s.getGraphicalProps();p.singular.forEach(function(y){s[y]=s[y].animate(y==="dataLabel"?{x:s[y].startXPos,y:s[y].startYPos,opacity:0}:u)}),p.plural.forEach(function(y){s[y].forEach(function(x){x.element&&x.animate(v({x:s.startXPos},x.startYPos?{x:x.startXPos,y:x.startYPos}:{}))})})}applyOptions(s,u){let p=this.series,y=p.options.pointValKey||p.pointValKey;return v(this,s=ge.prototype.optionsToObject.call(this,s)),this.options=this.options?v(this.options,s):s,s.group&&delete this.group,s.dataLabels&&delete this.dataLabels,y&&(this.y=ge.prototype.getNestedProperty.call(this,y)),this.selected&&(this.state="select"),"name"in this&&u===void 0&&p.xAxis&&p.xAxis.hasNames&&(this.x=p.xAxis.nameToX(this)),this.x===void 0&&p?this.x=u??p.autoIncrement():G(s.x)&&p.options.relativeXValue?this.x=p.autoIncrement(s.x):typeof this.x=="string"&&(u??(u=p.chart.time.parse(this.x)),G(u)&&(this.x=u)),this.isNull=this.isValid&&!this.isValid(),this.formatPrefix=this.isNull?"null":"point",this}destroy(){if(!this.destroyed){let s=this,u=s.series,p=u.chart,y=u.options.dataSorting,x=p.hoverPoints,E=Zu(s.series.chart.renderer.globalAnimation),S=()=>{for(let C in(s.graphic||s.graphics||s.dataLabel||s.dataLabels)&&(fe(s),s.destroyElements()),s)delete s[C]};s.legendItem&&p.legend.destroyItem(s),x&&(s.setState(),m(x,s),x.length||(p.hoverPoints=null)),s===p.hoverPoint&&s.onMouseOut(),y!=null&&y.enabled?(this.animateBeforeDestroy(),de(S,E.duration)):S(),p.pointCount--}this.destroyed=!0}destroyElements(s){let u=this,p=u.getGraphicalProps(s);p.singular.forEach(function(y){u[y]=u[y].destroy()}),p.plural.forEach(function(y){u[y].forEach(function(x){x!=null&&x.element&&x.destroy()}),delete u[y]})}firePointEvent(s,u,p){let y=this,x=this.series.options;y.manageEvent(s),s==="click"&&x.allowPointSelect&&(p=function(E){!y.destroyed&&y.select&&y.select(null,E.ctrlKey||E.metaKey||E.shiftKey)}),T(y,s,u,p)}getClassName(){var s;return"highcharts-point"+(this.selected?" highcharts-point-select":"")+(this.negative?" highcharts-negative":"")+(this.isNull?" highcharts-null-point":"")+(this.colorIndex!==void 0?" highcharts-color-"+this.colorIndex:"")+(this.options.className?" "+this.options.className:"")+((s=this.zone)!=null&&s.className?" "+this.zone.className.replace("highcharts-negative",""):"")}getGraphicalProps(s){let u,p,y=this,x=[],E={singular:[],plural:[]};for((s=s||{graphic:1,dataLabel:1}).graphic&&x.push("graphic","connector"),s.dataLabel&&x.push("dataLabel","dataLabelPath","dataLabelUpper"),p=x.length;p--;)y[u=x[p]]&&E.singular.push(u);return["graphic","dataLabel"].forEach(function(S){let C=S+"s";s[S]&&y[C]&&E.plural.push(C)}),E}getNestedProperty(s){return s?s.indexOf("custom.")===0?P(s,this.options):this[s]:void 0}getZone(){let s=this.series,u=s.zones,p=s.zoneAxis||"y",y,x=0;for(y=u[0];this[p]>=y.value;)y=u[++x];return this.nonZonedColor||(this.nonZonedColor=this.color),y!=null&&y.color&&!this.options.color?this.color=y.color:this.color=this.nonZonedColor,y}hasNewShapeType(){return(this.graphic&&(this.graphic.symbolName||this.graphic.element.nodeName))!==this.shapeType}constructor(s,u,p){this.formatPrefix="point",this.visible=!0,this.point=this,this.series=s,this.applyOptions(u,p),this.id??(this.id=pe()),this.resolveColor(),this.dataLabelOnNull??(this.dataLabelOnNull=s.options.nullInteraction),s.chart.pointCount++,T(this,"afterInit")}isValid(){return(G(this.x)||this.x instanceof Date)&&G(this.y)}optionsToObject(s){var N;let u=this.series,p=u.options.keys,y=p||u.pointArrayMap||["y"],x=y.length,E={},S,C=0,L=0;if(G(s)||s===null)E[y[0]]=s;else if(I(s))for(!p&&s.length>x&&((S=typeof s[0])=="string"?(N=u.xAxis)!=null&&N.dateTime?E.x=u.chart.time.parse(s[0]):E.name=s[0]:S==="number"&&(E.x=s[0]),C++);L<x;)p&&s[C]===void 0||(y[L].indexOf(".")>0?ge.prototype.setNestedProperty(E,s[C],y[L]):E[y[L]]=s[C]),C++,L++;else typeof s=="object"&&(E=s,s.dataLabels&&(u.hasDataLabels=()=>!0),s.marker&&(u._hasPointMarkers=!0));return E}pos(s,u=this.plotY){if(!this.destroyed){let{plotX:p,series:y}=this,{chart:x,xAxis:E,yAxis:S}=y,C=0,L=0;if(G(p)&&G(u))return s&&(C=E?E.pos:x.plotLeft,L=S?S.pos:x.plotTop),x.inverted&&E&&S?[S.len-u+L,E.len-p+C]:[p+C,u+L]}}resolveColor(){let s=this.series,u=s.chart.options.chart,p=s.chart.styledMode,y,x,E=u.colorCount,S;delete this.nonZonedColor,s.options.colorByPoint?(p||(y=(x=s.options.colors||s.chart.options.colors)[s.colorCounter],E=x.length),S=s.colorCounter,s.colorCounter++,s.colorCounter===E&&(s.colorCounter=0)):(p||(y=s.color),S=s.colorIndex),this.colorIndex=le(this.options.colorIndex,S),this.color=le(this.options.color,y)}setNestedProperty(s,u,p){return p.split(".").reduce(function(y,x,E,S){let C=S.length-1===E;return y[x]=C?u:$(y[x],!0)?y[x]:{},y[x]},s),s}shouldDraw(){return!this.isNull}tooltipFormatter(s){var C;let{chart:u,pointArrayMap:p=["y"],tooltipOptions:y}=this.series,{valueDecimals:x="",valuePrefix:E="",valueSuffix:S=""}=y;return u.styledMode&&(s=((C=u.tooltip)==null?void 0:C.styledModeFormat(s))||s),p.forEach(L=>{L="{point."+L,(E||S)&&(s=s.replace(RegExp(L+"}","g"),E+L+"}"+S)),s=s.replace(RegExp(L+"}","g"),L+":,."+x+"f}")}),d(s,this,u)}update(s,u,p,y){let x,E=this,S=E.series,C=E.graphic,L=S.chart,N=S.options;function z(){E.applyOptions(s);let j=C&&E.hasMockGraphic,W=E.y===null?!j:j;C&&W&&(E.graphic=C.destroy(),delete E.hasMockGraphic),$(s,!0)&&(C!=null&&C.element&&s&&s.marker&&s.marker.symbol!==void 0&&(E.graphic=C.destroy()),s!=null&&s.dataLabels&&E.dataLabel&&(E.dataLabel=E.dataLabel.destroy())),x=E.index;let Y={};for(let re of S.dataColumnKeys())Y[re]=E[re];S.dataTable.setRow(Y,x),N.data[x]=$(N.data[x],!0)||$(s,!0)?E.options:le(s,N.data[x]),S.isDirty=S.isDirtyData=!0,!S.fixedBox&&S.hasCartesianSeries&&(L.isDirtyBox=!0),N.legendType==="point"&&(L.isDirtyLegend=!0),u&&L.redraw(p)}u=le(u,!0),y===!1?z():E.firePointEvent("update",{options:s},z)}remove(s,u){this.series.removePoint(this.series.data.indexOf(this),s,u)}select(s,u){let p=this,y=p.series,x=y.chart;s=le(s,!p.selected),this.selectedStaging=s,p.firePointEvent(s?"select":"unselect",{accumulate:u},function(){p.selected=p.options.selected=s,y.options.data[y.data.indexOf(p)]=p.options,p.setState(s&&"select"),u||x.getSelectedPoints().forEach(function(E){let S=E.series;E.selected&&E!==p&&(E.selected=E.options.selected=!1,S.options.data[S.data.indexOf(E)]=E.options,E.setState(x.hoverPoints&&S.options.inactiveOtherPoints?"inactive":""),E.firePointEvent("unselect"))})}),delete this.selectedStaging}onMouseOver(s){let{inverted:u,pointer:p}=this.series.chart;p&&(s=s?p.normalize(s):p.getChartCoordinatesFromPoint(this,u),p.runPointActions(s,this))}onMouseOut(){let s=this.series.chart;this.firePointEvent("mouseOut"),this.series.options.inactiveOtherPoints||(s.hoverPoints||[]).forEach(function(u){u.setState()}),s.hoverPoints=s.hoverPoint=null}manageEvent(s){var y,x,E,S,C,L,N;let u=K(this.series.options.point,this.options),p=(y=u.events)==null?void 0:y[s];F(p)&&(!((x=this.hcEvents)!=null&&x[s])||((S=(E=this.hcEvents)==null?void 0:E[s])==null?void 0:S.map(z=>z.fn).indexOf(p))===-1)?((C=this.importedUserEvent)==null||C.call(this),this.importedUserEvent=r(this,s,p),this.hcEvents&&(this.hcEvents[s].userEvent=!0)):this.importedUserEvent&&!p&&((L=this.hcEvents)!=null&&L[s])&&((N=this.hcEvents)!=null&&N[s].userEvent)&&(fe(this,s),delete this.hcEvents[s],Object.keys(this.hcEvents)||delete this.importedUserEvent)}setState(s,u){var Re,rt;let p=this.series,y=this.state,x=p.options.states[s||"normal"]||{},E=Bl.plotOptions[p.type].marker&&p.options.marker,S=E&&E.enabled===!1,C=((Re=E==null?void 0:E.states)==null?void 0:Re[s||"normal"])||{},L=C.enabled===!1,N=this.marker||{},z=p.chart,j=E&&p.markerAttribs,W=p.halo,Y,re,te,Q=p.stateMarkerGraphic,ae;if((s=s||"")===this.state&&!u||this.selected&&s!=="select"||x.enabled===!1||s&&(L||S&&C.enabled===!1)||s&&N.states&&N.states[s]&&N.states[s].enabled===!1)return;if(this.state=s,j&&(Y=p.markerAttribs(this,s)),this.graphic&&!this.hasMockGraphic){if(y&&this.graphic.removeClass("highcharts-point-"+y),s&&this.graphic.addClass("highcharts-point-"+s),!z.styledMode){re=p.pointAttribs(this,s),te=le(z.options.chart.animation,x.animation);let qe=re.opacity;p.options.inactiveOtherPoints&&G(qe)&&(this.dataLabels||[]).forEach(function(st){st&&!st.hasClass("highcharts-data-label-hidden")&&(st.animate({opacity:qe},te),st.connector&&st.connector.animate({opacity:qe},te))}),this.graphic.animate(re,te)}Y&&this.graphic.animate(Y,le(z.options.chart.animation,C.animation,E.animation)),Q&&Q.hide()}else s&&C&&(ae=N.symbol||p.symbol,Q&&Q.currentSymbol!==ae&&(Q=Q.destroy()),Y&&(Q?Q[u?"animate":"attr"]({x:Y.x,y:Y.y}):ae&&(p.stateMarkerGraphic=Q=z.renderer.symbol(ae,Y.x,Y.y,Y.width,Y.height,K(E,C)).add(p.markerGroup),Q.currentSymbol=ae)),!z.styledMode&&Q&&this.state!=="inactive"&&Q.attr(p.pointAttribs(this,s))),Q&&(Q[s&&this.isInside?"show":"hide"](),Q.element.point=this,Q.addClass(this.getClassName(),!0));let he=x.halo,Ue=this.graphic||Q,Ie=(Ue==null?void 0:Ue.visibility)||"inherit";he!=null&&he.size&&Ue&&Ie!=="hidden"&&!this.isCluster?(W||(p.halo=W=z.renderer.path().add(Ue.parentGroup)),W.show()[u?"animate":"attr"]({d:this.haloPath(he.size)}),W.attr({class:"highcharts-halo highcharts-color-"+le(this.colorIndex,p.colorIndex)+(this.className?" "+this.className:""),visibility:Ie,zIndex:-1}),W.point=this,z.styledMode||W.attr(v({fill:this.color||p.color,"fill-opacity":he.opacity},Dr.filterUserAttributes(he.attributes||{})))):(rt=W==null?void 0:W.point)!=null&&rt.haloPath&&!W.point.destroyed&&W.animate({d:W.point.haloPath(0)},null,W.hide),T(this,"afterSetState",{state:s})}haloPath(s){let u=this.pos();return u?this.series.chart.renderer.symbols.circle(l(u[0],1)-s,u[1]-s,2*s,2*s):[]}}let J=ge,{parse:ue}=Ye,{charts:ve,composed:be,isTouchDevice:ze}=Ne,{addEvent:Pe,attr:Oe,css:Xe,extend:$e,find:it,fireEvent:Mt,isNumber:et,isObject:gt,objectEach:ot,offset:Pt,pick:Je,pushUnique:_t,splat:Lt}=me;class ft{applyInactiveState(s=[]){let u=[];s.forEach(p=>{let y=p.series;u.push(y),y.linkedParent&&u.push(y.linkedParent),y.linkedSeries&&u.push.apply(u,y.linkedSeries),y.navigatorSeries&&u.push(y.navigatorSeries),y.boosted&&y.markerGroup&&u.push.apply(u,this.chart.series.filter(x=>x.markerGroup===y.markerGroup))}),this.chart.series.forEach(p=>{u.indexOf(p)===-1?p.setState("inactive",!0):p.options.inactiveOtherPoints&&p.setAllPointsToState("inactive")})}destroy(){let s=this;this.eventsToUnbind.forEach(u=>u()),this.eventsToUnbind=[],!Ne.chartCount&&(ft.unbindDocumentMouseUp.forEach(u=>u.unbind()),ft.unbindDocumentMouseUp.length=0,ft.unbindDocumentTouchEnd&&(ft.unbindDocumentTouchEnd=ft.unbindDocumentTouchEnd())),clearInterval(s.tooltipTimeout),ot(s,function(u,p){s[p]=void 0})}getSelectionMarkerAttrs(s,u){let p={args:{chartX:s,chartY:u},attrs:{},shapeType:"rect"};return Mt(this,"getSelectionMarkerAttrs",p,y=>{let x,{chart:E,zoomHor:S,zoomVert:C}=this,{mouseDownX:L=0,mouseDownY:N=0}=E,z=y.attrs;z.x=E.plotLeft,z.y=E.plotTop,z.width=S?1:E.plotWidth,z.height=C?1:E.plotHeight,S&&(z.width=Math.max(1,Math.abs(x=s-L)),z.x=(x>0?0:x)+L),C&&(z.height=Math.max(1,Math.abs(x=u-N)),z.y=(x>0?0:x)+N)}),p}drag(s){let{chart:u}=this,{mouseDownX:p=0,mouseDownY:y=0}=u,{panning:x,panKey:E,selectionMarkerFill:S}=u.options.chart,C=u.plotLeft,L=u.plotTop,N=u.plotWidth,z=u.plotHeight,j=gt(x)?x.enabled:x,W=E&&s[`${E}Key`],Y=s.chartX,re=s.chartY,te,Q=this.selectionMarker;if((!Q||!Q.touch)&&(Y<C?Y=C:Y>C+N&&(Y=C+N),re<L?re=L:re>L+z&&(re=L+z),this.hasDragged=Math.sqrt(Math.pow(p-Y,2)+Math.pow(y-re,2)),this.hasDragged>10)){te=u.isInsidePlot(p-C,y-L,{visiblePlotOnly:!0});let{shapeType:ae,attrs:he}=this.getSelectionMarkerAttrs(Y,re);(u.hasCartesianSeries||u.mapView)&&this.hasZoom&&te&&!W&&!Q&&(this.selectionMarker=Q=u.renderer[ae](),Q.attr({class:"highcharts-selection-marker",zIndex:7}).add(),u.styledMode||Q.attr({fill:S||ue("#334eff").setOpacity(.25).get()})),Q&&Q.attr(he),te&&!Q&&j&&u.pan(s,x)}}dragStart(s){let u=this.chart;u.mouseIsDown=s.type,u.cancelClick=!1,u.mouseDownX=s.chartX,u.mouseDownY=s.chartY}getSelectionBox(s){let u={args:{marker:s},result:s.getBBox()};return Mt(this,"getSelectionBox",u),u.result}drop(s){let u,{chart:p,selectionMarker:y}=this;for(let x of p.axes)x.isPanning&&(x.isPanning=!1,(x.options.startOnTick||x.options.endOnTick||x.series.some(E=>E.boosted))&&(x.forceRedraw=!0,x.setExtremes(x.userMin,x.userMax,!1),u=!0));if(u&&p.redraw(),y&&s){if(this.hasDragged){let x=this.getSelectionBox(y);p.transform({axes:p.axes.filter(E=>E.zoomEnabled&&(E.coll==="xAxis"&&this.zoomX||E.coll==="yAxis"&&this.zoomY)),selection:{originalEvent:s,xAxis:[],yAxis:[],...x},from:x})}et(p.index)&&(this.selectionMarker=y.destroy())}p&&et(p.index)&&(Xe(p.container,{cursor:p._cursor}),p.cancelClick=this.hasDragged>10,p.mouseIsDown=!1,this.hasDragged=0,this.pinchDown=[])}findNearestKDPoint(s,u,p){let y;return s.forEach(function(x){let E=!(x.noSharedTooltip&&u)&&0>x.options.findNearestPointBy.indexOf("y"),S=x.searchPoint(p,E);gt(S,!0)&&S.series&&(!gt(y,!0)||function(C,L){var W,Y;let N=C.distX-L.distX,z=C.dist-L.dist,j=((W=L.series.group)==null?void 0:W.zIndex)-((Y=C.series.group)==null?void 0:Y.zIndex);return N!==0&&u?N:z!==0?z:j!==0?j:C.series.index>L.series.index?-1:1}(y,S)>0)&&(y=S)}),y}getChartCoordinatesFromPoint(s,u){let{xAxis:p,yAxis:y}=s.series,x=s.shapeArgs;if(p&&y){let E=s.clientX??s.plotX??0,S=s.plotY||0;return s.isNode&&x&&et(x.x)&&et(x.y)&&(E=x.x,S=x.y),u?{chartX:y.len+y.pos-S,chartY:p.len+p.pos-E}:{chartX:E+p.pos,chartY:S+y.pos}}if(x!=null&&x.x&&x.y)return{chartX:x.x,chartY:x.y}}getChartPosition(){if(this.chartPosition)return this.chartPosition;let{container:s}=this.chart,u=Pt(s);this.chartPosition={left:u.left,top:u.top,scaleX:1,scaleY:1};let{offsetHeight:p,offsetWidth:y}=s;return y>2&&p>2&&(this.chartPosition.scaleX=u.width/y,this.chartPosition.scaleY=u.height/p),this.chartPosition}getCoordinates(s){let u={xAxis:[],yAxis:[]};for(let p of this.chart.axes)u[p.isXAxis?"xAxis":"yAxis"].push({axis:p,value:p.toValue(s[p.horiz?"chartX":"chartY"])});return u}getHoverData(s,u,p,y,x,E){let S=[],C=function(W){return W.visible&&!(!x&&W.directTouch)&&Je(W.options.enableMouseTracking,!0)},L=u,N,z={chartX:E?E.chartX:void 0,chartY:E?E.chartY:void 0,shared:x};Mt(this,"beforeGetHoverData",z),N=L&&!L.stickyTracking?[L]:p.filter(W=>W.stickyTracking&&(z.filter||C)(W));let j=y&&s||!E?s:this.findNearestKDPoint(N,x,E);return L=j==null?void 0:j.series,j&&(x&&!L.noSharedTooltip?(N=p.filter(function(W){return z.filter?z.filter(W):C(W)&&!W.noSharedTooltip})).forEach(function(W){var te;let Y=(te=W.options)==null?void 0:te.nullInteraction,re=it(W.points,function(Q){return Q.x===j.x&&(!Q.isNull||!!Y)});gt(re)&&(W.boosted&&W.boost&&(re=W.boost.getPoint(re)),S.push(re))}):S.push(j)),Mt(this,"afterGetHoverData",z={hoverPoint:j}),{hoverPoint:z.hoverPoint,hoverSeries:L,hoverPoints:S}}getPointFromEvent(s){let u=s.target,p;for(;u&&!p;)p=u.point,u=u.parentNode;return p}onTrackerMouseOut(s){let u=this.chart,p=s.relatedTarget,y=u.hoverSeries;this.isDirectTouch=!1,!y||!p||y.stickyTracking||this.inClass(p,"highcharts-tooltip")||this.inClass(p,"highcharts-series-"+y.index)&&this.inClass(p,"highcharts-tracker")||y.onMouseOut()}inClass(s,u){let p=s,y;for(;p;){if(y=Oe(p,"class")){if(y.indexOf(u)!==-1)return!0;if(y.indexOf("highcharts-container")!==-1)return!1}p=p.parentElement}}constructor(s,u){var p;this.hasDragged=0,this.pointerCaptureEventsToUnbind=[],this.eventsToUnbind=[],this.options=u,this.chart=s,this.runChartClick=!!((p=u.chart.events)!=null&&p.click),this.pinchDown=[],this.setDOMEvents(),Mt(this,"afterInit")}normalize(s,u){let p=s.touches,y=p?p.length?p.item(0):Je(p.changedTouches,s.changedTouches)[0]:s;u||(u=this.getChartPosition());let x=y.pageX-u.left,E=y.pageY-u.top;return $e(s,{chartX:Math.round(x/=u.scaleX),chartY:Math.round(E/=u.scaleY)})}onContainerClick(s){let u=this.chart,p=u.hoverPoint,y=this.normalize(s),x=u.plotLeft,E=u.plotTop;!u.cancelClick&&(p&&this.inClass(y.target,"highcharts-tracker")?(Mt(p.series,"click",$e(y,{point:p})),u.hoverPoint&&p.firePointEvent("click",y)):($e(y,this.getCoordinates(y)),u.isInsidePlot(y.chartX-x,y.chartY-E,{visiblePlotOnly:!0})&&Mt(u,"click",y)))}onContainerMouseDown(s){var p;let u=(1&(s.buttons||s.button))==1;s=this.normalize(s),Ne.isFirefox&&s.button!==0&&this.onContainerMouseMove(s),(s.button===void 0||u)&&(this.zoomOption(s),u&&((p=s.preventDefault)==null||p.call(s)),this.dragStart(s))}onContainerMouseLeave(s){let{pointer:u}=ve[Je(ft.hoverChartIndex,-1)]||{};s=this.normalize(s),this.onContainerMouseMove(s),u&&!this.inClass(s.relatedTarget,"highcharts-tooltip")&&(u.reset(),u.chartPosition=void 0)}onContainerMouseEnter(){delete this.chartPosition}onContainerMouseMove(s){let u=this.chart,p=u.tooltip,y=this.normalize(s);this.setHoverChartIndex(s),(u.mouseIsDown==="mousedown"||this.touchSelect(y))&&this.drag(y),!u.openMenu&&(this.inClass(y.target,"highcharts-tracker")||u.isInsidePlot(y.chartX-u.plotLeft,y.chartY-u.plotTop,{visiblePlotOnly:!0}))&&!(p!=null&&p.shouldStickOnContact(y))&&(this.inClass(y.target,"highcharts-no-tooltip")?this.reset(!1,0):this.runPointActions(y))}onDocumentTouchEnd(s){this.onDocumentMouseUp(s)}onContainerTouchMove(s){this.touchSelect(s)?this.onContainerMouseMove(s):this.touch(s)}onContainerTouchStart(s){this.touchSelect(s)?this.onContainerMouseDown(s):(this.zoomOption(s),this.touch(s,!0))}onDocumentMouseMove(s){let u=this.chart,p=u.tooltip,y=this.chartPosition,x=this.normalize(s,y);!y||u.isInsidePlot(x.chartX-u.plotLeft,x.chartY-u.plotTop,{visiblePlotOnly:!0})||p!=null&&p.shouldStickOnContact(x)||x.target!==u.container.ownerDocument&&this.inClass(x.target,"highcharts-tracker")||this.reset()}onDocumentMouseUp(s){var u,p;(p=(u=ve[Je(ft.hoverChartIndex,-1)])==null?void 0:u.pointer)==null||p.drop(s)}pinch(s){let u=this,{chart:p,hasZoom:y,lastTouches:x}=u,E=[].map.call(s.touches||[],z=>u.normalize(z)),S=E.length,C=S===1&&(u.inClass(s.target,"highcharts-tracker")&&p.runTrackerClick||u.runChartClick),L=p.tooltip,N=S===1&&Je(L==null?void 0:L.options.followTouchMove,!0);S>1?u.initiated=!0:N&&(u.initiated=!1),y&&u.initiated&&!C&&s.cancelable!==!1&&s.preventDefault(),s.type==="touchstart"?(u.pinchDown=E,u.res=!0,p.mouseDownX=s.chartX):N?this.runPointActions(u.normalize(s)):x&&(Mt(p,"touchpan",{originalEvent:s,touches:E},()=>{let z=j=>{let W=j[0],Y=j[1]||W;return{x:W.chartX,y:W.chartY,width:Y.chartX-W.chartX,height:Y.chartY-W.chartY}};p.transform({axes:p.axes.filter(j=>j.zoomEnabled&&(this.zoomHor&&j.horiz||this.zoomVert&&!j.horiz)),to:z(E),from:z(x),trigger:s.type})}),u.res&&(u.res=!1,this.reset(!1,0))),u.lastTouches=E}reset(s,u){let p=this.chart,y=p.hoverSeries,x=p.hoverPoint,E=p.hoverPoints,S=p.tooltip,C=S!=null&&S.shared?E:x;s&&C&&Lt(C).forEach(function(L){L.series.isCartesian&&L.plotX===void 0&&(s=!1)}),s?S&&C&&Lt(C).length&&(S.refresh(C),S.shared&&E?E.forEach(function(L){L.setState(L.state,!0),L.series.isCartesian&&(L.series.xAxis.crosshair&&L.series.xAxis.drawCrosshair(null,L),L.series.yAxis.crosshair&&L.series.yAxis.drawCrosshair(null,L))}):x&&(x.setState(x.state,!0),p.axes.forEach(function(L){L.crosshair&&x.series[L.coll]===L&&L.drawCrosshair(null,x)}))):(x&&x.onMouseOut(),E&&E.forEach(function(L){L.setState()}),y&&y.onMouseOut(),S&&S.hide(u),this.unDocMouseMove&&(this.unDocMouseMove=this.unDocMouseMove()),p.axes.forEach(function(L){L.hideCrosshair()}),p.hoverPoints=p.hoverPoint=void 0)}runPointActions(s,u,p){var re;let y=this.chart,x=y.series,E=(re=y.tooltip)!=null&&re.options.enabled?y.tooltip:void 0,S=!!E&&E.shared,C=u||y.hoverPoint,L=(C==null?void 0:C.series)||y.hoverSeries,N=(!s||s.type!=="touchmove")&&(!!u||(L==null?void 0:L.directTouch)&&this.isDirectTouch),z=this.getHoverData(C,L,x,N,S,s);C=z.hoverPoint,L=z.hoverSeries;let j=z.hoverPoints,W=(L==null?void 0:L.tooltipOptions.followPointer)&&!L.tooltipOptions.split,Y=S&&L&&!L.noSharedTooltip;if(C&&(p||C!==y.hoverPoint||E!=null&&E.isHidden)){if((y.hoverPoints||[]).forEach(function(te){j.indexOf(te)===-1&&te.setState()}),y.hoverSeries!==L&&L.onMouseOver(),this.applyInactiveState(j),(j||[]).forEach(function(te){te.setState("hover")}),y.hoverPoint&&y.hoverPoint.firePointEvent("mouseOut"),!C.series)return;y.hoverPoints=j,y.hoverPoint=C,C.firePointEvent("mouseOver",void 0,()=>{E&&C&&E.refresh(Y?j:C,s)})}else if(W&&E&&!E.isHidden){let te=E.getAnchor([{}],s);y.isInsidePlot(te[0],te[1],{visiblePlotOnly:!0})&&E.updatePosition({plotX:te[0],plotY:te[1]})}this.unDocMouseMove||(this.unDocMouseMove=Pe(y.container.ownerDocument,"mousemove",te=>{var Q,ae;return(ae=(Q=ve[ft.hoverChartIndex??-1])==null?void 0:Q.pointer)==null?void 0:ae.onDocumentMouseMove(te)}),this.eventsToUnbind.push(this.unDocMouseMove)),y.axes.forEach(function(te){var he;let Q,ae=((he=te.crosshair)==null?void 0:he.snap)??!0;!ae||(Q=y.hoverPoint)&&Q.series[te.coll]===te||(Q=it(j,Ue=>{var Ie;return((Ie=Ue.series)==null?void 0:Ie[te.coll])===te})),Q||!ae?te.drawCrosshair(s,Q):te.hideCrosshair()})}setDOMEvents(){let s=this.chart.container,u=s.ownerDocument;s.onmousedown=this.onContainerMouseDown.bind(this),s.onmousemove=this.onContainerMouseMove.bind(this),s.onclick=this.onContainerClick.bind(this),this.eventsToUnbind.push(Pe(s,"mouseenter",this.onContainerMouseEnter.bind(this)),Pe(s,"mouseleave",this.onContainerMouseLeave.bind(this))),ft.unbindDocumentMouseUp.some(y=>y.doc===u)||ft.unbindDocumentMouseUp.push({doc:u,unbind:Pe(u,"mouseup",this.onDocumentMouseUp.bind(this))});let p=this.chart.renderTo.parentElement;for(;p&&p.tagName!=="BODY";)this.eventsToUnbind.push(Pe(p,"scroll",()=>{delete this.chartPosition})),p=p.parentElement;this.eventsToUnbind.push(Pe(s,"touchstart",this.onContainerTouchStart.bind(this),{passive:!1}),Pe(s,"touchmove",this.onContainerTouchMove.bind(this),{passive:!1})),ft.unbindDocumentTouchEnd||(ft.unbindDocumentTouchEnd=Pe(u,"touchend",this.onDocumentTouchEnd.bind(this),{passive:!1})),this.setPointerCapture(),Pe(this.chart,"redraw",this.setPointerCapture.bind(this))}setPointerCapture(){var x,E;if(!ze)return;let s=this.pointerCaptureEventsToUnbind,u=this.chart,p=u.container,y=Je((x=u.options.tooltip)==null?void 0:x.followTouchMove,!0)&&u.series.some(S=>S.options.findNearestPointBy.indexOf("y")>-1);!this.hasPointerCapture&&y?(s.push(Pe(p,"pointerdown",S=>{var C,L;(C=S.target)!=null&&C.hasPointerCapture(S.pointerId)&&((L=S.target)==null||L.releasePointerCapture(S.pointerId))}),Pe(p,"pointermove",S=>{var C,L;(L=(C=u.pointer)==null?void 0:C.getPointFromEvent(S))==null||L.onMouseOver(S)})),u.styledMode||Xe(p,{"touch-action":"none"}),p.className+=" highcharts-no-touch-action",this.hasPointerCapture=!0):this.hasPointerCapture&&!y&&(s.forEach(S=>S()),s.length=0,u.styledMode||Xe(p,{"touch-action":Je((E=u.options.chart.style)==null?void 0:E["touch-action"],"manipulation")}),p.className=p.className.replace(" highcharts-no-touch-action",""),this.hasPointerCapture=!1)}setHoverChartIndex(s){var y;let u=this.chart,p=Ne.charts[Je(ft.hoverChartIndex,-1)];if(p&&p!==u){let x={relatedTarget:u.container};s&&!(s!=null&&s.relatedTarget)&&Object.assign({},s,x),(y=p.pointer)==null||y.onContainerMouseLeave(s||x)}p!=null&&p.mouseIsDown||(ft.hoverChartIndex=u.index)}touch(s,u){let p,{chart:y,pinchDown:x=[]}=this;this.setHoverChartIndex(),(s=this.normalize(s)).touches.length===1?y.isInsidePlot(s.chartX-y.plotLeft,s.chartY-y.plotTop,{visiblePlotOnly:!0})&&!y.openMenu?(u&&this.runPointActions(s),s.type==="touchmove"&&(p=!!x[0]&&Math.pow(x[0].chartX-s.chartX,2)+Math.pow(x[0].chartY-s.chartY,2)>=16),Je(p,!0)&&this.pinch(s)):u&&this.reset():s.touches.length===2&&this.pinch(s)}touchSelect(s){return!!(this.chart.zooming.singleTouch&&s.touches&&s.touches.length===1)}zoomOption(s){let u=this.chart,p=u.inverted,y=u.zooming.type||"",x,E;/touch/.test(s.type)&&(y=Je(u.zooming.pinchType,y)),this.zoomX=x=/x/.test(y),this.zoomY=E=/y/.test(y),this.zoomHor=x&&!p||E&&p,this.zoomVert=E&&!p||x&&p,this.hasZoom=x||E}}ft.unbindDocumentMouseUp=[],function(R){R.compose=function(s){_t(be,"Core.Pointer")&&Pe(s,"beforeRender",function(){this.pointer=new R(this,this.options)})}}(ft||(ft={}));let Rt=ft;(function(R){R.setLength=function(s,u,p){return Array.isArray(s)?(s.length=u,s):s[p?"subarray":"slice"](0,u)},R.splice=function(s,u,p,y,x=[]){if(Array.isArray(s))return Array.isArray(x)||(x=Array.from(x)),{removed:s.splice(u,p,...x),array:s};let E=Object.getPrototypeOf(s).constructor,S=s[y?"subarray":"slice"](u,u+p),C=new E(s.length-p+x.length);return C.set(s.subarray(0,u),0),C.set(x,u),C.set(s.subarray(u+p),u+x.length),{removed:S,array:C}}})(xe||(xe={}));let{setLength:mi,splice:ki}=xe,{fireEvent:oi,objectEach:_i,uniqueKey:Oi}=me,Bi=class{constructor(R={}){this.autoId=!R.id,this.columns={},this.id=R.id||Oi(),this.modified=this,this.rowCount=0,this.versionTag=Oi();let s=0;_i(R.columns||{},(u,p)=>{this.columns[p]=u.slice(),s=Math.max(s,u.length)}),this.applyRowCount(s)}applyRowCount(R){this.rowCount=R,_i(this.columns,(s,u)=>{s.length!==R&&(this.columns[u]=mi(s,R))})}deleteRows(R,s=1){if(s>0&&R<this.rowCount){let u=0;_i(this.columns,(p,y)=>{this.columns[y]=ki(p,R,s).array,u=p.length}),this.rowCount=u}oi(this,"afterDeleteRows",{rowIndex:R,rowCount:s}),this.versionTag=Oi()}getColumn(R,s){return this.columns[R]}getColumns(R,s){return(R||Object.keys(this.columns)).reduce((u,p)=>(u[p]=this.columns[p],u),{})}getRow(R,s){return(s||Object.keys(this.columns)).map(u=>{var p;return(p=this.columns[u])==null?void 0:p[R]})}setColumn(R,s=[],u=0,p){this.setColumns({[R]:s},u,p)}setColumns(R,s,u){let p=this.rowCount;_i(R,(y,x)=>{this.columns[x]=y.slice(),p=y.length}),this.applyRowCount(p),u!=null&&u.silent||(oi(this,"afterSetColumns"),this.versionTag=Oi())}setRow(R,s=this.rowCount,u,p){let{columns:y}=this,x=u?this.rowCount+1:s+1;_i(R,(E,S)=>{let C=y[S]||(p==null?void 0:p.addColumns)!==!1&&Array(x);C&&(u?C=ki(C,s,0,!0,[E]).array:C[s]=E,y[S]=C)}),x>this.rowCount&&this.applyRowCount(x),p!=null&&p.silent||(oi(this,"afterSetRows"),this.versionTag=Oi())}},{extend:di,merge:xr,pick:Er}=me;(function(R){function s(u,p,y){var Ue,Ie;let x=this.legendItem=this.legendItem||{},{chart:E,options:S}=this,{baseline:C=0,symbolWidth:L,symbolHeight:N}=u,z=this.symbol||"circle",j=N/2,W=E.renderer,Y=x.group,re=C-Math.round((((Ue=u.fontMetrics)==null?void 0:Ue.b)||N)*(y?.4:.3)),te={},Q,ae=S.marker,he=0;if(E.styledMode||(te["stroke-width"]=Math.min(S.lineWidth||0,24),S.dashStyle?te.dashstyle=S.dashStyle:S.linecap==="square"||(te["stroke-linecap"]="round")),x.line=W.path().addClass("highcharts-graph").attr(te).add(Y),y&&(x.area=W.path().addClass("highcharts-area").add(Y)),te["stroke-linecap"]&&(he=Math.min(x.line.strokeWidth(),L)/2),L){let Re=[["M",he,re],["L",L-he,re]];x.line.attr({d:Re}),(Ie=x.area)==null||Ie.attr({d:[...Re,["L",L-he,C],["L",he,C]]})}if(ae&&ae.enabled!==!1&&L){let Re=Math.min(Er(ae.radius,j),j);z.indexOf("url")===0&&(ae=xr(ae,{width:N,height:N}),Re=0),x.symbol=Q=W.symbol(z,L/2-Re,re-Re,2*Re,2*Re,di({context:"legend"},ae)).addClass("highcharts-point").add(Y),Q.isMarker=!0}}R.areaMarker=function(u,p){s.call(this,u,p,!0)},R.lineMarker=s,R.rectangle=function(u,p){let y=p.legendItem||{},x=u.options,E=u.symbolHeight,S=x.squareSymbol,C=S?E:u.symbolWidth;y.symbol=this.chart.renderer.rect(S?(u.symbolWidth-E)/2:0,u.baseline-E+1,C,E,Er(u.options.symbolRadius,E/2)).addClass("highcharts-point").attr({zIndex:3}).add(y.group)}})(Te||(Te={}));let Sr=Te,{defaultOptions:Ar}=Ee,{extend:en,extendClass:Gs,merge:Nn}=me;(function(R){function s(u,p){let y=Ar.plotOptions||{},x=p.defaultOptions,E=p.prototype;return E.type=u,E.pointClass||(E.pointClass=J),!R.seriesTypes[u]&&(x&&(y[u]=x),R.seriesTypes[u]=p,!0)}R.seriesTypes=Ne.seriesTypes,R.registerSeriesType=s,R.seriesType=function(u,p,y,x,E){let S=Ar.plotOptions||{};if(p=p||"",S[u]=Nn(S[p],y),delete R.seriesTypes[u],s(u,Gs(R.seriesTypes[p]||function(){},x)),R.seriesTypes[u].prototype.type=u,E){class C extends J{}en(C.prototype,E),R.seriesTypes[u].prototype.pointClass=C}return R.seriesTypes[u]}})(je||(je={}));let wr=je,{animObject:Fr,setAnimation:Lr}=ls,{defaultOptions:or}=Ee,{registerEventOptions:ys}=Tc,{svg:dn,win:Nr}=Ne,{seriesTypes:ks}=wr,{format:kh}=Ys,{arrayMax:ea,arrayMin:Fl,clamp:Po,correctFloat:ta,crisp:Ya,defined:ns,destroyObjectProperties:Rc,diffObjects:Yu,erase:Uf,error:Ku,extend:Ph,find:jf,fireEvent:Jr,getClosestDistance:dg,getNestedProperty:mp,insertItem:Ju,isArray:wa,isNumber:Ms,isString:pg,merge:Ih,objectEach:Vf,pick:hs,removeEvent:Py,syncTimeout:gp}=me;class Cn{constructor(){this.zoneAxis="y"}init(s,u){var C,L,N;let p;Jr(this,"init",{options:u}),this.dataTable??(this.dataTable=new Bi);let y=s.series;this.eventsToUnbind=[],this.chart=s,this.options=this.setOptions(u);let x=this.options,E=x.visible!==!1;this.linkedSeries=[],this.bindAxes(),Ph(this,{name:x.name,state:"",visible:E,selected:x.selected===!0}),ys(this,x);let S=x.events;(S!=null&&S.click||(L=(C=x.point)==null?void 0:C.events)!=null&&L.click||x.allowPointSelect)&&(s.runTrackerClick=!0),this.getColor(),this.getSymbol(),this.isCartesian&&(s.hasCartesianSeries=!0),y.length&&(p=y[y.length-1]),this._i=hs(p==null?void 0:p._i,-1)+1,this.opacity=this.options.opacity,s.orderItems("series",Ju(this,y)),(N=x.dataSorting)!=null&&N.enabled?this.setDataSortingOptions():this.points||this.data||this.setData(x.data,!1),Jr(this,"afterInit")}is(s){return ks[s]&&this instanceof ks[s]}bindAxes(){let s,u=this,p=u.options,y=u.chart;Jr(this,"bindAxes",null,function(){(u.axisTypes||[]).forEach(function(x){(y[x]||[]).forEach(function(E){s=E.options,(hs(p[x],0)===E.index||p[x]!==void 0&&p[x]===s.id)&&(Ju(u,E.series),u[x]=E,E.isDirty=!0)}),u[x]||u.optionalAxis===x||Ku(18,!0,y)})}),Jr(this,"afterBindAxes")}hasData(){return this.visible&&this.dataMax!==void 0&&this.dataMin!==void 0||this.visible&&this.dataTable.rowCount>0}hasMarkerChanged(s,u){let p=s.marker,y=u.marker||{};return p&&(y.enabled&&!p.enabled||y.symbol!==p.symbol||y.height!==p.height||y.width!==p.width)}autoIncrement(s){let u,p=this.options,{pointIntervalUnit:y,relativeXValue:x}=this.options,E=this.chart.time,S=this.xIncrement??E.parse(p.pointStart)??0;if(this.pointInterval=u=hs(this.pointInterval,p.pointInterval,1),x&&Ms(s)&&(u*=s),y){let C=E.toParts(S);y==="day"?C[2]+=u:y==="month"?C[1]+=u:y==="year"&&(C[0]+=u),u=E.makeTime.apply(E,C)-S}return x&&Ms(s)?S+u:(this.xIncrement=S+u,S)}setDataSortingOptions(){let s=this.options;Ph(this,{requireSorting:!1,sorted:!1,enabledDataSorting:!0,allowDG:!1}),ns(s.pointRange)||(s.pointRange=1)}setOptions(s){var te,Q;let u,p=this.chart,y=p.options.plotOptions,x=p.userOptions||{},E=Ih(s),S=p.styledMode,C={plotOptions:y,userOptions:E};Jr(this,"setOptions",C);let L=C.plotOptions[this.type],N=x.plotOptions||{},z=N.series||{},j=or.plotOptions[this.type]||{},W=N[this.type]||{};L.dataLabels=this.mergeArrays(j.dataLabels,L.dataLabels),this.userOptions=C.userOptions;let Y=Ih(L,y.series,W,E);this.tooltipOptions=Ih(or.tooltip,(te=or.plotOptions.series)==null?void 0:te.tooltip,j==null?void 0:j.tooltip,p.userOptions.tooltip,(Q=N.series)==null?void 0:Q.tooltip,W.tooltip,E.tooltip),this.stickyTracking=hs(E.stickyTracking,W.stickyTracking,z.stickyTracking,!!this.tooltipOptions.shared&&!this.noSharedTooltip||Y.stickyTracking),L.marker===null&&delete Y.marker,this.zoneAxis=Y.zoneAxis||"y";let re=this.zones=(Y.zones||[]).map(ae=>({...ae}));return(Y.negativeColor||Y.negativeFillColor)&&!Y.zones&&(u={value:Y[this.zoneAxis+"Threshold"]||Y.threshold||0,className:"highcharts-negative"},S||(u.color=Y.negativeColor,u.fillColor=Y.negativeFillColor),re.push(u)),re.length&&ns(re[re.length-1].value)&&re.push(S?{}:{color:this.color,fillColor:this.fillColor}),Jr(this,"afterSetOptions",{options:Y}),Y}getName(){return this.options.name??kh(this.chart.options.lang.seriesName,this,this.chart)}getCyclic(s,u,p){let y,x,E=this.chart,S=`${s}Index`,C=`${s}Counter`,L=(p==null?void 0:p.length)||E.options.chart.colorCount;!u&&(ns(x=hs(s==="color"?this.options.colorIndex:void 0,this[S]))?y=x:(E.series.length||(E[C]=0),y=E[C]%L,E[C]+=1),p&&(u=p[y])),y!==void 0&&(this[S]=y),this[s]=u}getColor(){this.chart.styledMode?this.getCyclic("color"):this.options.colorByPoint?this.color="#cccccc":this.getCyclic("color",this.options.color||or.plotOptions[this.type].color,this.chart.options.colors)}getPointsCollection(){return(this.hasGroupedData?this.points:this.data)||[]}getSymbol(){let s=this.options.marker;this.getCyclic("symbol",s.symbol,this.chart.options.symbols)}getColumn(s,u){return(u?this.dataTable.modified:this.dataTable).getColumn(s,!0)||[]}findPointIndex(s,u){var z;let p,y,x,{id:E,x:S}=s,C=this.points,L=this.options.dataSorting,N=this.cropStart||0;if(E){let j=this.chart.get(E);j instanceof J&&(p=j)}else if(this.linkedParent||this.enabledDataSorting||this.options.relativeXValue){let j=W=>!W.touched&&W.index===s.index;if(L!=null&&L.matchByName?j=W=>!W.touched&&W.name===s.name:this.options.relativeXValue&&(j=W=>!W.touched&&W.options.x===s.x),!(p=jf(C,j)))return}return p&&(x=p==null?void 0:p.index)!==void 0&&(y=!0),x===void 0&&Ms(S)&&(x=this.getColumn("x").indexOf(S,u)),x!==-1&&x!==void 0&&this.cropped&&(x=x>=N?x-N:x),!y&&Ms(x)&&((z=C[x])!=null&&z.touched)&&(x=void 0),x}updateData(s,u){var re;let{options:p,requireSorting:y}=this,x=p.dataSorting,E=this.points,S=[],C=s.length===E.length,L,N,z,j,W=!0;if(this.xIncrement=null,s.forEach((te,Q)=>{var Re;let ae,he=ns(te)&&this.pointClass.prototype.optionsToObject.call({series:this},te)||{},{id:Ue,x:Ie}=he;Ue||Ms(Ie)?((ae=this.findPointIndex(he,j))===-1||ae===void 0?S.push(te):E[ae]&&te!==((Re=p.data)==null?void 0:Re[ae])?(E[ae].update(te,!1,void 0,!1),E[ae].touched=!0,y&&(j=ae+1)):E[ae]&&(E[ae].touched=!0),(!C||Q!==ae||x!=null&&x.enabled||this.hasDerivedData)&&(L=!0)):S.push(te)},this),L)for(N=E.length;N--;)(z=E[N])&&!z.touched&&((re=z.remove)==null||re.call(z,!1,u));else C&&!(x!=null&&x.enabled)?(s.forEach((te,Q)=>{te===E[Q].y||E[Q].destroyed||E[Q].update(te,!1,void 0,!1)}),S.length=0):W=!1;if(E.forEach(te=>{te&&(te.touched=!1)}),!W)return!1;S.forEach(te=>{this.addPoint(te,!1,void 0,void 0,!1)},this);let Y=this.getColumn("x");return this.xIncrement===null&&Y.length&&(this.xIncrement=ea(Y),this.autoIncrement()),!0}dataColumnKeys(){return["x",...this.pointArrayMap||["y"]]}setData(s,u=!0,p,y){var rt,qe;let x=this.points,E=(x==null?void 0:x.length)||0,S=this.options,C=this.chart,L=S.dataSorting,N=this.xAxis,z=S.turboThreshold,j=this.dataTable,W=this.dataColumnKeys(),Y=this.pointValKey||"y",re=(this.pointArrayMap||[]).length,te=S.keys,Q,ae,he=0,Ue=1,Ie;C.options.chart.allowMutatingData||(S.data&&delete this.options.data,this.userOptions.data&&delete this.userOptions.data,Ie=Ih(!0,s));let Re=(s=Ie||s||[]).length;if(L!=null&&L.enabled&&(s=this.sortData(s)),C.options.chart.allowMutatingData&&y!==!1&&Re&&E&&!this.cropped&&!this.hasGroupedData&&this.visible&&!this.boosted&&(ae=this.updateData(s,p)),!ae){this.xIncrement=null,this.colorCounter=0;let st=z&&Re>z;if(st){let Et=this.getFirstValidPoint(s),Bt=this.getFirstValidPoint(s,Re-1,-1),$t=At=>!!(wa(At)&&(te||Ms(At[0])));if(Ms(Et)&&Ms(Bt)){let At=[],Kt=[];for(let si of s)At.push(this.autoIncrement()),Kt.push(si);j.setColumns({x:At,[Y]:Kt})}else if($t(Et)&&$t(Bt))if(re){let At=+(Et.length===re),Kt=Array(W.length).fill(0).map(()=>[]);for(let si of s){At&&Kt[0].push(this.autoIncrement());for(let Ii=At;Ii<=re;Ii++)(rt=Kt[Ii])==null||rt.push(si[Ii-At])}j.setColumns(W.reduce((si,Ii,hi)=>(si[Ii]=Kt[hi],si),{}))}else{te&&(he=te.indexOf("x"),Ue=te.indexOf("y"),he=he>=0?he:0,Ue=Ue>=0?Ue:1),Et.length===1&&(Ue=0);let At=[],Kt=[];if(he===Ue)for(let si of s)At.push(this.autoIncrement()),Kt.push(si[Ue]);else for(let si of s)At.push(si[he]),Kt.push(si[Ue]);j.setColumns({x:At,[Y]:Kt})}else st=!1}if(!st){let Et=W.reduce((Bt,$t)=>(Bt[$t]=[],Bt),{});for(Q=0;Q<Re;Q++){let Bt=this.pointClass.prototype.applyOptions.apply({series:this},[s[Q]]);for(let $t of W)Et[$t][Q]=Bt[$t]}j.setColumns(Et)}for(pg(this.getColumn("y")[0])&&Ku(14,!0,C),this.data=[],this.options.data=this.userOptions.data=s,Q=E;Q--;)(qe=x[Q])==null||qe.destroy();N&&(N.minRange=N.userMinRange),this.isDirty=C.isDirtyBox=!0,this.isDirtyData=!!x,p=!1}S.legendType==="point"&&(this.processData(),this.generatePoints()),u&&C.redraw(p)}sortData(s){let u=this,p=u.options.dataSorting.sortKey||"y",y=function(x,E){return ns(E)&&x.pointClass.prototype.optionsToObject.call({series:x},E)||{}};return s.forEach(function(x,E){s[E]=y(u,x),s[E].index=E},this),s.concat().sort((x,E)=>{let S=mp(p,x),C=mp(p,E);return C<S?-1:+(C>S)}).forEach(function(x,E){x.x=E},this),u.linkedSeries&&u.linkedSeries.forEach(function(x){var C;let E=x.options,S=E.data;!((C=E.dataSorting)!=null&&C.enabled)&&S&&(S.forEach(function(L,N){S[N]=y(x,L),s[N]&&(S[N].x=s[N].x,S[N].index=N)}),x.setData(S,!1))}),s}getProcessedData(s){let u=this,{dataTable:p,isCartesian:y,options:x,xAxis:E}=u,S=x.cropThreshold,C=s||u.getExtremesFromAll,L=E==null?void 0:E.logarithmic,N=p.rowCount,z,j,W=0,Y,re,te,Q=u.getColumn("x"),ae=p,he=!1;return E&&(re=(Y=E.getExtremes()).min,te=Y.max,he=!!(E.categories&&!E.names.length),y&&u.sorted&&!C&&(!S||N>S||u.forceCrop)&&(Q[N-1]<re||Q[0]>te?ae=new Bi:u.getColumn(u.pointValKey||"y").length&&(Q[0]<re||Q[N-1]>te)&&(ae=(z=this.cropData(p,re,te)).modified,W=z.start,j=!0))),Q=ae.getColumn("x")||[],{modified:ae,cropped:j,cropStart:W,closestPointRange:dg([L?Q.map(L.log2lin):Q],()=>u.requireSorting&&!he&&Ku(15,!1,u.chart))}}processData(s){let u=this.xAxis,p=this.dataTable;if(this.isCartesian&&!this.isDirty&&!u.isDirty&&!this.yAxis.isDirty&&!s)return!1;let y=this.getProcessedData();p.modified=y.modified,this.cropped=y.cropped,this.cropStart=y.cropStart,this.closestPointRange=this.basePointRange=y.closestPointRange,Jr(this,"afterProcessData")}cropData(s,u,p){let y=s.getColumn("x",!0)||[],x=y.length,E={},S,C,L=0,N=x;for(S=0;S<x;S++)if(y[S]>=u){L=Math.max(0,S-1);break}for(C=S;C<x;C++)if(y[C]>p){N=C+1;break}for(let z of this.dataColumnKeys()){let j=s.getColumn(z,!0);j&&(E[z]=j.slice(L,N))}return{modified:new Bi({columns:E}),start:L,end:N}}generatePoints(){var Ie,Re,rt;let s=this.options,u=this.processedData||s.data,p=this.dataTable.modified,y=this.getColumn("x",!0),x=this.pointClass,E=p.rowCount,S=this.cropStart||0,C=this.hasGroupedData,L=s.keys,N=[],z=(Ie=s.dataGrouping)!=null&&Ie.groupAll?S:0,j=(Re=this.xAxis)==null?void 0:Re.categories,W=this.pointArrayMap||["y"],Y=this.dataColumnKeys(),re,te,Q,ae,he=this.data,Ue;if(!he&&!C){let qe=[];qe.length=(u==null?void 0:u.length)||0,he=this.data=qe}for(L&&C&&(this.options.keys=!1),ae=0;ae<E;ae++)te=S+ae,C?((Q=new x(this,p.getRow(ae,Y)||[])).dataGroup=this.groupMap[z+ae],(rt=Q.dataGroup)!=null&&rt.options&&(Q.options=Q.dataGroup.options,Ph(Q,Q.dataGroup.options),delete Q.dataLabels)):(Q=he[te],Ue=u?u[te]:p.getRow(ae,W),Q||Ue===void 0||(he[te]=Q=new x(this,Ue,y[ae]))),Q&&(Q.index=C?z+ae:te,N[ae]=Q,Q.category=(j==null?void 0:j[Q.x])??Q.x,Q.key=Q.name??Q.category);if(this.options.keys=L,he&&(E!==(re=he.length)||C))for(ae=0;ae<re;ae++)ae!==S||C||(ae+=E),he[ae]&&(he[ae].destroyElements(),he[ae].plotX=void 0);this.data=he,this.points=N,Jr(this,"afterGeneratePoints")}getXExtremes(s){return{min:Fl(s),max:ea(s)}}getExtremes(s,u){var Ie;let{xAxis:p,yAxis:y}=this,x=u||this.getExtremesFromAll||this.options.getExtremesFromAll,E=x&&this.cropped?this.dataTable:this.dataTable.modified,S=E.rowCount,C=s||this.stackedYData,L=C?[C]:((Ie=this.keysAffectYAxis||this.pointArrayMap||["y"])==null?void 0:Ie.map(Re=>E.getColumn(Re,!0)||[]))||[],N=this.getColumn("x",!0),z=[],j=this.requireSorting&&!this.is("column")?1:0,W=!!y&&y.positiveValuesOnly,Y=x||this.cropped||!p,re,te,Q,ae=0,he=0;for(p&&(ae=(re=p.getExtremes()).min,he=re.max),Q=0;Q<S;Q++)if(te=N[Q],Y||(N[Q+j]||te)>=ae&&(N[Q-j]||te)<=he)for(let Re of L){let rt=Re[Q];Ms(rt)&&(rt>0||!W)&&z.push(rt)}let Ue={activeYData:z,dataMin:Fl(z),dataMax:ea(z)};return Jr(this,"afterGetExtremes",{dataExtremes:Ue}),Ue}applyExtremes(){let s=this.getExtremes();return this.dataMin=s.dataMin,this.dataMax=s.dataMax,s}getFirstValidPoint(s,u=0,p=1){let y=s.length,x=u;for(;x>=0&&x<y;){if(ns(s[x]))return s[x];x+=p}}translate(){var he;this.generatePoints();let s=this.options,u=s.stacking,p=this.xAxis,y=this.enabledDataSorting,x=this.yAxis,E=this.points,S=E.length,C=this.pointPlacementToXValue(),L=!!C,N=s.threshold,z=s.startFromThreshold?N:0,j=(s==null?void 0:s.nullInteraction)&&x.len,W,Y,re,te,Q=Number.MAX_VALUE;function ae(Ue){return Po(Ue,-1e9,1e9)}for(W=0;W<S;W++){let Ue,Ie=E[W],Re=Ie.x,rt,qe,st=Ie.y,Et=Ie.low,Bt=u&&((he=x.stacking)==null?void 0:he.stacks[(this.negStacks&&st<(z?0:N)?"-":"")+this.stackKey]);Ie.plotX=Ms(Y=p.translate(Re,!1,!1,!1,!0,C))?ta(ae(Y)):void 0,u&&this.visible&&Bt&&Bt[Re]&&(te=this.getStackIndicator(te,Re,this.index),!Ie.isNull&&te.key&&(qe=(rt=Bt[Re]).points[te.key]),rt&&wa(qe)&&(Et=qe[0],st=qe[1],Et===z&&te.key===Bt[Re].base&&(Et=hs(Ms(N)?N:x.min)),x.positiveValuesOnly&&ns(Et)&&Et<=0&&(Et=void 0),Ie.total=Ie.stackTotal=hs(rt.total),Ie.percentage=ns(Ie.y)&&rt.total?Ie.y/rt.total*100:void 0,Ie.stackY=st,this.irregularWidths||rt.setOffset(this.pointXOffset||0,this.barW||0,void 0,void 0,void 0,this.xAxis))),Ie.yBottom=ns(Et)?ae(x.translate(Et,!1,!0,!1,!0)):void 0,this.dataModify&&(st=this.dataModify.modifyValue(st,W)),Ms(st)&&Ie.plotX!==void 0?Ue=Ms(Ue=x.translate(st,!1,!0,!1,!0))?ae(Ue):void 0:!Ms(st)&&j&&(Ue=j),Ie.plotY=Ue,Ie.isInside=this.isPointInside(Ie),Ie.clientX=L?ta(p.translate(Re,!1,!1,!1,!0,C)):Y,Ie.negative=(Ie.y||0)<(N||0),Ie.isNull||Ie.visible===!1||(re!==void 0&&(Q=Math.min(Q,Math.abs(Y-re))),re=Y),Ie.zone=this.zones.length?Ie.getZone():void 0,!Ie.graphic&&this.group&&y&&(Ie.isNew=!0)}this.closestPointRangePx=Q,Jr(this,"afterTranslate")}getValidPoints(s,u,p){let y=this.chart;return(s||this.points||[]).filter(function(x){let{plotX:E,plotY:S}=x;return!!((p||!x.isNull&&Ms(S))&&(!u||y.isInsidePlot(E,S,{inverted:y.inverted})))&&x.visible!==!1})}getSharedClipKey(){return this.sharedClipKey=(this.options.xAxis||0)+","+(this.options.yAxis||0),this.sharedClipKey}setClip(){let{chart:s,group:u,markerGroup:p}=this,y=s.sharedClips,x=s.renderer,E=s.getClipBox(this),S=this.getSharedClipKey(),C=y[S];C?C.animate(E):y[S]=C=x.clipRect(E),u&&u.clip(this.options.clip===!1?void 0:C),p&&p.clip()}animate(s){let{chart:u,group:p,markerGroup:y}=this,x=u.inverted,E=Fr(this.options.animation),S=[this.getSharedClipKey(),E.duration,E.easing,E.defer].join(","),C=u.sharedClips[S],L=u.sharedClips[S+"m"];if(s&&p){let N=u.getClipBox(this);if(C)C.attr("height",N.height);else{N.width=0,x&&(N.x=u.plotHeight),C=u.renderer.clipRect(N),u.sharedClips[S]=C;let z={x:-99,y:-99,width:x?u.plotWidth+199:99,height:x?99:u.plotHeight+199};L=u.renderer.clipRect(z),u.sharedClips[S+"m"]=L}p.clip(C),y==null||y.clip(L)}else if(C&&!C.hasClass("highcharts-animating")){let N=u.getClipBox(this),z=E.step;(y!=null&&y.element.childNodes.length||u.series.length>1)&&(E.step=function(j,W){z&&z.apply(W,arguments),W.prop==="width"&&(L!=null&&L.element)&&L.attr(x?"height":"width",j+99)}),C.addClass("highcharts-animating").animate(N,E)}}afterAnimate(){this.setClip(),Vf(this.chart.sharedClips,(s,u,p)=>{s&&!this.chart.container.querySelector(`[clip-path="url(#${s.id})"]`)&&(s.destroy(),delete p[u])}),this.finishedAnimating=!0,Jr(this,"afterAnimate")}drawPoints(s=this.points){let u,p,y,x,E,S,C,L=this.chart,N=L.styledMode,{colorAxis:z,options:j}=this,W=j.marker,Y=j.nullInteraction,re=this[this.specialGroup||"markerGroup"],te=this.xAxis,Q=hs(W.enabled,!te||!!te.isRadial||null,this.closestPointRangePx>=W.enabledThreshold*W.radius);if(W.enabled!==!1||this._hasPointMarkers)for(u=0;u<s.length;u++){x=(y=(p=s[u]).graphic)?"animate":"attr",E=p.marker||{},S=!!p.marker;let ae=p.isNull;if((Q&&!ns(E.enabled)||E.enabled)&&(!ae||Y)&&p.visible!==!1){let he=hs(E.symbol,this.symbol,"rect");C=this.markerAttribs(p,p.selected&&"select"),this.enabledDataSorting&&(p.startXPos=te.reversed?-(C.width||0):te.width);let Ue=p.isInside!==!1;if(!y&&Ue&&((C.width||0)>0||p.hasImage)&&(p.graphic=y=L.renderer.symbol(he,C.x,C.y,C.width,C.height,S?E:W).add(re),this.enabledDataSorting&&L.hasRendered&&(y.attr({x:p.startXPos}),x="animate")),y&&x==="animate"&&y[Ue?"show":"hide"](Ue).animate(C),y){let Ie=this.pointAttribs(p,N||!p.selected?void 0:"select");N?z&&y.css({fill:Ie.fill}):y[x](Ie)}y&&y.addClass(p.getClassName(),!0)}else y&&(p.graphic=y.destroy())}}markerAttribs(s,u){let p=this.options,y=p.marker,x=s.marker||{},E=x.symbol||y.symbol,S={},C,L,N=hs(x.radius,y==null?void 0:y.radius);u&&(C=y.states[u],L=x.states&&x.states[u],N=hs(L==null?void 0:L.radius,C==null?void 0:C.radius,N&&N+((C==null?void 0:C.radiusPlus)||0))),s.hasImage=E&&E.indexOf("url")===0,s.hasImage&&(N=0);let z=s.pos();return Ms(N)&&z&&(p.crisp&&(z[0]=Ya(z[0],s.hasImage?0:E==="rect"?(y==null?void 0:y.lineWidth)||0:1)),S.x=z[0]-N,S.y=z[1]-N),N&&(S.width=S.height=2*N),S}pointAttribs(s,u){var Q;let p=this.options,y=p.marker,x=s==null?void 0:s.options,E=(x==null?void 0:x.marker)||{},S=x==null?void 0:x.color,C=s==null?void 0:s.color,L=(Q=s==null?void 0:s.zone)==null?void 0:Q.color,N,z,j=this.color,W,Y,re=hs(E.lineWidth,y.lineWidth),te=s!=null&&s.isNull&&p.nullInteraction?0:1;return j=S||L||C||j,W=E.fillColor||y.fillColor||j,Y=E.lineColor||y.lineColor||j,u=u||"normal",N=y.states[u]||{},re=hs((z=E.states&&E.states[u]||{}).lineWidth,N.lineWidth,re+hs(z.lineWidthPlus,N.lineWidthPlus,0)),W=z.fillColor||N.fillColor||W,Y=z.lineColor||N.lineColor||Y,{stroke:Y,"stroke-width":re,fill:W,opacity:te=hs(z.opacity,N.opacity,te)}}destroy(s){var C,L;let u,p,y=this,x=y.chart,E=/AppleWebKit\/533/.test(Nr.navigator.userAgent),S=y.data||[];for(Jr(y,"destroy",{keepEventsForUpdate:s}),this.removeEvents(s),(y.axisTypes||[]).forEach(function(N){p=y[N],p!=null&&p.series&&(Uf(p.series,y),p.isDirty=p.forceRedraw=!0)}),y.legendItem&&y.chart.legend.destroyItem(y),u=S.length;u--;)(L=(C=S[u])==null?void 0:C.destroy)==null||L.call(C);for(let N of y.zones)Rc(N,void 0,!0);me.clearTimeout(y.animationTimeout),Vf(y,function(N,z){N instanceof js&&!N.survive&&N[E&&z==="group"?"hide":"destroy"]()}),x.hoverSeries===y&&(x.hoverSeries=void 0),Uf(x.series,y),x.orderItems("series"),Vf(y,function(N,z){s&&z==="hcEvents"||delete y[z]})}applyZones(){let{area:s,chart:u,graph:p,zones:y,points:x,xAxis:E,yAxis:S,zoneAxis:C}=this,{inverted:L,renderer:N}=u,z=this[`${C}Axis`],{isXAxis:j,len:W=0,minPointOffset:Y=0}=z||{},re=((p==null?void 0:p.strokeWidth())||0)/2+1,te=(Q,ae=0,he=0)=>{L&&(he=W-he);let{translated:Ue=0,lineClip:Ie}=Q,Re=he-Ue;Ie==null||Ie.push(["L",ae,Math.abs(Re)<re?he-re*(Re<=0?-1:1):Ue])};if(y.length&&(p||s)&&z&&Ms(z.min)){let Q=z.getExtremes().max+Y,ae=Ie=>{Ie.forEach((Re,rt)=>{(Re[0]==="M"||Re[0]==="L")&&(Ie[rt]=[Re[0],j?W-Re[1]:Re[1],j?Re[2]:W-Re[2]])})};if(y.forEach(Ie=>{Ie.lineClip=[],Ie.translated=Po(z.toPixels(hs(Ie.value,Q),!0)||0,0,W)}),p&&!this.showLine&&p.hide(),s&&s.hide(),C==="y"&&x.length<E.len)for(let Ie of x){let{plotX:Re,plotY:rt,zone:qe}=Ie,st=qe&&y[y.indexOf(qe)-1];qe&&te(qe,Re,rt),st&&te(st,Re,rt)}let he=[],Ue=z.toPixels(z.getExtremes().min-Y,!0);y.forEach(Ie=>{var Ii,hi;let Re=Ie.lineClip||[],rt=Math.round(Ie.translated||0);E.reversed&&Re.reverse();let{clip:qe,simpleClip:st}=Ie,Et=0,Bt=0,$t=E.len,At=S.len;j?(Et=rt,$t=Ue):(Bt=rt,At=Ue);let Kt=[["M",Et,Bt],["L",$t,Bt],["L",$t,At],["L",Et,At],["Z"]],si=[Kt[0],...Re,Kt[1],Kt[2],...he,Kt[3],Kt[4]];he=Re.reverse(),Ue=rt,L&&(ae(si),s&&ae(Kt)),qe?(qe.animate({d:si}),st==null||st.animate({d:Kt})):(qe=Ie.clip=N.path(si),s&&(st=Ie.simpleClip=N.path(Kt))),p&&((Ii=Ie.graph)==null||Ii.clip(qe)),s&&((hi=Ie.area)==null||hi.clip(st))})}else this.visible&&(p&&p.show(),s&&s.show())}plotGroup(s,u,p,y,x){let E=this[s],S=!E,C={visibility:p,zIndex:y||.1};return ns(this.opacity)&&!this.chart.styledMode&&this.state!=="inactive"&&(C.opacity=this.opacity),E||(this[s]=E=this.chart.renderer.g().add(x)),E.addClass("highcharts-"+u+" highcharts-series-"+this.index+" highcharts-"+this.type+"-series "+(ns(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(E.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0),E.attr(C)[S?"attr":"animate"](this.getPlotBox(u)),E}getPlotBox(s){let u=this.xAxis,p=this.yAxis,y=this.chart,x=y.inverted&&!y.polar&&u&&this.invertible&&s==="series";return y.inverted&&(u=p,p=this.xAxis),{translateX:u?u.left:y.plotLeft,translateY:p?p.top:y.plotTop,rotation:90*!!x,rotationOriginX:x?(u.len-p.len)/2:0,rotationOriginY:x?(u.len+p.len)/2:0,scaleX:x?-1:1,scaleY:1}}removeEvents(s){let{eventsToUnbind:u}=this;s||Py(this),u.length&&(u.forEach(p=>{p()}),u.length=0)}render(){var N,z,j,W,Y;let s=this,{chart:u,options:p,hasRendered:y}=s,x=Fr(p.animation),E=s.visible?"inherit":"hidden",S=p.zIndex,C=u.seriesGroup,L=s.finishedAnimating?0:x.duration;Jr(this,"render"),s.plotGroup("group","series",E,S,C),s.markerGroup=s.plotGroup("markerGroup","markers",E,S,C),p.clip!==!1&&s.setClip(),L&&((N=s.animate)==null||N.call(s,!0)),s.drawGraph&&(s.drawGraph(),s.applyZones()),s.visible&&s.drawPoints(),(z=s.drawDataLabels)==null||z.call(s),(j=s.redrawPoints)==null||j.call(s),p.enableMouseTracking&&((W=s.drawTracker)==null||W.call(s)),L&&((Y=s.animate)==null||Y.call(s)),y||(L&&x.defer&&(L+=x.defer),s.animationTimeout=gp(()=>{s.afterAnimate()},L||0)),s.isDirty=!1,s.hasRendered=!0,Jr(s,"afterRender")}redraw(){let s=this.isDirty||this.isDirtyData;this.translate(),this.render(),s&&delete this.kdTree}reserveSpace(){return this.visible||!this.chart.options.chart.ignoreHiddenSeries}searchPoint(s,u){let{xAxis:p,yAxis:y}=this,x=this.chart.inverted;return this.searchKDTree({clientX:x?p.len-s.chartY+p.pos:s.chartX-p.pos,plotY:x?y.len-s.chartX+y.pos:s.chartY-y.pos},u,s)}buildKDTree(s){this.buildingKdTree=!0;let u=this,p=u.options,y=p.findNearestPointBy.indexOf("y")>-1?2:1;delete u.kdTree,gp(function(){u.kdTree=function x(E,S,C){let L,N,z=E==null?void 0:E.length;if(z)return L=u.kdAxisArray[S%C],E.sort((j,W)=>(j[L]||0)-(W[L]||0)),{point:E[N=Math.floor(z/2)],left:x(E.slice(0,N),S+1,C),right:x(E.slice(N+1),S+1,C)}}(u.getValidPoints(void 0,!u.directTouch,p==null?void 0:p.nullInteraction),y,y),u.buildingKdTree=!1},p.kdNow||(s==null?void 0:s.type)==="touchstart"?0:1)}searchKDTree(s,u,p,y,x){let E=this,[S,C]=this.kdAxisArray,L=u?"distX":"dist",N=(E.options.findNearestPointBy||"").indexOf("y")>-1?2:1,z=!!E.isBubble,j=y||((Y,re,te)=>{let Q=Y[te]||0,ae=re[te]||0;return[Q===ae&&Y.index>re.index||Q<ae?Y:re,!1]}),W=x||((Y,re)=>Y<re);if(this.kdTree||this.buildingKdTree||this.buildKDTree(p),this.kdTree)return function Y(re,te,Q,ae){var Et;let he=te.point,Ue=E.kdAxisArray[Q%ae],Ie=he,Re=!1;(function(Bt,$t){var Zi;let At=Bt[S],Kt=$t[S],si=ns(At)&&ns(Kt)?At-Kt:null,Ii=Bt[C],hi=$t[C],Li=ns(Ii)&&ns(hi)?Ii-hi:0,ar=z&&((Zi=$t.marker)==null?void 0:Zi.radius)||0;$t.dist=Math.sqrt((si&&si*si||0)+Li*Li)-ar,$t.distX=ns(si)?Math.abs(si)-ar:Number.MAX_VALUE})(re,he);let rt=(re[Ue]||0)-(he[Ue]||0)+(z&&((Et=he.marker)==null?void 0:Et.radius)||0),qe=rt<0?"left":"right",st=rt<0?"right":"left";return te[qe]&&([Ie,Re]=j(he,Y(re,te[qe],Q+1,ae),L)),te[st]&&W(Math.sqrt(rt*rt),Ie[L],Re)&&(Ie=j(Ie,Y(re,te[st],Q+1,ae),L)[0]),Ie}(s,this.kdTree,N,N)}pointPlacementToXValue(){let{options:s,xAxis:u}=this,p=s.pointPlacement;return p==="between"&&(p=u.reversed?-.5:.5),Ms(p)?p*(s.pointRange||u.pointRange):0}isPointInside(s){let{chart:u,xAxis:p,yAxis:y}=this,{plotX:x=-1,plotY:E=-1}=s;return E>=0&&E<=(y?y.len:u.plotHeight)&&x>=0&&x<=(p?p.len:u.plotWidth)}drawTracker(){var j;let s=this,u=s.options,p=u.trackByArea,y=[].concat((p?s.areaPath:s.graphPath)||[]),x=s.chart,E=x.pointer,S=x.renderer,C=((j=x.options.tooltip)==null?void 0:j.snap)||0,L=()=>{u.enableMouseTracking&&x.hoverSeries!==s&&s.onMouseOver()},N="rgba(192,192,192,"+(dn?1e-4:.002)+")",z=s.tracker;z?z.attr({d:y}):s.graph&&(s.tracker=z=S.path(y).attr({visibility:s.visible?"inherit":"hidden",zIndex:2}).addClass(p?"highcharts-tracker-area":"highcharts-tracker-line").add(s.group),x.styledMode||z.attr({"stroke-linecap":"round","stroke-linejoin":"round",stroke:N,fill:p?N:"none","stroke-width":s.graph.strokeWidth()+(p?0:2*C)}),[s.tracker,s.markerGroup,s.dataLabelsGroup].forEach(W=>{W&&(W.addClass("highcharts-tracker").on("mouseover",L).on("mouseout",Y=>{E==null||E.onTrackerMouseOut(Y)}),u.cursor&&!x.styledMode&&W.css({cursor:u.cursor}),W.on("touchstart",L))})),Jr(this,"afterDrawTracker")}addPoint(s,u,p,y,x){let E,S,C=this.options,{chart:L,data:N,dataTable:z,xAxis:j}=this,W=(j==null?void 0:j.hasNames)&&j.names,Y=C.data,re=this.getColumn("x");u=hs(u,!0);let te={series:this};this.pointClass.prototype.applyOptions.apply(te,[s]);let Q=te.x;if(S=re.length,this.requireSorting&&Q<re[S-1])for(E=!0;S&&re[S-1]>Q;)S--;z.setRow(te,S,!0,{addColumns:!1}),W&&te.name&&(W[Q]=te.name),Y==null||Y.splice(S,0,s),(E||this.processedData)&&(this.data.splice(S,0,null),this.processData()),C.legendType==="point"&&this.generatePoints(),p&&(N[0]&&N[0].remove?N[0].remove(!1):([N,Y].filter(ns).forEach(ae=>{ae.shift()}),z.deleteRows(0))),x!==!1&&Jr(this,"addPoint",{point:te}),this.isDirty=!0,this.isDirtyData=!0,u&&L.redraw(y)}removePoint(s,u,p){let y=this,{chart:x,data:E,points:S,dataTable:C}=y,L=E[s],N=function(){[(S==null?void 0:S.length)===E.length?S:void 0,E,y.options.data].filter(ns).forEach(z=>{z.splice(s,1)}),C.deleteRows(s),L==null||L.destroy(),y.isDirty=!0,y.isDirtyData=!0,u&&x.redraw()};Lr(p,x),u=hs(u,!0),L?L.firePointEvent("remove",null,N):N()}remove(s,u,p,y){let x=this,E=x.chart;function S(){x.destroy(y),E.isDirtyLegend=E.isDirtyBox=!0,E.linkSeries(y),hs(s,!0)&&E.redraw(u)}p!==!1?Jr(x,"remove",null,S):S()}update(s,u){var Q,ae;Jr(this,"update",{options:s=Yu(s,this.userOptions)});let p=this,y=p.chart,x=p.userOptions,E=p.initialType||p.type,S=y.options.plotOptions,C=ks[E].prototype,L=p.finishedAnimating&&{animation:!1},N={},z,j,W=Cn.keepProps.slice(),Y=s.type||x.type||y.options.chart.type,re=!(this.hasDerivedData||Y&&Y!==this.type||s.keys!==void 0||s.pointStart!==void 0||s.pointInterval!==void 0||s.relativeXValue!==void 0||s.joinBy||s.mapData||["dataGrouping","pointStart","pointInterval","pointIntervalUnit","keys"].some(he=>p.hasOptionChanged(he)));Y=Y||E,re?(W.push.apply(W,Cn.keepPropsForPoints),s.visible!==!1&&W.push("area","graph"),p.parallelArrays.forEach(function(he){W.push(he+"Data")}),s.data&&(s.dataSorting&&Ph(p.options.dataSorting,s.dataSorting),this.setData(s.data,!1))):this.dataTable.modified=this.dataTable,s=Ih(x,{index:x.index===void 0?p.index:x.index,pointStart:((Q=S==null?void 0:S.series)==null?void 0:Q.pointStart)??x.pointStart??p.getColumn("x")[0]},!re&&{data:p.options.data},s,L),re&&s.data&&(s.data=p.options.data),(W=["group","markerGroup","dataLabelsGroup","transformGroup"].concat(W)).forEach(function(he){W[he]=p[he],delete p[he]});let te=!1;if(ks[Y]){if(te=Y!==p.type,p.remove(!1,!1,!1,!0),te)if(y.propFromSeries(),Object.setPrototypeOf)Object.setPrototypeOf(p,ks[Y].prototype);else{let he=Object.hasOwnProperty.call(p,"hcEvents")&&p.hcEvents;for(j in C)p[j]=void 0;Ph(p,ks[Y].prototype),he?p.hcEvents=he:delete p.hcEvents}}else Ku(17,!0,y,{missingModuleFor:Y});if(W.forEach(function(he){p[he]=W[he]}),p.init(y,s),re&&this.points)for(let he of((z=p.options).visible===!1?(N.graphic=1,N.dataLabel=1):(this.hasMarkerChanged(z,x)&&(N.graphic=1),(ae=p.hasDataLabels)!=null&&ae.call(p)||(N.dataLabel=1)),this.points))he!=null&&he.series&&(he.resolveColor(),Object.keys(N).length&&he.destroyElements(N),z.showInLegend===!1&&he.legendItem&&y.legend.destroyItem(he));p.initialType=E,y.linkSeries(),y.setSortedData(),te&&p.linkedSeries.length&&(p.isDirtyData=!0),Jr(this,"afterUpdate"),hs(u,!0)&&y.redraw(!!re&&void 0)}setName(s){this.name=this.options.name=this.userOptions.name=s,this.chart.isDirtyLegend=!0}hasOptionChanged(s){var S,C;let u=this.chart,p=this.options[s],y=u.options.plotOptions,x=this.userOptions[s],E=hs((S=y==null?void 0:y[this.type])==null?void 0:S[s],(C=y==null?void 0:y.series)==null?void 0:C[s]);return x&&!ns(E)?p!==x:p!==hs(E,p)}onMouseOver(){let s=this.chart,u=s.hoverSeries,p=s.pointer;p==null||p.setHoverChartIndex(),u&&u!==this&&u.onMouseOut(),this.options.events.mouseOver&&Jr(this,"mouseOver"),this.setState("hover"),s.hoverSeries=this}onMouseOut(){let s=this.options,u=this.chart,p=u.tooltip,y=u.hoverPoint;u.hoverSeries=null,y&&y.onMouseOut(),this&&s.events.mouseOut&&Jr(this,"mouseOut"),p&&!this.stickyTracking&&(!p.shared||this.noSharedTooltip)&&p.hide(),u.series.forEach(function(x){x.setState("",!0)})}setState(s,u){let p=this,y=p.options,x=p.graph,E=y.inactiveOtherPoints,S=y.states,C=hs(S[s||"normal"]&&S[s||"normal"].animation,p.chart.options.chart.animation),L=y.lineWidth,N=y.opacity;if(s=s||"",p.state!==s&&([p.group,p.markerGroup,p.dataLabelsGroup].forEach(function(z){z&&(p.state&&z.removeClass("highcharts-series-"+p.state),s&&z.addClass("highcharts-series-"+s))}),p.state=s,!p.chart.styledMode)){if(S[s]&&S[s].enabled===!1)return;if(s&&(L=S[s].lineWidth||L+(S[s].lineWidthPlus||0),N=hs(S[s].opacity,N)),x&&!x.dashstyle&&Ms(L))for(let z of[x,...this.zones.map(j=>j.graph)])z==null||z.animate({"stroke-width":L},C);E||[p.group,p.markerGroup,p.dataLabelsGroup,p.labelBySeries].forEach(function(z){z&&z.animate({opacity:N},C)})}u&&E&&p.points&&p.setAllPointsToState(s||void 0)}setAllPointsToState(s){this.points.forEach(function(u){u.setState&&u.setState(s)})}setVisible(s,u){var C;let p=this,y=p.chart,x=y.options.chart.ignoreHiddenSeries,E=p.visible;p.visible=s=p.options.visible=p.userOptions.visible=s===void 0?!E:s;let S=s?"show":"hide";["group","dataLabelsGroup","markerGroup","tracker","tt"].forEach(L=>{var N;(N=p[L])==null||N[S]()}),(y.hoverSeries===p||((C=y.hoverPoint)==null?void 0:C.series)===p)&&p.onMouseOut(),p.legendItem&&y.legend.colorizeItem(p,s),p.isDirty=!0,p.options.stacking&&y.series.forEach(L=>{L.options.stacking&&L.visible&&(L.isDirty=!0)}),p.linkedSeries.forEach(L=>{L.setVisible(s,!1)}),x&&(y.isDirtyBox=!0),Jr(p,S),u!==!1&&y.redraw()}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}select(s){this.selected=s=this.options.selected=s===void 0?!this.selected:s,this.checkbox&&(this.checkbox.checked=s),Jr(this,s?"select":"unselect")}shouldShowTooltip(s,u,p={}){return p.series=this,p.visiblePlotOnly=!0,this.chart.isInsidePlot(s,u,p)}drawLegendSymbol(s,u){var p;(p=Sr[this.options.legendSymbol||"rectangle"])==null||p.call(this,s,u)}}Cn.defaultOptions={lineWidth:2,allowPointSelect:!1,crisp:!0,showCheckbox:!1,animation:{duration:1e3},enableMouseTracking:!0,events:{},marker:{enabledThreshold:2,lineColor:"#ffffff",lineWidth:0,radius:4,states:{normal:{animation:!0},hover:{animation:{duration:150},enabled:!0,radiusPlus:2,lineWidthPlus:1},select:{fillColor:"#cccccc",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{animation:{},align:"center",borderWidth:0,defer:!0,formatter:function(){let{numberFormatter:R}=this.series.chart;return typeof this.y!="number"?"":R(this.y,-1)},padding:5,style:{fontSize:"0.7em",fontWeight:"bold",color:"contrast",textOutline:"1px contrast"},verticalAlign:"bottom",x:0,y:0},cropThreshold:300,opacity:1,pointRange:0,softThreshold:!0,states:{normal:{animation:!0},hover:{animation:{duration:150},lineWidthPlus:1,marker:{},halo:{size:10,opacity:.25}},select:{animation:{duration:0}},inactive:{animation:{duration:150},opacity:.2}},stickyTracking:!0,turboThreshold:1e3,findNearestPointBy:"x"},Cn.types=wr.seriesTypes,Cn.registerType=wr.registerSeriesType,Cn.keepProps=["colorIndex","eventOptions","navigatorSeries","symbolIndex","baseSeries"],Cn.keepPropsForPoints=["data","isDirtyData","isDirtyCanvas","points","dataTable","processedData","xIncrement","cropped","_hasPointMarkers","hasDataLabels","nodes","layout","level","mapMap","mapData","minY","maxY","minX","maxX","transformGroups"],Ph(Cn.prototype,{axisTypes:["xAxis","yAxis"],coll:"series",colorCounter:0,directTouch:!1,invertible:!0,isCartesian:!0,kdAxisArray:["clientX","plotY"],parallelArrays:["x","y"],pointClass:J,requireSorting:!0,sorted:!0}),wr.series=Cn;let tn=Cn,{animObject:Ka,setAnimation:ia}=ls,{registerEventOptions:Ja}=Tc,{composed:Nl,marginNames:Ul}=Ne,{distribute:Iy}=pa,{format:Ly}=Ys,{addEvent:_p,createElement:Dy,css:fg,defined:yp,discardElement:ra,find:Ry,fireEvent:Qa,isNumber:us,merge:pi,pick:qs,pushUnique:xp,relativeLength:Un,stableSort:mg,syncTimeout:gg}=me;class oo{constructor(s,u){this.allItems=[],this.initialItemY=0,this.itemHeight=0,this.itemMarginBottom=0,this.itemMarginTop=0,this.itemX=0,this.itemY=0,this.lastItemY=0,this.lastLineHeight=0,this.legendHeight=0,this.legendWidth=0,this.maxItemWidth=0,this.maxLegendWidth=0,this.offsetWidth=0,this.padding=0,this.pages=[],this.symbolHeight=0,this.symbolWidth=0,this.titleHeight=0,this.totalItemWidth=0,this.widthOption=0,this.chart=s,this.setOptions(u),u.enabled&&(this.render(),Ja(this,u),_p(this.chart,"endResize",function(){this.legend.positionCheckboxes()})),_p(this.chart,"render",()=>{this.options.enabled&&this.proximate&&(this.proximatePositions(),this.positionItems())})}setOptions(s){let u=qs(s.padding,8);this.options=s,this.chart.styledMode||(this.itemStyle=s.itemStyle,this.itemHiddenStyle=pi(this.itemStyle,s.itemHiddenStyle)),this.itemMarginTop=s.itemMarginTop,this.itemMarginBottom=s.itemMarginBottom,this.padding=u,this.initialItemY=u-5,this.symbolWidth=qs(s.symbolWidth,16),this.pages=[],this.proximate=s.layout==="proximate"&&!this.chart.inverted,this.baseline=void 0}update(s,u){let p=this.chart;this.setOptions(pi(!0,this.options,s)),"events"in this.options&&Ja(this,this.options),this.destroy(),p.isDirtyLegend=p.isDirtyBox=!0,qs(u,!0)&&p.redraw(),Qa(this,"afterUpdate",{redraw:u})}colorizeItem(s,u){var L;let p=s.color,{area:y,group:x,label:E,line:S,symbol:C}=s.legendItem||{};if((s instanceof tn||s instanceof J)&&(s.color=((L=s.options)==null?void 0:L.legendSymbolColor)||p),x==null||x[u?"removeClass":"addClass"]("highcharts-legend-item-hidden"),!this.chart.styledMode){let{itemHiddenStyle:N={}}=this,z=N.color,{fillColor:j,fillOpacity:W,lineColor:Y,marker:re}=s.options,te=Q=>(!u&&(Q.fill&&(Q.fill=z),Q.stroke&&(Q.stroke=z)),Q);E==null||E.css(pi(u?this.itemStyle:N)),S==null||S.attr(te({stroke:Y||s.color})),C&&C.attr(te(re&&C.isMarker?s.pointAttribs():{fill:s.color})),y==null||y.attr(te({fill:j||s.color,"fill-opacity":j?1:W??.75}))}s.color=p,Qa(this,"afterColorizeItem",{item:s,visible:u})}positionItems(){this.allItems.forEach(this.positionItem,this),this.chart.isResizing||this.positionCheckboxes()}positionItem(s){let{group:u,x:p=0,y=0}=s.legendItem||{},x=this.options,E=x.symbolPadding,S=!x.rtl,C=s.checkbox;if(u!=null&&u.element){let L={translateX:S?p:this.legendWidth-p-2*E-4,translateY:y};u[yp(u.translateY)?"animate":"attr"](L,void 0,()=>{Qa(this,"afterPositionItem",{item:s})})}C&&(C.x=p,C.y=y)}destroyItem(s){let u=s.checkbox,p=s.legendItem||{};for(let y of["group","label","line","symbol"])p[y]&&(p[y]=p[y].destroy());u&&ra(u),s.legendItem=void 0}destroy(){for(let s of this.getAllItems())this.destroyItem(s);for(let s of["clipRect","up","down","pager","nav","box","title","group"])this[s]&&(this[s]=this[s].destroy());this.display=null}positionCheckboxes(){var x;let s,u=(x=this.group)==null?void 0:x.alignAttr,p=this.clipHeight||this.legendHeight,y=this.titleHeight;u&&(s=u.translateY,this.allItems.forEach(function(E){let S,C=E.checkbox;C&&(S=s+y+C.y+(this.scrollOffset||0)+3,fg(C,{left:u.translateX+E.checkboxOffset+C.x-20+"px",top:S+"px",display:this.proximate||S>s-6&&S<s+p-6?"":"none"}))},this))}renderTitle(){let s=this.options,u=this.padding,p=s.title,y,x=0;p.text&&(this.title||(this.title=this.chart.renderer.label(p.text,u-3,u-4,void 0,void 0,void 0,s.useHTML,void 0,"legend-title").attr({zIndex:1}),this.chart.styledMode||this.title.css(p.style),this.title.add(this.group)),p.width||this.title.css({width:this.maxLegendWidth+"px"}),x=(y=this.title.getBBox()).height,this.offsetWidth=y.width,this.contentGroup.attr({translateY:x})),this.titleHeight=x}setText(s){let u=this.options;s.legendItem.label.attr({text:u.labelFormat?Ly(u.labelFormat,s,this.chart):u.labelFormatter.call(s)})}renderItem(s){var rt;let u=s.legendItem=s.legendItem||{},p=this.chart,y=p.renderer,x=this.options,E=x.layout==="horizontal",S=this.symbolWidth,C=x.symbolPadding||0,L=this.itemStyle,N=this.itemHiddenStyle,z=E?qs(x.itemDistance,20):0,j=!x.rtl,W=!s.series,Y=!W&&s.series.drawLegendSymbol?s.series:s,re=Y.options,te=!!this.createCheckboxForItem&&re&&re.showCheckbox,Q=x.useHTML,ae=s.options.className,he=u.label,Ue=S+C+z+20*!!te;!he&&(u.group=y.g("legend-item").addClass("highcharts-"+Y.type+"-series highcharts-color-"+s.colorIndex+(ae?" "+ae:"")+(W?" highcharts-series-"+s.index:"")).attr({zIndex:1}).add(this.scrollGroup),u.label=he=y.text("",j?S+C:-C,this.baseline||0,Q),p.styledMode||he.css(pi(s.visible?L:N)),he.attr({align:j?"left":"right",zIndex:2}).add(u.group),!this.baseline&&(this.fontMetrics=y.fontMetrics(he),this.baseline=this.fontMetrics.f+3+this.itemMarginTop,he.attr("y",this.baseline),this.symbolHeight=qs(x.symbolHeight,this.fontMetrics.f),x.squareSymbol&&(this.symbolWidth=qs(x.symbolWidth,Math.max(this.symbolHeight,16)),Ue=this.symbolWidth+C+z+20*!!te,j&&he.attr("x",this.symbolWidth+C))),Y.drawLegendSymbol(this,s),this.setItemEvents&&this.setItemEvents(s,he,Q)),te&&!s.checkbox&&this.createCheckboxForItem&&this.createCheckboxForItem(s),this.colorizeItem(s,s.visible),(p.styledMode||!L.width)&&he.css({width:(x.itemWidth||this.widthOption||p.spacingBox.width)-Ue+"px"}),this.setText(s);let Ie=he.getBBox(),Re=((rt=this.fontMetrics)==null?void 0:rt.h)||0;s.itemWidth=s.checkboxOffset=x.itemWidth||u.labelWidth||Ie.width+Ue,this.maxItemWidth=Math.max(this.maxItemWidth,s.itemWidth),this.totalItemWidth+=s.itemWidth,this.itemHeight=s.itemHeight=Math.round(u.labelHeight||(Ie.height>1.5*Re?Ie.height:Re))}layoutItem(s){let u=this.options,p=this.padding,y=u.layout==="horizontal",x=s.itemHeight,E=this.itemMarginBottom,S=this.itemMarginTop,C=y?qs(u.itemDistance,20):0,L=this.maxLegendWidth,N=u.alignColumns&&this.totalItemWidth>L?this.maxItemWidth:s.itemWidth,z=s.legendItem||{};y&&this.itemX-p+N>L&&(this.itemX=p,this.lastLineHeight&&(this.itemY+=S+this.lastLineHeight+E),this.lastLineHeight=0),this.lastItemY=S+this.itemY+E,this.lastLineHeight=Math.max(x,this.lastLineHeight),z.x=this.itemX,z.y=this.itemY,y?this.itemX+=N:(this.itemY+=S+x+E,this.lastLineHeight=x),this.offsetWidth=this.widthOption||Math.max((y?this.itemX-p-(s.checkbox?0:C):N)+p,this.offsetWidth)}getAllItems(){let s=[];return this.chart.series.forEach(function(u){var y;let p=u==null?void 0:u.options;u&&qs(p.showInLegend,!yp(p.linkedTo)&&void 0,!0)&&(s=s.concat(((y=u.legendItem)==null?void 0:y.labels)||(p.legendType==="point"?u.data:u)))}),Qa(this,"afterGetAllItems",{allItems:s}),s}getAlignment(){let s=this.options;return this.proximate?s.align.charAt(0)+"tv":s.floating?"":s.align.charAt(0)+s.verticalAlign.charAt(0)+s.layout.charAt(0)}adjustMargins(s,u){let p=this.chart,y=this.options,x=this.getAlignment();x&&[/(lth|ct|rth)/,/(rtv|rm|rbv)/,/(rbh|cb|lbh)/,/(lbv|lm|ltv)/].forEach(function(E,S){E.test(x)&&!yp(s[S])&&(p[Ul[S]]=Math.max(p[Ul[S]],p.legend[(S+1)%2?"legendHeight":"legendWidth"]+[1,-1,-1,1][S]*y[S%2?"x":"y"]+qs(y.margin,12)+u[S]+(p.titleOffset[S]||0)))})}proximatePositions(){let s,u=this.chart,p=[],y=this.options.align==="left";for(let x of(this.allItems.forEach(function(E){let S,C,L=y,N,z;E.yAxis&&(E.xAxis.options.reversed&&(L=!L),E.points&&(S=Ry(L?E.points:E.points.slice(0).reverse(),function(j){return us(j.plotY)})),C=this.itemMarginTop+E.legendItem.label.getBBox().height+this.itemMarginBottom,z=E.yAxis.top-u.plotTop,N=E.visible?(S?S.plotY:E.yAxis.height)+(z-.3*C):z+E.yAxis.height,p.push({target:N,size:C,item:E}))},this),Iy(p,u.plotHeight)))s=x.item.legendItem||{},us(x.pos)&&(s.y=u.plotTop-u.spacing[0]+x.pos)}render(){let s=this.chart,u=s.renderer,p=this.options,y=this.padding,x=this.getAllItems(),E,S,C,L=this.group,N,z=this.box;this.itemX=y,this.itemY=this.initialItemY,this.offsetWidth=0,this.lastItemY=0,this.widthOption=Un(p.width,s.spacingBox.width-y),N=s.spacingBox.width-2*y-p.x,["rm","lm"].indexOf(this.getAlignment().substring(0,2))>-1&&(N/=2),this.maxLegendWidth=this.widthOption||N,L||(this.group=L=u.g("legend").addClass(p.className||"").attr({zIndex:7}).add(),this.contentGroup=u.g().attr({zIndex:1}).add(L),this.scrollGroup=u.g().add(this.contentGroup)),this.renderTitle(),mg(x,(j,W)=>{var Y,re;return(((Y=j.options)==null?void 0:Y.legendIndex)||0)-(((re=W.options)==null?void 0:re.legendIndex)||0)}),p.reversed&&x.reverse(),this.allItems=x,this.display=E=!!x.length,this.lastLineHeight=0,this.maxItemWidth=0,this.totalItemWidth=0,this.itemHeight=0,x.forEach(this.renderItem,this),x.forEach(this.layoutItem,this),S=(this.widthOption||this.offsetWidth)+y,C=this.lastItemY+this.lastLineHeight+this.titleHeight,C=this.handleOverflow(C)+y,z||(this.box=z=u.rect().addClass("highcharts-legend-box").attr({r:p.borderRadius}).add(L)),s.styledMode||z.attr({stroke:p.borderColor,"stroke-width":p.borderWidth||0,fill:p.backgroundColor||"none"}).shadow(p.shadow),S>0&&C>0&&z[z.placed?"animate":"attr"](z.crisp.call({},{x:0,y:0,width:S,height:C},z.strokeWidth())),L[E?"show":"hide"](),s.styledMode&&L.getStyle("display")==="none"&&(S=C=0),this.legendWidth=S,this.legendHeight=C,E&&this.align(),this.proximate||this.positionItems(),Qa(this,"afterRender")}align(s=this.chart.spacingBox){let u=this.chart,p=this.options,y=s.y;/(lth|ct|rth)/.test(this.getAlignment())&&u.titleOffset[0]>0?y+=u.titleOffset[0]:/(lbh|cb|rbh)/.test(this.getAlignment())&&u.titleOffset[2]>0&&(y-=u.titleOffset[2]),y!==s.y&&(s=pi(s,{y})),u.hasRendered||(this.group.placed=!1),this.group.align(pi(p,{width:this.legendWidth,height:this.legendHeight,verticalAlign:this.proximate?"top":p.verticalAlign}),!0,s)}handleOverflow(s){let u=this,p=this.chart,y=p.renderer,x=this.options,E=x.y,S=x.verticalAlign==="top",C=this.padding,L=x.maxHeight,N=x.navigation,z=qs(N.animation,!0),j=N.arrowSize||12,W=this.pages,Y=this.allItems,re=function(qe){typeof qe=="number"?rt.attr({height:qe}):rt&&(u.clipRect=rt.destroy(),u.contentGroup.clip()),u.contentGroup.div&&(u.contentGroup.div.style.clip=qe?"rect("+C+"px,9999px,"+(C+qe)+"px,0)":"auto")},te=function(qe){return u[qe]=y.circle(0,0,1.3*j).translate(j/2,j/2).add(Re),p.styledMode||u[qe].attr("fill","rgba(0,0,0,0.0001)"),u[qe]},Q,ae,he,Ue,Ie=p.spacingBox.height+(S?-E:E)-C,Re=this.nav,rt=this.clipRect;return x.layout!=="horizontal"||x.verticalAlign==="middle"||x.floating||(Ie/=2),L&&(Ie=Math.min(Ie,L)),W.length=0,s&&Ie>0&&s>Ie&&N.enabled!==!1?(this.clipHeight=Q=Math.max(Ie-20-this.titleHeight-C,0),this.currentPage=qs(this.currentPage,1),this.fullHeight=s,Y.forEach((qe,st)=>{let Et=(he=qe.legendItem||{}).y||0,Bt=Math.round(he.label.getBBox().height),$t=W.length;(!$t||Et-W[$t-1]>Q&&(ae||Et)!==W[$t-1])&&(W.push(ae||Et),$t++),he.pageIx=$t-1,ae&&Ue&&(Ue.pageIx=$t-1),st===Y.length-1&&Et+Bt-W[$t-1]>Q&&Et>W[$t-1]&&(W.push(Et),he.pageIx=$t),Et!==ae&&(ae=Et),Ue=he}),rt||(rt=u.clipRect=y.clipRect(0,C-2,9999,0),u.contentGroup.clip(rt)),re(Q),Re||(this.nav=Re=y.g().attr({zIndex:1}).add(this.group),this.up=y.symbol("triangle",0,0,j,j).add(Re),te("upTracker").on("click",function(){u.scroll(-1,z)}),this.pager=y.text("",15,10).addClass("highcharts-legend-navigation"),!p.styledMode&&N.style&&this.pager.css(N.style),this.pager.add(Re),this.down=y.symbol("triangle-down",0,0,j,j).add(Re),te("downTracker").on("click",function(){u.scroll(1,z)})),u.scroll(0),s=Ie):Re&&(re(),this.nav=Re.destroy(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0),s}scroll(s,u){let p=this.chart,y=this.pages,x=y.length,E=this.clipHeight,S=this.options.navigation,C=this.pager,L=this.padding,N=this.currentPage+s;N>x&&(N=x),N>0&&(u!==void 0&&ia(u,p),this.nav.attr({translateX:L,translateY:E+this.padding+7+this.titleHeight,visibility:"inherit"}),[this.up,this.upTracker].forEach(function(z){z.attr({class:N===1?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})}),C.attr({text:N+"/"+x}),[this.down,this.downTracker].forEach(function(z){z.attr({x:18+this.pager.getBBox().width,class:N===x?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})},this),p.styledMode||(this.up.attr({fill:N===1?S.inactiveColor:S.activeColor}),this.upTracker.css({cursor:N===1?"default":"pointer"}),this.down.attr({fill:N===x?S.inactiveColor:S.activeColor}),this.downTracker.css({cursor:N===x?"default":"pointer"})),this.scrollOffset=-y[N-1]+this.initialItemY,this.scrollGroup.animate({translateY:this.scrollOffset}),this.currentPage=N,this.positionCheckboxes(),gg(()=>{Qa(this,"afterScroll",{currentPage:N})},Ka(qs(u,p.renderer.globalAnimation,!0)).duration))}setItemEvents(s,u,p){let y=this,x=s.legendItem||{},E=y.chart.renderer.boxWrapper,S=s instanceof J,C=s instanceof tn,L="highcharts-legend-"+(S?"point":"series")+"-active",N=y.chart.styledMode,z=p?[u,x.symbol]:[x.group],j=W=>{y.allItems.forEach(Y=>{s!==Y&&[Y].concat(Y.linkedSeries||[]).forEach(re=>{re.setState(W,!S)})})};for(let W of z)W&&W.on("mouseover",function(){s.visible&&j("inactive"),s.setState("hover"),s.visible&&E.addClass(L),N||u.css(y.options.itemHoverStyle)}).on("mouseout",function(){y.chart.styledMode||u.css(pi(s.visible?y.itemStyle:y.itemHiddenStyle)),j(""),E.removeClass(L),s.setState()}).on("click",function(Y){let re=function(){s.setVisible&&s.setVisible(),j(s.visible?"inactive":"")};E.removeClass(L),Qa(y,"itemClick",{browserEvent:Y,legendItem:s},re),S?s.firePointEvent("legendItemClick",{browserEvent:Y}):C&&Qa(s,"legendItemClick",{browserEvent:Y})})}createCheckboxForItem(s){s.checkbox=Dy("input",{type:"checkbox",className:"highcharts-legend-checkbox",checked:s.selected,defaultChecked:s.selected},this.options.itemCheckboxStyle,this.chart.container),_p(s.checkbox,"click",function(u){let p=u.target;Qa(s.series||s,"checkboxClick",{checked:p.checked,item:s},function(){s.select()})})}}(function(R){R.compose=function(s){xp(Nl,"Core.Legend")&&_p(s,"beforeMargins",function(){this.legend=new R(this,this.options.legend)})}})(oo||(oo={}));let vp=oo,{animate:el,animObject:Qu,setAnimation:tl}=ls,{defaultOptions:ed}=Ee,{numberFormat:bp}=Ys,{registerEventOptions:Gf}=Tc,{charts:jl,doc:td,marginNames:wp,svg:_g,win:Lh}=Ne,{seriesTypes:Vl}=wr,{addEvent:sa,attr:Tp,createElement:Ep,css:kn,defined:Io,diffObjects:jn,discardElement:id,erase:Tn,error:Vn,extend:Ta,find:Qr,fireEvent:gr,getAlignFactor:rd,getStyle:ao,isArray:zy,isNumber:Dh,isObject:yg,isString:sd,merge:En,objectEach:Sp,pick:rn,pInt:xg,relativeLength:$f,removeEvent:vg,splat:Ap,syncTimeout:bg,uniqueKey:wg}=me;class Lo{static chart(s,u,p){return new Lo(s,u,p)}constructor(s,u,p){this.sharedClips={};let y=[...arguments];(sd(s)||s.nodeName)&&(this.renderTo=y.shift()),this.init(y[0],y[1])}setZoomOptions(){let s=this.options.chart,u=s.zooming;this.zooming={...u,type:rn(s.zoomType,u.type),key:rn(s.zoomKey,u.key),pinchType:rn(s.pinchType,u.pinchType),singleTouch:rn(s.zoomBySingleTouch,u.singleTouch,!1),resetButton:En(u.resetButton,s.resetZoomButton)}}init(s,u){gr(this,"init",{args:arguments},function(){var E;let p=En(ed,s),y=p.chart,x=this.renderTo||y.renderTo;this.userOptions=Ta({},s),(this.renderTo=sd(x)?td.getElementById(x):x)||Vn(13,!0,this),this.margin=[],this.spacing=[],this.labelCollectors=[],this.callback=u,this.isResizing=0,this.options=p,this.axes=[],this.series=[],this.locale=p.lang.locale??((E=this.renderTo.closest("[lang]"))==null?void 0:E.lang),this.time=new hn(Ta(p.time||{},{locale:this.locale}),p.lang),p.time=this.time.options,this.numberFormatter=(y.numberFormatter||bp).bind(this),this.styledMode=y.styledMode,this.hasCartesianSeries=y.showAxes,this.index=jl.length,jl.push(this),Ne.chartCount++,Gf(this,y),this.xAxis=[],this.yAxis=[],this.pointCount=this.colorCounter=this.symbolCounter=0,this.setZoomOptions(),gr(this,"afterInit"),this.firstRender()})}initSeries(s){let u=this.options.chart,p=s.type||u.type,y=Vl[p];y||Vn(17,!0,this,{missingModuleFor:p});let x=new y;return typeof x.init=="function"&&x.init(this,s),x}setSortedData(){this.getSeriesOrderByLinks().forEach(function(s){s.points||s.data||!s.enabledDataSorting||s.setData(s.options.data,!1)})}getSeriesOrderByLinks(){return this.series.concat().sort(function(s,u){return s.linkedSeries.length||u.linkedSeries.length?u.linkedSeries.length-s.linkedSeries.length:0})}orderItems(s,u=0){let p=this[s],y=this.options[s]=Ap(this.options[s]).slice(),x=this.userOptions[s]=this.userOptions[s]?Ap(this.userOptions[s]).slice():[];if(this.hasRendered&&(y.splice(u),x.splice(u)),p)for(let E=u,S=p.length;E<S;++E){let C=p[E];C&&(C.index=E,C instanceof tn&&(C.name=C.getName()),C.options.isInternal||(y[E]=C.options,x[E]=C.userOptions))}}getClipBox(s,u){var N,z;let p=this.inverted,{xAxis:y,yAxis:x}=s||{},{x:E,y:S,width:C,height:L}=En(this.clipBox);return s&&(y&&y.len!==this.plotSizeX&&(C=y.len),x&&x.len!==this.plotSizeY&&(L=x.len),p&&!s.invertible&&([C,L]=[L,C])),u&&(E+=((N=p?x:y)==null?void 0:N.pos)??this.plotLeft,S+=((z=p?y:x)==null?void 0:z.pos)??this.plotTop),{x:E,y:S,width:C,height:L}}isInsidePlot(s,u,p={}){var te;let{inverted:y,plotBox:x,plotLeft:E,plotTop:S,scrollablePlotBox:C}=this,{scrollLeft:L=0,scrollTop:N=0}=p.visiblePlotOnly&&((te=this.scrollablePlotArea)==null?void 0:te.scrollingContainer)||{},z=p.series,j=p.visiblePlotOnly&&C||x,W=p.inverted?u:s,Y=p.inverted?s:u,re={x:W,y:Y,isInsidePlot:!0,options:p};if(!p.ignoreX){let Q=z&&(y&&!this.polar?z.yAxis:z.xAxis)||{pos:E,len:1/0},ae=p.paneCoordinates?Q.pos+W:E+W;ae>=Math.max(L+E,Q.pos)&&ae<=Math.min(L+E+j.width,Q.pos+Q.len)||(re.isInsidePlot=!1)}if(!p.ignoreY&&re.isInsidePlot){let Q=!y&&p.axis&&!p.axis.isXAxis&&p.axis||z&&(y?z.xAxis:z.yAxis)||{pos:S,len:1/0},ae=p.paneCoordinates?Q.pos+Y:S+Y;ae>=Math.max(N+S,Q.pos)&&ae<=Math.min(N+S+j.height,Q.pos+Q.len)||(re.isInsidePlot=!1)}return gr(this,"afterIsInsidePlot",re),re.isInsidePlot}redraw(s){gr(this,"beforeRedraw");let u=this.hasCartesianSeries?this.axes:this.colorAxis||[],p=this.series,y=this.pointer,x=this.legend,E=this.userOptions.legend,S=this.renderer,C=S.isHidden(),L=[],N,z,j,W=this.isDirtyBox,Y=this.isDirtyLegend,re;for(S.rootFontSize=S.boxWrapper.getStyle("font-size"),this.setResponsive&&this.setResponsive(!1),tl(!!this.hasRendered&&s,this),C&&this.temporaryDisplay(),this.layOutTitles(!1),j=p.length;j--;)if(((re=p[j]).options.stacking||re.options.centerInCategory)&&(z=!0,re.isDirty)){N=!0;break}if(N)for(j=p.length;j--;)(re=p[j]).options.stacking&&(re.isDirty=!0);p.forEach(function(te){te.isDirty&&(te.options.legendType==="point"?(typeof te.updateTotals=="function"&&te.updateTotals(),Y=!0):E&&(E.labelFormatter||E.labelFormat)&&(Y=!0)),te.isDirtyData&&gr(te,"updatedData")}),Y&&x&&x.options.enabled&&(x.render(),this.isDirtyLegend=!1),z&&this.getStacks(),u.forEach(function(te){te.updateNames(),te.setScale()}),this.getMargins(),u.forEach(function(te){te.isDirty&&(W=!0)}),u.forEach(function(te){let Q=te.min+","+te.max;te.extKey!==Q&&(te.extKey=Q,L.push(function(){gr(te,"afterSetExtremes",Ta(te.eventArgs,te.getExtremes())),delete te.eventArgs})),(W||z)&&te.redraw()}),W&&this.drawChartBox(),gr(this,"predraw"),p.forEach(function(te){(W||te.isDirty)&&te.visible&&te.redraw(),te.isDirtyData=!1}),y&&y.reset(!0),S.draw(),gr(this,"redraw"),gr(this,"render"),C&&this.temporaryDisplay(!0),L.forEach(function(te){te.call()})}get(s){let u=this.series;function p(x){return x.id===s||x.options&&x.options.id===s}let y=Qr(this.axes,p)||Qr(this.series,p);for(let x=0;!y&&x<u.length;x++)y=Qr(u[x].points||[],p);return y}createAxes(){let s=this.userOptions;for(let u of(gr(this,"createAxes"),["xAxis","yAxis"]))for(let p of s[u]=Ap(s[u]||{}))new xa(this,p,u);gr(this,"afterCreateAxes")}getSelectedPoints(){return this.series.reduce((s,u)=>(u.getPointsCollection().forEach(p=>{rn(p.selectedStaging,p.selected)&&s.push(p)}),s),[])}getSelectedSeries(){return this.series.filter(s=>s.selected)}setTitle(s,u,p){this.applyDescription("title",s),this.applyDescription("subtitle",u),this.applyDescription("caption",void 0),this.layOutTitles(p)}applyDescription(s,u){var E;let p=this,y=this.options[s]=En(this.options[s],u),x=this[s];x&&u&&(this[s]=x=x.destroy()),y&&!x&&((x=this.renderer.text(y.text,0,0,y.useHTML).attr({align:y.align,class:"highcharts-"+s,zIndex:y.zIndex||4}).css({textOverflow:"ellipsis",whiteSpace:"nowrap"}).add()).update=function(S,C){p.applyDescription(s,S),p.layOutTitles(C)},this.styledMode||x.css(Ta(s==="title"?{fontSize:this.options.isStock?"1em":"1.2em"}:{},y.style)),x.textPxLength=x.getBBox().width,x.css({whiteSpace:(E=y.style)==null?void 0:E.whiteSpace}),this[s]=x)}layOutTitles(s=!0){var S,C,L,N;let u=[0,0,0],{options:p,renderer:y,spacingBox:x}=this;["title","subtitle","caption"].forEach(z=>{var te;let j=this[z],W=this.options[z],Y=En(x),re=(j==null?void 0:j.textPxLength)||0;if(j&&W){gr(this,"layOutTitle",{alignTo:Y,key:z,textPxLength:re});let Q=y.fontMetrics(j),ae=Q.b,he=Q.h,Ue=W.verticalAlign||"top",Ie=Ue==="top",Re=Ie&&W.minScale||1,rt=z==="title"?Ie?-3:0:Ie?u[0]+2:0,qe=Math.min(Y.width/re,1),st=Math.max(Re,qe),Et=En({y:Ue==="bottom"?ae:rt+ae},{align:z==="title"?qe<Re?"left":"center":(te=this.title)==null?void 0:te.alignValue},W),Bt=(W.width||(qe>Re?this.chartWidth:Y.width)/st)+"px";j.alignValue!==Et.align&&(j.placed=!1);let $t=Math.round(j.css({width:Bt}).getBBox(W.useHTML).height);if(Et.height=$t,j.align(Et,!1,Y).attr({align:Et.align,scaleX:st,scaleY:st,"transform-origin":`${Y.x+re*st*rd(Et.align)} ${he}`}),!W.floating){let At=$t*($t<1.2*he?1:st);Ue==="top"?u[0]=Math.ceil(u[0]+At):Ue==="bottom"&&(u[2]=Math.ceil(u[2]+At))}}},this),u[0]&&(((S=p.title)==null?void 0:S.verticalAlign)||"top")==="top"&&(u[0]+=((C=p.title)==null?void 0:C.margin)||0),u[2]&&((L=p.caption)==null?void 0:L.verticalAlign)==="bottom"&&(u[2]+=((N=p.caption)==null?void 0:N.margin)||0);let E=!this.titleOffset||this.titleOffset.join(",")!==u.join(",");this.titleOffset=u,gr(this,"afterLayOutTitles"),!this.isDirtyBox&&E&&(this.isDirtyBox=this.isDirtyLegend=E,this.hasRendered&&s&&this.isDirtyBox&&this.redraw())}getContainerBox(){let s=[].map.call(this.renderTo.children,p=>{if(p!==this.container){let y=p.style.display;return p.style.display="none",[p,y]}}),u={width:ao(this.renderTo,"width",!0)||0,height:ao(this.renderTo,"height",!0)||0};return s.filter(Boolean).forEach(([p,y])=>{p.style.display=y}),u}getChartSize(){var E;let s=this.options.chart,u=s.width,p=s.height,y=this.getContainerBox(),x=y.height<=1||!((E=this.renderTo.parentElement)!=null&&E.style.height)&&this.renderTo.style.height==="100%";this.chartWidth=Math.max(0,u||y.width||600),this.chartHeight=Math.max(0,$f(p,this.chartWidth)||(x?400:y.height)),this.containerBox=y}temporaryDisplay(s){let u=this.renderTo,p;if(s)for(;u!=null&&u.style;)u.hcOrigStyle&&(kn(u,u.hcOrigStyle),delete u.hcOrigStyle),u.hcOrigDetached&&(td.body.removeChild(u),u.hcOrigDetached=!1),u=u.parentNode;else for(;u!=null&&u.style&&(td.body.contains(u)||u.parentNode||(u.hcOrigDetached=!0,td.body.appendChild(u)),(ao(u,"display",!1)==="none"||u.hcOricDetached)&&(u.hcOrigStyle={display:u.style.display,height:u.style.height,overflow:u.style.overflow},p={display:"block",overflow:"hidden"},u!==this.renderTo&&(p.height=0),kn(u,p),u.offsetWidth||u.style.setProperty("display","block","important")),(u=u.parentNode)!==td.body););}setClassName(s){this.container.className="highcharts-container "+(s||"")}getContainer(){var j,W;let s,u=this.options,p=u.chart,y="data-highcharts-chart",x=wg(),E=this.renderTo,S=xg(Tp(E,y));Dh(S)&&jl[S]&&jl[S].hasRendered&&jl[S].destroy(),Tp(E,y,this.index),E.innerHTML=Dr.emptyHTML,p.skipClone||E.offsetWidth||this.temporaryDisplay(),this.getChartSize();let C=this.chartHeight,L=this.chartWidth;kn(E,{overflow:"hidden"}),this.styledMode||(s=Ta({position:"relative",overflow:"hidden",width:L+"px",height:C+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)",userSelect:"none","touch-action":"manipulation",outline:"none",padding:"0px"},p.style||{}));let N=Ep("div",{id:x},s,E);this.container=N,this.getChartSize(),L===this.chartWidth||(L=this.chartWidth,this.styledMode||kn(N,{width:rn((j=p.style)==null?void 0:j.width,L+"px")})),this.containerBox=this.getContainerBox(),this._cursor=N.style.cursor;let z=p.renderer||!_g?Qn.getRendererType(p.renderer):vc;if(this.renderer=new z(N,L,C,void 0,p.forExport,(W=u.exporting)==null?void 0:W.allowHTML,this.styledMode),tl(void 0,this),this.setClassName(p.className),this.styledMode)for(let Y in u.defs)this.renderer.definition(u.defs[Y]);else this.renderer.setStyle(p.style);this.renderer.chartIndex=this.index,gr(this,"afterGetContainer")}getMargins(s){var x;let{spacing:u,margin:p,titleOffset:y}=this;this.resetMargins(),y[0]&&!Io(p[0])&&(this.plotTop=Math.max(this.plotTop,y[0]+u[0])),y[2]&&!Io(p[2])&&(this.marginBottom=Math.max(this.marginBottom,y[2]+u[2])),(x=this.legend)!=null&&x.display&&this.legend.adjustMargins(p,u),gr(this,"getMargins"),s||this.getAxisMargins()}getAxisMargins(){let s=this,u=s.axisOffset=[0,0,0,0],p=s.colorAxis,y=s.margin,x=function(E){E.forEach(function(S){S.visible&&S.getOffset()})};s.hasCartesianSeries?x(s.axes):p!=null&&p.length&&x(p),wp.forEach(function(E,S){Io(y[S])||(s[E]+=u[S])}),s.setChartSize()}getOptions(){return jn(this.userOptions,ed)}reflow(s){var x;let u=this,p=u.containerBox,y=u.getContainerBox();(x=u.pointer)==null||delete x.chartPosition,!u.isPrinting&&!u.isResizing&&p&&y.width&&((y.width!==p.width||y.height!==p.height)&&(me.clearTimeout(u.reflowTimeout),u.reflowTimeout=bg(function(){u.container&&u.setSize(void 0,void 0,!1)},100*!!s)),u.containerBox=y)}setReflow(){let s=this,u=p=>{var y;(y=s.options)!=null&&y.chart.reflow&&s.hasLoaded&&s.reflow(p)};if(typeof ResizeObserver=="function")new ResizeObserver(u).observe(s.renderTo);else{let p=sa(Lh,"resize",u);sa(this,"destroy",p)}}setSize(s,u,p){let y=this,x=y.renderer;y.isResizing+=1,tl(p,y);let E=x.globalAnimation;y.oldChartHeight=y.chartHeight,y.oldChartWidth=y.chartWidth,s!==void 0&&(y.options.chart.width=s),u!==void 0&&(y.options.chart.height=u),y.getChartSize();let{chartWidth:S,chartHeight:C,scrollablePixelsX:L=0,scrollablePixelsY:N=0}=y;(y.isDirtyBox||S!==y.oldChartWidth||C!==y.oldChartHeight)&&(y.styledMode||(E?el:kn)(y.container,{width:`${S+L}px`,height:`${C+N}px`},E),y.setChartSize(!0),x.setSize(S,C,E),y.axes.forEach(function(z){z.isDirty=!0,z.setScale()}),y.isDirtyLegend=!0,y.isDirtyBox=!0,y.layOutTitles(),y.getMargins(),y.redraw(E),y.oldChartHeight=void 0,gr(y,"resize"),setTimeout(()=>{y&&gr(y,"endResize")},Qu(E).duration)),y.isResizing-=1}setChartSize(s){let u,p,y,x,{chartHeight:E,chartWidth:S,inverted:C,spacing:L,renderer:N}=this,z=this.clipOffset,j=Math[C?"floor":"round"];this.plotLeft=u=Math.round(this.plotLeft),this.plotTop=p=Math.round(this.plotTop),this.plotWidth=y=Math.max(0,Math.round(S-u-(this.marginRight??0))),this.plotHeight=x=Math.max(0,Math.round(E-p-(this.marginBottom??0))),this.plotSizeX=C?x:y,this.plotSizeY=C?y:x,this.spacingBox=N.spacingBox={x:L[3],y:L[0],width:S-L[3]-L[1],height:E-L[0]-L[2]},this.plotBox=N.plotBox={x:u,y:p,width:y,height:x},z&&(this.clipBox={x:j(z[3]),y:j(z[0]),width:j(this.plotSizeX-z[1]-z[3]),height:j(this.plotSizeY-z[0]-z[2])}),s||(this.axes.forEach(function(W){W.setAxisSize(),W.setAxisTranslation()}),N.alignElements()),gr(this,"afterSetChartSize",{skipAxes:s})}resetMargins(){gr(this,"resetMargins");let s=this,u=s.options.chart,p=u.plotBorderWidth||0,y=Math.round(p)/2;["margin","spacing"].forEach(function(x){let E=u[x],S=yg(E)?E:[E,E,E,E];["Top","Right","Bottom","Left"].forEach(function(C,L){s[x][L]=rn(u[x+C],S[L])})}),wp.forEach(function(x,E){s[x]=rn(s.margin[E],s.spacing[E])}),s.axisOffset=[0,0,0,0],s.clipOffset=[y,y,y,y],s.plotBorderWidth=p}drawChartBox(){let s=this.options.chart,u=this.renderer,p=this.chartWidth,y=this.chartHeight,x=this.styledMode,E=this.plotBGImage,S=s.backgroundColor,C=s.plotBackgroundColor,L=s.plotBackgroundImage,N=this.plotLeft,z=this.plotTop,j=this.plotWidth,W=this.plotHeight,Y=this.plotBox,re=this.clipRect,te=this.clipBox,Q=this.chartBackground,ae=this.plotBackground,he=this.plotBorder,Ue,Ie,Re,rt="animate";Q||(this.chartBackground=Q=u.rect().addClass("highcharts-background").add(),rt="attr"),x?Ue=Ie=Q.strokeWidth():(Ie=(Ue=s.borderWidth||0)+8*!!s.shadow,Re={fill:S||"none"},(Ue||Q["stroke-width"])&&(Re.stroke=s.borderColor,Re["stroke-width"]=Ue),Q.attr(Re).shadow(s.shadow)),Q[rt]({x:Ie/2,y:Ie/2,width:p-Ie-Ue%2,height:y-Ie-Ue%2,r:s.borderRadius}),rt="animate",ae||(rt="attr",this.plotBackground=ae=u.rect().addClass("highcharts-plot-background").add()),ae[rt](Y),!x&&(ae.attr({fill:C||"none"}).shadow(s.plotShadow),L&&(E?(L!==E.attr("href")&&E.attr("href",L),E.animate(Y)):this.plotBGImage=u.image(L,N,z,j,W).add())),re?re.animate({width:te.width,height:te.height}):this.clipRect=u.clipRect(te),rt="animate",he||(rt="attr",this.plotBorder=he=u.rect().addClass("highcharts-plot-border").attr({zIndex:1}).add()),x||he.attr({stroke:s.plotBorderColor,"stroke-width":s.plotBorderWidth||0,fill:"none"}),he[rt](he.crisp(Y,-he.strokeWidth())),this.isDirtyBox=!1,gr(this,"afterDrawChartBox")}propFromSeries(){let s,u,p,y=this,x=y.options.chart,E=y.options.series;["inverted","angular","polar"].forEach(function(S){for(u=Vl[x.type],p=x[S]||u&&u.prototype[S],s=E==null?void 0:E.length;!p&&s--;)(u=Vl[E[s].type])&&u.prototype[S]&&(p=!0);y[S]=p})}linkSeries(s){let u=this,p=u.series;p.forEach(function(y){y.linkedSeries.length=0}),p.forEach(function(y){let{linkedTo:x}=y.options;if(sd(x)){let E;(E=x===":previous"?u.series[y.index-1]:u.get(x))&&E.linkedParent!==y&&(E.linkedSeries.push(y),y.linkedParent=E,E.enabledDataSorting&&y.setDataSortingOptions(),y.visible=rn(y.options.visible,E.options.visible,y.visible))}}),gr(this,"afterLinkSeries",{isUpdating:s})}renderSeries(){this.series.forEach(function(s){s.translate(),s.render()})}render(){var N;let s=this.axes,u=this.colorAxis,p=this.renderer,y=this.options.chart.axisLayoutRuns||2,x=z=>{z.forEach(j=>{j.visible&&j.render()})},E=0,S=!0,C,L=0;for(let z of(this.setTitle(),gr(this,"beforeMargins"),(N=this.getStacks)==null||N.call(this),this.getMargins(!0),this.setChartSize(),s)){let{options:j}=z,{labels:W}=j;if(this.hasCartesianSeries&&z.horiz&&z.visible&&W.enabled&&z.series.length&&z.coll!=="colorAxis"&&!this.polar){E=j.tickLength,z.createGroups();let Y=new Ko(z,0,"",!0),re=Y.createLabel("x",W);if(Y.destroy(),re&&rn(W.reserveSpace,!Dh(j.crossing))&&(E=re.getBBox().height+W.distance+Math.max(j.offset||0,0)),E){re==null||re.destroy();break}}}for(this.plotHeight=Math.max(this.plotHeight-E,0);(S||C||y>1)&&L<y;){let z=this.plotWidth,j=this.plotHeight;for(let W of s)L===0?W.setScale():(W.horiz&&S||!W.horiz&&C)&&W.setTickInterval(!0);L===0?this.getAxisMargins():this.getMargins(),S=z/this.plotWidth>(L?1:1.1),C=j/this.plotHeight>(L?1:1.05),L++}this.drawChartBox(),this.hasCartesianSeries?x(s):u!=null&&u.length&&x(u),this.seriesGroup||(this.seriesGroup=p.g("series-group").attr({zIndex:3}).shadow(this.options.chart.seriesGroupShadow).add()),this.renderSeries(),this.addCredits(),this.setResponsive&&this.setResponsive(),this.hasRendered=!0}addCredits(s){let u=this,p=En(!0,this.options.credits,s);p.enabled&&!this.credits&&(this.credits=this.renderer.text(p.text+(this.mapCredits||""),0,0).addClass("highcharts-credits").on("click",function(){p.href&&(Lh.location.href=p.href)}).attr({align:p.position.align,zIndex:8}),u.styledMode||this.credits.css(p.style),this.credits.add().align(p.position),this.credits.update=function(y){u.credits=u.credits.destroy(),u.addCredits(y)})}destroy(){var S,C;let s,u=this,p=u.axes,y=u.series,x=u.container,E=x==null?void 0:x.parentNode;for(gr(u,"destroy"),u.renderer.forExport?Tn(jl,u):jl[u.index]=void 0,Ne.chartCount--,u.renderTo.removeAttribute("data-highcharts-chart"),vg(u),s=p.length;s--;)p[s]=p[s].destroy();for((C=(S=this.scroller)==null?void 0:S.destroy)==null||C.call(S),s=y.length;s--;)y[s]=y[s].destroy();["title","subtitle","chartBackground","plotBackground","plotBGImage","plotBorder","seriesGroup","clipRect","credits","pointer","rangeSelector","legend","resetZoomButton","tooltip","renderer"].forEach(L=>{var N,z;u[L]=(z=(N=u[L])==null?void 0:N.destroy)==null?void 0:z.call(N)}),x&&(x.innerHTML=Dr.emptyHTML,vg(x),E&&id(x)),Sp(u,function(L,N){delete u[N]})}firstRender(){var y;let s=this,u=s.options;s.getContainer(),s.resetMargins(),s.setChartSize(),s.propFromSeries(),s.createAxes();let p=zy(u.series)?u.series:[];u.series=[],p.forEach(function(x){s.initSeries(x)}),s.linkSeries(),s.setSortedData(),gr(s,"beforeRender"),s.render(),(y=s.pointer)==null||y.getChartPosition(),s.renderer.imgCount||s.hasLoaded||s.onload(),s.temporaryDisplay(!0)}onload(){this.callbacks.concat([this.callback]).forEach(function(s){s&&this.index!==void 0&&s.apply(this,[this])},this),gr(this,"load"),gr(this,"render"),Io(this.index)&&this.setReflow(),this.warnIfA11yModuleNotLoaded(),this.hasLoaded=!0}warnIfA11yModuleNotLoaded(){let{options:s,title:u}=this;!s||this.accessibility||(this.renderer.boxWrapper.attr({role:"img","aria-label":((u==null?void 0:u.element.textContent)||"").replace(/</g,"&lt;")}),s.accessibility&&s.accessibility.enabled===!1||Vn('Highcharts warning: Consider including the "accessibility.js" module to make your chart more usable for people with disabilities. Set the "accessibility.enabled" option to false to remove this warning. See https://www.highcharts.com/docs/accessibility/accessibility-module.',!1,this))}addSeries(s,u,p){let y,x=this;return s&&(u=rn(u,!0),gr(x,"addSeries",{options:s},function(){y=x.initSeries(s),x.isDirtyLegend=!0,x.linkSeries(),y.enabledDataSorting&&y.setData(s.data,!1),gr(x,"afterAddSeries",{series:y}),u&&x.redraw(p)})),y}addAxis(s,u,p,y){return this.createAxis(u?"xAxis":"yAxis",{axis:s,redraw:p,animation:y})}addColorAxis(s,u,p){return this.createAxis("colorAxis",{axis:s,redraw:u,animation:p})}createAxis(s,u){let p=new xa(this,u.axis,s);return rn(u.redraw,!0)&&this.redraw(u.animation),p}showLoading(s){let u=this,p=u.options,y=p.loading,x=function(){E&&kn(E,{left:u.plotLeft+"px",top:u.plotTop+"px",width:u.plotWidth+"px",height:u.plotHeight+"px"})},E=u.loadingDiv,S=u.loadingSpan;E||(u.loadingDiv=E=Ep("div",{className:"highcharts-loading highcharts-loading-hidden"},null,u.container)),S||(u.loadingSpan=S=Ep("span",{className:"highcharts-loading-inner"},null,E),sa(u,"redraw",x)),E.className="highcharts-loading",Dr.setElementHTML(S,rn(s,p.lang.loading,"")),u.styledMode||(kn(E,Ta(y.style,{zIndex:10})),kn(S,y.labelStyle),u.loadingShown||(kn(E,{opacity:0,display:""}),el(E,{opacity:y.style.opacity||.5},{duration:y.showDuration||0}))),u.loadingShown=!0,x()}hideLoading(){let s=this.options,u=this.loadingDiv;u&&(u.className="highcharts-loading highcharts-loading-hidden",this.styledMode||el(u,{opacity:0},{duration:s.loading.hideDuration||100,complete:function(){kn(u,{display:"none"})}})),this.loadingShown=!1}update(s,u,p,y){let x,E,S,C=this,L={credits:"addCredits",title:"setTitle",subtitle:"setSubtitle",caption:"setCaption"},N=s.isResponsiveOptions,z=[];gr(C,"update",{options:s}),N||C.setResponsive(!1,!0),s=jn(s,C.options),C.userOptions=En(C.userOptions,s);let j=s.chart;j&&(En(!0,C.options.chart,j),this.setZoomOptions(),"className"in j&&C.setClassName(j.className),("inverted"in j||"polar"in j||"type"in j)&&(C.propFromSeries(),x=!0),"alignTicks"in j&&(x=!0),"events"in j&&Gf(this,j),Sp(j,function(re,te){C.propsRequireUpdateSeries.indexOf("chart."+te)!==-1&&(E=!0),C.propsRequireDirtyBox.indexOf(te)!==-1&&(C.isDirtyBox=!0),C.propsRequireReflow.indexOf(te)===-1||(C.isDirtyBox=!0,N||(S=!0))}),!C.styledMode&&j.style&&C.renderer.setStyle(C.options.chart.style||{})),!C.styledMode&&s.colors&&(this.options.colors=s.colors),Sp(s,function(re,te){C[te]&&typeof C[te].update=="function"?C[te].update(re,!1):typeof C[L[te]]=="function"?C[L[te]](re):te!=="colors"&&C.collectionsWithUpdate.indexOf(te)===-1&&En(!0,C.options[te],s[te]),te!=="chart"&&C.propsRequireUpdateSeries.indexOf(te)!==-1&&(E=!0)}),this.collectionsWithUpdate.forEach(function(re){s[re]&&(Ap(s[re]).forEach(function(te,Q){let ae,he=Io(te.id);he&&(ae=C.get(te.id)),!ae&&C[re]&&(ae=C[re][rn(te.index,Q)])&&(he&&Io(ae.options.id)||ae.options.isInternal)&&(ae=void 0),ae&&ae.coll===re&&(ae.update(te,!1),p&&(ae.touched=!0)),!ae&&p&&C.collectionsWithInit[re]&&(C.collectionsWithInit[re][0].apply(C,[te].concat(C.collectionsWithInit[re][1]||[]).concat([!1])).touched=!0)}),p&&C[re].forEach(function(te){te.touched||te.options.isInternal?delete te.touched:z.push(te)}))}),z.forEach(function(re){re.chart&&re.remove&&re.remove(!1)}),x&&C.axes.forEach(function(re){re.update({},!1)}),E&&C.getSeriesOrderByLinks().forEach(function(re){re.chart&&re.update({},!1)},this);let W=j==null?void 0:j.width,Y=j&&(sd(j.height)?$f(j.height,W||C.chartWidth):j.height);S||Dh(W)&&W!==C.chartWidth||Dh(Y)&&Y!==C.chartHeight?C.setSize(W,Y,y):rn(u,!0)&&C.redraw(y),gr(C,"afterUpdate",{options:s,redraw:u,animation:y})}setSubtitle(s,u){this.applyDescription("subtitle",s),this.layOutTitles(u)}setCaption(s,u){this.applyDescription("caption",s),this.layOutTitles(u)}showResetZoom(){let s=this,u=ed.lang,p=s.zooming.resetButton,y=p.theme,x=p.relativeTo==="chart"||p.relativeTo==="spacingBox"?null:"plotBox";function E(){s.zoomOut()}gr(this,"beforeShowResetZoom",null,function(){s.resetZoomButton=s.renderer.button(u.resetZoom,null,null,E,y).attr({align:p.position.align,title:u.resetZoomTitle}).addClass("highcharts-reset-zoom").add().align(p.position,!1,x)}),gr(this,"afterShowResetZoom")}zoomOut(){gr(this,"selection",{resetSelection:!0},()=>this.transform({reset:!0,trigger:"zoom"}))}pan(s,u){let p=this,y=typeof u=="object"?u:{enabled:u,type:"x"},x=y.type,E=x&&p[{x:"xAxis",xy:"axes",y:"yAxis"}[x]].filter(C=>C.options.panningEnabled&&!C.options.isInternal),S=p.options.chart;S!=null&&S.panning&&(S.panning=y),gr(this,"pan",{originalEvent:s},()=>{p.transform({axes:E,event:s,to:{x:s.chartX-(p.mouseDownX||0),y:s.chartY-(p.mouseDownY||0)},trigger:"pan"}),kn(p.container,{cursor:"move"})})}transform(s){var Y;let{axes:u=this.axes,event:p,from:y={},reset:x,selection:E,to:S={},trigger:C}=s,{inverted:L,time:N}=this,z=!1,j,W;for(let re of((Y=this.hoverPoints)==null||Y.forEach(te=>te.setState()),u)){let{horiz:te,len:Q,minPointOffset:ae=0,options:he,reversed:Ue}=re,Ie=te?"width":"height",Re=te?"x":"y",rt=rn(S[Ie],re.len),qe=rn(y[Ie],re.len),st=10>Math.abs(rt)?1:rt/qe,Et=(y[Re]||0)+qe/2-re.pos,Bt=Et-((S[Re]??re.pos)+rt/2-re.pos)/st,$t=Ue&&!L||!Ue&&L?-1:1;if(!x&&(Et<0||Et>re.len))continue;let At=re.toValue(Bt,!0)+(E||re.isOrdinal?0:ae*$t),Kt=re.toValue(Bt+Q/st,!0)-(E||re.isOrdinal?0:ae*$t||0),si=re.allExtremes;if(At>Kt&&([At,Kt]=[Kt,At]),st===1&&!x&&re.coll==="yAxis"&&!si){for(let $n of re.series){let uo=$n.getExtremes($n.getProcessedData(!0).modified.getColumn("y")||[],!0);si??(si={dataMin:Number.MAX_VALUE,dataMax:-Number.MAX_VALUE}),Dh(uo.dataMin)&&Dh(uo.dataMax)&&(si.dataMin=Math.min(uo.dataMin,si.dataMin),si.dataMax=Math.max(uo.dataMax,si.dataMax))}re.allExtremes=si}let{dataMin:Ii,dataMax:hi,min:Li,max:ar}=Ta(re.getExtremes(),si||{}),Zi=N.parse(he.min),dr=N.parse(he.max),pn=Ii??Zi,lr=hi??dr,Cr=Kt-At,Fi=re.categories?0:Math.min(Cr,lr-pn),ii=pn-Fi*(Io(Zi)?0:he.minPadding),ds=lr+Fi*(Io(dr)?0:he.maxPadding),kr=re.allowZoomOutside||st===1||C!=="zoom"&&st>1,Ur=Math.min(Zi??ii,ii,kr?Li:ii),Hr=Math.max(dr??ds,ds,kr?ar:ds);(!re.isOrdinal||re.options.overscroll||st!==1||x)&&(At<Ur&&(At=Ur,st>=1&&(Kt=At+Cr)),Kt>Hr&&(Kt=Hr,st>=1&&(At=Kt-Cr)),(x||re.series.length&&(At!==Li||Kt!==ar)&&At>=Ur&&Kt<=Hr)&&(E?E[re.coll].push({axis:re,min:At,max:Kt}):(re.isPanning=C!=="zoom",re.isPanning&&(W=!0),re.setExtremes(x?void 0:At,x?void 0:Kt,!1,!1,{move:Bt,trigger:C,scale:st}),!x&&(At>Ur||Kt<Hr)&&C!=="mousewheel"&&(j=!0)),z=!0),p&&(this[te?"mouseDownX":"mouseDownY"]=p[te?"chartX":"chartY"]))}return z&&(E?gr(this,"selection",E,()=>{delete s.selection,s.trigger="zoom",this.transform(s)}):(!j||W||this.resetZoomButton?!j&&this.resetZoomButton&&(this.resetZoomButton=this.resetZoomButton.destroy()):this.showResetZoom(),this.redraw(C==="zoom"&&(this.options.chart.animation??this.pointCount<100)))),z}}Ta(Lo.prototype,{callbacks:[],collectionsWithInit:{xAxis:[Lo.prototype.addAxis,[!0]],yAxis:[Lo.prototype.addAxis,[!1]],series:[Lo.prototype.addSeries]},collectionsWithUpdate:["xAxis","yAxis","series"],propsRequireDirtyBox:["backgroundColor","borderColor","borderWidth","borderRadius","plotBackgroundColor","plotBackgroundImage","plotBorderColor","plotBorderWidth","plotShadow","shadow"],propsRequireReflow:["margin","marginTop","marginRight","marginBottom","marginLeft","spacing","spacingTop","spacingRight","spacingBottom","spacingLeft"],propsRequireUpdateSeries:["chart.inverted","chart.polar","chart.ignoreHiddenSeries","chart.type","colors","plotOptions","time","tooltip"]});let{stop:Wf}=ls,{composed:Hf}=Ne,{addEvent:Ea,createElement:Xs,css:nd,defined:Mp,erase:Sa,merge:Tg,pushUnique:Gl}=me;function od(){let R=this.scrollablePlotArea;(this.scrollablePixelsX||this.scrollablePixelsY)&&!R&&(this.scrollablePlotArea=R=new Sn(this)),R==null||R.applyFixed()}function lo(){this.chart.scrollablePlotArea&&(this.chart.scrollablePlotArea.isDirty=!0)}class Sn{static compose(s,u,p){Gl(Hf,this.compose)&&(Ea(s,"afterInit",lo),Ea(u,"afterSetChartSize",y=>this.afterSetSize(y.target,y)),Ea(u,"render",od),Ea(p,"show",lo))}static afterSetSize(s,u){let p,y,x,{minWidth:E,minHeight:S}=s.options.chart.scrollablePlotArea||{},{clipBox:C,plotBox:L,inverted:N,renderer:z}=s;if(!z.forExport&&(E?(s.scrollablePixelsX=p=Math.max(0,E-s.chartWidth),p&&(s.scrollablePlotBox=Tg(s.plotBox),L.width=s.plotWidth+=p,C[N?"height":"width"]+=p,x=!0)):S&&(s.scrollablePixelsY=y=Math.max(0,S-s.chartHeight),Mp(y)&&(s.scrollablePlotBox=Tg(s.plotBox),L.height=s.plotHeight+=y,C[N?"width":"height"]+=y,x=!1)),Mp(x)&&!u.skipAxes))for(let j of s.axes)(j.horiz===x||s.hasParallelCoordinates&&j.coll==="yAxis")&&(j.setAxisSize(),j.setAxisTranslation())}constructor(s){var W;let u,p=s.options.chart,y=Qn.getRendererType(),x=p.scrollablePlotArea||{},E=this.moveFixedElements.bind(this),S={WebkitOverflowScrolling:"touch",overflowX:"hidden",overflowY:"hidden"};s.scrollablePixelsX&&(S.overflowX="auto"),s.scrollablePixelsY&&(S.overflowY="auto"),this.chart=s;let C=this.parentDiv=Xs("div",{className:"highcharts-scrolling-parent"},{position:"relative"},s.renderTo),L=this.scrollingContainer=Xs("div",{className:"highcharts-scrolling"},S,C),N=this.innerContainer=Xs("div",{className:"highcharts-inner-container"},void 0,L),z=this.fixedDiv=Xs("div",{className:"highcharts-fixed"},{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:(((W=p.style)==null?void 0:W.zIndex)||0)+2,top:0},void 0,!0),j=this.fixedRenderer=new y(z,s.chartWidth,s.chartHeight,p.style);this.mask=j.path().attr({fill:p.backgroundColor||"#fff","fill-opacity":x.opacity??.85,zIndex:-1}).addClass("highcharts-scrollable-mask").add(),L.parentNode.insertBefore(z,L),nd(s.renderTo,{overflow:"visible"}),Ea(s,"afterShowResetZoom",E),Ea(s,"afterApplyDrilldown",E),Ea(s,"afterLayOutTitles",E),Ea(L,"scroll",()=>{let{pointer:Y,hoverPoint:re}=s;Y&&(delete Y.chartPosition,re&&(u=re),Y.runPointActions(void 0,u,!0))}),N.appendChild(s.container)}applyFixed(){var Et;let{chart:s,fixedRenderer:u,isDirty:p,scrollingContainer:y}=this,{axisOffset:x,chartWidth:E,chartHeight:S,container:C,plotHeight:L,plotLeft:N,plotTop:z,plotWidth:j,scrollablePixelsX:W=0,scrollablePixelsY:Y=0}=s,{scrollPositionX:re=0,scrollPositionY:te=0}=s.options.chart.scrollablePlotArea||{},Q=E+W,ae=S+Y;u.setSize(E,S),(p??!0)&&(this.isDirty=!1,this.moveFixedElements()),Wf(s.container),nd(C,{width:`${Q}px`,height:`${ae}px`}),s.renderer.boxWrapper.attr({width:Q,height:ae,viewBox:[0,0,Q,ae].join(" ")}),(Et=s.chartBackground)==null||Et.attr({width:Q,height:ae}),nd(y,{width:`${E}px`,height:`${S}px`}),Mp(p)||(y.scrollLeft=W*re,y.scrollTop=Y*te);let he=z-x[0]-1,Ue=N-x[3]-1,Ie=z+L+x[2]+1,Re=N+j+x[1]+1,rt=N+j-W,qe=z+L-Y,st=[["M",0,0]];W?st=[["M",0,he],["L",N-1,he],["L",N-1,Ie],["L",0,Ie],["Z"],["M",rt,he],["L",E,he],["L",E,Ie],["L",rt,Ie],["Z"]]:Y&&(st=[["M",Ue,0],["L",Ue,z-1],["L",Re,z-1],["L",Re,0],["Z"],["M",Ue,qe],["L",Ue,S],["L",Re,S],["L",Re,qe],["Z"]]),s.redrawTrigger!=="adjustHeight"&&this.mask.attr({d:st})}moveFixedElements(){let s,{container:u,inverted:p,scrollablePixelsX:y,scrollablePixelsY:x}=this.chart,E=this.fixedRenderer,S=Sn.fixedSelectors;if(y&&!p?s=".highcharts-yaxis":y&&p||x&&!p?s=".highcharts-xaxis":x&&p&&(s=".highcharts-yaxis"),s&&!(this.chart.hasParallelCoordinates&&s===".highcharts-yaxis"))for(let C of[`${s}:not(.highcharts-radial-axis)`,`${s}-labels:not(.highcharts-radial-axis-labels)`])Gl(S,C);else for(let C of[".highcharts-xaxis",".highcharts-yaxis"])for(let L of[`${C}:not(.highcharts-radial-axis)`,`${C}-labels:not(.highcharts-radial-axis-labels)`])Sa(S,L);for(let C of S)[].forEach.call(u.querySelectorAll(C),L=>{(L.namespaceURI===E.SVG_NS?E.box:E.box.parentNode).appendChild(L),L.style.pointerEvents="auto"})}}Sn.fixedSelectors=[".highcharts-breadcrumbs-group",".highcharts-contextbutton",".highcharts-caption",".highcharts-credits",".highcharts-drillup-button",".highcharts-legend",".highcharts-legend-checkbox",".highcharts-navigator-series",".highcharts-navigator-xaxis",".highcharts-navigator-yaxis",".highcharts-navigator",".highcharts-range-selector-group",".highcharts-reset-zoom",".highcharts-scrollbar",".highcharts-subtitle",".highcharts-title"];let{format:Oy}=Ys,{series:Cp}=wr,{destroyObjectProperties:Eg,fireEvent:Sg,getAlignFactor:ad,isNumber:Do,pick:na}=me,qf=class{constructor(R,s,u,p,y){let x=R.chart.inverted,E=R.reversed;this.axis=R;let S=this.isNegative=!!u!=!!E;this.options=s=s||{},this.x=p,this.total=null,this.cumulative=null,this.points={},this.hasValidPoints=!1,this.stack=y,this.leftCliff=0,this.rightCliff=0,this.alignOptions={align:s.align||(x?S?"left":"right":"center"),verticalAlign:s.verticalAlign||(x?"middle":S?"bottom":"top"),y:s.y,x:s.x},this.textAlign=s.textAlign||(x?S?"right":"left":"center")}destroy(){Eg(this,this.axis)}render(R){let s=this.axis.chart,u=this.options,p=u.format,y=p?Oy(p,this,s):u.formatter.call(this);if(this.label)this.label.attr({text:y,visibility:"hidden"});else{this.label=s.renderer.label(y,null,void 0,u.shape,void 0,void 0,u.useHTML,!1,"stack-labels");let x={r:u.borderRadius||0,text:y,padding:na(u.padding,5),visibility:"hidden"};s.styledMode||(x.fill=u.backgroundColor,x.stroke=u.borderColor,x["stroke-width"]=u.borderWidth,this.label.css(u.style||{})),this.label.attr(x),this.label.added||this.label.add(R)}this.label.labelrank=s.plotSizeY,Sg(this,"afterRender")}setOffset(R,s,u,p,y,x){let{alignOptions:E,axis:S,label:C,options:L,textAlign:N}=this,z=S.chart,j=this.getStackBox({xOffset:R,width:s,boxBottom:u,boxTop:p,defaultX:y,xAxis:x}),{verticalAlign:W}=E;if(C&&j){let Y=C.getBBox(void 0,0),re=C.padding,te=na(L.overflow,"justify")==="justify",Q;E.x=L.x||0,E.y=L.y||0;let{x:ae,y:he}=this.adjustStackPosition({labelBox:Y,verticalAlign:W,textAlign:N});j.x-=ae,j.y-=he,C.align(E,!1,j),(Q=z.isInsidePlot(C.alignAttr.x+E.x+ae,C.alignAttr.y+E.y+he))||(te=!1),te&&Cp.prototype.justifyDataLabel.call(S,C,E,C.alignAttr,Y,j),C.attr({x:C.alignAttr.x,y:C.alignAttr.y,rotation:L.rotation,rotationOriginX:Y.width*ad(L.textAlign||"center"),rotationOriginY:Y.height/2}),na(!te&&L.crop,!0)&&(Q=Do(C.x)&&Do(C.y)&&z.isInsidePlot(C.x-re+(C.width||0),C.y)&&z.isInsidePlot(C.x+re,C.y)),C[Q?"show":"hide"]()}Sg(this,"afterSetOffset",{xOffset:R,width:s})}adjustStackPosition({labelBox:R,verticalAlign:s,textAlign:u}){return{x:R.width/2+R.width/2*(2*ad(u)-1),y:R.height/2*2*(1-ad(s))}}getStackBox(R){let s=this.axis,u=s.chart,{boxTop:p,defaultX:y,xOffset:x,width:E,boxBottom:S}=R,C=s.stacking.usePercentage?100:na(p,this.total,0),L=s.toPixels(C),N=R.xAxis||u.xAxis[0],z=na(y,N.translate(this.x))+x,j=Math.abs(L-s.toPixels(S||Do(s.min)&&s.logarithmic&&s.logarithmic.lin2log(s.min)||0)),W=u.inverted,Y=this.isNegative;return W?{x:(Y?L:L-j)-u.plotLeft,y:N.height-z-E+N.top-u.plotTop,width:j,height:E}:{x:z+N.transB-u.plotLeft,y:(Y?L-j:L)-u.plotTop,width:E,height:j}}},{getDeferredAnimation:Ag}=ls,{series:{prototype:By}}=wr,{addEvent:ld,correctFloat:zc,defined:Oc,destroyObjectProperties:Rh,fireEvent:cd,isNumber:zh,objectEach:$l,pick:Bc}=me;function Xf(){let R=this.inverted;this.axes.forEach(s=>{var u;(u=s.stacking)!=null&&u.stacks&&s.hasVisibleSeries&&(s.stacking.oldStacks=s.stacking.stacks)}),this.series.forEach(s=>{var p;let u=((p=s.xAxis)==null?void 0:p.options)||{};s.options.stacking&&s.reserveSpace()&&(s.stackKey=[s.type,Bc(s.options.stack,""),R?u.top:u.left,R?u.height:u.width].join(","))})}function Mg(){var s;let R=this.stacking;if(R){let u=R.stacks;$l(u,(p,y)=>{Rh(p),delete u[y]}),(s=R.stackTotalGroup)==null||s.destroy()}}function Oh(){this.stacking||(this.stacking=new hd(this))}function Cg(R,s,u,p){return!Oc(R)||R.x!==s||p&&R.stackKey!==p?R={x:s,index:0,key:p,stackKey:p}:R.index++,R.key=[u,s,R.index].join(","),R}function Zf(){let R,s=this,u=s.yAxis,p=s.stackKey||"",y=u.stacking.stacks,x=s.getColumn("x",!0),E=s.options.stacking,S=s[E+"Stacker"];S&&[p,"-"+p].forEach(C=>{var W;let L=x.length,N,z,j;for(;L--;)N=x[L],R=s.getStackIndicator(R,N,s.index,C),z=(W=y[C])==null?void 0:W[N],(j=z==null?void 0:z.points[R.key||""])&&S.call(s,j,z,L)})}function kg(R,s,u){let p=s.total?100/s.total:0;R[0]=zc(R[0]*p),R[1]=zc(R[1]*p),this.stackedYData[u]=R[1]}function Fy(R){(this.is("column")||this.is("columnrange"))&&(this.options.centerInCategory&&this.chart.series.length>1?By.setStackedPoints.call(this,R,"group"):R.stacking.resetStacks())}function Ny(R,s){var qe,st;let u,p,y,x,E,S,C,L=s||this.options.stacking;if(!L||!this.reserveSpace()||({group:"xAxis"}[L]||"yAxis")!==R.coll)return;let N=this.getColumn("x",!0),z=this.getColumn(this.pointValKey||"y",!0),j=[],W=z.length,Y=this.options,re=Y.threshold||0,te=Y.startFromThreshold?re:0,Q=Y.stack,ae=s?`${this.type},${L}`:this.stackKey||"",he="-"+ae,Ue=this.negStacks,Ie=R.stacking,Re=Ie.stacks,rt=Ie.oldStacks;for(Ie.stacksTouched+=1,C=0;C<W;C++){let Et=N[C]||0,Bt=z[C],$t=zh(Bt)&&Bt||0;S=(u=this.getStackIndicator(u,Et,this.index)).key||"",Re[E=(p=Ue&&$t<(te?0:re))?he:ae]||(Re[E]={}),Re[E][Et]||((qe=rt[E])!=null&&qe[Et]?(Re[E][Et]=rt[E][Et],Re[E][Et].total=null):Re[E][Et]=new qf(R,R.options.stackLabels,!!p,Et,Q)),y=Re[E][Et],Bt!==null?(y.points[S]=y.points[this.index]=[Bc(y.cumulative,te)],Oc(y.cumulative)||(y.base=S),y.touched=Ie.stacksTouched,u.index>0&&this.singleStacks===!1&&(y.points[S][0]=y.points[this.index+","+Et+",0"][0])):(delete y.points[S],delete y.points[this.index]);let At=y.total||0;L==="percent"?(x=p?ae:he,At=Ue&&((st=Re[x])!=null&&st[Et])?(x=Re[x][Et]).total=Math.max(x.total||0,At)+Math.abs($t):zc(At+Math.abs($t))):L==="group"?zh(Bt)&&At++:At=zc(At+$t),L==="group"?y.cumulative=(At||1)-1:y.cumulative=zc(Bc(y.cumulative,te)+$t),y.total=At,Bt!==null&&(y.points[S].push(y.cumulative),j[C]=y.cumulative,y.hasValidPoints=!0)}L==="percent"&&(Ie.usePercentage=!0),L!=="group"&&(this.stackedYData=j),Ie.oldStacks={}}class hd{constructor(s){this.oldStacks={},this.stacks={},this.stacksTouched=0,this.axis=s}buildStacks(){let s,u,p=this.axis,y=p.series,x=p.coll==="xAxis",E=p.options.reversedStacks,S=y.length;for(this.resetStacks(),this.usePercentage=!1,u=S;u--;)s=y[E?u:S-u-1],x&&s.setGroupedPoints(p),s.setStackedPoints(p);if(!x)for(u=0;u<S;u++)y[u].modifyStacks();cd(p,"afterBuildStacks")}cleanStacks(){this.oldStacks&&(this.stacks=this.oldStacks,$l(this.stacks,s=>{$l(s,u=>{u.cumulative=u.total})}))}resetStacks(){$l(this.stacks,s=>{$l(s,(u,p)=>{zh(u.touched)&&u.touched<this.stacksTouched?(u.destroy(),delete s[p]):(u.total=null,u.cumulative=null)})})}renderStackTotals(){var S;let s=this.axis,u=s.chart,p=u.renderer,y=this.stacks,x=Ag(u,((S=s.options.stackLabels)==null?void 0:S.animation)||!1),E=this.stackTotalGroup=this.stackTotalGroup||p.g("stack-labels").attr({zIndex:6,opacity:0}).add();E.translate(u.plotLeft,u.plotTop),$l(y,C=>{$l(C,L=>{L.render(E)})}),E.animate({opacity:1},x)}}(We||(We={})).compose=function(R,s,u){let p=s.prototype,y=u.prototype;p.getStacks||(ld(R,"init",Oh),ld(R,"destroy",Mg),p.getStacks=Xf,y.getStackIndicator=Cg,y.modifyStacks=Zf,y.percentStacker=kg,y.setGroupedPoints=Fy,y.setStackedPoints=Ny)};let Pg=We,{defined:Wl,merge:Mr,isObject:Yf}=me;class oa extends tn{drawGraph(){let s=this.options,u=(this.gappedPath||this.getGraphPath).call(this),p=this.chart.styledMode;[this,...this.zones].forEach((y,x)=>{let E,S=y.graph,C=S?"animate":"attr",L=y.dashStyle||s.dashStyle;S?(S.endX=this.preventGraphAnimation?null:u.xMap,S.animate({d:u})):u.length&&(y.graph=S=this.chart.renderer.path(u).addClass("highcharts-graph"+(x?` highcharts-zone-graph-${x-1} `:" ")+(x&&y.className||"")).attr({zIndex:1}).add(this.group)),S&&!p&&(E={stroke:!x&&s.lineColor||y.color||this.color||"#cccccc","stroke-width":s.lineWidth||0,fill:this.fillGraph&&this.color||"none"},L?E.dashstyle=L:s.linecap!=="square"&&(E["stroke-linecap"]=E["stroke-linejoin"]="round"),S[C](E).shadow(s.shadow&&Mr({filterUnits:"userSpaceOnUse"},Yf(s.shadow)?s.shadow:{}))),S&&(S.startX=u.xMap,S.isArea=u.isArea)})}getGraphPath(s,u,p){let y=this,x=y.options,E=[],S=[],C,L=x.step,N=(s=s||y.points).reversed;return N&&s.reverse(),(L={right:1,center:2}[L]||L&&3)&&N&&(L=4-L),(s=this.getValidPoints(s,!1,x.nullInteraction||!(x.connectNulls&&!u&&!p))).forEach(function(z,j){let W,Y=z.plotX,re=z.plotY,te=s[j-1],Q=z.isNull||typeof re!="number";(z.leftCliff||te!=null&&te.rightCliff)&&!p&&(C=!0),Q&&!Wl(u)&&j>0?C=!x.connectNulls:Q&&!u?C=!0:(j===0||C?W=[["M",z.plotX,z.plotY]]:y.getPointSpline?W=[y.getPointSpline(s,z,j)]:L?(W=L===1?[["L",te.plotX,re]]:L===2?[["L",(te.plotX+Y)/2,te.plotY],["L",(te.plotX+Y)/2,re]]:[["L",Y,te.plotY]]).push(["L",Y,re]):W=[["L",Y,re]],S.push(z.x),L&&(S.push(z.x),L===2&&S.push(z.x)),E.push.apply(E,W),C=!1)}),E.xMap=S,y.graphPath=E,E}}oa.defaultOptions=Mr(tn.defaultOptions,{legendSymbol:"lineMarker"}),wr.registerSeriesType("line",oa);let{seriesTypes:{line:Ro}}=wr,{extend:aa,merge:co,objectEach:sn,pick:ud}=me;class ho extends Ro{drawGraph(){this.areaPath=[],super.drawGraph.apply(this);let{areaPath:s,options:u}=this;[this,...this.zones].forEach((p,y)=>{let x={},E=p.fillColor||u.fillColor,S=p.area,C=S?"animate":"attr";S?(S.endX=this.preventGraphAnimation?null:s.xMap,S.animate({d:s})):(x.zIndex=0,(S=p.area=this.chart.renderer.path(s).addClass("highcharts-area"+(y?` highcharts-zone-area-${y-1} `:" ")+(y&&p.className||"")).add(this.group)).isArea=!0),this.chart.styledMode||(x.fill=E||p.color||this.color,x["fill-opacity"]=E?1:u.fillOpacity??.75,S.css({pointerEvents:this.stickyTracking?"none":"auto"})),S[C](x),S.startX=s.xMap,S.shiftUnit=u.step?2:1})}getGraphPath(s){let u,p,y,x=Ro.prototype.getGraphPath,E=this.options,S=E.stacking,C=this.yAxis,L=[],N=[],z=this.index,j=C.stacking.stacks[this.stackKey],W=E.threshold,Y=Math.round(C.getThreshold(E.threshold)),re=ud(E.connectNulls,S==="percent"),te=function(Re,rt,qe){let st=s[Re],Et=S&&j[st.x].points[z],Bt=st[qe+"Null"]||0,$t=st[qe+"Cliff"]||0,At,Kt,si=!0;$t||Bt?(At=(Bt?Et[0]:Et[1])+$t,Kt=Et[0]+$t,si=!!Bt):!S&&s[rt]&&s[rt].isNull&&(At=Kt=W),At!==void 0&&(N.push({plotX:u,plotY:At===null?Y:C.getThreshold(At),isNull:si,isCliff:!0}),L.push({plotX:u,plotY:Kt===null?Y:C.getThreshold(Kt),doCurve:!1}))};s=s||this.points,S&&(s=this.getStackPoints(s));for(let Re=0,rt=s.length;Re<rt;++Re)S||(s[Re].leftCliff=s[Re].rightCliff=s[Re].leftNull=s[Re].rightNull=void 0),p=s[Re].isNull,u=ud(s[Re].rectPlotX,s[Re].plotX),y=S?ud(s[Re].yBottom,Y):Y,p&&!re||(re||te(Re,Re-1,"left"),p&&!S&&re||(N.push(s[Re]),L.push({x:Re,plotX:u,plotY:y})),re||te(Re,Re+1,"right"));let Q=x.call(this,N,!0,!0);L.reversed=!0;let ae=x.call(this,L,!0,!0),he=ae[0];he&&he[0]==="M"&&(ae[0]=["L",he[1],he[2]]);let Ue=Q.concat(ae);Ue.length&&Ue.push(["Z"]);let Ie=x.call(this,N,!1,re);return this.chart.series.length>1&&S&&N.some(Re=>Re.isCliff)&&(Ue.hasStackedCliffs=Ie.hasStackedCliffs=!0),Ue.xMap=Q.xMap,this.areaPath=Ue,Ie}getStackPoints(s){let u=this,p=[],y=[],x=this.xAxis,E=this.yAxis,S=E.stacking.stacks[this.stackKey],C={},L=E.series,N=L.length,z=E.options.reversedStacks?1:-1,j=L.indexOf(u);if(s=s||this.points,this.options.stacking){for(let Y=0;Y<s.length;Y++)s[Y].leftNull=s[Y].rightNull=void 0,C[s[Y].x]=s[Y];sn(S,function(Y,re){Y.total!==null&&y.push(re)}),y.sort(function(Y,re){return Y-re});let W=L.map(Y=>Y.visible);y.forEach(function(Y,re){let te=0,Q,ae;if(C[Y]&&!C[Y].isNull)p.push(C[Y]),[-1,1].forEach(function(he){let Ue=he===1?"rightNull":"leftNull",Ie=S[y[re+he]],Re=0;if(Ie){let rt=j;for(;rt>=0&&rt<N;){let qe=L[rt].index;!(Q=Ie.points[qe])&&(qe===u.index?C[Y][Ue]=!0:W[rt]&&(ae=S[Y].points[qe])&&(Re-=ae[1]-ae[0])),rt+=z}}C[Y][he===1?"rightCliff":"leftCliff"]=Re});else{let he=j;for(;he>=0&&he<N;){let Ue=L[he].index;if(Q=S[Y].points[Ue]){te=Q[1];break}he+=z}te=ud(te,0),te=E.translate(te,0,1,0,1),p.push({isNull:!0,plotX:x.translate(Y,0,0,0,1),x:Y,plotY:te,yBottom:te})}})}return p}}ho.defaultOptions=co(Ro.defaultOptions,{threshold:0,legendSymbol:"areaMarker"}),aa(ho.prototype,{singleStacks:!1}),wr.registerSeriesType("area",ho);let{line:Kf}=wr.seriesTypes,{merge:Bh,pick:Fh}=me;class kp extends Kf{getPointSpline(s,u,p){let y,x,E,S,C=u.plotX||0,L=u.plotY||0,N=s[p-1],z=s[p+1];function j(Y){return Y&&!Y.isNull&&Y.doCurve!==!1&&!u.isCliff}if(j(N)&&j(z)){let Y=N.plotX||0,re=N.plotY||0,te=z.plotX||0,Q=z.plotY||0,ae=0;y=(1.5*C+Y)/2.5,x=(1.5*L+re)/2.5,E=(1.5*C+te)/2.5,S=(1.5*L+Q)/2.5,E!==y&&(ae=(S-x)*(E-C)/(E-y)+L-S),x+=ae,S+=ae,x>re&&x>L?(x=Math.max(re,L),S=2*L-x):x<re&&x<L&&(x=Math.min(re,L),S=2*L-x),S>Q&&S>L?(S=Math.max(Q,L),x=2*L-S):S<Q&&S<L&&(S=Math.min(Q,L),x=2*L-S),u.rightContX=E,u.rightContY=S,u.controlPoints={low:[y,x],high:[E,S]}}let W=["C",Fh(N.rightContX,N.plotX,0),Fh(N.rightContY,N.plotY,0),Fh(y,C,0),Fh(x,L,0),C,L];return N.rightContX=N.rightContY=void 0,W}}kp.defaultOptions=Bh(Kf.defaultOptions),wr.registerSeriesType("spline",kp);let Pp=kp,{area:Uy,area:{prototype:dd}}=wr.seriesTypes,{extend:Ig,merge:jy}=me;class la extends Pp{}la.defaultOptions=jy(Pp.defaultOptions,Uy.defaultOptions),Ig(la.prototype,{getGraphPath:dd.getGraphPath,getStackPoints:dd.getStackPoints,drawGraph:dd.drawGraph}),wr.registerSeriesType("areaspline",la);let{animObject:Fc}=ls,{parse:Ip}=Ye,{noop:Lp}=Ne,{clamp:Nh,crisp:pd,defined:Lg,extend:Jf,fireEvent:Dg,isArray:Dp,isNumber:Rp,merge:fd,pick:Uh,objectEach:Rg}=me;class Aa extends tn{animate(s){let u,p,y=this,x=this.yAxis,E=x.pos,S=x.reversed,C=y.options,{clipOffset:L,inverted:N}=this.chart,z={},j=N?"translateX":"translateY";s&&L?(z.scaleY=.001,p=Nh(x.toPixels(C.threshold||0),E,E+x.len),N?z.translateX=(p+=S?-Math.floor(L[0]):Math.ceil(L[2]))-x.len:z.translateY=p+=S?Math.ceil(L[0]):-Math.floor(L[2]),y.clipBox&&y.setClip(),y.group.attr(z)):(u=Number(y.group.attr(j)),y.group.animate({scaleY:1},Jf(Fc(y.options.animation),{step:function(W,Y){y.group&&(z[j]=u+Y.pos*(E-u),y.group.attr(z))}})))}init(s,u){super.init.apply(this,arguments);let p=this;(s=p.chart).hasRendered&&s.series.forEach(function(y){y.type===p.type&&(y.isDirty=!0)})}getColumnMetrics(){var re,te;let s=this,u=s.options,p=s.xAxis,y=s.yAxis,x=p.options.reversedStacks,E=p.reversed&&!x||!p.reversed&&x,S={},C,L=0;u.grouping===!1?L=1:s.chart.series.forEach(function(Q){let ae,he=Q.yAxis,Ue=Q.options;Q.type===s.type&&Q.reserveSpace()&&y.len===he.len&&y.pos===he.pos&&(Ue.stacking&&Ue.stacking!=="group"?(S[C=Q.stackKey]===void 0&&(S[C]=L++),ae=S[C]):Ue.grouping!==!1&&(ae=L++),Q.columnIndex=ae)});let N=Math.min(Math.abs(p.transA)*(!((re=p.brokenAxis)!=null&&re.hasBreaks)&&((te=p.ordinal)==null?void 0:te.slope)||u.pointRange||p.closestPointRange||p.tickInterval||1),p.len),z=N*u.groupPadding,j=(N-2*z)/(L||1),W=Math.min(u.maxPointWidth||p.len,Uh(u.pointWidth,j*(1-2*u.pointPadding))),Y=(s.columnIndex||0)+ +!!E;return s.columnMetrics={width:W,offset:(j-W)/2+(z+Y*j-N/2)*(E?-1:1),paddedWidth:j,columnCount:L},s.columnMetrics}crispCol(s,u,p,y){let x=this.borderWidth,E=this.chart.inverted;return y=pd(u+y,x,E)-(u=pd(u,x,E)),this.options.crisp&&(p=pd(s+p,x)-(s=pd(s,x))),{x:s,y:u,width:p,height:y}}adjustForMissingColumns(s,u,p,y){var x;if(!p.isNull&&y.columnCount>1){let E=this.xAxis.series.filter(N=>N.visible).map(N=>N.index),S=0,C=0;Rg((x=this.xAxis.stacking)==null?void 0:x.stacks,N=>{var Y;let z=typeof p.x=="number"?(Y=N[p.x.toString()])==null?void 0:Y.points:void 0,j=z==null?void 0:z[this.index],W={};if(z&&Dp(j)){let re=this.index,te=Object.keys(z).filter(Q=>!Q.match(",")&&z[Q]&&z[Q].length>1).map(parseFloat).filter(Q=>E.indexOf(Q)!==-1).filter(Q=>{let ae=this.chart.series[Q].options,he=ae.stacking&&ae.stack;if(Lg(he)){if(Rp(W[he]))return re===Q&&(re=W[he]),!1;W[he]=Q}return!0}).sort((Q,ae)=>ae-Q);S=te.indexOf(re),C=te.length}}),S=this.xAxis.reversed?C-1-S:S;let L=(C-1)*y.paddedWidth+u;s=(p.plotX||0)+L/2-u-S*y.paddedWidth}return s}translate(){let s=this,u=s.chart,p=s.options,y=s.dense=s.closestPointRange*s.xAxis.transA<2,x=s.borderWidth=Uh(p.borderWidth,+!y),E=s.xAxis,S=s.yAxis,C=p.threshold,L=Uh(p.minPointLength,5),N=s.getColumnMetrics(),z=N.width,j=s.pointXOffset=N.offset,W=s.dataMin,Y=s.dataMax,re=s.translatedThreshold=S.getThreshold(C),te=s.barW=Math.max(z,1+2*x);p.pointPadding&&p.crisp&&(te=Math.ceil(te)),tn.prototype.translate.apply(s),s.points.forEach(function(Q){let ae=Uh(Q.yBottom,re),he=999+Math.abs(ae),Ue=Q.plotX||0,Ie=Nh(Q.plotY,-he,S.len+he),Re,rt=Math.min(Ie,ae),qe=Math.max(Ie,ae)-rt,st=z,Et=Ue+j,Bt=te;L&&Math.abs(qe)<L&&(qe=L,Re=!S.reversed&&!Q.negative||S.reversed&&Q.negative,Rp(C)&&Rp(Y)&&Q.y===C&&Y<=C&&(S.min||0)<C&&(W!==Y||(S.max||0)<=C)&&(Re=!Re,Q.negative=!Q.negative),rt=Math.abs(rt-re)>L?ae-L:re-(Re?L:0)),Lg(Q.options.pointWidth)&&(Et-=Math.round(((st=Bt=Math.ceil(Q.options.pointWidth))-z)/2)),p.centerInCategory&&(Et=s.adjustForMissingColumns(Et,st,Q,N)),Q.barX=Et,Q.pointWidth=st,Q.tooltipPos=u.inverted?[Nh(S.len+S.pos-u.plotLeft-Ie,S.pos-u.plotLeft,S.len+S.pos-u.plotLeft),E.len+E.pos-u.plotTop-Et-Bt/2,qe]:[E.left-u.plotLeft+Et+Bt/2,Nh(Ie+S.pos-u.plotTop,S.pos-u.plotTop,S.len+S.pos-u.plotTop),qe],Q.shapeType=s.pointClass.prototype.shapeType||"roundedRect",Q.shapeArgs=s.crispCol(Et,rt,Bt,Q.isNull?0:qe)}),Dg(this,"afterColumnTranslate")}drawGraph(){this.group[this.dense?"addClass":"removeClass"]("highcharts-dense-data")}pointAttribs(s,u){let p=this.options,y=this.pointAttrToOptions||{},x=y.stroke||"borderColor",E=y["stroke-width"]||"borderWidth",S,C,L,N=s&&s.color||this.color,z=s&&s[x]||p[x]||N,j=s&&s.options.dashStyle||p.dashStyle,W=s&&s[E]||p[E]||this[E]||0,Y=s!=null&&s.isNull&&p.nullInteraction?0:(s==null?void 0:s.opacity)??p.opacity??1;s&&this.zones.length&&(C=s.getZone(),N=s.options.color||C&&(C.color||s.nonZonedColor)||this.color,C&&(z=C.borderColor||z,j=C.dashStyle||j,W=C.borderWidth||W)),u&&s&&(L=(S=fd(p.states[u],s.options.states&&s.options.states[u]||{})).brightness,N=S.color||L!==void 0&&Ip(N).brighten(S.brightness).get()||N,z=S[x]||z,W=S[E]||W,j=S.dashStyle||j,Y=Uh(S.opacity,Y));let re={fill:N,stroke:z,"stroke-width":W,opacity:Y};return j&&(re.dashstyle=j),re}drawPoints(s=this.points){let u,p=this,y=this.chart,x=p.options,E=x.nullInteraction,S=y.renderer,C=x.animationLimit||250;s.forEach(function(L){let N=L.plotY,z=L.graphic,j=!!z,W=z&&y.pointCount<C?"animate":"attr";Rp(N)&&(L.y!==null||E)?(u=L.shapeArgs,z&&L.hasNewShapeType()&&(z=z.destroy()),p.enabledDataSorting&&(L.startXPos=p.xAxis.reversed?-(u&&u.width||0):p.xAxis.width),!z&&(L.graphic=z=S[L.shapeType](u).add(L.group||p.group),z&&p.enabledDataSorting&&y.hasRendered&&y.pointCount<C&&(z.attr({x:L.startXPos}),j=!0,W="animate")),z&&j&&z[W](fd(u)),y.styledMode||z[W](p.pointAttribs(L,L.selected&&"select")).shadow(L.allowShadow!==!1&&x.shadow),z&&(z.addClass(L.getClassName(),!0),z.attr({visibility:L.visible?"inherit":"hidden"}))):z&&(L.graphic=z.destroy())})}drawTracker(s=this.points){let u,p=this,y=p.chart,x=y.pointer,E=function(S){x==null||x.normalize(S);let C=x==null?void 0:x.getPointFromEvent(S);x&&C&&p.options.enableMouseTracking&&(y.isInsidePlot(S.chartX-y.plotLeft,S.chartY-y.plotTop,{visiblePlotOnly:!0})||x!=null&&x.inClass(S.target,"highcharts-data-label"))&&(x.isDirectTouch=!0,C.onMouseOver(S))};s.forEach(function(S){u=Dp(S.dataLabels)?S.dataLabels:S.dataLabel?[S.dataLabel]:[],S.graphic&&(S.graphic.element.point=S),u.forEach(function(C){(C.div||C.element).point=S})}),p._hasTracking||(p.trackerGroups.forEach(function(S){p[S]&&(p[S].addClass("highcharts-tracker").on("mouseover",E).on("mouseout",function(C){x==null||x.onTrackerMouseOut(C)}).on("touchstart",E),!y.styledMode&&p.options.cursor&&p[S].css({cursor:p.options.cursor}))}),p._hasTracking=!0),Dg(this,"afterDrawTracker")}remove(){let s=this,u=s.chart;u.hasRendered&&u.series.forEach(function(p){p.type===s.type&&(p.isDirty=!0)}),tn.prototype.remove.apply(s,arguments)}}Aa.defaultOptions=fd(tn.defaultOptions,{borderRadius:3,centerInCategory:!1,groupPadding:.2,marker:null,pointPadding:.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{halo:!1,brightness:.1},select:{color:"#cccccc",borderColor:"#000000"}},dataLabels:{align:void 0,verticalAlign:void 0,y:void 0},startFromThreshold:!0,stickyTracking:!1,tooltip:{distance:6},threshold:0,borderColor:"#ffffff"}),Jf(Aa.prototype,{directTouch:!0,getSymbol:Lp,negStacks:!0,trackerGroups:["group","dataLabelsGroup"]}),wr.registerSeriesType("column",Aa);let md=Aa,{getDeferredAnimation:Vy}=ls,{format:jh}=Ys,{defined:Ma,extend:Qf,fireEvent:zp,getAlignFactor:zg,isArray:Hl,isString:Vh,merge:gd,objectEach:Og,pick:_d,pInt:Gy,splat:em}=me;(function(R){function s(){return C(this).some(N=>N==null?void 0:N.enabled)}function u(N,z,j,W,Y){var Et;let{chart:re,enabledDataSorting:te}=this,Q=this.isCartesian&&re.inverted,ae=N.plotX,he=N.plotY,Ue=j.rotation||0,Ie=Ma(ae)&&Ma(he)&&re.isInsidePlot(ae,Math.round(he),{inverted:Q,paneCoordinates:!0,series:this}),Re=Ue===0&&_d(j.overflow,te?"none":"justify")==="justify",rt=this.visible&&N.visible!==!1&&Ma(ae)&&(N.series.forceDL||te&&!Re||Ie||_d(j.inside,!!this.options.stacking)&&W&&re.isInsidePlot(ae,Q?W.x+1:W.y+W.height-1,{inverted:Q,paneCoordinates:!0,series:this})),qe=N.pos();if(rt&&qe){var st;let Bt=z.getBBox(),$t=z.getBBox(void 0,0);if(W=Qf({x:qe[0],y:Math.round(qe[1]),width:0,height:0},W||{}),j.alignTo==="plotEdges"&&this.isCartesian&&(W[Q?"x":"y"]=0,W[Q?"width":"height"]=((Et=this.yAxis)==null?void 0:Et.len)||0),Qf(j,{width:Bt.width,height:Bt.height}),st=W,te&&this.xAxis&&!Re&&this.setDataLabelStartPos(N,z,Y,Ie,st),z.align(gd(j,{width:$t.width,height:$t.height}),!1,W,!1),z.alignAttr.x+=zg(j.align)*($t.width-Bt.width),z.alignAttr.y+=zg(j.verticalAlign)*($t.height-Bt.height),z[z.placed?"animate":"attr"]({"text-align":z.alignAttr["text-align"]||"center",x:z.alignAttr.x+(Bt.width-$t.width)/2,y:z.alignAttr.y+(Bt.height-$t.height)/2,rotationOriginX:(z.width||0)/2,rotationOriginY:(z.height||0)/2}),Re&&W.height>=0)this.justifyDataLabel(z,j,z.alignAttr,Bt,W,Y);else if(_d(j.crop,!0)){let{x:At,y:Kt}=z.alignAttr;rt=re.isInsidePlot(At,Kt,{paneCoordinates:!0,series:this})&&re.isInsidePlot(At+Bt.width-1,Kt+Bt.height-1,{paneCoordinates:!0,series:this})}j.shape&&!Ue&&z[Y?"attr":"animate"]({anchorX:qe[0],anchorY:qe[1]})}Y&&te&&(z.placed=!1),rt||te&&!Re?(z.show(),z.placed=!0):(z.hide(),z.placed=!1)}function p(){return this.plotGroup("dataLabelsGroup","data-labels",this.hasRendered?"inherit":"hidden",this.options.dataLabels.zIndex||6)}function y(N){let z=this.hasRendered||0,j=this.initDataLabelsGroup().attr({opacity:+z});return!z&&j&&(this.visible&&j.show(),this.options.animation?j.animate({opacity:1},N):j.attr({opacity:1})),j}function x(N){var rt;let z;N=N||this.points;let j=this,W=j.chart,Y=j.options,re=W.renderer,{backgroundColor:te,plotBackgroundColor:Q}=W.options.chart,ae=re.getContrast(Vh(Q)&&Q||Vh(te)&&te||"#000000"),he=C(j),{animation:Ue,defer:Ie}=he[0],Re=Ie?Vy(W,Ue,j):{defer:0,duration:0};zp(this,"drawDataLabels"),(rt=j.hasDataLabels)!=null&&rt.call(j)&&(z=this.initDataLabels(Re),N.forEach(qe=>{var $t,At,Kt;let st=qe.dataLabels||[],Et=qe.color||j.color;em(S(he,qe.dlOptions||(($t=qe.options)==null?void 0:$t.dataLabels))).forEach((si,Ii)=>{var Ur;let hi=si.enabled&&(qe.visible||qe.dataLabelOnHidden)&&(!qe.isNull||qe.dataLabelOnNull)&&function(Hr,$n){let uo=$n.filter;if(uo){let zo=uo.operator,Pn=Hr[uo.property],Ps=uo.value;return zo===">"&&Pn>Ps||zo==="<"&&Pn<Ps||zo===">="&&Pn>=Ps||zo==="<="&&Pn<=Ps||zo==="=="&&Pn==Ps||zo==="==="&&Pn===Ps||zo==="!="&&Pn!=Ps||zo==="!=="&&Pn!==Ps||!1}return!0}(qe,si),{backgroundColor:Li,borderColor:ar,distance:Zi,style:dr={}}=si,pn,lr,Cr,Fi={},ii=st[Ii],ds=!ii,kr;hi&&(lr=Ma(pn=_d(si[qe.formatPrefix+"Format"],si.format))?jh(pn,qe,W):(si[qe.formatPrefix+"Formatter"]||si.formatter).call(qe,si),Cr=si.rotation,!W.styledMode&&(dr.color=_d(si.color,dr.color,Vh(j.color)?j.color:void 0,"#000000"),dr.color==="contrast"?(Li!=="none"&&(kr=Li),qe.contrastColor=re.getContrast(kr!=="auto"&&Vh(kr)&&kr||(Vh(Et)?Et:"")),dr.color=kr||!Ma(Zi)&&si.inside||0>Gy(Zi||0)||Y.stacking?qe.contrastColor:ae):delete qe.contrastColor,Y.cursor&&(dr.cursor=Y.cursor)),Fi={r:si.borderRadius||0,rotation:Cr,padding:si.padding,zIndex:1},W.styledMode||(Fi.fill=Li==="auto"?qe.color:Li,Fi.stroke=ar==="auto"?qe.color:ar,Fi["stroke-width"]=si.borderWidth),Og(Fi,(Hr,$n)=>{Hr===void 0&&delete Fi[$n]})),!ii||hi&&Ma(lr)&&!!(ii.div||(Ur=ii.text)!=null&&Ur.foreignObject)==!!si.useHTML&&(ii.rotation&&si.rotation||ii.rotation===si.rotation)||(ii=void 0,ds=!0),hi&&Ma(lr)&&(ii?Fi.text=lr:(ii=re.label(lr,0,0,si.shape,void 0,void 0,si.useHTML,void 0,"data-label")).addClass(" highcharts-data-label-color-"+qe.colorIndex+" "+(si.className||"")+(si.useHTML?" highcharts-tracker":"")),ii&&(ii.options=si,ii.attr(Fi),W.styledMode?dr.width&&ii.css({width:dr.width,textOverflow:dr.textOverflow,whiteSpace:dr.whiteSpace}):ii.css(dr).shadow(si.shadow),zp(ii,"beforeAddingDataLabel",{labelOptions:si,point:qe}),ii.added||ii.add(z),j.alignDataLabel(qe,ii,si,void 0,ds),ii.isActive=!0,st[Ii]&&st[Ii]!==ii&&st[Ii].destroy(),st[Ii]=ii))});let Bt=st.length;for(;Bt--;)(At=st[Bt])!=null&&At.isActive?st[Bt].isActive=!1:((Kt=st[Bt])==null||Kt.destroy(),st.splice(Bt,1));qe.dataLabel=st[0],qe.dataLabels=st})),zp(this,"afterDrawDataLabels")}function E(N,z,j,W,Y,re){let te=this.chart,Q=z.align,ae=z.verticalAlign,he=N.box?0:N.padding||0,Ue=te.inverted?this.yAxis:this.xAxis,Ie=Ue?Ue.left-te.plotLeft:0,Re=te.inverted?this.xAxis:this.yAxis,rt=Re?Re.top-te.plotTop:0,{x:qe=0,y:st=0}=z,Et,Bt;return(Et=(j.x||0)+he+Ie)<0&&(Q==="right"&&qe>=0?(z.align="left",z.inside=!0):qe-=Et,Bt=!0),(Et=(j.x||0)+W.width-he+Ie)>te.plotWidth&&(Q==="left"&&qe<=0?(z.align="right",z.inside=!0):qe+=te.plotWidth-Et,Bt=!0),(Et=j.y+he+rt)<0&&(ae==="bottom"&&st>=0?(z.verticalAlign="top",z.inside=!0):st-=Et,Bt=!0),(Et=(j.y||0)+W.height-he+rt)>te.plotHeight&&(ae==="top"&&st<=0?(z.verticalAlign="bottom",z.inside=!0):st+=te.plotHeight-Et,Bt=!0),Bt&&(z.x=qe,z.y=st,N.placed=!re,N.align(z,void 0,Y)),Bt}function S(N,z){let j=[],W;if(Hl(N)&&!Hl(z))j=N.map(function(Y){return gd(Y,z)});else if(Hl(z)&&!Hl(N))j=z.map(function(Y){return gd(N,Y)});else if(Hl(N)||Hl(z)){if(Hl(N)&&Hl(z))for(W=Math.max(N.length,z.length);W--;)j[W]=gd(N[W],z[W])}else j=gd(N,z);return j}function C(N){var j,W;let z=N.chart.options.plotOptions;return em(S(S((j=z==null?void 0:z.series)==null?void 0:j.dataLabels,(W=z==null?void 0:z[N.type])==null?void 0:W.dataLabels),N.options.dataLabels))}function L(N,z,j,W,Y){let re=this.chart,te=re.inverted,Q=this.xAxis,ae=Q.reversed,he=((te?z.height:z.width)||0)/2,Ue=N.pointWidth,Ie=Ue?Ue/2:0;z.startXPos=te?Y.x:ae?-he-Ie:Q.width-he+Ie,z.startYPos=te?ae?this.yAxis.height-he+Ie:-he-Ie:Y.y,W?z.visibility==="hidden"&&(z.show(),z.attr({opacity:0}).animate({opacity:1})):z.attr({opacity:1}).animate({opacity:0},void 0,z.hide),re.hasRendered&&(j&&z.attr({x:z.startXPos,y:z.startYPos}),z.placed=!0)}R.compose=function(N){let z=N.prototype;z.initDataLabels||(z.initDataLabels=y,z.initDataLabelsGroup=p,z.alignDataLabel=u,z.drawDataLabels=x,z.justifyDataLabel=E,z.mergeArrays=S,z.setDataLabelStartPos=L,z.hasDataLabels=s)}})(pt||(pt={}));let yd=pt,{composed:Bg}=Ne,{series:Op}=wr,{merge:il,pushUnique:Gn}=me;(function(R){function s(u,p,y,x,E){var re,te;let{chart:S,options:C}=this,L=S.inverted,N=((re=this.xAxis)==null?void 0:re.len)||S.plotSizeX||0,z=((te=this.yAxis)==null?void 0:te.len)||S.plotSizeY||0,j=u.dlBox||u.shapeArgs,W=u.below??(u.plotY||0)>(this.translatedThreshold??z),Y=y.inside??!!C.stacking;if(j){if(x=il(j),y.overflow!=="allow"||y.crop!==!1||C.clip!==!1){x.y<0&&(x.height+=x.y,x.y=0);let Q=x.y+x.height-z;Q>0&&Q<x.height-1&&(x.height-=Q)}L&&(x={x:z-x.y-x.height,y:N-x.x-x.width,width:x.height,height:x.width}),Y||(L?(x.x+=W?0:x.width,x.width=0):(x.y+=W?x.height:0,x.height=0))}y.align??(y.align=!L||Y?"center":W?"right":"left"),y.verticalAlign??(y.verticalAlign=L||Y?"middle":W?"top":"bottom"),Op.prototype.alignDataLabel.call(this,u,p,y,x,E),y.inside&&u.contrastColor&&p.css({color:u.contrastColor})}R.compose=function(u){yd.compose(Op),Gn(Bg,"ColumnDataLabel")&&(u.prototype.alignDataLabel=s)}})(yt||(yt={}));let $y=yt,{extend:tm,merge:Wy}=me;class im extends md{}im.defaultOptions=Wy(md.defaultOptions,{}),tm(im.prototype,{inverted:!0}),wr.registerSeriesType("bar",im);let{column:Hy,line:Bp}=wr.seriesTypes,{addEvent:Fp,extend:Fg,merge:Nc}=me;class ql extends Bp{applyJitter(){let s=this,u=this.options.jitter,p=this.points.length;u&&this.points.forEach(function(y,x){["x","y"].forEach(function(E,S){if(u[E]&&!y.isNull){let C=`plot${E.toUpperCase()}`,L=s[`${E}Axis`],N=u[E]*L.transA;if(L&&!L.logarithmic){let z=Math.max(0,(y[C]||0)-N),j=Math.min(L.len,(y[C]||0)+N);y[C]=z+(j-z)*function(W){let Y=1e4*Math.sin(W);return Y-Math.floor(Y)}(x+S*p),E==="x"&&(y.clientX=y.plotX)}}})})}drawGraph(){this.options.lineWidth?super.drawGraph():this.graph&&(this.graph=this.graph.destroy())}}ql.defaultOptions=Nc(Bp.defaultOptions,{lineWidth:0,findNearestPointBy:"xy",jitter:{x:0,y:0},marker:{enabled:!0},tooltip:{headerFormat:'<span style="color:{point.color}"></span> <span style="font-size: 0.8em"> {series.name}</span><br/>',pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>"}}),Fg(ql.prototype,{drawTracker:Hy.prototype.drawTracker,sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","markerGroup","dataLabelsGroup"]}),Fp(ql,"afterTranslate",function(){this.applyJitter()}),wr.registerSeriesType("scatter",ql);let{deg2rad:Ng}=Ne,{fireEvent:qy,isNumber:rm,pick:Np,relativeLength:Xy}=me;(function(R){R.getCenter=function(){let s=this.options,u=this.chart,p=2*(s.slicedOffset||0),y=u.plotWidth-2*p,x=u.plotHeight-2*p,E=s.center,S=Math.min(y,x),C=s.thickness,L,N=s.size,z=s.innerSize||0,j,W;typeof N=="string"&&(N=parseFloat(N)),typeof z=="string"&&(z=parseFloat(z));let Y=[Np(E==null?void 0:E[0],"50%"),Np(E==null?void 0:E[1],"50%"),Np(N&&N<0?void 0:s.size,"100%"),Np(z&&z<0?void 0:s.innerSize||0,"0%")];for(!u.angular||this instanceof tn||(Y[3]=0),j=0;j<4;++j)W=Y[j],L=j<2||j===2&&/%$/.test(W),Y[j]=Xy(W,[y,x,S,Y[2]][j])+(L?p:0);return Y[3]>Y[2]&&(Y[3]=Y[2]),rm(C)&&2*C<Y[2]&&C>0&&(Y[3]=Y[2]-2*C),qy(this,"afterGetCenter",{positions:Y}),Y},R.getStartAndEndRadians=function(s,u){let p=rm(s)?s:0,y=rm(u)&&u>p&&u-p<360?u:p+360;return{start:Ng*(p+-90),end:Ng*(y+-90)}}})(Ze||(Ze={}));let Ug=Ze,{setAnimation:Zy}=ls,{addEvent:Up,defined:Yy,extend:Gh,isNumber:Ky,pick:xs,relativeLength:jp}=me;class sm extends J{getConnectorPath(s){let u=s.dataLabelPosition,p=s.options||{},y=p.connectorShape,x=this.connectorShapes[y]||y;return u&&x.call(this,{...u.computed,alignment:u.alignment},u.connectorPosition,p)||[]}getTranslate(){return this.sliced&&this.slicedTranslation||{translateX:0,translateY:0}}haloPath(s){let u=this.shapeArgs;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(u.x,u.y,u.r+s,u.r+s,{innerR:u.r-1,start:u.start,end:u.end,borderRadius:u.borderRadius})}constructor(s,u,p){super(s,u,p),this.half=0,this.name??(this.name=s.chart.options.lang.pieSliceName);let y=x=>{this.slice(x.type==="select")};Up(this,"select",y),Up(this,"unselect",y)}isValid(){return Ky(this.y)&&this.y>=0}setVisible(s,u=!0){s!==this.visible&&this.update({visible:s??!this.visible},u,void 0,!1)}slice(s,u,p){let y=this.series;Zy(p,y.chart),u=xs(u,!0),this.sliced=this.options.sliced=s=Yy(s)?s:!this.sliced,y.options.data[y.data.indexOf(this)]=this.options,this.graphic&&this.graphic.animate(this.getTranslate())}}Gh(sm.prototype,{connectorShapes:{fixedOffset:function(R,s,u){let p=s.breakAt,y=s.touchingSliceAt,x=u.softConnector?["C",R.x+(R.alignment==="left"?-5:5),R.y,2*p.x-y.x,2*p.y-y.y,p.x,p.y]:["L",p.x,p.y];return[["M",R.x,R.y],x,["L",y.x,y.y]]},straight:function(R,s){let u=s.touchingSliceAt;return[["M",R.x,R.y],["L",u.x,u.y]]},crookedLine:function(R,s,u){let{angle:p=this.angle||0,breakAt:y,touchingSliceAt:x}=s,{series:E}=this,[S,C,L]=E.center,N=L/2,{plotLeft:z,plotWidth:j}=E.chart,W=R.alignment==="left",{x:Y,y:re}=R,te=y.x;if(u.crookDistance){let ae=jp(u.crookDistance,1);te=W?S+N+(j+z-S-N)*(1-ae):z+(S-N)*ae}else te=S+(C-re)*Math.tan(p-Math.PI/2);let Q=[["M",Y,re]];return(W?te<=Y&&te>=y.x:te>=Y&&te<=y.x)&&Q.push(["L",te,re]),Q.push(["L",y.x,y.y],["L",x.x,x.y]),Q}}});let{getStartAndEndRadians:Vp}=Ug,{noop:xd}=Ne,{clamp:vd,extend:jg,fireEvent:nm,merge:Uc,pick:om}=me;class bd extends tn{animate(s){let u=this,p=u.points,y=u.startAngleRad;s||p.forEach(function(x){let E=x.graphic,S=x.shapeArgs;E&&S&&(E.attr({r:om(x.startR,u.center&&u.center[3]/2),start:y,end:y}),E.animate({r:S.r,start:S.start,end:S.end},u.options.animation))})}drawEmpty(){let s,u,p=this.startAngleRad,y=this.endAngleRad,x=this.options;this.total===0&&this.center?(s=this.center[0],u=this.center[1],this.graph||(this.graph=this.chart.renderer.arc(s,u,this.center[1]/2,0,p,y).addClass("highcharts-empty-series").add(this.group)),this.graph.attr({d:lh.arc(s,u,this.center[2]/2,0,{start:p,end:y,innerR:this.center[3]/2})}),this.chart.styledMode||this.graph.attr({"stroke-width":x.borderWidth,fill:x.fillColor||"none",stroke:x.color||"#cccccc"})):this.graph&&(this.graph=this.graph.destroy())}drawPoints(){let s=this.chart.renderer;this.points.forEach(function(u){u.graphic&&u.hasNewShapeType()&&(u.graphic=u.graphic.destroy()),u.graphic||(u.graphic=s[u.shapeType](u.shapeArgs).add(u.series.group),u.delayedRendering=!0)})}generatePoints(){super.generatePoints(),this.updateTotals()}getX(s,u,p,y){let x=this.center,E=this.radii?this.radii[p.index]||0:x[2]/2,S=y.dataLabelPosition,C=(S==null?void 0:S.distance)||0,L=Math.asin(vd((s-x[1])/(E+C),-1,1));return x[0]+Math.cos(L)*(E+C)*(u?-1:1)+(C>0?(u?-1:1)*(y.padding||0):0)}hasData(){return!!this.dataTable.rowCount}redrawPoints(){let s,u,p,y,x=this,E=x.chart;this.drawEmpty(),x.group&&!E.styledMode&&x.group.shadow(x.options.shadow),x.points.forEach(function(S){let C={};u=S.graphic,!S.isNull&&u?(y=S.shapeArgs,s=S.getTranslate(),E.styledMode||(p=x.pointAttribs(S,S.selected&&"select")),S.delayedRendering?(u.setRadialReference(x.center).attr(y).attr(s),E.styledMode||u.attr(p).attr({"stroke-linejoin":"round"}),S.delayedRendering=!1):(u.setRadialReference(x.center),E.styledMode||Uc(!0,C,p),Uc(!0,C,y,s),u.animate(C)),u.attr({visibility:S.visible?"inherit":"hidden"}),u.addClass(S.getClassName(),!0)):u&&(S.graphic=u.destroy())})}sortByAngle(s,u){s.sort(function(p,y){return p.angle!==void 0&&(y.angle-p.angle)*u})}translate(s){nm(this,"translate"),this.generatePoints();let u=this.options,p=u.slicedOffset,y=Vp(u.startAngle,u.endAngle),x=this.startAngleRad=y.start,E=(this.endAngleRad=y.end)-x,S=this.points,C=u.ignoreHiddenPoint,L=S.length,N,z,j,W,Y,re,te,Q=0;for(s||(this.center=s=this.getCenter()),re=0;re<L;re++){te=S[re],N=x+Q*E,te.isValid()&&(!C||te.visible)&&(Q+=te.percentage/100),z=x+Q*E;let ae={x:s[0],y:s[1],r:s[2]/2,innerR:s[3]/2,start:Math.round(1e3*N)/1e3,end:Math.round(1e3*z)/1e3};te.shapeType="arc",te.shapeArgs=ae,(j=(z+N)/2)>1.5*Math.PI?j-=2*Math.PI:j<-Math.PI/2&&(j+=2*Math.PI),te.slicedTranslation={translateX:Math.round(Math.cos(j)*p),translateY:Math.round(Math.sin(j)*p)},W=Math.cos(j)*s[2]/2,Y=Math.sin(j)*s[2]/2,te.tooltipPos=[s[0]+.7*W,s[1]+.7*Y],te.half=+(j<-Math.PI/2||j>Math.PI/2),te.angle=j}nm(this,"afterTranslate")}updateTotals(){let s=this.points,u=s.length,p=this.options.ignoreHiddenPoint,y,x,E=0;for(y=0;y<u;y++)(x=s[y]).isValid()&&(!p||x.visible)&&(E+=x.y);for(y=0,this.total=E;y<u;y++)(x=s[y]).percentage=E>0&&(x.visible||!p)?x.y/E*100:0,x.total=E}}bd.defaultOptions=Uc(tn.defaultOptions,{borderRadius:3,center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{connectorPadding:5,connectorShape:"crookedLine",crookDistance:void 0,distance:30,enabled:!0,formatter:function(){return this.isNull?void 0:this.name},softConnector:!0,x:0},fillColor:void 0,ignoreHiddenPoint:!0,inactiveOtherPoints:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,stickyTracking:!1,tooltip:{followPointer:!0},borderColor:"#ffffff",borderWidth:1,lineWidth:void 0,states:{hover:{brightness:.1}}}),jg(bd.prototype,{axisTypes:[],directTouch:!0,drawGraph:void 0,drawTracker:md.prototype.drawTracker,getCenter:Ug.getCenter,getSymbol:xd,invertible:!1,isCartesian:!1,noSharedTooltip:!0,pointAttribs:md.prototype.pointAttribs,pointClass:sm,requireSorting:!1,searchPoint:xd,trackerGroups:["group","dataLabelsGroup"]}),wr.registerSeriesType("pie",bd);let{composed:am,noop:Jy}=Ne,{distribute:Vg}=pa,{series:$h}=wr,{arrayMax:Qy,clamp:Gp,defined:Gg,pick:lm,pushUnique:cm,relativeLength:wd}=me;(function(R){let s={radialDistributionY:function(E,S){var C;return(((C=S.dataLabelPosition)==null?void 0:C.top)||0)+E.distributeBox.pos},radialDistributionX:function(E,S,C,L,N){let z=N.dataLabelPosition;return E.getX(C<((z==null?void 0:z.top)||0)+2||C>((z==null?void 0:z.bottom)||0)-2?L:C,S.half,S,N)},justify:function(E,S,C,L){var N;return L[0]+(E.half?-1:1)*(C+(((N=S.dataLabelPosition)==null?void 0:N.distance)||0))},alignToPlotEdges:function(E,S,C,L){let N=E.getBBox().width;return S?N+L:C-N-L},alignToConnectors:function(E,S,C,L){let N=0,z;return E.forEach(function(j){(z=j.dataLabel.getBBox().width)>N&&(N=z)}),S?N+L:C-N-L}};function u(E,S){let C=Math.PI/2,{start:L=0,end:N=0}=E.shapeArgs||{},z=E.angle||0;S>0&&L<C&&N>C&&z>C/2&&z<1.5*C&&(z=z<=C?Math.max(C/2,(L+C)/2):Math.min(1.5*C,(C+N)/2));let{center:j,options:W}=this,Y=j[2]/2,re=Math.cos(z),te=Math.sin(z),Q=j[0]+re*Y,ae=j[1]+te*Y,he=Math.min((W.slicedOffset||0)+(W.borderWidth||0),S/5);return{natural:{x:Q+re*S,y:ae+te*S},computed:{},alignment:S<0?"center":E.half?"right":"left",connectorPosition:{angle:z,breakAt:{x:Q+re*he,y:ae+te*he},touchingSliceAt:{x:Q,y:ae}},distance:S}}function p(){var rt;let E=this,S=E.points,C=E.chart,L=C.plotWidth,N=C.plotHeight,z=C.plotLeft,j=Math.round(C.chartWidth/3),W=E.center,Y=W[2]/2,re=W[1],te=[[],[]],Q=[0,0,0,0],ae=E.dataLabelPositioners,he,Ue,Ie,Re=0;E.visible&&((rt=E.hasDataLabels)!=null&&rt.call(E))&&(S.forEach(qe=>{(qe.dataLabels||[]).forEach(st=>{st.shortened&&(st.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),st.shortened=!1)})}),$h.prototype.drawDataLabels.apply(E),S.forEach(qe=>{(qe.dataLabels||[]).forEach((st,Et)=>{var Kt;let Bt=W[2]/2,$t=st.options,At=wd(($t==null?void 0:$t.distance)||0,Bt);Et===0&&te[qe.half].push(qe),!Gg((Kt=$t==null?void 0:$t.style)==null?void 0:Kt.width)&&st.getBBox().width>j&&(st.css({width:Math.round(.7*j)+"px"}),st.shortened=!0),st.dataLabelPosition=this.getDataLabelPosition(qe,At),Re=Math.max(Re,At)})}),te.forEach((qe,st)=>{let Et=qe.length,Bt=[],$t,At,Kt=0,si;Et&&(E.sortByAngle(qe,st-.5),Re>0&&($t=Math.max(0,re-Y-Re),At=Math.min(re+Y+Re,C.plotHeight),qe.forEach(Ii=>{(Ii.dataLabels||[]).forEach(hi=>{var ar;let Li=hi.dataLabelPosition;Li&&Li.distance>0&&(Li.top=Math.max(0,re-Y-Li.distance),Li.bottom=Math.min(re+Y+Li.distance,C.plotHeight),Kt=hi.getBBox().height||21,hi.lineHeight=C.renderer.fontMetrics(hi.text||hi).h+2*hi.padding,Ii.distributeBox={target:(((ar=hi.dataLabelPosition)==null?void 0:ar.natural.y)||0)-Li.top+hi.lineHeight/2,size:Kt,rank:Ii.y},Bt.push(Ii.distributeBox))})}),Vg(Bt,si=At+Kt-$t,si/5)),qe.forEach(Ii=>{(Ii.dataLabels||[]).forEach(hi=>{let Li=hi.options||{},ar=Ii.distributeBox,Zi=hi.dataLabelPosition,dr=(Zi==null?void 0:Zi.natural.y)||0,pn=Li.connectorPadding||0,lr=hi.lineHeight||21,Cr=(lr-hi.getBBox().height)/2,Fi=0,ii=dr,ds="inherit";if(Zi){if(Bt&&Gg(ar)&&Zi.distance>0&&(ar.pos===void 0?ds="hidden":(Ie=ar.size,ii=ae.radialDistributionY(Ii,hi))),Li.justify)Fi=ae.justify(Ii,hi,Y,W);else switch(Li.alignTo){case"connectors":Fi=ae.alignToConnectors(qe,st,L,z);break;case"plotEdges":Fi=ae.alignToPlotEdges(hi,st,L,z);break;default:Fi=ae.radialDistributionX(E,Ii,ii-Cr,dr,hi)}if(Zi.attribs={visibility:ds,align:Zi.alignment},Zi.posAttribs={x:Fi+(Li.x||0)+({left:pn,right:-pn}[Zi.alignment]||0),y:ii+(Li.y||0)-lr/2},Zi.computed.x=Fi,Zi.computed.y=ii-Cr,lm(Li.crop,!0)){let kr;Fi-(Ue=hi.getBBox().width)<pn&&st===1?(kr=Math.round(Ue-Fi+pn),Q[3]=Math.max(kr,Q[3])):Fi+Ue>L-pn&&st===0&&(kr=Math.round(Fi+Ue-L+pn),Q[1]=Math.max(kr,Q[1])),ii-Ie/2<0?Q[0]=Math.max(Math.round(-ii+Ie/2),Q[0]):ii+Ie/2>N&&(Q[2]=Math.max(Math.round(ii+Ie/2-N),Q[2])),Zi.sideOverflow=kr}}})}))}),(Qy(Q)===0||this.verifyDataLabelOverflow(Q))&&(this.placeDataLabels(),this.points.forEach(qe=>{(qe.dataLabels||[]).forEach(st=>{var At;let{connectorColor:Et,connectorWidth:Bt=1}=st.options||{},$t=st.dataLabelPosition;if(Bt){let Kt;he=st.connector,$t&&$t.distance>0?(Kt=!he,he||(st.connector=he=C.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+qe.colorIndex+(qe.className?" "+qe.className:"")).add(E.dataLabelsGroup)),C.styledMode||he.attr({"stroke-width":Bt,stroke:Et||qe.color||"#666666"}),he[Kt?"attr":"animate"]({d:qe.getConnectorPath(st)}),he.attr({visibility:(At=$t.attribs)==null?void 0:At.visibility})):he&&(st.connector=he.destroy())}})})))}function y(){this.points.forEach(E=>{(E.dataLabels||[]).forEach(S=>{var L,N;let C=S.dataLabelPosition;C?(C.sideOverflow&&(S.css({width:Math.max(S.getBBox().width-C.sideOverflow,0)+"px",textOverflow:((N=(L=S.options)==null?void 0:L.style)==null?void 0:N.textOverflow)||"ellipsis"}),S.shortened=!0),S.attr(C.attribs),S[S.moved?"animate":"attr"](C.posAttribs),S.moved=!0):S&&S.attr({y:-9999})}),delete E.distributeBox},this)}function x(E){let S=this.center,C=this.options,L=C.center,N=C.minSize||80,z=N,j=C.size!==null;return!j&&(L[0]!==null?z=Math.max(S[2]-Math.max(E[1],E[3]),N):(z=Math.max(S[2]-E[1]-E[3],N),S[0]+=(E[3]-E[1])/2),L[1]!==null?z=Gp(z,N,S[2]-Math.max(E[0],E[2])):(z=Gp(z,N,S[2]-E[0]-E[2]),S[1]+=(E[0]-E[2])/2),z<S[2]?(S[2]=z,S[3]=Math.min(C.thickness?Math.max(0,z-2*C.thickness):Math.max(0,wd(C.innerSize||0,z)),z),this.translate(S),this.drawDataLabels&&this.drawDataLabels()):j=!0),j}R.compose=function(E){if(yd.compose($h),cm(am,"PieDataLabel")){let S=E.prototype;S.dataLabelPositioners=s,S.alignDataLabel=Jy,S.drawDataLabels=p,S.getDataLabelPosition=u,S.placeDataLabels=y,S.verifyDataLabelOverflow=x}}})(Ae||(Ae={}));let ex=Ae;(function(R){R.getCenterOfPoints=function(s){let u=s.reduce((p,y)=>(p.x+=y.x,p.y+=y.y,p),{x:0,y:0});return{x:u.x/s.length,y:u.y/s.length}},R.getDistanceBetweenPoints=function(s,u){return Math.sqrt(Math.pow(u.x-s.x,2)+Math.pow(u.y-s.y,2))},R.getAngleBetweenPoints=function(s,u){return Math.atan2(u.x-s.x,u.y-s.y)},R.pointInPolygon=function({x:s,y:u},p){let y=p.length,x,E,S=!1;for(x=0,E=y-1;x<y;E=x++){let[C,L]=p[x],[N,z]=p[E];L>u!=z>u&&s<(N-C)*(u-L)/(z-L)+C&&(S=!S)}return S}})(Be||(Be={}));let{pointInPolygon:tx}=Be,{addEvent:ix,getAlignFactor:rx,fireEvent:$g,objectEach:Wg,pick:$p}=me;function sx(R){let s=R.length,u=(N,z)=>!(z.x>=N.x+N.width||z.x+z.width<=N.x||z.y>=N.y+N.height||z.y+z.height<=N.y),p=(N,z)=>{for(let j of N)if(tx({x:j[0],y:j[1]},z))return!0;return!1},y,x,E,S,C,L=!1;for(let N=0;N<s;N++)(y=R[N])&&(y.oldOpacity=y.opacity,y.newOpacity=1,y.absoluteBox=function(z){var j,W;if(z&&(!z.alignAttr||z.placed)){let Y=z.box?0:z.padding||0,re=z.alignAttr||{x:z.attr("x"),y:z.attr("y")},{height:te,polygon:Q,width:ae}=z.getBBox(),he=rx(z.alignValue)*ae;return z.width=ae,z.height=te,{x:re.x+(((j=z.parentGroup)==null?void 0:j.translateX)||0)+Y-he,y:re.y+(((W=z.parentGroup)==null?void 0:W.translateY)||0)+Y,width:ae-2*Y,height:te-2*Y,polygon:Q}}}(y));R.sort((N,z)=>(z.labelrank||0)-(N.labelrank||0));for(let N=0;N<s;++N){S=(x=R[N])&&x.absoluteBox;let z=S==null?void 0:S.polygon;for(let j=N+1;j<s;++j){C=(E=R[j])&&E.absoluteBox;let W=!1;if(S&&C&&x!==E&&x.newOpacity!==0&&E.newOpacity!==0&&x.visibility!=="hidden"&&E.visibility!=="hidden"){let Y=C.polygon;if(z&&Y&&z!==Y?p(z,Y)&&(W=!0):u(S,C)&&(W=!0),W){let re=x.labelrank<E.labelrank?x:E,te=re.text;re.newOpacity=0,te!=null&&te.element.querySelector("textPath")&&te.hide()}}}}for(let N of R)hm(N,this)&&(L=!0);L&&$g(this,"afterHideAllOverlappingLabels")}function hm(R,s){let u,p=!1;return R&&(u=R.newOpacity,R.oldOpacity!==u&&(R.hasClass("highcharts-data-label")?(R[u?"removeClass":"addClass"]("highcharts-data-label-hidden"),p=!0,R[R.isOld?"animate":"attr"]({opacity:u},void 0,function(){s.styledMode||R.css({pointerEvents:u?"auto":"none"})}),$g(s,"afterHideOverlappingLabel")):R.attr({opacity:u})),R.isOld=!0),p}function Wh(){var u;let R=this,s=[];for(let p of R.labelCollectors||[])s=s.concat(p());for(let p of R.yAxis||[])p.stacking&&p.options.stackLabels&&!p.options.stackLabels.allowOverlap&&Wg(p.stacking.stacks,y=>{Wg(y,x=>{x.label&&s.push(x.label)})});for(let p of R.series||[])if(p.visible&&((u=p.hasDataLabels)!=null&&u.call(p))){let y=x=>{for(let E of x)E.visible&&(E.dataLabels||[]).forEach(S=>{var L;let C=S.options||{};S.labelrank=$p(C.labelrank,E.labelrank,(L=E.shapeArgs)==null?void 0:L.height),C.allowOverlap??Number(C.distance)>0?(S.oldOpacity=S.opacity,S.newOpacity=1,hm(S,R)):s.push(S)})};y(p.nodes||[]),y(p.points)}this.hideOverlappingLabels(s)}let Hg={compose:function(R){let s=R.prototype;s.hideOverlappingLabels||(s.hideOverlappingLabels=sx,ix(R,"render",Wh))}},{defaultOptions:nx}=Ee,{noop:qg}=Ne,{addEvent:um,extend:Xg,isObject:Zg,merge:ox,relativeLength:dm}=me,pm={radius:0,scope:"stack",where:void 0},Td=qg,Ed=qg;function ax(R,s,u,p,y={}){let x=Td(R,s,u,p,y),{innerR:E=0,r:S=u,start:C=0,end:L=0}=y;if(y.open||!y.borderRadius)return x;let N=L-C,z=Math.sin(N/2),j=Math.max(Math.min(dm(y.borderRadius||0,S-E),(S-E)/2,S*z/(1+z)),0),W=Math.min(j,N/Math.PI*2*E),Y=x.length-1;for(;Y--;)(function(re,te,Q){let ae,he,Ue,Ie=re[te],Re=re[te+1];if(Re[0]==="Z"&&(Re=re[0]),(Ie[0]==="M"||Ie[0]==="L")&&Re[0]==="A"?(ae=Ie,he=Re,Ue=!0):Ie[0]==="A"&&(Re[0]==="M"||Re[0]==="L")&&(ae=Re,he=Ie),ae&&he&&he.params){let rt=he[1],qe=he[5],st=he.params,{start:Et,end:Bt,cx:$t,cy:At}=st,Kt=qe?rt-Q:rt+Q,si=Kt?Math.asin(Q/Kt):0,Ii=qe?si:-si,hi=Math.cos(si)*Kt;Ue?(st.start=Et+Ii,ae[1]=$t+hi*Math.cos(Et),ae[2]=At+hi*Math.sin(Et),re.splice(te+1,0,["A",Q,Q,0,0,1,$t+rt*Math.cos(st.start),At+rt*Math.sin(st.start)])):(st.end=Bt-Ii,he[6]=$t+rt*Math.cos(st.end),he[7]=At+rt*Math.sin(st.end),re.splice(te+1,0,["A",Q,Q,0,0,1,$t+hi*Math.cos(Bt),At+hi*Math.sin(Bt)])),he[4]=Math.abs(st.end-st.start)<Math.PI?0:1}})(x,Y,Y>1?W:j);return x}function lx(){var R,s;if(this.options.borderRadius&&!(this.chart.is3d&&this.chart.is3d())){let{options:u,yAxis:p}=this,y=u.stacking==="percent",x=(s=(R=nx.plotOptions)==null?void 0:R[this.type])==null?void 0:s.borderRadius,E=jc(u.borderRadius,Zg(x)?x:{}),S=p.options.reversed;for(let C of this.points){let{shapeArgs:L}=C;if(C.shapeType==="roundedRect"&&L){let{width:N=0,height:z=0,y:j=0}=L,W=j,Y=z;if(E.scope==="stack"&&C.stackTotal){let ae=p.translate(y?100:C.stackTotal,!1,!0,!1,!0),he=p.translate(u.threshold||0,!1,!0,!1,!0),Ue=this.crispCol(0,Math.min(ae,he),0,Math.abs(ae-he));W=Ue.y,Y=Ue.height}let re=(C.negative?-1:1)*(S?-1:1)==-1,te=E.where;!te&&this.is("waterfall")&&Math.abs((C.yBottom||0)-(this.translatedThreshold||0))>this.borderWidth&&(te="all"),te||(te="end");let Q=Math.min(dm(E.radius,N),N/2,te==="all"?z/2:1/0)||0;te==="end"&&(re&&(W-=Q),Y+=Q),Xg(L,{brBoxHeight:Y,brBoxY:W,r:Q})}}}}function jc(R,s){return Zg(R)||(R={radius:R||0}),ox(pm,s,R)}function Sd(){let R=jc(this.options.borderRadius);for(let s of this.points){let u=s.shapeArgs;u&&(u.borderRadius=dm(R.radius,(u.r||0)-(u.innerR||0)))}}function Yg(R,s,u,p,y={}){let x=Ed(R,s,u,p,y),{r:E=0,brBoxHeight:S=p,brBoxY:C=s}=y,L=s-C,N=C+S-(s+p),z=L-E>-.1?0:E,j=N-E>-.1?0:E,W=Math.max(z&&L,0),Y=Math.max(j&&N,0),re=[R+z,s],te=[R+u-z,s],Q=[R+u,s+z],ae=[R+u,s+p-j],he=[R+u-j,s+p],Ue=[R+j,s+p],Ie=[R,s+p-j],Re=[R,s+z],rt=(qe,st)=>Math.sqrt(Math.pow(qe,2)-Math.pow(st,2));if(W){let qe=rt(z,z-W);re[0]-=qe,te[0]+=qe,Q[1]=Re[1]=s+z-W}if(p<z-W){let qe=rt(z,z-W-p);Q[0]=ae[0]=R+u-z+qe,he[0]=Math.min(Q[0],he[0]),Ue[0]=Math.max(ae[0],Ue[0]),Ie[0]=Re[0]=R+z-qe,Q[1]=Re[1]=s+p}if(Y){let qe=rt(j,j-Y);he[0]+=qe,Ue[0]-=qe,ae[1]=Ie[1]=s+p-j+Y}if(p<j-Y){let qe=rt(j,j-Y-p);Q[0]=ae[0]=R+u-j+qe,te[0]=Math.min(Q[0],te[0]),re[0]=Math.max(ae[0],re[0]),Ie[0]=Re[0]=R+j-qe,ae[1]=Ie[1]=s}return x.length=0,x.push(["M",...re],["L",...te],["A",z,z,0,0,1,...Q],["L",...ae],["A",j,j,0,0,1,...he],["L",...Ue],["A",j,j,0,0,1,...Ie],["L",...Re],["A",z,z,0,0,1,...re],["Z"]),x}let{diffObjects:Ad,extend:Kg,find:cx,merge:Jg,pick:Md,uniqueKey:Qg}=me;(function(R){function s(p,y){let x=p.condition;(x.callback||function(){return this.chartWidth<=Md(x.maxWidth,Number.MAX_VALUE)&&this.chartHeight<=Md(x.maxHeight,Number.MAX_VALUE)&&this.chartWidth>=Md(x.minWidth,0)&&this.chartHeight>=Md(x.minHeight,0)}).call(this)&&y.push(p._id)}function u(p,y){let x=this.options.responsive,E=this.currentResponsive,S=[],C;!y&&x&&x.rules&&x.rules.forEach(z=>{z._id===void 0&&(z._id=Qg()),this.matchResponsiveRule(z,S)},this);let L=Jg(...S.map(z=>cx((x==null?void 0:x.rules)||[],j=>j._id===z)).map(z=>z==null?void 0:z.chartOptions));L.isResponsiveOptions=!0,S=S.toString()||void 0;let N=E==null?void 0:E.ruleIds;S===N||(E&&(this.currentResponsive=void 0,this.updatingResponsive=!0,this.update(E.undoOptions,p,!0),this.updatingResponsive=!1),S?((C=Ad(L,this.options,!0,this.collectionsWithUpdate)).isResponsiveOptions=!0,this.currentResponsive={ruleIds:S,mergedOptions:L,undoOptions:C},this.updatingResponsive||this.update(L,p,!0)):this.currentResponsive=void 0)}R.compose=function(p){let y=p.prototype;return y.matchResponsiveRule||Kg(y,{matchResponsiveRule:s,setResponsive:u}),p}})(He||(He={}));let e_=He;Ne.AST=Dr,Ne.Axis=xa,Ne.Chart=Lo,Ne.Color=Ye,Ne.DataLabel=yd,Ne.DataTableCore=Bi,Ne.Fx=Si,Ne.HTMLElement=Ga,Ne.Legend=vp,Ne.LegendSymbol=Sr,Ne.OverlappingDataLabels=Ne.OverlappingDataLabels||Hg,Ne.PlotLineOrBand=Lc,Ne.Point=J,Ne.Pointer=Rt,Ne.RendererRegistry=Qn,Ne.Series=tn,Ne.SeriesRegistry=wr,Ne.StackItem=qf,Ne.SVGElement=js,Ne.SVGRenderer=vc,Ne.Templating=Ys,Ne.Tick=Ko,Ne.Time=hn,Ne.Tooltip=Ch,Ne.animate=ls.animate,Ne.animObject=ls.animObject,Ne.chart=Lo.chart,Ne.color=Ye.parse,Ne.dateFormat=Ys.dateFormat,Ne.defaultOptions=Ee.defaultOptions,Ne.distribute=pa.distribute,Ne.format=Ys.format,Ne.getDeferredAnimation=ls.getDeferredAnimation,Ne.getOptions=Ee.getOptions,Ne.numberFormat=Ys.numberFormat,Ne.seriesType=wr.seriesType,Ne.setAnimation=ls.setAnimation,Ne.setOptions=Ee.setOptions,Ne.stop=ls.stop,Ne.time=Ee.defaultTime,Ne.timers=Si.timers,{compose:function(R,s,u){let p=R.types.pie;if(!s.symbolCustomAttribs.includes("borderRadius")){let y=u.prototype.symbols;um(R,"afterColumnTranslate",lx,{order:9}),um(p,"afterTranslate",Sd),s.symbolCustomAttribs.push("borderRadius","brBoxHeight","brBoxY"),Td=y.arc,Ed=y.roundedRect,y.arc=ax,y.roundedRect=Yg}},optionsToObject:jc}.compose(Ne.Series,Ne.SVGElement,Ne.SVGRenderer),$y.compose(Ne.Series.types.column),yd.compose(Ne.Series),Fu.compose(Ne.Axis),Ga.compose(Ne.SVGRenderer),vp.compose(Ne.Chart),Ic.compose(Ne.Axis),Hg.compose(Ne.Chart),ex.compose(Ne.Series.types.pie),Lc.compose(Ne.Chart,Ne.Axis),Rt.compose(Ne.Chart),e_.compose(Ne.Chart),Sn.compose(Ne.Axis,Ne.Chart,Ne.Series),Pg.compose(Ne.Axis,Ne.Chart,Ne.Series),Ch.compose(Ne.Pointer),me.extend(Ne,me);let t_=Ne;return kt.default})())}(r0)),r0.exports}const fR=rI(ok);(function(a,h){(function(_,w){a.exports=w(pR(),fR)})(self,(_,w)=>(()=>{var M={879:o=>{o.exports=_},744:o=>{o.exports=w}},D={};function B(o){var X=D[o];if(X!==void 0)return X.exports;var ie=D[o]={exports:{}};return M[o](ie,ie.exports,B),ie.exports}B.n=o=>{var X=o&&o.__esModule?()=>o.default:()=>o;return B.d(X,{a:X}),X},B.d=(o,X)=>{for(var ie in X)B.o(X,ie)&&!B.o(o,ie)&&Object.defineProperty(o,ie,{enumerable:!0,get:X[ie]})},B.o=(o,X)=>Object.prototype.hasOwnProperty.call(o,X),B.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var q={};return(()=>{B.r(q),B.d(q,{Chart:()=>We,default:()=>pt});var o=B(879),X=B.n(o),ie=function yt(Ze,Ae){var Be=X().isArray(Ze)?[]:{};function He(lt,kt){!X().isObject(lt,!Ae)||X().isClass(lt)||X().isDOMElement(lt)?Be[kt]=lt:Be[kt]=yt(lt,Ae)}return X().isArray(Ze)?Ze.forEach(function(lt,kt){return He(lt,kt)}):X().objectEach(Ze,He),Be},oe=B(744);function xe(yt){return function(Ze){if(Array.isArray(Ze))return Te(Ze)}(yt)||function(Ze){if(typeof Symbol<"u"&&Ze[Symbol.iterator]!=null||Ze["@@iterator"]!=null)return Array.from(Ze)}(yt)||function(Ze,Ae){if(Ze){if(typeof Ze=="string")return Te(Ze,Ae);var Be=Object.prototype.toString.call(Ze).slice(8,-1);if(Be==="Object"&&Ze.constructor&&(Be=Ze.constructor.name),Be==="Map"||Be==="Set")return Array.from(Ze);if(Be==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Be))return Te(Ze,Ae)}}(yt)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Te(yt,Ze){(Ze==null||Ze>yt.length)&&(Ze=yt.length);for(var Ae=0,Be=new Array(Ze);Ae<Ze;Ae++)Be[Ae]=yt[Ae];return Be}const je=function(yt){var Ze=this;return{render:function(){return(0,oe.h)("div",{ref:"chart"})},beforeUnmount:function(){var Ae;return Ze==null||(Ae=Ze.chart)===null||Ae===void 0?void 0:Ae.destroy()},props:{constructorType:{type:String,default:"chart"},options:{type:Object,required:!0},callback:Function,updateArgs:{type:Array,default:function(){return[!0,!0]}},highcharts:{type:Object},deepCopyOnUpdate:{type:Boolean,default:!0}},watch:{options:{handler:function(Ae){var Be;(Be=this.chart).update.apply(Be,[ie(Ae,this.deepCopyOnUpdate)].concat(xe(this.updateArgs)))},deep:!0}},mounted:function(){var Ae=this.highcharts||yt;Ae[this.constructorType]?this.options?this.chart=Ae[this.constructorType](this.$refs.chart,ie(this.options,!0),this.callback?this.callback:null):console.error('The "options" parameter was not passed.'):console.error("'".concat(this.constructorType,"' constructor-type is incorrect. Sometimes this error is caused by the fact, that the corresponding module wasn't imported."))}}};var We=je(X());function pt(yt){var Ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};yt.component(Ze.tagName||"highcharts",je(Ze.highcharts||X()))}})(),q})())})(OE);var mR=OE.exports;const gR=rE(mR),ky=Y_(xP);ky.use(nI());ky.use(dR);ky.use(gR);ky.mount("#app");
